/*! For license information please see bitbybit-runner-threejs.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.bitbybitRunner=e():t.bitbybitRunner=e()}(this,(()=>(()=>{var t={258:t=>{t.exports=function(){var t={},e=this,i=(new Function("try {return this===window;}catch(e){ return false;}"),new Function("try {return this===global;}catch(e){return false;}")),n=new Function("try {return typeof importScripts === 'function';}catch(e){return false;}");if(i()&&n(),i()||n()){var r=e;if(n()){onmessage=function(t){if(t.data.className&&t.data.methodName){var i=(n=t.data.className,r=t.data.methodName,s=e,n.split(".").forEach((function(t){s&&(s=s[t])})),s?s[r]:null);if(!i)return console.error("could not find "+t.data.className+"."+t.data.methodName);postMessage({result:i.apply(null,t.data.args),id:t.data.id})}var n,r,s}}}return function(t,e,i){"use strict";e.geom=e.geom||{},e.exe=e.exe||{},e.eval=e.eval||{},e.core=e.core||{},e.promhx=e.promhx||{};var n={},r=function(){return C.__string_rec(this,"")};function s(t,e){function i(){}i.prototype=t;var n=new i;for(var r in e)n[r]=e[r];return e.toString!==Object.prototype.toString&&(n.toString=e.toString),n}var o=function(){};n.HxOverrides=o,o.__name__=["HxOverrides"],o.strDate=function(t){switch(t.length){case 8:var e=t.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),i.setUTCSeconds(e[2]),i;case 10:var n=t.split("-");return new Date(n[0],n[1]-1,n[2],0,0,0);case 19:var r=t.split(" "),s=r[0].split("-"),o=r[1].split(":");return new Date(s[0],s[1]-1,s[2],o[0],o[1],o[2]);default:throw new E("Invalid date format : "+t)}},o.cca=function(t,e){var i=t.charCodeAt(e);if(i==i)return i},o.substr=function(t,e,i){return null!=e&&0!=e&&null!=i&&i<0?"":(null==i&&(i=t.length),e<0?(e=t.length+e)<0&&(e=0):i<0&&(i=t.length+i-e),t.substr(e,i))},o.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var a=function(){};n.Lambda=a,a.__name__=["Lambda"],a.fold=function(t,e,i){for(var n=se(t)();n.hasNext();)i=e(n.next(),i);return i};var c=function(){this.length=0};n.List=c,c.__name__=["List"],c.prototype={add:function(t){var e=[t];null==this.h?this.h=e:this.q[1]=e,this.q=e,this.length++},pop:function(){if(null==this.h)return null;var t=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,t},isEmpty:function(){return null==this.h},__class__:c},Math.__name__=["Math"];var l=function(){};n.Reflect=l,l.__name__=["Reflect"],l.field=function(t,e){try{return t[e]}catch(t){return t instanceof E&&(t=t.val),null}},l.callMethod=function(t,e,i){return e.apply(t,i)},l.fields=function(t){var e=[];if(null!=t){var i=Object.prototype.hasOwnProperty;for(var n in t)"__id__"!=n&&"hx__closures__"!=n&&i.call(t,n)&&e.push(n)}return e},l.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},l.deleteField=function(t,e){return!!Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],!0)};var h=function(){};n.Std=h,h.__name__=["Std"],h.string=function(t){return C.__string_rec(t,"")},h.parseFloat=function(t){return parseFloat(t)};var u=function(){this.b=""};n.StringBuf=u,u.__name__=["StringBuf"],u.prototype={add:function(t){this.b+=h.string(t)},__class__:u};var d=function(){};n.StringTools=d,d.__name__=["StringTools"],d.fastCodeAt=function(t,e){return t.charCodeAt(e)};var p=n.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};p.TNull=["TNull",0],p.TNull.toString=r,p.TNull.__enum__=p,p.TInt=["TInt",1],p.TInt.toString=r,p.TInt.__enum__=p,p.TFloat=["TFloat",2],p.TFloat.toString=r,p.TFloat.__enum__=p,p.TBool=["TBool",3],p.TBool.toString=r,p.TBool.__enum__=p,p.TObject=["TObject",4],p.TObject.toString=r,p.TObject.__enum__=p,p.TFunction=["TFunction",5],p.TFunction.toString=r,p.TFunction.__enum__=p,p.TClass=function(t){var e=["TClass",6,t];return e.__enum__=p,e.toString=r,e},p.TEnum=function(t){var e=["TEnum",7,t];return e.__enum__=p,e.toString=r,e},p.TUnknown=["TUnknown",8],p.TUnknown.toString=r,p.TUnknown.__enum__=p;var f=function(){};n.Type=f,f.__name__=["Type"],f.getClassName=function(t){var e=t.__name__;return null==e?null:e.join(".")},f.getEnumName=function(t){return t.__ename__.join(".")},f.resolveClass=function(t){var e=n[t];return null!=e&&e.__name__?e:null},f.resolveEnum=function(t){var e=n[t];return null!=e&&e.__ename__?e:null},f.createEmptyInstance=function(t){function e(){}return e.prototype=t.prototype,new e},f.createEnum=function(t,e,i){var n=l.field(t,e);if(null==n)throw new E("No such constructor "+e);if(l.isFunction(n)){if(null==i)throw new E("Constructor "+e+" need parameters");return l.callMethod(t,n,i)}if(null!=i&&0!=i.length)throw new E("Constructor "+e+" does not need parameters");return n},f.getEnumConstructs=function(t){return t.__constructs__.slice()},f.typeof=function(t){switch(typeof t){case"boolean":return p.TBool;case"string":return p.TClass(String);case"number":return Math.ceil(t)==t%2147483648?p.TInt:p.TFloat;case"object":if(null==t)return p.TNull;var e=t.__enum__;if(null!=e)return p.TEnum(e);var i=C.getClass(t);return null!=i?p.TClass(i):p.TObject;case"function":return t.__name__||t.__ename__?p.TObject:p.TFunction;case"undefined":return p.TNull;default:return p.TUnknown}};var m=function(){};n["haxe.IMap"]=m,m.__name__=["haxe","IMap"];var g=function(t,e){this.high=t,this.low=e};n["haxe._Int64.___Int64"]=g,g.__name__=["haxe","_Int64","___Int64"],g.prototype={__class__:g};var v=function(){this.buf=new u,this.cache=[],this.useCache=v.USE_CACHE,this.useEnumIndex=v.USE_ENUM_INDEX,this.shash=new M,this.scount=0};n["haxe.Serializer"]=v,v.__name__=["haxe","Serializer"],v.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.get(t);if(null!=e)return this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e);this.shash.set(t,this.scount++),this.buf.b+="y",null==(t=encodeURIComponent(t)).length?this.buf.b+="null":this.buf.b+=""+t.length,this.buf.b+=":",this.buf.b+=null==t?"null":""+t},serializeRef:function(t){for(var e=typeof t,i=0,n=this.cache.length;i<n;){var r=i++,s=this.cache[r];if(typeof s==e&&s==t)return this.buf.b+="r",this.buf.b+=null==r?"null":""+r,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,i=l.fields(t);e<i.length;){var n=i[e];++e,this.serializeString(n),this.serialize(l.field(t,n))}this.buf.b+="g"},serialize:function(t){var e=f.typeof(t);switch(e[1]){case 0:this.buf.b+="n";break;case 1:var i=t;if(0==i)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==i?"null":""+i;break;case 2:var n=t;isNaN(n)?this.buf.b+="k":isFinite(n)?(this.buf.b+="d",this.buf.b+=null==n?"null":""+n):this.buf.b+=n<0?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 6:var r=e[2];if(r==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(r){case Array:var s=0;this.buf.b+="a";for(var o=t.length,a=0;a<o;){var d=a++;null==t[d]?s++:(s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s),s=0),this.serialize(t[d]))}s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s)),this.buf.b+="h";break;case c:this.buf.b+="l";for(var p=t.h,m=null;null!=p;){var g;m=p[0],p=p[1],g=m,this.serialize(g)}this.buf.b+="h";break;case Date:var _=t;this.buf.b+="v",this.buf.add(_.getTime());break;case M:this.buf.b+="b";for(var b=t,w=b.keys();w.hasNext();){var T=w.next();this.serializeString(T),this.serialize(null!=me[T]?b.getReserved(T):b.h[T])}this.buf.b+="h";break;case y:this.buf.b+="q";for(var P=t,A=P.keys();A.hasNext();){var D=A.next();this.buf.b+=":",this.buf.b+=null==D?"null":""+D,this.serialize(P.h[D])}this.buf.b+="h";break;case x:this.buf.b+="M";for(var R=t,k=R.keys();k.hasNext();){var I=k.next(),O=l.field(I,"__id__");l.deleteField(I,"__id__"),this.serialize(I),I.__id__=O,this.serialize(R.h[I.__id__])}this.buf.b+="h";break;case S:for(var L=t,U=0,N=L.length-2,W=new u,F=v.BASE64;U<N;){var B=L.get(U++),z=L.get(U++),V=L.get(U++);W.add(F.charAt(B>>2)),W.add(F.charAt(63&(B<<4|z>>4))),W.add(F.charAt(63&(z<<2|V>>6))),W.add(F.charAt(63&V))}if(U==N){var H=L.get(U++),G=L.get(U++);W.add(F.charAt(H>>2)),W.add(F.charAt(63&(H<<4|G>>4))),W.add(F.charAt(G<<2&63))}else if(U==N+1){var j=L.get(U++);W.add(F.charAt(j>>2)),W.add(F.charAt(j<<4&63))}var X=W.b;this.buf.b+="s",null==X.length?this.buf.b+="null":this.buf.b+=""+X.length,this.buf.b+=":",this.buf.b+=null==X?"null":""+X;break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(f.getClassName(r)),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(f.getClassName(r)),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 4:if(C.__instanceof(t,pe)){var q=f.getClassName(t);this.buf.b+="A",this.serializeString(q)}else if(C.__instanceof(t,fe))this.buf.b+="B",this.serializeString(f.getEnumName(t));else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 7:var Y=e[2];if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}this.useEnumIndex?this.buf.b+="j":this.buf.b+="w",this.serializeString(f.getEnumName(Y)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=h.string(t[1])):this.serializeString(t[0]),this.buf.b+=":";var Z=t.length;this.buf.b+=h.string(Z-2);for(var K=2;K<Z;){var J=K++;this.serialize(t[J])}this.useCache&&this.cache.push(t);break;case 5:throw new E("Cannot serialize function");default:throw new E("Cannot serialize "+h.string(t))}},__class__:v};var _=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];var e=_.DEFAULT_RESOLVER;null==e&&(e=f,_.DEFAULT_RESOLVER=e),this.setResolver(e)};n["haxe.Unserializer"]=_,_.__name__=["haxe","Unserializer"],_.initCodes=function(){for(var t=[],e=0,i=_.BASE64.length;e<i;){var n=e++;t[_.BASE64.charCodeAt(n)]=n}return t},_.prototype={setResolver:function(t){this.resolver=null==t?{resolveClass:function(t){return null},resolveEnum:function(t){return null}}:t},get:function(t){return this.buf.charCodeAt(t)},readDigits:function(){for(var t=0,e=!1,i=this.pos;;){var n=this.buf.charCodeAt(this.pos);if(n!=n)break;if(45!=n){if(n<48||n>57)break;t=10*t+(n-48),this.pos++}else{if(this.pos!=i)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if(!(e>=43&&e<58||101==e||69==e))break;this.pos++}return h.parseFloat(o.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw new E("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw new E("Invalid object key");var i=this.unserialize();t[e]=i}this.pos++},unserializeEnum:function(t,e){if(58!=this.get(this.pos++))throw new E("Invalid enum format");var i=this.readDigits();if(0==i)return f.createEnum(t,e);for(var n=[];i-- >0;)n.push(this.unserialize());return f.createEnum(t,e,n)},unserialize:function(){switch(this.get(this.pos++)){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var t=this.readDigits();if(58!=this.get(this.pos++)||this.length-this.pos<t)throw new E("Invalid string length");var e=o.substr(this.buf,this.pos,t);return this.pos+=t,e=decodeURIComponent(e.split("+").join(" ")),this.scache.push(e),e;case 107:return NaN;case 109:return-1/0;case 112:return 1/0;case 97:this.buf;var i=[];for(this.cache.push(i);;){var n=this.buf.charCodeAt(this.pos);if(104==n){this.pos++;break}if(117==n){this.pos++;var r=this.readDigits();i[i.length+r-1]=null}else i.push(this.unserialize())}return i;case 111:var s={};return this.cache.push(s),this.unserializeObject(s),s;case 114:var a=this.readDigits();if(a<0||a>=this.cache.length)throw new E("Invalid reference");return this.cache[a];case 82:var l=this.readDigits();if(l<0||l>=this.scache.length)throw new E("Invalid string reference");return this.scache[l];case 120:throw new E(this.unserialize());case 99:var h=this.unserialize(),u=this.resolver.resolveClass(h);if(null==u)throw new E("Class not found "+h);var p=f.createEmptyInstance(u);return this.cache.push(p),this.unserializeObject(p),p;case 119:var m=this.unserialize(),g=this.resolver.resolveEnum(m);if(null==g)throw new E("Enum not found "+m);var v=this.unserializeEnum(g,this.unserialize());return this.cache.push(v),v;case 106:var b=this.unserialize(),w=this.resolver.resolveEnum(b);if(null==w)throw new E("Enum not found "+b);this.pos++;var T=this.readDigits(),C=f.getEnumConstructs(w)[T];if(null==C)throw new E("Unknown enum index "+b+"@"+T);var P=this.unserializeEnum(w,C);return this.cache.push(P),P;case 108:var A=new c;for(this.cache.push(A),this.buf;104!=this.buf.charCodeAt(this.pos);)A.add(this.unserialize());return this.pos++,A;case 98:var D=new M;for(this.cache.push(D),this.buf;104!=this.buf.charCodeAt(this.pos);){var R=this.unserialize();D.set(R,this.unserialize())}return this.pos++,D;case 113:var k=new y;this.cache.push(k),this.buf;for(var I=this.get(this.pos++);58==I;){var O=this.readDigits();k.set(O,this.unserialize()),I=this.get(this.pos++)}if(104!=I)throw new E("Invalid IntMap format");return k;case 77:var L=new x;for(this.cache.push(L),this.buf;104!=this.buf.charCodeAt(this.pos);){var U=this.unserialize();L.set(U,this.unserialize())}return this.pos++,L;case 118:var N;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)){var W=o.substr(this.buf,this.pos,19);N=o.strDate(W),this.pos+=19}else{var F=this.readFloat(),B=new Date;B.setTime(F),N=B}return this.cache.push(N),N;case 115:var z=this.readDigits(),V=this.buf;if(58!=this.get(this.pos++)||this.length-this.pos<z)throw new E("Invalid bytes length");var H=_.CODES;null==H&&(H=_.initCodes(),_.CODES=H);var G,j=this.pos,X=3&z;G=3*(z>>2)+(X>=2?X-1:0);for(var q=j+(z-X),Y=S.alloc(G),Z=0;j<q;){var K=H[d.fastCodeAt(V,j++)],J=H[d.fastCodeAt(V,j++)];Y.set(Z++,K<<2|J>>4);var $=H[d.fastCodeAt(V,j++)];Y.set(Z++,J<<4|$>>2);var Q=H[d.fastCodeAt(V,j++)];Y.set(Z++,$<<6|Q)}if(X>=2){var tt=H[d.fastCodeAt(V,j++)],et=H[d.fastCodeAt(V,j++)];if(Y.set(Z++,tt<<2|et>>4),3==X){var it=H[d.fastCodeAt(V,j++)];Y.set(Z++,et<<4|it>>2)}}return this.pos+=z,this.cache.push(Y),Y;case 67:var nt=this.unserialize(),rt=this.resolver.resolveClass(nt);if(null==rt)throw new E("Class not found "+nt);var st=f.createEmptyInstance(rt);if(this.cache.push(st),st.hxUnserialize(this),103!=this.get(this.pos++))throw new E("Invalid custom data");return st;case 65:var ot=this.unserialize(),at=this.resolver.resolveClass(ot);if(null==at)throw new E("Class not found "+ot);return at;case 66:var ct=this.unserialize(),lt=this.resolver.resolveEnum(ct);if(null==lt)throw new E("Enum not found "+ct);return lt}throw this.pos--,new E("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:_};var y=function(){this.h={}};n["haxe.ds.IntMap"]=y,y.__name__=["haxe","ds","IntMap"],y.__interfaces__=[m],y.prototype={set:function(t,e){this.h[t]=e},remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(0|e);return o.iter(t)},__class__:y};var x=function(){this.h={},this.h.__keys__={}};n["haxe.ds.ObjectMap"]=x,x.__name__=["haxe","ds","ObjectMap"],x.__interfaces__=[m],x.prototype={set:function(t,e){var i=t.__id__||(t.__id__=++x.count);this.h[i]=e,this.h.__keys__[i]=t},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return o.iter(t)},__class__:x};var b=n["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};b.Some=function(t){var e=["Some",0,t];return e.__enum__=b,e.toString=r,e},b.None=["None",1],b.None.toString=r,b.None.__enum__=b;var M=function(){this.h={}};n["haxe.ds.StringMap"]=M,M.__name__=["haxe","ds","StringMap"],M.__interfaces__=[m],M.prototype={set:function(t,e){null!=me[t]?this.setReserved(t,e):this.h[t]=e},get:function(t){return null!=me[t]?this.getReserved(t):this.h[t]},setReserved:function(t,e){null==this.rh&&(this.rh={}),this.rh["$"+t]=e},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},keys:function(){var t=this.arrayKeys();return o.iter(t)},arrayKeys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(e);if(null!=this.rh)for(var e in this.rh)36==e.charCodeAt(0)&&t.push(e.substr(1));return t},__class__:M};var S=function(t){this.length=t.byteLength,this.b=new ve(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};n["haxe.io.Bytes"]=S,S.__name__=["haxe","io","Bytes"],S.alloc=function(t){return new S(new ge(t))},S.prototype={get:function(t){return this.b[t]},set:function(t,e){this.b[t]=255&e},__class__:S};var w=n["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};w.Blocked=["Blocked",0],w.Blocked.toString=r,w.Blocked.__enum__=w,w.Overflow=["Overflow",1],w.Overflow.toString=r,w.Overflow.__enum__=w,w.OutsideBounds=["OutsideBounds",2],w.OutsideBounds.toString=r,w.OutsideBounds.__enum__=w,w.Custom=function(t){var e=["Custom",3,t];return e.__enum__=w,e.toString=r,e};var T=function(){};n["haxe.io.FPHelper"]=T,T.__name__=["haxe","io","FPHelper"],T.i32ToFloat=function(t){var e=t>>>23&255,i=8388607&t;return 0==i&&0==e?0:(1-(t>>>31<<1))*(1+Math.pow(2,-23)*i)*Math.pow(2,e-127)},T.floatToI32=function(t){if(0==t)return 0;var e;e=t<0?-t:t;var i=Math.floor(Math.log(e)/.6931471805599453);return i<-127?i=-127:i>128&&(i=128),(t<0?-2147483648:0)|i+127<<23|8388607&Math.round(8388608*(e/Math.pow(2,i)-1))},T.i64ToDouble=function(t,e){var i=(e>>20&2047)-1023,n=4294967296*(1048575&e)+2147483648*(t>>>31)+(2147483647&t);return 0==n&&-1023==i?0:(1-(e>>>31<<1))*(1+Math.pow(2,-52)*n)*Math.pow(2,i)},T.doubleToI64=function(t){var e=T.i64tmp;if(0==t)e.low=0,e.high=0;else{var i;i=t<0?-t:t;var n,r=Math.floor(Math.log(i)/.6931471805599453),s=4503599627370496*(i/Math.pow(2,r)-1),o=0|(n=Math.round(s)),a=n/4294967296|0;e.low=o,e.high=(t<0?-2147483648:0)|r+1023<<20|a}return e};var E=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,E)};n["js._Boot.HaxeError"]=E,E.__name__=["js","_Boot","HaxeError"],E.__super__=Error,E.prototype=s(Error.prototype,{__class__:E});var C=function(){};n["js.Boot"]=C,C.__name__=["js","Boot"],C.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;var i=C.__nativeClassName(t);return null!=i?C.__resolveNativeClass(i):null},C.__string_rec=function(t,e){if(null==t)return"null";if(e.length>=5)return"<...>";var i=typeof t;switch("function"==i&&(t.__name__||t.__ename__)&&(i="object"),i){case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var n=t[0]+"(";e+="\t";for(var r=2,s=t.length;r<s;){var o=r++;n+=2!=o?","+C.__string_rec(t[o],e):C.__string_rec(t[o],e)}return n+")"}var a=t.length,c="[";e+="\t";for(var l=0;l<a;){var h=l++;c+=(h>0?",":"")+C.__string_rec(t[h],e)}return c+"]"}var u;try{u=t.toString}catch(t){return t instanceof E&&(t=t.val),"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var d=t.toString();if("[object Object]"!=d)return d}var p=null,f="{\n";e+="\t";var m=null!=t.hasOwnProperty;for(var p in t)m&&!t.hasOwnProperty(p)||"prototype"!=p&&"__class__"!=p&&"__super__"!=p&&"__interfaces__"!=p&&"__properties__"!=p&&(2!=f.length&&(f+=", \n"),f+=e+p+" : "+C.__string_rec(t[p],e));return f+"\n"+(e=e.substring(1))+"}";case"function":return"<function>";case"string":return t;default:return String(t)}},C.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var n=0,r=i.length;n<r;){var s=i[n++];if(s==e||C.__interfLoop(s,e))return!0}return C.__interfLoop(t.__super__,e)},C.__instanceof=function(t,e){if(null==e)return!1;switch(e){case le:return(0|t)===t;case ue:return"number"==typeof t;case de:return"boolean"==typeof t;case String:return"string"==typeof t;case Array:return t instanceof Array&&null==t.__enum__;case he:return!0;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(C.__interfLoop(C.getClass(t),e))return!0}else if("object"==typeof e&&C.__isNativeObj(e)&&t instanceof e)return!0;return e==pe&&null!=t.__name__||e==fe&&null!=t.__ename__||t.__enum__==e}},C.__nativeClassName=function(t){var e=C.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},C.__isNativeObj=function(t){return null!=C.__nativeClassName(t)},C.__resolveNativeClass=function(t){return i[t]};var P=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var e=t;this.a=[];for(var i=0;i<e;){var n=i++;this.a[n]=0}this.byteLength=e}};n["js.html.compat.ArrayBuffer"]=P,P.__name__=["js","html","compat","ArrayBuffer"],P.sliceImpl=function(t,e){var i=new ve(this,t,null==e?null:e-t),n=new ge(i.byteLength);return new ve(n).set(i),n},P.prototype={slice:function(t,e){return new P(this.a.slice(t,e))},__class__:P};var A=function(t,e,i){if(this.buf=t,this.offset=null==e?0:e,this.length=null==i?t.byteLength-this.offset:i,this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new E(w.OutsideBounds)};n["js.html.compat.DataView"]=A,A.__name__=["js","html","compat","DataView"],A.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];return e>=128?e-256:e},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var i=this.getUint16(t,e);return i>=32768?i-65536:i},getUint16:function(t,e){return e?this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8:this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var i=this.offset+t,n=this.buf.a[i++],r=this.buf.a[i++],s=this.buf.a[i++],o=this.buf.a[i++];return e?n|r<<8|s<<16|o<<24:o|s<<8|r<<16|n<<24},getUint32:function(t,e){var i=this.getInt32(t,e);return i<0?i+4294967296:i},getFloat32:function(t,e){return T.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var i=this.getInt32(t,e),n=this.getInt32(t+4,e);return T.i64ToDouble(e?i:n,e?n:i)},setInt8:function(t,e){this.buf.a[t+this.offset]=e<0?e+128&255:255&e},setUint8:function(t,e){this.buf.a[t+this.offset]=255&e},setInt16:function(t,e,i){this.setUint16(t,e<0?e+65536:e,i)},setUint16:function(t,e,i){var n=t+this.offset;i?(this.buf.a[n]=255&e,this.buf.a[n++]=e>>8&255):(this.buf.a[n++]=e>>8&255,this.buf.a[n]=255&e)},setInt32:function(t,e,i){this.setUint32(t,e,i)},setUint32:function(t,e,i){var n=t+this.offset;i?(this.buf.a[n++]=255&e,this.buf.a[n++]=e>>8&255,this.buf.a[n++]=e>>16&255,this.buf.a[n++]=e>>>24):(this.buf.a[n++]=e>>>24,this.buf.a[n++]=e>>16&255,this.buf.a[n++]=e>>8&255,this.buf.a[n++]=255&e)},setFloat32:function(t,e,i){this.setUint32(t,T.floatToI32(e),i)},setFloat64:function(t,e,i){var n=T.doubleToI64(e);i?(this.setUint32(t,n.low),this.setUint32(t,n.high)):(this.setUint32(t,n.high),this.setUint32(t,n.low))},__class__:A};var D=function(){};n["js.html.compat.Uint8Array"]=D,D.__name__=["js","html","compat","Uint8Array"],D._new=function(t,e,i){var n;if("number"==typeof t){n=[];for(var r=0;r<t;)n[r++]=0;n.byteLength=n.length,n.byteOffset=0,n.buffer=new P(n)}else if(C.__instanceof(t,P)){var s=t;null==e&&(e=0),null==i&&(i=s.byteLength-e),(n=0==e?s.a:s.a.slice(e,e+i)).byteLength=n.length,n.byteOffset=e,n.buffer=s}else{if(!(t instanceof Array&&null==t.__enum__))throw new E("TODO "+h.string(t));(n=t.slice()).byteLength=n.length,n.byteOffset=0,n.buffer=new P(n)}return n.subarray=D._subarray,n.set=D._set,n},D._set=function(t,e){var i=this;if(C.__instanceof(t.buffer,P)){var n=t;if(t.byteLength+e>i.byteLength)throw new E("set() outside of range");for(var r=0,s=t.byteLength;r<s;){var o=r++;i[o+e]=n[o]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new E("TODO");var a=t;if(a.length+e>i.byteLength)throw new E("set() outside of range");for(var c=0,l=a.length;c<l;){var h=c++;i[h+e]=a[h]}}},D._subarray=function(t,e){var i=D._new(this.slice(t,e));return i.byteOffset=t,i};var R=function(t){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=t&&R.link(t,this,(function(t){return t}))};n["promhx.base.AsyncBase"]=R,R.__name__=["promhx","base","AsyncBase"],R.link=function(t,e,i){t._update.push({async:e,linkf:function(t){e.handleResolve(i(t))}}),R.immediateLinkUpdate(t,e,i)},R.immediateLinkUpdate=function(t,e,i){if(!t._errored||t._errorPending||t._error.length>0||e.handleError(t._errorVal),t._resolved&&!t._pending)try{e.handleResolve(i(t._val))}catch(t){t instanceof E&&(t=t.val),e.handleError(t)}},R.linkAll=function(t,e){for(var i=function(i,n,r){if(0==i.length||R.allFulfilled(i)){for(var s,o=[],a=se(t)();a.hasNext();){var c=a.next();o.push(c==n?r:c._val)}s=o,e.handleResolve(s)}},n=se(t)();n.hasNext();){var r=n.next();r._update.push({async:e,linkf:function(t,e,i){return function(n){t(e,i,n)}}(i,function(e){for(var i=[],n=se(t)();n.hasNext();){var s=n.next();s!=r&&i.push(s)}return i}(),r)})}R.allFulfilled(t)&&e.handleResolve(function(e){for(var i=[],n=se(t)();n.hasNext();){var r=n.next();i.push(r._val)}return i}())},R.pipeLink=function(t,e,i){var n=!1,r=function(t){if(!n){n=!0;var r=i(t);r._update.push({async:e,linkf:ce(e,e.handleResolve)}),R.immediateLinkUpdate(r,e,(function(t){return t}))}};if(t._update.push({async:e,linkf:r}),t._resolved&&!t._pending)try{r(t._val)}catch(t){t instanceof E&&(t=t.val),e.handleError(t)}},R.allResolved=function(t){for(var e=se(t)();e.hasNext();)if(!e.next()._resolved)return!1;return!0},R.allFulfilled=function(t){for(var e=se(t)();e.hasNext();)if(!e.next()._fulfilled)return!1;return!0},R.prototype={catchError:function(t){return this._error.push(t),this},errorThen:function(t){return this._errorMap=t,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return this._error.length>0},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(t){this._resolve(t)},_resolve:function(t){var e,i,n=this;this._pending?U.enqueue((e=ce(this,this._resolve),i=t,function(){e(i)})):(this._resolved=!0,this._pending=!0,U.queue.add((function(){n._val=t;for(var e=0,i=n._update;e<i.length;){var r=i[e];++e;try{r.linkf(t)}catch(t){t instanceof E&&(t=t.val),r.async.handleError(t)}}n._fulfilled=!0,n._pending=!1})),U.continueOnNextLoop())},handleError:function(t){this._handleError(t)},_handleError:function(t){var e=this,i=function(t){if(e._error.length>0)for(var i=0,n=e._error;i<n.length;){var r=n[i];++i,r(t)}else{if(!(e._update.length>0))throw new E(t);for(var s=0,o=e._update;s<o.length;){var a=o[s];++s,a.async.handleError(t)}}e._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=t,U.queue.add((function(){if(null!=e._errorMap)try{e._resolve(e._errorMap(t))}catch(t){t instanceof E&&(t=t.val),i(t)}else i(t)})),U.continueOnNextLoop())},then:function(t){var e=new R(null);return R.link(this,e,t),e},unlink:function(t){var e=this;U.queue.add((function(){e._update=e._update.filter((function(e){return e.async!=t}))})),U.continueOnNextLoop()},isLinked:function(t){for(var e=0,i=this._update;e<i.length;){var n=i[e];if(++e,n.async==t)return!0}return!1},__class__:R};var k=e.promhx.Deferred=function(){R.call(this)};n["promhx.Deferred"]=k,k.__name__=["promhx","Deferred"],k.__super__=R,k.prototype=s(R.prototype,{resolve:function(t){this.handleResolve(t)},throwError:function(t){this.handleError(t)},promise:function(){return new I(this)},stream:function(){return new O(this)},publicStream:function(){return new L(this)},__class__:k});var I=e.promhx.Promise=function(t){R.call(this,t),this._rejected=!1};n["promhx.Promise"]=I,I.__name__=["promhx","Promise"],I.whenAll=function(t){var e=new I(null);return R.linkAll(t,e),e},I.promise=function(t){var e=new I;return e.handleResolve(t),e},I.__super__=R,I.prototype=s(R.prototype,{isRejected:function(){return this._rejected},reject:function(t){this._rejected=!0,this.handleError(t)},handleResolve:function(t){if(this._resolved){throw new E(N.AlreadyResolved("Promise has already been resolved"))}this._resolve(t)},then:function(t){var e=new I(null);return R.link(this,e,t),e},unlink:function(t){var e=this;U.queue.add((function(){if(e._fulfilled)e._update=e._update.filter((function(e){return e.async!=t}));else{e.handleError(N.DownstreamNotFullfilled("Downstream Promise is not fullfilled"))}})),U.continueOnNextLoop()},handleError:function(t){this._rejected=!0,this._handleError(t)},pipe:function(t){var e=new I(null);return R.pipeLink(this,e,t),e},errorPipe:function(t){var e=new I;return this.catchError((function(i){t(i).then(ce(e,e._resolve))})),this.then(ce(e,e._resolve)),e},__class__:I});var O=e.promhx.Stream=function(t){R.call(this,t),this._end_promise=new I};n["promhx.Stream"]=O,O.__name__=["promhx","Stream"],O.foreach=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var n=i.next();e.handleResolve(n)}return e.end(),e},O.wheneverAll=function(t){var e=new O(null);return R.linkAll(t,e),e},O.concatAll=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var n=i.next();e.concat(n)}return e},O.mergeAll=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var n=i.next();e.merge(n)}return e},O.stream=function(t){var e=new O(null);return e.handleResolve(t),e},O.__super__=R,O.prototype=s(R.prototype,{then:function(t){var e=new O(null);return R.link(this,e,t),this._end_promise._update.push({async:e._end_promise,linkf:function(t){e.end()}}),e},detachStream:function(t){for(var e=[],i=!1,n=0,r=this._update;n<r.length;){var s=r[n];++n,s.async==t?(this._end_promise._update=this._end_promise._update.filter((function(e){return e.async!=t._end_promise})),i=!0):e.push(s)}return this._update=e,i},first:function(){var t=new I(null);return this.then((function(e){t._resolved||t.handleResolve(e)})),t},handleResolve:function(t){this._end||this._pause||this._resolve(t)},pause:function(t){null==t&&(t=!this._pause),this._pause=t},pipe:function(t){var e=new O(null);return R.pipeLink(this,e,t),this._end_promise.then((function(t){e.end()})),e},errorPipe:function(t){var e=new O(null);return this.catchError((function(i){var n=t(i);n.then(ce(e,e._resolve)),n._end_promise.then(ce(oe=e._end_promise,oe._resolve))})),this.then(ce(e,e._resolve)),this._end_promise.then((function(t){e.end()})),e},handleEnd:function(){if(this._pending)U.queue.add(ce(this,this.handleEnd)),U.continueOnNextLoop();else{if(this._end_promise._resolved)return;var t;this._end=!0,t=this._resolved?b.Some(this._val):b.None,this._end_promise.handleResolve(t),this._update=[],this._error=[]}},end:function(){return U.queue.add(ce(this,this.handleEnd)),U.continueOnNextLoop(),this},endThen:function(t){return this._end_promise.then(t)},filter:function(t){var e=new O(null);return this._update.push({async:e,linkf:function(i){t(i)&&e.handleResolve(i)}}),R.immediateLinkUpdate(this,e,(function(t){return t})),e},concat:function(t){var e=new O(null);return this._update.push({async:e,linkf:ce(e,e.handleResolve)}),R.immediateLinkUpdate(this,e,(function(t){return t})),this._end_promise.then((function(i){t.pipe((function(t){return e.handleResolve(t),e})),t._end_promise.then((function(t){e.end()}))})),e},merge:function(t){var e=new O(null);return this._update.push({async:e,linkf:ce(e,e.handleResolve)}),t._update.push({async:e,linkf:ce(e,e.handleResolve)}),R.immediateLinkUpdate(this,e,(function(t){return t})),R.immediateLinkUpdate(t,e,(function(t){return t})),e},__class__:O});var L=e.promhx.PublicStream=function(t){O.call(this,t)};n["promhx.PublicStream"]=L,L.__name__=["promhx","PublicStream"],L.publicstream=function(t){var e=new L(null);return e.handleResolve(t),e},L.__super__=O,L.prototype=s(O.prototype,{resolve:function(t){this.handleResolve(t)},throwError:function(t){this.handleError(t)},update:function(t){this.handleResolve(t)},__class__:L});var U=function(){};n["promhx.base.EventLoop"]=U,U.__name__=["promhx","base","EventLoop"],U.enqueue=function(t){U.queue.add(t),U.continueOnNextLoop()},U.set_nextLoop=function(t){if(null!=U.nextLoop)throw new E("nextLoop has already been set");return U.nextLoop=t,U.nextLoop},U.queueEmpty=function(){return U.queue.isEmpty()},U.finish=function(t){null==t&&(t=1e3);for(var e=null;t-- >0&&null!=(e=U.queue.pop());)e();return U.queue.isEmpty()},U.clear=function(){U.queue=new c},U.f=function(){var t=U.queue.pop();null!=t&&t(),U.queue.isEmpty()||U.continueOnNextLoop()},U.continueOnNextLoop=function(){null!=U.nextLoop?U.nextLoop(U.f):setImmediate(U.f)};var N=n["promhx.error.PromiseError"]={__ename__:["promhx","error","PromiseError"],__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};N.AlreadyResolved=function(t){var e=["AlreadyResolved",0,t];return e.__enum__=N,e.toString=r,e},N.DownstreamNotFullfilled=function(t){var e=["DownstreamNotFullfilled",1,t];return e.__enum__=N,e.toString=r,e};var W=function(){};n["verb.Verb"]=W,W.__name__=["verb","Verb"],W.main=function(){t.log("verb 2.1.0")};var F=function(){};n["verb.core.ArrayExtensions"]=F,F.__name__=["verb","core","ArrayExtensions"],F.alloc=function(t,e){if(!(e<0))for(;t.length<e;)t.push(null)},F.reversed=function(t){var e=t.slice();return e.reverse(),e},F.last=function(t){return t[t.length-1]},F.first=function(t){return t[0]},F.spliceAndInsert=function(t,e,i,n){t.splice(e,i),t.splice(e,0,n)},F.left=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(0,e)},F.right=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e)},F.rightWithPivot=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e-1)},F.unique=function(t,e){if(0==t.length)return[];for(var i=[t.pop()];t.length>0;){for(var n=t.pop(),r=!0,s=0;s<i.length;){var o=i[s];if(++s,e(n,o)){r=!1;break}}r&&i.push(n)}return i};var B=function(){};n["verb.core.Binomial"]=B,B.__name__=["verb","core","Binomial"],B.get=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;if(e>t-e&&(e=t-e),B.memo_exists(t,e))return B.get_memo(t,e);for(var i=1,n=t,r=1,s=e+1;r<s;){var o=r++;B.memo_exists(n,o)?(t--,i=B.get_memo(n,o)):(i*=t--,B.memoize(n,o,i/=o))}return i},B.get_no_memo=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;e>t-e&&(e=t-e);for(var i=1,n=1,r=e+1;n<r;)i*=t--,i/=n++;return i},B.memo_exists=function(t,e){return B.memo.h.hasOwnProperty(t)&&B.memo.h[t].h.hasOwnProperty(e)},B.get_memo=function(t,e){return B.memo.h[t].h[e]},B.memoize=function(t,e,i){B.memo.h.hasOwnProperty(t)||B.memo.set(t,new y),B.memo.h[t].h[e]=i};var z=e.core.BoundingBox=function(t){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=t&&this.addRange(t)};n["verb.core.BoundingBox"]=z,z.__name__=["verb","core","BoundingBox"],z.intervalsOverlap=function(t,e,i,n,r){var s;null==r&&(r=-1),s=r<-.5?V.TOLERANCE:r;var o=Math.min(t,e)-s,a=Math.max(t,e)+s,c=Math.min(i,n)-s,l=Math.max(i,n)+s;return o>=c&&o<=l||a>=c&&a<=l||c>=o&&c<=a||l>=o&&l<=a},z.prototype={fromPoint:function(t){return new z([t])},add:function(t){if(!this.initialized)return this.dim=t.length,this.min=t.slice(0),this.max=t.slice(0),this.initialized=!0,this;for(var e=0,i=this.dim;e<i;){var n=e++;t[n]>this.max[n]&&(this.max[n]=t[n]),t[n]<this.min[n]&&(this.min[n]=t[n])}return this},addRange:function(t){for(var e=t.length,i=0;i<e;){var n=i++;this.add(t[n])}return this},contains:function(t,e){return null==e&&(e=-1),!!this.initialized&&this.intersects(new z([t]),e)},intersects:function(t,e){if(null==e&&(e=-1),!this.initialized||!t.initialized)return!1;for(var i=this.min,n=this.max,r=t.min,s=t.max,o=0,a=this.dim;o<a;){var c=o++;if(!z.intervalsOverlap(i[c],n[c],r[c],s[c],e))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var t=0,e=0,i=0,n=this.dim;i<n;){var r=i++,s=this.getAxisLength(r);s>t&&(t=s,e=r)}return e},getAxisLength:function(t){return t<0||t>this.dim-1?0:Math.abs(this.min[t]-this.max[t])},intersect:function(t,e){if(!this.initialized)return null;var i=this.min,n=this.max,r=t.min,s=t.max;if(!this.intersects(t,e))return null;for(var o=[],a=[],c=0,l=this.dim;c<l;){var h=c++;o.push(Math.min(n[h],s[h])),a.push(Math.max(i[h],r[h]))}return new z([a,o])},__class__:z};var V=e.core.Constants=function(){};n["verb.core.Constants"]=V,V.__name__=["verb","core","Constants"];var H=e.core.SerializableBase=function(){};n["verb.core.SerializableBase"]=H,H.__name__=["verb","core","SerializableBase"],H.prototype={serialize:function(){var t=new v;return t.serialize(this),t.toString()},__class__:H};var G=e.core.Plane=function(t,e){this.origin=t,this.normal=e};n["verb.core.Plane"]=G,G.__name__=["verb","core","Plane"],G.__super__=H,G.prototype=s(H.prototype,{__class__:G});var j=e.core.Ray=function(t,e){this.origin=t,this.dir=e};n["verb.core.Ray"]=j,j.__name__=["verb","core","Ray"],j.__super__=H,j.prototype=s(H.prototype,{__class__:j});var X=e.core.NurbsCurveData=function(t,e,i){this.degree=t,this.controlPoints=i,this.knots=e};n["verb.core.NurbsCurveData"]=X,X.__name__=["verb","core","NurbsCurveData"],X.__super__=H,X.prototype=s(H.prototype,{__class__:X});var q=e.core.NurbsSurfaceData=function(t,e,i,n,r){this.degreeU=t,this.degreeV=e,this.knotsU=i,this.knotsV=n,this.controlPoints=r};n["verb.core.NurbsSurfaceData"]=q,q.__name__=["verb","core","NurbsSurfaceData"],q.__super__=H,q.prototype=s(H.prototype,{__class__:q});var Y=e.core.MeshData=function(t,e,i,n){this.faces=t,this.points=e,this.normals=i,this.uvs=n};n["verb.core.MeshData"]=Y,Y.__name__=["verb","core","MeshData"],Y.empty=function(){return new Y([],[],[],[])},Y.__super__=H,Y.prototype=s(H.prototype,{__class__:Y});var Z=e.core.PolylineData=function(t,e){this.points=t,this.params=e};n["verb.core.PolylineData"]=Z,Z.__name__=["verb","core","PolylineData"],Z.__super__=H,Z.prototype=s(H.prototype,{__class__:Z});var K=e.core.VolumeData=function(t,e,i,n,r,s,o){this.degreeU=t,this.degreeV=e,this.degreeW=i,this.knotsU=n,this.knotsV=r,this.knotsW=s,this.controlPoints=o};n["verb.core.VolumeData"]=K,K.__name__=["verb","core","VolumeData"],K.__super__=H,K.prototype=s(H.prototype,{__class__:K});var J=e.core.Pair=function(t,e){this.item0=t,this.item1=e};n["verb.core.Pair"]=J,J.__name__=["verb","core","Pair"],J.prototype={__class__:J};var $=e.core.Interval=function(t,e){this.min=t,this.max=e};n["verb.core.Interval"]=$,$.__name__=["verb","core","Interval"],$.prototype={__class__:$};var Q=e.core.CurveCurveIntersection=function(t,e,i,n){this.point0=t,this.point1=e,this.u0=i,this.u1=n};n["verb.core.CurveCurveIntersection"]=Q,Q.__name__=["verb","core","CurveCurveIntersection"],Q.prototype={__class__:Q};var tt=e.core.CurveSurfaceIntersection=function(t,e,i,n){this.u=t,this.uv=e,this.curvePoint=i,this.surfacePoint=n};n["verb.core.CurveSurfaceIntersection"]=tt,tt.__name__=["verb","core","CurveSurfaceIntersection"],tt.prototype={__class__:tt};var et=e.core.MeshIntersectionPoint=function(t,e,i,n,r){this.visited=!1,this.adj=null,this.opp=null,this.uv0=t,this.uv1=e,this.point=i,this.faceIndex0,this.faceIndex1};n["verb.core.MeshIntersectionPoint"]=et,et.__name__=["verb","core","MeshIntersectionPoint"],et.prototype={__class__:et};var it=e.core.PolylineMeshIntersection=function(t,e,i,n,r){this.point=t,this.u=e,this.uv=i,this.polylineIndex=n,this.faceIndex=r};n["verb.core.PolylineMeshIntersection"]=it,it.__name__=["verb","core","PolylineMeshIntersection"],it.prototype={__class__:it};var nt=e.core.SurfaceSurfaceIntersectionPoint=function(t,e,i,n){this.uv0=t,this.uv1=e,this.point=i,this.dist=n};n["verb.core.SurfaceSurfaceIntersectionPoint"]=nt,nt.__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],nt.prototype={__class__:nt};var rt=e.core.TriSegmentIntersection=function(t,e,i,n){this.point=t,this.s=e,this.t=i,this.p=n};n["verb.core.TriSegmentIntersection"]=rt,rt.__name__=["verb","core","TriSegmentIntersection"],rt.prototype={__class__:rt};var st=e.core.CurveTriPoint=function(t,e,i){this.u=t,this.point=e,this.uv=i};n["verb.core.CurveTriPoint"]=st,st.__name__=["verb","core","CurveTriPoint"],st.prototype={__class__:st};var ot=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=-1),this.uv=i,this.point=t,this.normal=e,this.id=n,this.degen=r};n["verb.core.SurfacePoint"]=ot,ot.__name__=["verb","core","SurfacePoint"],ot.fromUv=function(t,e){return new ot(null,null,[t,e])},ot.prototype={__class__:ot};var at=e.core.CurvePoint=function(t,e){this.u=t,this.pt=e};n["verb.core.CurvePoint"]=at,at.__name__=["verb","core","CurvePoint"],at.prototype={__class__:at};var ct=e.core.KdTree=function(t,e){this.dim=3,this.points=t,this.distanceFunction=e,this.dim=t[0].point.length,this.root=this.buildTree(t,0,null)};n["verb.core.KdTree"]=ct,ct.__name__=["verb","core","KdTree"],ct.prototype={buildTree:function(t,e,i){var n,r,s=e%this.dim;return 0==t.length?null:1==t.length?new ut(t[0],s,i):(t.sort((function(t,e){var i=t.point[s]-e.point[s];return 0==i?0:i>0?1:-1})),n=Math.floor(t.length/2),(r=new ut(t[n],s,i)).left=this.buildTree(t.slice(0,n),e+1,r),r.right=this.buildTree(t.slice(n+1),e+1,r),r)},nearest:function(t,e,i){var n,r=this,s=new lt((function(t){return-t.item1})),o=null;n=o=function(i){for(var n,a,c,l,h=i.dimension,u=r.distanceFunction(t,i.kdPoint.point),d=[],p=0,f=r.dim;p<f;)p++,d.push(0);a=d;for(var m=function(t,i){s.push(new J(t,i)),s.size()>e&&s.pop()},g=0,v=r.dim;g<v;){var _=g++;_==i.dimension?a[_]=t[_]:a[_]=i.kdPoint.point[_]}c=r.distanceFunction(a,i.kdPoint.point),null!=i.right||null!=i.left?(n=null==i.right?i.left:null==i.left?i.right:t[h]<i.kdPoint.point[h]?i.left:i.right,o(n),(s.size()<e||u<s.peek().item1)&&m(i,u),(s.size()<e||Math.abs(c)<s.peek().item1)&&null!=(l=n==i.left?i.right:i.left)&&o(l)):(s.size()<e||u<s.peek().item1)&&m(i,u)};for(var a=0;a<e;)a++,s.push(new J(null,i));n(this.root);for(var c=[],l=0;l<e;){var h=l++;null!=s.content[h].item0&&c.push(new J(s.content[h].item0.kdPoint,s.content[h].item1))}return c},__class__:ct};var lt=function(t){this.content=[],this.scoreFunction=t};n["verb.core.BinaryHeap"]=lt,lt.__name__=["verb","core","BinaryHeap"],lt.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,i=0;i<e;){var n=i++;if(this.content[n]==t){var r=this.content.pop();return void(n!=e-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}}throw new E("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var i=Math.floor((t+1)/2)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var r=2*(t+1),s=r-1,o=-1,a=0;if(s<e){var c=this.content[s];(a=this.scoreFunction(c))<n&&(o=s)}if(r<e){var l=this.content[r];this.scoreFunction(l)<(-1==o?n:a)&&(o=r)}if(-1==o)break;this.content[t]=this.content[o],this.content[o]=i,t=o}},__class__:lt};var ht=e.core.KdPoint=function(t,e){this.point=t,this.obj=e};n["verb.core.KdPoint"]=ht,ht.__name__=["verb","core","KdPoint"],ht.prototype={__class__:ht};var ut=e.core.KdNode=function(t,e,i){this.kdPoint=t,this.left=null,this.right=null,this.parent=i,this.dimension=e};n["verb.core.KdNode"]=ut,ut.__name__=["verb","core","KdNode"],ut.prototype={__class__:ut};var dt=function(){};n["verb.eval.IBoundingBoxTree"]=dt,dt.__name__=["verb","eval","IBoundingBoxTree"],dt.prototype={__class__:dt};var pt=function(t,e){this._boundingBox=null,this._curve=t,null==e&&(e=Et.domain(this._curve.knots)/64),this._knotTol=e};n["verb.core.LazyCurveBoundingBoxTree"]=pt,pt.__name__=["verb","core","LazyCurveBoundingBoxTree"],pt.__interfaces__=[dt],pt.prototype={split:function(){var t=F.first(this._curve.knots),e=F.last(this._curve.knots),i=e-t,n=Dt.curveSplit(this._curve,(e+t)/2+.1*i*Math.random());return new J(new pt(n[0],this._knotTol),new pt(n[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new z(kt.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(t){return Et.domain(this._curve.knots)<this._knotTol},empty:function(){return!1},__class__:pt};var ft=function(t,e){if(this._boundingBox=null,this._mesh=t,null==e){for(var i=[],n=0,r=t.faces.length;n<r;){var s=n++;i.push(s)}e=i}this._faceIndices=e};n["verb.core.LazyMeshBoundingBoxTree"]=ft,ft.__name__=["verb","core","LazyMeshBoundingBoxTree"],ft.__interfaces__=[dt],ft.prototype={split:function(){var t=yt.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),e=F.left(t),i=F.right(t);return new J(new ft(this._mesh,e),new ft(this._mesh,i))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=yt.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(t){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length},__class__:ft};var mt=function(t,e){this._boundingBox=null,this._polyline=t,null==e&&(e=new $(0,0!=t.points.length?t.points.length-1:0)),this._interval=e};n["verb.core.LazyPolylineBoundingBoxTree"]=mt,mt.__name__=["verb","core","LazyPolylineBoundingBoxTree"],mt.__interfaces__=[dt],mt.prototype={split:function(){var t=this._interval.min,e=this._interval.max,i=t+Math.ceil((e-t)/2),n=new $(t,i),r=new $(i,e);return new J(new mt(this._polyline,n),new mt(this._polyline,r))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new z(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(t){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:mt};var gt=function(t,e,i,n){null==e&&(e=!1),this._boundingBox=null,this._surface=t,this._splitV=e,null==i&&(i=Et.domain(t.knotsU)/16),null==n&&(n=Et.domain(t.knotsV)/16),this._knotTolU=i,this._knotTolV=n};n["verb.core.LazySurfaceBoundingBoxTree"]=gt,gt.__name__=["verb","core","LazySurfaceBoundingBoxTree"],gt.__interfaces__=[dt],gt.prototype={split:function(){var t,e;this._splitV?(t=F.first(this._surface.knotsV),e=F.last(this._surface.knotsV)):(t=F.first(this._surface.knotsU),e=F.last(this._surface.knotsU));var i=(t+e)/2,n=Dt.surfaceSplit(this._surface,i,this._splitV);return new J(new gt(n[0],!this._splitV,this._knotTolU,this._knotTolV),new gt(n[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new z;for(var t=0,e=this._surface.controlPoints;t<e.length;){var i=e[t];++t,this._boundingBox.addRange(kt.dehomogenize1d(i))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(t){return Et.domain(this._surface.knotsV)<this._knotTolV&&Et.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1},__class__:gt};var vt=e.core.Mat=function(){};n["verb.core.Mat"]=vt,vt.__name__=["verb","core","Mat"],vt.mul=function(t,e){for(var i=[],n=0,r=e.length;n<r;){var s=n++;i.push(Et.mul(t,e[s]))}return i},vt.mult=function(t,e){var i,n,r,s,o,a,c,l;i=t.length,n=e.length,r=e[0].length,s=[];for(var h=i-1,u=0,d=0;h>=0;){for(o=[],a=t[h],d=r-1;d>=0;){for(c=a[n-1]*e[n-1][d],u=n-2;u>=1;)l=u-1,c+=a[u]*e[u][d]+a[l]*e[l][d],u-=2;0==u&&(c+=a[0]*e[0][d]),o[d]=c,d--}s[h]=o,h--}return s},vt.add=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(Et.add(t[s],e[s]))}return i},vt.div=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(Et.div(t[s],e))}return i},vt.sub=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(Et.sub(t[s],e[s]))}return i},vt.dot=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(Et.dot(t[s],e))}return i},vt.identity=function(t){for(var e=Et.zeros2d(t,t),i=0;i<t;){var n=i++;e[n][n]=1}return e},vt.transpose=function(t){if(0==t.length)return[];for(var e=[],i=0,n=t[0].length;i<n;){var r=i++;e.push(function(e){for(var i=[],n=0,s=t.length;n<s;){var o=n++;i.push(t[o][r])}return i}())}return e},vt.solve=function(t,e){return vt.LUsolve(vt.LU(t),e)},vt.LUsolve=function(t,e){var i,n,r,s,o,a=t.LU,c=a.length,l=e.slice(),h=t.P;for(i=c-1;-1!=i;)l[i]=e[i],--i;for(i=0;i<c;){for(r=h[i],h[i]!=i&&(o=l[i],l[i]=l[r],l[r]=o),s=a[i],n=0;n<i;)l[i]-=l[n]*s[n],++n;++i}for(i=c-1;i>=0;){for(s=a[i],n=i+1;n<c;)l[i]-=l[n]*s[n],++n;l[i]/=s[i],--i}return l},vt.LU=function(t){Math.abs;for(var e,i,n,r,s,o,a,c,l,h=[],u=0,d=t.length;u<d;){var p=u++;h.push(t[p].slice())}var f=(t=h).length,m=f-1,g=[];for(n=0;n<f;){for(a=n,o=t[n],l=Math.abs(o[n]),i=n+1;i<f;)l<(r=Math.abs(t[i][n]))&&(l=r,a=i),++i;for(g[n]=a,a!=n&&(t[n]=t[a],t[a]=o,o=t[n]),s=o[n],e=n+1;e<f;)t[e][n]/=s,++e;for(e=n+1;e<f;){for(c=t[e],i=n+1;i<m;)c[i]-=c[n]*o[i],c[++i]-=c[n]*o[i],++i;i==m&&(c[i]-=c[n]*o[i]),++e}++n}return new _t(t,g)};var _t=function(t,e){this.LU=t,this.P=e};n["verb.core._Mat.LUDecomp"]=_t,_t.__name__=["verb","core","_Mat","LUDecomp"],_t.prototype={__class__:_t};var yt=e.core.Mesh=function(){};n["verb.core.Mesh"]=yt,yt.__name__=["verb","core","Mesh"],yt.getTriangleNorm=function(t,e){var i=t[e[0]],n=t[e[1]],r=t[e[2]],s=Et.sub(n,i),o=Et.sub(r,i),a=Et.cross(s,o);return Et.mul(1/Et.norm(a),a)},yt.makeMeshAabb=function(t,e){for(var i=new z,n=0;n<e.length;){var r=e[n];++n,i.add(t.points[t.faces[r][0]]),i.add(t.points[t.faces[r][1]]),i.add(t.points[t.faces[r][2]])}return i},yt.sortTrianglesOnLongestAxis=function(t,e,i){for(var n=t.getLongestAxis(),r=[],s=0;s<i.length;){var o=i[s];++s;var a=yt.getMinCoordOnAxis(e.points,e.faces[o],n);r.push(new J(a,o))}r.sort((function(t,e){var i=t.item0,n=e.item0;return i==n?0:i>n?1:-1}));for(var c=[],l=0,h=r.length;l<h;){var u=l++;c.push(r[u].item1)}return c},yt.getMinCoordOnAxis=function(t,e,i){for(var n=1/0,r=0;r<3;){var s=t[e[r++]][i];s<n&&(n=s)}return n},yt.getTriangleCentroid=function(t,e){for(var i=[0,0,0],n=0;n<3;)for(var r=n++,s=0;s<3;){var o=s++;i[o]+=t[e[r]][o]}for(var a=0;a<3;)i[a++]/=3;return i},yt.triangleUVFromPoint=function(t,e,i){var n=t.faces[e],r=t.points[n[0]],s=t.points[n[1]],o=t.points[n[2]],a=t.uvs[n[0]],c=t.uvs[n[1]],l=t.uvs[n[2]],h=Et.sub(r,i),u=Et.sub(s,i),d=Et.sub(o,i),p=Et.norm(Et.cross(Et.sub(r,s),Et.sub(r,o))),f=Et.norm(Et.cross(u,d))/p,m=Et.norm(Et.cross(d,h))/p,g=Et.norm(Et.cross(h,u))/p;return Et.add(Et.mul(f,a),Et.add(Et.mul(m,c),Et.mul(g,l)))};var xt=function(t,e){if(this._empty=!1,this._face=-1,null==e){for(var i=[],n=0,r=t.faces.length;n<r;){var s=n++;i.push(s)}e=i}if(this._boundingBox=yt.makeMeshAabb(t,e),e.length<1)this._empty=!0;else if(e.length<2)this._face=e[0];else{var o=yt.sortTrianglesOnLongestAxis(this._boundingBox,t,e),a=F.left(o),c=F.right(o);this._children=new J(new xt(t,a),new xt(t,c))}};n["verb.core.MeshBoundingBoxTree"]=xt,xt.__name__=["verb","core","MeshBoundingBoxTree"],xt.__interfaces__=[dt],xt.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(t){return null==this._children},empty:function(){return this._empty},__class__:xt};var bt=e.core.Minimizer=function(){};n["verb.core.Minimizer"]=bt,bt.__name__=["verb","core","Minimizer"],bt.uncmin=function(t,e,i,n,r){null==i&&(i=1e-8),null==n&&(n=function(e){return bt.numericalGradient(t,e)}),null==r&&(r=1e3);var s,o,a,c,l=(e=e.slice(0)).length,h=t(e),u=h;if(isNaN(h))throw new E("uncmin: f(x0) is a NaN!");i=Math.max(i,V.EPSILON);var d,p,f,m,g,v,_=vt.identity(l),y=0,x=[],b="";for(a=n(e);y<r;){if(!Et.all(Et.finite(a))){b="Gradient has Infinity or NaN";break}if(o=Et.neg(vt.dot(_,a)),!Et.all(Et.finite(o))){b="Search direction has Infinity or NaN";break}if((v=Et.norm(o))<i){b="Newton step smaller than tol";break}for(g=1,s=Et.dot(a,o),d=e;y<r&&!(g*v<i)&&(x=Et.mul(g,o),d=Et.add(e,x),(u=t(d))-h>=.1*g*s||isNaN(u));)g*=.5,++y;if(g*v<i){b="Line search step size smaller than tol";break}if(y==r){b="maxit reached during line search";break}c=n(d),p=Et.sub(c,a),m=Et.dot(p,x),f=vt.dot(_,p),_=vt.sub(vt.add(_,vt.mul((m+Et.dot(p,f))/(m*m),bt.tensor(x,x))),vt.div(vt.add(bt.tensor(f,x),bt.tensor(x,f)),m)),e=d,h=u,a=c,++y}return new Mt(e,h,a,_,y,b)},bt.numericalGradient=function(t,e){var i=e.length,n=t(e);if(NaN==n)throw new E("gradient: f(x) is a NaN!");for(var r,s,o,a,c,l,h,u,d=e.slice(0),p=[],f=0,m=0;m<i;)for(var g=m++,v=Math.max(1e-6*n,1e-8);;){if(++f>20)throw new E("Numerical gradient fails");if(d[g]=e[g]+v,r=t(d),d[g]=e[g]-v,s=t(d),d[g]=e[g],isNaN(r)||isNaN(s))v/=16;else{if(p[g]=(r-s)/(2*v),o=e[g]-v,a=e[g],c=e[g]+v,l=(r-n)/v,h=(n-s)/v,u=Et.max([Math.abs(p[g]),Math.abs(n),Math.abs(r),Math.abs(s),Math.abs(o),Math.abs(a),Math.abs(c),1e-8]),!(Math.min(Et.max([Math.abs(l-p[g]),Math.abs(h-p[g]),Math.abs(l-h)])/u,v/u)>.001))break;v/=16}}return p},bt.tensor=function(t,e){for(var i,n,r=t.length,s=e.length,o=[],a=r-1;a>=0;){i=[],n=t[a];for(var c=s-1;c>=3;)i[c]=n*e[c],i[--c]=n*e[c],i[--c]=n*e[c],i[--c]=n*e[c],--c;for(;c>=0;)i[c]=n*e[c],--c;o[a]=i,a--}return o};var Mt=function(t,e,i,n,r,s){this.solution=t,this.value=e,this.gradient=i,this.invHessian=n,this.iterations=r,this.message=s};n["verb.core.MinimizationResult"]=Mt,Mt.__name__=["verb","core","MinimizationResult"],Mt.prototype={__class__:Mt};var St=function(){};n["verb.core.ISerializable"]=St,St.__name__=["verb","core","ISerializable"],St.prototype={__class__:St};var wt=e.core.Deserializer=function(){};n["verb.core.Deserializer"]=wt,wt.__name__=["verb","core","Deserializer"],wt.deserialize=function(t){return new _(t).unserialize()};var Tt=e.core.Trig=function(){};n["verb.core.Trig"]=Tt,Tt.__name__=["verb","core","Trig"],Tt.isPointInPlane=function(t,e,i){return Math.abs(Et.dot(Et.sub(t,e.origin),e.normal))<i},Tt.distToSegment=function(t,e,i){var n=Tt.segmentClosestPoint(e,t,i,0,1);return Et.dist(e,n.pt)},Tt.rayClosestPoint=function(t,e,i){var n=Et.sub(t,e),r=Et.dot(n,i);return Et.add(e,Et.mul(r,i))},Tt.distToRay=function(t,e,i){var n=Tt.rayClosestPoint(t,e,i),r=Et.sub(n,t);return Et.norm(r)},Tt.threePointsAreFlat=function(t,e,i,n){var r=Et.sub(e,t),s=Et.sub(i,t),o=Et.cross(r,s);return Et.dot(o,o)<n},Tt.segmentClosestPoint=function(t,e,i,n,r){var s=Et.sub(i,e),o=Et.norm(s);if(o<V.EPSILON)return{u:n,pt:e};var a=e,c=Et.mul(1/o,s),l=Et.sub(t,a),h=Et.dot(l,c);return h<0?{u:n,pt:e}:h>o?{u:r,pt:i}:{u:n+(r-n)*h/o,pt:Et.add(a,Et.mul(h,c))}};var Et=e.core.Vec=function(){};n["verb.core.Vec"]=Et,Et.__name__=["verb","core","Vec"],Et.angleBetween=function(t,e){return Math.acos(Et.dot(t,e)/(Et.norm(t)*Et.norm(e)))},Et.positiveAngleBetween=function(t,e,i){var n=Et.cross(t,e),r=Et.norm(t)*Et.norm(e),s=Et.dot(t,e),o=Et.norm(n)/r,a=s/r,c=Math.atan2(o,a),l=Et.dot(i,n);return Math.abs(l)<V.EPSILON||l>0?c:-c},Et.signedAngleBetween=function(t,e,i){var n=Et.cross(t,e),r=Et.norm(t)*Et.norm(e),s=Et.dot(t,e),o=Et.norm(n)/r,a=s/r,c=Math.atan2(o,a);return Et.dot(i,n)>0?c:2*Math.PI-c},Et.angleBetweenNormalized2d=function(t,e){var i=t[0]*e[1]-t[1]*e[0];return Math.atan2(i,Et.dot(t,e))},Et.domain=function(t){return F.last(t)-F.first(t)},Et.range=function(t){for(var e=[],i=0,n=0;n<t;)n++,e.push(i),i+=1;return e},Et.span=function(t,e,i){if(null==i)return[];if(i<V.EPSILON)return[];if(t>e&&i>0)return[];if(e>t&&i<0)return[];for(var n=[],r=t;r<=e;)n.push(r),r+=i;return n},Et.neg=function(t){return t.map((function(t){return-t}))},Et.min=function(t){return a.fold(t,(function(t,e){return Math.min(t,e)}),1/0)},Et.max=function(t){return a.fold(t,(function(t,e){return Math.max(t,e)}),-1/0)},Et.all=function(t){return a.fold(t,(function(t,e){return e&&t}),!0)},Et.finite=function(t){return t.map((function(t){return isFinite(t)}))},Et.onRay=function(t,e,i){return Et.add(t,Et.mul(i,e))},Et.lerp=function(t,e,i){return Et.add(Et.mul(t,e),Et.mul(1-t,i))},Et.normalized=function(t){return Et.div(t,Et.norm(t))},Et.cross=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},Et.dist=function(t,e){return Et.norm(Et.sub(t,e))},Et.distSquared=function(t,e){return Et.normSquared(Et.sub(t,e))},Et.sum=function(t){return a.fold(t,(function(t,e){return e+t}),0)},Et.addAll=function(t){var e=se(t)();if(!e.hasNext())return null;var i=e.next().length;return a.fold(t,(function(t,e){return Et.add(e,t)}),Et.rep(i,0))},Et.addAllMutate=function(t){for(var e=t[0],i=1,n=t.length;i<n;){var r=i++;Et.addMutate(e,t[r])}},Et.addMulMutate=function(t,e,i){for(var n=0,r=t.length;n<r;){var s=n++;t[s]=t[s]+e*i[s]}},Et.subMulMutate=function(t,e,i){for(var n=0,r=t.length;n<r;){var s=n++;t[s]=t[s]-e*i[s]}},Et.addMutate=function(t,e){for(var i=0,n=t.length;i<n;){var r=i++;t[r]=t[r]+e[r]}},Et.subMutate=function(t,e){for(var i=0,n=t.length;i<n;){var r=i++;t[r]=t[r]-e[r]}},Et.mulMutate=function(t,e){for(var i=0,n=e.length;i<n;){var r=i++;e[r]=e[r]*t}},Et.norm=function(t){var e=Et.normSquared(t);return 0!=e?Math.sqrt(e):e},Et.normSquared=function(t){return a.fold(t,(function(t,e){return e+t*t}),0)},Et.rep=function(t,e){for(var i=[],n=0;n<t;)n++,i.push(e);return i},Et.zeros1d=function(t){for(var e=[],i=0;i<t;)i++,e.push(0);return e},Et.zeros2d=function(t,e){for(var i=[],n=0;n<t;)n++,i.push(Et.zeros1d(e));return i},Et.zeros3d=function(t,e,i){for(var n=[],r=0;r<t;)r++,n.push(Et.zeros2d(e,i));return n},Et.dot=function(t,e){for(var i=0,n=0,r=t.length;n<r;){var s=n++;i+=t[s]*e[s]}return i},Et.add=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(t[s]+e[s])}return i},Et.mul=function(t,e){for(var i=[],n=0,r=e.length;n<r;){var s=n++;i.push(t*e[s])}return i},Et.div=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(t[s]/e)}return i},Et.sub=function(t,e){for(var i=[],n=0,r=t.length;n<r;){var s=n++;i.push(t[s]-e[s])}return i},Et.isZero=function(t){for(var e=0,i=t.length;e<i;){var n=e++;if(Math.abs(t[n])>V.TOLERANCE)return!1}return!0},Et.sortedSetUnion=function(t,e){for(var i=[],n=0,r=0;n<t.length||r<e.length;)if(n>=t.length)i.push(e[r]),r++;else if(r>=e.length)i.push(t[n]),n++;else{var s=t[n]-e[r];Math.abs(s)<V.EPSILON?(i.push(t[n]),n++,r++):s>0?(i.push(e[r]),r++):(i.push(t[n]),n++)}return i},Et.sortedSetSub=function(t,e){for(var i=[],n=0,r=0;n<t.length;)r>=e.length?(i.push(t[n]),n++):Math.abs(t[n]-e[r])<V.EPSILON?(n++,r++):(i.push(t[n]),n++);return i};var Ct=e.eval.Analyze=function(){};n["verb.eval.Analyze"]=Ct,Ct.__name__=["verb","eval","Analyze"],Ct.knotMultiplicities=function(t){for(var e=[new Pt(t[0],0)],i=e[0],n=0;n<t.length;){var r=t[n];++n,Math.abs(r-i.knot)>V.EPSILON&&(i=new Pt(r,0),e.push(i)),i.inc()}return e},Ct.isRationalSurfaceClosed=function(t,e){var i;null==e&&(e=!0);for(var n=0,r=(i=e?t.controlPoints:vt.transpose(t.controlPoints))[0].length;n<r;){var s=n++;if(!(Et.dist(F.first(i)[s],F.last(i)[s])<V.EPSILON))return!1}return!0},Ct.rationalSurfaceClosestPoint=function(t,e){var i=Ct.rationalSurfaceClosestParam(t,e);return kt.rationalSurfacePoint(t,i[0],i[1])},Ct.rationalSurfaceClosestParam=function(t,e){for(var i,n,r,s=0,o=1e-4,a=5e-4,c=t.knotsU[0],l=F.last(t.knotsU),h=t.knotsV[0],u=F.last(t.knotsV),d=Ct.isRationalSurfaceClosed(t),p=Ct.isRationalSurfaceClosed(t,!1),f=Ut.rationalSurfaceAdaptive(t,new Nt),m=1/0,g=0,v=f.points.length;g<v;){var _=g++,y=f.points[_],x=Et.normSquared(Et.sub(e,y));x<m&&(m=x,r=f.uvs[_])}for(;s<5;){B=r,i=kt.rationalSurfaceDerivatives(t,B[0],B[1],2),n=Et.sub(i[0][0],e);var b=Et.norm(n),M=Et.dot(i[1][0],n),S=Et.norm(i[1][0])*b,w=Et.dot(i[0][1],n),T=Et.norm(i[0][1])*b;if(b<o&&M/S<a&&w/T<a)return r;var E=(C=r,A=n,D=void 0,R=void 0,k=void 0,I=void 0,O=void 0,L=void 0,U=void 0,N=void 0,W=void 0,D=(P=i)[1][0],R=P[0][1],k=P[2][0],I=P[0][2],O=P[1][1],L=P[1][1],U=[-Et.dot(D,A),-Et.dot(R,A)],N=[[Et.dot(D,D)+Et.dot(k,A),Et.dot(D,R)+Et.dot(O,A)],[Et.dot(D,R)+Et.dot(L,A),Et.dot(R,R)+Et.dot(I,A)]],W=vt.solve(N,U),Et.add(W,C));if(E[0]<c?E=d?[l-(E[0]-c),E[1]]:[c+V.EPSILON,E[1]]:E[0]>l&&(E=d?[c+(E[0]-l),E[1]]:[l-V.EPSILON,E[1]]),E[1]<h?E=p?[E[0],u-(E[1]-h)]:[E[0],h+V.EPSILON]:E[1]>u&&(E=p?[E[0],h+(E[0]-u)]:[E[0],u-V.EPSILON]),Et.norm(Et.mul(E[0]-r[0],i[1][0]))+Et.norm(Et.mul(E[1]-r[1],i[0][1]))<o)return r;r=E,s++}var C,P,A,D,R,k,I,O,L,U,N,W,B;return r},Ct.rationalCurveClosestPoint=function(t,e){return kt.rationalCurvePoint(t,Ct.rationalCurveClosestParam(t,e))},Ct.rationalCurveClosestParam=function(t,e){for(var i=1/0,n=0,r=Ut.rationalCurveRegularSample(t,t.controlPoints.length*t.degree,!0),s=0,o=r.length-1;s<o;){var a=s++,c=r[a][0],l=r[a+1][0],h=r[a].slice(1),u=r[a+1].slice(1),d=Tt.segmentClosestPoint(e,h,u,c,l),p=Et.norm(Et.sub(e,d.pt));p<i&&(i=p,n=d.u)}for(var f,m,g=0,v=1e-4,_=t.knots[0],y=F.last(t.knots),x=Et.normSquared(Et.sub(t.controlPoints[0],F.last(t.controlPoints)))<V.EPSILON,b=n;g<5;){A=b,f=kt.rationalCurveDerivatives(t,A,2),m=Et.sub(f[0],e);var M=Et.norm(m),S=Et.dot(f[1],m)/(Et.norm(f[1])*M),w=M<v,T=Math.abs(S)<5e-4;if(w&&T)return b;var E=(C=f,P=m,b-Et.dot(C[1],P)/(Et.dot(C[2],P)+Et.dot(C[1],C[1])));if(E<_?E=x?y-(E-_):_:E>y&&(E=x?_+(E-y):y),Et.norm(Et.mul(E-b,f[1]))<v)return b;b=E,g++}var C,P,A;return b},Ct.rationalCurveParamAtArcLength=function(t,e,i,n,r){if(null==i&&(i=.001),e<V.EPSILON)return t.knots[0];var s,o,a=0,c=((s=null!=n?n:Lt.decomposeCurveIntoBeziers(t))[a],-V.EPSILON);for(o=null!=r?r:[];c<e&&a<s.length;){if(a<o.length?o[a]=o[a]:o[a]=Ct.rationalBezierCurveArcLength(t),e<(c+=o[a])+V.EPSILON)return Ct.rationalBezierCurveParamAtArcLength(t,e,i,o[a]);a++}return-1},Ct.rationalBezierCurveParamAtArcLength=function(t,e,i,n){if(e<0)return t.knots[0];var r;if(e>(r=null!=n?n:Ct.rationalBezierCurveArcLength(t)))return F.last(t.knots);var s,o=t.knots[0],a=0,c=F.last(t.knots),l=r,h=0,u=0;for(s=null!=i?i:2*V.TOLERANCE;l-a>s;)h=(o+c)/2,(u=Ct.rationalBezierCurveArcLength(t,h))>e?(c=h,l=u):(o=h,a=u);return(o+c)/2},Ct.rationalCurveArcLength=function(t,e,i){null==i&&(i=16),null==e&&(e=F.last(t.knots));for(var n=Lt.decomposeCurveIntoBeziers(t),r=0,s=n[0],o=0;r<n.length&&s.knots[0]+V.EPSILON<e;){var a=Math.min(F.last(s.knots),e);o+=Ct.rationalBezierCurveArcLength(s,a,i),s=n[++r]}return o},Ct.rationalBezierCurveArcLength=function(t,e,i){null==i&&(i=16);for(var n,r,s=((null==e?F.last(t.knots):e)-t.knots[0])/2,o=0,a=t.degree+i,c=0;c<a;){var l=c++;n=s*Ct.Tvalues[a][l]+s+t.knots[0],r=kt.rationalCurveDerivatives(t,n,1),o+=Ct.Cvalues[a][l]*Et.norm(r[1])}return s*o};var Pt=e.eval.KnotMultiplicity=function(t,e){this.knot=t,this.mult=e};n["verb.eval.KnotMultiplicity"]=Pt,Pt.__name__=["verb","eval","KnotMultiplicity"],Pt.prototype={inc:function(){this.mult++},__class__:Pt};var At=e.eval.Check=function(){};n["verb.eval.Check"]=At,At.__name__=["verb","eval","Check"],At.isValidKnotVector=function(t,e){if(0==t.length)return!1;if(t.length<2*(e+1))return!1;for(var i=F.first(t),n=0,r=e+1;n<r;){var s=n++;if(Math.abs(t[s]-i)>V.EPSILON)return!1}i=F.last(t);for(var o=t.length-e-1,a=t.length;o<a;){var c=o++;if(Math.abs(t[c]-i)>V.EPSILON)return!1}return At.isNonDecreasing(t)},At.isNonDecreasing=function(t){for(var e=F.first(t),i=0,n=t.length;i<n;){var r=i++;if(t[r]<e-V.EPSILON)return!1;e=t[r]}return!0},At.isValidNurbsCurveData=function(t){if(null==t.controlPoints)throw new E("Control points array cannot be null!");if(null==t.degree)throw new E("Degree cannot be null!");if(t.degree<1)throw new E("Degree must be greater than 1!");if(null==t.knots)throw new E("Knots cannot be null!");if(t.knots.length!=t.controlPoints.length+t.degree+1)throw new E("controlPoints.length + degree + 1 must equal knots.length!");if(!At.isValidKnotVector(t.knots,t.degree))throw new E("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t},At.isValidNurbsSurfaceData=function(t){if(null==t.controlPoints)throw new E("Control points array cannot be null!");if(null==t.degreeU)throw new E("DegreeU cannot be null!");if(null==t.degreeV)throw new E("DegreeV cannot be null!");if(t.degreeU<1)throw new E("DegreeU must be greater than 1!");if(t.degreeV<1)throw new E("DegreeV must be greater than 1!");if(null==t.knotsU)throw new E("KnotsU cannot be null!");if(null==t.knotsV)throw new E("KnotsV cannot be null!");if(t.knotsU.length!=t.controlPoints.length+t.degreeU+1)throw new E("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(t.knotsV.length!=t.controlPoints[0].length+t.degreeV+1)throw new E("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!At.isValidKnotVector(t.knotsU,t.degreeU)||!At.isValidKnotVector(t.knotsV,t.degreeV))throw new E("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t};var Dt=e.eval.Divide=function(){};n["verb.eval.Divide"]=Dt,Dt.__name__=["verb","eval","Divide"],Dt.surfaceSplit=function(t,e,i){var n,r,s,o;null==i&&(i=!1),i?(s=t.controlPoints,n=t.knotsV,r=t.degreeV):(s=vt.transpose(t.controlPoints),n=t.knotsU,r=t.degreeU);for(var a=[],c=0,l=r+1;c<l;)c++,a.push(e);o=a;for(var h=[],u=[],d=kt.knotSpan(r,e,n),p=null,f=0;f<s.length;){var m=s[f];++f,p=Lt.curveKnotRefine(new X(r,n,m),o),h.push(p.controlPoints.slice(0,d+1)),u.push(p.controlPoints.slice(d+1))}var g=p.knots.slice(0,d+r+2),v=p.knots.slice(d+1);return i?[new q(t.degreeU,r,t.knotsU.slice(),g,h),new q(t.degreeU,r,t.knotsU.slice(),v,u)]:(h=vt.transpose(h),u=vt.transpose(u),[new q(r,t.degreeV,g,t.knotsV.slice(),h),new q(r,t.degreeV,v,t.knotsV.slice(),u)])},Dt.curveSplit=function(t,e){for(var i,n=t.degree,r=(t.controlPoints,t.knots),s=[],o=0,a=n+1;o<a;)o++,s.push(e);i=s;var c=Lt.curveKnotRefine(t,i),l=kt.knotSpan(n,e,r),h=c.knots.slice(0,l+n+2),u=c.knots.slice(l+1),d=c.controlPoints.slice(0,l+1),p=c.controlPoints.slice(l+1);return[new X(n,h,d),new X(n,u,p)]},Dt.rationalCurveByEqualArcLength=function(t,e){var i=Ct.rationalCurveArcLength(t)/e;return Dt.rationalCurveByArcLength(t,i)},Dt.rationalCurveByArcLength=function(t,e){var i=Lt.decomposeCurveIntoBeziers(t),n=i.map((function(t){return Ct.rationalBezierCurveArcLength(t)})),r=Et.sum(n),s=[new Rt(t.knots[0],0)];if(e>r)return s;for(var o,a=e,c=0,l=a,h=0,u=0;c<i.length;){for(h+=n[c];l<h+V.EPSILON;)o=Ct.rationalBezierCurveParamAtArcLength(i[c],l-u,V.TOLERANCE,n[c]),s.push(new Rt(o,l)),l+=a;u+=n[c],c++}return s};var Rt=e.eval.CurveLengthSample=function(t,e){this.u=t,this.len=e};n["verb.eval.CurveLengthSample"]=Rt,Rt.__name__=["verb","eval","CurveLengthSample"],Rt.prototype={__class__:Rt};var kt=e.eval.Eval=function(){};n["verb.eval.Eval"]=kt,kt.__name__=["verb","eval","Eval"],kt.rationalCurveTangent=function(t,e){return kt.rationalCurveDerivatives(t,e,1)[1]},kt.rationalSurfaceNormal=function(t,e,i){var n=kt.rationalSurfaceDerivatives(t,e,i,1);return Et.cross(n[1][0],n[0][1])},kt.rationalSurfaceDerivatives=function(t,e,i,n){null==n&&(n=1);for(var r=kt.surfaceDerivatives(t,e,i,n),s=kt.rational2d(r),o=kt.weight2d(r),a=[],c=s[0][0].length,l=0,h=n+1;l<h;){var u=l++;a.push([]);for(var d=0,p=n-u+1;d<p;){for(var f=d++,m=s[u][f],g=1,v=f+1;g<v;){var _=g++;Et.subMulMutate(m,B.get(f,_)*o[0][_],a[u][f-_])}for(var y=1,x=u+1;y<x;){var b=y++;Et.subMulMutate(m,B.get(u,b)*o[b][0],a[u-b][f]);for(var M=Et.zeros1d(c),S=1,w=f+1;S<w;){var T=S++;Et.addMulMutate(M,B.get(f,T)*o[b][T],a[u-b][f-T])}Et.subMulMutate(m,B.get(u,b),M)}Et.mulMutate(1/o[0][0],m),a[u].push(m)}}return a},kt.rationalSurfacePoint=function(t,e,i){return kt.dehomogenize(kt.surfacePoint(t,e,i))},kt.rationalCurveDerivatives=function(t,e,i){null==i&&(i=1);for(var n=kt.curveDerivatives(t,e,i),r=kt.rational1d(n),s=kt.weight1d(n),o=[],a=0,c=i+1;a<c;){for(var l=a++,h=r[l],u=1,d=l+1;u<d;){var p=u++;Et.subMulMutate(h,B.get(l,p)*s[p],o[l-p])}Et.mulMutate(1/s[0],h),o.push(h)}return o},kt.rationalCurvePoint=function(t,e){return kt.dehomogenize(kt.curvePoint(t,e))},kt.surfaceDerivatives=function(t,e,i,n){var r=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2;return kt.surfaceDerivativesGivenNM(r,s,t,e,i,n)},kt.surfaceDerivativesGivenNM=function(t,e,i,n,r,s){var o=i.degreeU,a=i.degreeV,c=i.controlPoints,l=i.knotsU,h=i.knotsV;if(!kt.areValidRelations(o,c.length,l.length)||!kt.areValidRelations(a,c[0].length,h.length))throw new E("Invalid relations between control points, knot vector, and n");var u,d,p=c[0][0].length;u=s<o?s:o,d=s<a?s:a;for(var f=Et.zeros3d(s+1,s+1,p),m=kt.knotSpanGivenN(t,o,n,l),g=kt.knotSpanGivenN(e,a,r,h),v=kt.derivativeBasisFunctionsGivenNI(m,n,o,t,l),_=kt.derivativeBasisFunctionsGivenNI(g,r,a,e,h),y=Et.zeros2d(a+1,p),x=0,b=u+1;x<b;){for(var M=x++,S=0,w=a+1;S<w;){var T=S++;y[T]=Et.zeros1d(p);for(var C=0,P=o+1;C<P;){var A=C++;Et.addMulMutate(y[T],v[M][A],c[m-o+A][g-a+T])}}for(var D=s-M,R=0,k=(D<d?D:d)+1;R<k;){var I=R++;f[M][I]=Et.zeros1d(p);for(var O=0,L=a+1;O<L;){var U=O++;Et.addMulMutate(f[M][I],_[I][U],y[U])}}}return f},kt.surfacePoint=function(t,e,i){var n=t.knotsU.length-t.degreeU-2,r=t.knotsV.length-t.degreeV-2;return kt.surfacePointGivenNM(n,r,t,e,i)},kt.surfacePointGivenNM=function(t,e,i,n,r){var s=i.degreeU,o=i.degreeV,a=i.controlPoints,c=i.knotsU,l=i.knotsV;if(!kt.areValidRelations(s,a.length,c.length)||!kt.areValidRelations(o,a[0].length,l.length))throw new E("Invalid relations between control points, knot vector, and n");for(var h=a[0][0].length,u=kt.knotSpanGivenN(t,s,n,c),d=kt.knotSpanGivenN(e,o,r,l),p=kt.basisFunctionsGivenKnotSpanIndex(u,n,s,c),f=kt.basisFunctionsGivenKnotSpanIndex(d,r,o,l),m=u-s,g=d,v=Et.zeros1d(h),_=Et.zeros1d(h),y=0,x=o+1;y<x;){var b=y++;_=Et.zeros1d(h),g=d-o+b;for(var M=0,S=s+1;M<S;){var w=M++;Et.addMulMutate(_,p[w],a[m+w][g])}Et.addMulMutate(v,f[b],_)}return v},kt.curveRegularSamplePoints=function(t,e){for(var i=kt.curveDerivatives(t,t.knots[0],t.degree),n=1/e,r=n*n,s=i[0],o=Et.mul(n,i[1]),a=Et.mul(.5*r,i[2]),c=Et.mul(r*n*.5,i[3]),l=Et.add(a,a),h=Et.add(c,c),u=Et.mul(.3333333333333333,c),d=[],p=0,f=e+1;p<f;)p++,d.push(kt.dehomogenize(s)),Et.addAllMutate([s,o,a,u]),Et.addAllMutate([o,l,c]),Et.addAllMutate([l,h]),Et.addAllMutate([a,c]);return d},kt.curveRegularSamplePoints2=function(t,e){for(var i=kt.curveDerivatives(t,t.knots[0],t.degree),n=1/e,r=n*n,s=i[0],o=Et.mul(n,i[1]),a=Et.mul(.5*r,i[2]),c=Et.mul(r*n*.5,i[3]),l=Et.add(a,a),h=Et.add(c,c),u=Et.mul(.3333333333333333,c),d=[],p=0,f=e+1;p<f;)p++,d.push(kt.dehomogenize(s)),Et.addAllMutate([s,o,a,u]),Et.addAllMutate([o,l,c]),Et.addAllMutate([l,h]),Et.addAllMutate([a,c]);return d},kt.rationalSurfaceRegularSampleDerivatives=function(t,e,i,n){for(var r=kt.surfaceRegularSampleDerivatives(t,e,i,n),s=[],o=e+1,a=i+1,c=n+1,l=0;l<o;){var h=l++,u=[];s.push(u);for(var d=0;d<a;){for(var p=d++,f=r[h][p],m=kt.rational2d(f),g=kt.weight2d(f),v=[],_=m[0][0].length,y=0;y<c;){var x=y++;v.push([]);for(var b=0,M=c-x;b<M;){for(var S=b++,w=m[x][S],T=1,E=S+1;T<E;){var C=T++;Et.subMulMutate(w,B.get(S,C)*g[0][C],v[x][S-C])}for(var P=1,A=x+1;P<A;){var D=P++;Et.subMulMutate(w,B.get(x,D)*g[D][0],v[x-D][S]);for(var R=Et.zeros1d(_),k=1,I=S+1;k<I;){var O=k++;Et.addMulMutate(R,B.get(S,O)*g[D][O],v[x-D][S-O])}Et.subMulMutate(w,B.get(x,D),R)}Et.mulMutate(1/g[0][0],w),v[x].push(w)}}u.push(v)}}return s},kt.surfaceRegularSampleDerivatives=function(t,e,i,n){for(var r=t.degreeU,s=t.degreeV,o=t.controlPoints,a=t.knotsU,c=t.knotsV,l=o[0][0].length,h=(F.last(a),a[0],F.last(c),c[0],kt.regularlySpacedDerivativeBasisFunctions(r,a,e)),u=h.item0,d=h.item1,p=kt.regularlySpacedDerivativeBasisFunctions(s,c,i),f=p.item0,m=p.item1,g=[],v=e+1,_=i+1,y=0;y<v;){var x=y++,b=[];g.push(b);for(var M=0;M<_;){var S=M++;b.push(kt.surfaceDerivativesGivenBasesKnotSpans(r,s,o,u[x],f[S],d[x],m[S],l,n))}}return g},kt.rationalSurfaceRegularSamplePoints=function(t,e,i){return kt.dehomogenize2d(kt.surfaceRegularSamplePoints(t,e,i))},kt.surfaceRegularSamplePoints=function(t,e,i){for(var n=t.degreeU,r=t.degreeV,s=t.controlPoints,o=t.knotsU,a=t.knotsV,c=s[0][0].length,l=(F.last(o),o[0],F.last(a),a[0],kt.regularlySpacedBasisFunctions(n,o,e)),h=l.item0,u=l.item1,d=kt.regularlySpacedBasisFunctions(r,a,i),p=d.item0,f=d.item1,m=[],g=e+1,v=i+1,_=0;_<g;){var y=_++,x=[];m.push(x);for(var b=0;b<v;){var M=b++;x.push(kt.surfacePointGivenBasesKnotSpans(n,r,s,h[y],p[M],u[y],f[M],c))}}return m},kt.regularlySpacedBasisFunctions=function(t,e,i){for(var n=e.length-t-2,r=(F.last(e)-e[0])/i,s=[],o=[],a=e[0],c=kt.knotSpanGivenN(n,t,a,e),l=i+1,h=0;h<l;){for(h++;a>=e[c+1];)c++;o.push(c),s.push(kt.basisFunctionsGivenKnotSpanIndex(c,a,t,e)),a+=r}return new J(o,s)},kt.regularlySpacedDerivativeBasisFunctions=function(t,e,i){for(var n=e.length-t-2,r=(F.last(e)-e[0])/i,s=[],o=[],a=e[0],c=kt.knotSpanGivenN(n,t,a,e),l=i+1,h=0;h<l;){for(h++;a>=e[c+1];)c++;o.push(c),s.push(kt.derivativeBasisFunctionsGivenNI(c,a,t,n,e)),a+=r}return new J(o,s)},kt.surfacePointGivenBasesKnotSpans=function(t,e,i,n,r,s,o,a){for(var c,l=Et.zeros1d(a),h=n-t,u=r-e,d=0,p=e+1;d<p;){var f=d++;c=Et.zeros1d(a);for(var m=0,g=t+1;m<g;){var v=m++;Et.addMulMutate(c,s[v],i[h+v][u])}u++,Et.addMulMutate(l,o[f],c)}return l},kt.surfaceDerivativesGivenBasesKnotSpans=function(t,e,i,n,r,s,o,a,c){var l,h,u=i[0][0].length;l=c<t?c:t,h=c<e?c:e;for(var d=Et.zeros3d(l+1,h+1,u),p=Et.zeros2d(e+1,u),f=0,m=l+1;f<m;){for(var g=f++,v=0,_=e+1;v<_;){var y=v++;p[y]=Et.zeros1d(u);for(var x=0,b=t+1;x<b;){var M=x++;Et.addMulMutate(p[y],s[g][M],i[n-t+M][r-e+y])}}for(var S=c-g,w=0,T=(S<h?S:h)+1;w<T;){var E=w++;d[g][E]=Et.zeros1d(u);for(var C=0,P=e+1;C<P;){var A=C++;Et.addMulMutate(d[g][E],o[E][A],p[A])}}}return d},kt.curveDerivatives=function(t,e,i){var n=t.knots.length-t.degree-2;return kt.curveDerivativesGivenN(n,t,e,i)},kt.curveDerivativesGivenN=function(t,e,i,n){var r=e.degree,s=e.controlPoints,o=e.knots;if(!kt.areValidRelations(r,s.length,o.length))throw new E("Invalid relations between control points, knot vector, and n");var a,c=s[0].length;a=n<r?n:r;for(var l=Et.zeros2d(n+1,c),h=kt.knotSpanGivenN(t,r,i,o),u=kt.derivativeBasisFunctionsGivenNI(h,i,r,a,o),d=0,p=a+1;d<p;)for(var f=d++,m=0,g=r+1;m<g;){var v=m++;Et.addMulMutate(l[f],u[f][v],s[h-r+v])}return l},kt.curvePoint=function(t,e){var i=t.knots.length-t.degree-2;return kt.curvePointGivenN(i,t,e)},kt.areValidRelations=function(t,e,i){return e+t+1-i==0},kt.curvePointGivenN=function(t,e,i){var n=e.degree,r=e.controlPoints,s=e.knots;if(!kt.areValidRelations(n,r.length,s.length))throw new E("Invalid relations between control points, knot Array, and n");for(var o=kt.knotSpanGivenN(t,n,i,s),a=kt.basisFunctionsGivenKnotSpanIndex(o,i,n,s),c=Et.zeros1d(r[0].length),l=0,h=n+1;l<h;){var u=l++;Et.addMulMutate(c,a[u],r[o-n+u])}return c},kt.volumePoint=function(t,e,i,n){var r=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2,o=t.knotsW.length-t.degreeW-2;return kt.volumePointGivenNML(t,r,s,o,e,i,n)},kt.volumePointGivenNML=function(t,e,i,n,r,s,o){if(!kt.areValidRelations(t.degreeU,t.controlPoints.length,t.knotsU.length)||!kt.areValidRelations(t.degreeV,t.controlPoints[0].length,t.knotsV.length)||!kt.areValidRelations(t.degreeW,t.controlPoints[0][0].length,t.knotsW.length))throw new E("Invalid relations between control points and knot vector");for(var a=t.controlPoints,c=t.degreeU,l=t.degreeV,h=t.degreeW,u=t.knotsU,d=t.knotsV,p=t.knotsW,f=a[0][0][0].length,m=kt.knotSpanGivenN(e,c,r,u),g=kt.knotSpanGivenN(i,l,s,d),v=kt.knotSpanGivenN(n,h,o,p),_=kt.basisFunctionsGivenKnotSpanIndex(m,r,c,u),y=kt.basisFunctionsGivenKnotSpanIndex(g,s,l,d),x=kt.basisFunctionsGivenKnotSpanIndex(v,o,h,p),b=m-c,M=Et.zeros1d(f),S=Et.zeros1d(f),w=Et.zeros1d(f),T=0,C=h+1;T<C;){var P=T++;w=Et.zeros1d(f);for(var A=v-h+P,D=0,R=l+1;D<R;){var k=D++;S=Et.zeros1d(f);for(var I=g-l+k,O=0,L=c+1;O<L;){var U=O++;Et.addMulMutate(S,_[U],a[b+U][I][A])}Et.addMulMutate(w,y[k],S)}Et.addMulMutate(M,x[P],w)}return M},kt.derivativeBasisFunctions=function(t,e,i){var n=kt.knotSpan(e,t,i),r=i.length-1-e-1;return kt.derivativeBasisFunctionsGivenNI(n,t,e,r,i)},kt.derivativeBasisFunctionsGivenNI=function(t,e,i,n,r){var s=Et.zeros2d(i+1,i+1),o=Et.zeros1d(i+1),a=Et.zeros1d(i+1),c=0,l=0;s[0][0]=1;for(var h=1,u=i+1;h<u;){var d=h++;o[d]=e-r[t+1-d],a[d]=r[t+d]-e,c=0;for(var p=0;p<d;){var f=p++;s[d][f]=a[f+1]+o[d-f],l=s[f][d-1]/s[d][f],s[f][d]=c+a[f+1]*l,c=o[d-f]*l}s[d][d]=c}for(var m=Et.zeros2d(n+1,i+1),g=Et.zeros2d(2,i+1),v=0,_=1,y=0,x=0,b=0,M=0,S=i+1;M<S;){var w=M++;m[0][w]=s[w][i]}for(var T=0,E=i+1;T<E;){var C=T++;v=0,_=1,g[0][0]=1;for(var P=1,A=n+1;P<A;){var D=P++;y=0,x=C-D,b=i-D,C>=D&&(g[_][0]=g[v][0]/s[b+1][x],y=g[_][0]*s[x][b]);for(var R=x>=-1?1:-x,k=1+(C-1<=b?D-1:i-C);R<k;){var I=R++;g[_][I]=(g[v][I]-g[v][I-1])/s[b+1][x+I],y+=g[_][I]*s[x+I][b]}C<=b&&(g[_][D]=-g[v][D-1]/s[b+1][C],y+=g[_][D]*s[C][b]),m[D][C]=y;var O=v;v=_,_=O}}for(var L=i,U=1,N=n+1;U<N;){for(var W=U++,F=0,B=i+1;F<B;){var z=F++;m[W][z]*=L}L*=i-W}return m},kt.basisFunctions=function(t,e,i){var n=kt.knotSpan(e,t,i);return kt.basisFunctionsGivenKnotSpanIndex(n,t,e,i)},kt.basisFunctionsGivenKnotSpanIndex=function(t,e,i,n){var r=Et.zeros1d(i+1),s=Et.zeros1d(i+1),o=Et.zeros1d(i+1),a=0,c=0;r[0]=1;for(var l=1,h=i+1;l<h;){var u=l++;s[u]=e-n[t+1-u],o[u]=n[t+u]-e,a=0;for(var d=0;d<u;){var p=d++;c=r[p]/(o[p+1]+s[u-p]),r[p]=a+o[p+1]*c,a=s[u-p]*c}r[u]=a}return r},kt.knotSpan=function(t,e,i){return kt.knotSpanGivenN(i.length-t-2,t,e,i)},kt.knotSpanGivenN=function(t,e,i,n){if(i>n[t+1]-V.EPSILON)return t;if(i<n[e]+V.EPSILON)return e;for(var r=e,s=t+1,o=Math.floor((r+s)/2);i<n[o]||i>=n[o+1];)i<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o},kt.dehomogenize=function(t){for(var e=[],i=t[t.length-1],n=t.length-1,r=0;r<n;){var s=r++;e.push(t[s]/i)}return e},kt.rational1d=function(t){var e=t[0].length-1;return t.map((function(t){return t.slice(0,e)}))},kt.rational2d=function(t){return t.map(kt.rational1d)},kt.weight1d=function(t){var e=t[0].length-1;return t.map((function(t){return t[e]}))},kt.weight2d=function(t){return t.map(kt.weight1d)},kt.dehomogenize1d=function(t){return t.map(kt.dehomogenize)},kt.dehomogenize2d=function(t){return t.map(kt.dehomogenize1d)},kt.homogenize1d=function(t,e){var i,n=t.length,r=t[0].length,s=[],o=0,a=[];i=null!=e?e:Et.rep(t.length,1);for(var c=0;c<n;){var l=c++,h=[];a=t[l],o=i[l];for(var u=0;u<r;){var d=u++;h.push(a[d]*o)}h.push(o),s.push(h)}return s},kt.homogenize2d=function(t,e){var i,n=t.length,r=[];if(null!=e)i=e;else{for(var s=[],o=0;o<n;)o++,s.push(Et.rep(t[0].length,1));i=s}for(var a=0;a<n;){var c=a++;r.push(kt.homogenize1d(t[c],i[c]))}return r};var It=e.eval.Intersect=function(){};n["verb.eval.Intersect"]=It,It.__name__=["verb","eval","Intersect"],It.surfaces=function(t,e,i){var n=Ut.rationalSurfaceAdaptive(t),r=Ut.rationalSurfaceAdaptive(e);return It.meshes(n,r).map((function(n){return n.map((function(n){return It.surfacesAtPointWithEstimate(t,e,n.uv0,n.uv1,i)}))})).map((function(t){return Ot.rationalInterpCurve(t.map((function(t){return t.point})),3)}))},It.surfacesAtPointWithEstimate=function(t,e,i,n,r){var s,o,a,c,l,h,u,d,p,f,m,g,v,_=0;do{if(o=(s=kt.rationalSurfaceDerivatives(t,i[0],i[1],1))[0][0],c=s[1][0],l=s[0][1],a=Et.normalized(Et.cross(c,l)),h=Et.dot(a,o),d=(u=kt.rationalSurfaceDerivatives(e,n[0],n[1],1))[0][0],f=u[1][0],m=u[0][1],p=Et.normalized(Et.cross(f,m)),g=Et.dot(p,d),(v=Et.distSquared(o,d))<r*r)break;var y=Et.normalized(Et.cross(a,p)),x=Et.dot(y,o),b=It.threePlanes(a,h,p,g,y,x);if(null==b)throw new E("panic!");var M=Et.sub(b,o),S=Et.sub(b,d),w=Et.cross(c,a),T=Et.cross(l,a),C=Et.cross(f,p),P=Et.cross(m,p),A=Et.dot(T,M)/Et.dot(T,c),D=Et.dot(w,M)/Et.dot(w,l),R=Et.dot(P,S)/Et.dot(P,f),k=Et.dot(C,S)/Et.dot(C,m);i=Et.add([A,D],i),n=Et.add([R,k],n),_++}while(_<5);return new nt(i,n,o,v)},It.meshes=function(t,e,i,n){null==i&&(i=new ft(t)),null==n&&(n=new ft(e));var r=It.boundingBoxTrees(i,n,0),s=F.unique(r.map((function(i){return It.triangles(t,i.item0,e,i.item1)})).filter((function(t){return null!=t})).filter((function(t){return Et.distSquared(t.min.point,t.max.point)>V.EPSILON})),(function(t,e){var i=Et.sub(t.min.uv0,e.min.uv0),n=Et.dot(i,i),r=Et.sub(t.max.uv0,e.max.uv0),s=Et.dot(r,r),o=Et.sub(t.min.uv0,e.max.uv0),a=Et.dot(o,o),c=Et.sub(t.max.uv0,e.min.uv0),l=Et.dot(c,c);return n<V.EPSILON&&s<V.EPSILON||a<V.EPSILON&&l<V.EPSILON}));return It.makeMeshIntersectionPolylines(s)},It.meshSlices=function(t,e,i,n){for(var r=new xt(t),s=r.boundingBox(),o=s.min[0],a=s.min[1],c=s.max[0],l=s.max[1],h=Et.span(e,i,n),u=[],d=0;d<h.length;){var p=h[d];++d;var f=new Y([[0,1,2],[0,2,3]],[[o,a,p],[c,a,p],[c,l,p],[o,l,p]],null,[[0,0],[1,0],[1,1],[0,1]]);u.push(It.meshes(t,f,r))}return u},It.makeMeshIntersectionPolylines=function(t){if(0==t.length)return[];for(var e=0;e<t.length;){var i=t[e];++e,i.max.opp=i.min,i.min.opp=i.max}for(var n=It.kdTreeFromSegments(t),r=[],s=0;s<t.length;){var o=t[s];++s,r.push(o.min),r.push(o.max)}for(var a=0;a<r.length;){var c=r[a];if(++a,null==c.adj){var l=It.lookupAdjacentSegment(c,n,t.length);null!=l&&null==l.adj&&(c.adj=l,l.adj=c)}}var h=r.filter((function(t){return null==t.adj}));0==h.length&&(h=r);for(var u=[],d=0,p=!1;0!=h.length;){var f=h.pop();if(!f.visited){for(var m=[],g=f;null!=g&&!g.visited&&(g.visited=!0,g.opp.visited=!0,m.push(g),d+=2,(g=g.opp.adj)!=f););m.length>0&&(m.push(m[m.length-1].opp),u.push(m))}if(0==h.length&&r.length>0&&(p||d<r.length)){p=!0;var v=r.pop();h.push(v)}}return u},It.kdTreeFromSegments=function(t){for(var e=[],i=0;i<t.length;){var n=t[i];++i,e.push(new ht(n.min.point,n.min)),e.push(new ht(n.max.point,n.max))}return new ct(e,Et.distSquared)},It.lookupAdjacentSegment=function(t,e,i){var n=e.nearest(t.point,i,V.EPSILON).filter((function(e){return t!=e.item0.obj})).map((function(t){return t.item0.obj}));return 1==n.length?n[0]:null},It.curveAndSurface=function(t,e,i,n,r){null==i&&(i=.001),null!=n||(n=new pt(t)),null!=r||(r=new gt(e));var s=It.boundingBoxTrees(n,r,i);return F.unique(s.map((function(t){var e=t.item0,n=t.item1,r=(F.first(e.knots)+F.last(e.knots))/2,s=[(F.first(n.knotsU)+F.last(n.knotsU))/2,(F.first(n.knotsV)+F.last(n.knotsV))/2];return It.curveAndSurfaceWithEstimate(e,n,[r].concat(s),i)})).filter((function(t){return Et.distSquared(t.curvePoint,t.surfacePoint)<i*i})),(function(t,e){return Math.abs(t.u-e.u)<.5*i}))},It.curveAndSurfaceWithEstimate=function(t,e,i,n){null==n&&(n=.001);var r=bt.uncmin((function(i){var n=kt.rationalCurvePoint(t,i[0]),r=kt.rationalSurfacePoint(e,i[1],i[2]),s=Et.sub(n,r);return Et.dot(s,s)}),i,n*n,(function(i){var n=kt.rationalCurveDerivatives(t,i[0],1),r=kt.rationalSurfaceDerivatives(e,i[1],i[2],1),s=Et.sub(r[0][0],n[0]),o=Et.mul(-1,n[1]),a=r[1][0],c=r[0][1];return[2*Et.dot(o,s),2*Et.dot(a,s),2*Et.dot(c,s)]})).solution;return new tt(r[0],[r[1],r[2]],kt.rationalCurvePoint(t,r[0]),kt.rationalSurfacePoint(e,r[1],r[2]))},It.polylineAndMesh=function(t,e,i){for(var n=It.boundingBoxTrees(new mt(t),new ft(e),i),r=[],s=0;s<n.length;){var o=n[s];++s;var a=o.item0,c=o.item1,l=It.segmentWithTriangle(t.points[a],t.points[a+1],e.points,e.faces[c]);if(null!=l){var h=l.point,u=Et.lerp(l.p,[t.params[a]],[t.params[a+1]])[0],d=yt.triangleUVFromPoint(e,c,h);r.push(new it(h,u,d,a,c))}}return r},It.boundingBoxTrees=function(t,e,i){null==i&&(i=1e-9);var n=[],r=[];n.push(t),r.push(e);for(var s=[];n.length>0;){var o=n.pop(),a=r.pop();if(!o.empty()&&!a.empty()&&o.boundingBox().intersects(a.boundingBox(),i)){var c=o.indivisible(i),l=a.indivisible(i);if(c&&l)s.push(new J(o.yield(),a.yield()));else if(!c||l)if(c||!l){var h=o.split(),u=a.split();n.push(h.item1),r.push(u.item1),n.push(h.item1),r.push(u.item0),n.push(h.item0),r.push(u.item1),n.push(h.item0),r.push(u.item0)}else{var d=o.split();n.push(d.item1),r.push(a),n.push(d.item0),r.push(a)}else{var p=a.split();n.push(o),r.push(p.item1),n.push(o),r.push(p.item0)}}}return s},It.curves=function(t,e,i){var n=It.boundingBoxTrees(new pt(t),new pt(e),0);return F.unique(n.map((function(n){return It.curvesWithEstimate(t,e,F.first(n.item0.knots),F.first(n.item1.knots),i)})).filter((function(t){return Et.distSquared(t.point0,t.point1)<i})),(function(t,e){return Math.abs(t.u0-e.u0)<5*i}))},It.curvesWithEstimate=function(t,e,i,n,r){var s=bt.uncmin((function(i){var n=kt.rationalCurvePoint(t,i[0]),r=kt.rationalCurvePoint(e,i[1]),s=Et.sub(n,r);return Et.dot(s,s)}),[i,n],r*r,(function(i){var n=kt.rationalCurveDerivatives(t,i[0],1),r=kt.rationalCurveDerivatives(e,i[1],1),s=Et.sub(n[0],r[0]),o=n[1],a=Et.mul(-1,r[1]);return[2*Et.dot(o,s),2*Et.dot(a,s)]})),o=s.solution[0],a=s.solution[1],c=kt.rationalCurvePoint(t,o),l=kt.rationalCurvePoint(e,a);return new Q(c,l,o,a)},It.triangles=function(t,e,i,n){var r=t.faces[e],s=i.faces[n],o=yt.getTriangleNorm(t.points,r),a=yt.getTriangleNorm(i.points,s),c=t.points[r[0]],l=i.points[s[0]],h=It.planes(c,o,l,a);if(null==h)return null;var u=It.clipRayInCoplanarTriangle(h,t,e);if(null==u)return null;var d=It.clipRayInCoplanarTriangle(h,i,n);if(null==d)return null;var p=It.mergeTriangleClipIntervals(u,d,t,e,i,n);return null==p?null:new $(new et(p.min.uv0,p.min.uv1,p.min.point,e,n),new et(p.max.uv0,p.max.uv1,p.max.point,e,n))},It.clipRayInCoplanarTriangle=function(t,e,i){for(var n=e.faces[i],r=[e.points[n[0]],e.points[n[1]],e.points[n[2]]],s=[e.uvs[n[0]],e.uvs[n[1]],e.uvs[n[2]]],o=[Et.sub(s[1],s[0]),Et.sub(s[2],s[1]),Et.sub(s[0],s[2])],a=[Et.sub(r[1],r[0]),Et.sub(r[2],r[1]),Et.sub(r[0],r[2])],c=a.map(Et.normalized),l=a.map(Et.norm),h=null,u=null,d=0;d<3;){var p=d++,f=r[p],m=c[p],g=It.rays(f,m,t.origin,t.dir);if(null!=g){var v=g.u0,_=g.u1;v<-V.EPSILON||v>l[p]+V.EPSILON||((null==h||_<h.u)&&(h=new st(_,Et.onRay(t.origin,t.dir,_),Et.onRay(s[p],o[p],v/l[p]))),(null==u||_>u.u)&&(u=new st(_,Et.onRay(t.origin,t.dir,_),Et.onRay(s[p],o[p],v/l[p]))))}}return null==u||null==h?null:new $(h,u)},It.mergeTriangleClipIntervals=function(t,e,i,n,r,s){if(e.min.u>t.max.u+V.EPSILON||t.min.u>e.max.u+V.EPSILON)return null;var o,a;o=t.min.u>e.min.u?new J(t.min,0):new J(e.min,1),a=t.max.u<e.max.u?new J(t.max,0):new J(e.max,1);var c=new $(new et(null,null,o.item0.point,n,s),new et(null,null,a.item0.point,n,s));return 0==o.item1?(c.min.uv0=o.item0.uv,c.min.uv1=yt.triangleUVFromPoint(r,s,o.item0.point)):(c.min.uv0=yt.triangleUVFromPoint(i,n,o.item0.point),c.min.uv1=o.item0.uv),0==a.item1?(c.max.uv0=a.item0.uv,c.max.uv1=yt.triangleUVFromPoint(r,s,a.item0.point)):(c.max.uv0=yt.triangleUVFromPoint(i,n,a.item0.point),c.max.uv1=a.item0.uv),c},It.planes=function(t,e,i,n){var r=Et.cross(e,n);if(Et.dot(r,r)<V.EPSILON)return null;var s,o,a,c,l=0,h=Math.abs(r[0]),u=Math.abs(r[1]),d=Math.abs(r[2]);u>h&&(l=1,h=u),d>h&&(l=2,h=d),0==l?(s=e[1],o=e[2],a=n[1],c=n[2]):1==l?(s=e[0],o=e[2],a=n[0],c=n[2]):(s=e[0],o=e[1],a=n[0],c=n[1]);var p=-Et.dot(t,e),f=-Et.dot(i,n),m=s*c-o*a,g=(o*f-p*c)/m,v=(p*a-s*f)/m;return new j(0==l?[0,g,v]:1==l?[g,0,v]:[g,v,0],Et.normalized(r))},It.threePlanes=function(t,e,i,n,r,s){var o=Et.cross(i,r),a=Et.dot(t,o);if(Math.abs(a)<V.EPSILON)return null;var c=Et.sub(Et.mul(s,i),Et.mul(n,r)),l=Et.add(Et.mul(e,o),Et.cross(t,c));return Et.mul(1/a,l)},It.polylines=function(t,e,i){for(var n=It.boundingBoxTrees(new mt(t),new mt(e),i),r=[],s=0;s<n.length;){var o=n[s];++s;var a=o.item0,c=o.item1,l=It.segments(t.points[a],t.points[a+1],e.points[c],e.points[c+1],i);null!=l&&(l.u0=Et.lerp(l.u0,[t.params[a]],[t.params[a+1]])[0],l.u1=Et.lerp(l.u1,[e.params[c]],[e.params[c+1]])[0],r.push(l))}return r},It.segments=function(t,e,i,n,r){var s=Et.sub(e,t),o=Math.sqrt(Et.dot(s,s)),a=Et.mul(1/o,s),c=Et.sub(n,i),l=Math.sqrt(Et.dot(c,c)),h=Et.mul(1/l,c),u=It.rays(t,a,i,h);if(null!=u){var d=Math.min(Math.max(0,u.u0/o),1),p=Math.min(Math.max(0,u.u1/l),1),f=Et.onRay(t,s,d),m=Et.onRay(i,c,p);if(Et.distSquared(f,m)<r*r)return new Q(f,m,d,p)}return null},It.rays=function(t,e,i,n){var r=Et.dot(e,n),s=Et.dot(e,i),o=Et.dot(e,t),a=Et.dot(n,i),c=Et.dot(n,t),l=Et.dot(e,e),h=l*Et.dot(n,n)-r*r;if(Math.abs(h)<V.EPSILON)return null;var u=(r*(s-o)-l*(a-c))/h,d=(s-o+u*r)/l,p=Et.onRay(t,e,d),f=Et.onRay(i,n,u);return new Q(p,f,d,u)},It.segmentWithTriangle=function(t,e,i,n){var r=i[n[0]],s=i[n[1]],o=i[n[2]],a=Et.sub(s,r),c=Et.sub(o,r),l=Et.cross(a,c),h=Et.sub(e,t),u=Et.sub(t,r),d=-Et.dot(l,u),p=Et.dot(l,h);if(Math.abs(p)<V.EPSILON)return null;var f=d/p;if(f<0||f>1)return null;var m=Et.add(t,Et.mul(f,h)),g=Et.dot(a,c),v=Et.dot(a,a),_=Et.dot(c,c),y=Et.sub(m,r),x=Et.dot(y,a),b=Et.dot(y,c),M=g*g-v*_;if(Math.abs(M)<V.EPSILON)return null;var S=(g*b-_*x)/M,w=(g*x-v*b)/M;return S>1+V.EPSILON||w>1+V.EPSILON||w<-V.EPSILON||S<-V.EPSILON||S+w>1+V.EPSILON?null:new rt(m,S,w,f)},It.segmentAndPlane=function(t,e,i,n){var r=Et.dot(n,Et.sub(e,t));if(Math.abs(r)<V.EPSILON)return null;var s=Et.dot(n,Et.sub(i,t))/r;return s>1+V.EPSILON||s<-V.EPSILON?null:{p:s}};var Ot=e.eval.Make=function(){};n["verb.eval.Make"]=Ot,Ot.__name__=["verb","eval","Make"],Ot.rationalTranslationalSurface=function(t,e){for(var i=kt.rationalCurvePoint(e,F.first(e.knots)),n=F.first(e.knots),r=F.last(e.knots),s=2*e.controlPoints.length,o=(r-n)/(s-1),a=[],c=0;c<s;){var l=c++,h=Et.sub(kt.rationalCurvePoint(e,n+l*o),i),u=Lt.rationalCurveTransform(t,[[1,0,0,h[0]],[0,1,0,h[1]],[0,0,1,h[2]],[0,0,0,1]]);a.push(u)}return Ot.loftedSurface(a)},Ot.surfaceBoundaryCurves=function(t){return[Ot.surfaceIsocurve(t,F.first(t.knotsU),!1),Ot.surfaceIsocurve(t,F.last(t.knotsU),!1),Ot.surfaceIsocurve(t,F.first(t.knotsV),!0),Ot.surfaceIsocurve(t,F.last(t.knotsV),!0)]},Ot.surfaceIsocurve=function(t,e,i){var n,r;null==i&&(i=!1),n=i?t.knotsV:t.knotsU,r=i?t.degreeV:t.degreeU;for(var s=Ct.knotMultiplicities(n),o=-1,a=0,c=s.length;a<c;){var l=a++;if(Math.abs(e-s[l].knot)<V.EPSILON){o=l;break}}var h,u=r+1;o>=0&&(u-=s[o].mult),h=u>0?Lt.surfaceKnotRefine(t,Et.rep(u,e),i):t;var d=kt.knotSpan(r,e,n);return Math.abs(e-F.first(n))<V.EPSILON?d=0:Math.abs(e-F.last(n))<V.EPSILON&&(d=(i?h.controlPoints[0].length:h.controlPoints.length)-1),i?new X(h.degreeU,h.knotsU,function(t){for(var e=[],i=0,n=h.controlPoints;i<n.length;){var r=n[i];++i,e.push(r[d])}return e}()):new X(h.degreeV,h.knotsV,h.controlPoints[d])},Ot.loftedSurface=function(t,e){var i=(t=Lt.unifyCurveKnotVectors(t))[0].degree;null==e&&(e=3),e>t.length-1&&(e=t.length-1);for(var n=t[0].knots,r=[],s=[],o=0,a=t[0].controlPoints.length;o<a;){var c=[o++],l=t.map(function(t){return function(e){return e.controlPoints[t[0]]}}(c)),h=Ot.rationalInterpCurve(l,e,!0);s.push(h.controlPoints),r=h.knots}return new q(i,e,n,r,s)},Ot.clonedCurve=function(t){return new X(t.degree,t.knots.slice(),t.controlPoints.map((function(t){return t.slice()})))},Ot.rationalBezierCurve=function(t,e){for(var i=t.length-1,n=[],r=0,s=i+1;r<s;)r++,n.push(0);for(var o=0,a=i+1;o<a;)o++,n.push(1);return null==e&&(e=Et.rep(t.length,1)),new X(i,n,kt.homogenize1d(t,e))},Ot.fourPointSurface=function(t,e,i,n,r){null==r&&(r=3);for(var s=r,o=[],a=0,c=r+1;a<c;){for(var l=a++,h=[],u=0,d=r+1;u<d;){var p=u++,f=1-l/s,m=Et.lerp(f,t,e),g=Et.lerp(f,n,i),v=Et.lerp(1-p/s,m,g);v.push(1),h.push(v)}o.push(h)}var _=Et.rep(r+1,0),y=Et.rep(r+1,1);return new q(r,r,_.concat(y),_.concat(y),o)},Ot.ellipseArc=function(t,e,i,n,r){var s=Et.norm(e),o=Et.norm(i);e=Et.normalized(e),i=Et.normalized(i),r<n&&(r=2*Math.PI+n);var a,c=r-n,l=c/(a=c<=Math.PI/2?1:c<=Math.PI?2:c<=3*Math.PI/2?3:4),h=Math.cos(l/2),u=Et.add(t,Et.add(Et.mul(s*Math.cos(n),e),Et.mul(o*Math.sin(n),i))),d=Et.sub(Et.mul(Math.cos(n),i),Et.mul(Math.sin(n),e)),p=[],f=Et.zeros1d(2*a+3),m=0,g=n,v=Et.zeros1d(2*a);p[0]=u,v[0]=1;for(var _=1,y=a+1;_<y;){var x=_++;g+=l;var b=Et.add(t,Et.add(Et.mul(s*Math.cos(g),e),Et.mul(o*Math.sin(g),i)));v[m+2]=1,p[m+2]=b;var M=Et.sub(Et.mul(Math.cos(g),i),Et.mul(Math.sin(g),e)),S=It.rays(u,Et.mul(1/Et.norm(d),d),b,Et.mul(1/Et.norm(M),M)),w=Et.add(u,Et.mul(S.u0,d));v[m+1]=h,p[m+1]=w,m+=2,x<a&&(u=b,d=M)}for(var T=2*a+1,E=0;E<3;){var C=E++;f[C]=0,f[C+T]=1}switch(a){case 2:f[3]=f[4]=.5;break;case 3:f[3]=f[4]=.3333333333333333,f[5]=f[6]=.6666666666666666;break;case 4:f[3]=f[4]=.25,f[5]=f[6]=.5,f[7]=f[8]=.75}return new X(2,f,kt.homogenize1d(p,v))},Ot.arc=function(t,e,i,n,r,s){return Ot.ellipseArc(t,Et.mul(n,Et.normalized(e)),Et.mul(n,Et.normalized(i)),r,s)},Ot.polyline=function(t){for(var e,i=[0,0],n=0,r=0,s=t.length-1;r<s;){var o=r++;n+=Et.dist(t[o],t[o+1]),i.push(n)}i.push(n),i=Et.mul(1/n,i);for(var a=[],c=0,l=t.length;c<l;)c++,a.push(1);return e=a,new X(1,i,kt.homogenize1d(t.slice(0),e))},Ot.extrudedSurface=function(t,e,i){for(var n=[[],[],[]],r=[[],[],[]],s=kt.dehomogenize1d(i.controlPoints),o=kt.weight1d(i.controlPoints),a=Et.mul(e,t),c=Et.mul(.5*e,t),l=0,h=s.length;l<h;){var u=l++;n[2][u]=s[u],n[1][u]=Et.add(c,s[u]),n[0][u]=Et.add(a,s[u]),r[0][u]=o[u],r[1][u]=o[u],r[2][u]=o[u]}return new q(2,i.degree,[0,0,0,1,1,1],i.knots,kt.homogenize2d(n,r))},Ot.cylindricalSurface=function(t,e,i,n,r){var s=Et.cross(t,e),o=(Math.PI,Ot.arc(i,e,s,r,0,2*Math.PI));return Ot.extrudedSurface(t,n,o)},Ot.revolvedSurface=function(t,e,i,n){var r,s,o=kt.dehomogenize1d(t.controlPoints),a=kt.weight1d(t.controlPoints);n<=Math.PI/2?(r=1,s=Et.zeros1d(6+2*(r-1))):n<=Math.PI?(r=2,(s=Et.zeros1d(6+2*(r-1)))[3]=s[4]=.5):n<=3*Math.PI/2?(r=3,(s=Et.zeros1d(6+2*(r-1)))[3]=s[4]=.3333333333333333,s[5]=s[6]=.6666666666666666):(r=4,(s=Et.zeros1d(6+2*(r-1)))[3]=s[4]=.25,s[5]=s[6]=.5,s[7]=s[8]=.75);for(var c=n/r,l=3+2*(r-1),h=0;h<3;){var u=h++;s[u]=0,s[l+u]=1}for(var d=Math.cos(c/2),p=0,f=Et.zeros1d(r+1),m=Et.zeros1d(r+1),g=Et.zeros3d(2*r+1,o.length,3),v=Et.zeros2d(2*r+1,o.length),_=1,y=r+1;_<y;){var x=_++;p+=c,m[x]=Math.cos(p),f[x]=Math.sin(p)}for(var b=0,M=o.length;b<M;){var S=b++,w=Tt.rayClosestPoint(o[S],e,i),T=Et.sub(o[S],w),E=Et.norm(T),C=Et.cross(i,T);E>V.EPSILON&&(T=Et.mul(1/E,T),C=Et.mul(1/E,C)),g[0][S]=o[S];var P=o[S];v[0][S]=a[S];for(var A=C,D=0,R=1,k=r+1;R<k;){var I,O=R++;I=0==E?w:Et.add(w,Et.add(Et.mul(E*m[O],T),Et.mul(E*f[O],C))),g[D+2][S]=I,v[D+2][S]=a[S];var L=Et.sub(Et.mul(m[O],C),Et.mul(f[O],T));if(0==E)g[D+1][S]=w;else{var U=It.rays(P,Et.mul(1/Et.norm(A),A),I,Et.mul(1/Et.norm(L),L)),N=Et.add(P,Et.mul(U.u0,A));g[D+1][S]=N}v[D+1][S]=d*a[S],D+=2,O<r&&(P=I,A=L)}}return new q(2,t.degree,s,t.knots,kt.homogenize2d(g,v))},Ot.sphericalSurface=function(t,e,i,n){var r=Ot.arc(t,Et.mul(-1,e),i,n,0,Math.PI);return Ot.revolvedSurface(r,t,e,2*Math.PI)},Ot.conicalSurface=function(t,e,i,n,r){var s=2*Math.PI,o=[Et.add(i,Et.mul(n,t)),Et.add(i,Et.mul(r,e))],a=new X(1,[0,0,1,1],kt.homogenize1d(o,[1,1]));return Ot.revolvedSurface(a,i,t,s)},Ot.rationalInterpCurve=function(t,e,i,n,r){if(null==i&&(i=!1),null==e&&(e=3),t.length<e+1)throw new E("You need to supply at least degree + 1 points! You only supplied "+t.length+" points.");for(var s=[0],o=1,a=t.length;o<a;){var c=o++,l=Et.norm(Et.sub(t[c],t[c-1])),h=s[s.length-1];s.push(h+l)}for(var u=s[s.length-1],d=0,p=s.length;d<p;){var f=d++;s[f]=s[f]/u}var m,g,v=Et.rep(e+1,0),_=null!=n&&null!=r;m=_?0:1,g=_?s.length-e+1:s.length-e;for(var y=m;y<g;){for(var x=y++,b=0,M=0;M<e;)b+=s[x+M++];v.push(1/e*b)}var S,w,T=v.concat(Et.rep(e+1,1)),C=[];S=_?t.length+1:t.length-1,w=_?t.length-(e-1):t.length-(e+1);for(var P=0;P<s.length;){var A=s[P];++P;var D=kt.knotSpanGivenN(S,e,A,T),R=kt.basisFunctionsGivenKnotSpanIndex(D,A,e,T),k=D-e,I=Et.zeros1d(k),O=Et.zeros1d(w-k);C.push(I.concat(R).concat(O))}if(_){var L=C[0].length-2,U=[-1,1].concat(Et.zeros1d(L)),N=Et.zeros1d(L).concat([-1,1]);F.spliceAndInsert(C,1,0,U),F.spliceAndInsert(C,C.length-1,0,N)}for(var W=t[0].length,B=[],z=(1-T[T.length-e-2])/e,V=T[e+1]/e,H=0;H<W;){var G,j=[H++];if(_){(G=[t[0][j[0]]]).push(V*n[j[0]]);for(var q=1,Y=t.length-1;q<Y;){var Z=q++;G.push(t[Z][j[0]])}G.push(z*r[j[0]]),G.push(F.last(t)[j[0]])}else G=t.map(function(t){return function(e){return e[t[0]]}}(j));var K=vt.solve(C,G);B.push(K)}var J=vt.transpose(B);if(!i){var $=Et.rep(J.length,1);J=kt.homogenize1d(J,$)}return new X(e,T,J)};var Lt=e.eval.Modify=function(){};n["verb.eval.Modify"]=Lt,Lt.__name__=["verb","eval","Modify"],Lt.curveReverse=function(t){return new X(t.degree,Lt.knotsReverse(t.knots),F.reversed(t.controlPoints))},Lt.surfaceReverse=function(t,e){return null==e&&(e=!1),e?new q(t.degreeU,t.degreeV,t.knotsU,Lt.knotsReverse(t.knotsV),function(e){for(var i=[],n=0,r=t.controlPoints;n<r.length;){var s=r[n];++n,i.push(F.reversed(s))}return i}()):new q(t.degreeU,t.degreeV,Lt.knotsReverse(t.knotsU),t.knotsV,F.reversed(t.controlPoints))},Lt.knotsReverse=function(t){for(var e=F.first(t),i=(F.last(t),[e]),n=t.length,r=1;r<n;){var s=r++;i.push(i[s-1]+(t[n-s]-t[n-s-1]))}return i},Lt.unifyCurveKnotVectors=function(t){t=t.map(Ot.clonedCurve);for(var e,i=a.fold(t,(function(t,e){return Lt.imax(t.degree,e)}),0),n=0,r=t.length;n<r;){var s=n++;t[s].degree<i&&(t[s]=Lt.curveElevateDegree(t[s],i))}for(var o=[],c=0;c<t.length;){var l=t[c];++c,o.push(new $(F.first(l.knots),F.last(l.knots)))}e=o;for(var h=0,u=t.length;h<u;){var d=h++,p=[e[d].min];t[d].knots=t[d].knots.map(function(t){return function(e){return e-t[0]}}(p))}for(var f=e.map((function(t){return t.max-t.min})),m=a.fold(f,(function(t,e){return Math.max(t,e)}),0),g=0,v=t.length;g<v;){var _=g++,y=[m/f[_]];t[_].knots=t[_].knots.map(function(t){return function(e){return e*t[0]}}(y))}for(var x=a.fold(t,(function(t,e){return Et.sortedSetUnion(t.knots,e)}),[]),b=0,M=t.length;b<M;){var S=b++,w=Et.sortedSetSub(x,t[S].knots);0==w.length&&(t[S]=t[S]),t[S]=Lt.curveKnotRefine(t[S],w)}return t},Lt.imin=function(t,e){return t<e?t:e},Lt.imax=function(t,e){return t>e?t:e},Lt.curveElevateDegree=function(t,e){if(e<=t.degree)return t;var i=t.knots.length-t.degree-2,n=t.degree,r=t.knots,s=t.controlPoints,o=e-t.degree,a=t.controlPoints[0].length,c=Et.zeros2d(n+o+1,n+1),l=[],h=[],u=[],d=i+n+1,p=e,f=Math.floor(p/2),m=[],g=[];c[0][0]=1,c[p][n]=1;for(var v=1,_=f+1;v<_;)for(var y=v++,x=1/B.get(p,y),b=Lt.imin(n,y),M=Lt.imax(0,y-o),S=b+1;M<S;){var w=M++;c[y][w]=x*B.get(n,w)*B.get(o,y-w)}for(var T=f+1;T<p;)for(var E=T++,C=Lt.imin(n,E),P=Lt.imax(0,E-o),A=C+1;P<A;){var D=P++;c[E][D]=c[p-E][n-D]}var R=p+1,k=-1,I=n,O=n+1,L=1,U=r[0];m[0]=s[0];for(var N=0,W=p+1;N<W;)g[N++]=U;for(var F=0,z=n+1;F<z;){var V=F++;l[V]=s[V]}for(;O<d;){for(var H=O;O<d&&r[O]==r[O+1];)O+=1;var G,j,q=O-H+1,Y=r[O],Z=k;if(k=n-q,G=Z>0?Math.floor((Z+2)/2):1,j=k>0?Math.floor(p-(k+1)/2):p,k>0){for(var K=Y-U,J=[],$=n;$>q;)J[$-q-1]=K/(r[I+$]-U),$--;for(var Q=1,tt=k+1;Q<tt;){for(var et=Q++,it=k-et,nt=q+et,rt=n;rt>=nt;)l[rt]=Et.add(Et.mul(J[rt-nt],l[rt]),Et.mul(1-J[rt-nt],l[rt-1])),rt--;u[it]=l[n]}}for(var st=G,ot=p+1;st<ot;){var at=st++;h[at]=Et.zeros1d(a);for(var ct=Lt.imin(n,at),lt=Lt.imax(0,at-o),ht=ct+1;lt<ht;){var ut=lt++;h[at]=Et.add(h[at],Et.mul(c[at][ut],l[ut]))}}if(Z>1)for(var dt=R-2,pt=R,ft=Y-U,mt=(Y-g[R-1])/ft,gt=1;gt<Z;){for(var vt=gt++,_t=dt,yt=pt,xt=yt-R+1;yt-_t>vt;){if(_t<L){var bt=(Y-g[_t])/(U-g[_t]);m[_t]=Et.lerp(bt,m[_t],m[_t-1])}if(yt>=G){if(yt-vt<=R-p+Z){var Mt=(Y-g[yt-vt])/ft;h[xt]=Et.lerp(Mt,h[xt],h[xt+1])}}else h[xt]=Et.lerp(mt,h[xt],h[xt+1]);_t+=1,yt-=1,xt-=1}dt-=1,pt+=1}if(I!=n)for(var St=0,wt=p-Z;St<wt;)St++,g[R]=U,R+=1;for(var Tt=G,Ct=j+1;Tt<Ct;){var Pt=Tt++;m[L]=h[Pt],L+=1}if(O<d){for(var At=0;At<k;){var Dt=At++;l[Dt]=u[Dt]}for(var Rt=k,kt=n+1;Rt<kt;){var It=Rt++;l[It]=s[O-n+It]}I=O,O+=1,U=Y}else for(var Ot=0,Ut=p+1;Ot<Ut;)g[R+Ot++]=Y}return new X(e,g,m)},Lt.rationalSurfaceTransform=function(t,e){for(var i=kt.dehomogenize2d(t.controlPoints),n=0,r=i.length;n<r;)for(var s=n++,o=0,a=i[s].length;o<a;){var c=o++,l=i[s][c];l.push(1),i[s][c]=vt.dot(e,l).slice(0,l.length-1)}return new q(t.degreeU,t.degreeV,t.knotsU.slice(),t.knotsV.slice(),kt.homogenize2d(i,kt.weight2d(t.controlPoints)))},Lt.rationalCurveTransform=function(t,e){for(var i=kt.dehomogenize1d(t.controlPoints),n=0,r=i.length;n<r;){var s=n++,o=i[s];o.push(1),i[s]=vt.dot(e,o).slice(0,o.length-1)}return new X(t.degree,t.knots.slice(),kt.homogenize1d(i,kt.weight1d(t.controlPoints)))},Lt.surfaceKnotRefine=function(t,e,i){var n,r,s,o=[];i?(s=t.controlPoints,n=t.knotsV,r=t.degreeV):(s=vt.transpose(t.controlPoints),n=t.knotsU,r=t.degreeU);for(var a=null,c=0;c<s.length;){var l=s[c];++c,a=Lt.curveKnotRefine(new X(r,n,l),e),o.push(a.controlPoints)}var h=a.knots;return i?new q(t.degreeU,t.degreeV,t.knotsU.slice(),h,o):(o=vt.transpose(o),new q(t.degreeU,t.degreeV,h,t.knotsV.slice(),o))},Lt.decomposeCurveIntoBeziers=function(t){for(var e=t.degree,i=t.controlPoints,n=t.knots,r=Ct.knotMultiplicities(n),s=e+1,o=0;o<r.length;){var a=r[o];if(++o,a.mult<s){var c=Et.rep(s-a.mult,a.knot),l=Lt.curveKnotRefine(new X(e,n,i),c);n=l.knots,i=l.controlPoints}}n.length;for(var h=2*s,u=[],d=0;d<i.length;){var p=n.slice(d,d+h),f=i.slice(d,d+s);u.push(new X(e,p,f)),d+=s}return u},Lt.curveKnotRefine=function(t,e){if(0==e.length)return Ot.clonedCurve(t);for(var i=t.degree,n=t.controlPoints,r=t.knots,s=n.length-1,o=s+i+1,a=e.length-1,c=kt.knotSpan(i,e[0],r),l=kt.knotSpan(i,e[a],r),h=[],u=[],d=0,p=c-i+1;d<p;){var f=d++;h[f]=n[f]}for(var m=l-1,g=s+1;m<g;){var v=m++;h[v+a+1]=n[v]}for(var _=0,y=c+1;_<y;){var x=_++;u[x]=r[x]}for(var b=l+i,M=o+1;b<M;){var S=b++;u[S+a+1]=r[S]}for(var w=l+i-1,T=l+i+a,E=a;E>=0;){for(;e[E]<=r[w]&&w>c;)h[T-i-1]=n[w-i-1],u[T]=r[w],T-=1,w-=1;h[T-i-1]=h[T-i];for(var C=1,P=i+1;C<P;){var A=C++,D=T-i+A,R=u[T+A]-e[E];Math.abs(R)<V.EPSILON?h[D-1]=h[D]:(R/=u[T+A]-r[w-i+A],h[D-1]=Et.add(Et.mul(R,h[D-1]),Et.mul(1-R,h[D])))}u[T]=e[E],T-=1,E--}return new X(i,u,h)},Lt.curveKnotInsert=function(t,e,i){for(var n=t.degree,r=t.controlPoints,s=t.knots,o=r.length,a=kt.knotSpan(n,e,s),c=[],l=[],h=[],u=1,d=a+1;u<d;){var p=u++;l[p]=s[p]}for(var f=1,m=i+1;f<m;)l[a+f++]=e;for(var g=a+1,v=s.length;g<v;){var _=g++;l[_+i]=s[_]}for(var y=0,x=a-n+1;y<x;){var b=y++;h[b]=r[b]}for(var M=a-0;M<o;){var S=M++;h[S+i]=r[S]}for(var w=0,T=n-0+1;w<T;){var E=w++;c[E]=r[a-n+E]}for(var C=0,P=0,A=1,D=i+1;A<D;){var R=A++;C=a-n+R;for(var k=0,I=n-R-0+1;k<I;){var O=k++;P=(e-s[C+O])/(s[O+a+1]-s[C+O]),c[O]=Et.add(Et.mul(P,c[O+1]),Et.mul(1-P,c[O]))}h[C]=c[0],h[a+i-R-0]=c[n-R-0]}for(var L=C+1,U=a-0;L<U;){var N=L++;h[N]=c[N-C]}return new X(n,l,h)};var Ut=e.eval.Tess=function(){};n["verb.eval.Tess"]=Ut,Ut.__name__=["verb","eval","Tess"],Ut.rationalCurveRegularSample=function(t,e,i){return Ut.rationalCurveRegularSampleRange(t,t.knots[0],F.last(t.knots),e,i)},Ut.rationalCurveRegularSampleRange=function(t,e,i,n,r){n<1&&(n=2);for(var s=[],o=(i-e)/(n-1),a=0,c=0;c<n;)a=e+o*c++,r?s.push([a].concat(kt.rationalCurvePoint(t,a))):s.push(kt.rationalCurvePoint(t,a));return s},Ut.rationalCurveAdaptiveSample=function(t,e,i){if(null==i&&(i=!1),null==e&&(e=1e-6),1==t.degree){if(i){for(var n=[],r=0,s=t.controlPoints.length;r<s;){var o=r++;n.push([t.knots[o+1]].concat(kt.dehomogenize(t.controlPoints[o])))}return n}return t.controlPoints.map(kt.dehomogenize)}return Ut.rationalCurveAdaptiveSampleRange(t,t.knots[0],F.last(t.knots),e,i)},Ut.rationalCurveAdaptiveSampleRange=function(t,e,i,n,r){var s=kt.rationalCurvePoint(t,e),o=kt.rationalCurvePoint(t,i),a=e+(i-e)*(.5+.2*Math.random()),c=kt.rationalCurvePoint(t,a),l=Et.sub(s,o),h=Et.sub(s,c);if(Et.dot(l,l)<n&&Et.dot(h,h)>n||!Tt.threePointsAreFlat(s,c,o,n)){var u=e+.5*(i-e),d=Ut.rationalCurveAdaptiveSampleRange(t,e,u,n,r),p=Ut.rationalCurveAdaptiveSampleRange(t,u,i,n,r);return d.slice(0,-1).concat(p)}return r?[[e].concat(s),[i].concat(o)]:[s,o]},Ut.rationalSurfaceNaive=function(t,e,i){e<1&&(e=1),i<1&&(i=1),t.degreeU,t.degreeV,t.controlPoints;for(var n=t.knotsU,r=t.knotsV,s=(F.last(n)-n[0])/e,o=(F.last(r)-r[0])/i,a=[],c=[],l=[],h=0,u=e+1;h<u;)for(var d=h++,p=0,f=i+1;p<f;){var m=d*s,g=p++*o;c.push([m,g]);var v=kt.rationalSurfaceDerivatives(t,m,g,1),_=v[0][0];a.push(_);var y=Et.normalized(Et.cross(v[1][0],v[0][1]));l.push(y)}for(var x=[],b=0;b<e;)for(var M=b++,S=0;S<i;){var w=S++,T=M*(i+1)+w,E=(M+1)*(i+1)+w,C=E+1,P=[T,E,C],A=[T,C,T+1];x.push(P),x.push(A)}return new Y(x,a,l,c)},Ut.divideRationalSurfaceAdaptive=function(t,e){null==e&&(e=new Nt),null!=e.minDivsU?e.minDivsU=e.minDivsU:e.minDivsU=1,null!=e.minDivsV?e.minDivsU=e.minDivsV:e.minDivsU=1,null!=e.refine?e.refine=e.refine:e.refine=!0;var i,n,r=2*(t.controlPoints.length-1),s=2*(t.controlPoints[0].length-1);i=e.minDivsU>r?e.minDivsU=e.minDivsU:e.minDivsU=r,n=e.minDivsV>s?e.minDivsV=e.minDivsV:e.minDivsV=s;for(var o=F.last(t.knotsU),a=t.knotsU[0],c=F.last(t.knotsV),l=t.knotsV[0],h=(o-a)/i,u=(c-l)/n,d=[],p=[],f=0,m=n+1;f<m;){for(var g=f++,v=[],_=0,y=i+1;_<y;){var x=a+h*_++,b=l+u*g,M=kt.rationalSurfaceDerivatives(t,x,b,1),S=Et.normalized(Et.cross(M[0][1],M[1][0]));v.push(new ot(M[0][0],S,[x,b],-1,Et.isZero(S)))}p.push(v)}for(var w=0;w<n;)for(var T=w++,E=0;E<i;){var C=E++,P=[p[n-T-1][C],p[n-T-1][C+1],p[n-T][C+1],p[n-T][C]];d.push(new Wt(t,P))}if(!e.refine)return d;for(var A=0;A<n;)for(var D=A++,R=0;R<i;){var k=R++,I=D*i+k,O=Ut.north(I,D,k,i,n,d),L=Ut.east(I,D,k,i,n,d),U=Ut.south(I,D,k,i,n,d),N=Ut.west(I,D,k,i,n,d);d[I].neighbors=[U,L,O,N],d[I].divide(e)}return d},Ut.north=function(t,e,i,n,r,s){return 0==e?null:s[t-n]},Ut.south=function(t,e,i,n,r,s){return e==r-1?null:s[t+n]},Ut.east=function(t,e,i,n,r,s){return i==n-1?null:s[t+1]},Ut.west=function(t,e,i,n,r,s){return 0==i?null:s[t-1]},Ut.triangulateAdaptiveRefinementNodeTree=function(t){for(var e=Y.empty(),i=0;i<t.length;){var n=t[i];++i,n.triangulate(e)}return e},Ut.rationalSurfaceAdaptive=function(t,e){null!=e||(e=new Nt);var i=Ut.divideRationalSurfaceAdaptive(t,e);return Ut.triangulateAdaptiveRefinementNodeTree(i)};var Nt=e.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};n["verb.eval.AdaptiveRefinementOptions"]=Nt,Nt.__name__=["verb","eval","AdaptiveRefinementOptions"],Nt.prototype={__class__:Nt};var Wt=e.core.AdaptiveRefinementNode=function(t,e,i){if(this.srf=t,this.neighbors=null==i?[null,null,null,null]:i,this.corners=e,null==this.corners){var n=t.knotsU[0],r=F.last(t.knotsU),s=t.knotsV[0],o=F.last(t.knotsV);this.corners=[ot.fromUv(n,s),ot.fromUv(r,s),ot.fromUv(r,o),ot.fromUv(n,o)]}};n["verb.eval.AdaptiveRefinementNode"]=Wt,Wt.__name__=["verb","eval","AdaptiveRefinementNode"],Wt.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var t=0;t<4;){var e=t++;if(null==this.corners[e].point){var i=this.corners[e];this.evalSrf(i.uv[0],i.uv[1],i)}}},evalSrf:function(t,e,i){var n=kt.rationalSurfaceDerivatives(this.srf,t,e,1),r=n[0][0],s=Et.cross(n[0][1],n[1][0]),o=Et.isZero(s);return o||(s=Et.normalized(s)),null!=i?(i.degen=o,i.point=r,i.normal=s,i):new ot(r,s,[t,e],-1,o)},getEdgeCorners:function(t){if(this.isLeaf())return[this.corners[t]];if(this.horizontal)switch(t){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(t){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(t){var e=[this.corners[t]];if(null==this.neighbors[t])return e;var i=this.neighbors[t].getEdgeCorners((t+2)%4),n=t%2,r=V.EPSILON,s=this,o=[function(t){return t.uv[0]>s.corners[0].uv[0]+r&&t.uv[0]<s.corners[2].uv[0]-r},function(t){return t.uv[1]>s.corners[0].uv[1]+r&&t.uv[1]<s.corners[2].uv[1]-r}],a=i.filter(o[n]);return a.reverse(),e.concat(a)},midpoint:function(t){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[t])return this.midPoints[t];switch(t){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[t]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var t=this.corners.length,e=0;e<t;){var i=e++;if(this.corners[i],this.corners[i].degen){var n=this.corners[(i+1)%t],r=this.corners[(i+3)%t];n.degen?this.corners[i].normal=r.normal:this.corners[i].normal=n.normal}}},shouldDivide:function(t,e){if(e<t.minDepth)return!0;if(e>=t.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=Et.normSquared(Et.sub(this.corners[0].normal,this.corners[1].normal))>t.normTol||Et.normSquared(Et.sub(this.corners[2].normal,this.corners[3].normal))>t.normTol,this.splitHoriz=Et.normSquared(Et.sub(this.corners[1].normal,this.corners[2].normal))>t.normTol||Et.normSquared(Et.sub(this.corners[3].normal,this.corners[0].normal))>t.normTol,this.splitVert||this.splitHoriz)return!0;var i=this.center();return Et.normSquared(Et.sub(i.normal,this.corners[0].normal))>t.normTol||Et.normSquared(Et.sub(i.normal,this.corners[1].normal))>t.normTol||Et.normSquared(Et.sub(i.normal,this.corners[2].normal))>t.normTol||Et.normSquared(Et.sub(i.normal,this.corners[3].normal))>t.normTol},divide:function(t){null==t&&(t=new Nt),null==t.normTol&&(t.normTol=.085),null==t.minDepth&&(t.minDepth=0),null==t.maxDepth&&(t.maxDepth=10),this._divide(t,0,!0)},_divide:function(t,e,i){if(this.evalCorners(),this.shouldDivide(t,e)){if(e++,this.splitVert&&!this.splitHoriz?i=!1:!this.splitVert&&this.splitHoriz&&(i=!0),this.horizontal=i,this.horizontal){var n=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],r=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new Wt(this.srf,n),new Wt(this.srf,r)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var s=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],o=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new Wt(this.srf,s),new Wt(this.srf,o)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,c=this.children;a<c.length;){var l=c[a];++a,l._divide(t,e,!i)}}},triangulate:function(t){if(null==t&&(t=Y.empty()),this.isLeaf())return this.triangulateLeaf(t);for(var e=0,i=this.children;e<i.length;){var n=i[e];if(++e,null==n)break;n.triangulate(t)}return t},triangulateLeaf:function(t){for(var e=t.points.length,i=[],n=[],r=0,s=0;s<4;){var o=s++,a=this.getAllCorners(o);2==a.length&&(r=o+1);for(var c=0,l=a.length;c<l;){var h=c++;i.push(a[h])}}for(var u=0;u<i.length;){var d=i[u];++u,-1==d.id?(t.uvs.push(d.uv),t.points.push(d.point),t.normals.push(d.normal),d.id=e,n.push(e),e++):n.push(d.id)}if(4==i.length)return t.faces.push([n[0],n[3],n[1]]),t.faces.push([n[3],n[2],n[1]]),t;if(5==i.length){var p=n.length;return t.faces.push([n[r],n[(r+2)%p],n[(r+1)%p]]),t.faces.push([n[(r+4)%p],n[(r+3)%p],n[r]]),t.faces.push([n[r],n[(r+3)%p],n[(r+2)%p]]),t}var f=this.center();t.uvs.push(f.uv),t.points.push(f.point),t.normals.push(f.normal);for(var m=t.points.length-1,g=0,v=i.length-1;g<i.length;)t.faces.push([m,n[g],n[v]]),v=g++;return t},__class__:Wt};var Ft=e.exe.Dispatcher=function(){};n["verb.exe.Dispatcher"]=Ft,Ft.__name__=["verb","exe","Dispatcher"],Ft.init=function(){Ft._init||(Ft._workerPool=new Bt(Ft.THREADS),Ft._init=!0)},Ft.dispatchMethod=function(t,e,i){Ft.init();var n=new k;return Ft._workerPool.addWork(f.getClassName(t),e,i,(function(t){n.resolve(t)})),new I(n)};var Bt=e.exe.WorkerPool=function(t,e){null==e&&(e="verb.js"),null==t&&(t=1),this._callbacks=new y,this._working=new y,this._pool=[],this._queue=[];for(var i=0;i<t;){var n;i++;try{n=new Worker(Bt.basePath+e)}catch(t){t instanceof E&&(t=t.val),n=new Worker(Bt.basePath+e.substring(0,-3)+".min.js")}this._pool.push(n)}};n["verb.exe.WorkerPool"]=Bt,Bt.__name__=["verb","exe","WorkerPool"],Bt.prototype={addWork:function(t,e,i,n){var r=new zt(t,e,i);this._callbacks.set(r.id,n),this._queue.push(r),this.processQueue()},processQueue:function(){for(var e=this;this._queue.length>0&&this._pool.length>0;){var i=this._queue.shift(),n=[i.id],r=[this._pool.shift()];this._working.h[n[0]]=r[0],r[0].onmessage=function(i,n){return function(r){e._working.remove(n[0]),e._pool.push(i[0]);try{e._callbacks.h.hasOwnProperty(n[0])&&(e._callbacks.h[n[0]](r.data.result),e._callbacks.remove(n[0]))}catch(e){e instanceof E&&(e=e.val),t.log(e)}e.processQueue()}}(r,n),r[0].postMessage(i)}},__class__:Bt};var zt=function(t,e,i){this.className=t,this.methodName=e,this.args=i,this.id=zt.uuid++};n["verb.exe._WorkerPool.Work"]=zt,zt.__name__=["verb","exe","_WorkerPool","Work"],zt.prototype={__class__:zt};var Vt=function(){};n["verb.geom.ICurve"]=Vt,Vt.__name__=["verb","geom","ICurve"],Vt.__interfaces__=[St],Vt.prototype={__class__:Vt};var Ht=e.geom.NurbsCurve=function(t){this._data=At.isValidNurbsCurveData(t)};n["verb.geom.NurbsCurve"]=Ht,Ht.__name__=["verb","geom","NurbsCurve"],Ht.__interfaces__=[Vt],Ht.byKnotsControlPointsWeights=function(t,e,i,n){return new Ht(new X(t,e.slice(),kt.homogenize1d(i,n)))},Ht.byPoints=function(t,e){return null==e&&(e=3),new Ht(Ot.rationalInterpCurve(t,e))},Ht.__super__=H,Ht.prototype=s(H.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return kt.dehomogenize1d(this._data.controlPoints)},weights:function(){return kt.weight1d(this._data.controlPoints)},asNurbs:function(){return new X(this.degree(),this.knots(),kt.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Ht(this._data)},domain:function(){return new $(F.first(this._data.knots),F.last(this._data.knots))},transform:function(t){return new Ht(Lt.rationalCurveTransform(this._data,t))},transformAsync:function(t){return Ft.dispatchMethod(Lt,"rationalCurveTransform",[this._data,t]).then((function(t){return new Ht(t)}))},point:function(t){return kt.rationalCurvePoint(this._data,t)},pointAsync:function(t){return Ft.dispatchMethod(kt,"rationalCurvePoint",[this._data,t])},tangent:function(t){return kt.rationalCurveTangent(this._data,t)},tangentAsync:function(t){return Ft.dispatchMethod(kt,"rationalCurveTangent",[this._data,t])},derivatives:function(t,e){return null==e&&(e=1),kt.rationalCurveDerivatives(this._data,t,e)},derivativesAsync:function(t,e){return null==e&&(e=1),Ft.dispatchMethod(kt,"rationalCurveDerivatives",[this._data,t,e])},closestPoint:function(t){return Ct.rationalCurveClosestPoint(this._data,t)},closestPointAsync:function(t){return Ft.dispatchMethod(Ct,"rationalCurveClosestPoint",[this._data,t])},closestParam:function(t){return Ct.rationalCurveClosestParam(this._data,t)},closestParamAsync:function(t){return Ft.dispatchMethod(Ct,"rationalCurveClosestParam",[this._data,t])},length:function(){return Ct.rationalCurveArcLength(this._data)},lengthAsync:function(){return Ft.dispatchMethod(Ct,"rationalCurveArcLength",[this._data])},lengthAtParam:function(t){return Ct.rationalCurveArcLength(this._data,t)},lengthAtParamAsync:function(){return Ft.dispatchMethod(Ct,"rationalCurveArcLength",[this._data])},paramAtLength:function(t,e){return Ct.rationalCurveParamAtArcLength(this._data,t,e)},paramAtLengthAsync:function(t,e){return Ft.dispatchMethod(Ct,"rationalCurveParamAtArcLength",[this._data,t,e])},divideByEqualArcLength:function(t){return Dt.rationalCurveByEqualArcLength(this._data,t)},divideByEqualArcLengthAsync:function(t){return Ft.dispatchMethod(Dt,"rationalCurveByEqualArcLength",[this._data,t])},divideByArcLength:function(t){return Dt.rationalCurveByArcLength(this._data,t)},divideByArcLengthAsync:function(t){return Ft.dispatchMethod(Dt,"rationalCurveByArcLength",[this._data,t])},split:function(t){return Dt.curveSplit(this._data,t).map((function(t){return new Ht(t)}))},splitAsync:function(t){return Ft.dispatchMethod(Dt,"curveSplit",[this._data,t]).then((function(t){return t.map((function(t){return new Ht(t)}))}))},reverse:function(){return new Ht(Lt.curveReverse(this._data))},reverseAsync:function(){return Ft.dispatchMethod(Lt,"curveReverse",[this._data]).then((function(t){return new Ht(t)}))},tessellate:function(t){return Ut.rationalCurveAdaptiveSample(this._data,t,!1)},tessellateAsync:function(t){return Ft.dispatchMethod(Ut,"rationalCurveAdaptiveSample",[this._data,t,!1])},__class__:Ht});var Gt=e.geom.Arc=function(t,e,i,n,r,s){Ht.call(this,Ot.arc(t,e,i,n,r,s)),this._center=t,this._xaxis=e,this._yaxis=i,this._radius=n,this._minAngle=r,this._maxAngle=s};n["verb.geom.Arc"]=Gt,Gt.__name__=["verb","geom","Arc"],Gt.__super__=Ht,Gt.prototype=s(Ht.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Gt});var jt=e.geom.BezierCurve=function(t,e){Ht.call(this,Ot.rationalBezierCurve(t,e))};n["verb.geom.BezierCurve"]=jt,jt.__name__=["verb","geom","BezierCurve"],jt.__super__=Ht,jt.prototype=s(Ht.prototype,{__class__:jt});var Xt=e.geom.Circle=function(t,e,i,n){Gt.call(this,t,e,i,n,0,2*Math.PI)};n["verb.geom.Circle"]=Xt,Xt.__name__=["verb","geom","Circle"],Xt.__super__=Gt,Xt.prototype=s(Gt.prototype,{__class__:Xt});var qt=function(){};n["verb.geom.ISurface"]=qt,qt.__name__=["verb","geom","ISurface"],qt.__interfaces__=[St],qt.prototype={__class__:qt};var Yt=e.geom.NurbsSurface=function(t){this._data=At.isValidNurbsSurfaceData(t)};n["verb.geom.NurbsSurface"]=Yt,Yt.__name__=["verb","geom","NurbsSurface"],Yt.__interfaces__=[qt],Yt.byKnotsControlPointsWeights=function(t,e,i,n,r,s){return new Yt(new q(t,e,i,n,kt.homogenize2d(r,s)))},Yt.byCorners=function(t,e,i,n){return new Yt(Ot.fourPointSurface(t,e,i,n))},Yt.byLoftingCurves=function(t,e){return new Yt(Ot.loftedSurface(function(e){for(var i=[],n=0;n<t.length;){var r=t[n];++n,i.push(r.asNurbs())}return i}(),e))},Yt.__super__=H,Yt.prototype=s(H.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return kt.dehomogenize2d(this._data.controlPoints)},weights:function(){return kt.weight2d(this._data.controlPoints)},asNurbs:function(){return new q(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),kt.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Yt(this.asNurbs())},domainU:function(){return new $(F.first(this._data.knotsU),F.last(this._data.knotsU))},domainV:function(){return new $(F.first(this._data.knotsV),F.last(this._data.knotsV))},point:function(t,e){return kt.rationalSurfacePoint(this._data,t,e)},pointAsync:function(t,e){return Ft.dispatchMethod(kt,"rationalSurfacePoint",[this._data,t,e])},normal:function(t,e){return kt.rationalSurfaceNormal(this._data,t,e)},normalAsync:function(t,e){return Ft.dispatchMethod(kt,"rationalSurfaceNormal",[this._data,t,e])},derivatives:function(t,e,i){return null==i&&(i=1),kt.rationalSurfaceDerivatives(this._data,t,e,i)},derivativesAsync:function(t,e,i){return null==i&&(i=1),Ft.dispatchMethod(kt,"rationalSurfaceDerivatives",[this._data,t,e,i])},closestParam:function(t){return Ct.rationalSurfaceClosestParam(this._data,t)},closestParamAsync:function(t){return Ft.dispatchMethod(Ct,"rationalSurfaceClosestParam",[this._data,t])},closestPoint:function(t){return Ct.rationalSurfaceClosestPoint(this._data,t)},closestPointAsync:function(t){return Ft.dispatchMethod(Ct,"rationalSurfaceClosestPoint",[this._data,t])},split:function(t,e){return null==e&&(e=!1),Dt.surfaceSplit(this._data,t,e).map((function(t){return new Yt(t)}))},splitAsync:function(t,e){return null==e&&(e=!1),Ft.dispatchMethod(Dt,"surfaceSplit",[this._data,t,e]).then((function(t){return t.map((function(t){return new Yt(t)}))}))},reverse:function(t){return null==t&&(t=!1),new Yt(Lt.surfaceReverse(this._data,t))},reverseAsync:function(t){return null==t&&(t=!1),Ft.dispatchMethod(Lt,"surfaceReverse",[this._data,t]).then((function(t){return new Yt(t)}))},isocurve:function(t,e){return null==e&&(e=!1),new Ht(Ot.surfaceIsocurve(this._data,t,e))},isocurveAsync:function(t,e){return null==e&&(e=!1),Ft.dispatchMethod(Ot,"surfaceIsocurve",[this._data,t,e]).then((function(t){return new Ht(t)}))},boundaries:function(t){return Ot.surfaceBoundaryCurves(this._data).map((function(t){return new Ht(t)}))},boundariesAsync:function(t){return Ft.dispatchMethod(Ot,"surfaceBoundaryCurves",[this._data]).then((function(t){return t.map((function(t){return new Ht(t)}))}))},tessellate:function(t){return Ut.rationalSurfaceAdaptive(this._data,t)},tessellateAsync:function(t){return Ft.dispatchMethod(Ut,"rationalSurfaceAdaptive",[this._data,t])},transform:function(t){return new Yt(Lt.rationalSurfaceTransform(this._data,t))},transformAsync:function(t){return Ft.dispatchMethod(Lt,"rationalSurfaceTransform",[this._data,t]).then((function(t){return new Yt(t)}))},__class__:Yt});var Zt=e.geom.ConicalSurface=function(t,e,i,n,r){Yt.call(this,Ot.conicalSurface(t,e,i,n,r)),this._axis=t,this._xaxis=e,this._base=i,this._height=n,this._radius=r};n["verb.geom.ConicalSurface"]=Zt,Zt.__name__=["verb","geom","ConicalSurface"],Zt.__super__=Yt,Zt.prototype=s(Yt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Zt});var Kt=e.geom.CylindricalSurface=function(t,e,i,n,r){Yt.call(this,Ot.cylindricalSurface(t,e,i,n,r)),this._axis=t,this._xaxis=e,this._base=i,this._height=n,this._radius=r};n["verb.geom.CylindricalSurface"]=Kt,Kt.__name__=["verb","geom","CylindricalSurface"],Kt.__super__=Yt,Kt.prototype=s(Yt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Kt});var Jt=e.geom.EllipseArc=function(t,e,i,n,r){Ht.call(this,Ot.ellipseArc(t,e,i,n,r)),this._center=t,this._xaxis=e,this._yaxis=i,this._minAngle=n,this._maxAngle=r};n["verb.geom.EllipseArc"]=Jt,Jt.__name__=["verb","geom","EllipseArc"],Jt.__super__=Ht,Jt.prototype=s(Ht.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Jt});var $t=e.geom.Ellipse=function(t,e,i){Jt.call(this,t,e,i,0,2*Math.PI)};n["verb.geom.Ellipse"]=$t,$t.__name__=["verb","geom","Ellipse"],$t.__super__=Jt,$t.prototype=s(Jt.prototype,{__class__:$t});var Qt=e.geom.ExtrudedSurface=function(t,e){Yt.call(this,Ot.extrudedSurface(Et.normalized(e),Et.norm(e),t.asNurbs())),this._profile=t,this._direction=e};n["verb.geom.ExtrudedSurface"]=Qt,Qt.__name__=["verb","geom","ExtrudedSurface"],Qt.__super__=Yt,Qt.prototype=s(Yt.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:Qt});var te=e.geom.Intersect=function(){};n["verb.geom.Intersect"]=te,te.__name__=["verb","geom","Intersect"],te.curves=function(t,e,i){return null==i&&(i=.001),It.curves(t.asNurbs(),e.asNurbs(),i)},te.curvesAsync=function(t,e,i){return null==i&&(i=.001),Ft.dispatchMethod(It,"curves",[t.asNurbs(),e.asNurbs(),i])},te.curveAndSurface=function(t,e,i){return null==i&&(i=.001),It.curveAndSurface(t.asNurbs(),e.asNurbs(),i)},te.curveAndSurfaceAsync=function(t,e,i){return null==i&&(i=.001),Ft.dispatchMethod(It,"curveAndSurface",[t.asNurbs(),e.asNurbs(),i])},te.surfaces=function(t,e,i){return null==i&&(i=.001),It.surfaces(t.asNurbs(),e.asNurbs(),i).map((function(t){return new Ht(t)}))},te.surfacesAsync=function(t,e,i){return null==i&&(i=.001),Ft.dispatchMethod(It,"surfaces",[t.asNurbs(),e.asNurbs(),i]).then((function(t){return t.map((function(t){return new Ht(t)}))}))};var ee=e.geom.Line=function(t,e){Ht.call(this,Ot.polyline([t,e])),this._start=t,this._end=e};n["verb.geom.Line"]=ee,ee.__name__=["verb","geom","Line"],ee.__super__=Ht,ee.prototype=s(Ht.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:ee});var ie=e.geom.RevolvedSurface=function(t,e,i,n){Yt.call(this,Ot.revolvedSurface(t.asNurbs(),e,i,n)),this._profile=t,this._center=e,this._axis=i,this._angle=n};n["verb.geom.RevolvedSurface"]=ie,ie.__name__=["verb","geom","RevolvedSurface"],ie.__super__=Yt,ie.prototype=s(Yt.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:ie});var ne=e.geom.SphericalSurface=function(t,e){Yt.call(this,Ot.sphericalSurface(t,[0,0,1],[1,0,0],e)),this._center=t,this._radius=e};n["verb.geom.SphericalSurface"]=ne,ne.__name__=["verb","geom","SphericalSurface"],ne.__super__=Yt,ne.prototype=s(Yt.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:ne});var re=e.geom.SweptSurface=function(t,e){Yt.call(this,Ot.rationalTranslationalSurface(t.asNurbs(),e.asNurbs())),this._profile=t,this._rail=e};function se(t){return t instanceof Array?function(){return o.iter(t)}:"function"==typeof t.iterator?ce(t,t.iterator):t.iterator}n["verb.geom.SweptSurface"]=re,re.__name__=["verb","geom","SweptSurface"],re.__super__=Yt,re.prototype=s(Yt.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:re});var oe,ae=0;function ce(t,e){return null==e?null:(null==e.__id__&&(e.__id__=ae++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=t,i.method=e,t.hx__closures__[e.__id__]=i),i);var i}n.Math=Math,String.prototype.__class__=n.String=String,String.__name__=["String"],n.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=n.Date=Date,Date.__name__=["Date"];var le=n.Int={__name__:["Int"]},he=n.Dynamic={__name__:["Dynamic"]},ue=n.Float=Number;ue.__name__=["Float"];var de=n.Bool=Boolean;de.__ename__=["Bool"];var pe=n.Class={__name__:["Class"]},fe={};null==Array.prototype.map&&(Array.prototype.map=function(t){for(var e=[],i=0,n=this.length;i<n;){var r=i++;e[r]=t(this[r])}return e}),null==Array.prototype.filter&&(Array.prototype.filter=function(t){for(var e=[],i=0,n=this.length;i<n;){var r=this[i++];t(r)&&e.push(r)}return e});var me={},ge=i.ArrayBuffer||P;null==ge.prototype.slice&&(ge.prototype.slice=P.sliceImpl),i.DataView;var ve=i.Uint8Array||D._new;!function(t,e){if(!t.setImmediate){var i,n=1,r={},s=!1,o=t.document,a=Object.getPrototypeOf&&Object.getPrototypeOf(t);a=a&&a.setTimeout?a:t,"[object process]"==={}.toString.call(t.process)?i=function(){var t=d(arguments);return process.nextTick(p(f,t)),t}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(h="setImmediate$"+Math.random()+"$",u=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(h)&&f(+e.data.slice(h.length))},t.addEventListener?t.addEventListener("message",u,!1):t.attachEvent("onmessage",u),i=function(){var e=d(arguments);return t.postMessage(h+e,"*"),e}):t.MessageChannel?((l=new MessageChannel).port1.onmessage=function(t){f(t.data)},i=function(){var t=d(arguments);return l.port2.postMessage(t),t}):o&&"onreadystatechange"in o.createElement("script")?(c=o.documentElement,i=function(){var t=d(arguments),e=o.createElement("script");return e.onreadystatechange=function(){f(t),e.onreadystatechange=null,c.removeChild(e),e=null},c.appendChild(e),t}):i=function(){var t=d(arguments);return setTimeout(p(f,t),0),t},a.setImmediate=i,a.clearImmediate=m}var c,l,h,u;function d(t){return r[n]=p.apply(e,t),n++}function p(t){var i=[].slice.call(arguments,1);return function(){"function"==typeof t?t.apply(e,i):new Function(""+t)()}}function f(t){if(s)setTimeout(p(f,t),0);else{var e=r[t];if(e){s=!0;try{e()}finally{m(t),s=!1}}}}function m(t){delete r[t]}}(new Function("return this")()),v.USE_CACHE=!1,v.USE_ENUM_INDEX=!1,v.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_.DEFAULT_RESOLVER=f,_.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",x.count=0,T.i64tmp=new g(0,0),C.__toStr={}.toString,D.BYTES_PER_ELEMENT=1,U.queue=new c,B.memo=new y,V.TOLERANCE=1e-6,V.EPSILON=1e-10,V.VERSION="2.0.0",Ct.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],Ct.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Ft.THREADS=1,Ft._init=!1,Bt.basePath="",zt.uuid=0,W.main()}("undefined"!=typeof console?console:{log:function(){}},t,void 0!==r?r:void 0!==e?e:"undefined"!=typeof self?self:this),t}()},725:()=>{},439:()=>{},699:()=>{}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";i.r(n),i.d(n,{Runner:()=>DS,fontsEnum:()=>SS,getRunnerInstance:()=>AS});var t={};i.r(t),i.d(t,{ACESFilmicToneMapping:()=>Yt,AddEquation:()=>pt,AddOperation:()=>Ht,AdditiveAnimationBlendMode:()=>Di,AdditiveBlending:()=>lt,AgXToneMapping:()=>Kt,AlphaFormat:()=>Re,AlwaysCompare:()=>mn,AlwaysDepth:()=>Ot,AlwaysStencilFunc:()=>an,AmbientLight:()=>Du,AnimationAction:()=>xd,AnimationClip:()=>Qh,AnimationLoader:()=>cu,AnimationMixer:()=>Md,AnimationObjectGroup:()=>yd,AnimationUtils:()=>Bh,ArcCurve:()=>ul,ArrayCamera:()=>Ku,ArrowHelper:()=>vp,AttachedBindMode:()=>$t,Audio:()=>rd,AudioAnalyser:()=>hd,AudioContext:()=>Gu,AudioListener:()=>nd,AudioLoader:()=>ju,AxesHelper:()=>_p,BackSide:()=>st,BasicDepthPacking:()=>Oi,BasicShadowMap:()=>tt,BatchedMesh:()=>bc,Bone:()=>Ia,BooleanKeyframeTrack:()=>Xh,Box2:()=>Wd,Box3:()=>wr,Box3Helper:()=>dp,BoxGeometry:()=>Oo,BoxHelper:()=>up,BufferAttribute:()=>io,BufferGeometry:()=>xo,BufferGeometryLoader:()=>Nu,ByteType:()=>xe,Cache:()=>eu,Camera:()=>Bo,CameraHelper:()=>cp,CanvasTexture:()=>Zc,CapsuleGeometry:()=>$c,CatmullRomCurve3:()=>vl,CineonToneMapping:()=>qt,CircleGeometry:()=>Qc,ClampToEdgeWrapping:()=>ae,Clock:()=>Ju,Color:()=>Hs,ColorKeyframeTrack:()=>qh,ColorManagement:()=>nr,CompressedArrayTexture:()=>qc,CompressedCubeTexture:()=>Yc,CompressedTexture:()=>Xc,CompressedTextureLoader:()=>lu,ConeGeometry:()=>el,ConstantAlphaFactor:()=>Rt,ConstantColorFactor:()=>At,Controls:()=>xp,CubeCamera:()=>Xo,CubeReflectionMapping:()=>ee,CubeRefractionMapping:()=>ie,CubeTexture:()=>qo,CubeTextureLoader:()=>uu,CubeUVReflectionMapping:()=>se,CubicBezierCurve:()=>bl,CubicBezierCurve3:()=>Ml,CubicInterpolant:()=>Vh,CullFaceBack:()=>J,CullFaceFront:()=>$,CullFaceFrontBack:()=>Q,CullFaceNone:()=>K,Curve:()=>ll,CurvePath:()=>Al,CustomBlending:()=>dt,CustomToneMapping:()=>Zt,CylinderGeometry:()=>tl,Cylindrical:()=>Ld,Data3DTexture:()=>_r,DataArrayTexture:()=>gr,DataTexture:()=>Oa,DataTextureLoader:()=>du,DataUtils:()=>$s,DecrementStencilOp:()=>Zi,DecrementWrapStencilOp:()=>Ji,DefaultLoadingManager:()=>nu,DepthArrayTexture:()=>Jc,DepthFormat:()=>Oe,DepthStencilFormat:()=>Le,DepthTexture:()=>Kc,DetachedBindMode:()=>Qt,DirectionalLight:()=>Au,DirectionalLightHelper:()=>sp,DiscreteInterpolant:()=>Gh,DodecahedronGeometry:()=>nl,DoubleSide:()=>ot,DstAlphaFactor:()=>wt,DstColorFactor:()=>Et,DynamicCopyUsage:()=>Sn,DynamicDrawUsage:()=>vn,DynamicReadUsage:()=>xn,EdgesGeometry:()=>cl,EllipseCurve:()=>hl,EqualCompare:()=>hn,EqualDepth:()=>Nt,EqualStencilFunc:()=>en,EquirectangularReflectionMapping:()=>ne,EquirectangularRefractionMapping:()=>re,Euler:()=>as,EventDispatcher:()=>kn,ExtrudeGeometry:()=>ah,FileLoader:()=>au,Float16BufferAttribute:()=>ho,Float32BufferAttribute:()=>uo,FloatType:()=>Te,Fog:()=>Qo,FogExp2:()=>$o,FramebufferTexture:()=>jc,FrontSide:()=>rt,Frustum:()=>Qa,FrustumArray:()=>ic,GLBufferAttribute:()=>Ad,GLSL1:()=>Tn,GLSL3:()=>En,GreaterCompare:()=>dn,GreaterDepth:()=>Ft,GreaterEqualCompare:()=>fn,GreaterEqualDepth:()=>Wt,GreaterEqualStencilFunc:()=>on,GreaterStencilFunc:()=>rn,GridHelper:()=>tp,Group:()=>Zo,HalfFloatType:()=>Ee,HemisphereLight:()=>mu,HemisphereLightHelper:()=>Qd,IcosahedronGeometry:()=>lh,ImageBitmapLoader:()=>Vu,ImageLoader:()=>hu,ImageUtils:()=>ar,IncrementStencilOp:()=>Yi,IncrementWrapStencilOp:()=>Ki,InstancedBufferAttribute:()=>Wa,InstancedBufferGeometry:()=>Uu,InstancedInterleavedBuffer:()=>Pd,InstancedMesh:()=>Xa,Int16BufferAttribute:()=>oo,Int32BufferAttribute:()=>co,Int8BufferAttribute:()=>no,IntType:()=>Se,InterleavedBuffer:()=>ea,InterleavedBufferAttribute:()=>na,Interpolant:()=>zh,InterpolateDiscrete:()=>Si,InterpolateLinear:()=>wi,InterpolateSmooth:()=>Ti,InterpolationSamplingMode:()=>Rn,InterpolationSamplingType:()=>Dn,InvertStencilOp:()=>$i,KeepStencilOp:()=>Xi,KeyframeTrack:()=>jh,LOD:()=>Ma,LatheGeometry:()=>hh,Layers:()=>cs,LessCompare:()=>ln,LessDepth:()=>Lt,LessEqualCompare:()=>un,LessEqualDepth:()=>Ut,LessEqualStencilFunc:()=>nn,LessStencilFunc:()=>tn,Light:()=>fu,LightProbe:()=>Iu,Line:()=>Dc,Line3:()=>zd,LineBasicMaterial:()=>Mc,LineCurve:()=>Sl,LineCurve3:()=>wl,LineDashedMaterial:()=>Oh,LineLoop:()=>Lc,LineSegments:()=>Oc,LinearFilter:()=>fe,LinearInterpolant:()=>Hh,LinearMipMapLinearFilter:()=>_e,LinearMipMapNearestFilter:()=>ge,LinearMipmapLinearFilter:()=>ve,LinearMipmapNearestFilter:()=>me,LinearSRGBColorSpace:()=>Vi,LinearToneMapping:()=>jt,LinearTransfer:()=>Hi,Loader:()=>ru,LoaderUtils:()=>Lu,LoadingManager:()=>iu,LoopOnce:()=>xi,LoopPingPong:()=>Mi,LoopRepeat:()=>bi,MOUSE:()=>Y,Material:()=>Xs,MaterialLoader:()=>Ou,MathUtils:()=>Hn,Matrix2:()=>Ud,Matrix3:()=>jn,Matrix4:()=>Jr,MaxEquation:()=>vt,Mesh:()=>ko,MeshBasicMaterial:()=>qs,MeshDepthMaterial:()=>Rh,MeshDistanceMaterial:()=>kh,MeshLambertMaterial:()=>Dh,MeshMatcapMaterial:()=>Ih,MeshNormalMaterial:()=>Ah,MeshPhongMaterial:()=>Ch,MeshPhysicalMaterial:()=>Eh,MeshStandardMaterial:()=>Th,MeshToonMaterial:()=>Ph,MinEquation:()=>gt,MirroredRepeatWrapping:()=>ce,MixOperation:()=>Vt,MultiplyBlending:()=>ut,MultiplyOperation:()=>zt,NearestFilter:()=>le,NearestMipMapLinearFilter:()=>pe,NearestMipMapNearestFilter:()=>ue,NearestMipmapLinearFilter:()=>de,NearestMipmapNearestFilter:()=>he,NeutralToneMapping:()=>Jt,NeverCompare:()=>cn,NeverDepth:()=>It,NeverStencilFunc:()=>Qi,NoBlending:()=>at,NoColorSpace:()=>Bi,NoToneMapping:()=>Gt,NormalAnimationBlendMode:()=>Ai,NormalBlending:()=>ct,NotEqualCompare:()=>pn,NotEqualDepth:()=>Bt,NotEqualStencilFunc:()=>sn,NumberKeyframeTrack:()=>Yh,Object3D:()=>ws,ObjectLoader:()=>Wu,ObjectSpaceNormalMap:()=>Fi,OctahedronGeometry:()=>uh,OneFactor:()=>yt,OneMinusConstantAlphaFactor:()=>kt,OneMinusConstantColorFactor:()=>Dt,OneMinusDstAlphaFactor:()=>Tt,OneMinusDstColorFactor:()=>Ct,OneMinusSrcAlphaFactor:()=>St,OneMinusSrcColorFactor:()=>bt,OrthographicCamera:()=>Cu,PCFShadowMap:()=>et,PCFSoftShadowMap:()=>it,PMREMGenerator:()=>Yp,Path:()=>Dl,PerspectiveCamera:()=>Go,Plane:()=>Ka,PlaneGeometry:()=>dh,PlaneHelper:()=>pp,PointLight:()=>Eu,PointLightHelper:()=>Zd,Points:()=>zc,PointsMaterial:()=>Uc,PolarGridHelper:()=>ep,PolyhedronGeometry:()=>il,PositionalAudio:()=>ld,PropertyBinding:()=>_d,PropertyMixer:()=>ud,QuadraticBezierCurve:()=>Tl,QuadraticBezierCurve3:()=>El,Quaternion:()=>xr,QuaternionKeyframeTrack:()=>Kh,QuaternionLinearInterpolant:()=>Zh,RED_GREEN_RGTC2_Format:()=>_i,RED_RGTC1_Format:()=>gi,REVISION:()=>q,RGBADepthPacking:()=>Li,RGBAFormat:()=>Ie,RGBAIntegerFormat:()=>ze,RGBA_ASTC_10x10_Format:()=>hi,RGBA_ASTC_10x5_Format:()=>ai,RGBA_ASTC_10x6_Format:()=>ci,RGBA_ASTC_10x8_Format:()=>li,RGBA_ASTC_12x10_Format:()=>ui,RGBA_ASTC_12x12_Format:()=>di,RGBA_ASTC_4x4_Format:()=>Qe,RGBA_ASTC_5x4_Format:()=>ti,RGBA_ASTC_5x5_Format:()=>ei,RGBA_ASTC_6x5_Format:()=>ii,RGBA_ASTC_6x6_Format:()=>ni,RGBA_ASTC_8x5_Format:()=>ri,RGBA_ASTC_8x6_Format:()=>si,RGBA_ASTC_8x8_Format:()=>oi,RGBA_BPTC_Format:()=>pi,RGBA_ETC2_EAC_Format:()=>$e,RGBA_PVRTC_2BPPV1_Format:()=>Ze,RGBA_PVRTC_4BPPV1_Format:()=>Ye,RGBA_S3TC_DXT1_Format:()=>He,RGBA_S3TC_DXT3_Format:()=>Ge,RGBA_S3TC_DXT5_Format:()=>je,RGBDepthPacking:()=>Ui,RGBFormat:()=>ke,RGBIntegerFormat:()=>Be,RGB_BPTC_SIGNED_Format:()=>fi,RGB_BPTC_UNSIGNED_Format:()=>mi,RGB_ETC1_Format:()=>Ke,RGB_ETC2_Format:()=>Je,RGB_PVRTC_2BPPV1_Format:()=>qe,RGB_PVRTC_4BPPV1_Format:()=>Xe,RGB_S3TC_DXT1_Format:()=>Ve,RGDepthPacking:()=>Ni,RGFormat:()=>We,RGIntegerFormat:()=>Fe,RawShaderMaterial:()=>wh,Ray:()=>Kr,Raycaster:()=>Rd,RectAreaLight:()=>Ru,RedFormat:()=>Ue,RedIntegerFormat:()=>Ne,ReinhardToneMapping:()=>Xt,RenderTarget:()=>fr,RenderTarget3D:()=>Sd,RenderTargetArray:()=>wd,RepeatWrapping:()=>oe,ReplaceStencilOp:()=>qi,ReverseSubtractEquation:()=>mt,RingGeometry:()=>ph,SIGNED_RED_GREEN_RGTC2_Format:()=>yi,SIGNED_RED_RGTC1_Format:()=>vi,SRGBColorSpace:()=>zi,SRGBTransfer:()=>Gi,Scene:()=>ta,ShaderChunk:()=>Tp,ShaderLib:()=>Cp,ShaderMaterial:()=>Fo,ShadowMaterial:()=>Sh,Shape:()=>Rl,ShapeGeometry:()=>fh,ShapePath:()=>yp,ShapeUtils:()=>rh,ShortType:()=>be,Skeleton:()=>Na,SkeletonHelper:()=>qd,SkinnedMesh:()=>ka,Source:()=>lr,Sphere:()=>Vr,SphereGeometry:()=>mh,Spherical:()=>Od,SphericalHarmonics3:()=>ku,SplineCurve:()=>Cl,SpotLight:()=>bu,SpotLightHelper:()=>Hd,Sprite:()=>_a,SpriteMaterial:()=>ra,SrcAlphaFactor:()=>Mt,SrcAlphaSaturateFactor:()=>Pt,SrcColorFactor:()=>xt,StaticCopyUsage:()=>Mn,StaticDrawUsage:()=>gn,StaticReadUsage:()=>yn,StereoCamera:()=>Zu,StreamCopyUsage:()=>wn,StreamDrawUsage:()=>_n,StreamReadUsage:()=>bn,StringKeyframeTrack:()=>Jh,SubtractEquation:()=>ft,SubtractiveBlending:()=>ht,TOUCH:()=>Z,TangentSpaceNormalMap:()=>Wi,TetrahedronGeometry:()=>gh,Texture:()=>dr,TextureLoader:()=>pu,TextureUtils:()=>Mp,TimestampQuery:()=>An,TorusGeometry:()=>vh,TorusKnotGeometry:()=>_h,Triangle:()=>Ws,TriangleFanDrawMode:()=>Ii,TriangleStripDrawMode:()=>ki,TrianglesDrawMode:()=>Ri,TubeGeometry:()=>yh,UVMapping:()=>te,Uint16BufferAttribute:()=>ao,Uint32BufferAttribute:()=>lo,Uint8BufferAttribute:()=>ro,Uint8ClampedBufferAttribute:()=>so,Uniform:()=>Td,UniformsGroup:()=>Cd,UniformsLib:()=>Ep,UniformsUtils:()=>Wo,UnsignedByteType:()=>ye,UnsignedInt248Type:()=>Ae,UnsignedInt5999Type:()=>De,UnsignedIntType:()=>we,UnsignedShort4444Type:()=>Ce,UnsignedShort5551Type:()=>Pe,UnsignedShortType:()=>Me,VSMShadowMap:()=>nt,Vector2:()=>Gn,Vector3:()=>br,Vector4:()=>pr,VectorKeyframeTrack:()=>$h,VideoFrameTexture:()=>Gc,VideoTexture:()=>Hc,WebGL3DRenderTarget:()=>yr,WebGLArrayRenderTarget:()=>vr,WebGLCoordinateSystem:()=>Cn,WebGLCubeRenderTarget:()=>Yo,WebGLRenderTarget:()=>mr,WebGLRenderer:()=>rg,WebGLUtils:()=>Jm,WebGPUCoordinateSystem:()=>Pn,WebXRController:()=>Jo,WireframeGeometry:()=>xh,WrapAroundEnding:()=>Pi,ZeroCurvatureEnding:()=>Ei,ZeroFactor:()=>_t,ZeroSlopeEnding:()=>Ci,ZeroStencilOp:()=>ji,createCanvasElement:()=>Jn});var e={};i.r(e),i.d(e,{LodDto:()=>tx,lodEnum:()=>jy});var r={};i.r(r),i.d(r,{Part:()=>ex});var s={};i.r(s),i.d(s,{SerenitySwirlData:()=>nx,SerenitySwirlDto:()=>ix});var o={};i.r(o),i.d(o,{ArabicArchwayData:()=>ox,ArabicArchwayDrawingPart:()=>ax,ArabicArchwayDrawingPartShapes:()=>cx,ArabicArchwayDto:()=>sx,ArabicArchwayDtoBase:()=>rx});var a={};i.r(a),i.d(a,{ArabicArchway:()=>o,SerenitySwirl:()=>s});var c={};i.r(c),i.d(c,{EternalLoveData:()=>ux,EternalLoveDto:()=>hx,EternalLoveDtoBase:()=>lx});var l={};i.r(l),i.d(l,{EternalLove:()=>c});var h={};i.r(h),i.d(h,{CalmCupData:()=>fx,CalmCupDto:()=>px,CalmCupDtoBase:()=>dx});var u={};i.r(u),i.d(u,{DragonCupData:()=>vx,DragonCupDto:()=>gx,DragonCupDtoBase:()=>mx,DragonCupModelDto:()=>_x});var d={};i.r(d),i.d(d,{CalmCup:()=>h,DragonCup:()=>u});var p={};i.r(p),i.d(p,{PhoneNestData:()=>bx,PhoneNestDrawDto:()=>Ex,PhoneNestDrawingPart:()=>Mx,PhoneNestDrawingPartShapes:()=>Sx,PhoneNestDto:()=>xx,PhoneNestDtoBase:()=>yx,PhoneNestMainPart:()=>wx,PhoneNestModelDto:()=>Tx});var f={};i.r(f),i.d(f,{PhoneNest:()=>p});var m={};i.r(m),i.d(m,{SpicyBoxData:()=>Ax,SpicyBoxDto:()=>Px,SpicyBoxDtoBase:()=>Cx,SpicyBoxModelDto:()=>Dx});var g={};i.r(g),i.d(g,{SpicyBox:()=>m});var v={};i.r(v),i.d(v,{Boxes:()=>g,Cups:()=>d,Desktop:()=>f,Medals:()=>l,Vases:()=>a});var _={};i.r(_),i.d(_,{DropletsPhoneHolderData:()=>Ux,DropletsPhoneHolderDrawingPart:()=>Nx,DropletsPhoneHolderDrawingPartShapes:()=>Wx,DropletsPhoneHolderDto:()=>kx,DropletsPhoneHolderDtoBase:()=>Rx,DropletsPhoneHolderModelDto:()=>Ix,DropletsPhoneHolderModelDxfDto:()=>Ox,DropletsPhoneHolderModelStepDto:()=>Lx});var y={};i.r(y),i.d(y,{DropletsPhoneHolder:()=>_});var x={};i.r(x),i.d(x,{Gadgets:()=>y});var b={};i.r(b),i.d(b,{ZenHideoutData:()=>zx,ZenHideoutDrawingPart:()=>Vx,ZenHideoutDrawingPartShapes:()=>Hx,ZenHideoutDto:()=>Bx,ZenHideoutDtoBase:()=>Fx});var M={};i.r(M),i.d(M,{ZenHideout:()=>b});var S={};i.r(S),i.d(S,{BeamPart:()=>tb,CeilingPart:()=>lb,ColumnPart:()=>Qx,CornerEntranceDto:()=>ub,CornerEntrancePart:()=>ob,CornerPart:()=>$x,CornerStairDto:()=>rb,CornerStairPart:()=>sb,FloorPart:()=>hb,Houses:()=>M,RoofBeamsPart:()=>ib,RoofCoverOneSidedDto:()=>ab,RoofCoverPart:()=>cb,RoofPanelPart:()=>nb,RoofPart:()=>eb,SandwitchPanelDto:()=>Yx,SandwitchPanelFlexDto:()=>Zx,SandwitchPart:()=>Kx,SandwitchPartFlex:()=>Jx,WindowCornerDto:()=>Gx,WindowCornerPart:()=>qx,WindowRectangularDto:()=>jx,WindowRectangularPart:()=>Xx});var w={};i.r(w),i.d(w,{WingtipVillaData:()=>pb,WingtipVillaDto:()=>db});var T={};i.r(T),i.d(T,{ChirpyChaletData:()=>mb,ChirpyChaletDto:()=>fb});var E={};i.r(E),i.d(E,{ChirpyChalet:()=>T,WingtipVilla:()=>w});var C={};i.r(C),i.d(C,{BirdHouses:()=>E});var P={};i.r(P),i.d(P,{SnakeChairData:()=>_b,SnakeChairDrawDto:()=>Sb,SnakeChairDrawingPart:()=>yb,SnakeChairDrawingPartShapes:()=>xb,SnakeChairDto:()=>vb,SnakeChairDtoBase:()=>gb,SnakeChairMainPart:()=>bb,SnakeChairModelDto:()=>Mb});var A={};i.r(A),i.d(A,{SnakeChair:()=>P});var D={};i.r(D),i.d(D,{ElegantTableData:()=>Eb,ElegantTableDrawDto:()=>Ib,ElegantTableDrawingPart:()=>Cb,ElegantTableDrawingPartShapes:()=>Pb,ElegantTableDto:()=>Tb,ElegantTableDtoBase:()=>wb,ElegantTableLegByIndexDto:()=>Rb,ElegantTableLegPart:()=>Ab,ElegantTableModelDto:()=>kb,ElegantTableTopPart:()=>Db});var R={};i.r(R),i.d(R,{GoodCoffeeTableData:()=>Ub,GoodCoffeeTableDrawDto:()=>Gb,GoodCoffeeTableDrawingPart:()=>Nb,GoodCoffeeTableDrawingPartShapes:()=>Wb,GoodCoffeeTableDto:()=>Lb,GoodCoffeeTableDtoBase:()=>Ob,GoodCoffeeTableLegByIndexDto:()=>Vb,GoodCoffeeTableLegPart:()=>Fb,GoodCoffeeTableModelDto:()=>Hb,GoodCoffeeTableShelfPart:()=>Bb,GoodCoffeeTableTopPart:()=>zb});var k={};i.r(k),i.d(k,{SnakeTableData:()=>qb,SnakeTableDrawDto:()=>$b,SnakeTableDrawingPart:()=>Yb,SnakeTableDrawingPartShapes:()=>Zb,SnakeTableDto:()=>Xb,SnakeTableDtoBase:()=>jb,SnakeTableMainPart:()=>Kb,SnakeTableModelDto:()=>Jb});var I={};i.r(I),i.d(I,{ElegantTable:()=>D,GoodCoffeeTable:()=>R,SnakeTable:()=>k});var O={};i.r(O),i.d(O,{Chairs:()=>A,Tables:()=>I});var L={};i.r(L),i.d(L,{Architecture:()=>S,Enums:()=>e,Furniture:()=>O,KidsCorner:()=>C,LaserCutting:()=>x,Shared:()=>r,ThreeDPrinting:()=>v});var U={};i.r(U),i.d(U,{FontDefinition:()=>rM,Text3DData:()=>iM,Text3DDto:()=>tM,Text3DFaceDefinitionDto:()=>oM,Text3DFaceDto:()=>eM,Text3DLetterByIndexDto:()=>nM,Text3DModelDto:()=>sM,Texts3DFaceDto:()=>aM,faceTextVarEnum:()=>Yy,faceTypeEnum:()=>Zy,fontVariantsEnum:()=>qy,fontsEnum:()=>Xy,fontsModel:()=>Qb,recAlignmentEnum:()=>Ky});var N={};i.r(N),i.d(N,{PyramidSimpeByIndexDto:()=>uM,PyramidSimpleAffectorsDto:()=>lM,PyramidSimpleCellPart:()=>xM,PyramidSimpleData:()=>hM,PyramidSimpleDto:()=>cM,PyramidSimpleFacePart:()=>bM,PyramidSimpleModelCellDto:()=>mM,PyramidSimpleModelCellsDto:()=>pM,PyramidSimpleModelCellsIndexDto:()=>fM,PyramidSimpleModelDto:()=>dM,PyramidSimpleModelFaceCellIndexDto:()=>vM,PyramidSimpleModelFaceCellsUIndexDto:()=>_M,PyramidSimpleModelFaceCellsVIndexDto:()=>yM,PyramidSimpleModelFaceIndexDto:()=>gM});var W={};i.r(W),i.d(W,{PyramidSimple:()=>N});var F={};i.r(F),i.d(F,{FacePatterns:()=>W});var B={};i.r(B),i.d(B,{outputShapeEnum:()=>MM});var z={};i.r(z),i.d(z,{Enums:()=>B,Patterns:()=>F,Text3D:()=>U});var V={};i.r(V),i.d(V,{VectorCharData:()=>kM,VectorTextData:()=>IM});var H={};i.r(H),i.d(H,{HexGridData:()=>OM});var G={};i.r(G),i.d(G,{ObjectDefinition:()=>UM,ShapeWithId:()=>LM,TextWiresCharShapePart:()=>WM,TextWiresDataDto:()=>NM});var j={};i.r(j),i.d(j,{OCCT:()=>G,Point:()=>H,Text:()=>V,renderableModels:()=>EM});var X={};i.r(X),i.d(X,{Asset:()=>Zv,Color:()=>pv,Dates:()=>xv,Draw:()=>y_,JSCAD:()=>t_,JSON:()=>Kv,Line:()=>bv,Lists:()=>fv,Logic:()=>mv,Manifold:()=>e_,Math:()=>gv,Mesh:()=>Sv,OCCT:()=>uv,Point:()=>vv,Polyline:()=>Mv,Tag:()=>Jv,Text:()=>_v,Time:()=>$v,Transforms:()=>yv,Vector:()=>wv,Verb:()=>Qv});const q="176",Y={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Z={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},K=0,J=1,$=2,Q=3,tt=0,et=1,it=2,nt=3,rt=0,st=1,ot=2,at=0,ct=1,lt=2,ht=3,ut=4,dt=5,pt=100,ft=101,mt=102,gt=103,vt=104,_t=200,yt=201,xt=202,bt=203,Mt=204,St=205,wt=206,Tt=207,Et=208,Ct=209,Pt=210,At=211,Dt=212,Rt=213,kt=214,It=0,Ot=1,Lt=2,Ut=3,Nt=4,Wt=5,Ft=6,Bt=7,zt=0,Vt=1,Ht=2,Gt=0,jt=1,Xt=2,qt=3,Yt=4,Zt=5,Kt=6,Jt=7,$t="attached",Qt="detached",te=300,ee=301,ie=302,ne=303,re=304,se=306,oe=1e3,ae=1001,ce=1002,le=1003,he=1004,ue=1004,de=1005,pe=1005,fe=1006,me=1007,ge=1007,ve=1008,_e=1008,ye=1009,xe=1010,be=1011,Me=1012,Se=1013,we=1014,Te=1015,Ee=1016,Ce=1017,Pe=1018,Ae=1020,De=35902,Re=1021,ke=1022,Ie=1023,Oe=1026,Le=1027,Ue=1028,Ne=1029,We=1030,Fe=1031,Be=1032,ze=1033,Ve=33776,He=33777,Ge=33778,je=33779,Xe=35840,qe=35841,Ye=35842,Ze=35843,Ke=36196,Je=37492,$e=37496,Qe=37808,ti=37809,ei=37810,ii=37811,ni=37812,ri=37813,si=37814,oi=37815,ai=37816,ci=37817,li=37818,hi=37819,ui=37820,di=37821,pi=36492,fi=36494,mi=36495,gi=36283,vi=36284,_i=36285,yi=36286,xi=2200,bi=2201,Mi=2202,Si=2300,wi=2301,Ti=2302,Ei=2400,Ci=2401,Pi=2402,Ai=2500,Di=2501,Ri=0,ki=1,Ii=2,Oi=3200,Li=3201,Ui=3202,Ni=3203,Wi=0,Fi=1,Bi="",zi="srgb",Vi="srgb-linear",Hi="linear",Gi="srgb",ji=0,Xi=7680,qi=7681,Yi=7682,Zi=7683,Ki=34055,Ji=34056,$i=5386,Qi=512,tn=513,en=514,nn=515,rn=516,sn=517,on=518,an=519,cn=512,ln=513,hn=514,un=515,dn=516,pn=517,fn=518,mn=519,gn=35044,vn=35048,_n=35040,yn=35045,xn=35049,bn=35041,Mn=35046,Sn=35050,wn=35042,Tn="100",En="300 es",Cn=2e3,Pn=2001,An={COMPUTE:"compute",RENDER:"render"},Dn={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Rn={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FLAT_FIRST:"flat first",FLAT_EITHER:"flat either"};class kn{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return void 0!==i&&void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){const i=this._listeners;if(void 0===i)return;const n=i[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const i=e[t.type];if(void 0!==i){t.target=this;const e=i.slice(0);for(let i=0,n=e.length;i<n;i++)e[i].call(this,t);t.target=null}}}const In=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let On=1234567;const Ln=Math.PI/180,Un=180/Math.PI;function Nn(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(In[255&t]+In[t>>8&255]+In[t>>16&255]+In[t>>24&255]+"-"+In[255&e]+In[e>>8&255]+"-"+In[e>>16&15|64]+In[e>>24&255]+"-"+In[63&i|128]+In[i>>8&255]+"-"+In[i>>16&255]+In[i>>24&255]+In[255&n]+In[n>>8&255]+In[n>>16&255]+In[n>>24&255]).toLowerCase()}function Wn(t,e,i){return Math.max(e,Math.min(i,t))}function Fn(t,e){return(t%e+e)%e}function Bn(t,e,i){return(1-i)*t+i*e}function zn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Vn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Hn={DEG2RAD:Ln,RAD2DEG:Un,generateUUID:Nn,clamp:Wn,euclideanModulo:Fn,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:Bn,damp:function(t,e,i,n){return Bn(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Fn(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(On=t);let e=On+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Ln},radToDeg:function(t){return t*Un},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),c=o(i/2),l=s((e+n)/2),h=o((e+n)/2),u=s((e-n)/2),d=o((e-n)/2),p=s((n-e)/2),f=o((n-e)/2);switch(r){case"XYX":t.set(a*h,c*u,c*d,a*l);break;case"YZY":t.set(c*d,a*h,c*u,a*l);break;case"ZXZ":t.set(c*u,c*d,a*h,a*l);break;case"XZX":t.set(a*h,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*h,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Vn,denormalize:zn};class Gn{constructor(t=0,e=0){Gn.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Wn(this.x,t.x,e.x),this.y=Wn(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=Wn(this.x,t,e),this.y=Wn(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Wn(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Wn(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class jn{constructor(t,e,i,n,r,s,o,a,c){jn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,n,r,s,o,a,c)}set(t,e,i,n,r,s,o,a,c){const l=this.elements;return l[0]=t,l[1]=n,l[2]=o,l[3]=e,l[4]=r,l[5]=a,l[6]=i,l[7]=s,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],c=i[1],l=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],_=n[4],y=n[7],x=n[2],b=n[5],M=n[8];return r[0]=s*f+o*v+a*x,r[3]=s*m+o*_+a*b,r[6]=s*g+o*y+a*M,r[1]=c*f+l*v+h*x,r[4]=c*m+l*_+h*b,r[7]=c*g+l*y+h*M,r[2]=u*f+d*v+p*x,r[5]=u*m+d*_+p*b,r[8]=u*g+d*y+p*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*s*l-e*o*c-i*r*l+i*o*a+n*r*c-n*s*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=l*s-o*c,u=o*a-l*r,d=c*r-s*a,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(n*c-l*i)*f,t[2]=(o*i-n*s)*f,t[3]=u*f,t[4]=(l*e-n*a)*f,t[5]=(n*r-o*e)*f,t[6]=d*f,t[7]=(i*a-c*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,o){const a=Math.cos(r),c=Math.sin(r);return this.set(i*a,i*c,-i*(a*s+c*o)+s+t,-n*c,n*a,-n*(-c*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Xn.makeScale(t,e)),this}rotate(t){return this.premultiply(Xn.makeRotation(-t)),this}translate(t,e){return this.premultiply(Xn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Xn=new jn;function qn(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const Yn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Zn(t,e){return new Yn[t](e)}function Kn(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Jn(){const t=Kn("canvas");return t.style.display="block",t}const $n={};function Qn(t){t in $n||($n[t]=!0,console.warn(t))}const tr=(new jn).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),er=(new jn).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ir(){const t={enabled:!0,workingColorSpace:Vi,spaces:{},convert:function(t,e,i){return!1!==this.enabled&&e!==i&&e&&i?(this.spaces[e].transfer===Gi&&(t.r=rr(t.r),t.g=rr(t.g),t.b=rr(t.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===Gi&&(t.r=sr(t.r),t.g=sr(t.g),t.b=sr(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Bi?Hi:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,i){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[Vi]:{primaries:e,whitePoint:n,transfer:Hi,toXYZ:tr,fromXYZ:er,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:zi},outputColorSpaceConfig:{drawingBufferColorSpace:zi}},[zi]:{primaries:e,whitePoint:n,transfer:Gi,toXYZ:tr,fromXYZ:er,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:zi}}}),t}const nr=ir();function rr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function sr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let or;class ar{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{void 0===or&&(or=Kn("canvas")),or.width=t.width,or.height=t.height;const e=or.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),i=or}return i.toDataURL(e)}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Kn("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*rr(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*rr(e[t]/255)):e[t]=rr(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let cr=0;class lr{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:cr++}),this.uuid=Nn(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(hr(n[e].image)):t.push(hr(n[e]))}else t=hr(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function hr(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ar.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ur=0;class dr extends kn{constructor(t=dr.DEFAULT_IMAGE,e=dr.DEFAULT_MAPPING,i=ae,n=ae,r=fe,s=ve,o=Ie,a=ye,c=dr.DEFAULT_ANISOTROPY,l=Bi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ur++}),this.uuid=Nn(),this.name="",this.source=new lr(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Gn(0,0),this.repeat=new Gn(1,1),this.center=new Gn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isTextureArray=t.isTextureArray,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==te)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case oe:t.x=t.x-Math.floor(t.x);break;case ae:t.x=t.x<0?0:1;break;case ce:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case oe:t.y=t.y-Math.floor(t.y);break;case ae:t.y=t.y<0?0:1;break;case ce:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}dr.DEFAULT_IMAGE=null,dr.DEFAULT_MAPPING=te,dr.DEFAULT_ANISOTROPY=1;class pr{constructor(t=0,e=0,i=0,n=1){pr.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,o=.1,a=t.elements,c=a[0],l=a[4],h=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(l-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(l+u)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(c+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(c+1)/2,a=(d+1)/2,v=(g+1)/2,_=(l+u)/4,y=(h+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=_/i,r=y/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=_/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=y/r,n=x/r),this.set(i,n,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-l)*(u-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-l)/v,this.w=Math.acos((c+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Wn(this.x,t.x,e.x),this.y=Wn(this.y,t.y,e.y),this.z=Wn(this.z,t.z,e.z),this.w=Wn(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=Wn(this.x,t,e),this.y=Wn(this.y,t,e),this.z=Wn(this.z,t,e),this.w=Wn(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Wn(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fr extends kn{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=i.depth?i.depth:1,this.scissor=new pr(0,0,t,e),this.scissorTest=!1,this.viewport=new pr(0,0,t,e);const n={width:t,height:e,depth:this.depth};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:fe,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},i);const r=new dr(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const s=i.count;for(let t=0;t<s;t++)this.textures[t]=r.clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=t,this.textures[n].image.height=e,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,i=t.textures.length;e<i;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const i=Object.assign({},t.textures[e].image);this.textures[e].source=new lr(i)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class mr extends fr{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class gr extends dr{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class vr extends mr{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new gr(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class _r extends dr{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yr extends mr{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new _r(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class xr{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,r,s,o){let a=i[n+0],c=i[n+1],l=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=c,t[e+2]=l,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||c!==d||l!==p){let t=1-o;const e=a*u+c*d+l*p+h*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*t+u*r,c=c*t+d*r,l=l*t+p*r,h=h*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+c*c+l*l+h*h);a*=t,c*=t,l*=t,h*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const o=i[n],a=i[n+1],c=i[n+2],l=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+l*h+a*d-c*u,t[e+1]=a*p+l*u+c*h-o*d,t[e+2]=c*p+l*d+o*u-a*h,t[e+3]=l*p-o*h-a*u-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,n=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,c=o(i/2),l=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),p=a(r/2);switch(s){case"XYZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"YXZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"ZXY":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"ZYX":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"YZX":this._x=u*l*h+c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h-u*d*p;break;case"XZY":this._x=u*l*h-c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],o=e[5],a=e[9],c=e[2],l=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(r-c)*t,this._z=(s-n)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(l-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+c)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(r-c)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-n)/t,this._x=(r+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Wn(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,c=e._z,l=e._w;return this._x=i*l+s*o+n*c-r*a,this._y=n*l+s*a+r*o-i*c,this._z=r*l+s*c+i*a-n*o,this._w=s*l-i*o-n*a-r*c,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const c=Math.sqrt(a),l=Math.atan2(c,o),h=Math.sin((1-e)*l)/c,u=Math.sin(e*l)/c;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(t),n*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class br{constructor(t=0,e=0,i=0){br.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Sr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Sr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,c=2*(s*n-o*i),l=2*(o*e-r*n),h=2*(r*i-s*e);return this.x=e+a*c+s*h-o*l,this.y=i+a*l+o*c-r*h,this.z=n+a*h+r*l-s*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Wn(this.x,t.x,e.x),this.y=Wn(this.y,t.y,e.y),this.z=Wn(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=Wn(this.x,t,e),this.y=Wn(this.y,t,e),this.z=Wn(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Wn(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Mr.copy(this).projectOnVector(t),this.sub(Mr)}reflect(t){return this.sub(Mr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Wn(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mr=new br,Sr=new xr;class wr{constructor(t=new br(1/0,1/0,1/0),e=new br(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Er.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Er.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Er.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i){const n=i.getAttribute("position");if(!0===e&&void 0!==n&&!0!==t.isInstancedMesh)for(let e=0,i=n.count;e<i;e++)!0===t.isMesh?t.getVertexPosition(e,Er):Er.fromBufferAttribute(n,e),Er.applyMatrix4(t.matrixWorld),this.expandByPoint(Er);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Cr.copy(t.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),Cr.copy(i.boundingBox)),Cr.applyMatrix4(t.matrixWorld),this.union(Cr)}const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Er),Er.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Or),Lr.subVectors(this.max,Or),Pr.subVectors(t.a,Or),Ar.subVectors(t.b,Or),Dr.subVectors(t.c,Or),Rr.subVectors(Ar,Pr),kr.subVectors(Dr,Ar),Ir.subVectors(Pr,Dr);let e=[0,-Rr.z,Rr.y,0,-kr.z,kr.y,0,-Ir.z,Ir.y,Rr.z,0,-Rr.x,kr.z,0,-kr.x,Ir.z,0,-Ir.x,-Rr.y,Rr.x,0,-kr.y,kr.x,0,-Ir.y,Ir.x,0];return!!Wr(e,Pr,Ar,Dr,Lr)&&(e=[1,0,0,0,1,0,0,0,1],!!Wr(e,Pr,Ar,Dr,Lr)&&(Ur.crossVectors(Rr,kr),e=[Ur.x,Ur.y,Ur.z],Wr(e,Pr,Ar,Dr,Lr)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Er).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Er).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Tr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Tr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Tr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Tr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Tr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Tr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Tr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Tr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Tr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Tr=[new br,new br,new br,new br,new br,new br,new br,new br],Er=new br,Cr=new wr,Pr=new br,Ar=new br,Dr=new br,Rr=new br,kr=new br,Ir=new br,Or=new br,Lr=new br,Ur=new br,Nr=new br;function Wr(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){Nr.fromArray(t,s);const o=r.x*Math.abs(Nr.x)+r.y*Math.abs(Nr.y)+r.z*Math.abs(Nr.z),a=e.dot(Nr),c=i.dot(Nr),l=n.dot(Nr);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>o)return!1}return!0}const Fr=new wr,Br=new br,zr=new br;class Vr{constructor(t=new br,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Fr.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Br.subVectors(t,this.center);const e=Br.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(Br,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(zr.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Br.copy(t.center).add(zr)),this.expandByPoint(Br.copy(t.center).sub(zr))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Hr=new br,Gr=new br,jr=new br,Xr=new br,qr=new br,Yr=new br,Zr=new br;class Kr{constructor(t=new br,e=new br(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Hr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Hr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Hr.copy(this.origin).addScaledVector(this.direction,e),Hr.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Gr.copy(t).add(e).multiplyScalar(.5),jr.copy(e).sub(t).normalize(),Xr.copy(this.origin).sub(Gr);const r=.5*t.distanceTo(e),s=-this.direction.dot(jr),o=Xr.dot(this.direction),a=-Xr.dot(jr),c=Xr.lengthSq(),l=Math.abs(1-s*s);let h,u,d,p;if(l>0)if(h=s*a-o,u=s*o-a,p=r*l,h>=0)if(u>=-p)if(u<=p){const t=1/l;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+c}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+c):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+c):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+c);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(Gr).addScaledVector(jr,u),d}intersectSphere(t,e){Hr.subVectors(t.center,this.origin);const i=Hr.dot(this.direction),n=Hr.dot(Hr)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,o,a;const c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(i=(t.min.x-u.x)*c,n=(t.max.x-u.x)*c):(i=(t.max.x-u.x)*c,n=(t.min.x-u.x)*c),l>=0?(r=(t.min.y-u.y)*l,s=(t.max.y-u.y)*l):(r=(t.max.y-u.y)*l,s=(t.min.y-u.y)*l),i>s||r>n?null:((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Hr)}intersectTriangle(t,e,i,n,r){qr.subVectors(e,t),Yr.subVectors(i,t),Zr.crossVectors(qr,Yr);let s,o=this.direction.dot(Zr);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Xr.subVectors(this.origin,t);const a=s*this.direction.dot(Yr.crossVectors(Xr,Yr));if(a<0)return null;const c=s*this.direction.dot(qr.cross(Xr));if(c<0)return null;if(a+c>o)return null;const l=-s*Xr.dot(Zr);return l<0?null:this.at(l/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Jr{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m){Jr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m)}set(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jr).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/$r.setFromMatrixColumn(t,0).length(),r=1/$r.setFromMatrixColumn(t,1).length(),s=1/$r.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),c=Math.sin(n),l=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*l,i=s*h,n=o*l,r=o*h;e[0]=a*l,e[4]=-a*h,e[8]=c,e[1]=i+n*c,e[5]=t-r*c,e[9]=-o*a,e[2]=r-t*c,e[6]=n+i*c,e[10]=s*a}else if("YXZ"===t.order){const t=a*l,i=a*h,n=c*l,r=c*h;e[0]=t+r*o,e[4]=n*o-i,e[8]=s*c,e[1]=s*h,e[5]=s*l,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*l,i=a*h,n=c*l,r=c*h;e[0]=t-r*o,e[4]=-s*h,e[8]=n+i*o,e[1]=i+n*o,e[5]=s*l,e[9]=r-t*o,e[2]=-s*c,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*l,i=s*h,n=o*l,r=o*h;e[0]=a*l,e[4]=n*c-i,e[8]=t*c+r,e[1]=a*h,e[5]=r*c+t,e[9]=i*c-n,e[2]=-c,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*c,n=o*a,r=o*c;e[0]=a*l,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*l,e[9]=-o*l,e[2]=-c*l,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,i=s*c,n=o*a,r=o*c;e[0]=a*l,e[4]=-h,e[8]=c*l,e[1]=t*h+r,e[5]=s*l,e[9]=i*h-n,e[2]=n*h-i,e[6]=o*l,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ts,t,es)}lookAt(t,e,i){const n=this.elements;return rs.subVectors(t,e),0===rs.lengthSq()&&(rs.z=1),rs.normalize(),is.crossVectors(i,rs),0===is.lengthSq()&&(1===Math.abs(i.z)?rs.x+=1e-4:rs.z+=1e-4,rs.normalize(),is.crossVectors(i,rs)),is.normalize(),ns.crossVectors(rs,is),n[0]=is.x,n[4]=ns.x,n[8]=rs.x,n[1]=is.y,n[5]=ns.y,n[9]=rs.y,n[2]=is.z,n[6]=ns.z,n[10]=rs.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],c=i[12],l=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],_=i[7],y=i[11],x=i[15],b=n[0],M=n[4],S=n[8],w=n[12],T=n[1],E=n[5],C=n[9],P=n[13],A=n[2],D=n[6],R=n[10],k=n[14],I=n[3],O=n[7],L=n[11],U=n[15];return r[0]=s*b+o*T+a*A+c*I,r[4]=s*M+o*E+a*D+c*O,r[8]=s*S+o*C+a*R+c*L,r[12]=s*w+o*P+a*k+c*U,r[1]=l*b+h*T+u*A+d*I,r[5]=l*M+h*E+u*D+d*O,r[9]=l*S+h*C+u*R+d*L,r[13]=l*w+h*P+u*k+d*U,r[2]=p*b+f*T+m*A+g*I,r[6]=p*M+f*E+m*D+g*O,r[10]=p*S+f*C+m*R+g*L,r[14]=p*w+f*P+m*k+g*U,r[3]=v*b+_*T+y*A+x*I,r[7]=v*M+_*E+y*D+x*O,r[11]=v*S+_*C+y*R+x*L,r[15]=v*w+_*P+y*k+x*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],c=t[13],l=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*a*h-n*c*h-r*o*u+i*c*u+n*o*d-i*a*d)+t[7]*(+e*a*d-e*c*u+r*s*u-n*s*d+n*c*l-r*a*l)+t[11]*(+e*c*h-e*o*d-r*s*h+i*s*d+r*o*l-i*c*l)+t[15]*(-n*o*l-e*a*h+e*o*u+n*s*h-i*s*u+i*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*c-f*u*c+f*a*d-o*m*d-h*a*g+o*u*g,_=p*u*c-l*m*c-p*a*d+s*m*d+l*a*g-s*u*g,y=l*f*c-p*h*c+p*o*d-s*f*d-l*o*g+s*h*g,x=p*h*a-l*f*a-p*o*u+s*f*u+l*o*m-s*h*m,b=e*v+i*_+n*y+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=v*M,t[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*M,t[2]=(o*m*r-f*a*r+f*n*c-i*m*c-o*n*g+i*a*g)*M,t[3]=(h*a*r-o*u*r-h*n*c+i*u*c+o*n*d-i*a*d)*M,t[4]=_*M,t[5]=(l*m*r-p*u*r+p*n*d-e*m*d-l*n*g+e*u*g)*M,t[6]=(p*a*r-s*m*r-p*n*c+e*m*c+s*n*g-e*a*g)*M,t[7]=(s*u*r-l*a*r+l*n*c-e*u*c-s*n*d+e*a*d)*M,t[8]=y*M,t[9]=(p*h*r-l*f*r-p*i*d+e*f*d+l*i*g-e*h*g)*M,t[10]=(s*f*r-p*o*r+p*i*c-e*f*c-s*i*g+e*o*g)*M,t[11]=(l*o*r-s*h*r-l*i*c+e*h*c+s*i*d-e*o*d)*M,t[12]=x*M,t[13]=(l*f*n-p*h*n+p*i*u-e*f*u-l*i*m+e*h*m)*M,t[14]=(p*o*n-s*f*n-p*i*a+e*f*a+s*i*m-e*o*m)*M,t[15]=(s*h*n-l*o*n+l*i*a-e*h*a-s*i*u+e*o*u)*M,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,c=r*s,l=r*o;return this.set(c*s+i,c*o-n*a,c*a+n*o,0,c*o+n*a,l*o+i,l*a-n*s,0,c*a-n*o,l*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,c=r+r,l=s+s,h=o+o,u=r*c,d=r*l,p=r*h,f=s*l,m=s*h,g=o*h,v=a*c,_=a*l,y=a*h,x=i.x,b=i.y,M=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+y)*x,n[2]=(p-_)*x,n[3]=0,n[4]=(d-y)*b,n[5]=(1-(u+g))*b,n[6]=(m+v)*b,n[7]=0,n[8]=(p+_)*M,n[9]=(m-v)*M,n[10]=(1-(u+f))*M,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=$r.set(n[0],n[1],n[2]).length();const s=$r.set(n[4],n[5],n[6]).length(),o=$r.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Qr.copy(this);const a=1/r,c=1/s,l=1/o;return Qr.elements[0]*=a,Qr.elements[1]*=a,Qr.elements[2]*=a,Qr.elements[4]*=c,Qr.elements[5]*=c,Qr.elements[6]*=c,Qr.elements[8]*=l,Qr.elements[9]*=l,Qr.elements[10]*=l,e.setFromRotationMatrix(Qr),i.x=r,i.y=s,i.z=o,this}makePerspective(t,e,i,n,r,s,o=Cn){const a=this.elements,c=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),u=(i+n)/(i-n);let d,p;if(o===Cn)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(o!==Pn)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-r),p=-s*r/(s-r)}return a[0]=c,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s,o=Cn){const a=this.elements,c=1/(e-t),l=1/(i-n),h=1/(s-r),u=(e+t)*c,d=(i+n)*l;let p,f;if(o===Cn)p=(s+r)*h,f=-2*h;else{if(o!==Pn)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=r*h,f=-1*h}return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const $r=new br,Qr=new Jr,ts=new br(0,0,0),es=new br(1,1,1),is=new br,ns=new br,rs=new br,ss=new Jr,os=new xr;class as{constructor(t=0,e=0,i=0,n=as.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],o=n[8],a=n[1],c=n[5],l=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(Wn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Wn(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Wn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Wn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Wn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Wn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ss.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ss,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return os.setFromEuler(this),this.setFromQuaternion(os,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}as.DEFAULT_ORDER="XYZ";class cs{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let ls=0;const hs=new br,us=new xr,ds=new Jr,ps=new br,fs=new br,ms=new br,gs=new xr,vs=new br(1,0,0),_s=new br(0,1,0),ys=new br(0,0,1),xs={type:"added"},bs={type:"removed"},Ms={type:"childadded",child:null},Ss={type:"childremoved",child:null};class ws extends kn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ls++}),this.uuid=Nn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ws.DEFAULT_UP.clone();const t=new br,e=new as,i=new xr,n=new br(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Jr},normalMatrix:{value:new jn}}),this.matrix=new Jr,this.matrixWorld=new Jr,this.matrixAutoUpdate=ws.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ws.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return us.setFromAxisAngle(t,e),this.quaternion.multiply(us),this}rotateOnWorldAxis(t,e){return us.setFromAxisAngle(t,e),this.quaternion.premultiply(us),this}rotateX(t){return this.rotateOnAxis(vs,t)}rotateY(t){return this.rotateOnAxis(_s,t)}rotateZ(t){return this.rotateOnAxis(ys,t)}translateOnAxis(t,e){return hs.copy(t).applyQuaternion(this.quaternion),this.position.add(hs.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(vs,t)}translateY(t){return this.translateOnAxis(_s,t)}translateZ(t){return this.translateOnAxis(ys,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ds.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ps.copy(t):ps.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),fs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ds.lookAt(fs,ps,this.up):ds.lookAt(ps,fs,this.up),this.quaternion.setFromRotationMatrix(ds),n&&(ds.extractRotation(n.matrixWorld),us.setFromRotationMatrix(ds),this.quaternion.premultiply(us.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(xs),Ms.child=t,this.dispatchEvent(Ms),Ms.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(bs),Ss.child=t,this.dispatchEvent(Ss),Ss.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),ds.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ds.multiply(t.parent.matrixWorld)),t.applyMatrix4(ds),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(xs),Ms.child=t,this.dispatchEvent(Ms),Ms.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fs,t,ms),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fs,gs,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.geometryInfo=this._geometryInfo.map((t=>({...t,boundingBox:t.boundingBox?{min:t.boundingBox.min.toArray(),max:t.boundingBox.max.toArray()}:void 0,boundingSphere:t.boundingSphere?{radius:t.boundingSphere.radius,center:t.boundingSphere.center.toArray()}:void 0}))),n.instanceInfo=this._instanceInfo.map((t=>({...t}))),n.availableInstanceIds=this._availableInstanceIds.slice(),n.availableGeometryIds=this._availableGeometryIds.slice(),n.nextIndexStart=this._nextIndexStart,n.nextVertexStart=this._nextVertexStart,n.geometryCount=this._geometryCount,n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.matricesTexture=this._matricesTexture.toJSON(t),n.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(n.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(n.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),c=s(t.skeletons),l=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),c.length>0&&(i.skeletons=c),l.length>0&&(i.animations=l),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ws.DEFAULT_UP=new br(0,1,0),ws.DEFAULT_MATRIX_AUTO_UPDATE=!0,ws.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ts=new br,Es=new br,Cs=new br,Ps=new br,As=new br,Ds=new br,Rs=new br,ks=new br,Is=new br,Os=new br,Ls=new pr,Us=new pr,Ns=new pr;class Ws{constructor(t=new br,e=new br,i=new br){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Ts.subVectors(t,e),n.cross(Ts);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Ts.subVectors(n,e),Es.subVectors(i,e),Cs.subVectors(t,e);const s=Ts.dot(Ts),o=Ts.dot(Es),a=Ts.dot(Cs),c=Es.dot(Es),l=Es.dot(Cs),h=s*c-o*o;if(0===h)return r.set(0,0,0),null;const u=1/h,d=(c*a-o*l)*u,p=(s*l-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return null!==this.getBarycoord(t,e,i,n,Ps)&&Ps.x>=0&&Ps.y>=0&&Ps.x+Ps.y<=1}static getInterpolation(t,e,i,n,r,s,o,a){return null===this.getBarycoord(t,e,i,n,Ps)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,Ps.x),a.addScaledVector(s,Ps.y),a.addScaledVector(o,Ps.z),a)}static getInterpolatedAttribute(t,e,i,n,r,s){return Ls.setScalar(0),Us.setScalar(0),Ns.setScalar(0),Ls.fromBufferAttribute(t,e),Us.fromBufferAttribute(t,i),Ns.fromBufferAttribute(t,n),s.setScalar(0),s.addScaledVector(Ls,r.x),s.addScaledVector(Us,r.y),s.addScaledVector(Ns,r.z),s}static isFrontFacing(t,e,i,n){return Ts.subVectors(i,e),Es.subVectors(t,e),Ts.cross(Es).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ts.subVectors(this.c,this.b),Es.subVectors(this.a,this.b),.5*Ts.cross(Es).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ws.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ws.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,n,r){return Ws.getInterpolation(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Ws.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ws.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,o;As.subVectors(n,i),Ds.subVectors(r,i),ks.subVectors(t,i);const a=As.dot(ks),c=Ds.dot(ks);if(a<=0&&c<=0)return e.copy(i);Is.subVectors(t,n);const l=As.dot(Is),h=Ds.dot(Is);if(l>=0&&h<=l)return e.copy(n);const u=a*h-l*c;if(u<=0&&a>=0&&l<=0)return s=a/(a-l),e.copy(i).addScaledVector(As,s);Os.subVectors(t,r);const d=As.dot(Os),p=Ds.dot(Os);if(p>=0&&d<=p)return e.copy(r);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return o=c/(c-p),e.copy(i).addScaledVector(Ds,o);const m=l*p-d*h;if(m<=0&&h-l>=0&&d-p>=0)return Rs.subVectors(r,n),o=(h-l)/(h-l+(d-p)),e.copy(n).addScaledVector(Rs,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(i).addScaledVector(As,s).addScaledVector(Ds,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Fs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bs={h:0,s:0,l:0},zs={h:0,s:0,l:0};function Vs(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class Hs{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=zi){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,nr.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=nr.workingColorSpace){return this.r=t,this.g=e,this.b=i,nr.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=nr.workingColorSpace){if(t=Fn(t,1),e=Wn(e,0,1),i=Wn(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Vs(r,n,t+1/3),this.g=Vs(r,n,t),this.b=Vs(r,n,t-1/3)}return nr.toWorkingColorSpace(this,n),this}setStyle(t,e=zi){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const s=n[1],o=n[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=n[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(i,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=zi){const i=Fs[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=rr(t.r),this.g=rr(t.g),this.b=rr(t.b),this}copyLinearToSRGB(t){return this.r=sr(t.r),this.g=sr(t.g),this.b=sr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=zi){return nr.fromWorkingColorSpace(Gs.copy(this),t),65536*Math.round(Wn(255*Gs.r,0,255))+256*Math.round(Wn(255*Gs.g,0,255))+Math.round(Wn(255*Gs.b,0,255))}getHexString(t=zi){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=nr.workingColorSpace){nr.fromWorkingColorSpace(Gs.copy(this),e);const i=Gs.r,n=Gs.g,r=Gs.b,s=Math.max(i,n,r),o=Math.min(i,n,r);let a,c;const l=(o+s)/2;if(o===s)a=0,c=0;else{const t=s-o;switch(c=l<=.5?t/(s+o):t/(2-s-o),s){case i:a=(n-r)/t+(n<r?6:0);break;case n:a=(r-i)/t+2;break;case r:a=(i-n)/t+4}a/=6}return t.h=a,t.s=c,t.l=l,t}getRGB(t,e=nr.workingColorSpace){return nr.fromWorkingColorSpace(Gs.copy(this),e),t.r=Gs.r,t.g=Gs.g,t.b=Gs.b,t}getStyle(t=zi){nr.fromWorkingColorSpace(Gs.copy(this),t);const e=Gs.r,i=Gs.g,n=Gs.b;return t!==zi?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(t,e,i){return this.getHSL(Bs),this.setHSL(Bs.h+t,Bs.s+e,Bs.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Bs),t.getHSL(zs);const i=Bn(Bs.h,zs.h,e),n=Bn(Bs.s,zs.s,e),r=Bn(Bs.l,zs.l,e);return this.setHSL(i,n,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,n=this.b,r=t.elements;return this.r=r[0]*e+r[3]*i+r[6]*n,this.g=r[1]*e+r[4]*i+r[7]*n,this.b=r[2]*e+r[5]*i+r[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gs=new Hs;Hs.NAMES=Fs;let js=0;class Xs extends kn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:js++}),this.uuid=Nn(),this.name="",this.type="Material",this.blending=ct,this.side=rt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Mt,this.blendDst=St,this.blendEquation=pt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Hs(0,0,0),this.blendAlpha=0,this.depthFunc=Ut,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=an,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Xi,this.stencilZFail=Xi,this.stencilZPass=Xi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ct&&(i.blending=this.blending),this.side!==rt&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),this.blendSrc!==Mt&&(i.blendSrc=this.blendSrc),this.blendDst!==St&&(i.blendDst=this.blendDst),this.blendEquation!==pt&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Ut&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==an&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Xi&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Xi&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Xi&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class qs extends Xs{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Hs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new as,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ys=Zs();function Zs(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(n[t]=0,n[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(n[t]=1024>>-e-14,n[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(n[t]=e+15<<10,n[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(n[t]=31744,n[256|t]=64512,r[t]=24,r[256|t]=24):(n[t]=31744,n[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;!(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,s[t]=e|i}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Ks(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Wn(t,-65504,65504),Ys.floatView[0]=t;const e=Ys.uint32View[0],i=e>>23&511;return Ys.baseTable[i]+((8388607&e)>>Ys.shiftTable[i])}function Js(t){const e=t>>10;return Ys.uint32View[0]=Ys.mantissaTable[Ys.offsetTable[e]+(1023&t)]+Ys.exponentTable[e],Ys.floatView[0]}class $s{static toHalfFloat(t){return Ks(t)}static fromHalfFloat(t){return Js(t)}}const Qs=new br,to=new Gn;let eo=0;class io{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:eo++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=gn,this.updateRanges=[],this.gpuType=Te,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)to.fromBufferAttribute(this,e),to.applyMatrix3(t),this.setXY(e,to.x,to.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyMatrix3(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyMatrix4(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.applyNormalMatrix(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Qs.fromBufferAttribute(this,e),Qs.transformDirection(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=zn(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=Vn(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=zn(e,this.array)),e}setX(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=zn(e,this.array)),e}setY(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=zn(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=zn(e,this.array)),e}setW(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array),r=Vn(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==gn&&(t.usage=this.usage),t}}class no extends io{constructor(t,e,i){super(new Int8Array(t),e,i)}}class ro extends io{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class so extends io{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class oo extends io{constructor(t,e,i){super(new Int16Array(t),e,i)}}class ao extends io{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class co extends io{constructor(t,e,i){super(new Int32Array(t),e,i)}}class lo extends io{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class ho extends io{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}getX(t){let e=Js(this.array[t*this.itemSize]);return this.normalized&&(e=zn(e,this.array)),e}setX(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize]=Ks(e),this}getY(t){let e=Js(this.array[t*this.itemSize+1]);return this.normalized&&(e=zn(e,this.array)),e}setY(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+1]=Ks(e),this}getZ(t){let e=Js(this.array[t*this.itemSize+2]);return this.normalized&&(e=zn(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+2]=Ks(e),this}getW(t){let e=Js(this.array[t*this.itemSize+3]);return this.normalized&&(e=zn(e,this.array)),e}setW(t,e){return this.normalized&&(e=Vn(e,this.array)),this.array[t*this.itemSize+3]=Ks(e),this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array)),this.array[t+0]=Ks(e),this.array[t+1]=Ks(i),this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array)),this.array[t+0]=Ks(e),this.array[t+1]=Ks(i),this.array[t+2]=Ks(n),this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array),r=Vn(r,this.array)),this.array[t+0]=Ks(e),this.array[t+1]=Ks(i),this.array[t+2]=Ks(n),this.array[t+3]=Ks(r),this}}class uo extends io{constructor(t,e,i){super(new Float32Array(t),e,i)}}let po=0;const fo=new Jr,mo=new ws,go=new br,vo=new wr,_o=new wr,yo=new br;class xo extends kn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:po++}),this.uuid=Nn(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(qn(t)?lo:ao)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new jn).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return fo.makeRotationFromQuaternion(t),this.applyMatrix4(fo),this}rotateX(t){return fo.makeRotationX(t),this.applyMatrix4(fo),this}rotateY(t){return fo.makeRotationY(t),this.applyMatrix4(fo),this}rotateZ(t){return fo.makeRotationZ(t),this.applyMatrix4(fo),this}translate(t,e,i){return fo.makeTranslation(t,e,i),this.applyMatrix4(fo),this}scale(t,e,i){return fo.makeScale(t,e,i),this.applyMatrix4(fo),this}lookAt(t){return mo.lookAt(t),mo.updateMatrix(),this.applyMatrix4(mo.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(go).negate(),this.translate(go.x,go.y,go.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}this.setAttribute("position",new uo(e,3))}else{const i=Math.min(t.length,e.count);for(let n=0;n<i;n++){const i=t[n];e.setXYZ(n,i.x,i.y,i.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new wr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new br(-1/0,-1/0,-1/0),new br(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];vo.setFromBufferAttribute(i),this.morphTargetsRelative?(yo.addVectors(this.boundingBox.min,vo.min),this.boundingBox.expandByPoint(yo),yo.addVectors(this.boundingBox.max,vo.max),this.boundingBox.expandByPoint(yo)):(this.boundingBox.expandByPoint(vo.min),this.boundingBox.expandByPoint(vo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Vr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new br,1/0);if(t){const i=this.boundingSphere.center;if(vo.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];_o.setFromBufferAttribute(i),this.morphTargetsRelative?(yo.addVectors(vo.min,_o.min),vo.expandByPoint(yo),yo.addVectors(vo.max,_o.max),vo.expandByPoint(yo)):(vo.expandByPoint(_o.min),vo.expandByPoint(_o.max))}vo.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)yo.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(yo));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)yo.fromBufferAttribute(s,e),o&&(go.fromBufferAttribute(t,e),yo.add(go)),n=Math.max(n,i.distanceToSquared(yo))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.position,n=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new io(new Float32Array(4*i.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<i.count;t++)o[t]=new br,a[t]=new br;const c=new br,l=new br,h=new br,u=new Gn,d=new Gn,p=new Gn,f=new br,m=new br;function g(t,e,n){c.fromBufferAttribute(i,t),l.fromBufferAttribute(i,e),h.fromBufferAttribute(i,n),u.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,n),l.sub(c),h.sub(c),d.sub(u),p.sub(u);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[n].add(f),a[t].add(m),a[e].add(m),a[n].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,i=v.length;e<i;++e){const i=v[e],n=i.start;for(let e=n,r=n+i.count;e<r;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const _=new br,y=new br,x=new br,b=new br;function M(t){x.fromBufferAttribute(n,t),b.copy(x);const e=o[t];_.copy(e),_.sub(x.multiplyScalar(x.dot(e))).normalize(),y.crossVectors(b,e);const i=y.dot(a[t])<0?-1:1;s.setXYZW(t,_.x,_.y,_.z,i)}for(let e=0,i=v.length;e<i;++e){const i=v[e],n=i.start;for(let e=n,r=n+i.count;e<r;e+=3)M(t.getX(e+0)),M(t.getX(e+1)),M(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new io(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new br,r=new br,s=new br,o=new br,a=new br,c=new br,l=new br,h=new br;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),l.subVectors(s,r),h.subVectors(n,r),l.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),c.fromBufferAttribute(i,f),o.add(l),a.add(l),c.add(l),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),l.subVectors(s,r),h.subVectors(n,r),l.cross(h),i.setXYZ(t+0,l.x,l.y,l.z),i.setXYZ(t+1,l.x,l.y,l.z),i.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)yo.fromBufferAttribute(t,e),yo.normalize(),t.setXYZ(e,yo.x,yo.y,yo.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let o=0,a=0;for(let r=0,c=e.length;r<c;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[a++]=i[o++]}return new io(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new xo,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone());const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const bo=new Jr,Mo=new Kr,So=new Vr,wo=new br,To=new br,Eo=new br,Co=new br,Po=new br,Ao=new br,Do=new br,Ro=new br;class ko extends ws{constructor(t=new xo,e=new qs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(r&&o){Ao.set(0,0,0);for(let i=0,n=r.length;i<n;i++){const n=o[i],a=r[i];0!==n&&(Po.fromBufferAttribute(a,t),s?Ao.addScaledVector(Po,n):Ao.addScaledVector(Po.sub(e),n))}e.add(Ao)}return e}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),So.copy(i.boundingSphere),So.applyMatrix4(r),Mo.copy(t.ray).recast(t.near),!1===So.containsPoint(Mo.origin)){if(null===Mo.intersectSphere(So,wo))return;if(Mo.origin.distanceToSquared(wo)>(t.far-t.near)**2)return}bo.copy(r).invert(),Mo.copy(t.ray).applyMatrix4(bo),null!==i.boundingBox&&!1===Mo.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,Mo)}}_computeIntersections(t,e,i){let n;const r=this.geometry,s=this.material,o=r.index,a=r.attributes.position,c=r.attributes.uv,l=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(s))for(let r=0,a=u.length;r<a;r++){const a=u[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3)n=Io(this,p,t,i,c,l,h,o.getX(r),o.getX(r+1),o.getX(r+2)),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=a.materialIndex,e.push(n))}else for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3)n=Io(this,s,t,i,c,l,h,o.getX(r),o.getX(r+1),o.getX(r+2)),n&&(n.faceIndex=Math.floor(r/3),e.push(n));else if(void 0!==a)if(Array.isArray(s))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3)n=Io(this,p,t,i,c,l,h,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=o.materialIndex,e.push(n))}else for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3)n=Io(this,s,t,i,c,l,h,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),e.push(n))}}function Io(t,e,i,n,r,s,o,a,c,l){t.getVertexPosition(a,To),t.getVertexPosition(c,Eo),t.getVertexPosition(l,Co);const h=function(t,e,i,n,r,s,o,a){let c;if(c=e.side===st?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,e.side===rt,a),null===c)return null;Ro.copy(a),Ro.applyMatrix4(t.matrixWorld);const l=i.ray.origin.distanceTo(Ro);return l<i.near||l>i.far?null:{distance:l,point:Ro.clone(),object:t}}(t,e,i,n,To,Eo,Co,Do);if(h){const t=new br;Ws.getBarycoord(Do,To,Eo,Co,t),r&&(h.uv=Ws.getInterpolatedAttribute(r,a,c,l,t,new Gn)),s&&(h.uv1=Ws.getInterpolatedAttribute(s,a,c,l,t,new Gn)),o&&(h.normal=Ws.getInterpolatedAttribute(o,a,c,l,t,new br),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const e={a,b:c,c:l,normal:new br,materialIndex:0};Ws.getNormal(To,Eo,Co,e.normal),h.face=e,h.barycoord=t}return h}class Oo extends xo{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],c=[],l=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,v){const _=s/m,y=p/g,x=s/2,b=p/2,M=f/2,S=m+1,w=g+1;let T=0,E=0;const C=new br;for(let s=0;s<w;s++){const o=s*y-b;for(let a=0;a<S;a++){const u=a*_-x;C[t]=u*n,C[e]=o*r,C[i]=M,c.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=f>0?1:-1,l.push(C.x,C.y,C.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+S*t,n=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;a.push(i,n,s),a.push(n,r,s),E+=6}o.addGroup(d,E,v),d+=E,u+=T}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new uo(c,3)),this.setAttribute("normal",new uo(l,3)),this.setAttribute("uv",new uo(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Oo(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Lo(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Uo(t){const e={};for(let i=0;i<t.length;i++){const n=Lo(t[i]);for(const t in n)e[t]=n[t]}return e}function No(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:nr.workingColorSpace}const Wo={clone:Lo,merge:Uo};class Fo extends Xs{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Lo(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Bo extends ws{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Jr,this.projectionMatrix=new Jr,this.projectionMatrixInverse=new Jr,this.coordinateSystem=Cn}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const zo=new br,Vo=new Gn,Ho=new Gn;class Go extends Bo{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Un*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Ln*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Un*Math.atan(Math.tan(.5*Ln*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){zo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(zo.x,zo.y).multiplyScalar(-t/zo.z),zo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(zo.x,zo.y).multiplyScalar(-t/zo.z)}getViewSize(t,e){return this.getViewBounds(t,Vo,Ho),e.subVectors(Ho,Vo)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Ln*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/o,n*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const jo=-90;class Xo extends ws{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Go(jo,1,t,e);n.layers=this.layers,this.add(n);const r=new Go(jo,1,t,e);r.layers=this.layers,this.add(r);const s=new Go(jo,1,t,e);s.layers=this.layers,this.add(s);const o=new Go(jo,1,t,e);o.layers=this.layers,this.add(o);const a=new Go(jo,1,t,e);a.layers=this.layers,this.add(a);const c=new Go(jo,1,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,n,r,s,o,a]=e;for(const t of e)this.remove(t);if(t===Cn)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Pn)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,c,l]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,n),t.render(e,r),t.setRenderTarget(i,1,n),t.render(e,s),t.setRenderTarget(i,2,n),t.render(e,o),t.setRenderTarget(i,3,n),t.render(e,a),t.setRenderTarget(i,4,n),t.render(e,c),i.texture.generateMipmaps=f,t.setRenderTarget(i,5,n),t.render(e,l),t.setRenderTarget(h,u,d),t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class qo extends dr{constructor(t=[],e=ee,i,n,r,s,o,a,c,l){super(t,e,i,n,r,s,o,a,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Yo extends mr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new qo(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:fe}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Oo(5,5,5),o=new Fo({name:"CubemapFromEquirect",uniforms:Lo(i),vertexShader:n,fragmentShader:r,side:st,blending:at});o.uniforms.tEquirect.value=e;const a=new ko(s,o),c=e.minFilter;return e.minFilter===ve&&(e.minFilter=fe),new Xo(1,10,this).update(t,a),e.minFilter=c,a.geometry.dispose(),a.material.dispose(),this}clear(t,e=!0,i=!0,n=!0){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}class Zo extends ws{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ko={type:"move"};class Jo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Zo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Zo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new br,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new br),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Zo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new br,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new br),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(c&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i),r=this._getHandJoint(c,n);null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=t.radius),r.visible=null!==t}const n=c.joints["index-finger-tip"],r=c.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,l=.005;c.inputState.pinching&&o>a+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&o<=a-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ko)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Zo;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class $o{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Hs(t),this.density=e}clone(){return new $o(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Qo{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new Hs(t),this.near=e,this.far=i}clone(){return new Qo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ta extends ws{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new as,this.environmentIntensity=1,this.environmentRotation=new as,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class ea{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=gn,this.updateRanges=[],this.version=0,this.uuid=Nn()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ia=new br;class na{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.applyMatrix4(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.applyNormalMatrix(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.transformDirection(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=zn(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=Vn(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=Vn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Vn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Vn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Vn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=zn(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=zn(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=zn(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=zn(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Vn(e,this.array),i=Vn(i,this.array),n=Vn(n,this.array),r=Vn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new io(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new na(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ra extends Xs{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Hs(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let sa;const oa=new br,aa=new br,ca=new br,la=new Gn,ha=new Gn,ua=new Jr,da=new br,pa=new br,fa=new br,ma=new Gn,ga=new Gn,va=new Gn;class _a extends ws{constructor(t=new ra){if(super(),this.isSprite=!0,this.type="Sprite",void 0===sa){sa=new xo;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ea(t,5);sa.setIndex([0,1,2,0,2,3]),sa.setAttribute("position",new na(e,3,0,!1)),sa.setAttribute("uv",new na(e,2,3,!1))}this.geometry=sa,this.material=t,this.center=new Gn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),aa.setFromMatrixScale(this.matrixWorld),ua.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ca.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&aa.multiplyScalar(-ca.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;ya(da.set(-.5,-.5,0),ca,s,aa,n,r),ya(pa.set(.5,-.5,0),ca,s,aa,n,r),ya(fa.set(.5,.5,0),ca,s,aa,n,r),ma.set(0,0),ga.set(1,0),va.set(1,1);let o=t.ray.intersectTriangle(da,pa,fa,!1,oa);if(null===o&&(ya(pa.set(-.5,.5,0),ca,s,aa,n,r),ga.set(0,1),o=t.ray.intersectTriangle(da,fa,pa,!1,oa),null===o))return;const a=t.ray.origin.distanceTo(oa);a<t.near||a>t.far||e.push({distance:a,point:oa.clone(),uv:Ws.getInterpolation(oa,da,pa,fa,ma,ga,va,new Gn),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function ya(t,e,i,n,r,s){la.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(ha.x=s*la.x-r*la.y,ha.y=r*la.x+s*la.y):ha.copy(la),t.copy(e),t.x+=ha.x,t.y+=ha.y,t.applyMatrix4(ua)}const xa=new br,ba=new br;class Ma extends ws{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,i=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,hysteresis:i,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let i=0;i<e.length;i++)if(e[i].distance===t){const t=e.splice(i,1);return this.remove(t[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n;i++){let n=e[i].distance;if(e[i].object.visible&&(n-=n*e[i].hysteresis),t<n)break}return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){xa.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(xa);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){xa.setFromMatrixPosition(t.matrixWorld),ba.setFromMatrixPosition(this.matrixWorld);const i=xa.distanceTo(ba)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r;n++){let t=e[n].distance;if(e[n].object.visible&&(t-=t*e[n].hysteresis),!(i>=t))break;e[n-1].object.visible=!1,e[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return e}}const Sa=new br,wa=new pr,Ta=new pr,Ea=new br,Ca=new Jr,Pa=new br,Aa=new Vr,Da=new Jr,Ra=new Kr;class ka extends ko{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=$t,this.bindMatrix=new Jr,this.bindMatrixInverse=new Jr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new wr),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Pa),this.boundingBox.expandByPoint(Pa)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Vr),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Pa),this.boundingSphere.expandByPoint(Pa)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),Aa.copy(this.boundingSphere),Aa.applyMatrix4(n),!1!==t.ray.intersectsSphere(Aa)&&(Da.copy(n).invert(),Ra.copy(t.ray).applyMatrix4(Da),null!==this.boundingBox&&!1===Ra.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Ra)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new pr,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===$t?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Qt?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,n=this.geometry;wa.fromBufferAttribute(n.attributes.skinIndex,t),Ta.fromBufferAttribute(n.attributes.skinWeight,t),Sa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Ta.getComponent(t);if(0!==n){const r=wa.getComponent(t);Ca.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Ea.copy(Sa).applyMatrix4(Ca),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Ia extends ws{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Oa extends dr{constructor(t=null,e=1,i=1,n,r,s,o,a,c=le,l=le,h,u){super(null,s,o,a,c,l,n,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const La=new Jr,Ua=new Jr;class Na{constructor(t=[],e=[]){this.uuid=Nn(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Jr)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Jr;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Ua;La.multiplyMatrices(r,e[n]),La.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Na(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Oa(e,t,t,Ie,Te);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Ia),this.bones.push(r),this.boneInverses.push((new Jr).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class Wa extends io{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Fa=new Jr,Ba=new Jr,za=[],Va=new wr,Ha=new Jr,Ga=new ko,ja=new Vr;class Xa extends ko{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Wa(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,Ha)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new wr),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Fa),Va.copy(t.boundingBox).applyMatrix4(Fa),this.boundingBox.union(Va)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Vr),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Fa),ja.copy(t.boundingSphere).applyMatrix4(Fa),this.boundingSphere.union(ja)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const i=e.morphTargetInfluences,n=this.morphTexture.source.data.data,r=t*(i.length+1)+1;for(let t=0;t<i.length;t++)i[t]=n[r+t]}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Ga.geometry=this.geometry,Ga.material=this.material,void 0!==Ga.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ja.copy(this.boundingSphere),ja.applyMatrix4(i),!1!==t.ray.intersectsSphere(ja)))for(let r=0;r<n;r++){this.getMatrixAt(r,Fa),Ba.multiplyMatrices(i,Fa),Ga.matrixWorld=Ba,Ga.raycast(t,za);for(let t=0,i=za.length;t<i;t++){const i=za[t];i.instanceId=r,i.object=this,e.push(i)}za.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Wa(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const i=e.morphTargetInfluences,n=i.length+1;null===this.morphTexture&&(this.morphTexture=new Oa(new Float32Array(n*this.count),n,this.count,Ue,Te));const r=this.morphTexture.source.data.data;let s=0;for(let t=0;t<i.length;t++)s+=i[t];const o=this.geometry.morphTargetsRelative?1:1-s,a=n*t;r[a]=o,r.set(i,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const qa=new br,Ya=new br,Za=new jn;class Ka{constructor(t=new br(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=qa.subVectors(i,e).cross(Ya.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(qa),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(t.start).addScaledVector(i,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Za.getNormalMatrix(t),n=this.coplanarPoint(qa).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Ja=new Vr,$a=new br;class Qa{constructor(t=new Ka,e=new Ka,i=new Ka,n=new Ka,r=new Ka,s=new Ka){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=Cn){const i=this.planes,n=t.elements,r=n[0],s=n[1],o=n[2],a=n[3],c=n[4],l=n[5],h=n[6],u=n[7],d=n[8],p=n[9],f=n[10],m=n[11],g=n[12],v=n[13],_=n[14],y=n[15];if(i[0].setComponents(a-r,u-c,m-d,y-g).normalize(),i[1].setComponents(a+r,u+c,m+d,y+g).normalize(),i[2].setComponents(a+s,u+l,m+p,y+v).normalize(),i[3].setComponents(a-s,u-l,m-p,y-v).normalize(),i[4].setComponents(a-o,u-h,m-f,y-_).normalize(),e===Cn)i[5].setComponents(a+o,u+h,m+f,y+_).normalize();else{if(e!==Pn)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(o,h,f,_).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Ja.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Ja.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Ja)}intersectsSprite(t){return Ja.center.set(0,0,0),Ja.radius=.7071067811865476,Ja.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ja)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if($a.x=n.normal.x>0?t.max.x:t.min.x,$a.y=n.normal.y>0?t.max.y:t.min.y,$a.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint($a)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const tc=new Jr,ec=new Qa;class ic{constructor(){this.coordinateSystem=Cn}intersectsObject(t,e){if(!e.isArrayCamera||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const n=e.cameras[i];if(tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ec.setFromProjectionMatrix(tc,this.coordinateSystem),ec.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const n=e.cameras[i];if(tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ec.setFromProjectionMatrix(tc,this.coordinateSystem),ec.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const n=e.cameras[i];if(tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ec.setFromProjectionMatrix(tc,this.coordinateSystem),ec.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const n=e.cameras[i];if(tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ec.setFromProjectionMatrix(tc,this.coordinateSystem),ec.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const n=e.cameras[i];if(tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ec.setFromProjectionMatrix(tc,this.coordinateSystem),ec.containsPoint(t))return!0}return!1}clone(){return new ic}}function nc(t,e){return t-e}function rc(t,e){return t.z-e.z}function sc(t,e){return e.z-t.z}class oc{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,i,n){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];s.push(o),this.index++,o.start=t,o.count=e,o.z=i,o.index=n}reset(){this.list.length=0,this.index=0}}const ac=new Jr,cc=new Hs(1,1,1),lc=new Qa,hc=new ic,uc=new wr,dc=new Vr,pc=new br,fc=new br,mc=new br,gc=new oc,vc=new ko,_c=[];function yc(t,e,i=0){const n=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let s=0;s<r;s++)for(let r=0;r<n;r++)e.setComponent(s+i,r,t.getComponent(s,r))}else e.array.set(t.array,i*n);e.needsUpdate=!0}function xc(t,e){if(t.constructor!==e.constructor){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++)e[n]=t[n]}else{const i=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,i))}}class bc extends ko{constructor(t,e,i=2*e,n){super(new xo,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),i=new Oa(e,t,t,Ie,Te);this._matricesTexture=i}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),i=new Oa(e,t,t,Ne,we);this._indirectTexture=i}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),i=new Oa(e,t,t,Ie,Te);i.colorSpace=nr.workingColorSpace,this._colorsTexture=i}_initializeGeometry(t){const e=this.geometry,i=this._maxVertexCount,n=this._maxIndexCount;if(!1===this._geometryInitialized){for(const n in t.attributes){const r=t.getAttribute(n),{array:s,itemSize:o,normalized:a}=r,c=new s.constructor(i*o),l=new io(c,o,a);e.setAttribute(n,l)}if(null!==t.getIndex()){const t=i>65535?new Uint32Array(n):new Uint16Array(n);e.setIndex(new io(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in e.attributes){if(!t.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const n=t.getAttribute(i),r=e.getAttribute(i);if(n.itemSize!==r.itemSize||n.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new wr);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let i=0,n=e.length;i<n;i++){if(!1===e[i].active)continue;const n=e[i].geometryIndex;this.getMatrixAt(i,ac),this.getBoundingBoxAt(n,uc).applyMatrix4(ac),t.union(uc)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Vr);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let i=0,n=e.length;i<n;i++){if(!1===e[i].active)continue;const n=e[i].geometryIndex;this.getMatrixAt(i,ac),this.getBoundingSphereAt(n,dc).applyMatrix4(ac),t.union(dc)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(nc),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=e):(i=this._instanceInfo.length,this._instanceInfo.push(e));const n=this._matricesTexture;ac.identity().toArray(n.image.data,16*i),n.needsUpdate=!0;const r=this._colorsTexture;return r&&(cc.toArray(r.image.data,4*i),r.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(t,e=-1,i=-1){this._initializeGeometry(t),this._validateGeometry(t);const n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const s=t.getIndex();if(null!==s&&(n.indexStart=this._nextIndexStart,n.reservedIndexCount=-1===i?s.count:i),-1!==n.indexStart&&n.indexStart+n.reservedIndexCount>this._maxIndexCount||n.vertexStart+n.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(nc),o=this._availableGeometryIds.shift(),r[o]=n):(o=this._geometryCount,this._geometryCount++,r.push(n)),this.setGeometryAt(o,t),this._nextIndexStart=n.indexStart+n.reservedIndexCount,this._nextVertexStart=n.vertexStart+n.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const i=this.geometry,n=null!==i.getIndex(),r=i.getIndex(),s=e.getIndex(),o=this._geometryInfo[t];if(n&&s.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const t in i.attributes){const n=e.getAttribute(t),r=i.getAttribute(t);yc(n,r,a);const s=n.itemSize;for(let t=n.count,e=c;t<e;t++){const e=a+t;for(let t=0;t<s;t++)r.setComponent(e,t,0)}r.needsUpdate=!0,r.addUpdateRange(a*s,c*s)}if(n){const t=o.indexStart,i=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<s.count;e++)r.setX(t+e,a+s.getX(e));for(let e=s.count,n=i;e<n;e++)r.setX(t+e,a);r.needsUpdate=!0,r.addUpdateRange(t,o.reservedIndexCount)}return o.start=n?o.indexStart:o.vertexStart,o.count=n?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const i=this._instanceInfo;for(let e=0,n=i.length;e<n;e++)i[e].active&&i[e].geometryIndex===t&&this.deleteInstance(e);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const i=this._geometryInfo,n=i.map(((t,e)=>e)).sort(((t,e)=>i[t].vertexStart-i[e].vertexStart)),r=this.geometry;for(let s=0,o=i.length;s<o;s++){const o=n[s],a=i[o];if(!1!==a.active){if(null!==r.index){if(a.indexStart!==e){const{indexStart:i,vertexStart:n,reservedIndexCount:s}=a,o=r.index,c=o.array,l=t-n;for(let t=i;t<i+s;t++)c[t]=c[t]+l;o.array.copyWithin(e,i,i+s),o.addUpdateRange(e,s),a.indexStart=e}e+=a.reservedIndexCount}if(a.vertexStart!==t){const{vertexStart:e,reservedVertexCount:i}=a,n=r.attributes;for(const r in n){const s=n[r],{array:o,itemSize:a}=s;o.copyWithin(t*a,e*a,(e+i)*a),s.addUpdateRange(t*a,i*a)}a.vertexStart=t}t+=a.reservedVertexCount,a.start=r.index?a.indexStart:a.vertexStart,this._nextIndexStart=r.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,n=this._geometryInfo[t];if(null===n.boundingBox){const t=new wr,e=i.index,r=i.attributes.position;for(let i=n.start,s=n.start+n.count;i<s;i++){let n=i;e&&(n=e.getX(n)),t.expandByPoint(pc.fromBufferAttribute(r,n))}n.boundingBox=t}return e.copy(n.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,n=this._geometryInfo[t];if(null===n.boundingSphere){const e=new Vr;this.getBoundingBoxAt(t,uc),uc.getCenter(e.center);const r=i.index,s=i.attributes.position;let o=0;for(let t=n.start,i=n.start+n.count;t<i;t++){let i=t;r&&(i=r.getX(i)),pc.fromBufferAttribute(s,i),o=Math.max(o,e.center.distanceToSquared(pc))}e.radius=Math.sqrt(o),n.boundingSphere=e}return e.copy(n.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const i=this._matricesTexture,n=this._matricesTexture.image.data;return e.toArray(n,16*t),i.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,e={}){this.validateGeometryId(t);const i=this._geometryInfo[t];return e.vertexStart=i.vertexStart,e.vertexCount=i.vertexCount,e.reservedVertexCount=i.reservedVertexCount,e.indexStart=i.indexStart,e.indexCount=i.indexCount,e.reservedIndexCount=i.reservedIndexCount,e.start=i.start,e.count=i.count,e}setInstanceCount(t){const e=this._availableInstanceIds,i=this._instanceInfo;for(e.sort(nc);e[e.length-1]===i.length;)i.pop(),e.pop();if(t<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const n=new Int32Array(t),r=new Int32Array(t);xc(this._multiDrawCounts,n),xc(this._multiDrawStarts,r),this._multiDrawCounts=n,this._multiDrawStarts=r,this._maxInstanceCount=t;const s=this._indirectTexture,o=this._matricesTexture,a=this._colorsTexture;s.dispose(),this._initIndirectTexture(),xc(s.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),xc(o.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),xc(a.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const i=[...this._geometryInfo].filter((t=>t.active));if(Math.max(...i.map((t=>t.vertexStart+t.reservedVertexCount)))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map((t=>t.indexStart+t.reservedIndexCount)))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const n=this.geometry;n.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new xo,this._initializeGeometry(n));const r=this.geometry;n.index&&xc(n.index.array,r.index.array);for(const t in n.attributes)xc(n.attributes[t].array,r.attributes[t].array)}raycast(t,e){const i=this._instanceInfo,n=this._geometryInfo,r=this.matrixWorld,s=this.geometry;vc.material=this.material,vc.geometry.index=s.index,vc.geometry.attributes=s.attributes,null===vc.geometry.boundingBox&&(vc.geometry.boundingBox=new wr),null===vc.geometry.boundingSphere&&(vc.geometry.boundingSphere=new Vr);for(let s=0,o=i.length;s<o;s++){if(!i[s].visible||!i[s].active)continue;const o=i[s].geometryIndex,a=n[o];vc.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(s,vc.matrixWorld).premultiply(r),this.getBoundingBoxAt(o,vc.geometry.boundingBox),this.getBoundingSphereAt(o,vc.geometry.boundingSphere),vc.raycast(t,_c);for(let t=0,i=_c.length;t<i;t++){const i=_c[t];i.object=this,i.batchId=s,e.push(i)}_c.length=0}vc.material=null,vc.geometry.index=null,vc.geometry.attributes={},vc.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map((t=>({...t,boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null}))),this._instanceInfo=t._instanceInfo.map((t=>({...t}))),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,i,n,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=n.getIndex(),o=null===s?1:s.array.BYTES_PER_ELEMENT,a=this._instanceInfo,c=this._multiDrawStarts,l=this._multiDrawCounts,h=this._geometryInfo,u=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data,f=i.isArrayCamera?hc:lc;u&&!i.isArrayCamera&&(ac.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),lc.setFromProjectionMatrix(ac,t.coordinateSystem));let m=0;if(this.sortObjects){ac.copy(this.matrixWorld).invert(),pc.setFromMatrixPosition(i.matrixWorld).applyMatrix4(ac),fc.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(ac);for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;this.getMatrixAt(t,ac),this.getBoundingSphereAt(e,dc).applyMatrix4(ac);let n=!1;if(u&&(n=!f.intersectsSphere(dc,i)),!n){const i=h[e],n=mc.subVectors(dc.center,pc).dot(fc);gc.push(i.start,i.count,n,t)}}const t=gc.list,e=this.customSort;null===e?t.sort(r.transparent?sc:rc):e.call(this,t,i);for(let e=0,i=t.length;e<i;e++){const i=t[e];c[m]=i.start*o,l[m]=i.count,p[m]=i.index,m++}gc.reset()}else for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;let n=!1;if(u&&(this.getMatrixAt(t,ac),this.getBoundingSphereAt(e,dc).applyMatrix4(ac),n=!f.intersectsSphere(dc,i)),!n){const i=h[e];c[m]=i.start*o,l[m]=i.count,p[m]=t,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(t,e,i,n,r,s){this.onBeforeRender(t,null,n,r,s)}}class Mc extends Xs{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Hs(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Sc=new br,wc=new br,Tc=new Jr,Ec=new Kr,Cc=new Vr,Pc=new br,Ac=new br;class Dc extends ws{constructor(t=new xo,e=new Mc){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Sc.fromBufferAttribute(e,t-1),wc.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Sc.distanceTo(wc);t.setAttribute("lineDistance",new uo(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Cc.copy(i.boundingSphere),Cc.applyMatrix4(n),Cc.radius+=r,!1===t.ray.intersectsSphere(Cc))return;Tc.copy(n).invert(),Ec.copy(t.ray).applyMatrix4(Tc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=this.isLineSegments?2:1,l=i.index,h=i.attributes.position;if(null!==l){const i=Math.max(0,s.start),n=Math.min(l.count,s.start+s.count);for(let r=i,s=n-1;r<s;r+=c){const i=l.getX(r),n=l.getX(r+1),s=Rc(this,t,Ec,a,i,n,r);s&&e.push(s)}if(this.isLineLoop){const r=l.getX(n-1),s=l.getX(i),o=Rc(this,t,Ec,a,r,s,n-1);o&&e.push(o)}}else{const i=Math.max(0,s.start),n=Math.min(h.count,s.start+s.count);for(let r=i,s=n-1;r<s;r+=c){const i=Rc(this,t,Ec,a,r,r+1,r);i&&e.push(i)}if(this.isLineLoop){const r=Rc(this,t,Ec,a,n-1,i,n-1);r&&e.push(r)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Rc(t,e,i,n,r,s,o){const a=t.geometry.attributes.position;if(Sc.fromBufferAttribute(a,r),wc.fromBufferAttribute(a,s),i.distanceSqToSegment(Sc,wc,Pc,Ac)>n)return;Pc.applyMatrix4(t.matrixWorld);const c=e.ray.origin.distanceTo(Pc);return c<e.near||c>e.far?void 0:{distance:c,point:Ac.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const kc=new br,Ic=new br;class Oc extends Dc{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)kc.fromBufferAttribute(e,t),Ic.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+kc.distanceTo(Ic);t.setAttribute("lineDistance",new uo(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Lc extends Dc{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Uc extends Xs{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Hs(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Nc=new Jr,Wc=new Kr,Fc=new Vr,Bc=new br;class zc extends ws{constructor(t=new xo,e=new Uc){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Fc.copy(i.boundingSphere),Fc.applyMatrix4(n),Fc.radius+=r,!1===t.ray.intersectsSphere(Fc))return;Nc.copy(n).invert(),Wc.copy(t.ray).applyMatrix4(Nc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=i.index,l=i.attributes.position;if(null!==c)for(let i=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);i<r;i++){const r=c.getX(i);Bc.fromBufferAttribute(l,r),Vc(Bc,r,a,n,t,e,this)}else for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++)Bc.fromBufferAttribute(l,i),Vc(Bc,i,a,n,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Vc(t,e,i,n,r,s,o){const a=Wc.distanceSqToPoint(t);if(a<i){const i=new br;Wc.closestPointToPoint(t,i),i.applyMatrix4(n);const c=r.ray.origin.distanceTo(i);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Hc extends dr{constructor(t,e,i,n,r=fe,s=fe,o,a,c){super(t,e,i,n,r,s,o,a,c),this.isVideoTexture=!0,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Gc extends Hc{constructor(t,e,i,n,r,s,o,a){super({},t,e,i,n,r,s,o,a),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class jc extends dr{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=le,this.minFilter=le,this.generateMipmaps=!1,this.needsUpdate=!0}}class Xc extends dr{constructor(t,e,i,n,r,s,o,a,c,l,h,u){super(null,s,o,a,c,l,n,r,h,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class qc extends Xc{constructor(t,e,i,n,r,s){super(t,e,i,r,s),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ae,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Yc extends Xc{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,ee),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class Zc extends dr{constructor(t,e,i,n,r,s,o,a,c){super(t,e,i,n,r,s,o,a,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Kc extends dr{constructor(t,e,i=we,n,r,s,o=le,a=le,c,l=Oe){if(l!==Oe&&l!==Le)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,n,r,s,o,a,l,i,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new lr(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class Jc extends Kc{constructor(t=1,e=1,i=1){super(t,e),this.isDepthArrayTexture=!0,this.image={width:t,height:e,depth:i},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class $c extends xo{constructor(t=1,e=1,i=4,n=8,r=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:i,radialSegments:n,heightSegments:r},e=Math.max(0,e),i=Math.max(1,Math.floor(i)),n=Math.max(3,Math.floor(n)),r=Math.max(1,Math.floor(r));const s=[],o=[],a=[],c=[],l=e/2,h=Math.PI/2*t,u=e,d=2*h+u,p=2*i+r,f=n+1,m=new br,g=new br;for(let v=0;v<=p;v++){let _=0,y=0,x=0,b=0;if(v<=i){const e=v/i,n=e*Math.PI/2;y=-l-t*Math.cos(n),x=t*Math.sin(n),b=-t*Math.cos(n),_=e*h}else if(v<=i+r){const n=(v-i)/r;y=n*e-l,x=t,b=0,_=h+n*u}else{const e=(v-i-r)/i,n=e*Math.PI/2;y=l+t*Math.sin(n),x=t*Math.cos(n),b=t*Math.sin(n),_=h+u+e*h}const M=Math.max(0,Math.min(1,_/d));let S=0;0===v?S=.5/n:v===p&&(S=-.5/n);for(let t=0;t<=n;t++){const e=t/n,i=e*Math.PI*2,r=Math.sin(i),s=Math.cos(i);g.x=-x*s,g.y=y,g.z=x*r,o.push(g.x,g.y,g.z),m.set(-x*s,b,x*r),m.normalize(),a.push(m.x,m.y,m.z),c.push(e+S,M)}if(v>0){const t=(v-1)*f;for(let e=0;e<n;e++){const i=t+e,n=t+e+1,r=v*f+e,o=v*f+e+1;s.push(i,n,r),s.push(n,o,r)}}}this.setIndex(s),this.setAttribute("position",new uo(o,3)),this.setAttribute("normal",new uo(a,3)),this.setAttribute("uv",new uo(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $c(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class Qc extends xo{constructor(t=1,e=32,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],o=[],a=[],c=new br,l=new Gn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;c.x=t*Math.cos(u),c.y=t*Math.sin(u),s.push(c.x,c.y,c.z),o.push(0,0,1),l.x=(s[h]/t+1)/2,l.y=(s[h+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new uo(s,3)),this.setAttribute("normal",new uo(o,3)),this.setAttribute("uv",new uo(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class tl extends xo{constructor(t=1,e=1,i=1,n=32,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const c=this;n=Math.floor(n),r=Math.floor(r);const l=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function v(i){const r=p,s=new Gn,f=new br;let v=0;const _=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=n;t++){const e=t/n*a+o,i=Math.cos(e),r=Math.sin(e);f.x=_*r,f.y=m*y,f.z=_*i,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?l.push(n,n+1,e):l.push(n+1,n,e),v+=3}c.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new br,v=new br;let _=0;const y=(e-t)/i;for(let c=0;c<=r;c++){const l=[],g=c/r,_=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*a+o,c=Math.sin(r),f=Math.cos(r);v.x=_*c,v.y=-g*i+m,v.z=_*f,h.push(v.x,v.y,v.z),s.set(c,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),l.push(p++)}f.push(l)}for(let i=0;i<n;i++)for(let n=0;n<r;n++){const s=f[n][i],o=f[n+1][i],a=f[n+1][i+1],c=f[n][i+1];(t>0||0!==n)&&(l.push(s,o,c),_+=3),(e>0||n!==r-1)&&(l.push(o,a,c),_+=3)}c.addGroup(g,_,0),g+=_}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new uo(h,3)),this.setAttribute("normal",new uo(u,3)),this.setAttribute("uv",new uo(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new tl(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class el extends tl{constructor(t=1,e=1,i=32,n=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new el(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class il extends xo{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function o(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=t.clone().lerp(i,n/r),a=e.clone().lerp(i,n/r),c=r-n;for(let t=0;t<=c;t++)s[n][t]=0===t&&n===r?o:o.clone().lerp(a,t/c)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(a(s[t][i+1]),a(s[t+1][i]),a(s[t][i])):(a(s[t][i+1]),a(s[t+1][i+1]),a(s[t+1][i]))}}function a(t){r.push(t.x,t.y,t.z)}function c(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function l(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new br,n=new br,r=new br;for(let s=0;s<e.length;s+=3)c(e[s+0],i),c(e[s+1],n),c(e[s+2],r),o(i,n,r,t)}(n),function(t){const e=new br;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new br;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=h(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-o)}var e;(function(){const t=new br,e=new br,i=new br,n=new br,o=new Gn,a=new Gn,c=new Gn;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),c.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=h(n);l(o,d+0,t,p),l(a,d+2,e,p),l(c,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new uo(r,3)),this.setAttribute("normal",new uo(r.slice(),3)),this.setAttribute("uv",new uo(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new il(t.vertices,t.indices,t.radius,t.details)}}class nl extends il{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new nl(t.radius,t.detail)}}const rl=new br,sl=new br,ol=new br,al=new Ws;class cl extends xo{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(Ln*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,c=[0,0,0],l=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(c[0]=s.getX(t),c[1]=s.getX(t+1),c[2]=s.getX(t+2)):(c[0]=t,c[1]=t+1,c[2]=t+2);const{a:e,b:i,c:a}=al;if(e.fromBufferAttribute(o,c[0]),i.fromBufferAttribute(o,c[1]),a.fromBufferAttribute(o,c[2]),al.getNormal(ol),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=al[l[t]],o=al[l[e]],a=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(ol.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:c[t],index1:c[e],normal:ol.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];rl.fromBufferAttribute(o,e),sl.fromBufferAttribute(o,i),d.push(rl.x,rl.y,rl.z),d.push(sl.x,sl.y,sl.z)}this.setAttribute("position",new uo(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class ll{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let o,a=0,c=r-1;for(;a<=c;)if(n=Math.floor(a+(c-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){c=n;break}c=n-1}if(n=c,i[n]===s)return n/(r-1);const l=i[n];return(n+(s-l)/(i[n+1]-l))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=e||(s.isVector2?new Gn:new br);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e=!1){const i=new br,n=[],r=[],s=[],o=new br,a=new Jr;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new br)}r[0]=new br,s[0]=new br;let c=Number.MAX_VALUE;const l=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);l<=c&&(c=l,i.set(1,0,0)),h<=c&&(c=h,i.set(0,1,0)),u<=c&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Wn(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(Wn(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class hl extends ll{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new Gn){const i=e,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=c-this.aY;a=i*t-n*e+this.aX,c=i*e+n*t+this.aY}return i.set(a,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ul extends hl{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function dl(){let t=0,e=0,i=0,n=0;function r(r,s,o,a){t=r,e=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,o,a){let c=(e-t)/s-(i-t)/(s+o)+(i-e)/o,l=(i-e)/o-(n-e)/(o+a)+(n-i)/a;c*=o,l*=o,r(e,i,c,l)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}const pl=new br,fl=new dl,ml=new dl,gl=new dl;class vl extends ll{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new br){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let o,a,c=Math.floor(s),l=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/r)+1)*r:0===l&&c===r-1&&(c=r-2,l=1),this.closed||c>0?o=n[(c-1)%r]:(pl.subVectors(n[0],n[1]).add(n[0]),o=pl);const h=n[c%r],u=n[(c+1)%r];if(this.closed||c+2<r?a=n[(c+2)%r]:(pl.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=pl),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),fl.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,n),ml.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,n),gl.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(fl.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),ml.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),gl.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(fl.calc(l),ml.calc(l),gl.calc(l)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new br).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function _l(t,e,i,n,r){const s=.5*(n-e),o=.5*(r-i),a=t*t;return(2*i-2*n+s+o)*(t*a)+(-3*i+3*n-2*s-o)*a+s*t+i}function yl(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function xl(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}class bl extends ll{constructor(t=new Gn,e=new Gn,i=new Gn,n=new Gn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Gn){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(xl(t,n.x,r.x,s.x,o.x),xl(t,n.y,r.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Ml extends ll{constructor(t=new br,e=new br,i=new br,n=new br){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new br){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(xl(t,n.x,r.x,s.x,o.x),xl(t,n.y,r.y,s.y,o.y),xl(t,n.z,r.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Sl extends ll{constructor(t=new Gn,e=new Gn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Gn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Gn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class wl extends ll{constructor(t=new br,e=new br){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new br){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new br){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Tl extends ll{constructor(t=new Gn,e=new Gn,i=new Gn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Gn){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(yl(t,n.x,r.x,s.x),yl(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class El extends ll{constructor(t=new br,e=new br,i=new br){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new br){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(yl(t,n.x,r.x,s.x),yl(t,n.y,r.y,s.y),yl(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Cl extends ll{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Gn){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],c=n[s],l=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(_l(o,a.x,c.x,l.x,h.x),_l(o,a.y,c.y,l.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Gn).fromArray(i))}return this}}var Pl=Object.freeze({__proto__:null,ArcCurve:ul,CatmullRomCurve3:vl,CubicBezierCurve:bl,CubicBezierCurve3:Ml,EllipseCurve:hl,LineCurve:Sl,LineCurve3:wl,QuadraticBezierCurve:Tl,QuadraticBezierCurve3:El,SplineCurve:Cl});class Al extends ll{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const i=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Pl[i](e,t))}return this}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Pl[i.type]).fromJSON(i))}return this}}class Dl extends Al{constructor(t){super(),this.type="Path",this.currentPoint=new Gn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Sl(this.currentPoint.clone(),new Gn(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Tl(this.currentPoint.clone(),new Gn(t,e),new Gn(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const o=new bl(this.currentPoint.clone(),new Gn(t,e),new Gn(i,n),new Gn(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Cl(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,o,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,i,n,r,s,o,a),this}absellipse(t,e,i,n,r,s,o,a){const c=new hl(t,e,i,n,r,s,o,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Rl extends Dl{constructor(t){super(t),this.uuid=Nn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Dl).fromJSON(i))}return this}}function kl(t,e,i,n,r){let s;if(r===function(t,e,i,n){let r=0;for(let s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,i,n)>0)for(let r=e;r<i;r+=n)s=th(r/n|0,t[r],t[r+1],s);else for(let r=i-n;r>=e;r-=n)s=th(r/n|0,t[r],t[r+1],s);return s&&Yl(s,s.next)&&(eh(s),s=s.next),s}function Il(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!Yl(n,n.next)&&0!==ql(n.prev,n,n.next))n=n.next;else{if(eh(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Ol(t,e,i,n,r,s,o){if(!t)return;!o&&s&&function(t,e,i,n){let r=t;do{0===r.z&&(r.z=Vl(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i=1;do{let n,r=t;t=null;let s=null;for(e=0;r;){e++;let o=r,a=0;for(let t=0;t<i&&(a++,o=o.nextZ,o);t++);let c=i;for(;a>0||c>0&&o;)0!==a&&(0===c||!o||r.z<=o.z)?(n=r,r=r.nextZ,a--):(n=o,o=o.nextZ,c--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=o}s.nextZ=null,i*=2}while(e>1)}(r)}(t,n,r,s);let a=t;for(;t.prev!==t.next;){const c=t.prev,l=t.next;if(s?Ul(t,n,r,s):Ll(t))e.push(c.i,t.i,l.i),eh(t),t=l.next,a=l.next;else if((t=l)===a){o?1===o?Ol(t=Nl(Il(t),e),e,i,n,r,s,2):2===o&&Wl(t,e,i,n,r,s):Ol(Il(t),e,i,n,r,s,1);break}}}function Ll(t){const e=t.prev,i=t,n=t.next;if(ql(e,i,n)>=0)return!1;const r=e.x,s=i.x,o=n.x,a=e.y,c=i.y,l=n.y,h=Math.min(r,s,o),u=Math.min(a,c,l),d=Math.max(r,s,o),p=Math.max(a,c,l);let f=n.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&jl(r,a,s,c,o,l,f.x,f.y)&&ql(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ul(t,e,i,n){const r=t.prev,s=t,o=t.next;if(ql(r,s,o)>=0)return!1;const a=r.x,c=s.x,l=o.x,h=r.y,u=s.y,d=o.y,p=Math.min(a,c,l),f=Math.min(h,u,d),m=Math.max(a,c,l),g=Math.max(h,u,d),v=Vl(p,f,e,i,n),_=Vl(m,g,e,i,n);let y=t.prevZ,x=t.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==o&&jl(a,h,c,u,l,d,y.x,y.y)&&ql(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&jl(a,h,c,u,l,d,x.x,x.y)&&ql(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==o&&jl(a,h,c,u,l,d,y.x,y.y)&&ql(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&jl(a,h,c,u,l,d,x.x,x.y)&&ql(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Nl(t,e){let i=t;do{const n=i.prev,r=i.next.next;!Yl(n,r)&&Zl(n,i,i.next,r)&&$l(n,r)&&$l(r,n)&&(e.push(n.i,i.i,r.i),eh(i),eh(i.next),i=t=r),i=i.next}while(i!==t);return Il(i)}function Wl(t,e,i,n,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Xl(o,t)){let a=Ql(o,t);return o=Il(o,o.next),a=Il(a,a.next),Ol(o,e,i,n,r,s,0),void Ol(a,e,i,n,r,s,0)}t=t.next}o=o.next}while(o!==t)}function Fl(t,e){let i=t.x-e.x;return 0===i&&(i=t.y-e.y,0===i)&&(i=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Bl(t,e){const i=function(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;if(Yl(t,i))return i;do{if(Yl(t,i.next))return i.next;if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o&&(o=t,s=i.x<i.next.x?i:i.next,t===n))return s}i=i.next}while(i!==e);if(!s)return null;const a=s,c=s.x,l=s.y;let h=1/0;i=s;do{if(n>=i.x&&i.x>=c&&n!==i.x&&Gl(r<l?n:o,r,c,l,r<l?o:n,r,i.x,i.y)){const e=Math.abs(r-i.y)/(n-i.x);$l(i,t)&&(e<h||e===h&&(i.x>s.x||i.x===s.x&&zl(s,i)))&&(s=i,h=e)}i=i.next}while(i!==a);return s}(t,e);if(!i)return e;const n=Ql(i,t);return Il(n,n.next),Il(i,i.next)}function zl(t,e){return ql(t.prev,t,e.prev)<0&&ql(e.next,t,t.next)<0}function Vl(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hl(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Gl(t,e,i,n,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function jl(t,e,i,n,r,s,o,a){return!(t===o&&e===a)&&Gl(t,e,i,n,r,s,o,a)}function Xl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Zl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&($l(t,e)&&$l(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(ql(t.prev,t,e.prev)||ql(t,e.prev,e))||Yl(t,e)&&ql(t.prev,t,t.next)>0&&ql(e.prev,e,e.next)>0)}function ql(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Yl(t,e){return t.x===e.x&&t.y===e.y}function Zl(t,e,i,n){const r=Jl(ql(t,e,i)),s=Jl(ql(t,e,n)),o=Jl(ql(i,n,t)),a=Jl(ql(i,n,e));return r!==s&&o!==a||!(0!==r||!Kl(t,i,e))||!(0!==s||!Kl(t,n,e))||!(0!==o||!Kl(i,t,n))||!(0!==a||!Kl(i,e,n))}function Kl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Jl(t){return t>0?1:t<0?-1:0}function $l(t,e){return ql(t.prev,t,t.next)<0?ql(t,e,t.next)>=0&&ql(t,t.prev,e)>=0:ql(t,e,t.prev)<0||ql(t,t.next,e)<0}function Ql(t,e){const i=ih(t.i,t.x,t.y),n=ih(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function th(t,e,i,n){const r=ih(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function eh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ih(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class nh{static triangulate(t,e,i=2){return function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=kl(t,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l;if(n&&(s=function(t,e,i,n){const r=[];for(let i=0,s=e.length;i<s;i++){const o=kl(t,e[i]*n,i<s-1?e[i+1]*n:t.length,n,!1);o===o.next&&(o.steiner=!0),r.push(Hl(o))}r.sort(Fl);for(let t=0;t<r.length;t++)i=Bl(r[t],i);return i}(t,e,s,i)),t.length>80*i){a=1/0,c=1/0;let e=-1/0,n=-1/0;for(let s=i;s<r;s+=i){const i=t[s],r=t[s+1];i<a&&(a=i),r<c&&(c=r),i>e&&(e=i),r>n&&(n=r)}l=Math.max(e-a,n-c),l=0!==l?32767/l:0}return Ol(s,o,i,a,c,l,0),o}(t,e,i)}}class rh{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return rh.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];sh(t),oh(i,t);let s=t.length;e.forEach(sh);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,oh(i,e[t]);const o=nh.triangulate(i,n);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function sh(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function oh(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ah extends xo{constructor(t=new Rl([new Gn(.5,.5),new Gn(-.5,.5),new Gn(-.5,-.5),new Gn(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,c=void 0!==e.depth?e.depth:1;let l=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:ch;let g,v,_,y,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,l=!1,v=f.computeFrenetFrames(a,!1),_=new br,y=new br,x=new br),l||(p=0,h=0,u=0,d=0);const M=t.extractPoints(o);let S=M.shape;const w=M.holes;if(!rh.isClockWise(S)){S=S.reverse();for(let t=0,e=w.length;t<e;t++){const e=w[t];rh.isClockWise(e)&&(w[t]=e.reverse())}}function T(t){const e=1e-10*1e-10;let i=t[0];for(let n=1;n<=t.length;n++){const r=n%t.length,s=t[r],o=s.x-i.x,a=s.y-i.y,c=o*o+a*a,l=Math.max(Math.abs(s.x),Math.abs(s.y),Math.abs(i.x),Math.abs(i.y));c<=e*l*l?(t.splice(r,1),n--):i=s}}T(S),w.forEach(T);const E=w.length,C=S;for(let t=0;t<E;t++){const e=w[t];S=S.concat(e)}function P(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,i)}const A=S.length;function D(t,e,i){let n,r,s;const o=t.x-e.x,a=t.y-e.y,c=i.x-t.x,l=i.y-t.y,h=o*o+a*a,u=o*l-a*c;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(c*c+l*l),p=e.x-a/u,f=e.y+o/u,m=((i.x-l/d-p)*l-(i.y+c/d-f)*c)/(o*l-a*c);n=p+o*m-t.x,r=f+a*m-t.y;const g=n*n+r*r;if(g<=2)return new Gn(n,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?c>Number.EPSILON&&(t=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new Gn(n/s,r/s)}const R=[];for(let t=0,e=C.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),R[t]=D(C[t],C[i],C[n]);const k=[];let I,O,L=R.concat();for(let t=0,e=E;t<e;t++){const e=w[t];I=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),I[t]=D(e[t],e[n],e[r]);k.push(I),L=L.concat(I)}if(0===p)O=rh.triangulateShape(C,w);else{const t=[],e=[];for(let i=0;i<p;i++){const n=i/p,r=h*Math.cos(n*Math.PI/2),s=u*Math.sin(n*Math.PI/2)+d;for(let e=0,i=C.length;e<i;e++){const i=P(C[e],R[e],s);F(i.x,i.y,-r),0===n&&t.push(i)}for(let t=0,i=E;t<i;t++){const i=w[t];I=k[t];const o=[];for(let t=0,e=i.length;t<e;t++){const e=P(i[t],I[t],s);F(e.x,e.y,-r),0===n&&o.push(e)}0===n&&e.push(o)}}O=rh.triangulateShape(t,e)}const U=O.length,N=u+d;for(let t=0;t<A;t++){const e=l?P(S[t],L[t],N):S[t];b?(y.copy(v.normals[0]).multiplyScalar(e.x),_.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(y).add(_),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<A;e++){const i=l?P(S[e],L[e],N):S[e];b?(y.copy(v.normals[t]).multiplyScalar(i.x),_.copy(v.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(y).add(_),F(x.x,x.y,x.z)):F(i.x,i.y,c/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=C.length;t<e;t++){const e=P(C[t],R[t],n);F(e.x,e.y,c+i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];I=k[t];for(let t=0,r=e.length;t<r;t++){const r=P(e[t],I[t],n);b?F(r.x,r.y+g[a-1].y,g[a-1].x+i):F(r.x,r.y,c+i)}}}function W(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=A*t,s=A*(t+1);z(e+n+i,e+r+i,e+r+s,e+n+s)}}}function F(t,e,i){s.push(t),s.push(e),s.push(i)}function B(t,e,r){V(t),V(e),V(r);const s=n.length/3,o=m.generateTopUV(i,n,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[2])}function z(t,e,r,s){V(t),V(e),V(s),V(e),V(r),V(s);const o=n.length/3,a=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function V(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(l){let t=0,e=A*t;for(let t=0;t<U;t++){const i=O[t];B(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=A*t;for(let t=0;t<U;t++){const i=O[t];B(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<U;t++){const e=O[t];B(e[2],e[1],e[0])}for(let t=0;t<U;t++){const e=O[t];B(e[0]+A*a,e[1]+A*a,e[2]+A*a)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;W(C,e),e+=C.length;for(let t=0,i=w.length;t<i;t++){const i=w[t];W(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new uo(n,3)),this.setAttribute("uv",new uo(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Pl[n.type]).fromJSON(n)),new ah(i,t.options)}}const ch={generateTopUV:function(t,e,i,n,r){const s=e[3*i],o=e[3*i+1],a=e[3*n],c=e[3*n+1],l=e[3*r],h=e[3*r+1];return[new Gn(s,o),new Gn(a,c),new Gn(l,h)]},generateSideWallUV:function(t,e,i,n,r,s){const o=e[3*i],a=e[3*i+1],c=e[3*i+2],l=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-l)?[new Gn(o,1-c),new Gn(l,1-u),new Gn(d,1-f),new Gn(m,1-v)]:[new Gn(a,1-c),new Gn(h,1-u),new Gn(p,1-f),new Gn(g,1-v)]}};class lh extends il{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new lh(t.radius,t.detail)}}class hh extends xo{constructor(t=[new Gn(0,-.5),new Gn(.5,0),new Gn(0,.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=Wn(n,0,2*Math.PI);const r=[],s=[],o=[],a=[],c=[],l=1/e,h=new br,u=new Gn,d=new br,p=new br,f=new br;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case t.length-1:a.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=e;r++){const d=i+r*l*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*f,s.push(h.x,h.y,h.z),u.x=r/e,u.y=i/(t.length-1),o.push(u.x,u.y);const n=a[3*i+0]*p,l=a[3*i+1],d=a[3*i+0]*f;c.push(n,l,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,o=n+t.length,a=n+t.length+1,c=n+1;r.push(s,o,c),r.push(a,c,o)}this.setIndex(r),this.setAttribute("position",new uo(s,3)),this.setAttribute("uv",new uo(o,2)),this.setAttribute("normal",new uo(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new hh(t.points,t.segments,t.phiStart,t.phiLength)}}class uh extends il{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new uh(t.radius,t.detail)}}class dh extends xo{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,o=Math.floor(i),a=Math.floor(n),c=o+1,l=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<l;t++){const e=t*u-s;for(let i=0;i<c;i++){const n=i*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+c*t,n=e+c*(t+1),r=e+1+c*(t+1),s=e+1+c*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new uo(p,3)),this.setAttribute("normal",new uo(f,3)),this.setAttribute("uv",new uo(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new dh(t.width,t.height,t.widthSegments,t.heightSegments)}}class ph extends xo{constructor(t=.5,e=1,i=32,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],c=[],l=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new br,p=new Gn;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),a.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,l.push(p.x,p.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,a=n+i+2,c=n+1;o.push(r,s,c),o.push(s,a,c)}}this.setIndex(o),this.setAttribute("position",new uo(a,3)),this.setAttribute("normal",new uo(c,3)),this.setAttribute("uv",new uo(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ph(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class fh extends xo{constructor(t=new Rl([new Gn(0,.5),new Gn(-.5,-.5),new Gn(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(o,a,e),o+=a,a=0;function c(t){const o=n.length/3,c=t.extractPoints(e);let l=c.shape;const h=c.holes;!1===rh.isClockWise(l)&&(l=l.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===rh.isClockWise(e)&&(h[t]=e.reverse())}const u=rh.triangulateShape(l,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+o,r=e[1]+o,s=e[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new uo(n,3)),this.setAttribute("normal",new uo(r,3)),this.setAttribute("uv",new uo(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new fh(i,t.curveSegments)}}class mh extends xo{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let c=0;const l=[],h=new br,u=new br,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let _=0;0===d&&0===s?_=.5/e:d===i&&a===Math.PI&&(_=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(n+a*r)*Math.sin(s+v*o),h.y=t*Math.cos(s+v*o),h.z=t*Math.sin(n+a*r)*Math.sin(s+v*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+_,1-v),g.push(c++)}l.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=l[t][n+1],r=l[t][n],o=l[t+1][n],c=l[t+1][n+1];(0!==t||s>0)&&d.push(e,r,c),(t!==i-1||a<Math.PI)&&d.push(r,o,c)}this.setIndex(d),this.setAttribute("position",new uo(p,3)),this.setAttribute("normal",new uo(f,3)),this.setAttribute("uv",new uo(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new mh(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class gh extends il{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new gh(t.radius,t.detail)}}class vh extends xo{constructor(t=1,e=.4,i=12,n=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],c=[],l=new br,h=new br,u=new br;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),o.push(h.x,h.y,h.z),l.x=t*Math.cos(p),l.y=t*Math.sin(p),u.subVectors(h,l).normalize(),a.push(u.x,u.y,u.z),c.push(d/n),c.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,o=(n+1)*(t-1)+e,a=(n+1)*t+e;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new uo(o,3)),this.setAttribute("normal",new uo(a,3)),this.setAttribute("uv",new uo(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vh(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class _h extends xo{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],c=[],l=[],h=new br,u=new br,d=new br,p=new br,f=new br,m=new br,g=new br;for(let o=0;o<=i;++o){const _=o/i*r*Math.PI*2;v(_,r,s,t,d),v(_+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),c.push(u.x,u.y,u.z),l.push(o/i),l.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;o.push(i,r,a),o.push(r,s,a)}function v(t,e,i,n,r){const s=Math.cos(t),o=Math.sin(t),a=i/e*t,c=Math.cos(a);r.x=n*(2+c)*.5*s,r.y=n*(2+c)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new uo(a,3)),this.setAttribute("normal",new uo(c,3)),this.setAttribute("uv",new uo(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _h(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class yh extends xo{constructor(t=new El(new br(-1,-1,0),new br(-1,1,0),new br(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new br,a=new br,c=new Gn;let l=new br;const h=[],u=[],d=[],p=[];function f(r){l=t.getPointAt(r/e,l);const c=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);a.x=s*c.x+r*d.x,a.y=s*c.y+r*d.y,a.z=s*c.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=l.x+i*a.x,o.y=l.y+i*a.y,o.z=l.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)c.x=t/e,c.y=i/n,d.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;p.push(i,r,o),p.push(r,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new uo(h,3)),this.setAttribute("normal",new uo(u,3)),this.setAttribute("uv",new uo(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new yh((new Pl[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class xh extends xo{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new br,r=new br;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,c=a.length;t<c;++t){const c=a[t],l=c.start;for(let t=l,a=l+c.count;t<a;t+=3)for(let a=0;a<3;a++){const c=o.getX(t+a),l=o.getX(t+(a+1)%3);n.fromBufferAttribute(s,c),r.fromBufferAttribute(s,l),!0===bh(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,c=3*t+(o+1)%3;n.fromBufferAttribute(s,a),r.fromBufferAttribute(s,c),!0===bh(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new uo(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function bh(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var Mh=Object.freeze({__proto__:null,BoxGeometry:Oo,CapsuleGeometry:$c,CircleGeometry:Qc,ConeGeometry:el,CylinderGeometry:tl,DodecahedronGeometry:nl,EdgesGeometry:cl,ExtrudeGeometry:ah,IcosahedronGeometry:lh,LatheGeometry:hh,OctahedronGeometry:uh,PlaneGeometry:dh,PolyhedronGeometry:il,RingGeometry:ph,ShapeGeometry:fh,SphereGeometry:mh,TetrahedronGeometry:gh,TorusGeometry:vh,TorusKnotGeometry:_h,TubeGeometry:yh,WireframeGeometry:xh});class Sh extends Xs{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Hs(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class wh extends Fo{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Th extends Xs{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Hs(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Hs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new as,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Eh extends Th{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Gn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Wn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Hs(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Hs(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Hs(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Ch extends Xs{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Hs(16777215),this.specular=new Hs(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Hs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new as,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ph extends Xs{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Hs(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Hs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Ah extends Xs{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Dh extends Xs{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Hs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Hs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new as,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Rh extends Xs{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Oi,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class kh extends Xs{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class Ih extends Xs{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Hs(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wi,this.normalScale=new Gn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Oh extends Mc{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Lh(t,e){return t&&t.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function Uh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Nh(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function Wh(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[o++]=t[n+i]}return r}function Fh(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(e.push(s.time),i.push(...o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(e.push(s.time),o.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(e.push(s.time),i.push(o)),s=t[r++]}while(void 0!==s)}class Bh{static convertArray(t,e){return Lh(t,e)}static isTypedArray(t){return Uh(t)}static getKeyframeOrder(t){return Nh(t)}static sortedArray(t,e,i){return Wh(t,e,i)}static flattenJSON(t,e,i,n){Fh(t,e,i,n)}static subclip(t,e,i,n,r=30){return function(t,e,i,n,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){c.push(e.times[t]);for(let i=0;i<a;++i)l.push(e.values[t*a+i])}}0!==c.length&&(e.times=Lh(c,e.times.constructor),e.values=Lh(l,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s}(t,e,i,n,r)}static makeClipAdditive(t,e=0,i=t,n=30){return function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const c=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=a,e=c-a;d=n.values.slice(t,e)}else if(s>=n.times[u]){const t=u*c+a,e=t+c-a;d=n.values.slice(t,e)}else{const t=n.createInterpolant(),e=a,i=c-a;t.evaluate(s),d=t.resultBuffer.slice(e,i)}"quaternion"===r&&(new xr).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+l;if("quaternion"===r)xr.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*l;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=Di,t}(t,e,i,n)}}class zh{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Vh extends zh{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ei,endingEnd:Ei}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case Ci:r=t,o=2*e-i;break;case Pi:r=n.length-2,o=e+n[r]-n[r+1];break;default:r=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Ci:s=t,a=2*i-e;break;case Pi:s=1,a=i+n[1]-n[0];break;default:s=t-1,a=e}const c=.5*(i-e),l=this.valueSize;this._weightPrev=c/(e-o),this._weightNext=c/(a-i),this._offsetPrev=r*l,this._offsetNext=s*l}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,_=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[l+t]+v*s[c+t]+_*s[a+t]+y*s[h+t];return r}}class Hh extends zh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=(i-e)/(n-e),h=1-l;for(let t=0;t!==o;++t)r[t]=s[c+t]*h+s[a+t]*l;return r}}class Gh extends zh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class jh{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Lh(e,this.TimeBufferType),this.values=Lh(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Lh(t.times,Array),values:Lh(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Gh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Hh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Vh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Si:e=this.InterpolantFactoryMethodDiscrete;break;case wi:e=this.InterpolantFactoryMethodLinear;break;case Ti:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Si;case this.InterpolantFactoryMethodLinear:return wi;case this.InterpolantFactoryMethodSmooth:return Ti}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=i.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&Uh(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===Ti,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)r=!0;else{const t=o*i,n=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const n=o*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,o=0;o!==i;++o)e[n+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}jh.prototype.ValueTypeName="",jh.prototype.TimeBufferType=Float32Array,jh.prototype.ValueBufferType=Float32Array,jh.prototype.DefaultInterpolation=wi;class Xh extends jh{constructor(t,e,i){super(t,e,i)}}Xh.prototype.ValueTypeName="bool",Xh.prototype.ValueBufferType=Array,Xh.prototype.DefaultInterpolation=Si,Xh.prototype.InterpolantFactoryMethodLinear=void 0,Xh.prototype.InterpolantFactoryMethodSmooth=void 0;class qh extends jh{constructor(t,e,i,n){super(t,e,i,n)}}qh.prototype.ValueTypeName="color";class Yh extends jh{constructor(t,e,i,n){super(t,e,i,n)}}Yh.prototype.ValueTypeName="number";class Zh extends zh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let c=t*o;for(let t=c+o;c!==t;c+=4)xr.slerpFlat(r,0,s,c-o,s,c,a);return r}}class Kh extends jh{constructor(t,e,i,n){super(t,e,i,n)}InterpolantFactoryMethodLinear(t){return new Zh(this.times,this.values,this.getValueSize(),t)}}Kh.prototype.ValueTypeName="quaternion",Kh.prototype.InterpolantFactoryMethodSmooth=void 0;class Jh extends jh{constructor(t,e,i){super(t,e,i)}}Jh.prototype.ValueTypeName="string",Jh.prototype.ValueBufferType=Array,Jh.prototype.DefaultInterpolation=Si,Jh.prototype.InterpolantFactoryMethodLinear=void 0,Jh.prototype.InterpolantFactoryMethodSmooth=void 0;class $h extends jh{constructor(t,e,i,n){super(t,e,i,n)}}$h.prototype.ValueTypeName="vector";class Qh{constructor(t="",e=-1,i=[],n=Ai){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Nn(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(tu(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(jh.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const c=Nh(o);o=Wh(o,1,c),a=Wh(a,1,c),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Yh(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],o=[];Fh(i,s,o,n),0!==s.length&&r.push(new t(e,s,o))}},n=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const r=c[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Yh(".morphTargetInfluence["+i+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";i($h,s+".position",r,"pos",n),i(Kh,s+".quaternion",r,"rot",n),i($h,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function tu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Yh;case"vector":case"vector2":case"vector3":case"vector4":return $h;case"color":return qh;case"quaternion":return Kh;case"bool":case"boolean":return Xh;case"string":return Jh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Fh(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const eu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class iu{constructor(t,e,i){const n=this;let r,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===s&&void 0!==n.onStart&&n.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=c.length;e<i;e+=2){const i=c[e],n=c[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const nu=new iu;class ru{constructor(t){this.manager=void 0!==t?t:nu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}ru.DEFAULT_MATERIAL_NAME="__DEFAULT";const su={};class ou extends Error{constructor(t,e){super(t),this.response=e}}class au extends ru{constructor(t){super(t),this.mimeType="",this.responseType=""}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=eu.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==su[t])return void su[t].push({onLoad:e,onProgress:i,onError:n});su[t]=[],su[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=su[t],n=e.body.getReader(),r=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const c=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}),(e=>{t.error(e)}))}()}});return new Response(c)}throw new ou(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(""===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{eu.add(t,e);const i=su[t];delete su[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=su[t];if(void 0===i)throw this.manager.itemError(t),e;delete su[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class cu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new au(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=Qh.parse(t[i]);e.push(n)}return e}}class lu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],o=new Xc,a=new au(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let c=0;function l(l){a.load(t[l],(function(t){const i=r.parse(t,!0);s[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},c+=1,6===c&&(1===i.mipmapCount&&(o.minFilter=fe),o.image=s,o.format=i.format,o.needsUpdate=!0,e&&e(o))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)l(e);else a.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=fe),o.format=i.format,o.needsUpdate=!0,e&&e(o)}),i,n);return o}}class hu extends ru{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=eu.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=Kn("img");function a(){l(),eu.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(e){l(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class uu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=new qo;r.colorSpace=zi;const s=new hu(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(t[i],(function(t){r.images[i]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)a(e);return r}}class du extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new Oa,o=new au(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){let i;try{i=r.parse(t)}catch(t){if(void 0===n)return void console.error(t);n(t)}void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:ae,s.wrapT=void 0!==i.wrapT?i.wrapT:ae,s.magFilter=void 0!==i.magFilter?i.magFilter:fe,s.minFilter=void 0!==i.minFilter?i.minFilter:fe,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace&&(s.colorSpace=i.colorSpace),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=ve),1===i.mipmapCount&&(s.minFilter=fe),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i)}),i,n),s}}class pu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=new dr,s=new hu(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class fu extends ws{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Hs(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class mu extends fu{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ws.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Hs(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const gu=new Jr,vu=new br,_u=new br;class yu{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Gn(512,512),this.mapType=ye,this.map=null,this.mapPass=null,this.matrix=new Jr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qa,this._frameExtents=new Gn(1,1),this._viewportCount=1,this._viewports=[new pr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;vu.setFromMatrixPosition(t.matrixWorld),e.position.copy(vu),_u.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(_u),e.updateMatrixWorld(),gu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(gu)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class xu extends yu{constructor(){super(new Go(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*Un*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class bu extends fu{constructor(t,e,i=0,n=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ws.DEFAULT_UP),this.updateMatrix(),this.target=new ws,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new xu}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const Mu=new Jr,Su=new br,wu=new br;class Tu extends yu{constructor(){super(new Go(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Gn(4,2),this._viewportCount=6,this._viewports=[new pr(2,1,1,1),new pr(0,1,1,1),new pr(3,1,1,1),new pr(1,1,1,1),new pr(3,0,1,1),new pr(1,0,1,1)],this._cubeDirections=[new br(1,0,0),new br(-1,0,0),new br(0,0,1),new br(0,0,-1),new br(0,1,0),new br(0,-1,0)],this._cubeUps=[new br(0,1,0),new br(0,1,0),new br(0,1,0),new br(0,1,0),new br(0,0,1),new br(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Su.setFromMatrixPosition(t.matrixWorld),i.position.copy(Su),wu.copy(i.position),wu.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(wu),i.updateMatrixWorld(),n.makeTranslation(-Su.x,-Su.y,-Su.z),Mu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mu)}}class Eu extends fu{constructor(t,e,i=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Tu}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Cu extends Bo{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class Pu extends yu{constructor(){super(new Cu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Au extends fu{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ws.DEFAULT_UP),this.updateMatrix(),this.target=new ws,this.shadow=new Pu}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Du extends fu{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ru extends fu{constructor(t,e,i=10,n=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class ku{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new br)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}class Iu extends fu{constructor(t=new ku,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Ou extends ru{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new au(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=this.createMaterialFromType(t.type);if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new Hs).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(n.dispersion=t.dispersion),void 0!==t.iridescence&&(n.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(n.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(n.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(n.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(n.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(n.depthFunc=t.depthFunc),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(n.blendSrc=t.blendSrc),void 0!==t.blendDst&&(n.blendDst=t.blendDst),void 0!==t.blendEquation&&(n.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(n.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(n.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(n.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==n.blendColor&&n.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(n.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),void 0!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(n.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new Hs).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Gn).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new br).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new pr).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new jn).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Jr).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(n.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(n.lights=t.lights),void 0!==t.clipping&&(n.clipping=t.clipping),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Gn).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapRotation&&n.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Gn).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(n.iridescenceMap=i(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(n.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.anisotropyMap&&(n.anisotropyMap=i(t.anisotropyMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return Ou.createMaterialFromType(t)}static createMaterialFromType(t){return new{ShadowMaterial:Sh,SpriteMaterial:ra,RawShaderMaterial:wh,ShaderMaterial:Fo,PointsMaterial:Uc,MeshPhysicalMaterial:Eh,MeshStandardMaterial:Th,MeshPhongMaterial:Ch,MeshToonMaterial:Ph,MeshNormalMaterial:Ah,MeshLambertMaterial:Dh,MeshDepthMaterial:Rh,MeshDistanceMaterial:kh,MeshBasicMaterial:qs,MeshMatcapMaterial:Ih,LineDashedMaterial:Oh,LineBasicMaterial:Mc,Material:Xs}[t]}}class Lu{static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Uu extends xo{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Nu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new au(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),o=Zn(r.type,s),a=new ea(o,r.stride);return a.uuid=r.uuid,e[n]=a,a}const r=t.isInstancedBufferGeometry?new Uu:new xo,s=t.data.index;if(void 0!==s){const t=Zn(s.type,s.array);r.setIndex(new io(t,1))}const o=t.data.attributes;for(const e in o){const i=o[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new na(e,i.itemSize,i.offset,i.normalized)}else{const t=Zn(i.type,i.array);s=new(i.isInstancedBufferAttribute?Wa:io)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),r.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const i=a[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let o;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);o=new na(e,r.itemSize,r.offset,r.normalized)}else{const t=Zn(r.type,r.array);o=new io(t,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];r.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new br;void 0!==l.center&&t.fromArray(l.center),r.boundingSphere=new Vr(t,l.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class Wu extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Lu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new au(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==n&&n(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);r.parse(s,e)}),i,n)}async loadAsync(t,e){const i=""===this.path?Lu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new au(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(c)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,r,a,o,i),l=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,l),this.bindLightTargets(c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(c)}return c}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,n,o,s,e),c=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,c),this.bindLightTargets(a),a}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Rl).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Na).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Nu;for(let r=0,s=t.length;r<s;r++){let s;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(o);break;default:o.type in Mh?s=Mh[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Ou;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=Qh.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:Zn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new iu(e);r=new hu(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){const t=[];for(let e=0,i=r.length;e<i;e++){const i=s(r[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Oa(i.data,i.width,i.height)))}n[i.uuid]=new lr(t)}else{const t=s(i.url);n[i.uuid]=new lr(t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:Zn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new hu(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],n=await r(i);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Oa(n.data,n.width,n.height)))}i[n.uuid]=new lr(t)}else{const t=await r(n.url);i[n.uuid]=new lr(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image],a=o.data;let c;Array.isArray(a)?(c=new qo,6===a.length&&(c.needsUpdate=!0)):(c=a&&a.data?new Oa:new dr,a&&(c.needsUpdate=!0)),c.source=o,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=i(s.mapping,Fu)),void 0!==s.channel&&(c.channel=s.channel),void 0!==s.offset&&c.offset.fromArray(s.offset),void 0!==s.repeat&&c.repeat.fromArray(s.repeat),void 0!==s.center&&c.center.fromArray(s.center),void 0!==s.rotation&&(c.rotation=s.rotation),void 0!==s.wrap&&(c.wrapS=i(s.wrap[0],Bu),c.wrapT=i(s.wrap[1],Bu)),void 0!==s.format&&(c.format=s.format),void 0!==s.internalFormat&&(c.internalFormat=s.internalFormat),void 0!==s.type&&(c.type=s.type),void 0!==s.colorSpace&&(c.colorSpace=s.colorSpace),void 0!==s.minFilter&&(c.minFilter=i(s.minFilter,zu)),void 0!==s.magFilter&&(c.magFilter=i(s.magFilter,zu)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),void 0!==s.flipY&&(c.flipY=s.flipY),void 0!==s.generateMipmaps&&(c.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(c.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(c.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(c.compareFunction=s.compareFunction),void 0!==s.userData&&(c.userData=s.userData),n[s.uuid]=c}return n}parseObject(t,e,i,n,r){let s,o,a;function c(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new ta,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Hs(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new Qo(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new $o(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&s.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(s.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&s.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":s=new Go(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Cu(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Du(t.color,t.intensity);break;case"DirectionalLight":s=new Au(t.color,t.intensity),s.target=t.target||"";break;case"PointLight":s=new Eu(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Ru(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new bu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),s.target=t.target||"";break;case"HemisphereLight":s=new mu(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Iu).fromJSON(t);break;case"SkinnedMesh":o=c(t.geometry),a=l(t.material),s=new ka(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=c(t.geometry),a=l(t.material),s=new ko(o,a);break;case"InstancedMesh":o=c(t.geometry),a=l(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new Xa(o,a,e),s.instanceMatrix=new Wa(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new Wa(new Float32Array(n.array),n.itemSize));break;case"BatchedMesh":o=c(t.geometry),a=l(t.material),s=new bc(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,a),s.geometry=o,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._geometryInfo=t.geometryInfo.map((t=>{let e=null,i=null;return void 0!==t.boundingBox&&(e=new wr,e.min.fromArray(t.boundingBox.min),e.max.fromArray(t.boundingBox.max)),void 0!==t.boundingSphere&&(i=new Vr,i.radius=t.boundingSphere.radius,i.center.fromArray(t.boundingSphere.center)),{...t,boundingBox:e,boundingSphere:i}})),s._instanceInfo=t.instanceInfo,s._availableInstanceIds=t._availableInstanceIds,s._availableGeometryIds=t._availableGeometryIds,s._nextIndexStart=t.nextIndexStart,s._nextVertexStart=t.nextVertexStart,s._geometryCount=t.geometryCount,s._maxInstanceCount=t.maxInstanceCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._matricesTexture=h(t.matricesTexture.uuid),s._indirectTexture=h(t.indirectTexture.uuid),void 0!==t.colorsTexture&&(s._colorsTexture=h(t.colorsTexture.uuid)),void 0!==t.boundingSphere&&(s.boundingSphere=new Vr,s.boundingSphere.center.fromArray(t.boundingSphere.center),s.boundingSphere.radius=t.boundingSphere.radius),void 0!==t.boundingBox&&(s.boundingBox=new wr,s.boundingBox.min.fromArray(t.boundingBox.min),s.boundingBox.max.fromArray(t.boundingBox.max));break;case"LOD":s=new Ma;break;case"Line":s=new Dc(c(t.geometry),l(t.material));break;case"LineLoop":s=new Lc(c(t.geometry),l(t.material));break;case"LineSegments":s=new Oc(c(t.geometry),l(t.material));break;case"PointCloud":case"Points":s=new zc(c(t.geometry),l(t.material));break;case"Sprite":s=new _a(l(t.material));break;case"Group":s=new Zo;break;case"Bone":s=new Ia;break;default:s=new ws}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(s.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance,i.hysteresis)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}bindLightTargets(t){t.traverse((function(e){if(e.isDirectionalLight||e.isSpotLight){const i=e.target,n=t.getObjectByProperty("uuid",i);e.target=void 0!==n?n:new ws}}))}}const Fu={UVMapping:te,CubeReflectionMapping:ee,CubeRefractionMapping:ie,EquirectangularReflectionMapping:ne,EquirectangularRefractionMapping:re,CubeUVReflectionMapping:se},Bu={RepeatWrapping:oe,ClampToEdgeWrapping:ae,MirroredRepeatWrapping:ce},zu={NearestFilter:le,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:de,LinearFilter:fe,LinearMipmapNearestFilter:me,LinearMipmapLinearFilter:ve};class Vu extends ru{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=eu.get(t);if(void 0!==s)return r.manager.itemStart(t),s.then?void s.then((i=>{e&&e(i),r.manager.itemEnd(t)})).catch((t=>{n&&n(t)})):(setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;const a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){return eu.add(t,i),e&&e(i),r.manager.itemEnd(t),i})).catch((function(e){n&&n(e),eu.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)}));eu.add(t,a),r.manager.itemStart(t)}}let Hu;class Gu{static getContext(){return void 0===Hu&&(Hu=new(window.AudioContext||window.webkitAudioContext)),Hu}static setContext(t){Hu=t}}class ju extends ru{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new au(this.manager);function o(e){n?n(e):console.error(e),r.manager.itemError(t)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){try{const i=t.slice(0);Gu.getContext().decodeAudioData(i,(function(t){e(t)})).catch(o)}catch(t){o(t)}}),i,n)}}const Xu=new Jr,qu=new Jr,Yu=new Jr;class Zu{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Go,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Go,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Yu.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(Ln*e.fov*.5)/e.zoom;let s,o;qu.elements[12]=-i,Xu.elements[12]=i,s=-r*e.aspect+n,o=r*e.aspect+n,Yu.elements[0]=2*e.near/(o-s),Yu.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(Yu),s=-r*e.aspect-n,o=r*e.aspect-n,Yu.elements[0]=2*e.near/(o-s),Yu.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(Yu)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(qu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Xu)}}class Ku extends Go{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class Ju{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$u(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=$u();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function $u(){return performance.now()}const Qu=new br,td=new xr,ed=new br,id=new br;class nd extends ws{constructor(){super(),this.type="AudioListener",this.context=Gu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ju}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Qu,td,ed),id.set(0,0,-1).applyQuaternion(td),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Qu.x,t),e.positionY.linearRampToValueAtTime(Qu.y,t),e.positionZ.linearRampToValueAtTime(Qu.z,t),e.forwardX.linearRampToValueAtTime(id.x,t),e.forwardY.linearRampToValueAtTime(id.y,t),e.forwardZ.linearRampToValueAtTime(id.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(Qu.x,Qu.y,Qu.z),e.setOrientation(id.x,id.y,id.z,i.x,i.y,i.z)}}class rd extends ws{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(t=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),"buffer"!==t.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const sd=new br,od=new xr,ad=new br,cd=new br;class ld extends rd{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(sd,od,ad),cd.set(0,0,1).applyQuaternion(od);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(sd.x,t),e.positionY.linearRampToValueAtTime(sd.y,t),e.positionZ.linearRampToValueAtTime(sd.z,t),e.orientationX.linearRampToValueAtTime(cd.x,t),e.orientationY.linearRampToValueAtTime(cd.y,t),e.orientationZ.linearRampToValueAtTime(cd.z,t)}else e.setPosition(sd.x,sd.y,sd.z),e.setOrientation(cd.x,cd.y,cd.z)}}class hd{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class ud{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){xr.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;xr.multiplyQuaternionsFlat(t,s,t,e,t,i),xr.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[i+o]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const dd="\\[\\]\\.:\\/",pd=new RegExp("["+dd+"]","g"),fd="[^"+dd+"]",md="[^"+dd.replace("\\.","")+"]",gd=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",fd)+/(WCOD+)?/.source.replace("WCOD",md)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fd)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fd)+"$"),vd=["material","materials","bones","map"];class _d{constructor(t,e,i){this.path=e,this.parsedPath=i||_d.parseTrackName(e),this.node=_d.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new _d.Composite(t,e,i):new _d(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(pd,"")}static parseTrackName(t){const e=gd.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==vd.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=_d.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?o=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}_d.Composite=class{constructor(t,e,i){const n=i||_d.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},_d.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},_d.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},_d.prototype.GetterByBindingType=[_d.prototype._getValue_direct,_d.prototype._getValue_array,_d.prototype._getValue_arrayElement,_d.prototype._getValue_toArray],_d.prototype.SetterByBindingTypeAndVersioning=[[_d.prototype._setValue_direct,_d.prototype._setValue_direct_setNeedsUpdate,_d.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[_d.prototype._setValue_array,_d.prototype._setValue_array_setNeedsUpdate,_d.prototype._setValue_array_setMatrixWorldNeedsUpdate],[_d.prototype._setValue_arrayElement,_d.prototype._setValue_arrayElement_setNeedsUpdate,_d.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[_d.prototype._setValue_fromArray,_d.prototype._setValue_fromArray_setNeedsUpdate,_d.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class yd{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Nn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let o,a=t.length,c=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const h=arguments[l],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new _d(h,i[t],n[t]))}else if(d<c){o=t[d];const a=--c,l=t[a];e[l.uuid]=d,t[d]=l,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new _d(h,i[t],n[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,c=e[a];if(void 0!==c&&c>=r){const s=r++,l=t[s];e[l.uuid]=c,t[c]=l,e[a]=s,t[s]=o;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[c];e[c]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<r){const o=--r,a=t[o],l=--s,h=t[l];e[a.uuid]=c,t[c]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[o],r=e[l];e[c]=n,e[o]=r,e.pop()}}else{const r=--s,o=t[r];r>0&&(e[o.uuid]=c),t[c]=o,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[c]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,o=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,h=new Array(c);n=r.length,i[t]=n,s.push(t),o.push(e),r.push(h);for(let i=l,n=a.length;i!==n;++i){const n=a[i];h[i]=new _d(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=i,s[i]=a,s.pop(),r[i]=r[o],r.pop(),n[i]=n[o],n.pop()}}}class xd{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:Ei,endingEnd:Ei};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=bi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i=!1){if(t.fadeOut(e),this.fadeIn(e),!0===i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i=!1){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=r,a[1]=r+i,c[0]=t/s,c[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===Di)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=i===Mi;if(0===t)return-1===r||!s||1&~r?n:e-n;if(i===xi){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&!(1&~r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Ci,n.endingEnd=Ci):(n.endingStart=t?this.zeroSlopeAtStart?Ci:Ei:Pi,n.endingEnd=e?this.zeroSlopeAtEnd?Ci:Ei:Pi)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=i,this}}const bd=new Float32Array(1);class Md extends kn{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==r;++t){const r=n[t],c=r.name;let h=l[c];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,c));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new ud(_d.create(i,c,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,c),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Hh(new Float32Array(2),new Float32Array(2),1,bd),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?Qh.findByName(n,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let c=null;if(void 0===i&&(i=null!==s?s.blendMode:Ai),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;c=a.knownActions[0],null===s&&(s=c._clip)}if(null===s)return null;const l=new xd(this,s,e,i);return this._bindAction(l,c),this._addInactiveAction(l,o,r),l}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?Qh.findByName(i,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o)e[o]._update(n,t,r,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Sd extends fr{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isRenderTarget3D=!0,this.depth=i,this.texture=new _r(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class wd extends fr{constructor(t=1,e=1,i=1,n={}){super(t,e,n),this.isRenderTargetArray=!0,this.depth=i,this.texture=new gr(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class Td{constructor(t){this.value=t}clone(){return new Td(void 0===this.value.clone?this.value:this.value.clone())}}let Ed=0;class Cd extends kn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ed++}),this.name="",this.usage=gn,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,i=e.length;t<i;t++){const i=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0;t<i.length;t++)this.uniforms.push(i[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class Pd extends ea{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class Ad{constructor(t,e,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const Dd=new Jr;class Rd{constructor(t,e,i=0,n=1/0){this.ray=new Kr(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new cs,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Dd.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Dd),this}intersectObject(t,e=!0,i=[]){return Id(t,this,i,e),i.sort(kd),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)Id(t[n],this,i,e);return i.sort(kd),i}}function kd(t,e){return t.distance-e.distance}function Id(t,e,i,n){let r=!0;if(t.layers.test(e.layers)&&!1===t.raycast(e,i)&&(r=!1),!0===r&&!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)Id(n[t],e,i,!0)}}class Od{constructor(t=1,e=0,i=0){this.radius=t,this.phi=e,this.theta=i}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Wn(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Wn(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Ld{constructor(t=1,e=0,i=0){this.radius=t,this.theta=e,this.y=i}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class Ud{constructor(t,e,i,n){Ud.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,i,n)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let i=0;i<4;i++)this.elements[i]=t[i+e];return this}set(t,e,i,n){const r=this.elements;return r[0]=t,r[2]=e,r[1]=i,r[3]=n,this}}const Nd=new Gn;class Wd{constructor(t=new Gn(1/0,1/0),e=new Gn(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Nd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Nd).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Fd=new br,Bd=new br;class zd{constructor(t=new br,e=new br){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Fd.subVectors(t,this.start),Bd.subVectors(this.end,this.start);const i=Bd.dot(Bd);let n=Bd.dot(Fd)/i;return e&&(n=Wn(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Vd=new br;class Hd extends ws{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const i=new xo,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new uo(n,3));const r=new Mc({fog:!1,toneMapped:!1});this.cone=new Oc(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Vd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Vd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Gd=new br,jd=new Jr,Xd=new Jr;class qd extends Oc{constructor(t){const e=Yd(t),i=new xo,n=[],r=[],s=new Hs(0,0,1),o=new Hs(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new uo(n,3)),i.setAttribute("color",new uo(r,3)),super(i,new Mc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Xd.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(jd.multiplyMatrices(Xd,r.matrixWorld),Gd.setFromMatrixPosition(jd),n.setXYZ(i,Gd.x,Gd.y,Gd.z),jd.multiplyMatrices(Xd,r.parent.matrixWorld),Gd.setFromMatrixPosition(jd),n.setXYZ(i+1,Gd.x,Gd.y,Gd.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Yd(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push(...Yd(t.children[i]));return e}class Zd extends ko{constructor(t,e,i){super(new mh(e,4,2),new qs({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Kd=new br,Jd=new Hs,$d=new Hs;class Qd extends ws{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new uh(e);n.rotateY(.5*Math.PI),this.material=new qs({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new io(s,3)),this.add(new ko(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Jd.copy(this.light.color),$d.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?Jd:$d;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Kd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class tp extends Oc{constructor(t=10,e=10,i=4473924,n=8947848){i=new Hs(i),n=new Hs(n);const r=e/2,s=t/e,o=t/2,a=[],c=[];for(let t=0,l=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===r?i:n;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new xo;l.setAttribute("position",new uo(a,3)),l.setAttribute("color",new uo(c,3)),super(l,new Mc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ep extends Oc{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new Hs(r),s=new Hs(s);const o=[],a=[];if(e>1)for(let i=0;i<e;i++){const n=i/e*(2*Math.PI),c=Math.sin(n)*t,l=Math.cos(n)*t;o.push(0,0,0),o.push(c,0,l);const h=1&i?r:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<i;e++){const c=1&e?r:s,l=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*l,r=Math.cos(e)*l;o.push(i,0,r),a.push(c.r,c.g,c.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*l,r=Math.cos(e)*l,o.push(i,0,r),a.push(c.r,c.g,c.b)}}const c=new xo;c.setAttribute("position",new uo(o,3)),c.setAttribute("color",new uo(a,3)),super(c,new Mc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const ip=new br,np=new br,rp=new br;class sp extends ws{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===e&&(e=1);let n=new xo;n.setAttribute("position",new uo([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Mc({fog:!1,toneMapped:!1});this.lightPlane=new Dc(n,r),this.add(this.lightPlane),n=new xo,n.setAttribute("position",new uo([0,0,0,0,0,1],3)),this.targetLine=new Dc(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),ip.setFromMatrixPosition(this.light.matrixWorld),np.setFromMatrixPosition(this.light.target.matrixWorld),rp.subVectors(np,ip),this.lightPlane.lookAt(np),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(np),this.targetLine.scale.z=rp.length()}}const op=new br,ap=new Bo;class cp extends Oc{constructor(t){const e=new xo,i=new Mc({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function o(t,e){a(t),a(e)}function a(t){n.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new uo(n,3)),e.setAttribute("color",new uo(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const c=new Hs(16755200),l=new Hs(16711680),h=new Hs(43775),u=new Hs(16777215),d=new Hs(3355443);this.setColors(c,l,h,u,d)}setColors(t,e,i,n,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;ap.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const i=this.camera.coordinateSystem===Cn?-1:0;lp("c",e,t,ap,0,0,i),lp("t",e,t,ap,0,0,1),lp("n1",e,t,ap,-1,-1,i),lp("n2",e,t,ap,1,-1,i),lp("n3",e,t,ap,-1,1,i),lp("n4",e,t,ap,1,1,i),lp("f1",e,t,ap,-1,-1,1),lp("f2",e,t,ap,1,-1,1),lp("f3",e,t,ap,-1,1,1),lp("f4",e,t,ap,1,1,1),lp("u1",e,t,ap,.7,1.1,i),lp("u2",e,t,ap,-.7,1.1,i),lp("u3",e,t,ap,0,2,i),lp("cf1",e,t,ap,-1,0,1),lp("cf2",e,t,ap,1,0,1),lp("cf3",e,t,ap,0,-1,1),lp("cf4",e,t,ap,0,1,1),lp("cn1",e,t,ap,-1,0,i),lp("cn2",e,t,ap,1,0,i),lp("cn3",e,t,ap,0,-1,i),lp("cn4",e,t,ap,0,1,i),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function lp(t,e,i,n,r,s,o){op.set(r,s,o).unproject(n);const a=e[t];if(void 0!==a){const t=i.getAttribute("position");for(let e=0,i=a.length;e<i;e++)t.setXYZ(a[e],op.x,op.y,op.z)}}const hp=new wr;class up extends Oc{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new xo;r.setIndex(new io(i,1)),r.setAttribute("position",new io(n,3)),super(r,new Mc({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&hp.setFromObject(this.object),hp.isEmpty())return;const t=hp.min,e=hp.max,i=this.geometry.attributes.position,n=i.array;n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=t.x,n[4]=e.y,n[5]=e.z,n[6]=t.x,n[7]=t.y,n[8]=e.z,n[9]=e.x,n[10]=t.y,n[11]=e.z,n[12]=e.x,n[13]=e.y,n[14]=t.z,n[15]=t.x,n[16]=e.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=e.x,n[22]=t.y,n[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dp extends Oc{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new xo;n.setIndex(new io(i,1)),n.setAttribute("position",new uo([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Mc({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class pp extends Dc{constructor(t,e=1,i=16776960){const n=i,r=new xo;r.setAttribute("position",new uo([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Mc({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new xo;s.setAttribute("position",new uo([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new ko(s,new qs({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const fp=new br;let mp,gp;class vp extends ws{constructor(t=new br(0,0,1),e=new br(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===mp&&(mp=new xo,mp.setAttribute("position",new uo([0,0,0,0,1,0],3)),gp=new el(.5,1,5,1),gp.translate(0,-.5,0)),this.position.copy(e),this.line=new Dc(mp,new Mc({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ko(gp,new qs({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{fp.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(fp,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class _p extends Oc{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new xo;i.setAttribute("position",new uo(e,3)),i.setAttribute("color",new uo([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Mc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Hs,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yp{constructor(){this.type="ShapePath",this.color=new Hs,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Dl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],o=e[s],a=o.x-i.x,c=o.y-i.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(i=e[s],a=-a,o=e[r],c=-c),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=c*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return n}const i=rh.isClockWise,n=this.subPaths;if(0===n.length)return[];let r,s,o;const a=[];if(1===n.length)return s=n[0],o=new Rl,o.curves=s.curves,a.push(o),a;let c=!i(n[0].getPoints());c=t?!c:c;const l=[],h=[];let u,d,p=[],f=0;h[f]=void 0,p[f]=[];for(let e=0,o=n.length;e<o;e++)s=n[e],u=s.getPoints(),r=i(u),r=t?!r:r,r?(!c&&h[f]&&f++,h[f]={s:new Rl,p:u},h[f].s.curves=s.curves,c&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Rl;r.curves=n.curves,e.push(r)}return e}(n);if(h.length>1){let t=!1,i=0;for(let t=0,e=h.length;t<e;t++)l[t]=[];for(let n=0,r=h.length;n<r;n++){const r=p[n];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<h.length;r++)e(o.p,h[r].p)&&(n!==r&&i++,a?(a=!1,l[r].push(o)):t=!0);a&&l[n].push(o)}}i>0&&!1===t&&(p=l)}for(let t=0,e=h.length;t<e;t++){o=h[t].s,a.push(o),d=p[t];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return a}}class xp extends kn{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){void 0!==t?(null!==this.domElement&&this.disconnect(),this.domElement=t):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function bp(t,e,i,n){const r=function(t){switch(t){case ye:case xe:return{byteLength:1,components:1};case Me:case be:case Ee:return{byteLength:2,components:1};case Ce:case Pe:return{byteLength:2,components:4};case we:case Se:case Te:return{byteLength:4,components:1};case De:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}(n);switch(i){case Re:return t*e;case Ue:case Ne:return t*e/r.components*r.byteLength;case We:case Fe:return t*e*2/r.components*r.byteLength;case ke:return t*e*3/r.components*r.byteLength;case Ie:case ze:return t*e*4/r.components*r.byteLength;case Ve:case He:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Ge:case je:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case qe:case Ze:return Math.max(t,16)*Math.max(e,8)/4;case Xe:case Ye:return Math.max(t,8)*Math.max(e,8)/2;case Ke:case Je:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case $e:case Qe:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case ti:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case ei:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case ii:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case ni:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case ri:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case si:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case oi:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case ai:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case ci:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case li:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case hi:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case ui:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case di:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case pi:case fi:case mi:return Math.ceil(t/4)*Math.ceil(e/4)*16;case gi:case vi:return Math.ceil(t/4)*Math.ceil(e/4)*8;case _i:case yi:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}class Mp{static contain(t,e){return function(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}(t,e)}static cover(t,e){return function(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}(t,e)}static fill(t){return function(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}(t)}static getByteLength(t,e,i,n){return bp(t,e,i,n)}}function Sp(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function wp(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);const n=e.get(i);n&&(t.deleteBuffer(n.buffer),e.delete(i))},update:function(i,n){if(i.isInterleavedBufferAttribute&&(i=i.data),i.isGLBufferAttribute){const t=e.get(i);return void((!t||t.version<i.version)&&e.set(i,{buffer:i.buffer,type:i.type,bytesPerElement:i.elementSize,version:i.version}))}const r=e.get(i);if(void 0===r)e.set(i,function(e,i){const n=e.array,r=e.usage,s=n.byteLength,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,n,r),e.onUploadCallback(),n instanceof Float32Array)a=t.FLOAT;else if(n instanceof Uint16Array)a=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(n instanceof Int16Array)a=t.SHORT;else if(n instanceof Uint32Array)a=t.UNSIGNED_INT;else if(n instanceof Int32Array)a=t.INT;else if(n instanceof Int8Array)a=t.BYTE;else if(n instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version,size:s}}(i,n));else if(r.version<i.version){if(r.size!==i.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,i,n){const r=i.array,s=i.updateRanges;if(t.bindBuffer(n,e),0===s.length)t.bufferSubData(n,0,r);else{s.sort(((t,e)=>t.start-e.start));let e=0;for(let t=1;t<s.length;t++){const i=s[e],n=s[t];n.start<=i.start+i.count+1?i.count=Math.max(i.count,n.start+n.count-i.start):(++e,s[e]=n)}s.length=e+1;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.bufferSubData(n,i.start*r.BYTES_PER_ELEMENT,r,i.start,i.count)}i.clearUpdateRanges()}i.onUploadCallback()}(r.buffer,i,n),r.version=i.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:q}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=q);const Tp={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ep={common:{diffuse:{value:new Hs(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new jn},alphaMap:{value:null},alphaMapTransform:{value:new jn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new jn}},envmap:{envMap:{value:null},envMapRotation:{value:new jn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new jn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new jn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new jn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new jn},normalScale:{value:new Gn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new jn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new jn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new jn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new jn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Hs(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Hs(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new jn},alphaTest:{value:0},uvTransform:{value:new jn}},sprite:{diffuse:{value:new Hs(16777215)},opacity:{value:1},center:{value:new Gn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new jn},alphaMap:{value:null},alphaMapTransform:{value:new jn},alphaTest:{value:0}}},Cp={basic:{uniforms:Uo([Ep.common,Ep.specularmap,Ep.envmap,Ep.aomap,Ep.lightmap,Ep.fog]),vertexShader:Tp.meshbasic_vert,fragmentShader:Tp.meshbasic_frag},lambert:{uniforms:Uo([Ep.common,Ep.specularmap,Ep.envmap,Ep.aomap,Ep.lightmap,Ep.emissivemap,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,Ep.fog,Ep.lights,{emissive:{value:new Hs(0)}}]),vertexShader:Tp.meshlambert_vert,fragmentShader:Tp.meshlambert_frag},phong:{uniforms:Uo([Ep.common,Ep.specularmap,Ep.envmap,Ep.aomap,Ep.lightmap,Ep.emissivemap,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,Ep.fog,Ep.lights,{emissive:{value:new Hs(0)},specular:{value:new Hs(1118481)},shininess:{value:30}}]),vertexShader:Tp.meshphong_vert,fragmentShader:Tp.meshphong_frag},standard:{uniforms:Uo([Ep.common,Ep.envmap,Ep.aomap,Ep.lightmap,Ep.emissivemap,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,Ep.roughnessmap,Ep.metalnessmap,Ep.fog,Ep.lights,{emissive:{value:new Hs(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tp.meshphysical_vert,fragmentShader:Tp.meshphysical_frag},toon:{uniforms:Uo([Ep.common,Ep.aomap,Ep.lightmap,Ep.emissivemap,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,Ep.gradientmap,Ep.fog,Ep.lights,{emissive:{value:new Hs(0)}}]),vertexShader:Tp.meshtoon_vert,fragmentShader:Tp.meshtoon_frag},matcap:{uniforms:Uo([Ep.common,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,Ep.fog,{matcap:{value:null}}]),vertexShader:Tp.meshmatcap_vert,fragmentShader:Tp.meshmatcap_frag},points:{uniforms:Uo([Ep.points,Ep.fog]),vertexShader:Tp.points_vert,fragmentShader:Tp.points_frag},dashed:{uniforms:Uo([Ep.common,Ep.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tp.linedashed_vert,fragmentShader:Tp.linedashed_frag},depth:{uniforms:Uo([Ep.common,Ep.displacementmap]),vertexShader:Tp.depth_vert,fragmentShader:Tp.depth_frag},normal:{uniforms:Uo([Ep.common,Ep.bumpmap,Ep.normalmap,Ep.displacementmap,{opacity:{value:1}}]),vertexShader:Tp.meshnormal_vert,fragmentShader:Tp.meshnormal_frag},sprite:{uniforms:Uo([Ep.sprite,Ep.fog]),vertexShader:Tp.sprite_vert,fragmentShader:Tp.sprite_frag},background:{uniforms:{uvTransform:{value:new jn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Tp.background_vert,fragmentShader:Tp.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new jn}},vertexShader:Tp.backgroundCube_vert,fragmentShader:Tp.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Tp.cube_vert,fragmentShader:Tp.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tp.equirect_vert,fragmentShader:Tp.equirect_frag},distanceRGBA:{uniforms:Uo([Ep.common,Ep.displacementmap,{referencePosition:{value:new br},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tp.distanceRGBA_vert,fragmentShader:Tp.distanceRGBA_frag},shadow:{uniforms:Uo([Ep.lights,Ep.fog,{color:{value:new Hs(0)},opacity:{value:1}}]),vertexShader:Tp.shadow_vert,fragmentShader:Tp.shadow_frag}};Cp.physical={uniforms:Uo([Cp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new jn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new jn},clearcoatNormalScale:{value:new Gn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new jn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new jn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new jn},sheen:{value:0},sheenColor:{value:new Hs(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new jn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new jn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new jn},transmissionSamplerSize:{value:new Gn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new jn},attenuationDistance:{value:0},attenuationColor:{value:new Hs(0)},specularColor:{value:new Hs(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new jn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new jn},anisotropyVector:{value:new Gn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new jn}}]),vertexShader:Tp.meshphysical_vert,fragmentShader:Tp.meshphysical_frag};const Pp={r:0,b:0,g:0},Ap=new as,Dp=new Jr;function Rp(t,e,i,n,r,s,o){const a=new Hs(0);let c,l,h=!0===s?0:1,u=null,d=0,p=null;function f(t){let n=!0===t.isScene?t.background:null;return n&&n.isTexture&&(n=(t.backgroundBlurriness>0?i:e).get(n)),n}function m(e,i){e.getRGB(Pp,No(t)),n.buffers.color.setClear(Pp.r,Pp.g,Pp.b,i,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(a,h)},render:function(e){let i=!1;const r=f(e);null===r?m(a,h):r&&r.isColor&&(m(r,1),i=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?n.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===s&&n.buffers.color.setClear(0,0,0,0,o),(t.autoClear||i)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,i){const n=f(i);n&&(n.isCubeTexture||n.mapping===se)?(void 0===l&&(l=new ko(new Oo(1,1,1),new Fo({name:"BackgroundCubeMaterial",uniforms:Lo(Cp.backgroundCube.uniforms),vertexShader:Cp.backgroundCube.vertexShader,fragmentShader:Cp.backgroundCube.fragmentShader,side:st,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),Ap.copy(i.backgroundRotation),Ap.x*=-1,Ap.y*=-1,Ap.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(Ap.y*=-1,Ap.z*=-1),l.material.uniforms.envMap.value=n,l.material.uniforms.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=i.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(Dp.makeRotationFromEuler(Ap)),l.material.toneMapped=nr.getTransfer(n.colorSpace)!==Gi,u===n&&d===n.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=n,d=n.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null)):n&&n.isTexture&&(void 0===c&&(c=new ko(new dh(2,2),new Fo({name:"BackgroundMaterial",uniforms:Lo(Cp.background.uniforms),vertexShader:Cp.background.vertexShader,fragmentShader:Cp.background.fragmentShader,side:rt,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=n,c.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,c.material.toneMapped=nr.getTransfer(n.colorSpace)!==Gi,!0===n.matrixAutoUpdate&&n.updateMatrix(),c.material.uniforms.uvTransform.value.copy(n.matrix),u===n&&d===n.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=n,d=n.version,p=t.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null))},dispose:function(){void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0),void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}}}function kp(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),n={},r=l(null);let s=r,o=!1;function a(e){return t.bindVertexArray(e)}function c(e){return t.deleteVertexArray(e)}function l(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function h(){const t=s.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function u(t){d(t,0)}function d(e,i){const n=s.newAttributes,r=s.enabledAttributes,o=s.attributeDivisors;n[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),o[e]!==i&&(t.vertexAttribDivisor(e,i),o[e]=i)}function p(){const e=s.newAttributes,i=s.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function f(e,i,n,r,s,o,a){!0===a?t.vertexAttribIPointer(e,i,n,s,o):t.vertexAttribPointer(e,i,n,r,s,o)}function m(){g(),o=!0,s!==r&&(s=r,a(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(i,r,c,m,g){let v=!1;const _=function(e,i,r){const s=!0===r.wireframe;let o=n[e.id];void 0===o&&(o={},n[e.id]=o);let a=o[i.id];void 0===a&&(a={},o[i.id]=a);let c=a[s];return void 0===c&&(c=l(t.createVertexArray()),a[s]=c),c}(m,c,r);s!==_&&(s=_,a(s.object)),v=function(t,e,i,n){const r=s.attributes,o=e.attributes;let a=0;const c=i.getAttributes();for(const e in c)if(c[e].location>=0){const i=r[e];let n=o[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}return s.attributesNum!==a||s.index!==n}(i,m,c,g),v&&function(t,e,i,n){const r={},o=e.attributes;let a=0;const c=i.getAttributes();for(const e in c)if(c[e].location>=0){let i=o[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[e]=n,a++}s.attributes=r,s.attributesNum=a,s.index=n}(i,m,c,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(i,n,r,s){h();const o=s.attributes,a=r.getAttributes(),c=n.defaultAttributeValues;for(const n in a){const r=a[n];if(r.location>=0){let a=o[n];if(void 0===a&&("instanceMatrix"===n&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===n&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const n=a.normalized,o=a.itemSize,c=e.get(a);if(void 0===c)continue;const l=c.buffer,h=c.type,p=c.bytesPerElement,m=h===t.INT||h===t.UNSIGNED_INT||a.gpuType===Se;if(a.isInterleavedBufferAttribute){const e=a.data,c=e.stride,g=a.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)d(r.location+t,e.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<r.locationSize;t++)f(r.location+t,o/r.locationSize,h,n,c*p,(g+o/r.locationSize*t)*p,m)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)d(r.location+t,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<r.locationSize;t++)f(r.location+t,o/r.locationSize,h,n,o*p,o/r.locationSize*t*p,m)}}else if(void 0!==c){const e=c[n];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(r.location,e);break;case 3:t.vertexAttrib3fv(r.location,e);break;case 4:t.vertexAttrib4fv(r.location,e);break;default:t.vertexAttrib1fv(r.location,e)}}}}p()}(i,r,c,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in n){const e=n[t];for(const t in e){const i=e[t];for(const t in i)c(i[t].object),delete i[t];delete e[t]}delete n[t]}},releaseStatesOfGeometry:function(t){if(void 0===n[t.id])return;const e=n[t.id];for(const t in e){const i=e[t];for(const t in i)c(i[t].object),delete i[t];delete e[t]}delete n[t.id]},releaseStatesOfProgram:function(t){for(const e in n){const i=n[e];if(void 0===i[t.id])continue;const r=i[t.id];for(const t in r)c(r[t].object),delete r[t];delete i[t.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function Ip(t,e,i){let n;function r(e,r,s){0!==s&&(t.drawArraysInstanced(n,e,r,s),i.update(r,n,s))}this.setMode=function(t){n=t},this.render=function(e,r){t.drawArrays(n,e,r),i.update(r,n,1)},this.renderInstances=r,this.renderMultiDraw=function(t,r,s){if(0===s)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,t,0,r,0,s);let o=0;for(let t=0;t<s;t++)o+=r[t];i.update(o,n,1)},this.renderMultiDrawInstances=function(t,s,o,a){if(0===o)return;const c=e.get("WEBGL_multi_draw");if(null===c)for(let e=0;e<t.length;e++)r(t[e],s[e],a[e]);else{c.multiDrawArraysInstancedWEBGL(n,t,0,s,0,a,0,o);let e=0;for(let t=0;t<o;t++)e+=s[t]*a[t];i.update(e,n,1)}}}function Op(t,e,i,n){let r;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==i.precision?i.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const c=!0===i.logarithmicDepthBuffer,l=!0===i.reverseDepthBuffer&&e.has("EXT_clip_control"),h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(e){return e===Ie||n.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(i){const r=i===Ee&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(i!==ye&&n.convert(i)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&i!==Te&&!r)},precision:o,logarithmicDepthBuffer:c,reverseDepthBuffer:l,maxTextures:h,maxVertexTextures:u,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:u>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function Lp(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new Ka,a=new jn,c={value:null,needsUpdate:!1};function l(t,i,n,r){const s=null!==t?t.length:0;let l=null;if(0!==s){if(l=c.value,!0!==r||null===l){const e=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(l,i),l[i+3]=o.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==n||r;return r=e,n=t.length,i},this.beginShadows=function(){s=!0,l(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){i=l(t,e,0)},this.setState=function(o,a,h){const u=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!r||null===u||0===u.length||s&&!p)s?l(null):(c.value!==i&&(c.value=i,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0);else{const t=s?0:n,e=4*t;let r=f.clippingState||null;c.value=r,r=l(u,a,e,h);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Up(t){let e=new WeakMap;function i(t,e){return e===ne?t.mapping=ee:e===re&&(t.mapping=ie),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===ne||s===re){if(e.has(r))return i(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=new Yo(s.height);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}const Np=[.125,.215,.35,.446,.526,.582],Wp=new Cu,Fp=new Hs;let Bp=null,zp=0,Vp=0,Hp=!1;const Gp=(1+Math.sqrt(5))/2,jp=1/Gp,Xp=[new br(-Gp,jp,0),new br(Gp,jp,0),new br(-jp,0,Gp),new br(jp,0,Gp),new br(0,Gp,-jp),new br(0,Gp,jp),new br(-1,1,-1),new br(1,1,-1),new br(-1,1,1),new br(1,1,1)],qp=new br;class Yp{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100,r={}){const{size:s=256,position:o=qp}=r;Bp=this._renderer.getRenderTarget(),zp=this._renderer.getActiveCubeFace(),Vp=this._renderer.getActiveMipmapLevel(),Hp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(t,i,n,a,o),e>0&&this._blur(a,0,0,e),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=$p(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Jp(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Bp,zp,Vp),this._renderer.xr.enabled=Hp,t.scissorTest=!1,Kp(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===ee||t.mapping===ie?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Bp=this._renderer.getRenderTarget(),zp=this._renderer.getActiveCubeFace(),Vp=this._renderer.getActiveMipmapLevel(),Hp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Ee,format:Ie,colorSpace:Vi,depthBuffer:!1},n=Zp(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Zp(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Np.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);i.push(s);let a=1/s;o>t-4?a=Np[o-t+4-1]:0===o&&(a=0),n.push(a);const c=1/(s-2),l=-c,h=1+c,u=[l,l,h,l,h,h,l,l,h,h,l,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),_=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,f*p*t),_.set(u,m*p*t);const r=[t,t,t,t,t,t];y.set(r,g*p*t)}const x=new xo;x.setAttribute("position",new io(v,f)),x.setAttribute("uv",new io(_,m)),x.setAttribute("faceIndex",new io(y,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(20),r=new br(0,1,0);return new Fo({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new ko(this._lodPlanes[0],t);this._renderer.compile(e,Wp)}_sceneToCubeUV(t,e,i,n,r){const s=new Go(90,1,e,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],c=this._renderer,l=c.autoClear,h=c.toneMapping;c.getClearColor(Fp),c.toneMapping=Gt,c.autoClear=!1;const u=new qs({name:"PMREM.Background",side:st,depthWrite:!1,depthTest:!1}),d=new ko(new Oo,u);let p=!1;const f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,p=!0):(u.color.copy(Fp),p=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,o[e],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x+a[e],r.y,r.z)):1===i?(s.up.set(0,0,o[e]),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y+a[e],r.z)):(s.up.set(0,o[e],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y,r.z+a[e]));const l=this._cubeSize;Kp(n,i*l,e>2?l:0,l,l),c.setRenderTarget(n),p&&c.render(d,s),c.render(t,s)}d.geometry.dispose(),d.material.dispose(),c.toneMapping=h,c.autoClear=l,t.background=f}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===ee||t.mapping===ie;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=$p()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Jp());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new ko(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;Kp(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,Wp)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let e=1;e<n;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),r=Xp[(n-e-1)%Xp.length];this._blur(t,e-1,e,i,r)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,o){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new ko(this._lodPlanes[n],c),h=c.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;const _=this._sizeLods[n];Kp(e,3*_*(n>v-4?n-v+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(e),a.render(l,Wp)}}function Zp(t,e,i){const n=new mr(t,e,i);return n.texture.mapping=se,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Kp(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Jp(){return new Fo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}function $p(){return new Fo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}function Qp(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===ne||s===re,a=s===ee||s===ie;if(o||a){let s=e.get(r);const c=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==c)return null===i&&(i=new Yp(t)),s=o?i.fromEquirectangular(r,s):i.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),s.texture;if(void 0!==s)return s.texture;{const c=r.image;return o&&c&&c.height>0||a&&c&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(c)?(null===i&&(i=new Yp(t)),s=o?i.fromEquirectangular(r):i.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),r.addEventListener("dispose",n),s.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function tf(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(t){const e=i(t);return null===e&&Qn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ef(t,e,i,n){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const c=s.get(a);c&&(e.remove(c),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,r=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{if(void 0===r)return;{const t=r.array;o=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}}const a=new(qn(i)?lo:ao)(i,1);a.version=o;const c=s.get(t);c&&e.remove(c),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return s.get(t)}}}function nf(t,e,i){let n,r,s;function o(e,o,a){0!==a&&(t.drawElementsInstanced(n,o,r,e*s,a),i.update(o,n,a))}this.setMode=function(t){n=t},this.setIndex=function(t){r=t.type,s=t.bytesPerElement},this.render=function(e,o){t.drawElements(n,o,r,e*s),i.update(o,n,1)},this.renderInstances=o,this.renderMultiDraw=function(t,s,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,s,0,r,t,0,o);let a=0;for(let t=0;t<o;t++)a+=s[t];i.update(a,n,1)},this.renderMultiDrawInstances=function(t,a,c,l){if(0===c)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<t.length;e++)o(t[e]/s,a[e],l[e]);else{h.multiDrawElementsInstancedWEBGL(n,a,0,r,t,0,l,0,c);let e=0;for(let t=0;t<c;t++)e+=a[t]*l[t];i.update(e,n,1)}}}function rf(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,r){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=r*(i/3);break;case t.LINES:e.lines+=r*(i/2);break;case t.LINE_STRIP:e.lines+=r*(i-1);break;case t.LINE_LOOP:e.lines+=r*i;break;case t.POINTS:e.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function sf(t,e,i){const n=new WeakMap,r=new pr;return{update:function(s,o,a){const c=s.morphTargetInfluences,l=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=void 0!==l?l.length:0;let u=n.get(o);if(void 0===u||u.count!==h){void 0!==u&&u.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let _=0;!0===d&&(_=1),!0===p&&(_=2),!0===f&&(_=3);let y=o.attributes.position.count*_,x=1;y>e.maxTextureSize&&(x=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const b=new Float32Array(y*x*4*h),M=new gr(b,y,x,h);M.type=Te,M.needsUpdate=!0;const S=4*_;for(let T=0;T<h;T++){const E=m[T],C=g[T],P=v[T],A=y*x*4*T;for(let D=0;D<E.count;D++){const R=D*S;!0===d&&(r.fromBufferAttribute(E,D),b[A+R+0]=r.x,b[A+R+1]=r.y,b[A+R+2]=r.z,b[A+R+3]=0),!0===p&&(r.fromBufferAttribute(C,D),b[A+R+4]=r.x,b[A+R+5]=r.y,b[A+R+6]=r.z,b[A+R+7]=0),!0===f&&(r.fromBufferAttribute(P,D),b[A+R+8]=r.x,b[A+R+9]=r.y,b[A+R+10]=r.z,b[A+R+11]=4===P.itemSize?r.w:1)}}function w(){M.dispose(),n.delete(o),o.removeEventListener("dispose",w)}u={count:h,texture:M,size:new Gn(y,x)},n.set(o,u),o.addEventListener("dispose",w)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)a.getUniforms().setValue(t,"morphTexture",s.morphTexture,i);else{let k=0;for(let O=0;O<c.length;O++)k+=c[O];const I=o.morphTargetsRelative?1:1-k;a.getUniforms().setValue(t,"morphTargetBaseInfluence",I),a.getUniforms().setValue(t,"morphTargetInfluences",c)}a.getUniforms().setValue(t,"morphTargetsTexture",u.texture,i),a.getUniforms().setValue(t,"morphTargetsTextureSize",u.size)}}}function of(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=n.render.frame,c=o.geometry,l=e.get(o,c);if(r.get(l)!==a&&(e.update(l),r.set(l,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),r.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),r.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;r.get(t)!==a&&(t.update(),r.set(t,a))}return l},dispose:function(){r=new WeakMap}}}const af=new dr,cf=new Kc(1,1),lf=new gr,hf=new _r,uf=new qo,df=[],pf=[],ff=new Float32Array(16),mf=new Float32Array(9),gf=new Float32Array(4);function vf(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=df[r];if(void 0===s&&(s=new Float32Array(r),df[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function _f(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function yf(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function xf(t,e){let i=pf[e];void 0===i&&(i=new Int32Array(e),pf[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function bf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Mf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(_f(i,e))return;t.uniform2fv(this.addr,e),yf(i,e)}}function Sf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(_f(i,e))return;t.uniform3fv(this.addr,e),yf(i,e)}}function wf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(_f(i,e))return;t.uniform4fv(this.addr,e),yf(i,e)}}function Tf(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(_f(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),yf(i,e)}else{if(_f(i,n))return;gf.set(n),t.uniformMatrix2fv(this.addr,!1,gf),yf(i,n)}}function Ef(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(_f(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),yf(i,e)}else{if(_f(i,n))return;mf.set(n),t.uniformMatrix3fv(this.addr,!1,mf),yf(i,n)}}function Cf(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(_f(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),yf(i,e)}else{if(_f(i,n))return;ff.set(n),t.uniformMatrix4fv(this.addr,!1,ff),yf(i,n)}}function Pf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Af(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(_f(i,e))return;t.uniform2iv(this.addr,e),yf(i,e)}}function Df(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(_f(i,e))return;t.uniform3iv(this.addr,e),yf(i,e)}}function Rf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(_f(i,e))return;t.uniform4iv(this.addr,e),yf(i,e)}}function kf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function If(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(_f(i,e))return;t.uniform2uiv(this.addr,e),yf(i,e)}}function Of(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(_f(i,e))return;t.uniform3uiv(this.addr,e),yf(i,e)}}function Lf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(_f(i,e))return;t.uniform4uiv(this.addr,e),yf(i,e)}}function Uf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();let s;n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),this.type===t.SAMPLER_2D_SHADOW?(cf.compareFunction=un,s=cf):s=af,i.setTexture2D(e||s,r)}function Nf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||hf,r)}function Wf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||uf,r)}function Ff(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||lf,r)}function Bf(t,e){t.uniform1fv(this.addr,e)}function zf(t,e){const i=vf(e,this.size,2);t.uniform2fv(this.addr,i)}function Vf(t,e){const i=vf(e,this.size,3);t.uniform3fv(this.addr,i)}function Hf(t,e){const i=vf(e,this.size,4);t.uniform4fv(this.addr,i)}function Gf(t,e){const i=vf(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function jf(t,e){const i=vf(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Xf(t,e){const i=vf(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function qf(t,e){t.uniform1iv(this.addr,e)}function Yf(t,e){t.uniform2iv(this.addr,e)}function Zf(t,e){t.uniform3iv(this.addr,e)}function Kf(t,e){t.uniform4iv(this.addr,e)}function Jf(t,e){t.uniform1uiv(this.addr,e)}function $f(t,e){t.uniform2uiv(this.addr,e)}function Qf(t,e){t.uniform3uiv(this.addr,e)}function tm(t,e){t.uniform4uiv(this.addr,e)}function em(t,e,i){const n=this.cache,r=e.length,s=xf(i,r);_f(n,s)||(t.uniform1iv(this.addr,s),yf(n,s));for(let t=0;t!==r;++t)i.setTexture2D(e[t]||af,s[t])}function im(t,e,i){const n=this.cache,r=e.length,s=xf(i,r);_f(n,s)||(t.uniform1iv(this.addr,s),yf(n,s));for(let t=0;t!==r;++t)i.setTexture3D(e[t]||hf,s[t])}function nm(t,e,i){const n=this.cache,r=e.length,s=xf(i,r);_f(n,s)||(t.uniform1iv(this.addr,s),yf(n,s));for(let t=0;t!==r;++t)i.setTextureCube(e[t]||uf,s[t])}function rm(t,e,i){const n=this.cache,r=e.length,s=xf(i,r);_f(n,s)||(t.uniform1iv(this.addr,s),yf(n,s));for(let t=0;t!==r;++t)i.setTexture2DArray(e[t]||lf,s[t])}class sm{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return bf;case 35664:return Mf;case 35665:return Sf;case 35666:return wf;case 35674:return Tf;case 35675:return Ef;case 35676:return Cf;case 5124:case 35670:return Pf;case 35667:case 35671:return Af;case 35668:case 35672:return Df;case 35669:case 35673:return Rf;case 5125:return kf;case 36294:return If;case 36295:return Of;case 36296:return Lf;case 35678:case 36198:case 36298:case 36306:case 35682:return Uf;case 35679:case 36299:case 36307:return Nf;case 35680:case 36300:case 36308:case 36293:return Wf;case 36289:case 36303:case 36311:case 36292:return Ff}}(e.type)}}class om{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Bf;case 35664:return zf;case 35665:return Vf;case 35666:return Hf;case 35674:return Gf;case 35675:return jf;case 35676:return Xf;case 5124:case 35670:return qf;case 35667:case 35671:return Yf;case 35668:case 35672:return Zf;case 35669:case 35673:return Kf;case 5125:return Jf;case 36294:return $f;case 36295:return Qf;case 36296:return tm;case 35678:case 36198:case 36298:case 36306:case 35682:return em;case 35679:case 36299:case 36307:return im;case 35680:case 36300:case 36308:case 36293:return nm;case 36289:case 36303:case 36311:case 36292:return rm}}(e.type)}}class am{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}}}const cm=/(\w+)(\])?(\[|\.)?/g;function lm(t,e){t.seq.push(e),t.map[e.id]=e}function hm(t,e,i){const n=t.name,r=n.length;for(cm.lastIndex=0;;){const s=cm.exec(n),o=cm.lastIndex;let a=s[1];const c="]"===s[2],l=s[3];if(c&&(a|=0),void 0===l||"["===l&&o+2===r){lm(i,void 0===l?new sm(a,t,e):new om(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new am(a),lm(i,t)),i=t}}}class um{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);hm(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i}}function dm(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}const pm=37297;let fm=0;const mm=new jn;function gm(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=r;t<s;t++){const r=t+1;n.push(`${r===e?">":" "} ${r}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return r}function vm(t,e){const i=function(t){nr._getMatrix(mm,nr.workingColorSpace,t);const e=`mat3( ${mm.elements.map((t=>t.toFixed(4)))} )`;switch(nr.getTransfer(t)){case Hi:return[e,"LinearTransferOETF"];case Gi:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${t}( vec4 value ) {`,`\treturn ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join("\n")}function _m(t,e){let i;switch(e){case jt:i="Linear";break;case Xt:i="Reinhard";break;case qt:i="Cineon";break;case Yt:i="ACESFilmic";break;case Kt:i="AgX";break;case Jt:i="Neutral";break;case Zt:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const ym=new br;function xm(t){return""!==t}function bm(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Mm(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Sm=/^[ \t]*#include +<([\w\d./]+)>/gm;function wm(t){return t.replace(Sm,Em)}const Tm=new Map;function Em(t,e){let i=Tp[e];if(void 0===i){const t=Tm.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=Tp[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return wm(i)}const Cm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Pm(t){return t.replace(Cm,Am)}function Am(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Dm(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Rm(t,e,i,n){const r=t.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const c=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===et?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===it?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===nt&&(e="SHADOWMAP_TYPE_VSM"),e}(i),l=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ee:case ie:e="ENVMAP_TYPE_CUBE";break;case se:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),h=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===ie&&(e="ENVMAP_MODE_REFRACTION"),e}(i),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case zt:e="ENVMAP_BLENDING_MULTIPLY";break;case Vt:e="ENVMAP_BLENDING_MIX";break;case Ht:e="ENVMAP_BLENDING_ADD"}return e}(i),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(xm).join("\n")}(i),f=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),m=r.createProgram();let g,v,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(xm).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(xm).join("\n"),v.length>0&&(v+="\n")):(g=[Dm(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(xm).join("\n"),v=[Dm(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Gt?"#define TONE_MAPPING":"",i.toneMapping!==Gt?Tp.tonemapping_pars_fragment:"",i.toneMapping!==Gt?_m("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Tp.colorspace_pars_fragment,vm("linearToOutputTexel",i.outputColorSpace),(nr.getLuminanceCoefficients(ym),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${ym.x.toFixed(4)}, ${ym.y.toFixed(4)}, ${ym.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(xm).join("\n")),o=wm(o),o=bm(o,i),o=Mm(o,i),a=wm(a),a=bm(a,i),a=Mm(a,i),o=Pm(o),a=Pm(a),!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===En?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===En?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=_+g+o,x=_+v+a,b=dm(r,r.VERTEX_SHADER,y),M=dm(r,r.FRAGMENT_SHADER,x);function S(e){if(t.debug.checkShaderErrors){const i=r.getProgramInfoLog(m).trim(),n=r.getShaderInfoLog(b).trim(),s=r.getShaderInfoLog(M).trim();let o=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(r,m,b,M);else{const t=gm(r,b,"vertex"),n=gm(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+i+"\n"+t+"\n"+n)}else""!==i?console.warn("THREE.WebGLProgram: Program Info Log:",i):""!==n&&""!==s||(a=!1);a&&(e.diagnostics={runnable:o,programLog:i,vertexShader:{log:n,prefix:g},fragmentShader:{log:s,prefix:v}})}r.deleteShader(b),r.deleteShader(M),w=new um(r,m),T=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let o=1;n.type===t.FLOAT_MAT2&&(o=2),n.type===t.FLOAT_MAT3&&(o=3),n.type===t.FLOAT_MAT4&&(o=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}(r,m)}let w,T;r.attachShader(m,b),r.attachShader(m,M),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===w&&S(this),w},this.getAttributes=function(){return void 0===T&&S(this),T};let E=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=r.getProgramParameter(m,pm)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=fm++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=M,this}let km=0;class Im{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new Om(t),e.set(t,i)),i}}class Om{constructor(t){this.id=km++,this.code=t,this.usedTimes=0}}function Lm(t,e,i,n,r,s,o){const a=new cs,c=new Im,l=new Set,h=[],u=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return l.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,a,h,g,v){const _=g.fog,y=v.geometry,x=s.isMeshStandardMaterial?g.environment:null,b=(s.isMeshStandardMaterial?i:e).get(s.envMap||x),M=b&&b.mapping===se?b.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const w=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,T=void 0!==w?w.length:0;let E,C,P,A,D=0;if(void 0!==y.morphAttributes.position&&(D=1),void 0!==y.morphAttributes.normal&&(D=2),void 0!==y.morphAttributes.color&&(D=3),S){const t=Cp[S];E=t.vertexShader,C=t.fragmentShader}else E=s.vertexShader,C=s.fragmentShader,c.update(s),P=c.getVertexShaderID(s),A=c.getFragmentShaderID(s);const R=t.getRenderTarget(),k=t.state.buffers.depth.getReversed(),I=!0===v.isInstancedMesh,O=!0===v.isBatchedMesh,L=!!s.map,U=!!s.matcap,N=!!b,W=!!s.aoMap,F=!!s.lightMap,B=!!s.bumpMap,z=!!s.normalMap,V=!!s.displacementMap,H=!!s.emissiveMap,G=!!s.metalnessMap,j=!!s.roughnessMap,X=s.anisotropy>0,q=s.clearcoat>0,Y=s.dispersion>0,Z=s.iridescence>0,K=s.sheen>0,J=s.transmission>0,$=X&&!!s.anisotropyMap,Q=q&&!!s.clearcoatMap,tt=q&&!!s.clearcoatNormalMap,et=q&&!!s.clearcoatRoughnessMap,it=Z&&!!s.iridescenceMap,nt=Z&&!!s.iridescenceThicknessMap,rt=K&&!!s.sheenColorMap,at=K&&!!s.sheenRoughnessMap,lt=!!s.specularMap,ht=!!s.specularColorMap,ut=!!s.specularIntensityMap,dt=J&&!!s.transmissionMap,pt=J&&!!s.thicknessMap,ft=!!s.gradientMap,mt=!!s.alphaMap,gt=s.alphaTest>0,vt=!!s.alphaHash,_t=!!s.extensions;let yt=Gt;s.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(yt=t.toneMapping));const xt={shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:E,fragmentShader:C,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:A,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:O,batchingColor:O&&null!==v._colorsTexture,instancing:I,instancingColor:I&&null!==v.instanceColor,instancingMorph:I&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===R?t.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Vi,alphaToCoverage:!!s.alphaToCoverage,map:L,matcap:U,envMap:N,envMapMode:N&&b.mapping,envMapCubeUVHeight:M,aoMap:W,lightMap:F,bumpMap:B,normalMap:z,displacementMap:d&&V,emissiveMap:H,normalMapObjectSpace:z&&s.normalMapType===Fi,normalMapTangentSpace:z&&s.normalMapType===Wi,metalnessMap:G,roughnessMap:j,anisotropy:X,anisotropyMap:$,clearcoat:q,clearcoatMap:Q,clearcoatNormalMap:tt,clearcoatRoughnessMap:et,dispersion:Y,iridescence:Z,iridescenceMap:it,iridescenceThicknessMap:nt,sheen:K,sheenColorMap:rt,sheenRoughnessMap:at,specularMap:lt,specularColorMap:ht,specularIntensityMap:ut,transmission:J,transmissionMap:dt,thicknessMap:pt,gradientMap:ft,opaque:!1===s.transparent&&s.blending===ct&&!1===s.alphaToCoverage,alphaMap:mt,alphaTest:gt,alphaHash:vt,combine:s.combine,mapUv:L&&m(s.map.channel),aoMapUv:W&&m(s.aoMap.channel),lightMapUv:F&&m(s.lightMap.channel),bumpMapUv:B&&m(s.bumpMap.channel),normalMapUv:z&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:H&&m(s.emissiveMap.channel),metalnessMapUv:G&&m(s.metalnessMap.channel),roughnessMapUv:j&&m(s.roughnessMap.channel),anisotropyMapUv:$&&m(s.anisotropyMap.channel),clearcoatMapUv:Q&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:tt&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:it&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:nt&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:at&&m(s.sheenRoughnessMap.channel),specularMapUv:lt&&m(s.specularMap.channel),specularColorMapUv:ht&&m(s.specularColorMap.channel),specularIntensityMapUv:ut&&m(s.specularIntensityMap.channel),transmissionMapUv:dt&&m(s.transmissionMap.channel),thicknessMapUv:pt&&m(s.thicknessMap.channel),alphaMapUv:mt&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(z||X),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!y.attributes.uv&&(L||mt),fog:!!_,useFog:!0===s.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:u,reverseDepthBuffer:k,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:T,morphTextureStride:D,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:yt,decodeVideoTexture:L&&!0===s.map.isVideoTexture&&nr.getTransfer(s.map.colorSpace)===Gi,decodeVideoTextureEmissive:H&&!0===s.emissiveMap.isVideoTexture&&nr.getTransfer(s.emissiveMap.colorSpace)===Gi,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===ot,flipSided:s.side===st,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:_t&&!0===s.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(_t&&!0===s.extensions.multiDraw||O)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return xt.vertexUv1s=l.has(1),xt.vertexUv2s=l.has(2),xt.vertexUv3s=l.has(3),l.clear(),xt},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){a.disableAll(),e.supportsVertexTextures&&a.enable(0),e.instancing&&a.enable(1),e.instancingColor&&a.enable(2),e.instancingMorph&&a.enable(3),e.matcap&&a.enable(4),e.envMap&&a.enable(5),e.normalMapObjectSpace&&a.enable(6),e.normalMapTangentSpace&&a.enable(7),e.clearcoat&&a.enable(8),e.iridescence&&a.enable(9),e.alphaTest&&a.enable(10),e.vertexColors&&a.enable(11),e.vertexAlphas&&a.enable(12),e.vertexUv1s&&a.enable(13),e.vertexUv2s&&a.enable(14),e.vertexUv3s&&a.enable(15),e.vertexTangents&&a.enable(16),e.anisotropy&&a.enable(17),e.alphaHash&&a.enable(18),e.batching&&a.enable(19),e.dispersion&&a.enable(20),e.batchingColor&&a.enable(21),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.reverseDepthBuffer&&a.enable(4),e.skinning&&a.enable(5),e.morphTargets&&a.enable(6),e.morphNormals&&a.enable(7),e.morphColors&&a.enable(8),e.premultipliedAlpha&&a.enable(9),e.shadowMapEnabled&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.transmission&&a.enable(15),e.sheen&&a.enable(16),e.opaque&&a.enable(17),e.pointsUvs&&a.enable(18),e.decodeVideoTexture&&a.enable(19),e.decodeVideoTextureEmissive&&a.enable(20),e.alphaToCoverage&&a.enable(21),t.push(a.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=Cp[e];i=Wo.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Rm(t,i,e,s),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function Um(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Nm(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Wm(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Fm(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let c=t[e];return void 0===c?(c={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},t[e]=c):(c.id=i.id,c.object=i,c.geometry=n,c.material=r,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=o,c.group=a),e++,c}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,o,a,c,l){const h=s(t,e,o,a,c,l);o.transmission>0?n.push(h):!0===o.transparent?r.push(h):i.push(h)},unshift:function(t,e,o,a,c,l){const h=s(t,e,o,a,c,l);o.transmission>0?n.unshift(h):!0===o.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Nm),n.length>1&&n.sort(e||Wm),r.length>1&&r.sort(e||Wm)}}}function Bm(){let t=new WeakMap;return{get:function(e,i){const n=t.get(e);let r;return void 0===n?(r=new Fm,t.set(e,[r])):i>=n.length?(r=new Fm,n.push(r)):r=n[i],r},dispose:function(){t=new WeakMap}}}function zm(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new br,color:new Hs};break;case"SpotLight":i={position:new br,direction:new br,color:new Hs,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new br,color:new Hs,distance:0,decay:0};break;case"HemisphereLight":i={direction:new br,skyColor:new Hs,groundColor:new Hs};break;case"RectAreaLight":i={color:new Hs,position:new br,halfWidth:new br,halfHeight:new br}}return t[e.id]=i,i}}}let Vm=0;function Hm(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Gm(t){const e=new zm,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gn};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)n.probe.push(new br);const r=new br,s=new Jr,o=new Jr;return{setup:function(r){let s=0,o=0,a=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let c=0,l=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,_=0;r.sort(Hm);for(let t=0,y=r.length;t<y;t++){const y=r[t],x=y.color,b=y.intensity,M=y.distance,S=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)s+=x.r*b,o+=x.g*b,a+=x.b*b;else if(y.isLightProbe){for(let t=0;t<9;t++)n.probe[t].addScaledVector(y.sh.coefficients[t],b);_++}else if(y.isDirectionalLight){const t=e.get(y);if(t.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const t=y.shadow,e=i.get(y);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,n.directionalShadow[c]=e,n.directionalShadowMap[c]=S,n.directionalShadowMatrix[c]=y.shadow.matrix,p++}n.directional[c]=t,c++}else if(y.isSpotLight){const t=e.get(y);t.position.setFromMatrixPosition(y.matrixWorld),t.color.copy(x).multiplyScalar(b),t.distance=M,t.coneCos=Math.cos(y.angle),t.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),t.decay=y.decay,n.spot[h]=t;const r=y.shadow;if(y.map&&(n.spotLightMap[g]=y.map,g++,r.updateMatrices(y),y.castShadow&&v++),n.spotLightMatrix[h]=r.matrix,y.castShadow){const t=i.get(y);t.shadowIntensity=r.intensity,t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,n.spotShadow[h]=t,n.spotShadowMap[h]=S,m++}h++}else if(y.isRectAreaLight){const t=e.get(y);t.color.copy(x).multiplyScalar(b),t.halfWidth.set(.5*y.width,0,0),t.halfHeight.set(0,.5*y.height,0),n.rectArea[u]=t,u++}else if(y.isPointLight){const t=e.get(y);if(t.color.copy(y.color).multiplyScalar(y.intensity),t.distance=y.distance,t.decay=y.decay,y.castShadow){const t=y.shadow,e=i.get(y);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,n.pointShadow[l]=e,n.pointShadowMap[l]=S,n.pointShadowMatrix[l]=y.shadow.matrix,f++}n.point[l]=t,l++}else if(y.isHemisphereLight){const t=e.get(y);t.skyColor.copy(y.color).multiplyScalar(b),t.groundColor.copy(y.groundColor).multiplyScalar(b),n.hemi[d]=t,d++}}u>0&&(!0===t.has("OES_texture_float_linear")?(n.rectAreaLTC1=Ep.LTC_FLOAT_1,n.rectAreaLTC2=Ep.LTC_FLOAT_2):(n.rectAreaLTC1=Ep.LTC_HALF_1,n.rectAreaLTC2=Ep.LTC_HALF_2)),n.ambient[0]=s,n.ambient[1]=o,n.ambient[2]=a;const y=n.hash;y.directionalLength===c&&y.pointLength===l&&y.spotLength===h&&y.rectAreaLength===u&&y.hemiLength===d&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===_||(n.directional.length=c,n.spot.length=h,n.rectArea.length=u,n.point.length=l,n.hemi.length=d,n.directionalShadow.length=p,n.directionalShadowMap.length=p,n.pointShadow.length=f,n.pointShadowMap.length=f,n.spotShadow.length=m,n.spotShadowMap.length=m,n.directionalShadowMatrix.length=p,n.pointShadowMatrix.length=f,n.spotLightMatrix.length=m+g-v,n.spotLightMap.length=g,n.numSpotLightShadowsWithMaps=v,n.numLightProbes=_,y.directionalLength=c,y.pointLength=l,y.spotLength=h,y.rectAreaLength=u,y.hemiLength=d,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=_,n.version=Vm++)},setupView:function(t,e){let i=0,a=0,c=0,l=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=n.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=n.spot[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),c++}else if(d.isRectAreaLight){const t=n.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),s.copy(d.matrixWorld),s.premultiply(u),o.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),l++}else if(d.isPointLight){const t=n.point[a];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a++}else if(d.isHemisphereLight){const t=n.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:n}}function jm(t){const e=new Gm(t),i=[],n=[],r={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){r.camera=t,i.length=0,n.length=0},state:r,setupLights:function(){e.setup(i)},setupLightsView:function(t){e.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){n.push(t)}}}function Xm(t){let e=new WeakMap;return{get:function(i,n=0){const r=e.get(i);let s;return void 0===r?(s=new jm(t),e.set(i,[s])):n>=r.length?(s=new jm(t),r.push(s)):s=r[n],s},dispose:function(){e=new WeakMap}}}function qm(t,e,i){let n=new Qa;const r=new Gn,s=new Gn,o=new pr,a=new Rh({depthPacking:Li}),c=new kh,l={},h=i.maxTextureSize,u={[rt]:st,[st]:rt,[ot]:ot},d=new Fo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Gn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new xo;f.setAttribute("position",new io(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new ko(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=et;let v=this.type;function _(i,n){const s=e.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new mr(r.x,r.y)),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,s,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,s,p,m,null)}function y(e,i,n,r){let s=null;const o=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===n.isPointLight?c:a,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0||!0===i.alphaToCoverage){const t=s.uuid,e=i.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let r=n[e];void 0===r&&(r=s.clone(),n[e]=r,i.addEventListener("dispose",b)),s=r}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=r===nt?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],s.alphaMap=i.alphaMap,s.alphaTest=!0===i.alphaToCoverage?.5:i.alphaTest,s.map=i.map,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.displacementMap=i.displacementMap,s.displacementScale=i.displacementScale,s.displacementBias=i.displacementBias,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===n.isPointLight&&!0===s.isMeshDistanceMaterial&&(t.properties.get(s).light=n),s}function x(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===nt)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),c=i.material;if(Array.isArray(c)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],u=c[h.materialIndex];if(u&&u.visible){const e=y(i,u,o,a);i.onBeforeShadow(t,i,r,s,n,e,h),t.renderBufferDirect(s,null,n,e,i,h),i.onAfterShadow(t,i,r,s,n,e,h)}}}else if(c.visible){const e=y(i,c,o,a);i.onBeforeShadow(t,i,r,s,n,e,null),t.renderBufferDirect(s,null,n,e,i,null),i.onAfterShadow(t,i,r,s,n,e,null)}}const c=i.children;for(let t=0,e=c.length;t<e;t++)x(c[t],r,s,o,a)}function b(t){t.target.removeEventListener("dispose",b);for(const e in l){const i=l[e],n=t.target.uuid;n in i&&(i[n].dispose(),delete i[n])}}this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),l=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(at),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==nt&&this.type===nt,f=v===nt&&this.type!==nt;for(let c=0,l=e.length;c<l;c++){const l=e[c],u=l.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const m=u.getFrameExtents();if(r.multiply(m),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/m.x),r.x=s.x*m.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/m.y),r.y=s.y*m.y,u.mapSize.y=s.y)),null===u.map||!0===p||!0===f){const t=this.type!==nt?{minFilter:le,magFilter:le}:{};null!==u.map&&u.map.dispose(),u.map=new mr(r.x,r.y,t),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),u.updateMatrices(l,t),n=u.getFrustum(),x(i,a,u.camera,l,this.type)}!0!==u.isPointLightShadow&&this.type===nt&&_(u,a),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(c,l,u)}}const Ym={[It]:Ot,[Lt]:Ft,[Nt]:Bt,[Ut]:Wt,[Ot]:It,[Ft]:Lt,[Bt]:Nt,[Wt]:Ut};function Zm(t,e){const i=new function(){let e=!1;const i=new pr;let n=null;const r=new pr(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,o,a){!0===a&&(e*=o,n*=o,s*=o),i.set(e,n,s,o),!1===r.equals(i)&&(t.clearColor(e,n,s,o),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},n=new function(){let i=!1,n=!1,r=null,s=null,o=null;return{setReversed:function(t){if(n!==t){const i=e.get("EXT_clip_control");t?i.clipControlEXT(i.LOWER_LEFT_EXT,i.ZERO_TO_ONE_EXT):i.clipControlEXT(i.LOWER_LEFT_EXT,i.NEGATIVE_ONE_TO_ONE_EXT),n=t;const r=o;o=null,this.setClear(r)}},getReversed:function(){return n},setTest:function(e){e?B(t.DEPTH_TEST):z(t.DEPTH_TEST)},setMask:function(e){r===e||i||(t.depthMask(e),r=e)},setFunc:function(e){if(n&&(e=Ym[e]),s!==e){switch(e){case It:t.depthFunc(t.NEVER);break;case Ot:t.depthFunc(t.ALWAYS);break;case Lt:t.depthFunc(t.LESS);break;case Ut:t.depthFunc(t.LEQUAL);break;case Nt:t.depthFunc(t.EQUAL);break;case Wt:t.depthFunc(t.GEQUAL);break;case Ft:t.depthFunc(t.GREATER);break;case Bt:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}s=e}},setLocked:function(t){i=t},setClear:function(e){o!==e&&(n&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){i=!1,r=null,s=null,o=null,n=!1}}},r=new function(){let e=!1,i=null,n=null,r=null,s=null,o=null,a=null,c=null,l=null;return{setTest:function(i){e||(i?B(t.STENCIL_TEST):z(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&r===i&&s===o||(t.stencilFunc(e,i,o),n=e,r=i,s=o)},setOp:function(e,i,n){o===e&&a===i&&c===n||(t.stencilOp(e,i,n),o=e,a=i,c=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,o=null,a=null,c=null,l=null}}},s=new WeakMap,o=new WeakMap;let a={},c={},l=new WeakMap,h=[],u=null,d=!1,p=null,f=null,m=null,g=null,v=null,_=null,y=null,x=new Hs(0,0,0),b=0,M=!1,S=null,w=null,T=null,E=null,C=null;const P=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let A=!1,D=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(R)[1]),A=D>=1):-1!==R.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),A=D>=2);let k=null,I={};const O=t.getParameter(t.SCISSOR_BOX),L=t.getParameter(t.VIEWPORT),U=(new pr).fromArray(O),N=(new pr).fromArray(L);function W(e,i,n,r){const s=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<n;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(i,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(i+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return o}const F={};function B(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function z(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}F[t.TEXTURE_2D]=W(t.TEXTURE_2D,t.TEXTURE_2D,1),F[t.TEXTURE_CUBE_MAP]=W(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[t.TEXTURE_2D_ARRAY]=W(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),F[t.TEXTURE_3D]=W(t.TEXTURE_3D,t.TEXTURE_3D,1,1),i.setClear(0,0,0,1),n.setClear(1),r.setClear(0),B(t.DEPTH_TEST),n.setFunc(Ut),j(!1),X(J),B(t.CULL_FACE),G(at);const V={[pt]:t.FUNC_ADD,[ft]:t.FUNC_SUBTRACT,[mt]:t.FUNC_REVERSE_SUBTRACT};V[gt]=t.MIN,V[vt]=t.MAX;const H={[_t]:t.ZERO,[yt]:t.ONE,[xt]:t.SRC_COLOR,[Mt]:t.SRC_ALPHA,[Pt]:t.SRC_ALPHA_SATURATE,[Et]:t.DST_COLOR,[wt]:t.DST_ALPHA,[bt]:t.ONE_MINUS_SRC_COLOR,[St]:t.ONE_MINUS_SRC_ALPHA,[Ct]:t.ONE_MINUS_DST_COLOR,[Tt]:t.ONE_MINUS_DST_ALPHA,[At]:t.CONSTANT_COLOR,[Dt]:t.ONE_MINUS_CONSTANT_COLOR,[Rt]:t.CONSTANT_ALPHA,[kt]:t.ONE_MINUS_CONSTANT_ALPHA};function G(e,i,n,r,s,o,a,c,l,h){if(e!==at){if(!1===d&&(B(t.BLEND),d=!0),e===dt)s=s||i,o=o||n,a=a||r,i===f&&s===v||(t.blendEquationSeparate(V[i],V[s]),f=i,v=s),n===m&&r===g&&o===_&&a===y||(t.blendFuncSeparate(H[n],H[r],H[o],H[a]),m=n,g=r,_=o,y=a),!1!==c.equals(x)&&l===b||(t.blendColor(c.r,c.g,c.b,l),x.copy(c),b=l),p=e,M=!1;else if(e!==p||h!==M){if(f===pt&&v===pt||(t.blendEquation(t.FUNC_ADD),f=pt,v=pt),h)switch(e){case ct:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case lt:t.blendFunc(t.ONE,t.ONE);break;case ht:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case ut:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case ct:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case lt:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case ht:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case ut:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,_=null,y=null,x.set(0,0,0),b=0,p=e,M=h}}else!0===d&&(z(t.BLEND),d=!1)}function j(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function X(e){e!==K?(B(t.CULL_FACE),e!==w&&(e===J?t.cullFace(t.BACK):e===$?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):z(t.CULL_FACE),w=e}function q(e,i,n){e?(B(t.POLYGON_OFFSET_FILL),E===i&&C===n||(t.polygonOffset(i,n),E=i,C=n)):z(t.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:n,stencil:r},enable:B,disable:z,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=i),!0)},drawBuffers:function(e,i){let n=h,r=!1;if(e){n=l.get(i),void 0===n&&(n=[],l.set(i,n));const s=e.textures;if(n.length!==s.length||n[0]!==t.COLOR_ATTACHMENT0){for(let e=0,i=s.length;e<i;e++)n[e]=t.COLOR_ATTACHMENT0+e;n.length=s.length,r=!0}}else n[0]!==t.BACK&&(n[0]=t.BACK,r=!0);r&&t.drawBuffers(n)},useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:G,setMaterial:function(e,s){e.side===ot?z(t.CULL_FACE):B(t.CULL_FACE);let o=e.side===st;s&&(o=!o),j(o),e.blending===ct&&!1===e.transparent?G(at):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),i.setMask(e.colorWrite);const a=e.stencilWrite;r.setTest(a),a&&(r.setMask(e.stencilWriteMask),r.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),r.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(t.SAMPLE_ALPHA_TO_COVERAGE):z(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:j,setCullFace:X,setLineWidth:function(e){e!==T&&(A&&t.lineWidth(e),T=e)},setPolygonOffset:q,setScissorTest:function(e){e?B(t.SCISSOR_TEST):z(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+P-1),k!==e&&(t.activeTexture(e),k=e)},bindTexture:function(e,i,n){void 0===n&&(n=null===k?t.TEXTURE0+P-1:k);let r=I[n];void 0===r&&(r={type:void 0,texture:void 0},I[n]=r),r.type===e&&r.texture===i||(k!==n&&(t.activeTexture(n),k=n),t.bindTexture(e,i||F[e]),r.type=e,r.texture=i)},unbindTexture:function(){const e=I[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let n=o.get(i);void 0===n&&(n=new WeakMap,o.set(i,n));let r=n.get(e);void 0===r&&(r=t.getUniformBlockIndex(i,e.name),n.set(e,r))},uniformBlockBinding:function(e,i){const n=o.get(i).get(e);s.get(i)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),s.set(i,n))},texStorage2D:function(){try{t.texStorage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===U.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),U.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),n.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},k=null,I={},c={},l=new WeakMap,h=[],u=null,d=!1,p=null,f=null,m=null,g=null,v=null,_=null,y=null,x=new Hs(0,0,0),b=0,M=!1,S=null,w=null,T=null,E=null,C=null,U.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),i.reset(),n.reset(),r.reset()}}}function Km(t,e,i,n,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),l=new Gn,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):Kn("canvas")}function m(t,e,i){let n=1;const r=V(t);if((r.width>i||r.height>i)&&(n=i/Math.max(r.width,r.height)),n<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const i=Math.floor(n*r.width),s=Math.floor(n*r.height);void 0===u&&(u=f(i,s));const o=e?f(i,s):u;return o.width=i,o.height=s,o.getContext("2d").drawImage(t,0,0,i,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+i+"x"+s+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function g(t){return t.generateMipmaps}function v(e){t.generateMipmap(e)}function _(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function y(i,n,r,s,o=!1){if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let a=n;if(n===t.RED&&(r===t.FLOAT&&(a=t.R32F),r===t.HALF_FLOAT&&(a=t.R16F),r===t.UNSIGNED_BYTE&&(a=t.R8)),n===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(a=t.R8UI),r===t.UNSIGNED_SHORT&&(a=t.R16UI),r===t.UNSIGNED_INT&&(a=t.R32UI),r===t.BYTE&&(a=t.R8I),r===t.SHORT&&(a=t.R16I),r===t.INT&&(a=t.R32I)),n===t.RG&&(r===t.FLOAT&&(a=t.RG32F),r===t.HALF_FLOAT&&(a=t.RG16F),r===t.UNSIGNED_BYTE&&(a=t.RG8)),n===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(a=t.RG8UI),r===t.UNSIGNED_SHORT&&(a=t.RG16UI),r===t.UNSIGNED_INT&&(a=t.RG32UI),r===t.BYTE&&(a=t.RG8I),r===t.SHORT&&(a=t.RG16I),r===t.INT&&(a=t.RG32I)),n===t.RGB_INTEGER&&(r===t.UNSIGNED_BYTE&&(a=t.RGB8UI),r===t.UNSIGNED_SHORT&&(a=t.RGB16UI),r===t.UNSIGNED_INT&&(a=t.RGB32UI),r===t.BYTE&&(a=t.RGB8I),r===t.SHORT&&(a=t.RGB16I),r===t.INT&&(a=t.RGB32I)),n===t.RGBA_INTEGER&&(r===t.UNSIGNED_BYTE&&(a=t.RGBA8UI),r===t.UNSIGNED_SHORT&&(a=t.RGBA16UI),r===t.UNSIGNED_INT&&(a=t.RGBA32UI),r===t.BYTE&&(a=t.RGBA8I),r===t.SHORT&&(a=t.RGBA16I),r===t.INT&&(a=t.RGBA32I)),n===t.RGB&&r===t.UNSIGNED_INT_5_9_9_9_REV&&(a=t.RGB9_E5),n===t.RGBA){const e=o?Hi:nr.getTransfer(s);r===t.FLOAT&&(a=t.RGBA32F),r===t.HALF_FLOAT&&(a=t.RGBA16F),r===t.UNSIGNED_BYTE&&(a=e===Gi?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(a=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(a=t.RGB5_A1)}return a!==t.R16F&&a!==t.R32F&&a!==t.RG16F&&a!==t.RG32F&&a!==t.RGBA16F&&a!==t.RGBA32F||e.get("EXT_color_buffer_float"),a}function x(e,i){let n;return e?null===i||i===we||i===Ae?n=t.DEPTH24_STENCIL8:i===Te?n=t.DEPTH32F_STENCIL8:i===Me&&(n=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===i||i===we||i===Ae?n=t.DEPTH_COMPONENT24:i===Te?n=t.DEPTH_COMPONENT32F:i===Me&&(n=t.DEPTH_COMPONENT16),n}function b(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==le&&t.minFilter!==fe?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(t){const e=t.target;e.removeEventListener("dispose",M),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=d.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&w(t),0===Object.keys(r).length&&d.delete(i)}n.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=n.get(e);if(e.depthTexture&&(e.depthTexture.dispose(),n.remove(e.depthTexture)),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(i.__webglFramebuffer[e]))for(let n=0;n<i.__webglFramebuffer[e].length;n++)t.deleteFramebuffer(i.__webglFramebuffer[e][n]);else t.deleteFramebuffer(i.__webglFramebuffer[e]);i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e])}else{if(Array.isArray(i.__webglFramebuffer))for(let e=0;e<i.__webglFramebuffer.length;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let e=0;e<i.__webglColorRenderbuffer.length;e++)i.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(i.__webglColorRenderbuffer[e]);i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer)}const r=e.textures;for(let e=0,i=r.length;e<i;e++){const i=n.get(r[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),o.memory.textures--),n.remove(r[e])}n.remove(e)}(i)}function w(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete d.get(r)[i.__cacheKey],o.memory.textures--}let T=0;function E(e,r){const s=n.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void k(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const C={[oe]:t.REPEAT,[ae]:t.CLAMP_TO_EDGE,[ce]:t.MIRRORED_REPEAT},P={[le]:t.NEAREST,[he]:t.NEAREST_MIPMAP_NEAREST,[de]:t.NEAREST_MIPMAP_LINEAR,[fe]:t.LINEAR,[me]:t.LINEAR_MIPMAP_NEAREST,[ve]:t.LINEAR_MIPMAP_LINEAR},A={[cn]:t.NEVER,[mn]:t.ALWAYS,[ln]:t.LESS,[un]:t.LEQUAL,[hn]:t.EQUAL,[fn]:t.GEQUAL,[dn]:t.GREATER,[pn]:t.NOTEQUAL};function D(i,s){if(s.type!==Te||!1!==e.has("OES_texture_float_linear")||s.magFilter!==fe&&s.magFilter!==me&&s.magFilter!==de&&s.magFilter!==ve&&s.minFilter!==fe&&s.minFilter!==me&&s.minFilter!==de&&s.minFilter!==ve||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(i,t.TEXTURE_WRAP_S,C[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,C[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,C[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,P[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,P[s.minFilter]),s.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,A[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===le)return;if(s.minFilter!==de&&s.minFilter!==ve)return;if(s.type===Te&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||n.get(s).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy}}}function R(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",M));const r=i.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&w(i)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return n}function k(e,o,a){let c=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(c=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(c=t.TEXTURE_3D);const l=R(e,o),h=o.source;i.bindTexture(c,e.__webglTexture,t.TEXTURE0+a);const u=n.get(h);if(h.version!==u.__version||!0===l){i.activeTexture(t.TEXTURE0+a);const e=nr.getPrimaries(nr.workingColorSpace),n=o.colorSpace===Bi?null:nr.getPrimaries(o.colorSpace),d=o.colorSpace===Bi||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,r.maxTextureSize);p=z(o,p);const f=s.convert(o.format,o.colorSpace),_=s.convert(o.type);let M,S=y(o.internalFormat,f,_,o.colorSpace,o.isVideoTexture);D(c,o);const w=o.mipmaps,T=!0!==o.isVideoTexture,E=void 0===u.__version||!0===l,C=h.dataReady,P=b(o,p);if(o.isDepthTexture)S=x(o.format===Le,o.type),E&&(T?i.texStorage2D(t.TEXTURE_2D,1,S,p.width,p.height):i.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,null));else if(o.isDataTexture)if(w.length>0){T&&E&&i.texStorage2D(t.TEXTURE_2D,P,S,w[0].width,w[0].height);for(let e=0,n=w.length;e<n;e++)M=w[e],T?C&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,_,M.data):i.texImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,f,_,M.data);o.generateMipmaps=!1}else T?(E&&i.texStorage2D(t.TEXTURE_2D,P,S,p.width,p.height),C&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,_,p.data)):i.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&E&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,S,w[0].width,w[0].height,p.depth);for(let e=0,n=w.length;e<n;e++)if(M=w[e],o.format!==Ie)if(null!==f)if(T){if(C)if(o.layerUpdates.size>0){const n=bp(M.width,M.height,o.format,o.type);for(const r of o.layerUpdates){const s=M.data.subarray(r*n/M.data.BYTES_PER_ELEMENT,(r+1)*n/M.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,r,M.width,M.height,1,f,s)}o.clearLayerUpdates()}else i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,M.width,M.height,p.depth,f,M.data)}else i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,S,M.width,M.height,p.depth,0,M.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?C&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,M.width,M.height,p.depth,f,_,M.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,S,M.width,M.height,p.depth,0,f,_,M.data)}else{T&&E&&i.texStorage2D(t.TEXTURE_2D,P,S,w[0].width,w[0].height);for(let e=0,n=w.length;e<n;e++)M=w[e],o.format!==Ie?null!==f?T?C&&i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,M.data):i.compressedTexImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?C&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,_,M.data):i.texImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,f,_,M.data)}else if(o.isDataArrayTexture)if(T){if(E&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,S,p.width,p.height,p.depth),C)if(o.layerUpdates.size>0){const e=bp(p.width,p.height,o.format,o.type);for(const n of o.layerUpdates){const r=p.data.subarray(n*e/p.data.BYTES_PER_ELEMENT,(n+1)*e/p.data.BYTES_PER_ELEMENT);i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,n,p.width,p.height,1,f,_,r)}o.clearLayerUpdates()}else i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else i.texImage3D(t.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(o.isData3DTexture)T?(E&&i.texStorage3D(t.TEXTURE_3D,P,S,p.width,p.height,p.depth),C&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):i.texImage3D(t.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(o.isFramebufferTexture){if(E)if(T)i.texStorage2D(t.TEXTURE_2D,P,S,p.width,p.height);else{let e=p.width,n=p.height;for(let r=0;r<P;r++)i.texImage2D(t.TEXTURE_2D,r,S,e,n,0,f,_,null),e>>=1,n>>=1}}else if(w.length>0){if(T&&E){const e=V(w[0]);i.texStorage2D(t.TEXTURE_2D,P,S,e.width,e.height)}for(let e=0,n=w.length;e<n;e++)M=w[e],T?C&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,_,M):i.texImage2D(t.TEXTURE_2D,e,S,f,_,M);o.generateMipmaps=!1}else if(T){if(E){const e=V(p);i.texStorage2D(t.TEXTURE_2D,P,S,e.width,e.height)}C&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,_,p)}else i.texImage2D(t.TEXTURE_2D,0,S,f,_,p);g(o)&&v(c),u.__version=h.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function I(e,r,o,c,l,h){const u=s.convert(o.format,o.colorSpace),d=s.convert(o.type),p=y(o.internalFormat,u,d,o.colorSpace),f=n.get(r),m=n.get(o);if(m.__renderTarget=r,!f.__hasExternalTextures){const e=Math.max(1,r.width>>h),n=Math.max(1,r.height>>h);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,h,p,e,n,r.depth,0,u,d,null):i.texImage2D(l,h,p,e,n,0,u,d,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),B(r)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,c,l,m.__webglTexture,0,F(r)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,c,l,m.__webglTexture,h),i.bindFramebuffer(t.FRAMEBUFFER,null)}function O(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer){const r=i.depthTexture,s=r&&r.isDepthTexture?r.type:null,o=x(i.stencilBuffer,s),c=i.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,l=F(i);B(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,l,o,i.width,i.height):n?t.renderbufferStorageMultisample(t.RENDERBUFFER,l,o,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,o,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,c,t.RENDERBUFFER,e)}else{const e=i.textures;for(let r=0;r<e.length;r++){const o=e[r],c=s.convert(o.format,o.colorSpace),l=s.convert(o.type),h=y(o.internalFormat,c,l,o.colorSpace),u=F(i);n&&!1===B(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,h,i.width,i.height):B(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,h,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,h,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function L(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=n.get(r.depthTexture);s.__renderTarget=r,s.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const o=s.__webglTexture,c=F(r);if(r.depthTexture.format===Oe)B(r)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,c):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==Le)throw new Error("Unknown depthTexture format");B(r)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,c):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}function U(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),t){const e=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),r.__depthDisposeCallback=e}r.__boundDepthTexture=t}if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");const t=e.texture.mipmaps;t&&t.length>0?L(r.__webglFramebuffer[0],e):L(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)if(i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[n]),void 0===r.__webglDepthbuffer[n])r.__webglDepthbuffer[n]=t.createRenderbuffer(),O(r.__webglDepthbuffer[n],e,!1);else{const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,s=r.__webglDepthbuffer[n];t.bindRenderbuffer(t.RENDERBUFFER,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,s)}}else{const n=e.texture.mipmaps;if(n&&n.length>0?i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[0]):i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=t.createRenderbuffer(),O(r.__webglDepthbuffer,e,!1);else{const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,n=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,n),t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,n)}}i.bindFramebuffer(t.FRAMEBUFFER,null)}const N=[],W=[];function F(t){return Math.min(r.maxSamples,t.samples)}function B(t){const i=n.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function z(t,e){const i=t.colorSpace,n=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||i!==Vi&&i!==Bi&&(nr.getTransfer(i)===Gi?n===Ie&&r===ye||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),e}function V(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(l.width=t.naturalWidth||t.width,l.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(l.width=t.displayWidth,l.height=t.displayHeight):(l.width=t.width,l.height=t.height),l}this.allocateTextureUnit=function(){const t=T;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?k(s,e,r):i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?k(s,e,r):i.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,o){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,o,a){if(6!==o.image.length)return;const c=R(e,o),l=o.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+a);const h=n.get(l);if(l.version!==h.__version||!0===c){i.activeTexture(t.TEXTURE0+a);const e=nr.getPrimaries(nr.workingColorSpace),n=o.colorSpace===Bi?null:nr.getPrimaries(o.colorSpace),u=o.colorSpace===Bi||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:m(o.image[t],!0,r.maxCubemapSize),f[t]=z(o,f[t]);const _=f[0],x=s.convert(o.format,o.colorSpace),M=s.convert(o.type),S=y(o.internalFormat,x,M,o.colorSpace),w=!0!==o.isVideoTexture,T=void 0===h.__version||!0===c,E=l.dataReady;let C,P=b(o,_);if(D(t.TEXTURE_CUBE_MAP,o),d){w&&T&&i.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,_.width,_.height);for(let e=0;e<6;e++){C=f[e].mipmaps;for(let n=0;n<C.length;n++){const r=C[n];o.format!==Ie?null!==x?w?E&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r.width,r.height,x,r.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?E&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r.width,r.height,x,M,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,S,r.width,r.height,0,x,M,r.data)}}}else{if(C=o.mipmaps,w&&T){C.length>0&&P++;const e=V(f[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){w?E&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,x,M,f[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,f[e].width,f[e].height,0,x,M,f[e].data);for(let n=0;n<C.length;n++){const r=C[n].image[e].image;w?E&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,r.width,r.height,x,M,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,S,r.width,r.height,0,x,M,r.data)}}else{w?E&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,x,M,f[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,x,M,f[e]);for(let n=0;n<C.length;n++){const r=C[n];w?E&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,x,M,r.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,S,x,M,r.image[e])}}}g(o)&&v(t.TEXTURE_CUBE_MAP),h.__version=l.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(a,e,o):i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,i,r){const s=n.get(e);void 0!==i&&I(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&U(e)},this.setupRenderTarget=function(e){const r=e.texture,a=n.get(e),c=n.get(r);e.addEventListener("dispose",S);const l=e.textures,h=!0===e.isWebGLCubeRenderTarget,u=l.length>1;if(u||(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=r.version,o.memory.textures++),h){a.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer[e]=[];for(let i=0;i<r.mipmaps.length;i++)a.__webglFramebuffer[e][i]=t.createFramebuffer()}else a.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)a.__webglFramebuffer[e]=t.createFramebuffer()}else a.__webglFramebuffer=t.createFramebuffer();if(u)for(let e=0,i=l.length;e<i;e++){const i=n.get(l[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===B(e)){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let i=0;i<l.length;i++){const n=l[i];a.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,a.__webglColorRenderbuffer[i]);const r=s.convert(n.format,n.colorSpace),o=s.convert(n.type),c=y(n.internalFormat,r,o,n.colorSpace,!0===e.isXRRenderTarget),h=F(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,a.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),O(a.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),D(t.TEXTURE_CUBE_MAP,r);for(let i=0;i<6;i++)if(r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)I(a.__webglFramebuffer[i][n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else I(a.__webglFramebuffer[i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);g(r)&&v(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(u){for(let r=0,s=l.length;r<s;r++){const s=l[r],o=n.get(s);i.bindTexture(t.TEXTURE_2D,o.__webglTexture),D(t.TEXTURE_2D,s),I(a.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),g(s)&&v(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(n,c.__webglTexture),D(n,r),r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)I(a.__webglFramebuffer[i],e,r,t.COLOR_ATTACHMENT0,n,i);else I(a.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,n,0);g(r)&&v(n),i.unbindTexture()}e.depthBuffer&&U(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let r=0,s=e.length;r<s;r++){const s=e[r];if(g(s)){const e=_(t),r=n.get(s).__webglTexture;i.bindTexture(e,r),v(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===B(e)){const r=e.textures,s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=n.get(e),u=r.length>1;if(u)for(let e=0;e<r.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer);const d=e.texture.mipmaps;d&&d.length>0?i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer[0]):i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<r.length;i++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),u){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[i]);const e=n.get(r[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),!0===c&&(N.length=0,W.length=0,N.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&!1===e.resolveDepthBuffer&&(N.push(l),W.push(l),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,W)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,N))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<r.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=n.get(r[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&c){const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[i])}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=I,this.useMultisampledRTT=B}function Jm(t,e){return{convert:function(i,n=Bi){let r;const s=nr.getTransfer(n);if(i===ye)return t.UNSIGNED_BYTE;if(i===Ce)return t.UNSIGNED_SHORT_4_4_4_4;if(i===Pe)return t.UNSIGNED_SHORT_5_5_5_1;if(i===De)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===xe)return t.BYTE;if(i===be)return t.SHORT;if(i===Me)return t.UNSIGNED_SHORT;if(i===Se)return t.INT;if(i===we)return t.UNSIGNED_INT;if(i===Te)return t.FLOAT;if(i===Ee)return t.HALF_FLOAT;if(i===Re)return t.ALPHA;if(i===ke)return t.RGB;if(i===Ie)return t.RGBA;if(i===Oe)return t.DEPTH_COMPONENT;if(i===Le)return t.DEPTH_STENCIL;if(i===Ue)return t.RED;if(i===Ne)return t.RED_INTEGER;if(i===We)return t.RG;if(i===Fe)return t.RG_INTEGER;if(i===ze)return t.RGBA_INTEGER;if(i===Ve||i===He||i===Ge||i===je)if(s===Gi){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===Ve)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===He)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Ge)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===je)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===Ve)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===He)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ge)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===je)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===Xe||i===qe||i===Ye||i===Ze){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(i===Xe)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===qe)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Ye)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Ze)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===Ke||i===Je||i===$e){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(i===Ke||i===Je)return s===Gi?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===$e)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(i===Qe||i===ti||i===ei||i===ii||i===ni||i===ri||i===si||i===oi||i===ai||i===ci||i===li||i===hi||i===ui||i===di){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(i===Qe)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===ti)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===ei)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===ii)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===ni)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===ri)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===si)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===oi)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===ai)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===ci)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===li)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===hi)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===ui)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===di)return s===Gi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===pi||i===fi||i===mi){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(i===pi)return s===Gi?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===fi)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===mi)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===gi||i===vi||i===_i||i===yi){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===pi)return r.COMPRESSED_RED_RGTC1_EXT;if(i===vi)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===_i)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===yi)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Ae?t.UNSIGNED_INT_24_8:void 0!==t[i]?t[i]:null}}}class $m{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,i){if(null===this.texture){const n=new dr;t.properties.get(n).__webglTexture=e.texture,e.depthNear===i.depthNear&&e.depthFar===i.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,i=new Fo({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new ko(new dh(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Qm extends kn{constructor(t,e){super();const i=this;let n=null,r=1,s=null,o="local-floor",a=1,c=null,l=null,h=null,u=null,d=null,p=null;const f=new $m,m=e.getContextAttributes();let g=null,v=null;const _=[],y=[],x=new Gn;let b=null;const M=new Go;M.viewport=new pr;const S=new Go;S.viewport=new pr;const w=[M,S],T=new Ku;let E=null,C=null;function P(t){const e=y.indexOf(t.inputSource);if(-1===e)return;const i=_[e];void 0!==i&&(i.update(t.inputSource,t.frame,c||s),i.dispatchEvent({type:t.type,data:t.inputSource}))}function A(){n.removeEventListener("select",P),n.removeEventListener("selectstart",P),n.removeEventListener("selectend",P),n.removeEventListener("squeeze",P),n.removeEventListener("squeezestart",P),n.removeEventListener("squeezeend",P),n.removeEventListener("end",A),n.removeEventListener("inputsourceschange",D);for(let t=0;t<_.length;t++){const e=y[t];null!==e&&(y[t]=null,_[t].disconnect(e))}E=null,C=null,f.reset(),t.setRenderTarget(g),d=null,u=null,h=null,n=null,v=null,L.stop(),i.isPresenting=!1,t.setPixelRatio(b),t.setSize(x.width,x.height,!1),i.dispatchEvent({type:"sessionend"})}function D(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=y.indexOf(i);n>=0&&(y[n]=null,_[n].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=y.indexOf(i);if(-1===n){for(let t=0;t<_.length;t++){if(t>=y.length){y.push(i),n=t;break}if(null===y[t]){y[t]=i,n=t;break}}if(-1===n)break}const r=_[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new Jo,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new Jo,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new Jo,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(t){c=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(g=t.getRenderTarget(),n.addEventListener("select",P),n.addEventListener("selectstart",P),n.addEventListener("selectend",P),n.addEventListener("squeeze",P),n.addEventListener("squeezestart",P),n.addEventListener("squeezeend",P),n.addEventListener("end",A),n.addEventListener("inputsourceschange",D),!0!==m.xrCompatible&&await e.makeXRCompatible(),b=t.getPixelRatio(),t.getSize(x),"undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let i=null,s=null,o=null;m.depth&&(o=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=m.stencil?Le:Oe,s=m.stencil?Ae:we);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:r};h=new XRWebGLBinding(n,e),u=h.createProjectionLayer(a),n.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),v=new mr(u.textureWidth,u.textureHeight,{format:Ie,type:ye,depthTexture:new Kc(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===u.ignoreDepthValues,resolveStencilBuffer:!1===u.ignoreDepthValues})}else{const i={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new mr(d.framebufferWidth,d.framebufferHeight,{format:Ie,type:ye,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(a),c=null,s=await n.requestReferenceSpace(o),L.setContext(n),L.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const R=new br,k=new br;function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;let e=t.near,i=t.far;null!==f.texture&&(f.depthNear>0&&(e=f.depthNear),f.depthFar>0&&(i=f.depthFar)),T.near=S.near=M.near=e,T.far=S.far=M.far=i,E===T.near&&C===T.far||(n.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,C=T.far),M.layers.mask=2|t.layers.mask,S.layers.mask=4|t.layers.mask,T.layers.mask=M.layers.mask|S.layers.mask;const r=t.parent,s=T.cameras;I(T,r);for(let t=0;t<s.length;t++)I(s[t],r);2===s.length?function(t,e,i){R.setFromMatrixPosition(e.matrixWorld),k.setFromMatrixPosition(i.matrixWorld);const n=R.distanceTo(k),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=n/(-h+u),m=f*-h;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===r[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,i=a+f,r=d-m,s=p+(n-m),h=c*a/i*e,u=l*a/i*e;t.projectionMatrix.makePerspective(r,s,h,u,e,i),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(T,M,S):T.projectionMatrix.copy(M.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Un*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,T,r)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(t){a=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let O=null;const L=new Sp;L.setAnimationLoop((function(e,r){if(l=r.getViewerPose(c||s),p=r,null!==l){const e=l.views;null!==d&&(t.setRenderTargetFramebuffer(v,d.framebuffer),t.setRenderTarget(v));let i=!1;e.length!==T.cameras.length&&(T.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==d)s=d.getViewport(r);else{const e=h.getViewSubImage(u,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(v,e.colorTexture,e.depthStencilTexture),t.setRenderTarget(v))}let o=w[n];void 0===o&&(o=new Go,o.layers.enable(n),o.viewport=new pr,w[n]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&(T.matrix.copy(o.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===i&&T.cameras.push(o)}const r=n.enabledFeatures;if(r&&r.includes("depth-sensing")&&"gpu-optimized"==n.depthUsage&&h){const i=h.getDepthInformation(e[0]);i&&i.isValid&&i.texture&&f.init(t,i,n.renderState)}}for(let t=0;t<_.length;t++){const e=y[t],i=_[t];null!==e&&void 0!==i&&i.update(e,r,c||s)}O&&O(e,r),r.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(t){O=t},this.dispose=function(){}}}const tg=new as,eg=new Jr;function ig(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function n(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map,i(n.map,t.mapTransform)),n.alphaMap&&(t.alphaMap.value=n.alphaMap,i(n.alphaMap,t.alphaMapTransform)),n.bumpMap&&(t.bumpMap.value=n.bumpMap,i(n.bumpMap,t.bumpMapTransform),t.bumpScale.value=n.bumpScale,n.side===st&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,i(n.normalMap,t.normalMapTransform),t.normalScale.value.copy(n.normalScale),n.side===st&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,i(n.displacementMap,t.displacementMapTransform),t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap,i(n.emissiveMap,t.emissiveMapTransform)),n.specularMap&&(t.specularMap.value=n.specularMap,i(n.specularMap,t.specularMapTransform)),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const r=e.get(n),s=r.envMap,o=r.envMapRotation;s&&(t.envMap.value=s,tg.copy(o),tg.x*=-1,tg.y*=-1,tg.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(tg.y*=-1,tg.z*=-1),t.envMapRotation.value.setFromMatrix4(eg.makeRotationFromEuler(tg)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity,i(n.lightMap,t.lightMapTransform)),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity,i(n.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,No(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,r,s,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(t,r):r.isMeshToonMaterial?(n(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(n(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(n(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,i(e.metalnessMap,t.metalnessMapTransform)),t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,i(e.roughnessMap,t.roughnessMapTransform)),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===st&&t.clearcoatNormalScale.value.negate())),e.dispersion>0&&(t.dispersion.value=e.dispersion),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,a)):r.isMeshMatcapMaterial?(n(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?n(t,r):r.isMeshDistanceMaterial?(n(t,r),function(t,i){const n=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(n.matrixWorld),t.nearDistance.value=n.shadow.camera.near,t.farDistance.value=n.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?n(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function ng(t,e,i,n){let r={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(t,e,i,n){const r=t.value,s=e+"_"+i;if(void 0===n[s])return n[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const t=n[s];if("number"==typeof r||"boolean"==typeof r){if(t!==r)return n[s]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function l(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const i=e.target;i.removeEventListener("dispose",h);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),t.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,u){let d=r[i.id];void 0===d&&(function(t){const e=t.uniforms;let i=0;for(let t=0,n=e.length;t<n;t++){const n=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=n.length;t<e;t++){const e=n[t],r=Array.isArray(e.value)?e.value:[e.value];for(let t=0,n=r.length;t<n;t++){const n=l(r[t]),s=i%16,o=s%n.boundary,a=s+o;i+=o,0!==a&&16-a<n.storage&&(i+=16-a),e.__data=new Float32Array(n.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,i+=n.storage}}}const n=i%16;n>0&&(i+=16-n),t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const n=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",h));const p=u.program;n.updateUBOMapping(i,p);const f=e.render.frame;s[i.id]!==f&&(function(e){const i=r[e.id],n=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=n.length;e<i;e++){const i=Array.isArray(n[e])?n[e]:[n[e]];for(let n=0,r=i.length;n<r;n++){const r=i[n];if(!0===c(r,e,n,s)){const e=r.__offset,i=Array.isArray(r.value)?r.value:[r.value];let n=0;for(let s=0;s<i.length;s++){const o=i[s],a=l(o);"number"==typeof o||"boolean"==typeof o?(r.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+n,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,n),n+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,r.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),s[i.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},s={}}}}class rg{constructor(t={}){const{canvas:e=Jn(),context:i=null,depth:n=!0,stencil:r=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:c=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:u=!1}=t;let d;if(this.isWebGLRenderer=!0,null!==i){if("undefined"!=typeof WebGLRenderingContext&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=i.getContextAttributes().alpha}else d=s;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const v=[],_=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Gt,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const y=this;let x=!1;this._outputColorSpace=zi;let b=0,M=0,S=null,w=-1,T=null;const E=new pr,C=new pr;let P=null;const A=new Hs(0);let D=0,R=e.width,k=e.height,I=1,O=null,L=null;const U=new pr(0,0,R,k),N=new pr(0,0,R,k);let W=!1;const F=new Qa;let B=!1,z=!1;const V=new Jr,H=new Jr,G=new br,j=new pr,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Y=!1;function Z(){return null===S?I:1}let K,J,$,Q,tt,et,it,nt,at,ct,lt,ht,ut,dt,pt,ft,mt,gt,vt,_t,yt,xt,bt,Mt,St=i;function wt(t,i){return e.getContext(t,i)}try{const t={alpha:!0,depth:n,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${q}`),e.addEventListener("webglcontextlost",Ct,!1),e.addEventListener("webglcontextrestored",Pt,!1),e.addEventListener("webglcontextcreationerror",At,!1),null===St){const e="webgl2";if(St=wt(e,t),null===St)throw wt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Tt(){K=new tf(St),K.init(),xt=new Jm(St,K),J=new Op(St,K,t,xt),$=new Zm(St,K),J.reverseDepthBuffer&&u&&$.buffers.depth.setReversed(!0),Q=new rf(St),tt=new Um,et=new Km(St,K,$,tt,J,xt,Q),it=new Up(y),nt=new Qp(y),at=new wp(St),bt=new kp(St,at),ct=new ef(St,at,Q,bt),lt=new of(St,ct,at,Q),vt=new sf(St,J,et),ft=new Lp(tt),ht=new Lm(y,it,nt,K,J,bt,ft),ut=new ig(y,tt),dt=new Bm,pt=new Xm(K),gt=new Rp(y,it,nt,$,lt,d,a),mt=new qm(y,lt,J),Mt=new ng(St,Q,J,$),_t=new Ip(St,K,Q),yt=new nf(St,K,Q),Q.programs=ht.programs,y.capabilities=J,y.extensions=K,y.properties=tt,y.renderLists=dt,y.shadowMap=mt,y.state=$,y.info=Q}Tt();const Et=new Qm(y,St);function Ct(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Pt(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=Q.autoReset,e=mt.enabled,i=mt.autoUpdate,n=mt.needsUpdate,r=mt.type;Tt(),Q.autoReset=t,mt.enabled=e,mt.autoUpdate=i,mt.needsUpdate=n,mt.type=r}function At(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Dt(t){const e=t.target;e.removeEventListener("dispose",Dt),function(t){(function(t){const e=tt.get(t).programs;void 0!==e&&(e.forEach((function(t){ht.releaseProgram(t)})),t.isShaderMaterial&&ht.releaseShaderCache(t))})(t),tt.remove(t)}(e)}function Rt(t,e,i){!0===t.transparent&&t.side===ot&&!1===t.forceSinglePass?(t.side=st,t.needsUpdate=!0,zt(t,e,i),t.side=rt,t.needsUpdate=!0,zt(t,e,i),t.side=ot):zt(t,e,i)}this.xr=Et,this.getContext=function(){return St},this.getContextAttributes=function(){return St.getContextAttributes()},this.forceContextLoss=function(){const t=K.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=K.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(R,k,!1))},this.getSize=function(t){return t.set(R,k)},this.setSize=function(t,i,n=!0){Et.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,k=i,e.width=Math.floor(t*I),e.height=Math.floor(i*I),!0===n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(R*I,k*I).floor()},this.setDrawingBufferSize=function(t,i,n){R=t,k=i,I=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(U)},this.setViewport=function(t,e,i,n){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,i,n),$.viewport(E.copy(U).multiplyScalar(I).round())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,i,n){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,i,n),$.scissor(C.copy(N).multiplyScalar(I).round())},this.getScissorTest=function(){return W},this.setScissorTest=function(t){$.setScissorTest(W=t)},this.setOpaqueSort=function(t){O=t},this.setTransparentSort=function(t){L=t},this.getClearColor=function(t){return t.copy(gt.getClearColor())},this.setClearColor=function(){gt.setClearColor(...arguments)},this.getClearAlpha=function(){return gt.getClearAlpha()},this.setClearAlpha=function(){gt.setClearAlpha(...arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;if(t){let t=!1;if(null!==S){const e=S.texture.format;t=e===ze||e===Fe||e===Ne}if(t){const t=S.texture.type,e=t===ye||t===we||t===Me||t===Ae||t===Ce||t===Pe,i=gt.getClearColor(),n=gt.getClearAlpha(),r=i.r,s=i.g,o=i.b;e?(p[0]=r,p[1]=s,p[2]=o,p[3]=n,St.clearBufferuiv(St.COLOR,0,p)):(f[0]=r,f[1]=s,f[2]=o,f[3]=n,St.clearBufferiv(St.COLOR,0,f))}else n|=St.COLOR_BUFFER_BIT}e&&(n|=St.DEPTH_BUFFER_BIT),i&&(n|=St.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),St.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ct,!1),e.removeEventListener("webglcontextrestored",Pt,!1),e.removeEventListener("webglcontextcreationerror",At,!1),gt.dispose(),dt.dispose(),pt.dispose(),tt.dispose(),it.dispose(),nt.dispose(),lt.dispose(),bt.dispose(),Mt.dispose(),ht.dispose(),Et.dispose(),Et.removeEventListener("sessionstart",It),Et.removeEventListener("sessionend",Ot),Lt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=X);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,i,n,r){!0!==e.isScene&&(e=X),et.resetTextureUnits();const s=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===S?y.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:Vi,c=(n.isMeshStandardMaterial?nt:it).get(n.envMap||o),l=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!i.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let f=Gt;n.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=y.toneMapping));const m=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==m?m.length:0,_=tt.get(n),x=g.state.lights;if(!0===B&&(!0===z||t!==T)){const e=t===T&&n.id===w;ft.setState(n,t,e)}let b=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputColorSpace!==a||r.isBatchedMesh&&!1===_.batching?b=!0:r.isBatchedMesh||!0!==_.batching?r.isBatchedMesh&&!0===_.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===_.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===_.instancing?b=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?b=!0:r.isSkinnedMesh||!0!==_.skinning?r.isInstancedMesh&&!0===_.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===_.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===_.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===_.instancingMorph&&null!==r.morphTexture||_.envMap!==c||!0===n.fog&&_.fog!==s?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===ft.numPlanes&&_.numIntersection===ft.numIntersection?(_.vertexAlphas!==l||_.vertexTangents!==h||_.morphTargets!==u||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==f||_.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,_.__version=n.version);let M=_.currentProgram;!0===b&&(M=zt(n,e,r));let E=!1,C=!1,P=!1;const A=M.getUniforms(),D=_.uniforms;if($.useProgram(M.program)&&(E=!0,C=!0,P=!0),n.id!==w&&(w=n.id,C=!0),E||T!==t){$.buffers.depth.getReversed()?(V.copy(t.projectionMatrix),function(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}(V),function(t){const e=t.elements;-1===e[11]?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=1-e[14])}(V),A.setValue(St,"projectionMatrix",V)):A.setValue(St,"projectionMatrix",t.projectionMatrix),A.setValue(St,"viewMatrix",t.matrixWorldInverse);const e=A.map.cameraPosition;void 0!==e&&e.setValue(St,G.setFromMatrixPosition(t.matrixWorld)),J.logarithmicDepthBuffer&&A.setValue(St,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&A.setValue(St,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,C=!0,P=!0)}if(r.isSkinnedMesh){A.setOptional(St,r,"bindMatrix"),A.setOptional(St,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),A.setValue(St,"boneTexture",t.boneTexture,et))}r.isBatchedMesh&&(A.setOptional(St,r,"batchingTexture"),A.setValue(St,"batchingTexture",r._matricesTexture,et),A.setOptional(St,r,"batchingIdTexture"),A.setValue(St,"batchingIdTexture",r._indirectTexture,et),A.setOptional(St,r,"batchingColorTexture"),null!==r._colorsTexture&&A.setValue(St,"batchingColorTexture",r._colorsTexture,et));const R=i.morphAttributes;var O,L;if(void 0===R.position&&void 0===R.normal&&void 0===R.color||vt.update(r,i,M),(C||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,A.setValue(St,"receiveShadow",r.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(D.envMap.value=c,D.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1),n.isMeshStandardMaterial&&null===n.envMap&&null!==e.environment&&(D.envMapIntensity.value=e.environmentIntensity),C&&(A.setValue(St,"toneMappingExposure",y.toneMappingExposure),_.needsLights&&(L=P,(O=D).ambientLightColor.needsUpdate=L,O.lightProbe.needsUpdate=L,O.directionalLights.needsUpdate=L,O.directionalLightShadows.needsUpdate=L,O.pointLights.needsUpdate=L,O.pointLightShadows.needsUpdate=L,O.spotLights.needsUpdate=L,O.spotLightShadows.needsUpdate=L,O.rectAreaLights.needsUpdate=L,O.hemisphereLights.needsUpdate=L),s&&!0===n.fog&&ut.refreshFogUniforms(D,s),ut.refreshMaterialUniforms(D,n,I,k,g.state.transmissionRenderTarget[t.id]),um.upload(St,Vt(_),D,et)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(um.upload(St,Vt(_),D,et),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&A.setValue(St,"center",r.center),A.setValue(St,"modelViewMatrix",r.modelViewMatrix),A.setValue(St,"normalMatrix",r.normalMatrix),A.setValue(St,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++){const i=t[e];Mt.update(i,M),Mt.bind(i,M)}}return M}(t,e,i,n,r);$.setMaterial(n,o);let c=i.index,l=1;if(!0===n.wireframe){if(c=ct.getWireframeAttribute(i),void 0===c)return;l=2}const h=i.drawRange,u=i.attributes.position;let d=h.start*l,p=(h.start+h.count)*l;null!==s&&(d=Math.max(d,s.start*l),p=Math.min(p,(s.start+s.count)*l)),null!==c?(d=Math.max(d,0),p=Math.min(p,c.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let m;bt.setup(r,n,a,i,c);let v=_t;if(null!==c&&(m=at.get(c),v=yt,v.setIndex(m)),r.isMesh)!0===n.wireframe?($.setLineWidth(n.wireframeLinewidth*Z()),v.setMode(St.LINES)):v.setMode(St.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),$.setLineWidth(t*Z()),r.isLineSegments?v.setMode(St.LINES):r.isLineLoop?v.setMode(St.LINE_LOOP):v.setMode(St.LINE_STRIP)}else r.isPoints?v.setMode(St.POINTS):r.isSprite&&v.setMode(St.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)Qn("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const t=r._multiDrawStarts,e=r._multiDrawCounts,i=r._multiDrawCount,s=c?at.get(c).bytesPerElement:1,o=tt.get(n).currentProgram.getUniforms();for(let n=0;n<i;n++)o.setValue(St,"_gl_DrawID",n),v.render(t[n]/s,e[n])}else if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);v.renderInstances(d,f,e)}else v.render(d,f)},this.compile=function(t,e,i=null){null===i&&(i=t),g=pt.get(i),g.init(e),_.push(g),i.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),t!==i&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),g.setupLights();const n=new Set;return t.traverse((function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];Rt(s,i,t),n.add(s)}else Rt(e,i,t),n.add(e)})),g=_.pop(),n},this.compileAsync=function(t,e,i=null){const n=this.compile(t,e,i);return new Promise((e=>{function i(){n.forEach((function(t){tt.get(t).currentProgram.isReady()&&n.delete(t)})),0!==n.size?setTimeout(i,10):e(t)}null!==K.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)}))};let kt=null;function It(){Lt.stop()}function Ot(){Lt.start()}const Lt=new Sp;function Ut(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||F.intersectsSprite(t)){n&&j.setFromMatrixPosition(t.matrixWorld).applyMatrix4(H);const e=lt.update(t),r=t.material;r.visible&&m.push(t,e,r,i,j.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||F.intersectsObject(t))){const e=lt.update(t),r=t.material;if(n&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),j.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),j.copy(e.boundingSphere.center)),j.applyMatrix4(t.matrixWorld).applyMatrix4(H)),Array.isArray(r)){const n=e.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&m.push(t,e,a,i,j.z,o)}}else r.visible&&m.push(t,e,r,i,j.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Ut(r[t],e,i,n)}function Nt(t,e,i,n){const r=t.opaque,s=t.transmissive,o=t.transparent;g.setupLightsView(i),!0===B&&ft.setGlobalState(y.clippingPlanes,i),n&&$.viewport(E.copy(n)),r.length>0&&Ft(r,e,i),s.length>0&&Ft(s,e,i),o.length>0&&Ft(o,e,i),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function Wt(t,e,i,n){if(null!==(!0===i.isScene?i.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[n.id]&&(g.state.transmissionRenderTarget[n.id]=new mr(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?Ee:ye,minFilter:ve,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:nr.workingColorSpace}));const s=g.state.transmissionRenderTarget[n.id],o=n.viewport||E;s.setSize(o.z*y.transmissionResolutionScale,o.w*y.transmissionResolutionScale);const a=y.getRenderTarget();y.setRenderTarget(s),y.getClearColor(A),D=y.getClearAlpha(),D<1&&y.setClearColor(16777215,.5),y.clear(),Y&&gt.render(i);const c=y.toneMapping;y.toneMapping=Gt;const l=n.viewport;if(void 0!==n.viewport&&(n.viewport=void 0),g.setupLightsView(n),!0===B&&ft.setGlobalState(y.clippingPlanes,n),Ft(t,i,n),et.updateMultisampleRenderTarget(s),et.updateRenderTargetMipmap(s),!1===K.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,c=s.material,l=s.group;if(c.side===ot&&o.layers.test(n.layers)){const e=c.side;c.side=st,c.needsUpdate=!0,Bt(o,i,n,a,c,l),c.side=e,c.needsUpdate=!0,t=!0}}!0===t&&(et.updateMultisampleRenderTarget(s),et.updateRenderTargetMipmap(s))}y.setRenderTarget(a),y.setClearColor(A,D),void 0!==l&&(n.viewport=l),y.toneMapping=c}function Ft(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,c=s.group;let l=s.material;!0===l.allowOverride&&null!==n&&(l=n),o.layers.test(i.layers)&&Bt(o,e,i,a,l,c)}}function Bt(t,e,i,n,r,s){t.onBeforeRender(y,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(y,e,i,n,t,s),!0===r.transparent&&r.side===ot&&!1===r.forceSinglePass?(r.side=st,r.needsUpdate=!0,y.renderBufferDirect(i,e,n,r,t,s),r.side=rt,r.needsUpdate=!0,y.renderBufferDirect(i,e,n,r,t,s),r.side=ot):y.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(y,e,i,n,r,s)}function zt(t,e,i){!0!==e.isScene&&(e=X);const n=tt.get(t),r=g.state.lights,s=g.state.shadowsArray,o=r.state.version,a=ht.getParameters(t,r.state,s,e,i),c=ht.getProgramCacheKey(a);let l=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?nt:it).get(t.envMap||n.environment),n.envMapRotation=null!==n.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===l&&(t.addEventListener("dispose",Dt),l=new Map,n.programs=l);let h=l.get(c);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return Ht(t,a),h}else a.uniforms=ht.getUniforms(t),t.onBeforeCompile(a,y),h=ht.acquireProgram(a,c),l.set(c,h),n.uniforms=a.uniforms;const u=n.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ft.uniform),Ht(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),n.currentProgram=h,n.uniformsList=null,h}function Vt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=um.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Ht(t,e){const i=tt.get(t);i.outputColorSpace=e.outputColorSpace,i.batching=e.batching,i.batchingColor=e.batchingColor,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.instancingMorph=e.instancingMorph,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Lt.setAnimationLoop((function(t){kt&&kt(t)})),"undefined"!=typeof self&&Lt.setContext(self),this.setAnimationLoop=function(t){kt=t,Et.setAnimationLoop(t),null===t?Lt.stop():Lt.start()},Et.addEventListener("sessionstart",It),Et.addEventListener("sessionend",Ot),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Et.enabled&&!0===Et.isPresenting&&(!0===Et.cameraAutoUpdate&&Et.updateCamera(e),e=Et.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,S),g=pt.get(t,_.length),g.init(e),_.push(g),H.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),F.setFromProjectionMatrix(H),z=this.localClippingEnabled,B=ft.init(this.clippingPlanes,z),m=dt.get(t,v.length),m.init(),v.push(m),!0===Et.enabled&&!0===Et.isPresenting){const t=y.xr.getDepthSensingMesh();null!==t&&Ut(t,e,-1/0,y.sortObjects)}Ut(t,e,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(O,L),Y=!1===Et.enabled||!1===Et.isPresenting||!1===Et.hasDepthSensing(),Y&&gt.addToRenderList(m,t),this.info.render.frame++,!0===B&&ft.beginShadows();const i=g.state.shadowsArray;mt.render(i,t,e),!0===B&&ft.endShadows(),!0===this.info.autoReset&&this.info.reset();const n=m.opaque,r=m.transmissive;if(g.setupLights(),e.isArrayCamera){const i=e.cameras;if(r.length>0)for(let e=0,s=i.length;e<s;e++)Wt(n,r,t,i[e]);Y&&gt.render(t);for(let e=0,n=i.length;e<n;e++){const n=i[e];Nt(m,t,n,n.viewport)}}else r.length>0&&Wt(n,r,t,e),Y&&gt.render(t),Nt(m,t,e);null!==S&&0===M&&(et.updateMultisampleRenderTarget(S),et.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(y,t,e),bt.resetDefaultState(),w=-1,T=null,_.pop(),_.length>0?(g=_[_.length-1],!0===B&&ft.setGlobalState(y.clippingPlanes,g.state.camera)):g=null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,i){const n=tt.get(t);n.__autoAllocateDepthBuffer=!1===t.resolveDepthBuffer,!1===n.__autoAllocateDepthBuffer&&(n.__useRenderToTexture=!1),tt.get(t.texture).__webglTexture=e,tt.get(t.depthTexture).__webglTexture=n.__autoAllocateDepthBuffer?void 0:i,n.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(t,e){const i=tt.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e};const jt=St.createFramebuffer();this.setRenderTarget=function(t,e=0,i=0){S=t,b=e,M=i;let n=!0,r=null,s=!1,o=!1;if(t){const a=tt.get(t);if(void 0!==a.__useDefaultFramebuffer)$.bindFramebuffer(St.FRAMEBUFFER,null),n=!1;else if(void 0===a.__webglFramebuffer)et.setupRenderTarget(t);else if(a.__hasExternalTextures)et.rebindTextures(t,tt.get(t.texture).__webglTexture,tt.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(a.__boundDepthTexture!==e){if(null!==e&&tt.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");et.setupDepthRenderbuffer(t)}}const c=t.texture;(c.isData3DTexture||c.isDataArrayTexture||c.isCompressedArrayTexture)&&(o=!0);const l=tt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(l[e])?l[e][i]:l[e],s=!0):r=t.samples>0&&!1===et.useMultisampledRTT(t)?tt.get(t).__webglMultisampledFramebuffer:Array.isArray(l)?l[i]:l,E.copy(t.viewport),C.copy(t.scissor),P=t.scissorTest}else E.copy(U).multiplyScalar(I).floor(),C.copy(N).multiplyScalar(I).floor(),P=W;if(0!==i&&(r=jt),$.bindFramebuffer(St.FRAMEBUFFER,r)&&n&&$.drawBuffers(t,r),$.viewport(E),$.scissor(C),$.setScissorTest(P),s){const n=tt.get(t.texture);St.framebufferTexture2D(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(o){const n=tt.get(t.texture),r=e;St.framebufferTextureLayer(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0,n.__webglTexture,i,r)}else if(null!==t&&0!==i){const e=tt.get(t.texture);St.framebufferTexture2D(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_2D,e.__webglTexture,i)}w=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=tt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){$.bindFramebuffer(St.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,c=o.type;if(!J.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!J.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&St.readPixels(e,i,n,r,xt.convert(a),xt.convert(c),s)}finally{const t=null!==S?tt.get(S).__webglFramebuffer:null;$.bindFramebuffer(St.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,i,n,r,s,o){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=tt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){if(e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r){$.bindFramebuffer(St.FRAMEBUFFER,a);const o=t.texture,c=o.format,l=o.type;if(!J.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!J.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=St.createBuffer();St.bindBuffer(St.PIXEL_PACK_BUFFER,h),St.bufferData(St.PIXEL_PACK_BUFFER,s.byteLength,St.STREAM_READ),St.readPixels(e,i,n,r,xt.convert(c),xt.convert(l),0);const u=null!==S?tt.get(S).__webglFramebuffer:null;$.bindFramebuffer(St.FRAMEBUFFER,u);const d=St.fenceSync(St.SYNC_GPU_COMMANDS_COMPLETE,0);return St.flush(),await function(t,e,i){return new Promise((function(i,n){setTimeout((function r(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(r,4);break;default:i()}}),4)}))}(St,d),St.bindBuffer(St.PIXEL_PACK_BUFFER,h),St.getBufferSubData(St.PIXEL_PACK_BUFFER,0,s),St.deleteBuffer(h),St.deleteSync(d),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t,e=null,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n),o=null!==e?e.x:0,a=null!==e?e.y:0;et.setTexture2D(t,0),St.copyTexSubImage2D(St.TEXTURE_2D,i,0,0,o,a,r,s),$.unbindTexture()};const Xt=St.createFramebuffer(),qt=St.createFramebuffer();this.copyTextureToTexture=function(t,e,i=null,n=null,r=0,s=null){let o,a,c,l,h,u,d,p,f;null===s&&(0!==r?(Qn("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),s=r,r=0):s=0);const m=t.isCompressedTexture?t.mipmaps[s]:t.image;if(null!==i)o=i.max.x-i.min.x,a=i.max.y-i.min.y,c=i.isBox3?i.max.z-i.min.z:1,l=i.min.x,h=i.min.y,u=i.isBox3?i.min.z:0;else{const e=Math.pow(2,-r);o=Math.floor(m.width*e),a=Math.floor(m.height*e),c=t.isDataArrayTexture?m.depth:t.isData3DTexture?Math.floor(m.depth*e):1,l=0,h=0,u=0}null!==n?(d=n.x,p=n.y,f=n.z):(d=0,p=0,f=0);const g=xt.convert(e.format),v=xt.convert(e.type);let _;e.isData3DTexture?(et.setTexture3D(e,0),_=St.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(et.setTexture2DArray(e,0),_=St.TEXTURE_2D_ARRAY):(et.setTexture2D(e,0),_=St.TEXTURE_2D),St.pixelStorei(St.UNPACK_FLIP_Y_WEBGL,e.flipY),St.pixelStorei(St.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),St.pixelStorei(St.UNPACK_ALIGNMENT,e.unpackAlignment);const y=St.getParameter(St.UNPACK_ROW_LENGTH),x=St.getParameter(St.UNPACK_IMAGE_HEIGHT),b=St.getParameter(St.UNPACK_SKIP_PIXELS),M=St.getParameter(St.UNPACK_SKIP_ROWS),S=St.getParameter(St.UNPACK_SKIP_IMAGES);St.pixelStorei(St.UNPACK_ROW_LENGTH,m.width),St.pixelStorei(St.UNPACK_IMAGE_HEIGHT,m.height),St.pixelStorei(St.UNPACK_SKIP_PIXELS,l),St.pixelStorei(St.UNPACK_SKIP_ROWS,h),St.pixelStorei(St.UNPACK_SKIP_IMAGES,u);const w=t.isDataArrayTexture||t.isData3DTexture,T=e.isDataArrayTexture||e.isData3DTexture;if(t.isDepthTexture){const i=tt.get(t),n=tt.get(e),m=tt.get(i.__renderTarget),g=tt.get(n.__renderTarget);$.bindFramebuffer(St.READ_FRAMEBUFFER,m.__webglFramebuffer),$.bindFramebuffer(St.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let i=0;i<c;i++)w&&(St.framebufferTextureLayer(St.READ_FRAMEBUFFER,St.COLOR_ATTACHMENT0,tt.get(t).__webglTexture,r,u+i),St.framebufferTextureLayer(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0,tt.get(e).__webglTexture,s,f+i)),St.blitFramebuffer(l,h,o,a,d,p,o,a,St.DEPTH_BUFFER_BIT,St.NEAREST);$.bindFramebuffer(St.READ_FRAMEBUFFER,null),$.bindFramebuffer(St.DRAW_FRAMEBUFFER,null)}else if(0!==r||t.isRenderTargetTexture||tt.has(t)){const i=tt.get(t),n=tt.get(e);$.bindFramebuffer(St.READ_FRAMEBUFFER,Xt),$.bindFramebuffer(St.DRAW_FRAMEBUFFER,qt);for(let t=0;t<c;t++)w?St.framebufferTextureLayer(St.READ_FRAMEBUFFER,St.COLOR_ATTACHMENT0,i.__webglTexture,r,u+t):St.framebufferTexture2D(St.READ_FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_2D,i.__webglTexture,r),T?St.framebufferTextureLayer(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0,n.__webglTexture,s,f+t):St.framebufferTexture2D(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_2D,n.__webglTexture,s),0!==r?St.blitFramebuffer(l,h,o,a,d,p,o,a,St.COLOR_BUFFER_BIT,St.NEAREST):T?St.copyTexSubImage3D(_,s,d,p,f+t,l,h,o,a):St.copyTexSubImage2D(_,s,d,p,l,h,o,a);$.bindFramebuffer(St.READ_FRAMEBUFFER,null),$.bindFramebuffer(St.DRAW_FRAMEBUFFER,null)}else T?t.isDataTexture||t.isData3DTexture?St.texSubImage3D(_,s,d,p,f,o,a,c,g,v,m.data):e.isCompressedArrayTexture?St.compressedTexSubImage3D(_,s,d,p,f,o,a,c,g,m.data):St.texSubImage3D(_,s,d,p,f,o,a,c,g,v,m):t.isDataTexture?St.texSubImage2D(St.TEXTURE_2D,s,d,p,o,a,g,v,m.data):t.isCompressedTexture?St.compressedTexSubImage2D(St.TEXTURE_2D,s,d,p,m.width,m.height,g,m.data):St.texSubImage2D(St.TEXTURE_2D,s,d,p,o,a,g,v,m);St.pixelStorei(St.UNPACK_ROW_LENGTH,y),St.pixelStorei(St.UNPACK_IMAGE_HEIGHT,x),St.pixelStorei(St.UNPACK_SKIP_PIXELS,b),St.pixelStorei(St.UNPACK_SKIP_ROWS,M),St.pixelStorei(St.UNPACK_SKIP_IMAGES,S),0===s&&e.generateMipmaps&&St.generateMipmap(_),$.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i=null,n=null,r=0){return Qn('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(t,e,i,n,r)},this.initRenderTarget=function(t){void 0===tt.get(t).__webglFramebuffer&&et.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?et.setTextureCube(t,0):t.isData3DTexture?et.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?et.setTexture2DArray(t,0):et.setTexture2D(t,0),$.unbindTexture()},this.resetState=function(){b=0,M=0,S=null,$.reset(),bt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Cn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=nr._getDrawingBufferColorSpace(t),e.unpackColorSpace=nr._getUnpackColorSpace()}}class sg{constructor(t){this.occWorkerManager=t}makeCompound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.compound.makeCompound",t)}getShapesOfCompound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.compound.getShapesOfCompound",t)}}class og{constructor(t){this.occWorkerManager=t}line(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.line",t)}arcThroughThreePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcThroughThreePoints",t)}arcThroughTwoPointsAndTangent(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcThroughTwoPointsAndTangent",t)}arcFromCircleAndTwoPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCircleAndTwoPoints",t)}arcFromCircleAndTwoAngles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCircleAndTwoAngles",t)}arcFromCirclePointAndAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCirclePointAndAngle",t)}createCircleEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.createCircleEdge",t)}createEllipseEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.createEllipseEdge",t)}removeInternalEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.removeInternalEdges",t)}makeEdgeFromGeom2dCurveAndSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.makeEdgeFromGeom2dCurveAndSurface",t)}getEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdge",t)}getEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdges",t)}getEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesAlongWire",t)}getCircularEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgesAlongWire",t)}getLinearEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getLinearEdgesAlongWire",t)}getCornerPointsOfEdgesForShape(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCornerPointsOfEdgesForShape",t)}getEdgeLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeLength",t)}getEdgeLengthsOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeLengthsOfShape",t)}getEdgesLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesLengths",t)}getEdgeCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeCenterOfMass",t)}getEdgesCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesCentersOfMass",t)}getCircularEdgeCenterPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgeCenterPoint",t)}getCircularEdgeRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgeRadius",t)}getCircularEdgePlaneDirection(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgePlaneDirection",t)}pointOnEdgeAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointOnEdgeAtParam",t)}pointsOnEdgesAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointsOnEdgesAtParam",t)}edgesToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.edgesToPoints",t)}reversedEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.reversedEdge",t)}tangentOnEdgeAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentOnEdgeAtParam",t)}tangentsOnEdgesAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentsOnEdgesAtParam",t)}pointOnEdgeAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointOnEdgeAtLength",t)}pointsOnEdgesAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointsOnEdgesAtLength",t)}tangentOnEdgeAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentOnEdgeAtLength",t)}tangentsOnEdgesAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentsOnEdgesAtLength",t)}startPointOnEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.startPointOnEdge",t)}startPointsOnEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.startPointsOnEdges",t)}endPointOnEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.endPointOnEdge",t)}endPointsOnEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.endPointsOnEdges",t)}divideEdgeByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgeByParamsToPoints",t)}divideEdgesByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgesByParamsToPoints",t)}divideEdgeByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgeByEqualDistanceToPoints",t)}divideEdgesByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgesByEqualDistanceToPoints",t)}constraintTanLinesFromTwoPtsToCircle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesFromTwoPtsToCircle",t)}constraintTanLinesFromPtToCircle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesFromPtToCircle",t)}constraintTanLinesOnTwoCircles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesOnTwoCircles",t)}constraintTanCirclesOnTwoCircles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanCirclesOnTwoCircles",t)}constraintTanCirclesOnCircleAndPnt(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanCirclesOnCircleAndPnt",t)}isEdgeLinear(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.isEdgeLinear",t)}isEdgeCircular(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.isEdgeCircular",t)}}class ag{constructor(t){this.occWorkerManager=t}createFacesFromWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFacesFromWiresOnFace",t)}createFaceFromWireOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWireOnFace",t)}createFaceFromWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWire",t)}createFaceFromWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWires",t)}createFaceFromWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWiresOnFace",t)}createFacesFromWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFacesFromWires",t)}createFaceFromMultipleCircleTanWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromMultipleCircleTanWires",t)}createFaceFromMultipleCircleTanWireCollections(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromMultipleCircleTanWireCollections",t)}faceFromSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.faceFromSurface",t)}faceFromSurfaceAndWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.faceFromSurfaceAndWire",t)}createPolygonFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createPolygonFace",t)}createCircleFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createCircleFace",t)}hexagonsInGrid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.hexagonsInGrid",t)}createEllipseFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createEllipseFace",t)}createSquareFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createSquareFace",t)}createRectangleFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createRectangleFace",t)}getFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFace",t)}getFaces(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaces",t)}reversedFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.reversedFace",t)}subdivideToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPoints",t)}subdivideToWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToWires",t)}subdivideToRectangleWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToRectangleWires",t)}subdivideToRectangleHoles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToRectangleHoles",t)}subdivideToHexagonWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToHexagonWires",t)}subdivideToHexagonHoles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToHexagonHoles",t)}subdivideToPointsControlled(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPointsControlled",t)}subdivideToNormals(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToNormals",t)}subdivideToUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToUV",t)}pointOnUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.pointOnUV",t)}normalOnUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.normalOnUV",t)}pointsOnUVs(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.pointsOnUVs",t)}normalsOnUVs(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.normalsOnUVs",t)}subdivideToPointsOnParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPointsOnParam",t)}wireAlongParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.wireAlongParam",t)}wiresAlongParams(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.wiresAlongParams",t)}getUMinBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getUMinBound",t)}getUMaxBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getUMaxBound",t)}getVMinBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getVMinBound",t)}getVMaxBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getVMaxBound",t)}getFaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaceArea",t)}getFacesAreas(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFacesAreas",t)}getFaceCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaceCenterOfMass",t)}getFacesCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFacesCentersOfMass",t)}filterFacePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.filterFacePoints",t)}filterFacesPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.filterFacesPoints",t)}}class cg{constructor(t){this.occWorkerManager=t}fromClosedShell(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.fromClosedShell",t)}createBox(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createBox",t)}createCube(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCube",t)}createBoxFromCorner(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createBoxFromCorner",t)}createCylinder(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCylinder",t)}createCylindersOnLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCylindersOnLines",t)}createSphere(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createSphere",t)}createCone(t){return t.angle=t.angle*(Math.PI/180),this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCone",t)}getSolidSurfaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidSurfaceArea",t)}getSolidVolume(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidVolume",t)}getSolidsVolumes(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidsVolumes",t)}getSolidCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidCenterOfMass",t)}getSolidsCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidsCentersOfMass",t)}getSolids(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolids",t)}filterSolidPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.filterSolidPoints",t)}}class lg{static parse(t,e){var i;const n=[t],r=new Set;for(;n.length>0;){const t=n.pop();if("object"==typeof t&&null!==t&&!r.has(t))if(r.add(t),Array.isArray(t))for(let e=0;e<t.length;e++)n.push(t[e]);else{if(Object.keys(t).includes("shapes")){const n=t.shapes;if("object"==typeof n&&null!==n)for(const r in n)t.shapes[r]&&(t.shapes[r]=null===(i=e.find((e=>e.id===t.shapes[r])))||void 0===i?void 0:i.shape)}for(const e in t)n.push(t[e])}}return t}}class hg{constructor(t){this.occWorkerManager=t}createPolygonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolygonWire",t)}createPolygons(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolygons",t)}createLineWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLineWire",t)}createLineWireWithExtensions(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLineWireWithExtensions",t)}createLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLines",t)}splitOnPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.splitOnPoints",t)}wiresToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.wiresToPoints",t)}createPolylineWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolylineWire",t)}createZigZagBetweenTwoWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createZigZagBetweenTwoWires",t)}createWireFromTwoCirclesTan(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createWireFromTwoCirclesTan",t)}createPolylines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolylines",t)}createBezier(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezier",t)}createBezierWeights(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezierWeights",t)}createBezierWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezierWires",t)}interpolatePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.interpolatePoints",t)}interpolateWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.interpolateWires",t)}createBSpline(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBSpline",t)}createBSplines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBSplines",t)}combineEdgesAndWiresIntoAWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.combineEdgesAndWiresIntoAWire",t)}createWireFromEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createWireFromEdge",t)}addEdgesAndWiresToWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.addEdgesAndWiresToWire",t)}divideWireByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWireByParamsToPoints",t)}divideWiresByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWiresByParamsToPoints",t)}divideWireByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWireByEqualDistanceToPoints",t)}divideWiresByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWiresByEqualDistanceToPoints",t)}pointOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointOnWireAtParam",t)}pointOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointOnWireAtLength",t)}pointsOnWireAtLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtLengths",t)}pointsOnWireAtEqualLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtEqualLength",t)}pointsOnWireAtPatternOfLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtPatternOfLengths",t)}tangentOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.tangentOnWireAtParam",t)}tangentOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.tangentOnWireAtLength",t)}derivativesOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.derivativesOnWireAtLength",t)}derivativesOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.derivativesOnWireAtParam",t)}startPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.startPointOnWire",t)}midPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.midPointOnWire",t)}endPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.endPointOnWire",t)}createCircleWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createCircleWire",t)}hexagonsInGrid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.hexagonsInGrid",t)}createSquareWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createSquareWire",t)}createStarWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createStarWire",t)}createChristmasTreeWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createChristmasTreeWire",t)}createNGonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createNGonWire",t)}createParallelogramWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createParallelogramWire",t)}createHeartWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createHeartWire",t)}createRectangleWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createRectangleWire",t)}createLPolygonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLPolygonWire",t)}createEllipseWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createEllipseWire",t)}textWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.textWires",t)}textWiresWithData(t){return e=this,i=void 0,r=function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.textWiresWithData",t),i=lg.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})},new((n=void 0)||(n=Promise))((function(t,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}c((r=r.apply(e,i||[])).next())}));var e,i,n,r}getWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWire",t)}getWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWires",t)}getWireCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWireCenterOfMass",t)}getWiresCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWiresCentersOfMass",t)}reversedWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.reversedWire",t)}reversedWireFromReversedEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.reversedWireFromReversedEdges",t)}isWireClosed(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.isWireClosed",t)}getWireLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWireLength",t)}getWiresLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWiresLengths",t)}placeWireOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.placeWireOnFace",t)}placeWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.placeWiresOnFace",t)}closeOpenWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.closeOpenWire",t)}project(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.project",t)}projectWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.projectWires",t)}}class ug{constructor(t){this.occWorkerManager=t}sewFaces(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shell.sewFaces",t)}getShellSurfaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shell.getShellSurfaceArea",t)}}class dg{constructor(t){this.occWorkerManager=t}purgeInternalEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.purgeInternalEdges",t)}unifySameDomain(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.unifySameDomain",t)}isClosed(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isClosed",t)}isConvex(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isConvex",t)}isChecked(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isChecked",t)}isFree(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isFree",t)}isInfinite(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isInfinite",t)}isModified(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isModified",t)}isLocked(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isLocked",t)}isNull(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isNull",t)}isEqual(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isEqual",t)}isNotEqual(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isNotEqual",t)}isPartner(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isPartner",t)}isSame(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isSame",t)}getOrientation(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.getOrientation",t)}getShapeType(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.getShapeType",t)}}class pg{constructor(t){this.occWorkerManager=t}vertexFromXYZ(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexFromXYZ",t)}vertexFromPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexFromPoint",t)}verticesFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesFromPoints",t)}verticesCompoundFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesCompoundFromPoints",t)}getVertices(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.getVertices",t)}getVerticesAsPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.getVerticesAsPoints",t)}verticesToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesToPoints",t)}vertexToPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexToPoint",t)}projectPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.projectPoints",t)}}class fg{constructor(t){this.vertex=new pg(t),this.edge=new og(t),this.wire=new hg(t),this.face=new ag(t),this.shell=new ug(t),this.solid=new cg(t),this.compound=new sg(t),this.shape=new dg(t)}}var mg=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class gg{constructor(t){this.occWorkerManager=t}saveShapeSTEP(t){return mg(this,void 0,void 0,(function*(){this.saveSTEP(t)}))}saveShapeSTEPAndReturn(t){return mg(this,void 0,void 0,(function*(){return this.saveSTEP(t)}))}saveShapeStl(t){return mg(this,void 0,void 0,(function*(){this.saveStl(t)}))}saveShapeStlAndReturn(t){return mg(this,void 0,void 0,(function*(){return this.saveStl(t)}))}saveSTEP(t){return this.occWorkerManager.genericCallToWorkerPromise("io.saveShapeSTEP",t).then((e=>{if(t.tryDownload&&document){const i=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(i);let r=t.fileName?t.fileName:"bitbybit-dev.step";r.toLowerCase().includes(".step")||(r+=".step");const s=document.createElement("a");s.href=n,s.target="_self",s.download=r,s.click(),s.remove()}return e}))}saveStl(t){return this.occWorkerManager.genericCallToWorkerPromise("io.saveShapeStl",t).then((e=>{if(t.tryDownload&&document){const i=new Blob([e],{type:"application/stl"}),n=URL.createObjectURL(i),r=t.fileName?t.fileName:"bitbybit-dev.stl",s=document.createElement("a");s.href=n,s.target="_self",s.download=r,s.click(),s.remove()}return e}))}}class vg{constructor(t){this.occWorkerManager=t}transform(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.transform",t)}rotate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotate",t)}rotateAroundCenter(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateAroundCenter",t)}align(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.align",t)}alignNormAndAxis(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignNormAndAxis",t)}alignAndTranslate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignAndTranslate",t)}translate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.translate",t)}scale(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale",t)}scale3d(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale3d",t)}mirror(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirror",t)}mirrorAlongNormal(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorAlongNormal",t)}transformShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.transformShapes",t)}rotateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateShapes",t)}rotateAroundCenterShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateAroundCenterShapes",t)}alignShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignShapes",t)}alignAndTranslateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignAndTranslateShapes",t)}translateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.translateShapes",t)}scaleShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scaleShapes",t)}scale3dShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale3dShapes",t)}mirrorShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorShapes",t)}mirrorAlongNormalShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorAlongNormalShapes",t)}}class _g{constructor(t){this.occWorkerManager=t}loft(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.loft",t)}loftAdvanced(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.loftAdvanced",t)}closestPointsBetweenTwoShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsBetweenTwoShapes",t)}closestPointsOnShapeFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsOnShapeFromPoints",t)}closestPointsOnShapesFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsOnShapesFromPoints",t)}distancesToShapeFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.distancesToShapeFromPoints",t)}boundingBoxOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxOfShape",t)}boundingBoxMinOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxMinOfShape",t)}boundingBoxMaxOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxMaxOfShape",t)}boundingBoxCenterOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxCenterOfShape",t)}boundingBoxSizeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxSizeOfShape",t)}boundingBoxShapeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxShapeOfShape",t)}boundingSphereOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereOfShape",t)}boundingSphereCenterOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereCenterOfShape",t)}boundingSphereRadiusOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereRadiusOfShape",t)}boundingSphereShapeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereShapeOfShape",t)}extrude(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.extrude",t)}extrudeShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.extrudeShapes",t)}splitShapeWithShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.splitShapeWithShapes",t)}revolve(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.revolve",t)}rotatedExtrude(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.rotatedExtrude",t)}pipe(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipe",t)}pipePolylineWireNGon(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipePolylineWireNGon",t)}pipeWiresCylindrical(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipeWiresCylindrical",t)}pipeWireCylindrical(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipeWireCylindrical",t)}offset(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offset",t)}offsetAdv(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offsetAdv",t)}makeThickSolidSimple(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.makeThickSolidSimple",t)}makeThickSolidByJoin(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.makeThickSolidByJoin",t)}slice(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.slice",t)}sliceInStepPattern(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.sliceInStepPattern",t)}offset3DWire(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offset3DWire",t)}}class yg{constructor(t){this.occWorkerManager=t}union(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.union",t)}difference(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.difference",t)}intersection(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.intersection",t)}meshMeshIntersectionWires(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionWires",t)}meshMeshIntersectionPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionPoints",t)}meshMeshIntersectionOfShapesWires(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionOfShapesWires",t)}meshMeshIntersectionOfShapesPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionOfShapesPoints",t)}}class xg{constructor(t){this.occWorkerManager=t}geom2dEllipse(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dEllipse",t)}geom2dTrimmedCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dTrimmedCurve",t)}geom2dSegment(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dSegment",t)}get2dPointFrom2dCurveOnParam(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.get2dPointFrom2dCurveOnParam",t)}geomCircleCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geomCircleCurve",t)}geomEllipseCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geomEllipseCurve",t)}}class bg{constructor(t){this.occWorkerManager=t}cylindricalSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.surfaces.cylindricalSurface",t)}surfaceFromFace(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.surfaces.surfaceFromFace",t)}}class Mg{constructor(t){this.curves=new xg(t),this.surfaces=new bg(t)}}class Sg{constructor(t){this.occWorkerManager=t}filletEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdges",t)}filletEdgesList(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesList",t)}filletEdgesListOneRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesListOneRadius",t)}filletEdgeVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgeVariableRadius",t)}filletEdgesSameVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesSameVariableRadius",t)}filletEdgesVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesVariableRadius",t)}fillet3DWire(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet3DWire",t)}fillet3DWires(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet3DWires",t)}chamferEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdges",t)}chamferEdgesList(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesList",t)}chamferEdgeTwoDistances(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgeTwoDistances",t)}chamferEdgesTwoDistances(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesTwoDistances",t)}chamferEdgesTwoDistancesLists(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesTwoDistancesLists",t)}chamferEdgeDistAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgeDistAngle",t)}chamferEdgesDistAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesDistAngle",t)}chamferEdgesDistsAngles(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesDistsAngles",t)}fillet2d(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet2d",t)}fillet2dShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet2dShapes",t)}filletTwoEdgesInPlaneIntoAWire(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletTwoEdgesInPlaneIntoAWire",t)}}class wg{constructor(t){this.occWorkerManager=t}basicShapeRepair(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.basicShapeRepair",t)}fixSmallEdgeOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.fixSmallEdgeOnWire",t)}fixEdgeOrientationsAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.fixEdgeOrientationsAlongWire",t)}}class Tg{constructor(t){this.occWorkerManager=t}simpleLinearLengthDimension(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.simpleLinearLengthDimension",t)}simpleAngularDimension(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.simpleAngularDimension",t)}pinWithLabel(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.pinWithLabel",t)}}var Eg=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Cg{constructor(t){this.occWorkerManager=t,this.shapes=new fg(t),this.geom=new Mg(t),this.transforms=new vg(t),this.operations=new _g(t),this.booleans=new yg(t),this.fillets=new Sg(t),this.shapeFix=new wg(t),this.dimensions=new Tg(t),this.io=new gg(t)}shapeFacesToPolygonPoints(t){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapeFacesToPolygonPoints",t)}))}shapeToMesh(t){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapeToMesh",t)}))}shapesToMeshes(t){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapesToMeshes",t)}))}deleteShape(t){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("deleteShape",t)}))}deleteShapes(t){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("deleteShapes",t)}))}cleanAllCache(){return Eg(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("cleanAllCache",{})}))}}var Pg=function(t,e){return Pg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},Pg(t,e)};function Ag(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}Pg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function Dg(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rg(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}function kg(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))}function Ig(t){return"function"==typeof t}function Og(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Lg=Og((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function Ug(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var Ng=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,i,n,r;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=Dg(s),a=o.next();!a.done;a=o.next())a.value.remove(this)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(Ig(c))try{c()}catch(t){r=t instanceof Lg?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var h=Dg(l),u=h.next();!u.done;u=h.next()){var d=u.value;try{Bg(d)}catch(t){r=null!=r?r:[],t instanceof Lg?r=kg(kg([],Rg(r)),Rg(t.errors)):r.push(t)}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}if(r)throw new Lg(r)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)Bg(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Ug(e,t)},t.prototype.remove=function(e){var i=this._finalizers;i&&Ug(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),Wg=Ng.EMPTY;function Fg(t){return t instanceof Ng||t&&"closed"in t&&Ig(t.remove)&&Ig(t.add)&&Ig(t.unsubscribe)}function Bg(t){Ig(t)?t():t.unsubscribe()}var zg=null,Vg=null,Hg=void 0,Gg=!1,jg=!1,Xg={setTimeout:function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=Xg.delegate;return(null==r?void 0:r.setTimeout)?r.setTimeout.apply(r,kg([t,e],Rg(i))):setTimeout.apply(void 0,kg([t,e],Rg(i)))},clearTimeout:function(t){var e=Xg.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function qg(){}var Yg=Zg("C",void 0,void 0);function Zg(t,e,i){return{kind:t,value:e,error:i}}var Kg=null;function Jg(t){if(Gg){var e=!Kg;if(e&&(Kg={errorThrown:!1,error:null}),t(),e){var i=Kg,n=i.errorThrown,r=i.error;if(Kg=null,n)throw r}}else t()}var $g=function(t){function e(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,Fg(e)&&e.add(i)):i.destination=sv,i}return Ag(e,t),e.create=function(t,e,i){return new iv(t,e,i)},e.prototype.next=function(t){this.isStopped?rv(function(t){return Zg("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?rv(Zg("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?rv(Yg,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ng),Qg=Function.prototype.bind;function tv(t,e){return Qg.call(t,e)}var ev=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){nv(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){nv(t)}else nv(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){nv(t)}},t}(),iv=function(t){function e(e,i,n){var r,s,o=t.call(this)||this;return Ig(e)||!e?r={next:null!=e?e:void 0,error:null!=i?i:void 0,complete:null!=n?n:void 0}:o&&jg?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},r={next:e.next&&tv(e.next,s),error:e.error&&tv(e.error,s),complete:e.complete&&tv(e.complete,s)}):r=e,o.destination=new ev(r),o}return Ag(e,t),e}($g);function nv(t){var e;Gg?(e=t,Gg&&Kg&&(Kg.errorThrown=!0,Kg.error=e)):function(t){Xg.setTimeout((function(){if(!zg)throw t;zg(t)}))}(t)}function rv(t,e){var i=Vg;i&&Xg.setTimeout((function(){return i(t,e)}))}var sv={closed:!0,next:qg,error:function(t){throw t},complete:qg},ov="function"==typeof Symbol&&Symbol.observable||"@@observable";function av(t){return t}var cv=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n,r=this,s=(n=t)&&n instanceof $g||function(t){return t&&Ig(t.next)&&Ig(t.error)&&Ig(t.complete)}(n)&&Fg(n)?t:new iv(t,e,i);return Jg((function(){var t=r,e=t.operator,i=t.source;s.add(e?e.call(s,i):i?r._subscribe(s):r._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=lv(e))((function(e,n){var r=new iv({next:function(e){try{t(e)}catch(t){n(t),r.unsubscribe()}},error:n,complete:e});i.subscribe(r)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[ov]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(i=t).length?av:1===i.length?i[0]:function(t){return i.reduce((function(t,e){return e(t)}),t)})(this);var i},t.prototype.toPromise=function(t){var e=this;return new(t=lv(t))((function(t,i){var n;e.subscribe((function(t){return n=t}),(function(t){return i(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function lv(t){var e;return null!==(e=null!=t?t:Hg)&&void 0!==e?e:Promise}var hv,uv,dv,pv,fv,mv,gv,vv,_v,yv,xv,bv,Mv,Sv,wv,Tv,Ev,Cv,Pv,Av,Dv,Rv=Og((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),kv=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return Ag(e,t),e.prototype.lift=function(t){var e=new Iv(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new Rv},e.prototype.next=function(t){var e=this;Jg((function(){var i,n;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var r=Dg(e.currentObservers),s=r.next();!s.done;s=r.next())s.value.next(t)}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}}}))},e.prototype.error=function(t){var e=this;Jg((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}}))},e.prototype.complete=function(){var t=this;Jg((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,i=this,n=i.hasError,r=i.isStopped,s=i.observers;return n||r?Wg:(this.currentObservers=null,s.push(t),new Ng((function(){e.currentObservers=null,Ug(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,n=e.thrownError,r=e.isStopped;i?t.error(n):r&&t.complete()},e.prototype.asObservable=function(){var t=new cv;return t.source=this,t},e.create=function(t,e){return new Iv(t,e)},e}(cv),Iv=function(t){function e(e,i){var n=t.call(this)||this;return n.destination=e,n.source=i,n}return Ag(e,t),e.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},e.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Wg},e}(kv);!function(t){t.loading="loading",t.loaded="loaded",t.initialised="initialised",t.computing="computing"}(hv||(hv={}));class Ov{constructor(){this.occWorkerState$=new kv,this.promisesMade=[]}occWorkerAlreadyInitialised(){return!!this.occWorker}setOccWorker(t){this.occWorker=t,this.occWorker.onmessage=({data:t})=>{if("occ-initialised"===t)this.occWorkerState$.next({state:hv.initialised});else if("busy"===t)this.occWorkerState$.next({state:hv.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&void 0!==t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.occWorkerState$.next({state:hv.loaded}):this.occWorkerState$.next({state:hv.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,n={uid:i},r=new Promise(((t,e)=>{n.resolve=t,n.reject=e}));return n.promise=r,this.promisesMade.push(n),this.occWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),r}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}!function(t){let e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_;!function(t){t.arc="arc",t.intersection="intersection",t.tangent="tangent"}(e=t.joinTypeEnum||(t.joinTypeEnum={})),function(t){t.skin="skin",t.pipe="pipe",t.rectoVerso="rectoVerso"}(i=t.bRepOffsetModeEnum||(t.bRepOffsetModeEnum={})),function(t){t.approxChordLength="approxChordLength",t.approxCentripetal="approxCentripetal",t.approxIsoParametric="approxIsoParametric"}(n=t.approxParametrizationTypeEnum||(t.approxParametrizationTypeEnum={})),function(t){t.outside="outside",t.inside="inside",t.middle="middle"}(r=t.directionEnum||(t.directionEnum={})),function(t){t.iges="iges",t.step="step"}(s=t.fileTypeEnum||(t.fileTypeEnum={})),function(t){t.forward="forward",t.reversed="reversed",t.internal="internal",t.external="external"}(o=t.topAbsOrientationEnum||(t.topAbsOrientationEnum={})),function(t){t.in="in",t.out="out",t.on="on",t.unknown="unknown"}(a=t.topAbsStateEnum||(t.topAbsStateEnum={})),function(t){t.unknown="unknown",t.vertex="vertex",t.edge="edge",t.wire="wire",t.face="face",t.shell="shell",t.solid="solid",t.compSolid="compSolid",t.compound="compound",t.shape="shape"}(c=t.shapeTypeEnum||(t.shapeTypeEnum={})),function(t){t.unqualified="unqualified",t.enclosing="enclosing",t.enclosed="enclosed",t.outside="outside",t.noqualifier="noqualifier"}(l=t.gccEntPositionEnum||(t.gccEntPositionEnum={})),function(t){t.keepSide1="keepSide1",t.keepSide2="keepSide2",t.all="all"}(h=t.positionResultEnum||(t.positionResultEnum={})),function(t){t.none="none",t.keepSide1="keepSide1",t.keepSide2="keepSide2"}(u=t.circleInclusionEnum||(t.circleInclusionEnum={})),function(t){t.none="none",t.outside="outside",t.inside="inside",t.outsideInside="outsideInside",t.insideOutside="insideOutside"}(d=t.twoCircleInclusionEnum||(t.twoCircleInclusionEnum={})),function(t){t.outside="outside",t.inside="inside",t.outsideInside="outsideInside",t.insideOutside="insideOutside"}(p=t.fourSidesStrictEnum||(t.fourSidesStrictEnum={})),function(t){t.outside="outside",t.inside="inside"}(f=t.twoSidesStrictEnum||(t.twoSidesStrictEnum={})),function(t){t.allWithAll="allWithAll",t.inOrder="inOrder",t.inOrderClosed="inOrderClosed"}(m=t.combinationCirclesForFaceEnum||(t.combinationCirclesForFaceEnum={})),function(t){t[t.curve=0]="curve",t[t.edge=1]="edge",t[t.wire=2]="wire",t[t.face=3]="face"}(g=t.typeSpecificityEnum||(t.typeSpecificityEnum={})),function(t){t.all="all",t.closest="closest",t.furthest="furthest",t.closestAndFurthest="closestAndFurthest"}(v=t.pointProjectionTypeEnum||(t.pointProjectionTypeEnum={})),function(t){t.isCorrectedFrenet="isCorrectedFrenet",t.isFixed="isFixed",t.isFrenet="isFrenet",t.isConstantNormal="isConstantNormal",t.isDarboux="isDarboux",t.isGuideAC="isGuideAC",t.isGuidePlan="isGuidePlan",t.isGuideACWithContact="isGuideACWithContact",t.isGuidePlanWithContact="isGuidePlanWithContact",t.isDiscreteTrihedron="isDiscreteTrihedron"}(_=t.geomFillTrihedronEnum||(t.geomFillTrihedronEnum={})),t.DecomposedMeshDto=class{constructor(t,e){void 0!==t&&(this.faceList=t),void 0!==e&&(this.edgeList=e)}},t.DecomposedFaceDto=class{},t.DecomposedEdgeDto=class{},t.ShapesDto=class{constructor(t){void 0!==t&&(this.shapes=t)}},t.PointDto=class{constructor(t){this.point=[0,0,0],void 0!==t&&(this.point=t)}},t.XYZDto=class{constructor(t,e,i){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},t.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.ConstraintTanLinesFromPtToCircleDto=class{constructor(t,e,i,n,r){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainder=u.none,void 0!==t&&(this.circle=t),void 0!==e&&(this.point=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.positionResult=n),void 0!==r&&(this.circleRemainder=r)}},t.ConstraintTanLinesFromTwoPtsToCircleDto=class{constructor(t,e,i,n,r,s){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainder=u.none,void 0!==t&&(this.circle=t),void 0!==e&&(this.point1=e),void 0!==i&&(this.point1=i),void 0!==n&&(this.tolerance=n),void 0!==r&&(this.positionResult=r),void 0!==s&&(this.circleRemainder=s)}},t.ConstraintTanLinesOnTwoCirclesDto=class{constructor(t,e,i,n,r){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainders=d.none,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.positionResult=n),void 0!==r&&(this.circleRemainders=r)}},t.ConstraintTanCirclesOnTwoCirclesDto=class{constructor(t,e,i,n){this.tolerance=1e-7,this.radius=.3,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.radius=n)}},t.ConstraintTanCirclesOnCircleAndPntDto=class{constructor(t,e,i,n){this.tolerance=1e-7,this.radius=.3,void 0!==t&&(this.circle=t),void 0!==e&&(this.point=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.radius=n)}},t.CurveAndSurfaceDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.surface=e)}},t.FilletTwoEdgesInPlaneDto=class{constructor(t,e,i,n,r,s){this.planeOrigin=[0,0,0],this.planeDirection=[0,1,0],this.radius=.3,this.solution=-1,void 0!==t&&(this.edge1=t),void 0!==e&&(this.edge2=e),void 0!==i&&(this.planeOrigin=i),void 0!==n&&(this.planeDirection=n),void 0!==r&&(this.radius=r),void 0!==s&&(this.solution=s)}},t.ClosestPointsOnShapeFromPointsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e)}},t.BoundingBoxDto=class{constructor(t){void 0!==t&&(this.bbox=t)}},t.BoundingBoxPropsDto=class{constructor(t,e,i,n){this.min=[0,0,0],this.max=[0,0,0],this.center=[0,0,0],this.size=[0,0,0],void 0!==t&&(this.min=t),void 0!==e&&(this.max=e),void 0!==i&&(this.center=i),void 0!==n&&(this.size=n)}},t.BoundingSpherePropsDto=class{constructor(t,e){this.center=[0,0,0],this.radius=0,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e)}},t.SplitWireOnPointsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e)}},t.ClosestPointsOnShapesFromPointsDto=class{constructor(t,e){void 0!==t&&(this.shapes=t),void 0!==e&&(this.points=e)}},t.ClosestPointsBetweenTwoShapesDto=class{constructor(t,e){void 0!==t&&(this.shape1=t),void 0!==e&&(this.shape2=e)}},t.FaceFromSurfaceAndWireDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.surface=t),void 0!==e&&(this.wire=e),void 0!==i&&(this.inside=i)}},t.WireOnFaceDto=class{constructor(t,e){void 0!==t&&(this.wire=t),void 0!==e&&(this.face=e)}},t.DrawShapeDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.edgeWidth=2,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.vertexColour="#ffaaff",this.vertexSize=.03,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",void 0!==t&&(this.shape=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.edgeOpacity=i),void 0!==n&&(this.edgeColour=n),void 0!==r&&(this.faceMaterial=r),void 0!==s&&(this.faceColour=s),void 0!==h&&(this.vertexColour=h),void 0!==u&&(this.vertexSize=u),void 0!==o&&(this.edgeWidth=o),void 0!==a&&(this.drawEdges=a),void 0!==c&&(this.drawFaces=c),void 0!==l&&(this.drawVertices=l),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdgeIndexes=p),void 0!==f&&(this.edgeIndexHeight=f),void 0!==m&&(this.edgeIndexColour=m),void 0!==g&&(this.drawFaceIndexes=g),void 0!==v&&(this.faceIndexHeight=v),void 0!==_&&(this.faceIndexColour=_)}},t.DrawShapesDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.edgeWidth=2,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.vertexColour="#ffaaff",this.vertexSize=.03,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",void 0!==t&&(this.shapes=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.edgeOpacity=i),void 0!==n&&(this.edgeColour=n),void 0!==r&&(this.faceMaterial=r),void 0!==s&&(this.faceColour=s),void 0!==h&&(this.vertexColour=h),void 0!==u&&(this.vertexSize=u),void 0!==o&&(this.edgeWidth=o),void 0!==a&&(this.drawEdges=a),void 0!==c&&(this.drawFaces=c),void 0!==l&&(this.drawVertices=l),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdgeIndexes=p),void 0!==f&&(this.edgeIndexHeight=f),void 0!==m&&(this.edgeIndexColour=m),void 0!==g&&(this.drawFaceIndexes=g),void 0!==v&&(this.faceIndexHeight=v),void 0!==_&&(this.faceIndexColour=_)}},t.FaceSubdivisionDto=class{constructor(t,e,i,n,r,s,o,a,c){this.nrDivisionsU=10,this.nrDivisionsV=10,this.shiftHalfStepU=!1,this.removeStartEdgeU=!1,this.removeEndEdgeU=!1,this.shiftHalfStepV=!1,this.removeStartEdgeV=!1,this.removeEndEdgeV=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisionsU=e),void 0!==i&&(this.nrDivisionsV=i),void 0!==n&&(this.shiftHalfStepU=n),void 0!==r&&(this.removeStartEdgeU=r),void 0!==s&&(this.removeEndEdgeU=s),void 0!==o&&(this.shiftHalfStepV=o),void 0!==a&&(this.removeStartEdgeV=a),void 0!==c&&(this.removeEndEdgeV=c)}},t.FaceSubdivisionToWiresDto=class{constructor(t,e,i,n,r,s){this.nrDivisions=10,this.isU=!0,this.shiftHalfStep=!1,this.removeStart=!1,this.removeEnd=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisions=e),void 0!==i&&(this.isU=i),void 0!==n&&(this.shiftHalfStep=n),void 0!==r&&(this.removeStart=r),void 0!==s&&(this.removeEnd=s)}},t.FaceSubdivideToRectangleWiresDto=class{constructor(t,e,i,n,r,s,o,a,c){this.nrRectanglesU=10,this.nrRectanglesV=10,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrRectanglesU=e),void 0!==i&&(this.nrRectanglesU=i),void 0!==n&&(this.scalePatternU=n),void 0!==r&&(this.scalePatternV=r),void 0!==s&&(this.filletPattern=s),void 0!==o&&(this.inclusionPattern=o),void 0!==a&&(this.offsetFromBorderU=a),void 0!==c&&(this.offsetFromBorderV=c)}},t.FaceSubdivideToHexagonWiresDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p){this.nrHexagonsU=10,this.nrHexagonsV=10,this.flatU=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,this.extendUUp=!1,this.extendUBottom=!1,this.extendVUp=!1,this.extendVBottom=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrHexagonsU=e),void 0!==i&&(this.nrHexagonsU=i),void 0!==n&&(this.flatU=n),void 0!==r&&(this.scalePatternU=r),void 0!==s&&(this.scalePatternV=s),void 0!==o&&(this.filletPattern=o),void 0!==a&&(this.inclusionPattern=a),void 0!==c&&(this.offsetFromBorderU=c),void 0!==l&&(this.offsetFromBorderV=l),void 0!==h&&(this.extendUUp=h),void 0!==u&&(this.extendUBottom=u),void 0!==d&&(this.extendVUp=d),void 0!==p&&(this.extendVBottom=p)}},t.FaceSubdivideToHexagonHolesDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h){this.nrHexagonsU=10,this.nrHexagonsV=10,this.flatU=!1,this.holesToFaces=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrHexagonsU=e),void 0!==i&&(this.nrHexagonsU=i),void 0!==n&&(this.flatU=n),void 0!==r&&(this.holesToFaces=r),void 0!==s&&(this.scalePatternU=s),void 0!==o&&(this.scalePatternV=o),void 0!==a&&(this.filletPattern=a),void 0!==c&&(this.inclusionPattern=c),void 0!==l&&(this.offsetFromBorderU=l),void 0!==h&&(this.offsetFromBorderV=h)}},t.FaceSubdivideToRectangleHolesDto=class{constructor(t,e,i,n,r,s,o,a,c,l){this.nrRectanglesU=10,this.nrRectanglesV=10,this.holesToFaces=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrRectanglesU=e),void 0!==i&&(this.nrRectanglesU=i),void 0!==n&&(this.scalePatternU=n),void 0!==r&&(this.scalePatternV=r),void 0!==s&&(this.filletPattern=s),void 0!==o&&(this.inclusionPattern=o),void 0!==a&&(this.holesToFaces=a),void 0!==c&&(this.offsetFromBorderU=c),void 0!==l&&(this.offsetFromBorderV=l)}},t.FaceSubdivisionControlledDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f){this.nrDivisionsU=10,this.nrDivisionsV=10,this.shiftHalfStepNthU=0,this.shiftHalfStepUOffsetN=0,this.removeStartEdgeNthU=0,this.removeStartEdgeUOffsetN=0,this.removeEndEdgeNthU=0,this.removeEndEdgeUOffsetN=0,this.shiftHalfStepNthV=0,this.shiftHalfStepVOffsetN=0,this.removeStartEdgeNthV=0,this.removeStartEdgeVOffsetN=0,this.removeEndEdgeNthV=0,this.removeEndEdgeVOffsetN=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisionsU=e),void 0!==i&&(this.nrDivisionsV=i),void 0!==n&&(this.shiftHalfStepNthU=n),void 0!==r&&(this.shiftHalfStepUOffsetN=r),void 0!==s&&(this.removeStartEdgeNthU=s),void 0!==o&&(this.removeStartEdgeUOffsetN=o),void 0!==a&&(this.removeEndEdgeNthU=a),void 0!==c&&(this.removeEndEdgeUOffsetN=c),void 0!==l&&(this.shiftHalfStepNthV=l),void 0!==h&&(this.shiftHalfStepVOffsetN=h),void 0!==u&&(this.removeStartEdgeNthV=u),void 0!==d&&(this.removeStartEdgeVOffsetN=d),void 0!==p&&(this.removeEndEdgeNthV=p),void 0!==f&&(this.removeEndEdgeVOffsetN=f)}},t.FaceLinearSubdivisionDto=class{constructor(t,e,i,n,r,s,o){this.isU=!0,this.param=.5,this.nrPoints=10,this.shiftHalfStep=!1,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.param=i),void 0!==n&&(this.nrPoints=n),void 0!==r&&(this.shiftHalfStep=r),void 0!==s&&(this.removeStartPoint=s),void 0!==o&&(this.removeEndPoint=o)}},t.WireAlongParamDto=class{constructor(t,e,i){this.isU=!0,this.param=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.param=i)}},t.WiresAlongParamsDto=class{constructor(t,e,i){this.isU=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.params=i)}},t.DataOnUVDto=class{constructor(t,e,i){this.paramU=.5,this.paramV=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.paramU=e),void 0!==i&&(this.paramV=i)}},t.DataOnUVsDto=class{constructor(t,e){this.paramsUV=[[.5,.5]],void 0!==t&&(this.shape=t),void 0!==e&&(this.paramsUV=e)}},t.PolygonDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PolygonsDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.polygons=t),void 0!==e&&(this.returnCompound=e)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PolylinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.polylines=t),void 0!==e&&(this.returnCompound=e)}},t.SquareDto=class{constructor(t,e,i){this.size=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.size=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.RectangleDto=class{constructor(t,e,i,n){this.width=1,this.length=2,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.center=i),void 0!==n&&(this.direction=n)}},t.LPolygonDto=class{constructor(t,e,i,n,s,o,a,c){this.widthFirst=1,this.lengthFirst=2,this.widthSecond=.5,this.lengthSecond=2,this.align=r.outside,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.widthFirst=t),void 0!==e&&(this.lengthFirst=e),void 0!==i&&(this.widthSecond=i),void 0!==n&&(this.lengthSecond=n),void 0!==s&&(this.align=s),void 0!==o&&(this.rotation=o),void 0!==a&&(this.center=a),void 0!==c&&(this.direction=c)}},t.BoxDto=class{constructor(t,e,i,n,r){this.width=1,this.length=2,this.height=3,this.center=[0,0,0],this.originOnCenter=!0,void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.height=i),void 0!==n&&(this.center=n),void 0!==r&&(this.originOnCenter=r)}},t.CubeDto=class{constructor(t,e,i){this.size=1,this.center=[0,0,0],this.originOnCenter=!0,void 0!==t&&(this.size=t),void 0!==e&&(this.center=e),void 0!==i&&(this.originOnCenter=i)}},t.BoxFromCornerDto=class{constructor(t,e,i,n){this.width=1,this.length=2,this.height=3,this.corner=[0,0,0],void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.height=i),void 0!==n&&(this.corner=n)}},t.SphereDto=class{constructor(t,e){this.radius=1,this.center=[0,0,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e)}},t.ConeDto=class{constructor(t,e,i,n,r,s){this.radius1=2,this.radius2=1,this.height=2,this.angle=360,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius1=t),void 0!==e&&(this.radius2=e),void 0!==i&&(this.height=i),void 0!==n&&(this.angle=n),void 0!==r&&(this.center=r),void 0!==s&&(this.direction=s)}},t.LineDto=class{constructor(t,e){this.start=[0,0,0],this.end=[0,1,0],void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},t.LineWithExtensionsDto=class{constructor(t,e,i,n){this.start=[0,0,0],this.end=[0,1,0],this.extensionStart=.1,this.extensionEnd=.1,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.extensionStart=i),void 0!==n&&(this.extensionEnd=n)}},t.LinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.lines=t),void 0!==e&&(this.returnCompound=e)}},t.ArcEdgeTwoPointsTangentDto=class{constructor(t,e,i){this.start=[0,0,0],this.tangentVec=[0,1,0],this.end=[0,0,1],void 0!==t&&(this.start=t),void 0!==e&&(this.tangentVec=e),void 0!==i&&(this.end=i)}},t.ArcEdgeCircleTwoPointsDto=class{constructor(t,e,i,n){this.start=[0,0,0],this.end=[0,0,1],this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.start=e),void 0!==i&&(this.end=i),void 0!==n&&(this.sense=n)}},t.ArcEdgeCircleTwoAnglesDto=class{constructor(t,e,i,n){this.alphaAngle1=0,this.alphaAngle2=90,this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.alphaAngle1=e),void 0!==i&&(this.alphaAngle2=i),void 0!==n&&(this.sense=n)}},t.ArcEdgeCirclePointAngleDto=class{constructor(t,e,i,n){this.alphaAngle=90,this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.alphaAngle=e),void 0!==n&&(this.sense=n)}},t.ArcEdgeThreePointsDto=class{constructor(t,e,i){this.start=[0,0,0],this.middle=[0,1,0],this.end=[0,0,1],void 0!==t&&(this.start=t),void 0!==e&&(this.middle=e),void 0!==i&&(this.end=i)}},t.CylinderDto=class{constructor(t,e,i,n,r,s){this.radius=1,this.height=2,this.center=[0,0,0],this.direction=[0,1,0],this.angle=360,this.originOnCenter=!1,void 0!==t&&(this.radius=t),void 0!==e&&(this.height=e),void 0!==i&&(this.center=i),void 0!==n&&(this.direction=n),void 0!==r&&(this.angle=r),void 0!==s&&(this.originOnCenter=s)}},t.CylindersOnLinesDto=class{constructor(t,e){void 0!==t&&(this.radius=t),void 0!==e&&(this.lines=e)}},t.FilletDto=class{constructor(t,e,i,n){this.radius=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.radiusList=i),void 0!==n&&(this.indexes=n)}},t.FilletShapesDto=class{constructor(t,e,i,n){this.radius=.1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.radiusList=i),void 0!==n&&(this.indexes=n)}},t.FilletEdgesListDto=class{constructor(t,e,i){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusList=i)}},t.FilletEdgesListOneRadiusDto=class{constructor(t,e,i){this.radius=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radius=i)}},t.FilletEdgeVariableRadiusDto=class{constructor(t,e,i,n){void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.radiusList=i),void 0!==n&&(this.paramsU=n)}},t.FilletEdgesVariableRadiusDto=class{constructor(t,e,i,n){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusLists=i),void 0!==n&&(this.paramsULists=n)}},t.FilletEdgesSameVariableRadiusDto=class{constructor(t,e,i,n){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusList=i),void 0!==n&&(this.paramsU=n)}},t.Fillet3DWiresDto=class{constructor(t,e,i,n,r){this.radius=.1,this.direction=[0,1,0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.radiusList=n),void 0!==r&&(this.indexes=r)}},t.Fillet3DWireDto=class{constructor(t,e,i,n,r){this.radius=.1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.radiusList=n),void 0!==r&&(this.indexes=r)}},t.ChamferDto=class{constructor(t,e,i,n){this.distance=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.distance=e),void 0!==i&&(this.distanceList=i),void 0!==n&&(this.indexes=n)}},t.ChamferEdgesListDto=class{constructor(t,e,i){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.distanceList=i)}},t.ChamferEdgeDistAngleDto=class{constructor(t,e,i,n,r){this.distance=.1,this.angle=45,void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.face=i),void 0!==n&&(this.distance=n),void 0!==r&&(this.angle=r)}},t.ChamferEdgeTwoDistancesDto=class{constructor(t,e,i,n,r){this.distance1=.1,this.distance2=.2,void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.face=i),void 0!==n&&(this.distance1=n),void 0!==r&&(this.distance2=r)}},t.ChamferEdgesTwoDistancesListsDto=class{constructor(t,e,i,n,r){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==n&&(this.distances1=n),void 0!==r&&(this.distances2=r)}},t.ChamferEdgesTwoDistancesDto=class{constructor(t,e,i,n,r){this.distance1=.1,this.distance2=.2,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==n&&(this.distance1=n),void 0!==r&&(this.distance2=r)}},t.ChamferEdgesDistsAnglesDto=class{constructor(t,e,i,n,r){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==n&&(this.distances=n),void 0!==r&&(this.angles=r)}},t.ChamferEdgesDistAngleDto=class{constructor(t,e,i,n,r){this.distance=.1,this.angle=45,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==n&&(this.distance=n),void 0!==r&&(this.angle=r)}},t.BSplineDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.BSplinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.bSplines=t),void 0!==e&&(this.returnCompound=e)}},t.WireFromTwoCirclesTanDto=class{constructor(t,e,i,n,r){this.keepLines=f.outside,this.circleRemainders=p.outside,this.tolerance=1e-7,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.keepLines=i),void 0!==n&&(this.circleRemainders=n),void 0!==r&&(this.tolerance=r)}},t.FaceFromMultipleCircleTanWiresDto=class{constructor(t,e,i,n){this.combination=m.allWithAll,this.unify=!0,this.tolerance=1e-7,void 0!==t&&(this.circles=t),void 0!==e&&(this.combination=e),void 0!==i&&(this.unify=i),void 0!==n&&(this.tolerance=n)}},t.FaceFromMultipleCircleTanWireCollectionsDto=class{constructor(t,e,i,n){this.combination=m.allWithAll,this.unify=!0,this.tolerance=1e-7,void 0!==t&&(this.listsOfCircles=t),void 0!==e&&(this.combination=e),void 0!==i&&(this.unify=i),void 0!==n&&(this.tolerance=n)}},t.ZigZagBetweenTwoWiresDto=class{constructor(t,e,i,n,r,s){this.nrZigZags=20,this.divideByEqualDistance=!1,this.zigZagsPerEdge=!0,void 0!==t&&(this.wire1=t),void 0!==e&&(this.wire2=e),void 0!==i&&(this.nrZigZags=i),void 0!==n&&(this.inverse=n),void 0!==r&&(this.divideByEqualDistance=r),void 0!==s&&(this.zigZagsPerEdge=s)}},t.InterpolationDto=class{constructor(t,e,i){this.periodic=!1,this.tolerance=1e-7,void 0!==t&&(this.points=t),void 0!==e&&(this.periodic=e),void 0!==i&&(this.tolerance=i)}},t.InterpolateWiresDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.interpolations=t),void 0!==e&&(this.returnCompound=e)}},t.BezierDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.BezierWeightsDto=class{constructor(t,e,i){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.weights=e),void 0!==i&&(this.closed=i)}},t.BezierWiresDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.bezierWires=t),void 0!==e&&(this.returnCompound=e)}},t.DivideDto=class{constructor(t,e,i,n){this.nrOfDivisions=10,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.removeStartPoint=i),void 0!==n&&(this.removeEndPoint=n)}},t.ProjectWireDto=class{constructor(t,e,i){this.direction=[0,1,0],void 0!==t&&(this.wire=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i)}},t.ProjectPointsOnShapeDto=class{constructor(t,e,i,n){this.direction=[0,10,0],void 0!==t&&(this.points=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.projectionType=n)}},t.WiresToPointsDto=class{constructor(t,e,i,n,r,s){this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.angularDeflection=e),void 0!==i&&(this.curvatureDeflection=i),void 0!==n&&(this.minimumOfPoints=n),void 0!==r&&(this.uTolerance=r),void 0!==s&&(this.minimumLength=s)}},t.EdgesToPointsDto=class{constructor(t,e,i,n,r,s){this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.angularDeflection=e),void 0!==i&&(this.curvatureDeflection=i),void 0!==n&&(this.minimumOfPoints=n),void 0!==r&&(this.uTolerance=r),void 0!==s&&(this.minimumLength=s)}},t.ProjectWiresDto=class{constructor(t,e,i){this.direction=[0,1,0],void 0!==t&&(this.wires=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i)}},t.DivideShapesDto=class{constructor(t,e,i,n){this.nrOfDivisions=10,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.removeStartPoint=i),void 0!==n&&(this.removeEndPoint=n)}},t.DataOnGeometryAtParamDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.param=e)}},t.DataOnGeometryesAtParamDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.shapes=t),void 0!==e&&(this.param=e)}},t.PointInFaceDto=class{constructor(t,e,i,n){this.tEdgeParam=.5,this.distance2DParam=.5,void 0!==t&&(this.face=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.tEdgeParam=i),void 0!==n&&(this.distance2DParam=n)}},t.PointsOnWireAtEqualLengthDto=class{constructor(t,e,i,n,r){this.length=.5,this.tryNext=!1,this.includeFirst=!1,this.includeLast=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.length=e),void 0!==i&&(this.tryNext=i),void 0!==n&&(this.includeFirst=n),void 0!==r&&(this.includeLast=r)}},t.PointsOnWireAtPatternOfLengthsDto=class{constructor(t,e,i,n,r){this.tryNext=!1,this.includeFirst=!1,this.includeLast=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.lengths=e),void 0!==i&&(this.tryNext=i),void 0!==n&&(this.includeLast=n),void 0!==r&&(this.includeLast=r)}},t.DataOnGeometryAtLengthDto=class{constructor(t,e){this.length=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.length=e)}},t.DataOnGeometryesAtLengthDto=class{constructor(t,e){this.length=.5,void 0!==t&&(this.shapes=t),void 0!==e&&(this.length=e)}},t.DataOnGeometryAtLengthsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.lengths=e)}},t.CircleDto=class{constructor(t,e,i){this.radius=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.HexagonsInGridDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d){this.width=10,this.height=10,this.nrHexagonsInWidth=10,this.nrHexagonsInHeight=10,this.flatTop=!1,this.extendTop=!1,this.extendBottom=!1,this.extendLeft=!1,this.extendRight=!1,void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.nrHexagonsInHeight=i),void 0!==n&&(this.nrHexagonsInWidth=n),void 0!==r&&(this.flatTop=r),void 0!==s&&(this.extendTop=s),void 0!==o&&(this.extendBottom=o),void 0!==a&&(this.extendLeft=a),void 0!==c&&(this.extendRight=c),void 0!==l&&(this.scalePatternWidth=l),void 0!==h&&(this.scalePatternHeight=h),void 0!==u&&(this.filletPattern=u),void 0!==d&&(this.inclusionPattern=d)}},t.LoftDto=class{constructor(t,e){this.makeSolid=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.makeSolid=e)}},t.LoftAdvancedDto=class{constructor(t,e,i,r,s,o,a,c,l,h,u,d){this.makeSolid=!1,this.closed=!1,this.periodic=!1,this.straight=!1,this.nrPeriodicSections=10,this.useSmoothing=!1,this.maxUDegree=3,this.tolerance=1e-7,this.parType=n.approxCentripetal,void 0!==t&&(this.shapes=t),void 0!==e&&(this.makeSolid=e),void 0!==i&&(this.closed=i),void 0!==r&&(this.periodic=r),void 0!==s&&(this.straight=s),void 0!==o&&(this.nrPeriodicSections=o),void 0!==a&&(this.useSmoothing=a),void 0!==c&&(this.maxUDegree=c),void 0!==l&&(this.tolerance=l),void 0!==h&&(this.parType=h),void 0!==u&&(this.startVertex=u),void 0!==d&&(this.endVertex=d)}},t.OffsetDto=class{constructor(t,e,i,n){this.distance=.2,this.tolerance=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.face=e),void 0!==i&&(this.distance=i),void 0!==n&&(this.tolerance=n)}},t.OffsetAdvancedDto=class{constructor(t,i,n,r,s,o){this.distance=.2,this.tolerance=.1,this.joinType=e.arc,this.removeIntEdges=!1,void 0!==t&&(this.shape=t),void 0!==i&&(this.face=i),void 0!==n&&(this.distance=n),void 0!==r&&(this.tolerance=r),void 0!==s&&(this.joinType=s),void 0!==o&&(this.removeIntEdges=o)}},t.RevolveDto=class{constructor(t,e,i,n){this.angle=360,this.direction=[0,1,0],this.copy=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.copy=n)}},t.ShapeShapesDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e)}},t.WiresOnFaceDto=class{constructor(t,e){void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e)}},t.PipeWiresCylindricalDto=class{constructor(t,e,i,n,r){this.radius=.1,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.makeSolid=i),void 0!==n&&(this.trihedronEnum=n),void 0!==r&&(this.forceApproxC1=r)}},t.PipeWireCylindricalDto=class{constructor(t,e,i,n,r){this.radius=.1,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.makeSolid=i),void 0!==n&&(this.trihedronEnum=n),void 0!==r&&(this.forceApproxC1=r)}},t.PipePolygonWireNGonDto=class{constructor(t,e,i,n,r,s){this.radius=.1,this.nrCorners=6,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.nrCorners=i),void 0!==n&&(this.makeSolid=n),void 0!==r&&(this.trihedronEnum=r),void 0!==s&&(this.forceApproxC1=s)}},t.ExtrudeDto=class{constructor(t,e){this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.direction=e)}},t.ExtrudeShapesDto=class{constructor(t,e){this.direction=[0,1,0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.direction=e)}},t.SplitDto=class{constructor(t,e){this.localFuzzyTolerance=1e-4,this.nonDestructive=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e)}},t.UnionDto=class{constructor(t,e){this.keepEdges=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.keepEdges=e)}},t.DifferenceDto=class{constructor(t,e,i){this.keepEdges=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e),void 0!==i&&(this.keepEdges=i)}},t.IntersectionDto=class{constructor(t,e){this.keepEdges=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.keepEdges=e)}},t.ShapeDto=class{constructor(t){void 0!==t&&(this.shape=t)}},t.MeshMeshIntersectionTwoShapesDto=class{constructor(t,e,i,n){this.precision1=.01,this.precision2=.01,void 0!==t&&(this.shape1=t),void 0!==e&&(this.shape2=e),void 0!==i&&(this.precision1=i),void 0!==n&&(this.precision2=n)}},t.MeshMeshesIntersectionOfShapesDto=class{constructor(t,e,i,n){this.precision=.01,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e),void 0!==i&&(this.precision=i),void 0!==n&&(this.precisionShapes=n)}},t.CompareShapesDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.otherShape=e)}},t.FixSmallEdgesInWireDto=class{constructor(t,e,i){this.lockvtx=!1,this.precsmall=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.lockvtx=e),void 0!==i&&(this.precsmall=i)}},t.BasicShapeRepairDto=class{constructor(t,e,i,n){this.precision=.001,this.maxTolerance=.01,this.minTolerance=1e-4,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.maxTolerance=i),void 0!==n&&(this.minTolerance=n)}},t.FixClosedDto=class{constructor(t,e){this.precision=-.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e)}},t.ShapesWithToleranceDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shapes=t),void 0!==e&&(this.tolerance=e)}},t.ShapeWithToleranceDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.tolerance=e)}},t.ShapeIndexDto=class{constructor(t,e){this.index=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.index=e)}},t.EdgeIndexDto=class{constructor(t,e){this.index=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.index=e)}},t.RotationExtrudeDto=class{constructor(t,e,i,n){this.height=1,this.angle=360,this.makeSolid=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.height=e),void 0!==i&&(this.angle=i),void 0!==n&&(this.makeSolid=n)}},t.ThickSolidByJoinDto=class{constructor(t,i,n,r,s,o,a,c){this.offset=1,this.tolerance=.001,this.intersection=!1,this.selfIntersection=!1,this.joinType=e.arc,this.removeIntEdges=!1,void 0!==t&&(this.shape=t),void 0!==i&&(this.shapes=i),void 0!==n&&(this.offset=n),void 0!==r&&(this.tolerance=r),void 0!==s&&(this.intersection=s),void 0!==o&&(this.selfIntersection=o),void 0!==a&&(this.joinType=a),void 0!==c&&(this.removeIntEdges=c)}},t.TransformDto=class{constructor(t,e,i,n,r){this.translation=[0,0,0],this.rotationAxis=[0,1,0],this.rotationAngle=0,this.scaleFactor=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.translation=e),void 0!==i&&(this.rotationAxis=i),void 0!==n&&(this.rotationAngle=n),void 0!==r&&(this.scaleFactor=r)}},t.TransformShapesDto=class{constructor(t,e,i,n,r){this.translations=[[0,0,0]],this.rotationAxes=[[0,1,0]],this.rotationAngles=[0],this.scaleFactors=[1],void 0!==t&&(this.shapes=t),void 0!==e&&(this.translations=e),void 0!==i&&(this.rotationAxes=i),void 0!==n&&(this.rotationAngles=n),void 0!==r&&(this.scaleFactors=r)}},t.TranslateDto=class{constructor(t,e){this.translation=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.translation=e)}},t.TranslateShapesDto=class{constructor(t,e){this.translations=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.translations=e)}},t.AlignNormAndAxisDto=class{constructor(t,e,i,n,r,s,o){this.fromOrigin=[0,0,0],this.fromNorm=[1,0,0],this.fromAx=[0,0,1],this.toOrigin=[0,1,0],this.toNorm=[0,1,0],this.toAx=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.fromOrigin=e),void 0!==i&&(this.fromNorm=i),void 0!==n&&(this.fromAx=n),void 0!==r&&(this.toOrigin=r),void 0!==s&&(this.toNorm=s),void 0!==o&&(this.toAx=o)}},t.AlignDto=class{constructor(t,e,i,n,r){this.fromOrigin=[0,0,0],this.fromDirection=[0,0,1],this.toOrigin=[0,1,0],this.toDirection=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.fromOrigin=e),void 0!==i&&(this.fromDirection=i),void 0!==n&&(this.toOrigin=n),void 0!==r&&(this.toDirection=r)}},t.AlignShapesDto=class{constructor(t,e,i,n,r){this.fromOrigins=[[0,0,0]],this.fromDirections=[[0,0,1]],this.toOrigins=[[0,1,0]],this.toDirections=[[0,1,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.fromOrigins=e),void 0!==i&&(this.fromDirections=i),void 0!==n&&(this.toOrigins=n),void 0!==r&&(this.toDirections=r)}},t.MirrorDto=class{constructor(t,e,i){this.origin=[0,0,0],this.direction=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.origin=e),void 0!==i&&(this.direction=i)}},t.MirrorShapesDto=class{constructor(t,e,i){this.origins=[[0,0,0]],this.directions=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.origins=e),void 0!==i&&(this.directions=i)}},t.MirrorAlongNormalDto=class{constructor(t,e,i){this.origin=[0,0,0],this.normal=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.origin=e),void 0!==i&&(this.normal=i)}},t.MirrorAlongNormalShapesDto=class{constructor(t,e,i){this.origins=[[0,0,0]],this.normals=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.origins=e),void 0!==i&&(this.normals=i)}},t.AlignAndTranslateDto=class{constructor(t,e,i){this.direction=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.center=i)}},t.UnifySameDomainDto=class{constructor(t,e,i,n){this.unifyEdges=!0,this.unifyFaces=!0,this.concatBSplines=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.unifyEdges=e),void 0!==i&&(this.unifyFaces=i),void 0!==n&&(this.concatBSplines=n)}},t.FilterFacesPointsDto=class{constructor(t,e,i,n,r,s,o,a,c,l){this.tolerance=1e-4,this.useBndBox=!1,this.gapTolerance=.1,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,this.flatPointsArray=!0,void 0!==t&&(this.shapes=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.useBndBox=n),void 0!==r&&(this.gapTolerance=r),void 0!==s&&(this.keepIn=s),void 0!==o&&(this.keepOn=o),void 0!==a&&(this.keepOut=a),void 0!==c&&(this.keepUnknown=c),void 0!==l&&(this.flatPointsArray=l)}},t.FilterFacePointsDto=class{constructor(t,e,i,n,r,s,o,a,c){this.tolerance=1e-4,this.useBndBox=!1,this.gapTolerance=.1,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.useBndBox=n),void 0!==r&&(this.gapTolerance=r),void 0!==s&&(this.keepIn=s),void 0!==o&&(this.keepOn=o),void 0!==a&&(this.keepOut=a),void 0!==c&&(this.keepUnknown=c)}},t.FilterSolidPointsDto=class{constructor(t,e,i,n,r,s,o){this.tolerance=1e-4,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==n&&(this.keepIn=n),void 0!==r&&(this.keepOn=r),void 0!==s&&(this.keepOut=s),void 0!==o&&(this.keepUnknown=o)}},t.AlignAndTranslateShapesDto=class{constructor(t,e,i){this.directions=[[0,1,0]],this.centers=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.directions=e),void 0!==i&&(this.centers=i)}},t.RotateDto=class{constructor(t,e,i){this.axis=[0,0,1],this.angle=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.axis=e),void 0!==i&&(this.angle=i)}},t.RotateAroundCenterDto=class{constructor(t,e,i,n){this.angle=0,this.center=[0,0,0],this.axis=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.center=i),void 0!==n&&(this.axis=n)}},t.RotateShapesDto=class{constructor(t,e,i){this.angles=[0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.axes=e),void 0!==i&&(this.angles=i)}},t.RotateAroundCenterShapesDto=class{constructor(t,e,i,n){this.angles=[0],this.centers=[[0,0,0]],this.axes=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.angles=e),void 0!==i&&(this.centers=i),void 0!==n&&(this.axes=n)}},t.ScaleDto=class{constructor(t,e){this.factor=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.factor=e)}},t.ScaleShapesDto=class{constructor(t,e){this.factors=[1],void 0!==t&&(this.shapes=t),void 0!==e&&(this.factors=e)}},t.Scale3DDto=class{constructor(t,e,i){this.scale=[1,1,1],this.center=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.scale=e),void 0!==i&&(this.center=i)}},t.Scale3DShapesDto=class{constructor(t,e,i){this.scales=[[1,1,1]],this.centers=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.scales=e),void 0!==i&&(this.centers=i)}},t.ShapeToMeshDto=class{constructor(t,e,i){this.precision=.01,this.adjustYtoZ=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i)}},t.ShapeFacesToPolygonPointsDto=class{constructor(t,e,i,n){this.precision=.01,this.adjustYtoZ=!1,this.reversedPoints=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i),void 0!==n&&(this.reversedPoints=n)}},t.ShapesToMeshesDto=class{constructor(t,e,i){this.precision=.01,this.adjustYtoZ=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i)}},t.SaveStepDto=class{constructor(t,e,i,n){this.fileName="shape.step",this.adjustYtoZ=!1,this.tryDownload=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.adjustYtoZ=i),void 0!==n&&(this.tryDownload=n)}},t.SaveStlDto=class{constructor(t,e,i,n,r,s){this.fileName="shape.stl",this.precision=.01,this.adjustYtoZ=!1,this.tryDownload=!0,this.binary=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.precision=i),void 0!==n&&(this.adjustYtoZ=n),void 0!==r&&(this.tryDownload=r),void 0!==s&&(this.binary=s)}},t.ImportStepIgesFromTextDto=class{constructor(t,e,i){this.fileType=s.step,this.adjustZtoY=!0,void 0!==t&&(this.text=t),void 0!==e&&(this.fileType=e),void 0!==i&&(this.adjustZtoY=i)}},t.ImportStepIgesDto=class{constructor(t,e){this.adjustZtoY=!0,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.adjustZtoY=e)}},t.LoadStepOrIgesDto=class{constructor(t,e,i){this.fileName="shape.igs",this.adjustZtoY=!0,void 0!==t&&(this.filetext=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.adjustZtoY=i)}},t.CompoundShapesDto=class{constructor(t){void 0!==t&&(this.shapes=t)}},t.ThisckSolidSimpleDto=class{constructor(t,e){this.offset=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.offset=e)}},t.Offset3DWireDto=class{constructor(t,e,i){this.offset=1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.offset=e),void 0!==i&&(this.direction=i)}},t.FaceFromWireDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.planar=e)}},t.FaceFromWireOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wire=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.FacesFromWiresOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.FaceFromWiresDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.planar=e)}},t.FacesFromWiresDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.planar=e)}},t.FaceFromWiresOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.SewDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shapes=t),void 0!==e&&(this.tolerance=e)}},t.FaceIsoCurveAtParamDto=class{constructor(t,e,i){this.dir="u",void 0!==t&&(this.shape=t),void 0!==e&&(this.param=e),void 0!==i&&(this.dir=i)}},t.DivideFaceToUVPointsDto=class{constructor(t,e,i,n){this.nrOfPointsU=10,this.nrOfPointsV=10,this.flat=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrOfPointsU=e),void 0!==i&&(this.nrOfPointsV=i),void 0!==n&&(this.flat=n)}},t.Geom2dEllipseDto=class{constructor(t,e,i,n,r){this.center=[0,0],this.direction=[1,0],this.radiusMinor=1,this.radiusMajor=2,this.sense=!1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radiusMinor=i),void 0!==n&&(this.radiusMajor=n),void 0!==r&&(this.sense=r)}},t.Geom2dCircleDto=class{constructor(t,e,i,n){this.center=[0,0],this.direction=[1,0],this.radius=1,this.sense=!1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radius=i),void 0!==n&&(this.sense=n)}},t.ChristmasTreeDto=class{constructor(t,e,i,n,r,s,o,a,c,l){this.height=6,this.innerDist=1.5,this.outerDist=3,this.nrSkirts=5,this.trunkHeight=1,this.trunkWidth=1,this.half=!1,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.innerDist=e),void 0!==i&&(this.outerDist=i),void 0!==n&&(this.nrSkirts=n),void 0!==r&&(this.trunkHeight=r),void 0!==s&&(this.trunkWidth=s),void 0!==o&&(this.half=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.origin=c),void 0!==l&&(this.direction=l)}},t.StarDto=class{constructor(t,e,i,n,r,s,o){this.center=[0,0,0],this.direction=[0,1,0],this.numRays=7,this.half=!1,void 0!==t&&(this.outerRadius=t),void 0!==e&&(this.innerRadius=e),void 0!==i&&(this.numRays=i),void 0!==n&&(this.center=n),void 0!==r&&(this.direction=r),void 0!==s&&(this.offsetOuterEdges=s),void 0!==o&&(this.half=o)}},t.ParallelogramDto=class{constructor(t,e,i,n,r,s){this.center=[0,0,0],this.direction=[0,1,0],this.aroundCenter=!0,this.width=2,this.height=1,this.angle=15,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.aroundCenter=i),void 0!==n&&(this.width=n),void 0!==r&&(this.height=r),void 0!==s&&(this.angle=s)}},t.Heart2DDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.direction=[0,1,0],this.rotation=0,this.sizeApprox=2,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.rotation=i),void 0!==n&&(this.sizeApprox=n)}},t.NGonWireDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.direction=[0,1,0],this.nrCorners=6,this.radius=1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.nrCorners=i),void 0!==n&&(this.radius=n)}},t.EllipseDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.direction=[0,1,0],this.radiusMinor=1,this.radiusMajor=2,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radiusMinor=i),void 0!==n&&(this.radiusMajor=n)}},t.TextWiresDto=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u){this.text="Hello World",this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=2,this.letterSpacing=0,this.extrudeOffset=0,this.centerOnOrigin=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==n&&(this.height=n),void 0!==r&&(this.lineSpacing=r),void 0!==s&&(this.letterSpacing=s),void 0!==o&&(this.align=o),void 0!==a&&(this.extrudeOffset=a),void 0!==u&&(this.centerOnOrigin=u)}},t.GeomCylindricalSurfaceDto=class{constructor(t,e,i){this.radius=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.Geom2dTrimmedCurveDto=class{constructor(t,e,i,n,r){this.u1=0,this.u2=1,this.sense=!0,this.adjustPeriodic=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.u1=e),void 0!==i&&(this.u2=i),void 0!==n&&(this.sense=n),void 0!==r&&(this.adjustPeriodic=r)}},t.Geom2dSegmentDto=class{constructor(t,e){this.start=[0,0],this.end=[1,0],void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},t.SliceDto=class{constructor(t,e,i){this.step=.1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.step=e),void 0!==i&&(this.direction=i)}},t.SliceInStepPatternDto=class{constructor(t,e,i){this.steps=[.1,.2],this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.steps=e),void 0!==i&&(this.direction=i)}},t.SimpleLinearLengthDimensionDto=class{constructor(t,e,i,n,r,s,o,a){this.offsetFromPoints=0,this.crossingSize=.2,this.decimalPlaces=2,this.labelSuffix="(cm)",this.labelSize=.1,this.labelOffset=.3,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.offsetFromPoints=n),void 0!==r&&(this.crossingSize=r),void 0!==s&&(this.labelSuffix=s),void 0!==o&&(this.labelSize=o),void 0!==a&&(this.labelOffset=a)}},t.SimpleAngularDimensionDto=class{constructor(t,e,i,n,r,s,o,a,c,l){this.direction1=[1,0,0],this.direction2=[0,0,1],this.center=[0,0,0],this.radius=4,this.offsetFromCenter=.5,this.extraSize=0,this.decimalPlaces=2,this.labelSuffix="(deg)",this.labelSize=.1,this.labelOffset=.3,this.radians=!1,void 0!==t&&(this.direction1=t),void 0!==e&&(this.direction2=e),void 0!==i&&(this.center=i),void 0!==n&&(this.radius=n),void 0!==r&&(this.offsetFromCenter=r),void 0!==s&&(this.extraSize=s),void 0!==o&&(this.radians=o),void 0!==a&&(this.labelSuffix=a),void 0!==c&&(this.labelSize=c),void 0!==l&&(this.labelOffset=l)}},t.PinWithLabelDto=class{constructor(t,e,i,n,r,s,o){this.startPoint=[0,0,0],this.endPoint=[0,5,2],this.direction=[0,0,1],this.offsetFromStart=0,this.label="Pin",this.labelOffset=.3,this.labelSize=.1,void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoint=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.offsetFromStart=n),void 0!==r&&(this.label=r),void 0!==s&&(this.labelOffset=s),void 0!==o&&(this.labelSize=o)}}}(uv||(uv={})),function(t){let e;!function(t){t.left="left",t.center="center",t.right="right"}(e=t.horizontalAlignEnum||(t.horizontalAlignEnum={}))}(dv||(dv={}));class Lv{constructor(t){this.math=t}hexColor(t){return t.color}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t.color);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:void 0}rgbToHex(t){let e=t.r,i=t.g,n=t.b;return 255!==t.max&&(e=Math.round(this.math.remap({number:e,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255})),i=Math.round(this.math.remap({number:i,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255})),n=Math.round(this.math.remap({number:n,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255}))),`#${Number(16777216+65536*e+256*i+n).toString(16).substring(1,7)}`}rgbObjToHex(t){return this.rgbToHex({r:t.rgb.r,g:t.rgb.g,b:t.rgb.b,min:t.min,max:t.max})}hexToRgbMapped(t){const e=this.hexToRgb(t);return{r:this.math.remap({number:e.r,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to}),g:this.math.remap({number:e.g,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to}),b:this.math.remap({number:e.b,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to})}}getRedParam(t){return this.hexToRgbMapped(t).r}getGreenParam(t){return this.hexToRgbMapped(t).g}getBlueParam(t){return this.hexToRgbMapped(t).b}rgbToRed(t){return t.rgb.r}rgbToGreen(t){return t.rgb.g}rgbToBlue(t){return t.rgb.b}invert(t){const{r:e,g:i,b:n}=this.hexToRgbMapped({color:t.color,from:0,to:255});if(t.blackAndWhite)return.299*e+.587*i+.114*n>186?"#000000":"#ffffff";const r=255-e,s=255-i,o=255-n;return this.rgbToHex({r,g:s,b:o,min:0,max:255})}}!function(t){t.HexDto=class{constructor(t){this.color="#0000ff",void 0!==t&&(this.color=t)}},t.InvertHexDto=class{constructor(t){this.color="#0000ff",this.blackAndWhite=!1,void 0!==t&&(this.color=t)}},t.HexDtoMapped=class{constructor(t,e,i){this.color="#0000ff",this.from=0,this.to=255,void 0!==t&&(this.color=t),void 0!==e&&(this.from=e),void 0!==i&&(this.to=i)}},t.RGBObjectMaxDto=class{constructor(t,e){this.min=0,this.max=255,void 0!==t&&(this.rgb=t),void 0!==e&&(this.max=e)}},t.RGBMinMaxDto=class{constructor(t,e,i,n,r){this.r=255,this.g=255,this.b=255,this.min=0,this.max=255,void 0!==t&&(this.r=t),void 0!==e&&(this.g=e),void 0!==i&&(this.b=i),void 0!==n&&(this.min=n),void 0!==r&&(this.max=r)}},t.RGBObjectDto=class{constructor(t){void 0!==t&&(this.rgb=t)}}}(pv||(pv={})),function(t){let e;!function(t){t.first="first",t.last="last"}(e=t.firstLastEnum||(t.firstLastEnum={})),t.ListItemDto=class{constructor(t,e,i){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.index=e),void 0!==i&&(this.clone=i)}},t.SubListDto=class{constructor(t,e,i,n){this.indexStart=0,this.indexEnd=1,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.indexStart=e),void 0!==i&&(this.indexEnd=i),void 0!==n&&(this.clone=n)}},t.ListCloneDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e)}},t.RepeatInPatternDto=class{constructor(t){this.clone=!0,this.lengthLimit=100,void 0!==t&&(this.list=t)}},t.SortDto=class{constructor(t,e,i){this.clone=!0,this.orderAsc=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e),void 0!==i&&(this.orderAsc=i)}},t.SortJsonDto=class{constructor(t,e,i){this.clone=!0,this.orderAsc=!0,this.property="propName",void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e),void 0!==i&&(this.orderAsc=i)}},t.ListDto=class{constructor(t){void 0!==t&&(this.list=t)}},t.GroupListDto=class{constructor(t,e,i){this.nrElements=2,this.keepRemainder=!1,void 0!==t&&(this.list=t),void 0!==e&&(this.nrElements=e),void 0!==i&&(this.keepRemainder=i)}},t.MultiplyItemDto=class{constructor(t,e){void 0!==t&&(this.item=t),void 0!==e&&(this.times=e)}},t.AddItemAtIndexDto=class{constructor(t,e,i,n){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.index=i),void 0!==n&&(this.clone=n)}},t.AddItemAtIndexesDto=class{constructor(t,e,i,n){this.indexes=[0],this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.indexes=i),void 0!==n&&(this.clone=n)}},t.AddItemsAtIndexesDto=class{constructor(t,e,i,n){this.indexes=[0],this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.items=e),void 0!==i&&(this.indexes=i),void 0!==n&&(this.clone=n)}},t.RemoveItemAtIndexDto=class{constructor(t,e,i){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.index=e),void 0!==i&&(this.clone=i)}},t.RemoveItemsAtIndexesDto=class{constructor(t,e,i){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.indexes=e),void 0!==i&&(this.clone=i)}},t.RemoveNthItemDto=class{constructor(t,e,i,n){this.nth=2,this.offset=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.nth=e),void 0!==i&&(this.offset=i),void 0!==n&&(this.clone=n)}},t.RandomThresholdDto=class{constructor(t,e,i){this.threshold=1,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.threshold=e),void 0!==i&&(this.clone=i)}},t.RemoveDuplicatesDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e)}},t.RemoveDuplicatesToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,this.clone=!0,void 0!==t&&(this.list=t),void 0!==i&&(this.tolerance=i),void 0!==e&&(this.clone=e)}},t.GetByPatternDto=class{constructor(t,e){this.pattern=[!0,!0,!1],void 0!==t&&(this.list=t),void 0!==e&&(this.pattern=e)}},t.GetNthItemDto=class{constructor(t,e,i,n){this.nth=2,this.offset=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.nth=e),void 0!==i&&(this.offset=i),void 0!==n&&(this.clone=n)}},t.GetLongestListLength=class{constructor(t){void 0!==t&&(this.lists=t)}},t.MergeElementsOfLists=class{constructor(t,e){this.level=0,void 0!==t&&(this.lists=t),void 0!==e&&(this.level=e)}},t.AddItemDto=class{constructor(t,e,i){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.clone=i)}},t.AddItemFirstLastDto=class{constructor(t,i,n,r){this.position=e.last,this.clone=!0,void 0!==t&&(this.list=t),void 0!==i&&(this.item=i),void 0!==n&&(this.position=n),void 0!==r&&(this.clone=r)}}}(fv||(fv={})),function(t){let e;!function(t){t.less="<",t.lessOrEqual="<=",t.greater=">",t.greaterOrEqual=">=",t.tripleEqual="===",t.tripleNotEqual="!==",t.equal="==",t.notEqual="!="}(e=t.BooleanOperatorsEnum||(t.BooleanOperatorsEnum={})),t.ComparisonDto=class{constructor(t,e,i){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e),void 0!==i&&(this.operator=i)}},t.BooleanDto=class{constructor(t){this.boolean=!1,void 0!==t&&(this.boolean=t)}},t.BooleanListDto=class{constructor(t){void 0!==t&&(this.booleans=t)}},t.ValueGateDto=class{constructor(t,e){this.boolean=!1,void 0!==t&&(this.value=t),void 0!==e&&(this.boolean=e)}},t.TwoValueGateDto=class{constructor(t,e){void 0!==t&&(this.value1=t),void 0!==e&&(this.value2=e)}},t.RandomBooleansDto=class{constructor(t){this.length=10,this.trueThreshold=.5,void 0!==t&&(this.length=t)}},t.TwoThresholdRandomGradientDto=class{},t.ThresholdBooleanListDto=class{},t.ThresholdGapsBooleanListDto=class{}}(mv||(mv={})),function(t){let e,i,n;!function(t){t.add="add",t.subtract="subtract",t.multiply="multiply",t.divide="divide",t.power="power",t.modulus="modulus"}(e=t.mathTwoNrOperatorEnum||(t.mathTwoNrOperatorEnum={})),function(t){t.absolute="absolute",t.negate="negate",t.ln="ln",t.log10="log10",t.tenPow="tenPow",t.round="round",t.floor="floor",t.ceil="ceil",t.sqrt="sqrt",t.sin="sin",t.cos="cos",t.tan="tan",t.asin="asin",t.acos="acos",t.atan="atan",t.log="log",t.exp="exp",t.radToDeg="radToDeg",t.degToRad="degToRad"}(i=t.mathOneNrOperatorEnum||(t.mathOneNrOperatorEnum={})),function(t){t.easeInSine="easeInSine",t.easeOutSine="easeOutSine",t.easeInOutSine="easeInOutSine",t.easeInQuad="easeInQuad",t.easeOutQuad="easeOutQuad",t.easeInOutQuad="easeInOutQuad",t.easeInCubic="easeInCubic",t.easeOutCubic="easeOutCubic",t.easeInOutCubic="easeInOutCubic",t.easeInQuart="easeInQuart",t.easeOutQuart="easeOutQuart",t.easeInOutQuart="easeInOutQuart",t.easeInQuint="easeInQuint",t.easeOutQuint="easeOutQuint",t.easeInOutQuint="easeInOutQuint",t.easeInExpo="easeInExpo",t.easeOutExpo="easeOutExpo",t.easeInOutExpo="easeInOutExpo",t.easeInCirc="easeInCirc",t.easeOutCirc="easeOutCirc",t.easeInOutCirc="easeInOutCirc",t.easeInElastic="easeInElastic",t.easeOutElastic="easeOutElastic",t.easeInOutElastic="easeInOutElastic",t.easeInBack="easeInBack",t.easeOutBack="easeOutBack",t.easeInOutBack="easeInOutBack",t.easeInBounce="easeInBounce",t.easeOutBounce="easeOutBounce",t.easeInOutBounce="easeInOutBounce"}(n=t.easeEnum||(t.easeEnum={})),t.ModulusDto=class{constructor(t,e){this.number=1,this.modulus=2,void 0!==t&&(this.number=t),void 0!==e&&(this.modulus=e)}},t.NumberDto=class{constructor(t){this.number=1,void 0!==t&&(this.number=t)}},t.EaseDto=class{constructor(t){this.x=.5,this.min=0,this.max=1,void 0!==t&&(this.x=t)}},t.RoundToDecimalsDto=class{constructor(t,e){this.number=1.123456,this.decimalPlaces=2,void 0!==t&&(this.number=t),void 0!==e&&(this.decimalPlaces=e)}},t.ActionOnTwoNumbersDto=class{constructor(t,e,i){this.first=1,this.second=1,void 0!==t&&(this.first=t),void 0!==e&&(this.second=e),void 0!==i&&(this.operation=i)}},t.TwoNumbersDto=class{constructor(t,e){this.first=1,this.second=2,void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},t.ActionOnOneNumberDto=class{constructor(t,e){this.number=1,void 0!==t&&(this.number=t),void 0!==e&&(this.operation=e)}},t.RemapNumberDto=class{constructor(t,e,i,n,r){this.number=.5,this.fromLow=0,this.fromHigh=1,this.toLow=1,this.toHigh=2,void 0!==t&&(this.number=t),void 0!==e&&(this.fromLow=e),void 0!==i&&(this.fromHigh=i),void 0!==n&&(this.toLow=n),void 0!==r&&(this.toHigh=r)}},t.RandomNumberDto=class{constructor(t,e){this.low=0,this.high=1,void 0!==t&&(this.low=t),void 0!==e&&(this.high=e)}},t.RandomNumbersDto=class{constructor(t,e,i){this.low=0,this.high=1,this.count=10,void 0!==t&&(this.low=t),void 0!==e&&(this.high=e),void 0!==i&&(this.count=i)}},t.ToFixedDto=class{constructor(t,e){this.decimalPlaces=2,void 0!==t&&(this.number=t),void 0!==e&&(this.decimalPlaces=e)}}}(gv||(gv={})),(Dv=vv||(vv={})).PointDto=class{constructor(t){void 0!==t&&(this.point=t)}},Dv.PointXYZDto=class{constructor(t,e,i){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},Dv.PointXYDto=class{constructor(t,e){this.x=0,this.y=0,void 0!==t&&(this.x=t),void 0!==e&&(this.y=e)}},Dv.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},Dv.TwoPointsDto=class{constructor(t,e){void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e)}},Dv.DrawPointDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.size=3,this.colours="#444444",this.updatable=!1,void 0!==t&&(this.point=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.size=i),void 0!==n&&(this.colours=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.pointMesh=s)}},Dv.DrawPointsDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.size=.1,this.colours="#444444",this.updatable=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.size=i),void 0!==n&&(this.colours=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.pointsMesh=s)}},Dv.TransformPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.transformation=e)}},Dv.TransformPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.transformation=e)}},Dv.TranslatePointsWithVectorsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.translations=e)}},Dv.TranslatePointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.translation=e)}},Dv.TranslateXYZPointsDto=class{constructor(t,e,i,n){this.x=0,this.y=1,this.z=0,void 0!==t&&(this.points=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n)}},Dv.ScalePointsCenterXYZDto=class{constructor(t,e,i){this.center=[0,0,0],this.scaleXyz=[1,1,1],void 0!==t&&(this.points=t),void 0!==e&&(this.center=e),void 0!==i&&(this.scaleXyz=i)}},Dv.StretchPointsDirFromCenterDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.direction=[0,0,1],this.scale=2,void 0!==t&&(this.points=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i),void 0!==n&&(this.scale=n)}},Dv.RotatePointsCenterAxisDto=class{constructor(t,e,i,n){this.angle=90,this.axis=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.points=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.axis=i),void 0!==n&&(this.center=n)}},Dv.TransformsForPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.transformation=e)}},Dv.ThreePointsNormalDto=class{constructor(t,e,i,n){this.reverseNormal=!1,void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.point3=i),void 0!==n&&(this.reverseNormal=n)}},Dv.ThreePointsToleranceDto=class{constructor(t,e,i,n){this.tolerance=1e-7,void 0!==t&&(this.start=t),void 0!==e&&(this.center=e),void 0!==i&&(this.end=i),void 0!==n&&(this.tolerance=n)}},Dv.PointsMaxFilletsHalfLineDto=class{constructor(t,e,i){this.checkLastWithFirst=!1,this.tolerance=1e-7,void 0!==t&&(this.points=t),void 0!==e&&(this.checkLastWithFirst=e),void 0!==i&&(this.tolerance=i)}},Dv.RemoveConsecutiveDuplicatesDto=class{constructor(t,e,i){this.tolerance=1e-7,this.checkFirstAndLast=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.tolerance=e),void 0!==i&&(this.checkFirstAndLast=i)}},Dv.ClosestPointFromPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.point=e)}},Dv.TwoPointsToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.tolerance=i)}},Dv.StartEndPointsDto=class{constructor(t,e){void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoint=e)}},Dv.StartEndPointsListDto=class{constructor(t,e){void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoints=e)}},Dv.MultiplyPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.amountOfPoints=e)}},Dv.SpiralDto=class{constructor(t,e,i,n,r){this.phi=.9,this.numberPoints=200,this.widening=3,this.radius=6,this.factor=1,void 0!==t&&(this.radius=t),void 0!==e&&(this.numberPoints=e),void 0!==i&&(this.widening=i),void 0!==n&&(this.factor=n),void 0!==r&&(this.phi=r)}},Dv.HexGridScaledToFitDto=class{constructor(t,e,i,n,r,s){this.width=10,this.height=10,this.nrHexagonsInWidth=10,this.nrHexagonsInHeight=10,this.flatTop=!1,this.extendTop=!1,this.extendBottom=!1,this.extendLeft=!1,this.extendRight=!1,this.centerGrid=!1,this.pointsOnGround=!1,void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.nrHexagonsInHeight=i),void 0!==n&&(this.nrHexagonsInWidth=n),void 0!==r&&(this.centerGrid=r),void 0!==s&&(this.pointsOnGround=s)}},Dv.HexGridCentersDto=class{constructor(t,e,i,n,r){this.nrHexagonsY=21,this.nrHexagonsX=21,this.orientOnCenter=!1,this.pointsOnGround=!1,void 0!==t&&(this.nrHexagonsX=t),void 0!==e&&(this.nrHexagonsY=e),void 0!==i&&(this.radiusHexagon=i),void 0!==n&&(this.orientOnCenter=n),void 0!==r&&(this.pointsOnGround=r)}},function(t){t.TextDto=class{constructor(t){this.text="Hello World",void 0!==t&&(this.text=t)}},t.TextSplitDto=class{constructor(t,e){this.text="a,b,c",this.separator=",",void 0!==t&&(this.text=t),void 0!==e&&(this.separator=e)}},t.TextReplaceDto=class{constructor(t,e,i){this.text="a-c",this.search="-",this.replaceWith="b",void 0!==t&&(this.text=t),void 0!==e&&(this.search=e),void 0!==i&&(this.replaceWith=i)}},t.TextJoinDto=class{constructor(t,e){this.separator=",",void 0!==t&&(this.list=t),void 0!==e&&(this.separator=e)}},t.ToStringDto=class{constructor(t){void 0!==t&&(this.item=t)}},t.ToStringEachDto=class{constructor(t){void 0!==t&&(this.list=t)}},t.TextFormatDto=class{constructor(t,e){this.text="Hello {0}",this.values=["World"],void 0!==t&&(this.text=t),void 0!==e&&(this.values=e)}},t.VectorCharDto=class{constructor(t,e,i,n,r){this.char="A",this.xOffset=0,this.yOffset=0,this.height=1,this.extrudeOffset=0,void 0!==t&&(this.char=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==n&&(this.height=n),void 0!==r&&(this.extrudeOffset=r)}},t.VectorTextDto=class{constructor(t,e,i,n,r,s,o,a,c){this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=0,this.extrudeOffset=0,this.centerOnOrigin=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==n&&(this.height=n),void 0!==r&&(this.lineSpacing=r),void 0!==s&&(this.letterSpacing=s),void 0!==o&&(this.align=o),void 0!==a&&(this.extrudeOffset=a),void 0!==c&&(this.centerOnOrigin=c)}}}(_v||(_v={})),(Av=yv||(yv={})).RotationCenterAxisDto=class{constructor(t,e,i){this.angle=90,this.axis=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.angle=t),void 0!==e&&(this.axis=e),void 0!==i&&(this.center=i)}},Av.RotationCenterDto=class{constructor(t,e){this.angle=90,this.center=[0,0,0],void 0!==t&&(this.angle=t),void 0!==e&&(this.center=e)}},Av.RotationCenterYawPitchRollDto=class{constructor(t,e,i,n){this.yaw=0,this.pitch=0,this.roll=0,this.center=[0,0,0],void 0!==t&&(this.yaw=t),void 0!==e&&(this.pitch=e),void 0!==i&&(this.roll=i),void 0!==n&&(this.center=n)}},Av.ScaleXYZDto=class{constructor(t){this.scaleXyz=[1,1,1],void 0!==t&&(this.scaleXyz=t)}},Av.StretchDirCenterDto=class{constructor(t,e,i){this.center=[0,0,0],this.direction=[0,0,1],this.scale=2,void 0!==t&&(this.scale=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},Av.ScaleCenterXYZDto=class{constructor(t,e){this.center=[0,0,0],this.scaleXyz=[1,1,1],void 0!==t&&(this.center=t),void 0!==e&&(this.scaleXyz=e)}},Av.UniformScaleDto=class{constructor(t){this.scale=1,void 0!==t&&(this.scale=t)}},Av.UniformScaleFromCenterDto=class{constructor(t,e){this.scale=1,this.center=[0,0,0],void 0!==t&&(this.scale=t),void 0!==e&&(this.center=e)}},Av.TranslationXYZDto=class{constructor(t){this.translation=[0,0,0],void 0!==t&&(this.translation=t)}},Av.TranslationsXYZDto=class{constructor(t){void 0!==t&&(this.translations=t)}},function(t){t.DateDto=class{constructor(t){void 0!==t&&(this.date=t)}},t.DateStringDto=class{constructor(t){void 0!==t&&(this.dateString=t)}},t.DateSecondsDto=class{constructor(t,e){this.seconds=30,void 0!==t&&(this.date=t),void 0!==e&&(this.seconds=e)}},t.DateDayDto=class{constructor(t,e){this.day=1,void 0!==t&&(this.date=t),void 0!==e&&(this.day=e)}},t.DateYearDto=class{constructor(t,e){this.year=1,void 0!==t&&(this.date=t),void 0!==e&&(this.year=e)}},t.DateMonthDto=class{constructor(t,e){this.month=1,void 0!==t&&(this.date=t),void 0!==e&&(this.month=e)}},t.DateHoursDto=class{constructor(t,e){this.hours=1,void 0!==t&&(this.date=t),void 0!==e&&(this.hours=e)}},t.DateMinutesDto=class{constructor(t,e){this.minutes=1,void 0!==t&&(this.date=t),void 0!==e&&(this.minutes=e)}},t.DateMillisecondsDto=class{constructor(t,e){this.milliseconds=1,void 0!==t&&(this.date=t),void 0!==e&&(this.milliseconds=e)}},t.DateTimeDto=class{constructor(t,e){this.time=1,void 0!==t&&(this.date=t),void 0!==e&&(this.time=e)}},t.CreateFromUnixTimeStampDto=class{constructor(t){this.unixTimeStamp=1,void 0!==t&&(this.unixTimeStamp=t)}},t.CreateDateDto=class{constructor(t,e,i,n,r,s,o){this.year=1,this.month=1,this.day=1,this.hours=1,this.minutes=1,this.seconds=1,this.milliseconds=1,void 0!==t&&(this.year=t),void 0!==e&&(this.month=e),void 0!==i&&(this.day=i),void 0!==n&&(this.hours=n),void 0!==r&&(this.minutes=r),void 0!==s&&(this.seconds=s),void 0!==o&&(this.milliseconds=o)}}}(xv||(xv={})),(Pv=bv||(bv={})).LinePointsDto=class{constructor(t,e){void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},Pv.LineStartEndPointsDto=class{constructor(t,e){void 0!==t&&(this.startPoints=t),void 0!==e&&(this.endPoints=e)}},Pv.DrawLineDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.line=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.lineMesh=s)}},Pv.DrawLinesDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.lines=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.linesMesh=s)}},Pv.PointsLinesDto=class{constructor(t){void 0!==t&&(this.points=t)}},Pv.LineDto=class{constructor(t){void 0!==t&&(this.line=t)}},Pv.SegmentDto=class{constructor(t){void 0!==t&&(this.segment=t)}},Pv.SegmentsDto=class{constructor(t){void 0!==t&&(this.segments=t)}},Pv.LinesDto=class{constructor(t){void 0!==t&&(this.lines=t)}},Pv.LineLineIntersectionDto=class{constructor(t,e,i){this.checkSegmentsOnly=!0,void 0!==t&&(this.line1=t),void 0!==e&&(this.line2=e),void 0!==i&&(this.tolerance=i)}},Pv.PointOnLineDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.line=t),void 0!==e&&(this.param=e)}},Pv.TransformLineDto=class{constructor(t,e){void 0!==t&&(this.line=t),void 0!==e&&(this.transformation=e)}},Pv.TransformsLinesDto=class{constructor(t,e){void 0!==t&&(this.lines=t),void 0!==e&&(this.transformation=e)}},Pv.TransformLinesDto=class{constructor(t,e){void 0!==t&&(this.lines=t),void 0!==e&&(this.transformation=e)}},(Cv=Mv||(Mv={})).PolylineCreateDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},Cv.PolylinePropertiesDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},Cv.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},Cv.PolylinesDto=class{constructor(t){void 0!==t&&(this.polylines=t)}},Cv.TransformPolylineDto=class{constructor(t,e){void 0!==t&&(this.polyline=t),void 0!==e&&(this.transformation=e)}},Cv.DrawPolylineDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.polyline=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.polylineMesh=s)}},Cv.DrawPolylinesDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.polylines=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.polylinesMesh=s)}},Cv.SegmentsToleranceDto=class{constructor(t){this.tolerance=1e-5,void 0!==t&&(this.segments=t)}},Cv.PolylineToleranceDto=class{constructor(t,e){this.tolerance=1e-5,void 0!==t&&(this.polyline=t),void 0!==e&&(this.tolerance=e)}},Cv.TwoPolylinesToleranceDto=class{constructor(t,e,i){this.tolerance=1e-5,void 0!==t&&(this.polyline1=t),void 0!==e&&(this.polyline2=e),void 0!==i&&(this.tolerance=i)}},(Ev=Sv||(Sv={})).SignedDistanceFromPlaneToPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.plane=e)}},Ev.TriangleDto=class{constructor(t){void 0!==t&&(this.triangle=t)}},Ev.TriangleToleranceDto=class{constructor(t){this.tolerance=1e-7,void 0!==t&&(this.triangle=t)}},Ev.TriangleTriangleToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.triangle1=t),void 0!==e&&(this.triangle2=e),void 0!==i&&(this.tolerance=i)}},Ev.MeshMeshToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.mesh1=t),void 0!==e&&(this.mesh2=e),void 0!==i&&(this.tolerance=i)}},(Tv=wv||(wv={})).TwoVectorsDto=class{constructor(t,e){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},Tv.VectorBoolDto=class{constructor(t){void 0!==t&&(this.vector=t)}},Tv.RemoveAllDuplicateVectorsDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.vectors=t),void 0!==e&&(this.tolerance=e)}},Tv.RemoveConsecutiveDuplicateVectorsDto=class{constructor(t,e,i){this.checkFirstAndLast=!1,this.tolerance=1e-7,void 0!==t&&(this.vectors=t),void 0!==e&&(this.checkFirstAndLast=e),void 0!==i&&(this.tolerance=i)}},Tv.VectorsTheSameDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.vec1=t),void 0!==e&&(this.vec2=e),void 0!==i&&(this.tolerance=i)}},Tv.VectorDto=class{constructor(t){void 0!==t&&(this.vector=t)}},Tv.Vector3Dto=class{constructor(t){void 0!==t&&(this.vector=t)}},Tv.RangeMaxDto=class{constructor(t){void 0!==t&&(this.max=t)}},Tv.VectorXYZDto=class{constructor(t,e,i){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},Tv.VectorXYDto=class{constructor(t,e){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e)}},Tv.SpanDto=class{constructor(t,e,i){this.step=.1,this.min=0,this.max=1,void 0!==t&&(this.step=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},Tv.SpanEaseItemsDto=class{constructor(t,e,i,n){this.nrItems=100,this.min=0,this.max=1,this.ease=gv.easeEnum.easeInSine,this.intervals=!1,void 0!==t&&(this.nrItems=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i),void 0!==n&&(this.ease=n)}},Tv.SpanLinearItemsDto=class{constructor(t,e,i){this.nrItems=100,this.min=0,this.max=1,void 0!==t&&(this.nrItems=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},Tv.RayPointDto=class{constructor(t,e,i){void 0!==t&&(this.point=t),void 0!==e&&(this.distance=e),void 0!==i&&(this.vector=i)}},Tv.VectorsDto=class{constructor(t){void 0!==t&&(this.vectors=t)}},Tv.FractionTwoVectorsDto=class{constructor(t,e,i){this.fraction=.5,void 0!==t&&(this.fraction=t),void 0!==e&&(this.first=e),void 0!==i&&(this.second=i)}},Tv.VectorScalarDto=class{constructor(t,e){void 0!==t&&(this.scalar=t),void 0!==e&&(this.vector=e)}},Tv.TwoVectorsReferenceDto=class{constructor(t,e,i){void 0!==t&&(this.reference=t),void 0!==e&&(this.first=e),void 0!==i&&(this.second=i)}};class Uv{getItem(t){if(t.index<0||t.index>=t.list.length)throw new Error("Index out of bounds");let e;return e=t.clone?structuredClone(t.list[t.index]):t.list[t.index],e}randomGetThreshold(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let n=0;n<t.list.length;n++)Math.random()<t.threshold&&i.push(e[n]);return i}getSubList(t){let e;return e=t.clone?structuredClone(t.list.slice(t.indexStart,t.indexEnd)):t.list.slice(t.indexStart,t.indexEnd),e}getNthItem(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let n=0;n<e.length;n++)(n+t.offset)%t.nth==0&&i.push(e[n]);return i}getByPattern(t){const{list:e,pattern:i}=t;if(!i||0===i.length)throw new Error("Pattern is empty or does not exist");const n=i.length,r=e.length,s=[];if(n>=r)e.forEach(((t,e)=>{!0===i[e]&&s.push(t)}));else{const t=[],o=Math.ceil(r/n);for(let e=0;e<o;e++)t.push(...i);e.forEach(((e,i)=>{!0===t[i]&&s.push(e)}))}return s}mergeElementsOfLists(t){const e=t.lists,i=t.level,n=[],r=[];e.forEach((t=>{const e=t.flat(i);n.push(e)}));const s=this.getLongestListLength({lists:n});for(let t=0;t<s;t++){const e=[];for(let i=0;i<n.length;i++){const r=n[i][t];void 0!==r&&e.push(r)}e.length>0&&r.push(e)}let o=[];if(i>0)for(let t=0;t<i;t++)t===i-1&&0!==t?o[t-1].push(r):t===i-1?o.push(r):o.push([]);else o=r;return o}getLongestListLength(t){let e=0;return t.lists?(t.lists.forEach((t=>{t.length>e&&(e=t.length)})),e):void 0}reverse(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.reverse()}flipLists(t){if(t.list.length>0){const e=t.list[0].length;let i=!0;if(t.list.forEach((t=>{t.length!==e&&(i=!1)})),i){const i=[];for(let n=0;n<e;n++){const e=[];t.list.forEach((t=>{e.push(t[n])})),i.push(e)}return i}throw new Error("Lists are not of the same length")}throw new Error("List is empty")}groupNth(t){return(t=>{const{nrElements:e,list:i,keepRemainder:n}=t,r=e,s=[];let o=[];return i.forEach(((t,e)=>{o.push(t),(e+1)%r==0&&(s.push(o),o=[]),o.length>0&&n&&e===i.length-1&&s.push(o)})),s})(t)}getListDepth(t){let e=0,i=!0,n=t.list;for(;i;){let t=!1;for(let e=0;e<n.length;e++)Array.isArray(n[e])&&(t=!0);n=n.flat(),t?e++:(e++,i=!1)}return e}listLength(t){return t.list.length}addItemAtIndex(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.index>=0&&t.index<=e.length&&e.splice(t.index,0,t.item),e}addItemAtIndexes(t){let e=t.list;t.clone&&(e=structuredClone(t.list));let i=[...t.indexes];return i=i.filter((t=>t>=0&&t<=e.length)),i.sort(((t,e)=>t-e)),i.forEach(((i,n)=>{i>=0&&i+n<=e.length&&e.splice(i+n,0,t.item)})),e}addItemsAtIndexes(t){if(t.items.length!==t.indexes.length)throw new Error("Items and indexes must have the same length");for(let e=0;e<t.indexes.length;e++)if(e>0&&t.indexes[e-1]>t.indexes[e])throw new Error("Indexes must be in ascending order");let e=t.list;return t.clone&&(e=structuredClone(t.list)),[...t.indexes].forEach(((i,n)=>{i>=0&&i+n<=e.length&&e.splice(i+n,0,t.items[n])})),e}removeItemAtIndex(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.index>=0&&t.index<=e.length&&e.splice(t.index,1),e}removeItemsAtIndexes(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[...t.indexes];return i.sort(((t,e)=>e-t)),i.forEach((t=>{t>=0&&t<e.length&&e.splice(t,1)})),e}removeAllItems(t){return t.list.length=0,t.list}removeNthItem(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let n=0;n<e.length;n++)(n+t.offset)%t.nth!=0&&i.push(e[n]);return i}randomRemoveThreshold(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let n=0;n<t.list.length;n++)Math.random()>t.threshold&&i.push(e[n]);return i}removeDuplicateNumbers(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.filter(((t,e,i)=>i.indexOf(t)===e))}removeDuplicateNumbersTolerance(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.filter(((e,i,n)=>n.findIndex((i=>Math.abs(i-e)<t.tolerance))===i))}addItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.push(t.item),e}prependItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.unshift(t.item),e}addItemFirstLast(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.position===fv.firstLastEnum.first?e.unshift(t.item):e.push(t.item),e}createEmptyList(){return[]}repeat(t){const e=[];for(let i=0;i<t.times;i++)e.push(t.item);return e}repeatInPattern(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];let n=0,r=0;for(;n<t.lengthLimit;)i.push(e[r]),r++,r===e.length&&(r=0),n++;return i}sortNumber(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort(((t,e)=>t-e)):e.sort(((t,e)=>e-t))}sortTexts(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort():e.sort().reverse()}sortByPropValue(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort(((e,i)=>e[t.property]-i[t.property])):e.sort(((e,i)=>i[t.property]-e[t.property]))}}class Nv{boolean(t){return t.boolean}randomBooleans(t){const e=[];for(let i=0;i<t.length;i++)e.push(Math.random()<t.trueThreshold);return e}twoThresholdRandomGradient(t){const e=[];return t.numbers.forEach((i=>{if(i<t.thresholdTotalTrue)e.push(!0);else if(i>t.thresholdTotalFalse)e.push(!1);else{const n=i-t.thresholdTotalTrue,r=(t.thresholdTotalFalse-t.thresholdTotalTrue)/t.nrLevels,s=Math.ceil(n/r)/t.nrLevels;Math.random()>s?e.push(!0):e.push(!1)}})),e}thresholdBooleanList(t){const e=[];return t.numbers.forEach((i=>{i<t.threshold?e.push(!0):e.push(!1)})),t.inverse?e.map((t=>!t)):e}thresholdGapsBooleanList(t){const e=[];return t.numbers.forEach((i=>{let n=!1;t.gapThresholds.forEach((t=>{const r=t[0],s=t[1];i>=r&&i<=s&&(e.push(!0),n=!0)})),n||e.push(!1)})),t.inverse?e.map((t=>!t)):e}not(t){return!t.boolean}notList(t){return t.booleans.map((t=>!t))}compare(t){switch(t.operator){case"==":return t.first==t.second;case"!=":return t.first!=t.second;case"===":return t.first===t.second;case"!==":return t.first!==t.second;case"<":return t.first<t.second;case"<=":return t.first<=t.second;case">":return t.first>t.second;case">=":return t.first>=t.second;default:return!1}}valueGate(t){return t.boolean?t.value:void 0}firstDefinedValueGate(t){let e;return e=void 0!==t.value1?t.value1:void 0!==t.value2?t.value2:void 0,e}}class Wv{number(t){return t.number}twoNrOperation(t){let e;switch(t.operation){case gv.mathTwoNrOperatorEnum.add:e=t.first+t.second;break;case gv.mathTwoNrOperatorEnum.subtract:e=t.first-t.second;break;case gv.mathTwoNrOperatorEnum.multiply:e=t.first*t.second;break;case gv.mathTwoNrOperatorEnum.divide:e=t.first/t.second;break;case gv.mathTwoNrOperatorEnum.power:e=Math.pow(t.first,t.second);break;case gv.mathTwoNrOperatorEnum.modulus:e=t.first%t.second}return e}modulus(t){return this.twoNrOperation({first:t.number,second:t.modulus,operation:gv.mathTwoNrOperatorEnum.modulus})}roundToDecimals(t){return Math.round(t.number*Math.pow(10,t.decimalPlaces))/Math.pow(10,t.decimalPlaces)}oneNrOperation(t){let e;switch(t.operation){case gv.mathOneNrOperatorEnum.absolute:e=Math.abs(t.number);break;case gv.mathOneNrOperatorEnum.negate:e=-t.number;break;case gv.mathOneNrOperatorEnum.ln:e=Math.log(t.number);break;case gv.mathOneNrOperatorEnum.log10:e=Math.log10(t.number);break;case gv.mathOneNrOperatorEnum.tenPow:e=Math.pow(10,t.number);break;case gv.mathOneNrOperatorEnum.round:e=Math.round(t.number);break;case gv.mathOneNrOperatorEnum.floor:e=Math.floor(t.number);break;case gv.mathOneNrOperatorEnum.ceil:e=Math.ceil(t.number);break;case gv.mathOneNrOperatorEnum.sqrt:e=Math.sqrt(t.number);break;case gv.mathOneNrOperatorEnum.sin:e=Math.sin(t.number);break;case gv.mathOneNrOperatorEnum.cos:e=Math.cos(t.number);break;case gv.mathOneNrOperatorEnum.tan:e=Math.tan(t.number);break;case gv.mathOneNrOperatorEnum.asin:e=Math.asin(t.number);break;case gv.mathOneNrOperatorEnum.acos:e=Math.acos(t.number);break;case gv.mathOneNrOperatorEnum.atan:e=Math.atan(t.number);break;case gv.mathOneNrOperatorEnum.log:e=Math.log(t.number);break;case gv.mathOneNrOperatorEnum.exp:e=Math.exp(t.number);break;case gv.mathOneNrOperatorEnum.degToRad:e=t.number*Math.PI/180;break;case gv.mathOneNrOperatorEnum.radToDeg:e=180*t.number/Math.PI}return e}remap(t){return(t.number-t.fromLow)*(t.toHigh-t.toLow)/(t.fromHigh-t.fromLow)+t.toLow}random(){return Math.random()}randomNumber(t){return Math.random()*(t.high-t.low)+t.low}randomNumbers(t){const e=[];for(let i=0;i<t.count;i++)e.push(this.randomNumber(t));return e}pi(){return Math.PI}toFixed(t){return t.number.toFixed(t.decimalPlaces)}add(t){return t.first+t.second}subtract(t){return t.first-t.second}multiply(t){return t.first*t.second}divide(t){return t.first/t.second}power(t){return Math.pow(t.first,t.second)}sqrt(t){return Math.sqrt(t.number)}abs(t){return Math.abs(t.number)}round(t){return Math.round(t.number)}floor(t){return Math.floor(t.number)}ceil(t){return Math.ceil(t.number)}negate(t){return-t.number}ln(t){return Math.log(t.number)}log10(t){return Math.log10(t.number)}tenPow(t){return Math.pow(10,t.number)}sin(t){return Math.sin(t.number)}cos(t){return Math.cos(t.number)}tan(t){return Math.tan(t.number)}asin(t){return Math.asin(t.number)}acos(t){return Math.acos(t.number)}atan(t){return Math.atan(t.number)}exp(t){return Math.exp(t.number)}degToRad(t){return t.number*Math.PI/180}radToDeg(t){return 180*t.number/Math.PI}ease(t){const e=t.x,i=t.min,n=t.max,r=this[t.ease](e);return this.remap({number:r,fromLow:0,fromHigh:1,toLow:i,toHigh:n})}easeInSine(t){return 1-Math.cos(t*Math.PI/2)}easeOutSine(t){return Math.sin(t*Math.PI/2)}easeInOutSine(t){return-(Math.cos(Math.PI*t)-1)/2}easeInQuad(t){return t*t}easeOutQuad(t){return 1-(1-t)*(1-t)}easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}easeInCubic(t){return t*t*t}easeOutCubic(t){return 1-Math.pow(1-t,3)}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}easeInQuart(t){return t*t*t*t}easeOutQuart(t){return 1-Math.pow(1-t,4)}easeInOutQuart(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2}easeInQuint(t){return t*t*t*t*t}easeOutQuint(t){return 1-Math.pow(1-t,5)}easeInOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}easeInExpo(t){return 0===t?0:Math.pow(2,10*t-10)}easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}easeInOutExpo(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}easeInCirc(t){return 1-Math.sqrt(1-t*t)}easeOutCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}easeInOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}easeInBack(t){return 2.70158*t*t*t-1.70158*t*t}easeOutBack(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}easeInOutBack(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2}easeInElastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)}easeOutElastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}easeInOutElastic(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1}easeInBounce(t){return 1-this.easeOutBounce(1-t)}easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}easeInOutBounce(t){return t<.5?(1-this.easeOutBounce(1-2*t))/2:(1+this.easeOutBounce(2*t-1))/2}}class Fv{constructor(t,e,i,n){this.geometryHelper=t,this.transforms=e,this.vector=i,this.lists=n}transformPoint(t){const e=t.transformation;let i=[t.point];return i=this.geometryHelper.transformControlPoints(e,i),i[0]}transformPoints(t){return this.geometryHelper.transformControlPoints(t.transformation,t.points)}transformsForPoints(t){if(t.points.length!==t.transformation.length)throw new Error("You must provide equal nr of points and transformations");return t.points.map(((e,i)=>this.geometryHelper.transformControlPoints(t.transformation[i],[e])[0]))}translatePoints(t){const e=this.transforms.translationXYZ({translation:t.translation});return this.geometryHelper.transformControlPoints(e,t.points)}translatePointsWithVectors(t){if(t.points.length!==t.translations.length)throw new Error("You must provide equal nr of points and translations");const e=this.transforms.translationsXYZ({translations:t.translations});return t.points.map(((t,i)=>this.geometryHelper.transformControlPoints(e[i],[t])[0]))}translateXYZPoints(t){const e=this.transforms.translationXYZ({translation:[t.x,t.y,t.z]});return this.geometryHelper.transformControlPoints(e,t.points)}scalePointsCenterXYZ(t){const e=this.transforms.scaleCenterXYZ({center:t.center,scaleXyz:t.scaleXyz});return this.geometryHelper.transformControlPoints(e,t.points)}stretchPointsDirFromCenter(t){const e=this.transforms.stretchDirFromCenter({center:t.center,scale:t.scale,direction:t.direction});return this.geometryHelper.transformControlPoints(e,t.points)}rotatePointsCenterAxis(t){const e=this.transforms.rotationCenterAxis({center:t.center,axis:t.axis,angle:t.angle});return this.geometryHelper.transformControlPoints(e,t.points)}boundingBoxOfPoints(t){const e=[],i=[],n=[];t.points.forEach((t=>{e.push(t[0]),i.push(t[1]),n.push(t[2])}));const r=[Math.min(...e),Math.min(...i),Math.min(...n)],s=[Math.max(...e),Math.max(...i),Math.max(...n)];return{min:r,max:s,center:[(r[0]+s[0])/2,(r[1]+s[1])/2,(r[2]+s[2])/2],width:s[0]-r[0],height:s[1]-r[1],length:s[2]-r[2]}}closestPointFromPointsDistance(t){return this.closestPointFromPointData(t).distance}closestPointFromPointsIndex(t){return this.closestPointFromPointData(t).index}closestPointFromPoints(t){return this.closestPointFromPointData(t).point}distance(t){const e=t.endPoint[0]-t.startPoint[0],i=t.endPoint[1]-t.startPoint[1],n=t.endPoint[2]-t.startPoint[2];return Math.sqrt(e*e+i*i+n*n)}distancesToPoints(t){return t.endPoints.map((e=>this.distance({startPoint:t.startPoint,endPoint:e})))}multiplyPoint(t){const e=[];for(let i=0;i<t.amountOfPoints;i++)e.push([t.point[0],t.point[1],t.point[2]]);return e}getX(t){return t.point[0]}getY(t){return t.point[1]}getZ(t){return t.point[2]}averagePoint(t){const e=[],i=[],n=[];return t.points.forEach((t=>{e.push(t[0]),i.push(t[1]),n.push(t[2])})),[e.reduce(((t,e)=>t+e),0)/t.points.length,i.reduce(((t,e)=>t+e),0)/t.points.length,n.reduce(((t,e)=>t+e),0)/t.points.length]}pointXYZ(t){return[t.x,t.y,t.z]}pointXY(t){return[t.x,t.y]}spiral(t){const e=t.phi,i=Math.log(e)/(Math.PI/t.widening),n=[],r=t.radius/t.numberPoints;for(let e=0;e<t.radius;e+=r){const r=Math.log(e/t.factor)/i,s=e*Math.cos(r),o=e*Math.sin(r);n.push([s||0,o||0,0])}return n}hexGrid(t){const e=Math.sqrt(Math.pow(t.radiusHexagon,2)-Math.pow(t.radiusHexagon/2,2)),i=[];for(let n=0;n<t.nrHexagonsX;n++){const r=n*e*2;for(let n=0;n<t.nrHexagonsY;n++){const s=(t.radiusHexagon+t.radiusHexagon/2)*n,o=r+(n%2==0?0:e);i.push([o,s,0])}}if(t.orientOnCenter){const t=i[i.length-1][0]/2,e=i[i.length-1][1]/2;i.forEach(((n,r)=>{i[r]=[n[0]-t,n[1]-e,0]}))}return t.pointsOnGround&&i.forEach(((t,e)=>{i[e]=[t[0],0,t[1]]})),i}hexGridScaledToFit(t){var e,i,n,r;let s=t.width,o=t.height,a=t.nrHexagonsInHeight,c=t.nrHexagonsInWidth,l=null!==(e=t.extendTop)&&void 0!==e&&e,h=null!==(i=t.extendBottom)&&void 0!==i&&i,u=null!==(n=t.extendLeft)&&void 0!==n&&n,d=null!==(r=t.extendRight)&&void 0!==r&&r;const{flatTop:p=!1,centerGrid:f=!1,pointsOnGround:m=!1}=t;if(p){const e=s;s=t.height,o=e;const i=c;c=a,a=i;const n=l,r=h;l=u,h=d,u=r,d=n}if(s<=0||o<=0||c<1||a<1)return console.warn("Hex grid dimensions and counts must be positive."),{centers:[],hexagons:[],shortestDistEdge:void 0,longestDistEdge:void 0,maxFilletRadius:void 0};const g=this.hexGrid({radiusHexagon:1,nrHexagonsX:c,nrHexagonsY:a,orientOnCenter:!1,pointsOnGround:!1});if(0===g.length)return{centers:[],hexagons:[],shortestDistEdge:void 0,longestDistEdge:void 0,maxFilletRadius:void 0};const v=g.map((t=>this.getRegularHexagonVertices(t,1)));let _=1/0,y=-1/0,x=1/0,b=-1/0;for(const t of v)for(const e of t)e[0]<_&&(_=e[0]),e[0]>y&&(y=e[0]),e[1]<x&&(x=e[1]),e[1]>b&&(b=e[1]);const M=y-_,S=b-x,w=M>1e-9?s/M:1,T=S>1e-9?o/S:1;let E=g.map((t=>[(t[0]-_)*w,(t[1]-x)*T,0])),C=v.map((t=>t.map((t=>[(t[0]-_)*w,(t[1]-x)*T,0])))),P=1/0,A=-1/0,D=0;if(0!==C.length){const t=C[0];if(D=this.safestPointsMaxFilletHalfLine({points:t,checkLastWithFirst:!0,tolerance:1e-7}),t.forEach(((e,i)=>{const n=t[(i+1)%t.length],r=this.distance({startPoint:e,endPoint:n});r<P&&(P=r),r>A&&(A=r)})),l||h||u||d){const e=t[0],i=t[1],n=e[1]-i[1],r=i[0]-e[0];if(l&&!h){const t={center:[0,0,0],direction:[0,1,0],scale:o/(o-n)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}if(h&&!l){const t={center:[0,o,0],direction:[0,-1,0],scale:o/(o-n)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}if(l&&h){const t={center:[0,o/2,0],direction:[0,1,0],scale:o/(o-2*n)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}if(u&&!d){const t={center:[s,0,0],direction:[1,0,0],scale:s/(s-r)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}if(d&&!u){const t={center:[0,0,0],direction:[1,0,0],scale:s/(s-r)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}if(u&&d){const t={center:[s/2,0,0],direction:[1,0,0],scale:s/(s-2*r)};C=C.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=E,E=this.stretchPointsDirFromCenter(t)}}}if(p){E=this.rotatePointsCenterAxis({points:E,center:[s/2,o/2,0],axis:[0,0,1],angle:90}),C=C.map((t=>this.rotatePointsCenterAxis({points:t,center:[s/2,o/2,0],axis:[0,0,1],angle:90})));const t=this.vector.sub({first:[o/2,s/2,0],second:[s/2,o/2,0]});E=this.translatePoints({points:E,translation:t}),C=C.map((e=>this.translatePoints({points:e,translation:t})))}if(f){let t=s/2,e=o/2;p&&(t=o/2,e=s/2);for(let i=0;i<E.length;i++)E[i][0]-=t,E[i][1]-=e;for(let i=0;i<C.length;i++)for(let n=0;n<C[i].length;n++)C[i][n][0]-=t,C[i][n][1]-=e}if(m){for(let t=0;t<E.length;t++)E[t]=[E[t][0],0,E[t][1]];for(let t=0;t<C.length;t++)for(let e=0;e<C[t].length;e++)C[t][e]=[C[t][e][0],0,C[t][e][1]]}if(p){const e=this.lists.groupNth({list:C.reverse(),nrElements:t.nrHexagonsInWidth,keepRemainder:!0}),i=this.lists.flipLists({list:e});i.forEach((t=>t.reverse())),C=i.flat();const n=this.lists.groupNth({list:E.reverse(),nrElements:t.nrHexagonsInWidth,keepRemainder:!0}),r=this.lists.flipLists({list:n});r.forEach((t=>t.reverse())),E=r.flat()}return{centers:E,hexagons:C,shortestDistEdge:P,longestDistEdge:A,maxFilletRadius:D}}maxFilletRadius(t){const{start:e,center:i,end:n,tolerance:r=1e-7}=t,s=this.vector.sub({first:e,second:n}),o=this.vector.sub({first:i,second:n}),a=this.vector.length({vector:s}),c=this.vector.length({vector:o});if(a<r||c<r)return 0;const l=this.vector.normalized({vector:s}),h=this.vector.normalized({vector:o});if(!l||!h)return 0;const u=Math.max(-1,Math.min(1,this.vector.dot({first:l,second:h})));if(u>1-r)return 0;if(u<-1+r)return 0;const d=Math.acos(u),p=Math.tan(d/2);return p<r?0:Math.min(a,c)*p}maxFilletRadiusHalfLine(t){const{start:e,center:i,end:n,tolerance:r=1e-7}=t,s=this.vector.sub({first:e,second:n}),o=this.vector.sub({first:i,second:n}),a=this.vector.length({vector:s}),c=this.vector.length({vector:o});if(a<r||c<r)return 0;const l=this.vector.normalized({vector:s}),h=this.vector.normalized({vector:o});if(!l||!h)return 0;const u=Math.max(-1,Math.min(1,this.vector.dot({first:l,second:h})));if(u>1-r||u<-1+r)return 0;const d=Math.acos(u),p=Math.tan(d/2);return p<r?0:Math.min(a/2,c/2)*p}maxFilletsHalfLine(t){const{points:e,checkLastWithFirst:i=!1,tolerance:n=1e-7}=t,r=e.length,s=[];if(r<3)return s;for(let t=1;t<r-1;t++){const i=e[t-1],r=e[t],o={start:i,center:e[t+1],end:r,tolerance:n};s.push(this.maxFilletRadiusHalfLine(o))}if(i&&r>=3){const t=e[r-1],i=e[0],o={start:t,center:e[1],end:i,tolerance:n};s.push(this.maxFilletRadiusHalfLine(o));const a=e[r-2],c=e[r-1],l={start:a,center:e[0],end:c,tolerance:n};s.push(this.maxFilletRadiusHalfLine(l))}return s}safestPointsMaxFilletHalfLine(t){const e=this.maxFilletsHalfLine(t);if(0===e.length)return 0;const i=Math.min(...e);return Math.max(0,i)}removeConsecutiveDuplicates(t){return this.geometryHelper.removeConsecutivePointDuplicates(t.points,t.checkFirstAndLast,t.tolerance)}normalFromThreePoints(t){const e=t.point1,i=t.point2,n=t.point3;if(!e||!i||!n||3!==e.length||3!==i.length||3!==n.length)throw new Error("All points must be arrays of 3 numbers [x, y, z]");const r=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=n[0]-e[0],c=n[1]-e[1],l=n[2]-e[2];let h=s*l-o*c,u=o*a-r*l,d=r*c-s*a;if(0!==h||0!==u||0!==d)return t.reverseNormal&&(h=-h,u=-u,d=-d),this.vector.normalized({vector:[h,u,d]});console.warn("Points are collinear or coincident; cannot calculate a unique normal.")}closestPointFromPointData(t){let e,i,n=Number.MAX_SAFE_INTEGER;for(let r=0;r<t.points.length;r++){const s=t.points[r],o=this.distance({startPoint:t.point,endPoint:s});o<n&&(n=o,e=r,i=s)}return{index:e+1,distance:n,point:i}}twoPointsAlmostEqual(t){const e=t.point1,i=t.point2;return this.distance({startPoint:e,endPoint:i})<t.tolerance}sortPoints(t){return[...t.points].sort(((t,e)=>t[0]!==e[0]?t[0]-e[0]:t[1]!==e[1]?t[1]-e[1]:t[2]-e[2]))}getRegularHexagonVertices(t,e){const i=[],n=t[0],r=t[1],s=t[2],o=Math.PI/3;for(let t=0;t<6;t++){const a=o*t;i.push([n+e*Math.sin(a),r+e*Math.cos(a),s])}return i}}const Bv={xOffset:0,yOffset:0,input:"?",align:"left",font:{height:21,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]},height:21,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0};class zv{constructor(t){this.point=t}create(t){return t.text}split(t){return t.text.split(t.separator)}replaceAll(t){return t.text.split(t.search).join(t.replaceWith)}join(t){return t.list.join(t.separator)}toString(t){return t.item.toString()}toStringEach(t){return t.list.map((t=>t.toString()))}format(t){return t.text.replace(/{(\d+)}/g,((e,i)=>void 0!==t.values[i]?t.values[i]:e))}vectorChar(t){const{xOffset:e,yOffset:i,font:n,input:r,height:s,extrudeOffset:o}=this.vectorParamsChar(t);let a=r.charCodeAt(0);a&&n[a]||(a=63);const c=[].concat(n[a]),l=(s-o)/n.height,h=o/2,u=c.shift()*l,d=[];let p=[];for(let t=0,n=c.length;t<n;t+=2){const n=l*c[t]+e,r=l*c[t+1]+i+h;void 0===c[t]?(d.push(p),p=[],t--):p.push([n,0,r])}return p.length&&d.push(p),{width:u,height:s,paths:d}}vectorText(t){const{xOffset:e,yOffset:i,height:n,align:r,extrudeOffset:s,lineSpacing:o,letterSpacing:a}=Object.assign({},Bv,t),c=t.text;if("string"!=typeof c)throw new Error("text must be a string");const l=n*a;let h=0,u={width:0,height:0,chars:[]},d=[];const p=()=>{h=Math.max(h,u.width),u.chars.length&&d.push(u),u={width:0,height:0,chars:[]}};let f,m=e,g=i;const v=c.length;for(let t=0;t<v;t++){const i=c[t];if("\n"===i){p(),m=e,g-=n*o;continue}f=this.vectorChar({xOffset:m,yOffset:g,height:n,extrudeOffset:s,char:i});const r=f.width+l;m+=r,u.width+=r,u.height=Math.max(u.height,f.height)," "!==i&&(u.chars=u.chars.concat(f))}if(u.chars.length&&p(),d=d.map((t=>{const e=h-t.width;return r===dv.horizontalAlignEnum.right?this.translateLine({x:e},t):r===dv.horizontalAlignEnum.center?this.translateLine({x:e/2},t):t})),t.centerOnOrigin){const t=[];d.forEach((e=>{e.chars.forEach((e=>{e.paths.forEach((e=>{t.push(...e)}))}))}));const e=this.point.boundingBoxOfPoints({points:t});d.forEach((t=>{t.chars.forEach((t=>(t.paths=t.paths.map((t=>this.point.translatePoints({points:t,translation:[-e.center[0],-e.center[1],-e.center[2]]}))),t)))}))}return d}vectorParamsChar(t){const e=Object.assign({},Bv,t);return e.input=t.char||e.char,e}translateLine(t,e){const{x:i,y:n}=Object.assign({x:0,y:0},t);return e.chars=e.chars.map((t=>(t.paths=t.paths.map((t=>this.point.translatePoints({points:t,translation:[i,0,n]}))),t))),e}}class Vv{toDateString(t){return t.date.toDateString()}toISOString(t){return t.date.toISOString()}toJSON(t){return t.date.toJSON()}toString(t){return t.date.toString()}toTimeString(t){return t.date.toTimeString()}toUTCString(t){return t.date.toUTCString()}now(){return new Date(Date.now())}createDate(t){return new Date(t.year,t.month,t.day,t.hours,t.minutes,t.seconds,t.milliseconds)}createDateUTC(t){return new Date(Date.UTC(t.year,t.month,t.day,t.hours,t.minutes,t.seconds,t.milliseconds))}createFromUnixTimeStamp(t){return new Date(t.unixTimeStamp)}parseDate(t){return Date.parse(t.dateString)}getDayOfMonth(t){return t.date.getDate()}getWeekday(t){return t.date.getDay()}getYear(t){return t.date.getFullYear()}getMonth(t){return t.date.getMonth()}getHours(t){return t.date.getHours()}getMinutes(t){return t.date.getMinutes()}getSeconds(t){return t.date.getSeconds()}getMilliseconds(t){return t.date.getMilliseconds()}getTime(t){return t.date.getTime()}getUTCYear(t){return t.date.getUTCFullYear()}getUTCMonth(t){return t.date.getUTCMonth()}getUTCDay(t){return t.date.getUTCDate()}getUTCHours(t){return t.date.getUTCHours()}getUTCMinutes(t){return t.date.getUTCMinutes()}getUTCSeconds(t){return t.date.getUTCSeconds()}getUTCMilliseconds(t){return t.date.getUTCMilliseconds()}setYear(t){const e=new Date(t.date.getTime());return e.setFullYear(t.year),e}setMonth(t){const e=new Date(t.date.getTime());return e.setMonth(t.month),e}setDayOfMonth(t){const e=new Date(t.date.getTime());return e.setDate(t.day),e}setHours(t){const e=new Date(t.date.getTime());return e.setHours(t.hours),e}setMinutes(t){const e=new Date(t.date.getTime());return e.setMinutes(t.minutes),e}setSeconds(t){const e=new Date(t.date.getTime());return e.setSeconds(t.seconds),e}setMilliseconds(t){const e=new Date(t.date.getTime());return e.setMilliseconds(t.milliseconds),e}setTime(t){const e=new Date(t.date.getTime());return e.setTime(t.time),e}setUTCYear(t){const e=new Date(t.date.getTime());return e.setUTCFullYear(t.year),e}setUTCMonth(t){const e=new Date(t.date.getTime());return e.setUTCMonth(t.month),e}setUTCDay(t){const e=new Date(t.date.getTime());return e.setUTCDate(t.day),e}setUTCHours(t){const e=new Date(t.date.getTime());return e.setUTCHours(t.hours),e}setUTCMinutes(t){const e=new Date(t.date.getTime());return e.setUTCMinutes(t.minutes),e}setUTCSeconds(t){const e=new Date(t.date.getTime());return e.setUTCSeconds(t.seconds),e}setUTCMilliseconds(t){const e=new Date(t.date.getTime());return e.setUTCMilliseconds(t.milliseconds),e}}class Hv{constructor(t,e){this.math=t,this.geometryHelper=e}removeAllDuplicateVectors(t){return this.geometryHelper.removeAllDuplicateVectors(t.vectors,t.tolerance)}removeConsecutiveDuplicateVectors(t){return this.geometryHelper.removeConsecutiveVectorDuplicates(t.vectors,t.checkFirstAndLast,t.tolerance)}vectorsTheSame(t){return this.geometryHelper.vectorsTheSame(t.vec1,t.vec2,t.tolerance)}angleBetween(t){return this.math.radToDeg({number:Math.acos(this.dot({first:t.first,second:t.second})/(this.norm({vector:t.first})*this.norm({vector:t.second})))})}angleBetweenNormalized2d(t){const e=t.first[0]*t.second[1]-t.first[1]*t.second[0];return this.math.radToDeg({number:Math.atan2(e,this.dot({first:t.first,second:t.second}))})}positiveAngleBetween(t){const e=this.signedAngleBetween(t);return e<0?360+e:e}addAll(t){const e=[];for(let i=0;i<t.vectors[0].length;i++){let n=0;for(const e of t.vectors)n+=e[i];e.push(n)}return e}add(t){const e=[];for(let i=0;i<t.first.length;i++)e.push(t.first[i]+t.second[i]);return e}all(t){return t.vector.every((t=>t))}cross(t){const e=[];return e.push(t.first[1]*t.second[2]-t.first[2]*t.second[1]),e.push(t.first[2]*t.second[0]-t.first[0]*t.second[2]),e.push(t.first[0]*t.second[1]-t.first[1]*t.second[0]),e}distSquared(t){let e=0;for(let i=0;i<t.first.length;i++)e+=Math.pow(t.first[i]-t.second[i],2);return e}dist(t){return Math.sqrt(this.distSquared(t))}div(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(t.vector[i]/t.scalar);return e}domain(t){return t.vector[t.vector.length-1]-t.vector[0]}dot(t){let e=0;for(let i=0;i<t.first.length;i++)e+=t.first[i]*t.second[i];return e}finite(t){return t.vector.map((t=>isFinite(t)))}isZero(t){return 0===this.norm({vector:t.vector})}lerp(t){return this.add({first:this.mul({vector:t.first,scalar:t.fraction}),second:this.mul({vector:t.second,scalar:1-t.fraction})})}max(t){return Math.max(...t.vector)}min(t){return Math.min(...t.vector)}mul(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(t.vector[i]*t.scalar);return e}neg(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(-t.vector[i]);return e}normSquared(t){return this.dot({first:t.vector,second:t.vector})}norm(t){const e=this.normSquared(t);return 0!==e?Math.sqrt(e):e}normalized(t){if(!(this.length({vector:t.vector})<=1e-8))return this.div({scalar:this.norm(t),vector:t.vector})}onRay(t){return this.add({first:t.point,second:this.mul({vector:t.vector,scalar:t.distance})})}vectorXYZ(t){return[t.x,t.y,t.z]}vectorXY(t){return[t.x,t.y]}range(t){const e=[];for(let i=0;i<t.max;i++)e.push(i);return e}signedAngleBetween(t){const e=this.cross({first:t.first,second:t.second}),i=this.norm({vector:t.first})*this.norm({vector:t.second}),n=this.dot({first:t.first,second:t.second}),r=this.norm({vector:e})/i,s=n/i,o=Math.atan2(r,s),a=this.dot({first:t.reference,second:e})>0?o:2*Math.PI-o;return this.math.radToDeg({number:a})}span(t){const e=[];for(let i=t.min;i<=t.max;i+=t.step)e.push(i);return e}spanEaseItems(t){const e=[];for(let i=0;i<t.nrItems;i++){const n=1*i/(t.nrItems-1);e.push(this.math.ease({x:n,ease:t.ease,min:t.min,max:t.max}))}return t.intervals?e.map(((t,e,i)=>0===e?t:t-i[e-1])):e}spanLinearItems(t){const e=[],i=t.max-t.min;for(let n=0;n<t.nrItems;n++){const r=i*n/(t.nrItems-1);e.push(r+t.min)}return e}sub(t){const e=[];for(let i=0;i<t.first.length;i++)e.push(t.first[i]-t.second[i]);return e}sum(t){return t.vector.reduce(((t,e)=>t+e),0)}lengthSq(t){const e=t.vector;return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}length(t){return Math.sqrt(this.lengthSq(t))}}class Gv{constructor(t,e){this.vector=t,this.math=e}rotationCenterAxis(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationAxis(t.axis,this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterX(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationX(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterY(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationY(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterZ(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationZ(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterYawPitchRoll(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationYawPitchRoll(this.math.degToRad({number:t.yaw}),this.math.degToRad({number:t.pitch}),this.math.degToRad({number:t.roll})),this.translation(t.center[0],t.center[1],t.center[2])]}scaleCenterXYZ(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.scaling(t.scaleXyz[0],t.scaleXyz[1],t.scaleXyz[2]),this.translation(t.center[0],t.center[1],t.center[2])]}scaleXYZ(t){return[this.scaling(t.scaleXyz[0],t.scaleXyz[1],t.scaleXyz[2])]}stretchDirFromCenter(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.stretchDirection(t.direction,t.scale),this.translation(t.center[0],t.center[1],t.center[2])]}uniformScale(t){return[this.scaling(t.scale,t.scale,t.scale)]}uniformScaleFromCenter(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.scaling(t.scale,t.scale,t.scale),this.translation(t.center[0],t.center[1],t.center[2])]}translationXYZ(t){return[this.translation(t.translation[0],t.translation[1],t.translation[2])]}translationsXYZ(t){return t.translations.map((t=>[this.translation(t[0],t[1],t[2])]))}identity(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}translation(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}scaling(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}rotationAxis(t,e){const i=Math.sin(-e),n=Math.cos(-e),r=1-n,s=this.vector.normalized({vector:t}),o=s[0],a=s[1],c=s[2],l=this.identity();return l[0]=o*o*r+n,l[1]=o*a*r-c*i,l[2]=o*c*r+a*i,l[3]=0,l[4]=a*o*r+c*i,l[5]=a*a*r+n,l[6]=a*c*r-o*i,l[7]=0,l[8]=c*o*r-a*i,l[9]=c*a*r+o*i,l[10]=c*c*r+n,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}rotationX(t){const e=Math.sin(t),i=Math.cos(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]}rotationY(t){const e=Math.sin(t),i=Math.cos(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]}rotationZ(t){const e=Math.sin(t),i=Math.cos(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]}rotationYawPitchRoll(t,e,i){const n=.5*i,r=.5*e,s=.5*t,o=Math.sin(n),a=Math.cos(n),c=Math.sin(r),l=Math.cos(r),h=Math.sin(s),u=Math.cos(s),d=u*c*a+h*l*o,p=h*l*a-u*c*o,f=u*l*o-h*c*a,m=u*l*a+h*c*o;return this.rotationMatrixFromQuat(d,p,f,m)}rotationMatrixFromQuat(t,e,i,n){const r=t*t,s=e*e,o=i*i,a=t*e,c=i*n,l=i*t,h=e*n,u=e*i,d=t*n,p=this.identity();return p[0]=1-2*(s+o),p[1]=2*(a+c),p[2]=2*(l-h),p[3]=0,p[4]=2*(a-c),p[5]=1-2*(o+r),p[6]=2*(u+d),p[7]=0,p[8]=2*(l+h),p[9]=2*(u-d),p[10]=1-2*(s+r),p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}stretchDirection(t,e){const i=this.vector.normalized({vector:t}),[n,r,s]=i;if(isNaN(n)||0===n&&0===r&&0===s)return console.warn("Stretch direction vector is zero or invalid. Returning identity matrix."),this.identity();const o=e-1;return[1+o*n*n,o*r*n,o*s*n,0,o*n*r,1+o*r*r,o*s*r,0,o*n*s,o*r*s,1+o*s*s,0,0,0,0,1]}}class jv{constructor(){this.getArrayDepth=t=>Array.isArray(t)?1+Math.max(...t.map(this.getArrayDepth)):0}transformControlPoints(t,e){return this.getFlatTransformations(t).forEach((t=>{e=this.transformPointsByMatrixArray(e,t)})),e}getFlatTransformations(t){let e=[];return 3===this.getArrayDepth(t)?t.forEach((t=>{e.push(...t)})):e=t,e}transformPointsByMatrixArray(t,e){return this.transformPointsCoordinates(t,e)}transformPointsCoordinates(t,e){const i=[];for(const n of t){const t=this.transformCoordinates(n[0],n[1],n[2],e);i.push(t)}return i}removeAllDuplicateVectors(t,e=1e-7){const i=[];return t.forEach((t=>{i.some((i=>this.vectorsTheSame(t,i,e)))||i.push(t)})),i}removeConsecutiveVectorDuplicates(t,e=!0,i=1e-7){const n=[];if(t.length>1){for(let e=1;e<t.length;e++){const r=t[e],s=t[e-1];this.vectorsTheSame(r,s,i)||n.push(s),e===t.length-1&&n.push(r)}if(e){const t=n[0],e=n[n.length-1];this.vectorsTheSame(t,e,i)&&n.pop()}}else 1===t.length&&n.push(...t);return n}vectorsTheSame(t,e,i){let n=!1;if(t.length!==e.length)return n;n=!0;for(let r=0;r<t.length;r++)if(!this.approxEq(t[r],e[r],i)){n=!1;break}return n}approxEq(t,e,i){return Math.abs(t-e)<i}removeConsecutivePointDuplicates(t,e=!0,i=1e-7){const n=[];if(t.length>1){for(let e=1;e<t.length;e++){const r=t[e],s=t[e-1];this.arePointsTheSame(r,s,i)||n.push(s),e===t.length-1&&n.push(r)}if(e){const t=n[0],e=n[n.length-1];this.arePointsTheSame(t,e,i)&&n.pop()}}else 1===t.length&&n.push(...t);return n}arePointsTheSame(t,e,i){let n=!1;return 2===t.length&&2===e.length?this.approxEq(t[0],e[0],i)&&this.approxEq(t[1],e[1],i)&&(n=!0):3===t.length&&3===e.length&&this.approxEq(t[0],e[0],i)&&this.approxEq(t[1],e[1],i)&&this.approxEq(t[2],e[2],i)&&(n=!0),n}transformCoordinates(t,e,i,n){const r=n,s=t*r[0]+e*r[4]+i*r[8]+r[12],o=t*r[1]+e*r[5]+i*r[9]+r[13],a=t*r[2]+e*r[6]+i*r[10]+r[14],c=1/(t*r[3]+e*r[7]+i*r[11]+r[15]);return[s*c,o*c,a*c]}}class Xv{constructor(t,e,i){this.vector=t,this.point=e,this.geometryHelper=i}getStartPoint(t){return t.line.start}getEndPoint(t){return t.line.end}length(t){return this.point.distance({startPoint:t.line.start,endPoint:t.line.end})}reverse(t){return{start:t.line.end,end:t.line.start}}transformLine(t){const e=t.transformation;let i=[t.line.start,t.line.end];return i=this.geometryHelper.transformControlPoints(e,i),{start:i[0],end:i[1]}}transformsForLines(t){return t.lines.map(((e,i)=>{const n=t.transformation[i];let r=[e.start,e.end];return r=this.geometryHelper.transformControlPoints(n,r),{start:r[0],end:r[1]}}))}create(t){return{start:t.start,end:t.end}}getPointOnLine(t){const e=t.line.start,i=t.line.end,n=t.param,r=[i[0]-e[0],i[1]-e[1],i[2]-e[2]];return[e[0]+n*r[0],e[1]+n*r[1],e[2]+n*r[2]]}linesBetweenPoints(t){const e=[];for(let i=1;i<t.points.length;i++){const n=t.points[i-1],r=t.points[i];e.push({start:n,end:r})}return e}linesBetweenStartAndEndPoints(t){return t.startPoints.map(((e,i)=>({start:e,end:t.endPoints[i]}))).filter((t=>0!==this.point.distance({startPoint:t.start,endPoint:t.end})))}lineToSegment(t){return[t.line.start,t.line.end]}linesToSegments(t){return t.lines.map((t=>[t.start,t.end]))}segmentToLine(t){return{start:t.segment[0],end:t.segment[1]}}segmentsToLines(t){return t.segments.map((t=>({start:t[0],end:t[1]})))}lineLineIntersection(t){const e=t.tolerance||1e-6,i=t.checkSegmentsOnly,n=t.line1,r=t.line2;if(!((null==n?void 0:n.start)&&n.end&&(null==r?void 0:r.start)&&r.end&&3===n.start.length&&3===n.end.length&&3===r.start.length&&3===r.end.length))return void console.error("Invalid line input to lineLineIntersection");const s=n.start,o=this.vector.sub({first:n.end,second:n.start}),a=r.start,c=this.vector.sub({first:r.end,second:r.start}),l=this.vector.sub({first:a,second:s}),h=this.vector.lengthSq({vector:o}),u=this.vector.lengthSq({vector:c});if(h<e*e||u<e*e)return;const d=this.vector.cross({first:o,second:c});if(this.vector.lengthSq({vector:d})<e*e){const t=this.vector.cross({first:l,second:o}),n=e*e*h;if(this.vector.lengthSq({vector:t})<n){if(i){const t=h<e*e?1:h,i=this.vector.dot({first:o,second:l})/t,n=this.vector.sub({first:r.end,second:s}),a=this.vector.dot({first:o,second:n})/t,c=[Math.min(i,a),Math.max(i,a)],u=[0,1];return Math.max(u[0],c[0]),void Math.min(u[1],c[1])}return s}return}const p=this.vector.dot({first:l,second:d}),f=e*e*e;if(Math.abs(p)>f)return;const m=h,g=u,v=this.vector.dot({first:o,second:c}),_=this.vector.dot({first:o,second:l}),y=this.vector.dot({first:c,second:l}),x=m*g-v*v;if(Math.abs(x)<e*e)return void console.error("Internal error: Denominator near zero after non-parallel check.");const b=(g*_-v*y)/x,M=(v*_-m*y)/x;if(i&&(b<-e||b>1+e||M<-e||M>1+e))return;const S=this.getPointOnLine({param:b,line:n});return[Math.abs(S[0])<e?0:S[0],Math.abs(S[1])<e?0:S[1],Math.abs(S[2])<e?0:S[2]]}}class qv{constructor(t,e,i,n){this.vector=t,this.point=e,this.line=i,this.geometryHelper=n}length(t){let e=0;for(let i=1;i<t.polyline.points.length;i++){const n=t.polyline.points[i-1],r=t.polyline.points[i];e+=this.point.distance({startPoint:n,endPoint:r})}return e}countPoints(t){return t.polyline.points.length}getPoints(t){return t.polyline.points}reverse(t){return{points:t.polyline.points.reverse()}}transformPolyline(t){const e=t.transformation;let i=t.polyline.points;return i=this.geometryHelper.transformControlPoints(e,i),{points:i}}create(t){return{points:t.points}}polylineToLines(t){return this.polylineToSegments(t).map((t=>({start:t[0],end:t[1]})))}polylineToSegments(t){const e=t.polyline,i=[],n=e.points,r=n.length;if(r<2)return i;for(let t=0;t<r-1;t++)i.push([n[t],n[t+1]]);return e.isClosed&&r>=2&&(this.point.twoPointsAlmostEqual({point1:n[r-1],point2:n[0],tolerance:1e-9})||i.push([n[r-1],n[0]])),i}polylineSelfIntersection(t){const{polyline:e,tolerance:i}=t,n=this.polylineToLines({polyline:e}),r=n.length;if(r<3)return[];const s=[],o=null!=i?i:1e-6;for(let t=0;t<r;t++)for(let i=t+1;i<r;i++){let a=i===t+1;if(!a&&e.isClosed&&0===t&&i===r-1&&(a=!0),a)continue;const c=this.line.lineLineIntersection({line1:n[t],line2:n[i],checkSegmentsOnly:!0,tolerance:o});if(c){let t=!1;for(const e of s)if(this.point.twoPointsAlmostEqual({point1:c,point2:e,tolerance:o})){t=!0;break}t||s.push(c)}}return s}twoPolylineIntersection(t){const{polyline1:e,polyline2:i,tolerance:n}=t,r=this.polylineToLines({polyline:e}),s=this.polylineToLines({polyline:i}),o=[],a=null!=n?n:1e-6;for(const t of r)for(const e of s){const i=this.line.lineLineIntersection({line1:t,line2:e,checkSegmentsOnly:!0,tolerance:a});if(i){let t=!1;for(const e of o)if(this.point.twoPointsAlmostEqual({point1:i,point2:e,tolerance:a})){t=!0;break}t||o.push(i)}}return o}sortSegmentsIntoPolylines(t){var e;const i=null!==(e=t.tolerance)&&void 0!==e?e:1e-5,n=t.segments;if(!n||0===n.length)return[];const r=i*i,s=n.length,o=new Array(s).fill(!1),a=[],c=new Map,l=1/i,h=t=>`${Math.round(t[0]*l)},${Math.round(t[1]*l)},${Math.round(t[2]*l)}`;for(let t=0;t<s;t++){const e=n[t];if(this.point.twoPointsAlmostEqual({point1:e[0],point2:e[1],tolerance:i})){o[t]=!0;continue}const r=h(e[0]),s=h(e[1]),a={segmentIndex:t,endpointIndex:0,coords:e[0]},l={segmentIndex:t,endpointIndex:1,coords:e[1]};c.has(r)||c.set(r,[]),c.get(r).push(a),s!==r?(c.has(s)||c.set(s,[]),c.get(s).push(l)):c.get(r).push(l)}const u=t=>{const e=[],n=Math.round(t[0]*l),s=Math.round(t[1]*l),a=Math.round(t[2]*l);for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++)e.push(`${n+t},${s+i},${a+r}`);let h,u=r;for(const n of e){const e=c.get(n);if(e)for(const n of e)if(!o[n.segmentIndex]){const e=this.vector.sub({first:n.coords,second:t}),r=this.vector.lengthSq({vector:e});r<u&&this.point.twoPointsAlmostEqual({point1:n.coords,point2:t,tolerance:i})&&(h=n,u=r)}}if(h&&!o[h.segmentIndex])return h};for(let t=0;t<s;t++){if(o[t])continue;o[t]=!0;const e=n[t],r=[e[0],e[1]];let c=e[0],l=e[1],h=!1,d=0;for(;d++<s;){const t=u(l);if(!t)break;const e=n[t.segmentIndex],s=0===t.endpointIndex?e[1]:e[0];if(this.point.twoPointsAlmostEqual({point1:s,point2:c,tolerance:i})){h=!0,o[t.segmentIndex]=!0;break}o[t.segmentIndex]=!0,r.push(s),l=s}if(d=0,!h)for(;d++<s;){const t=u(c);if(!t)break;const e=n[t.segmentIndex],s=0===t.endpointIndex?e[1]:e[0];if(this.point.twoPointsAlmostEqual({point1:s,point2:l,tolerance:i})){h=!0,o[t.segmentIndex]=!0;break}o[t.segmentIndex]=!0,r.unshift(s),c=s}!h&&r.length>=2&&(h=this.point.twoPointsAlmostEqual({point1:c,point2:l,tolerance:i})),h&&r.length>2&&this.point.twoPointsAlmostEqual({point1:r[r.length-1],point2:r[0],tolerance:i})&&r.pop(),a.push({points:r,isClosed:h})}return a}maxFilletsHalfLine(t){return this.point.maxFilletsHalfLine({points:t.polyline.points,checkLastWithFirst:t.polyline.isClosed,tolerance:t.tolerance})}safestFilletRadius(t){const e=this.maxFilletsHalfLine(t);if(0===e.length)return 0;const i=Math.min(...e);return Math.max(0,i)}}class Yv{constructor(t,e){this.vector=t,this.polyline=e}signedDistanceToPlane(t){return this.vector.dot({first:t.plane.normal,second:t.point})-t.plane.d}calculateTrianglePlane(t){const e=Math.pow(t.tolerance||1e-7,2),i=this.vector.sub({first:t.triangle[1],second:t.triangle[0]}),n=this.vector.sub({first:t.triangle[2],second:t.triangle[0]}),r=this.vector.cross({first:i,second:n});if(this.vector.lengthSq({vector:r})<e)return;const s=this.vector.normalized({vector:r});return{normal:s,d:this.vector.dot({first:s,second:t.triangle[0]})}}triangleTriangleIntersection(t){const e=t.triangle1,i=t.triangle2,n=t.tolerance||1e-7,r=e[0],s=e[1],o=e[2],a=i[0],c=i[1],l=i[2],h=this.calculateTrianglePlane({triangle:e,tolerance:n}),u=this.calculateTrianglePlane({triangle:i,tolerance:n});if(!h||!u)return;const d=[this.signedDistanceToPlane({point:a,plane:h}),this.signedDistanceToPlane({point:c,plane:h}),this.signedDistanceToPlane({point:l,plane:h})];if(d[0]>n&&d[1]>n&&d[2]>n||d[0]<-n&&d[1]<-n&&d[2]<-n)return;const p=[this.signedDistanceToPlane({point:r,plane:u}),this.signedDistanceToPlane({point:s,plane:u}),this.signedDistanceToPlane({point:o,plane:u})];if(p[0]>n&&p[1]>n&&p[2]>n||p[0]<-n&&p[1]<-n&&p[2]<-n)return;const f=p.every((t=>Math.abs(t)<n)),m=d.every((t=>Math.abs(t)<n));if(f&&m)return;const g=this.vector.cross({first:h.normal,second:u.normal}),v=this.vector.dot({first:g,second:g});if(v<n*n)return;const _=[],y=[],x=[[r,s],[s,o],[o,r]],b=p;for(let t=0;t<3;++t){const e=x[t][0],i=x[t][1],r=b[t],s=b[(t+1)%3];if(Math.abs(r)<n&&_.push(e),r*s<0&&Math.abs(r-s)>n){const t=r/(r-s);_.push(this.computeIntersectionPoint(e,i,t))}}const M=[[a,c],[c,l],[l,a]],S=d;for(let t=0;t<3;++t){const e=M[t][0],i=M[t][1],r=S[t],s=S[(t+1)%3];if(Math.abs(r)<n&&y.push(e),r*s<0&&Math.abs(r-s)>n){const t=r/(r-s);y.push(this.computeIntersectionPoint(e,i,t))}}if(_.length<2||y.length<2)return;const w=h.normal,T=u.normal,E=h.d,C=u.d,P=this.vector.mul({vector:T,scalar:E}),A=this.vector.mul({vector:w,scalar:C}),D=this.vector.sub({first:P,second:A}),R=this.vector.cross({first:D,second:g}),k=this.vector.mul({vector:R,scalar:1/v}),I=_.map((t=>this.vector.dot({first:this.vector.sub({first:t,second:k}),second:g}))),O=y.map((t=>this.vector.dot({first:this.vector.sub({first:t,second:k}),second:g}))),L=[Math.min(...I),Math.max(...I)],U=[Math.min(...O),Math.max(...O)],N=Math.max(L[0],U[0]),W=Math.min(L[1],U[1]);if(N<W-n*v){const t=this.vector.add({first:k,second:this.vector.mul({vector:g,scalar:N/v})}),e=this.vector.add({first:k,second:this.vector.mul({vector:g,scalar:W/v})}),i=this.vector.sub({first:t,second:e});return this.vector.lengthSq({vector:i})>n*n?[t,e]:void 0}}meshMeshIntersectionSegments(t){const e=t.mesh1,i=t.mesh2,n=[];for(let r=0;r<e.length;++r)for(let s=0;s<i.length;++s){const o=e[r],a=i[s],c=this.triangleTriangleIntersection({triangle1:o,triangle2:a,tolerance:t.tolerance});c&&n.push(c)}return n}meshMeshIntersectionPolylines(t){const e=this.meshMeshIntersectionSegments(t);return this.polyline.sortSegmentsIntoPolylines({segments:e,tolerance:t.tolerance})}meshMeshIntersectionPoints(t){return this.meshMeshIntersectionPolylines(t).map((t=>t.isClosed?[...t.points,t.points[0]]:t.points))}computeIntersectionPoint(t,e,i){return this.vector.add({first:t,second:this.vector.mul({vector:this.vector.sub({first:e,second:t}),scalar:i})})}}var Zv,Kv,Jv,$v,Qv,t_,e_;"undefined"!=typeof document&&document.currentScript&&document.currentScript.src,function(t){t.GetAssetDto=class{constructor(t){void 0!==t&&(this.fileName=t)}},t.FetchDto=class{constructor(t){void 0!==t&&(this.url=t)}},t.FileDto=class{constructor(t){void 0!==t&&(this.file=t)}},t.FilesDto=class{constructor(t){void 0!==t&&(this.files=t)}},t.AssetFileDto=class{constructor(t,e){this.hidden=!1,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.hidden=e)}},t.AssetFileByUrlDto=class{constructor(t,e,i){this.hidden=!1,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.rootUrl=e),void 0!==i&&(this.hidden=i)}}}(Zv||(Zv={})),function(t){t.StringifyDto=class{constructor(t){void 0!==t&&(this.json=t)}},t.ParseDto=class{constructor(t){this.text="[0, 0, 0]",void 0!==t&&(this.text=t)}},t.QueryDto=class{constructor(t,e){void 0!==t&&(this.json=t),void 0!==e&&(this.query=e)}},t.SetValueOnPropDto=class{constructor(t,e,i){this.property="propName",void 0!==t&&(this.json=t),void 0!==e&&(this.value=e),void 0!==i&&(this.property=i)}},t.GetJsonFromArrayByFirstPropMatchDto=class{constructor(t,e,i){this.property="propName",void 0!==t&&(this.jsonArray=t),void 0!==e&&(this.property=e),void 0!==i&&(this.match=i)}},t.GetValueOnPropDto=class{constructor(t,e){this.property="propName",void 0!==t&&(this.json=t),void 0!==e&&(this.property=e)}},t.SetValueDto=class{constructor(t,e,i,n){this.path="$.pathToParent",this.prop="propertyName",void 0!==t&&(this.json=t),void 0!==e&&(this.value=e),void 0!==i&&(this.path=i),void 0!==n&&(this.prop=n)}},t.SetValuesOnPathsDto=class{constructor(t,e,i,n){void 0!==t&&(this.json=t),void 0!==e&&(this.values=e),void 0!==i&&(this.paths=i),void 0!==n&&(this.props=n)}},t.PathsDto=class{constructor(t,e){void 0!==t&&(this.json=t),void 0!==e&&(this.query=e)}},t.JsonDto=class{constructor(t){void 0!==t&&(this.json=t)}}}(Kv||(Kv={})),function(t){t.DrawTagDto=class{constructor(t,e,i){this.updatable=!1,void 0!==t&&(this.tag=t),void 0!==e&&(this.updatable=e),void 0!==i&&(this.tagVariable=i)}},t.DrawTagsDto=class{constructor(t,e,i){this.updatable=!1,void 0!==t&&(this.tags=t),void 0!==e&&(this.updatable=e),void 0!==i&&(this.tagsVariable=i)}},t.TagDto=class{constructor(t,e,i,n,r,s,o){this.position=[0,0,0],this.colour="#444444",this.size=12,this.adaptDepth=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.position=e),void 0!==i&&(this.colour=i),void 0!==n&&(this.size=n),void 0!==r&&(this.adaptDepth=r),void 0!==s&&(this.needsUpdate=s),void 0!==o&&(this.id=o)}}}(Jv||(Jv={})),function(t){t.PostFromIframe=class{constructor(t,e){void 0!==t&&(this.data=t),void 0!==e&&(this.targetOrigin=e)}}}($v||($v={})),function(t){t.CurveDto=class{constructor(t){void 0!==t&&(this.curve=t)}},t.LineDto=class{constructor(t){void 0!==t&&(this.line=t)}},t.LinesDto=class{constructor(t){void 0!==t&&(this.lines=t)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},t.PolylinesDto=class{constructor(t){void 0!==t&&(this.polylines=t)}},t.CurvesDto=class{constructor(t){void 0!==t&&(this.curves=t)}},t.ClosestPointDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.point=e)}},t.ClosestPointsDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.points=e)}},t.BezierCurveDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.weights=e)}},t.DrawCurveDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.curve=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.curveMesh=s)}},t.CurveParameterDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.parameter=e)}},t.CurvesParameterDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.parameter=e)}},t.CurveTransformDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.transformation=e)}},t.CurvesTransformDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.transformation=e)}},t.CurveToleranceDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.tolerance=e)}},t.CurveLengthToleranceDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.length=e),void 0!==i&&(this.tolerance=i)}},t.CurveDerivativesDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.parameter=e),void 0!==i&&(this.numDerivatives=i)}},t.CurveSubdivisionsDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.subdivision=e)}},t.CurvesSubdivisionsDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.subdivision=e)}},t.CurvesDivideLengthDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.length=e)}},t.CurveDivideLengthDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.length=e)}},t.DrawCurvesDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.curves=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.size=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.curvesMesh=s)}},t.CurveNurbsDataDto=class{constructor(t,e,i,n){void 0!==t&&(this.degree=t),void 0!==e&&(this.weights=e),void 0!==i&&(this.knots=i),void 0!==n&&(this.points=n)}},t.CurvePathDataDto=class{constructor(t,e){void 0!==t&&(this.degree=t),void 0!==e&&(this.points=e)}},t.EllipseDto=class{constructor(t){void 0!==t&&(this.ellipse=t)}},t.CircleDto=class{constructor(t){void 0!==t&&(this.circle=t)}},t.ArcDto=class{constructor(t){void 0!==t&&(this.arc=t)}},t.EllipseParametersDto=class{constructor(t,e,i){void 0!==t&&(this.xAxis=t),void 0!==e&&(this.yAxis=e),void 0!==i&&(this.center=i)}},t.CircleParametersDto=class{constructor(t,e,i,n){void 0!==t&&(this.xAxis=t),void 0!==e&&(this.yAxis=e),void 0!==i&&(this.radius=i),void 0!==n&&(this.center=n)}},t.ArcParametersDto=class{constructor(t,e,i,n,r,s){void 0!==t&&(this.minAngle=t),void 0!==e&&(this.maxAngle=e),void 0!==i&&(this.xAxis=i),void 0!==n&&(this.yAxis=n),void 0!==r&&(this.radius=r),void 0!==s&&(this.center=s)}},t.EllipseArcParametersDto=class{constructor(t,e,i,n,r){void 0!==t&&(this.minAngle=t),void 0!==e&&(this.maxAngle=e),void 0!==i&&(this.xAxis=i),void 0!==n&&(this.yAxis=n),void 0!==r&&(this.center=r)}},t.SurfaceDto=class{constructor(t){void 0!==t&&(this.surface=t)}},t.SurfaceTransformDto=class{constructor(t,e){void 0!==t&&(this.surface=t),void 0!==e&&(this.transformation=e)}},t.SurfaceParameterDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.parameter=e),void 0!==i&&(this.useV=i)}},t.IsocurvesParametersDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.parameters=e),void 0!==i&&(this.useV=i)}},t.IsocurveSubdivisionDto=class{constructor(t,e,i,n,r){this.useV=!1,this.includeLast=!0,this.includeFirst=!0,void 0!==t&&(this.surface=t),void 0!==e&&(this.useV=e),void 0!==i&&(this.includeLast=i),void 0!==n&&(this.includeFirst=n),void 0!==r&&(this.isocurveSegments=r)}},t.DerivativesDto=class{constructor(t,e,i,n){void 0!==t&&(this.surface=t),void 0!==e&&(this.u=e),void 0!==i&&(this.v=i),void 0!==n&&(this.numDerivatives=n)}},t.SurfaceLocationDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.u=e),void 0!==i&&(this.v=i)}},t.CornersDto=class{constructor(t,e,i,n){void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.point3=i),void 0!==n&&(this.point4=n)}},t.SurfaceParamDto=class{constructor(t,e){void 0!==t&&(this.surface=t),void 0!==e&&(this.point=e)}},t.KnotsControlPointsWeightsDto=class{constructor(t,e,i,n,r,s){void 0!==t&&(this.degreeU=t),void 0!==e&&(this.degreeV=e),void 0!==i&&(this.knotsU=i),void 0!==n&&(this.knotsV=n),void 0!==r&&(this.points=r),void 0!==s&&(this.weights=s)}},t.LoftCurvesDto=class{constructor(t,e){void 0!==t&&(this.degreeV=t),void 0!==e&&(this.curves=e)}},t.DrawSurfaceDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,void 0!==t&&(this.surface=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r),void 0!==s&&(this.surfaceMesh=s)}},t.DrawSurfacesDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,void 0!==t&&(this.surfaces=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r),void 0!==s&&(this.surfacesMesh=s)}},t.DrawSurfacesColoursDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.updatable=!1,this.hidden=!1,void 0!==t&&(this.surfaces=t),void 0!==e&&(this.colours=e),void 0!==i&&(this.opacity=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r),void 0!==s&&(this.surfacesMesh=s)}},t.ConeAndCylinderParametersDto=class{constructor(t,e,i,n,r){this.axis=[0,1,0],this.xAxis=[1,0,0],this.base=[0,0,0],this.height=2,this.radius=1,void 0!==t&&(this.axis=t),void 0!==e&&(this.xAxis=e),void 0!==i&&(this.base=i),void 0!==n&&(this.height=n),void 0!==r&&(this.radius=r)}},t.ConeDto=class{constructor(t){void 0!==t&&(this.cone=t)}},t.CylinderDto=class{constructor(t){void 0!==t&&(this.cylinder=t)}},t.ExtrusionParametersDto=class{constructor(t,e){void 0!==t&&(this.profile=t),void 0!==e&&(this.direction=e)}},t.ExtrusionDto=class{constructor(t){void 0!==t&&(this.extrusion=t)}},t.SphericalParametersDto=class{constructor(t,e){void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e)}},t.SphereDto=class{constructor(t){void 0!==t&&(this.sphere=t)}},t.RevolutionParametersDto=class{constructor(t,e,i,n){void 0!==t&&(this.profile=t),void 0!==e&&(this.center=e),void 0!==i&&(this.axis=i),void 0!==n&&(this.angle=n)}},t.RevolutionDto=class{constructor(t){void 0!==t&&(this.revolution=t)}},t.SweepParametersDto=class{constructor(t,e){void 0!==t&&(this.profile=t),void 0!==e&&(this.rail=e)}},t.SweepDto=class{constructor(t){void 0!==t&&(this.sweep=t)}},t.CurveCurveDto=class{constructor(t,e,i){void 0!==t&&(this.firstCurve=t),void 0!==e&&(this.secondCurve=e),void 0!==i&&(this.tolerance=i)}},t.CurveSurfaceDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.surface=e),void 0!==i&&(this.tolerance=i)}},t.SurfaceSurfaceDto=class{constructor(t,e,i){void 0!==t&&(this.firstSurface=t),void 0!==e&&(this.secondSurface=e),void 0!==i&&(this.tolerance=i)}},t.CurveCurveIntersectionsDto=class{constructor(t){void 0!==t&&(this.intersections=t)}},t.CurveSurfaceIntersectionsDto=class{constructor(t){void 0!==t&&(this.intersections=t)}}}(Qv||(Qv={})),function(t){let e,i;t.PolylinePropertiesDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},function(t){t.edge="edge",t.round="round",t.chamfer="chamfer"}(e=t.solidCornerTypeEnum||(t.solidCornerTypeEnum={})),function(t){t.left="left",t.center="center",t.right="right"}(i=t.jscadTextAlignEnum||(t.jscadTextAlignEnum={})),t.MeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.MeshesDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.DrawSolidMeshDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,void 0!==t&&(this.mesh=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r),void 0!==s&&(this.jscadMesh=s)}},t.DrawSolidMeshesDto=class{constructor(t,e,i,n,r,s){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,void 0!==t&&(this.meshes=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r),void 0!==s&&(this.jscadMesh=s)}},t.DrawPathDto=class{constructor(t,e,i,n,r,s){this.colour="#444444",this.opacity=1,this.width=10,this.updatable=!1,void 0!==t&&(this.path=t),void 0!==e&&(this.colour=e),void 0!==i&&(this.opacity=i),void 0!==n&&(this.width=n),void 0!==r&&(this.updatable=r),void 0!==s&&(this.pathMesh=s)}},t.TransformSolidsDto=class{constructor(t,e){void 0!==t&&(this.meshes=t),void 0!==e&&(this.transformation=e)}},t.TransformSolidDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.transformation=e)}},t.DownloadSolidDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.fileName=e)}},t.DownloadGeometryDto=class{constructor(t,e,i){this.fileName="jscad-geometry",void 0!==t&&(this.geometry=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.options=i)}},t.DownloadSolidsDto=class{constructor(t,e){void 0!==t&&(this.meshes=t),void 0!==e&&(this.fileName=e)}},t.ColorizeDto=class{constructor(t,e){this.color="#0000ff",void 0!==t&&(this.geometry=t),void 0!==e&&(this.color=e)}},t.BooleanObjectsDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.BooleanTwoObjectsDto=class{constructor(t,e){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},t.BooleanObjectsFromDto=class{constructor(t,e){void 0!==t&&(this.from=t),void 0!==e&&(this.meshes=e)}},t.ExpansionDto=class{constructor(t,i,n,r){this.delta=.1,this.corners=e.edge,this.segments=24,void 0!==t&&(this.geometry=t),void 0!==i&&(this.delta=i),void 0!==n&&(this.corners=n),void 0!==r&&(this.segments=r)}},t.OffsetDto=class{constructor(t,i,n,r){this.delta=.1,this.corners=e.edge,this.segments=24,void 0!==t&&(this.geometry=t),void 0!==i&&(this.delta=i),void 0!==n&&(this.corners=n),void 0!==r&&(this.segments=r)}},t.ExtrudeLinearDto=class{constructor(t,e,i,n){this.height=1,this.twistAngle=90,this.twistSteps=15,void 0!==t&&(this.geometry=t),void 0!==e&&(this.height=e),void 0!==i&&(this.twistAngle=i),void 0!==n&&(this.twistSteps=n)}},t.HullDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.ExtrudeRectangularDto=class{constructor(t,e,i){this.height=1,this.size=1,void 0!==t&&(this.geometry=t),void 0!==e&&(this.height=e),void 0!==i&&(this.size=i)}},t.ExtrudeRectangularPointsDto=class{constructor(t,e,i){this.height=1,this.size=1,void 0!==t&&(this.points=t),void 0!==e&&(this.height=e),void 0!==i&&(this.size=i)}},t.ExtrudeRotateDto=class{constructor(t,e,i,n){this.angle=90,this.startAngle=0,this.segments=24,void 0!==t&&(this.polygon=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.startAngle=i),void 0!==n&&(this.segments=n)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},t.CurveDto=class{constructor(t){void 0!==t&&(this.curve=t)}},t.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PathDto=class{constructor(t){void 0!==t&&(this.path=t)}},t.PathFromPointsDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.PathsFromPointsDto=class{constructor(t){void 0!==t&&(this.pointsLists=t)}},t.PathFromPolylineDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.polyline=t),void 0!==e&&(this.closed=e)}},t.PathAppendCurveDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.path=e)}},t.PathAppendPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.path=e)}},t.PathAppendPolylineDto=class{constructor(t,e){void 0!==t&&(this.polyline=t),void 0!==e&&(this.path=e)}},t.PathAppendArcDto=class{constructor(t,e,i,n,r,s,o,a){this.endPoint=[1,1],this.xAxisRotation=90,this.clockwise=!0,this.large=!1,this.segments=24,this.radiusX=1,this.radiusY=1,void 0!==t&&(this.path=t),void 0!==e&&(this.endPoint=e),void 0!==i&&(this.xAxisRotation=i),void 0!==n&&(this.clockwise=n),void 0!==r&&(this.large=r),void 0!==s&&(this.segments=s),void 0!==o&&(this.radiusX=o),void 0!==a&&(this.radiusY=a)}},t.CircleDto=class{constructor(t,e,i){this.center=[0,0],this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.EllipseDto=class{constructor(t,e,i){this.center=[0,0],this.radius=[1,2],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.SquareDto=class{constructor(t,e){this.center=[0,0],this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.RectangleDto=class{constructor(t,e,i){this.center=[0,0],this.width=1,this.length=1,void 0!==t&&(this.center=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i)}},t.RoundedRectangleDto=class{constructor(t,e,i,n,r){this.center=[0,0],this.roundRadius=.2,this.segments=24,this.width=1,this.length=1,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.segments=i),void 0!==n&&(this.width=n),void 0!==r&&(this.length=r)}},t.StarDto=class{constructor(t,e,i,n,r,s){this.center=[0,0],this.vertices=10,this.density=1,this.outerRadius=2,this.innerRadius=1,this.startAngle=0,void 0!==t&&(this.center=t),void 0!==e&&(this.vertices=e),void 0!==i&&(this.density=i),void 0!==n&&(this.outerRadius=n),void 0!==r&&(this.innerRadius=r),void 0!==s&&(this.startAngle=s)}},t.CubeDto=class{constructor(t,e){this.center=[0,0,0],this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.CubeCentersDto=class{constructor(t,e){this.size=1,void 0!==t&&(this.centers=t),void 0!==e&&(this.size=e)}},t.CuboidDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.width=1,this.length=1,this.height=1,void 0!==t&&(this.center=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==n&&(this.height=n)}},t.CuboidCentersDto=class{constructor(t,e,i,n){this.width=1,this.length=1,this.height=1,void 0!==t&&(this.centers=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==n&&(this.height=n)}},t.RoundedCuboidDto=class{constructor(t,e,i,n,r,s){this.center=[0,0,0],this.roundRadius=1,this.width=1,this.length=1,this.height=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.width=i),void 0!==n&&(this.length=n),void 0!==r&&(this.height=r),void 0!==s&&(this.segments=s)}},t.RoundedCuboidCentersDto=class{constructor(t,e,i,n,r,s){this.roundRadius=.1,this.width=1,this.length=1,this.height=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.width=i),void 0!==n&&(this.length=n),void 0!==r&&(this.height=r),void 0!==s&&(this.segments=s)}},t.CylidnerEllipticDto=class{constructor(t,e,i,n,r){this.center=[0,0,0],this.height=1,this.startRadius=[1,2],this.endRadius=[2,3],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.height=e),void 0!==i&&(this.startRadius=i),void 0!==n&&(this.endRadius=n),void 0!==r&&(this.segments=r)}},t.CylidnerCentersEllipticDto=class{constructor(t,e,i,n,r){this.height=1,this.startRadius=[1,2],this.endRadius=[2,3],this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.height=e),void 0!==i&&(this.startRadius=i),void 0!==n&&(this.endRadius=n),void 0!==r&&(this.segments=r)}},t.CylidnerDto=class{constructor(t,e,i,n){this.center=[0,0,0],this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.height=e),void 0!==i&&(this.radius=i),void 0!==n&&(this.segments=n)}},t.RoundedCylidnerDto=class{constructor(t,e,i,n,r){this.center=[0,0,0],this.roundRadius=.1,this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.height=i),void 0!==n&&(this.radius=n),void 0!==r&&(this.segments=r)}},t.EllipsoidDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=[1,2,3],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.EllipsoidCentersDto=class{constructor(t,e,i){this.radius=[1,2,3],this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.GeodesicSphereDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=1,this.frequency=12,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.frequency=i)}},t.GeodesicSphereCentersDto=class{constructor(t,e,i){this.radius=1,this.frequency=12,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.frequency=i)}},t.CylidnerCentersDto=class{constructor(t,e,i,n){this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.height=e),void 0!==i&&(this.radius=i),void 0!==n&&(this.segments=n)}},t.RoundedCylidnerCentersDto=class{constructor(t,e,i,n,r){this.roundRadius=.1,this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.height=i),void 0!==n&&(this.radius=n),void 0!==r&&(this.segments=r)}},t.SphereDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.SphereCentersDto=class{constructor(t,e,i){this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.TorusDto=class{constructor(t,e,i,n,r,s,o,a){this.center=[0,0,0],this.innerRadius=1,this.outerRadius=2,this.innerSegments=24,this.outerSegments=24,this.innerRotation=0,this.outerRotation=360,this.startAngle=0,void 0!==t&&(this.center=t),void 0!==e&&(this.innerRadius=e),void 0!==i&&(this.outerRadius=i),void 0!==n&&(this.innerSegments=n),void 0!==r&&(this.outerSegments=r),void 0!==s&&(this.innerRotation=s),void 0!==o&&(this.outerRotation=o),void 0!==a&&(this.startAngle=a)}},t.TextDto=class{constructor(t,e,n,r,s,o,a,c,l){this.text="Hello World",this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.segments=e),void 0!==n&&(this.xOffset=n),void 0!==r&&(this.yOffset=r),void 0!==s&&(this.height=s),void 0!==o&&(this.lineSpacing=o),void 0!==a&&(this.letterSpacing=a),void 0!==c&&(this.align=c),void 0!==l&&(this.extrudeOffset=l)}},t.CylinderTextDto=class{constructor(t,e,n,r,s,o,a,c,l,h,u){this.text="Hello World",this.extrusionHeight=.5,this.extrusionSize=.1,this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.extrusionHeight=e),void 0!==n&&(this.extrusionSize=n),void 0!==r&&(this.segments=r),void 0!==s&&(this.xOffset=s),void 0!==o&&(this.yOffset=o),void 0!==a&&(this.height=a),void 0!==c&&(this.lineSpacing=c),void 0!==l&&(this.letterSpacing=l),void 0!==h&&(this.align=h),void 0!==u&&(this.extrudeOffset=u)}},t.SphereTextDto=class{constructor(t,e,n,r,s,o,a,c,l,h){this.text="Hello World",this.radius=.1,this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.radius=e),void 0!==n&&(this.segments=n),void 0!==r&&(this.xOffset=r),void 0!==s&&(this.yOffset=s),void 0!==o&&(this.height=o),void 0!==a&&(this.lineSpacing=a),void 0!==c&&(this.letterSpacing=c),void 0!==l&&(this.align=l),void 0!==h&&(this.extrudeOffset=h)}},t.FromPolygonPoints=class{constructor(t){void 0!==t&&(this.polygonPoints=t)}}}(t_||(t_={})),function(t){let e,i;!function(t){t.evenOdd="EvenOdd",t.nonZero="NonZero",t.positive="Positive",t.negative="Negative"}(e=t.fillRuleEnum||(t.fillRuleEnum={})),function(t){t.square="Square",t.round="Round",t.miter="Miter"}(i=t.manifoldJoinTypeEnum||(t.manifoldJoinTypeEnum={})),t.DecomposedManifoldMeshDto=class{},t.DrawManifoldOrCrossSectionDto=class{constructor(t,e,i,n,r,s,o,a){this.faceOpacity=1,this.faceColour="#ff0000",this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.crossSectionOpacity=1,this.computeNormals=!1,void 0!==t&&(this.manifoldOrCrossSection=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.faceMaterial=i),void 0!==n&&(this.faceColour=n),void 0!==r&&(this.crossSectionColour=r),void 0!==s&&(this.crossSectionWidth=s),void 0!==o&&(this.crossSectionOpacity=o),void 0!==a&&(this.computeNormals=a)}},t.DrawManifoldsOrCrossSectionsDto=class{constructor(t,e,i,n,r,s,o,a){this.faceColour="#ff0000",this.faceOpacity=1,this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.crossSectionOpacity=1,this.computeNormals=!1,void 0!==t&&(this.manifoldsOrCrossSections=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.faceMaterial=i),void 0!==n&&(this.faceColour=n),void 0!==r&&(this.crossSectionColour=r),void 0!==s&&(this.crossSectionWidth=s),void 0!==o&&(this.crossSectionOpacity=o),void 0!==a&&(this.computeNormals=a)}},t.CreateFromMeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.FromPolygonPointsDto=class{constructor(t){void 0!==t&&(this.polygonPoints=t)}},t.CubeDto=class{constructor(t,e){this.center=!0,this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.CreateContourSectionDto=class{constructor(t,i){this.fillRule=e.evenOdd,void 0!==t&&(this.polygons=t),void 0!==i&&(this.fillRule=i)}},t.SquareDto=class{constructor(t,e){this.center=!1,this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.SphereDto=class{constructor(t,e){this.radius=1,void 0!==t&&(this.radius=t),void 0!==e&&(this.circularSegments=e)}},t.CylinderDto=class{constructor(t,e,i,n,r){this.height=1,this.radiusLow=1,this.radiusHigh=1,this.circularSegments=32,this.center=!0,void 0!==t&&(this.height=t),void 0!==e&&(this.radiusLow=e),void 0!==i&&(this.radiusHigh=i),void 0!==n&&(this.circularSegments=n),void 0!==r&&(this.center=r)}},t.CircleDto=class{constructor(t,e){this.radius=1,this.circularSegments=32,void 0!==t&&(this.radius=t),void 0!==e&&(this.circularSegments=e)}},t.RectangleDto=class{constructor(t,e,i){this.length=1,this.height=1,this.center=!1,void 0!==t&&(this.length=t),void 0!==e&&(this.height=e),void 0!==i&&(this.center=i)}},t.ManifoldDto=class{constructor(t){void 0!==t&&(this.manifold=t)}},t.CalculateNormalsDto=class{constructor(t,e,i){this.normalIdx=0,this.minSharpAngle=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e),void 0!==i&&(this.minSharpAngle=i)}},t.CalculateCurvatureDto=class{constructor(t){void 0!==t&&(this.manifold=t)}},t.CountDto=class{constructor(t){void 0!==t&&(this.count=t)}},t.ManifoldsMinGapDto=class{constructor(t,e,i){this.searchLength=100,void 0!==t&&(this.manifold1=t),void 0!==e&&(this.manifold2=e),void 0!==i&&(this.searchLength=i)}},t.ManifoldRefineToleranceDto=class{constructor(t,e){this.tolerance=1e-6,void 0!==t&&(this.manifold=t),void 0!==e&&(this.tolerance=e)}},t.ManifoldRefineLengthDto=class{constructor(t,e){this.length=.1,void 0!==t&&(this.manifold=t),void 0!==e&&(this.length=e)}},t.ManifoldRefineDto=class{constructor(t,e){this.number=1,void 0!==t&&(this.manifold=t),void 0!==e&&(this.number=e)}},t.ManifoldSmoothByNormalsDto=class{constructor(t,e){this.normalIdx=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldSmoothOutDto=class{constructor(t,e,i){this.minSharpAngle=60,this.minSmoothness=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.minSharpAngle=e),void 0!==i&&(this.minSmoothness=i)}},t.HullPointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.SliceDto=class{constructor(t){this.height=.5,void 0!==t&&(this.manifold=t)}},t.MeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.MeshVertexIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.vertexIndex=e)}},t.MeshTriangleRunIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.triangleRunIndex=e)}},t.MeshHalfEdgeIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.halfEdgeIndex=e)}},t.MeshTriangleIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.triangleIndex=e)}},t.CrossSectionDto=class{constructor(t){void 0!==t&&(this.crossSection=t)}},t.CrossSectionsDto=class{constructor(t){void 0!==t&&(this.crossSections=t)}},t.ExtrudeDto=class{constructor(t){this.height=1,this.nDivisions=1,this.twistDegrees=0,this.scaleTopX=1,this.scaleTopY=1,this.center=!0,void 0!==t&&(this.crossSection=t)}},t.RevolveDto=class{constructor(t,e,i,n){this.matchProfile=!0,this.circularSegments=32,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.revolveDegrees=e),void 0!==i&&(this.matchProfile=i),void 0!==n&&(this.circularSegments=n)}},t.OffsetDto=class{constructor(t,e,n,r,s){this.joinType=i.round,this.miterLimit=2,this.circularSegments=32,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.delta=e),void 0!==n&&(this.joinType=n),void 0!==r&&(this.miterLimit=r),void 0!==s&&(this.circularSegments=s)}},t.SimplifyDto=class{constructor(t,e){this.epsilon=1e-6,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.epsilon=e)}},t.ComposeDto=class{constructor(t){void 0!==t&&(this.polygons=t)}},t.MirrorCrossSectionDto=class{constructor(t,e){this.normal=[1,0],void 0!==t&&(this.crossSection=t),void 0!==e&&(this.normal=e)}},t.Scale2DCrossSectionDto=class{constructor(t,e){this.vector=[2,2],void 0!==t&&(this.crossSection=t),void 0!==e&&(this.vector=e)}},t.TranslateCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.vector=e)}},t.RotateCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.degrees=e)}},t.ScaleCrossSectionDto=class{constructor(t,e){this.factor=2,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.factor=e)}},t.TranslateXYCrossSectionDto=class{constructor(t,e,i){this.x=0,this.y=0,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i)}},t.TransformCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.transform=e)}},t.MirrorDto=class{constructor(t,e){this.normal=[1,0,0],void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e)}},t.Scale3DDto=class{constructor(t,e){this.vector=[2,2,2],void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.TranslateDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.TranslateByVectorsDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vectors=e)}},t.RotateDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.RotateXYZDto=class{constructor(t,e,i,n){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n)}},t.ScaleDto=class{constructor(t,e){this.factor=2,void 0!==t&&(this.manifold=t),void 0!==e&&(this.factor=e)}},t.TranslateXYZDto=class{constructor(t,e,i,n){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n)}},t.TransformDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.transform=e)}},t.TransformsDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.transforms=e)}},t.TwoCrossSectionsDto=class{constructor(t,e){void 0!==t&&(this.crossSection1=t),void 0!==e&&(this.crossSection2=e)}},t.TwoManifoldsDto=class{constructor(t,e){void 0!==t&&(this.manifold1=t),void 0!==e&&(this.manifold2=e)}},t.SplitManifoldsDto=class{constructor(t,e){void 0!==t&&(this.manifoldToSplit=t),void 0!==e&&(this.manifoldCutter=e)}},t.TrimByPlaneDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffset=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffset=i)}},t.SplitByPlaneDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffset=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffset=i)}},t.SplitByPlaneOnOffsetsDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffsets=[0],void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffsets=i)}},t.ManifoldsDto=class{constructor(t){void 0!==t&&(this.manifolds=t)}},t.ManifoldToMeshDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldsToMeshesDto=class{constructor(t,e){void 0!==t&&(this.manifolds=t),void 0!==e&&(this.normalIdx=e)}},t.DecomposeManifoldOrCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.manifoldOrCrossSection=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldOrCrossSectionDto=class{constructor(t){void 0!==t&&(this.manifoldOrCrossSection=t)}},t.ManifoldsOrCrossSectionsDto=class{constructor(t){void 0!==t&&(this.manifoldsOrCrossSections=t)}},t.DecomposeManifoldsOrCrossSectionsDto=class{constructor(t,e){void 0!==t&&(this.manifoldsOrCrossSections=t),void 0!==e&&(this.normalIdx=e)}}}(e_||(e_={}));class i_ extends gg{constructor(t,e){super(t),this.occWorkerManager=t,this.context=e}loadSTEPorIGES(t){return this.context.getFile(t.assetFile).then((e=>this.occWorkerManager.genericCallToWorkerPromise("io.loadSTEPorIGES",new uv.LoadStepOrIgesDto(e,t.assetFile.name,t.adjustZtoY))))}loadSTEPorIGESFromText(t){return this.occWorkerManager.genericCallToWorkerPromise("io.loadSTEPorIGES",new uv.LoadStepOrIgesDto(t.text,`fake.${t.fileType}`,t.adjustZtoY))}}class n_ extends Cg{constructor(t,e){super(e),this.context=t,this.occWorkerManager=e,this.io=new i_(e,t)}}class r_{constructor(t,e){this.context=t,this.math=e}createCircle(t){return new this.context.verb.geom.Circle(t.center,t.xAxis,t.yAxis,t.radius)}createArc(t){return new this.context.verb.geom.Arc(t.center,t.xAxis,t.yAxis,t.radius,this.math.degToRad({number:t.minAngle}),this.math.degToRad({number:t.maxAngle}))}center(t){return t.circle.center()}radius(t){return t.circle.radius()}maxAngle(t){return this.math.radToDeg({number:t.circle.maxAngle()})}minAngle(t){return this.math.radToDeg({number:t.circle.minAngle()})}xAxis(t){return t.circle.xaxis()}yAxis(t){return t.circle.yaxis()}}class s_{constructor(t,e){this.context=t,this.math=e}createEllipse(t){return new this.context.verb.geom.Ellipse(t.center,t.xAxis,t.yAxis)}createArc(t){return new this.context.verb.geom.EllipseArc(t.center,t.xAxis,t.yAxis,this.math.degToRad({number:t.minAngle}),this.math.degToRad({number:t.maxAngle}))}center(t){return t.ellipse.center()}maxAngle(t){return this.math.radToDeg({number:t.ellipse.maxAngle()})}minAngle(t){return this.math.radToDeg({number:t.ellipse.minAngle()})}xAxis(t){return t.ellipse.xaxis()}yAxis(t){return t.ellipse.yaxis()}}class o_{constructor(t,e,i){this.context=t,this.geometryHelper=e,this.math=i,this.circle=new r_(t,this.math),this.ellipse=new s_(t,this.math)}createCurveByKnotsControlPointsWeights(t){return this.context.verb.geom.NurbsCurve.byKnotsControlPointsWeights(t.degree,t.knots,t.points,t.weights)}createCurveByPoints(t){return this.context.verb.geom.NurbsCurve.byPoints(t.points,t.degree)}convertLinesToNurbsCurves(t){return t.lines.map((t=>new this.context.verb.geom.Line(t.start,t.end)))}convertLineToNurbsCurve(t){return new this.context.verb.geom.Line(t.line.start,t.line.end)}convertPolylineToNurbsCurve(t){return this.context.verb.geom.NurbsCurve.byPoints(t.polyline.points,1)}convertPolylinesToNurbsCurves(t){return t.polylines.map((t=>this.convertPolylineToNurbsCurve({polyline:t})))}createBezierCurve(t){return new this.context.verb.geom.BezierCurve(t.points,t.weights)}clone(t){return t.curve.clone()}closestParam(t){return t.curve.closestParam(t.point)}closestParams(t){return t.points.map((e=>t.curve.closestParam(e)))}closestPoint(t){return t.curve.closestPoint(t.point)}closestPoints(t){return t.points.map((e=>t.curve.closestPoint(e)))}controlPoints(t){return t.curve.controlPoints()}degree(t){return t.curve.degree()}derivatives(t){return t.curve.derivatives(t.parameter,t.numDerivatives)}divideByEqualArcLengthToParams(t){return t.curve.divideByEqualArcLength(t.subdivision).map((t=>t.u))}divideByEqualArcLengthToPoints(t){return t.curve.divideByEqualArcLength(t.subdivision).map((e=>t.curve.point(e.u)))}divideByArcLengthToParams(t){return t.curve.divideByArcLength(t.length).map((t=>t.u))}divideByArcLengthToPoints(t){return t.curve.divideByArcLength(t.length).map((e=>t.curve.point(e.u)))}divideCurvesByEqualArcLengthToPoints(t){return t.curves.map((e=>this.divideByEqualArcLengthToPoints({curve:e,subdivision:t.subdivision})))}divideCurvesByArcLengthToPoints(t){return t.curves.map((e=>this.divideByArcLengthToPoints({curve:e,length:t.length})))}domain(t){return t.curve.domain()}startPoint(t){return t.curve.point(t.curve.domain().min)}endPoint(t){return t.curve.point(t.curve.domain().max)}startPoints(t){return t.curves.map((t=>this.startPoint({curve:t})))}endPoints(t){return t.curves.map((t=>this.endPoint({curve:t})))}knots(t){return t.curve.knots()}lengthAtParam(t){return t.curve.lengthAtParam(t.parameter)}length(t){return t.curve.length()}paramAtLength(t){return t.curve.paramAtLength(t.length,t.tolerance)}pointAtParam(t){return t.curve.point(t.parameter)}pointsAtParam(t){return t.curves.map((e=>this.pointAtParam({curve:e,parameter:t.parameter})))}reverse(t){return t.curve.reverse()}split(t){return t.curve.split(t.parameter)}tangent(t){return t.curve.tangent(t.parameter)}tessellate(t){return t.curve.tessellate(t.tolerance)}transform(t){const e=t.curve.controlPoints(),i=this.geometryHelper.transformControlPoints(t.transformation,e);return this.context.verb.geom.NurbsCurve.byKnotsControlPointsWeights(t.curve.degree(),t.curve.knots(),i,t.curve.weights())}transformCurves(t){return t.curves.map((e=>this.transform({curve:e,transformation:t.transformation})))}weights(t){return t.curve.weights()}}class a_{constructor(t,e){this.context=t,this.geometryHelper=e}curves(t){return this.context.verb.geom.Intersect.curves(t.firstCurve,t.secondCurve,t.tolerance)}curveAndSurface(t){return this.context.verb.geom.Intersect.curveAndSurface(t.curve,t.surface,t.tolerance)}surfaces(t){return this.context.verb.geom.Intersect.surfaces(t.firstSurface,t.secondSurface)}curveCurveFirstParams(t){return t.intersections.filter((t=>t.u0>=0&&t.u0<=1)).map((t=>t.u0))}curveCurveSecondParams(t){return t.intersections.filter((t=>t.u1>=0&&t.u1<=1)).map((t=>t.u1))}curveCurveFirstPoints(t){return t.intersections.filter((t=>t.u0>=0&&t.u0<=1)).map((t=>t.point0))}curveCurveSecondPoints(t){return t.intersections.filter((t=>t.u1>=0&&t.u1<=1)).map((t=>t.point1))}curveSurfaceCurveParams(t){return t.intersections.filter((t=>t.u>=0&&t.u<=1)).map((t=>t.u))}curveSurfaceSurfaceParams(t){return t.intersections.map((t=>t.uv))}curveSurfaceCurvePoints(t){return t.intersections.filter((t=>t.u>=0&&t.u<=1)).map((t=>t.curvePoint))}curveSurfaceSurfacePoints(t){return t.intersections.map((t=>t.surfacePoint))}}class c_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.ConicalSurface(t.axis,t.xAxis,t.base,t.height,t.radius)}axis(t){return t.cone.axis()}base(t){return t.cone.base()}height(t){return t.cone.height()}radius(t){return t.cone.radius()}xAxis(t){return t.cone.xaxis()}}class l_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.CylindricalSurface(t.axis,t.xAxis,t.base,t.height,t.radius)}axis(t){return t.cylinder.axis()}base(t){return t.cylinder.base()}height(t){return t.cylinder.height()}radius(t){return t.cylinder.radius()}xAxis(t){return t.cylinder.xaxis()}}class h_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.ExtrudedSurface(t.profile,t.direction)}direction(t){return t.extrusion.direction()}profile(t){return t.extrusion.profile()}}class u_{constructor(t,e){this.context=t,this.math=e}create(t){return new this.context.verb.geom.RevolvedSurface(t.profile,t.center,t.axis,this.math.degToRad({number:t.angle}))}profile(t){return t.revolution.profile()}center(t){return t.revolution.center()}axis(t){return t.revolution.axis()}angle(t){return this.math.radToDeg({number:t.revolution.angle()})}}class d_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.SphericalSurface(t.center,t.radius)}radius(t){return t.sphere.radius()}center(t){return t.sphere.center()}}class p_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.SweptSurface(t.profile,t.rail)}profile(t){return t.sweep.profile()}rail(t){return t.sweep.rail()}}class f_{constructor(t,e,i){this.context=t,this.geometryHelper=e,this.math=i,this.cone=new c_(t),this.cylinder=new l_(t),this.extrusion=new h_(t),this.sphere=new d_(t),this.revolved=new u_(t,i),this.sweep=new p_(t)}boundaries(t){return t.surface.boundaries()}createSurfaceByCorners(t){return this.context.verb.geom.NurbsSurface.byCorners(t.point1,t.point2,t.point3,t.point4)}createSurfaceByKnotsControlPointsWeights(t){return this.context.verb.geom.NurbsSurface.byKnotsControlPointsWeights(t.degreeU,t.degreeV,t.knotsU,t.knotsV,t.points,t.weights)}createSurfaceByLoftingCurves(t){return this.context.verb.geom.NurbsSurface.byLoftingCurves(t.curves,t.degreeV)}clone(t){return t.surface.clone()}closestParam(t){return t.surface.closestParam(t.point)}closestPoint(t){return t.surface.closestPoint(t.point)}controlPoints(t){return t.surface.controlPoints()}degreeU(t){return t.surface.degreeU()}degreeV(t){return t.surface.degreeV()}derivatives(t){return t.surface.derivatives(t.u,t.v,t.numDerivatives)}domainU(t){return t.surface.domainU()}domainV(t){return t.surface.domainV()}isocurve(t){return t.surface.isocurve(t.parameter,t.useV)}isocurvesSubdivision(t){const e=.999999/t.isocurveSegments,i=this.context.verb.core.Vec.span(1e-7,.9999999,e);return t.includeLast||i.pop(),t.includeFirst||i.shift(),i.map((e=>t.surface.isocurve(e,t.useV)))}isocurvesAtParams(t){return t.parameters.map((e=>t.surface.isocurve(e,t.useV)))}knotsU(t){return t.surface.knotsU()}knotsV(t){return t.surface.knotsV()}normal(t){return t.surface.normal(t.u,t.v)}point(t){return t.surface.point(t.u,t.v)}reverse(t){return t.surface.reverse()}split(t){return t.surface.split(t.parameter,t.useV)}transformSurface(t){const e=t.surface.controlPoints(),i=t.transformation,n=[];return e.forEach((t=>{let e=t;e=this.geometryHelper.transformControlPoints(i,e),n.push(e)})),this.context.verb.geom.NurbsSurface.byKnotsControlPointsWeights(t.surface.degreeU(),t.surface.degreeV(),t.surface.knotsU(),t.surface.knotsV(),n,t.surface.weights())}weights(t){return t.surface.weights()}}class m_{constructor(t,e,i){this.math=i,this.curve=new o_(t,e,this.math),this.surface=new f_(t,e,this.math),this.intersect=new a_(t,e)}}class g_{}var v_,__,y_,x_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class b_{constructor(){this.assetManager=new g_}getFile(t){return this.assetManager.getAsset(t.fileName)}getLocalFile(t){return this.assetManager.getLocalAsset(t.fileName)}fetchBlob(t){return x_(this,void 0,void 0,(function*(){return(yield fetch(t.url)).blob()}))}fetchFile(t){return x_(this,void 0,void 0,(function*(){const e=yield fetch(t.url),i=yield e.blob();return new File([i],t.url.split("/").pop().split("?")[0])}))}fetchJSON(t){return x_(this,void 0,void 0,(function*(){return(yield fetch(t.url)).json()}))}fetchText(t){return x_(this,void 0,void 0,(function*(){return(yield fetch(t.url)).text()}))}createObjectURL(t){return URL.createObjectURL(t.file)}createObjectURLs(t){return t.files.map((t=>URL.createObjectURL(t)))}}!function(t){t.IntervalDto=class{constructor(){this.min=0,this.max=1}},t.UVDto=class{constructor(){this.u=0,this.v=0}},t.CurveCurveIntersection=class{},t.CurveSurfaceIntersection=class{},t.SurfaceSurfaceIntersectionPoint=class{}}(v_||(v_={}));class M_{constructor(t){this.context=t}stringify(t){return JSON.stringify(t.json)}parse(t){return JSON.parse(t.text)}query(t){return this.context.jsonpath({path:t.query,json:t.json})}setValueOnProp(t){const e=Object.assign({},structuredClone(t.json));return e[t.property]=t.value,e}getJsonFromArrayByFirstPropMatch(t){return t.jsonArray.find((e=>e[t.property]===t.match))}getValueOnProp(t){try{return Object.assign({},structuredClone(t.json))[t.property]}catch(e){return t.json[t.property]}}setValue(t){if(t.json instanceof Object){const e=Object.assign({},structuredClone(t.json)),i=e=>(e[t.prop]=t.value,e);return this.context.jsonpath({path:t.path,json:e,callback:i}),e}throw new Error("Json must be an object")}setValuesOnPaths(t){let e=Object.assign({},structuredClone(t.json));return t.paths.forEach(((i,n)=>{e=this.setValue({json:e,path:i,value:t.values[n],prop:t.props[n]})})),e}paths(t){return this.context.jsonpath({json:t.json,path:t.query,resultType:"path"})}createEmpty(){return{}}previewAndSaveJson(t){t.json&&this.context.promptPrintSave({text:t.json,isJson:!0,hidden:!1})}previewJson(t){t.json&&this.context.promptPrint({text:t.json,isJson:!0,hidden:!1})}}class S_{constructor(t){this.context=t}create(t){const e=new Jv.TagDto;return e.text=t.text,e.position=t.position,e.colour=t.colour,e.size=t.size,e.adaptDepth=t.adaptDepth,e}drawTag(t){if(t.tagVariable&&t.updatable){const e=this.context.tagBag.find((e=>e.id===t.tagVariable.id));Object.keys(t.tag).forEach((i=>{e[i]=t.tag[i]})),e.needsUpdate=!0}else{const e=document.createElement("span"),i="_tag"+(new Date).getTime()+this.context.tagBag.length;t.tag.id=i,e.id=i,e.textContent=t.tag.text,document.querySelector("."+this.context.canvasZoneClass).appendChild(e),t.tag.needsUpdate=!0,this.context.tagBag.push(t.tag)}return t.tag}drawTags(t){if(t.tagsVariable&&t.updatable){if(t.tagsVariable.length<t.tags.length)for(let e=t.tagsVariable.length-1;e<t.tags.length-1;e++){const i=t.tags[e],n=document.createElement("span"),r="_tag"+(new Date).getTime()+this.context.tagBag.length;i.id=r,n.id=r,document.querySelector("."+this.context.canvasZoneClass).appendChild(n),i.needsUpdate=!0,this.context.tagBag.push(i),t.tagsVariable.push(i)}t.tagsVariable.forEach(((e,i)=>{const n=this.context.tagBag.find((t=>t.id===e.id)),r=t.tags[i];if(r)Object.keys(r).forEach((t=>{n[t]=r[t]})),n.needsUpdate=!0;else{this.context.tagBag=this.context.tagBag.filter((t=>t.id!==n.id));const t=document.getElementById(n.id);t.parentNode.removeChild(t)}}))}else{const e=[];t.tags.forEach(((i,n)=>{const r=document.createElement("span"),s="_tag"+(new Date).getTime()+this.context.tagBag.length;i.id=s,r.id=s,r.textContent=i.text,document.querySelector("."+this.context.canvasZoneClass).appendChild(r),i.needsUpdate=!0,this.context.tagBag.push(i),e.push(i),t.tagsVariable=e}))}return t.tagsVariable}}class w_{constructor(t){this.context=t}registerRenderFunction(t){this.context.renderLoopBag.push((e=>{t(e)}))}}class T_{constructor(){this.canvasZoneClass="canvasZone",this.tolerance=1e-5,this.snapTolerance=1e-5,this.tagBag=[],this.timeoutBag=[],this.intervalBag=[],this.renderLoopBag=[],this.keyDownBag=[],this.keyUpBag=[],this.keyPressBag=[],this.currentlyPressedKeys=[]}getFile(t){return new Promise(((e,i)=>{if(t){const n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=t=>{const i=t.target.result;e(i)},n.onerror=t=>{i()}}else i()}))}remap(t,e,i,n,r){return(t-e)/(i-e)*(r-n)+n}}class E_{detectPoint(t){return Array.isArray(t)&&3===t.length&&this.checkIfElementsInArrayAreNumbers(t)}detectPoints(t){return Array.isArray(t)&&this.checkIfElementsInArrayAreArrays(t)&&this.arraysInChildrenArraysContainNumbers(t)&&this.arraysInChildrenArraysAreOfLength3(t)}detectLine(t){return t.start&&t.end&&Array.isArray(t.start)&&Array.isArray(t.end)}detectLines(t){return Array.isArray(t)&&!t.some((t=>!this.detectLine(t)))}detectPolyline(t){return t.points&&Array.isArray(t.points)}detectPolylines(t){return Array.isArray(t)&&!t.some((t=>!this.detectPolyline(t)))}detectNode(t){return!Array.isArray(t)&&t.id&&t.id.includes("node")}detectNodes(t){return Array.isArray(t)&&!t.some((t=>!this.detectNode(t)))}detectVerbCurve(t){return!Array.isArray(t)&&t._data&&t._data.controlPoints&&t._data.knots&&t._data.degree}detectVerbSurface(t){return!Array.isArray(t)&&t._data&&t._data.controlPoints&&t._data.degreeU&&t._data.degreeV&&t._data.knotsU&&t._data.knotsV}detectVerbCurves(t){return Array.isArray(t)&&!t.some((t=>!this.detectVerbCurve(t)))}detectVerbSurfaces(t){return Array.isArray(t)&&!t.some((t=>!this.detectVerbSurface(t)))}detectJscadMesh(t){return!Array.isArray(t)&&(t.sides||t.polygons)}detectJscadMeshes(t){return Array.isArray(t)&&!t.some((t=>!this.detectJscadMesh(t)))}detectOcctShape(t){return"occ-shape"===(null==t?void 0:t.type)}detectOcctShapes(t){return Array.isArray(t)&&!t.some((t=>!this.detectOcctShape(t)))}detectManifoldShape(t){return"manifold-shape"===(null==t?void 0:t.type)}detectManifoldShapes(t){return Array.isArray(t)&&!t.some((t=>!this.detectManifoldShape(t)))}detectTag(t){return!Array.isArray(t)&&t.text}detectTags(t){return Array.isArray(t)&&!t.some((t=>!this.detectTag(t)))}checkIfElementsInArrayAreNumbers(t){return!t.some((t=>isNaN(t)))}checkIfElementsInArrayAreArrays(t){return!t.some((t=>!Array.isArray(t)))}arraysInChildrenArraysContainNumbers(t){return!t.some((t=>!this.checkIfElementsInArrayAreNumbers(t)))}arraysInChildrenArraysAreOfLength3(t){return!t.some((t=>3!==t.length))}}class C_{constructor(t){this.vector=t}computeEdgeMiddlePos(t){let e;if(2===t.vertex_coord.length){const i=t.vertex_coord[0],n=t.vertex_coord[1];e=this.vector.lerp({first:i,second:n,fraction:.5})}else if(3===t.vertex_coord.length)e=t.vertex_coord[1];else{const i=t.vertex_coord[Math.floor(t.vertex_coord.length/2)],n=t.vertex_coord[Math.floor(t.vertex_coord.length/2+1)];e=this.vector.lerp({first:i,second:n,fraction:.5})}return e}computeFaceMiddlePos(t){let e=0,i=0,n=0,r=0;return t.forEach((t=>{e+=t[0],i+=t[1],n+=t[2],r++})),[e/r,i/r,n/r]}}!function(t){let e,i;!function(t){t.default="default",t.clearSky="clearSky",t.city="city",t.greyGradient="greyGradient"}(e=t.skyboxEnum||(t.skyboxEnum={})),function(t){t.none="none",t.exponential="exponential",t.exponentialSquared="exponentialSquared",t.linear="linear"}(i=t.fogModeEnum||(t.fogModeEnum={}))}(__||(__={})),function(t){let e;t.DrawAny=class{constructor(t,e){void 0!==t&&(this.entity=t),void 0!==e&&(this.options=e)}},t.DrawManifoldOrCrossSectionOptions=class{constructor(t,e,i,n,r,s,o){this.faceOpacity=1,this.faceColour="#ff0000",this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.computeNormals=!1,void 0!==t&&(this.faceOpacity=t),void 0!==e&&(this.faceMaterial=e),void 0!==i&&(this.faceColour=i),void 0!==n&&(this.crossSectionColour=n),void 0!==r&&(this.crossSectionWidth=r),void 0!==s&&(this.crossSectionOpacity=s),void 0!==o&&(this.computeNormals=o)}},t.DrawOcctShapeOptions=class{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.vertexColour="#ffaaff",this.edgeWidth=2,this.vertexSize=.03,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",void 0!==t&&(this.faceOpacity=t),void 0!==e&&(this.edgeOpacity=e),void 0!==i&&(this.edgeColour=i),void 0!==n&&(this.faceMaterial=n),void 0!==r&&(this.faceColour=r),void 0!==l&&(this.vertexColour=l),void 0!==h&&(this.vertexSize=h),void 0!==s&&(this.edgeWidth=s),void 0!==o&&(this.drawEdges=o),void 0!==a&&(this.drawFaces=a),void 0!==c&&(this.drawVertices=c),void 0!==u&&(this.precision=u),void 0!==d&&(this.drawEdgeIndexes=d),void 0!==p&&(this.edgeIndexHeight=p),void 0!==f&&(this.edgeIndexColour=f),void 0!==m&&(this.drawFaceIndexes=m),void 0!==g&&(this.faceIndexHeight=g),void 0!==v&&(this.faceIndexColour=v)}},t.DrawBasicGeometryOptions=class{constructor(t,e,i,n,r){this.colours="#ff0000",this.size=.1,this.opacity=1,this.updatable=!1,this.hidden=!1,void 0!==t&&(this.colours=t),void 0!==e&&(this.size=e),void 0!==i&&(this.opacity=i),void 0!==n&&(this.updatable=n),void 0!==r&&(this.hidden=r)}},function(t){t[t.point=0]="point",t[t.points=1]="points",t[t.line=2]="line",t[t.lines=3]="lines",t[t.node=4]="node",t[t.nodes=5]="nodes",t[t.polyline=6]="polyline",t[t.polylines=7]="polylines",t[t.verbCurve=8]="verbCurve",t[t.verbCurves=9]="verbCurves",t[t.verbSurface=10]="verbSurface",t[t.verbSurfaces=11]="verbSurfaces",t[t.jscadMesh=12]="jscadMesh",t[t.jscadMeshes=13]="jscadMeshes",t[t.occt=14]="occt",t[t.occtShapes=15]="occtShapes",t[t.tag=16]="tag",t[t.tags=17]="tags"}(e=t.drawingTypes||(t.drawingTypes={}))}(y_||(y_={}));var P_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class A_ extends E_{constructor(t,e,i){super(),this.drawHelper=t,this.context=e,this.tag=i,this.defaultBasicOptions=new y_.DrawBasicGeometryOptions,this.defaultPolylineOptions=Object.assign(Object.assign({},new y_.DrawBasicGeometryOptions),{size:2,colours:"#ff00ff"})}drawAnyAsync(t){return P_(this,void 0,void 0,(function*(){const e=t.entity;return void 0===e||Array.isArray(e)&&0===e.length?Promise.resolve(void 0):this.detectJscadMesh(e)?this.handleJscadMesh(t):this.detectOcctShape(e)?this.handleOcctShape(t):this.detectOcctShapes(e)?this.handleOcctShapes(t):this.detectJscadMeshes(e)?this.handleJscadMeshes(t):this.detectManifoldShape(e)?this.handleManifoldShape(t):this.detectManifoldShapes(e)?this.handleManifoldShapes(t):Promise.resolve(this.drawAny(t))}))}drawAny(t){let e;const i=t.entity;return t.group?e=this.updateAny(t):this.detectLine(i)?e=this.handleLine(t):this.detectPoint(i)?e=this.handlePoint(t):this.detectPolyline(i)?e=this.handlePolyline(t):this.detectVerbCurve(i)?e=this.handleVerbCurve(t):this.detectVerbSurface(i)?e=this.handleVerbSurface(t):this.detectPolylines(i)?e=this.handlePolylines(t):this.detectLines(i)?e=this.handleLines(t):this.detectPoints(i)?e=this.handlePoints(t):this.detectVerbCurves(i)?e=this.handleVerbCurves(t):this.detectVerbSurfaces(i)?e=this.handleVerbSurfaces(t):this.detectTag(i)?e=this.handleTag(t):this.detectTags(i)&&(e=this.handleTags(t)),e}optionsSimple(t){return t}optionsOcctShape(t){return t}handleJscadMesh(t){return this.handleAsync(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSolidOrPolygonMesh(Object.assign({jscadMesh:t.group,mesh:t.entity},e))),y_.drawingTypes.jscadMesh)}handleJscadMeshes(t){return this.handleAsync(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSolidOrPolygonMeshes(Object.assign({jscadMesh:t.group,meshes:t.entity},e))),y_.drawingTypes.jscadMeshes)}handleManifoldShape(t){return this.handleAsync(t,new e_.DrawManifoldOrCrossSectionDto(t.entity),(e=>this.drawHelper.drawManifoldOrCrossSection(Object.assign(Object.assign({manifoldOrCrossSection:t.entity},new y_.DrawManifoldOrCrossSectionOptions),e))),y_.drawingTypes.occt)}handleManifoldShapes(t){return this.handleAsync(t,new e_.DrawManifoldOrCrossSectionDto(t.entity),(e=>this.drawHelper.drawManifoldsOrCrossSections(Object.assign(Object.assign({manifoldsOrCrossSections:t.entity},new y_.DrawManifoldOrCrossSectionOptions),e))),y_.drawingTypes.occt)}handleOcctShape(t){return this.handleAsync(t,new uv.DrawShapeDto(t.entity),(e=>this.drawHelper.drawShape(Object.assign(Object.assign({shape:t.entity},new y_.DrawOcctShapeOptions),e))),y_.drawingTypes.occt)}handleOcctShapes(t){return this.handleAsync(t,new uv.DrawShapeDto(t.entity),(e=>this.drawHelper.drawShapes(Object.assign(Object.assign({shapes:t.entity},new y_.DrawOcctShapeOptions),e))),y_.drawingTypes.occtShapes)}handleLine(t){return this.handle(t,this.defaultPolylineOptions,(e=>{const i=t.entity;return this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:[{points:[i.start,i.end]}]},e))}),y_.drawingTypes.line)}handlePoint(t){return this.handle(t,this.defaultBasicOptions,(e=>this.drawHelper.drawPoint(Object.assign({pointMesh:t.group,point:t.entity},e))),y_.drawingTypes.point)}handlePolyline(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPolylineClose(Object.assign({polylineMesh:t.group,polyline:t.entity},e))),y_.drawingTypes.polyline)}handleVerbCurve(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawCurve(Object.assign({curveMesh:t.group,curve:t.entity},e))),y_.drawingTypes.verbCurve)}handleVerbSurface(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSurface(Object.assign({surfaceMesh:t.group,surface:t.entity},e))),y_.drawingTypes.verbSurface)}handlePolylines(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:t.entity},e))),y_.drawingTypes.polylines)}handleLines(t){return this.handle(t,this.defaultPolylineOptions,(e=>{const i=t.entity;return this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:i.map((t=>({points:[t.start,t.end]})))},e))}),y_.drawingTypes.lines)}handlePoints(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPoints(Object.assign({pointsMesh:t.group,points:t.entity},e))),y_.drawingTypes.points)}handleVerbCurves(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawCurves(Object.assign({curvesMesh:t.group,curves:t.entity},e))),y_.drawingTypes.verbCurves)}handleVerbSurfaces(t){return this.handle(t,this.defaultBasicOptions,(e=>this.drawHelper.drawSurfacesMultiColour(Object.assign({surfacesMesh:t.group,surfaces:t.entity},e))),y_.drawingTypes.verbSurfaces)}handleTag(t){const e=t.options?t.options:{updatable:!1},i=this.tag.drawTag(Object.assign({tagVariable:t.group,tag:t.entity},e));return i.userData={type:y_.drawingTypes.tag,options:e},i}handleTags(t){const e=t.options?t.options:{updatable:!1},i=this.tag.drawTags(Object.assign({tagsVariable:t.group,tags:t.entity},e));return i.userData={type:y_.drawingTypes.tags,options:e},i}updateAny(t){let e;if(t.group&&t.group.userData)switch(t.group.userData.type){case y_.drawingTypes.point:e=this.handlePoint(t);break;case y_.drawingTypes.points:e=this.handlePoints(t);break;case y_.drawingTypes.line:e=this.handleLine(t);break;case y_.drawingTypes.lines:e=this.handleLines(t);break;case y_.drawingTypes.polyline:e=this.handlePolyline(t);break;case y_.drawingTypes.polylines:e=this.handlePolylines(t);break;case y_.drawingTypes.verbCurve:e=this.handleVerbCurve(t);break;case y_.drawingTypes.verbCurves:e=this.handleVerbCurves(t);break;case y_.drawingTypes.verbSurface:e=this.handleVerbSurface(t);break;case y_.drawingTypes.verbSurfaces:e=this.handleVerbSurfaces(t);break;case y_.drawingTypes.tag:e=this.handleTag(t);break;case y_.drawingTypes.tags:e=this.handleTags(t)}return e}handle(t,e,i,n){let r=t.options?t.options:e;!t.options&&t.group&&t.group.userData.options&&(r=t.group.userData.options);const s=i(r);return this.applyGlobalSettingsAndMetadataAndShadowCasting(n,r,s),s}handleAsync(t,e,i,n){return P_(this,void 0,void 0,(function*(){let r=t.options?t.options:e;return!t.options&&t.group&&t.group.userData.options&&(r=t.group.userData.options),i(r).then((t=>(this.applyGlobalSettingsAndMetadataAndShadowCasting(n,r,t),t)))}))}applyGlobalSettingsAndMetadataAndShadowCasting(t,e,i){if(i){const n={type:t,options:e};i.userData=i.userData?Object.assign(Object.assign({},i.userData),n):n}}}class D_ extends T_{}function R_(t){let e,i,n,r=-1,s=0;for(let o=0;o<t.length;++o){const a=t[o];if(void 0===e&&(e=a.array.constructor),e!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===r&&(r=a.gpuType),r!==a.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=a.count*i}const o=new e(s),a=new io(o,i,n);let c=0;for(let e=0;e<t.length;++e){const n=t[e];if(n.isInterleavedBufferAttribute){const t=c/i;for(let e=0,r=n.count;e<r;e++)for(let r=0;r<i;r++){const i=n.getComponent(e,r);a.setComponent(e+t,r,i)}}else o.set(n.array,c);c+=n.count*i}return void 0!==r&&(a.gpuType=r),a}var k_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class I_ extends C_{constructor(t,e,i,n,r,s){super(i),this.context=t,this.solidText=e,this.vector=i,this.jscadWorkerManager=n,this.manifoldWorkerManager=r,this.occWorkerManager=s,this.usedMaterials=[]}drawManifoldsOrCrossSections(t){return k_(this,void 0,void 0,(function*(){const e=this.deleteFaceMaterialForWorker(t),i=(yield this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldsOrCrossSections",t)).map((t=>this.handleDecomposedManifold(t,e))).filter((t=>void 0!==t)),n=new Zo;return n.name="manifoldMeshContainer-"+Math.random(),i.forEach((t=>{t.parent=n})),this.context.scene.add(n),n}))}drawManifoldOrCrossSection(t){return k_(this,void 0,void 0,(function*(){const e=this.deleteFaceMaterialForWorker(t),i=yield this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldOrCrossSection",t);return this.handleDecomposedManifold(i,e)}))}drawShape(t){return k_(this,void 0,void 0,(function*(){const e=this.deleteFaceMaterialForWorker(t),i=yield this.occWorkerManager.genericCallToWorkerPromise("shapeToMesh",t);return this.handleDecomposedMesh(t,i,e)}))}drawShapes(t){return k_(this,void 0,void 0,(function*(){const e=this.deleteFaceMaterialForWorker(t),i=yield this.occWorkerManager.genericCallToWorkerPromise("shapesToMeshes",t),n=yield Promise.all(i.map((i=>k_(this,void 0,void 0,(function*(){return this.handleDecomposedMesh(t,i,e)}))))),r=new Zo;return r.name="shapesMeshContainer-"+Math.random(),this.context.scene.add(r),n.forEach((t=>{r.add(t)})),r}))}drawSolidOrPolygonMesh(t){return k_(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("shapeToMesh",t);let i,n;if(t.jscadMesh&&t.updatable?i=t.jscadMesh:(i=new Zo,i.name=`jscadMesh-${Math.random()}`,this.context.scene.add(i)),t.mesh.color&&t.mesh.color.length>0){const e=t.mesh.color;n="#"+new Hs(e[0],e[1],e[2]).getHexString()}else n=Array.isArray(t.colours)?t.colours[0]:t.colours;const r=this.makeMesh(Object.assign(Object.assign({},t),{colour:n}),i,e);return t.jscadMesh=r,r}))}drawSolidOrPolygonMeshes(t){return k_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapesToMeshes",t).then((e=>{let i;t.jscadMesh&&t.updatable?(i=t.jscadMesh,i.clear()):(i=new Zo,i.name=`jscadMeshes-${Math.random()}`);const n=Array.isArray(t.colours)&&t.colours.length===e.length,r=Array.isArray(t.colours);return e.map(((e,s)=>{const o=new Zo;let a;if(o.name=`jscadMeshes-${Math.random()}`,e.color){const t=e.color;a="#"+new Hs(t[0],t[1],t[2]).getHexString()}else a=n?t.colours[s]:r?t.colours[0]:t.colours;const c=this.makeMesh(Object.assign(Object.assign({},t),{colour:a}),o,e);i.add(c)})),this.context.scene.add(i),t.jscadMesh=i,i}))}))}drawPolylinesWithColours(t){let e=t.colours;const i=t.polylines.map(((t,i)=>{const n=t.points;return t.isClosed&&n.push(n[0]),t.color&&(Array.isArray(e)||(e=[]),Array.isArray(t.color)?e[i]="#"+new Hs(t.color[0],t.color[1],t.color[2]).getHexString():e[i]=t.color),n}));let n;t.polylinesMesh&&t.updatable&&(n=t.polylinesMesh.children[0]);const r=this.drawPolylines(n,i,t.updatable,t.size,t.opacity,e);if(t.polylinesMesh&&t.updatable){if(t.polylinesMesh.children[0].name!==r.name){const t=new Zo;return t.name=`polylines-${Math.random()}`,t.add(r),this.context.scene.add(t),t}return t.polylinesMesh}{const t=new Zo;return t.name=`polylines-${Math.random()}`,t.add(r),this.context.scene.add(t),t}}drawPoint(t){const e=[t.point];let i=[];return i=Array.isArray(t.colours)?t.colours:[t.colours],t.pointMesh&&t.updatable?this.updatePointsInstances(t.pointMesh,e):t.pointMesh=this.createPointSpheresMesh(`pointMesh-${Math.random()}`,e,i,t.opacity,t.size,t.updatable),t.pointMesh}drawPolylineClose(t){const e=t.polyline.points;return t.polyline.isClosed&&e.push(e[0]),this.drawPolyline(t.polylineMesh,e,t.updatable,t.size,t.opacity,t.colours)}drawPolyline(t,e,i,n,r,s){let o;t&&t.children.length>0&&(o=t.children[0]);const a=this.drawPolylines(o,[e],i,n,r,s);return t||((t=new Zo).name=`polyline-${Math.random()}`,t.add(a),this.context.scene.add(t)),t}drawCurve(t){const e=t.curve.tessellate();return this.drawPolyline(t.curveMesh,e,t.updatable,t.size,t.opacity,t.colours)}drawPoints(t){const e=t.points;let i=[];return Array.isArray(t.colours)?(i=t.colours,i.length!==t.points.length&&(i=t.points.map((()=>i[0])))):i=t.points.map((()=>t.colours)),t.pointsMesh&&t.updatable?t.pointsMesh.children.length===e.length?this.updatePointsInstances(t.pointsMesh,e):(t.pointsMesh.remove(),t.pointsMesh=this.createPointSpheresMesh(`pointsMesh-${Math.random()}`,e,i,t.opacity,t.size,t.updatable)):t.pointsMesh=this.createPointSpheresMesh(`pointsMesh-${Math.random()}`,e,i,t.opacity,t.size,t.updatable),t.pointsMesh}updatePointsInstances(t,e){const i=t.children,n={};e.forEach(((t,e)=>{n[e]=new br(t[0],t[1],t[2])})),i.forEach((t=>{const e=t.userData.index,i=n[e];t.position.set(i.x,i.y,i.z)}))}drawCurves(t){const e=t.curves.map((t=>({points:t.tessellate()})));return this.drawPolylinesWithColours(Object.assign({polylines:e,polylinesMesh:t.curvesMesh},t))}drawSurfacesMultiColour(t){return t.surfacesMesh&&t.updatable?t.surfacesMesh.clear():(t.surfacesMesh=new Zo,t.surfacesMesh.name=`colouredSurfaces-${Math.random()}`,this.context.scene.add(t.surfacesMesh)),Array.isArray(t.colours)?t.surfaces.forEach(((e,i)=>{const n=this.drawSurface({surface:e,colours:t.colours[i]?t.colours[i]:t.colours[0],updatable:t.updatable,opacity:t.opacity,hidden:t.hidden});t.surfacesMesh.add(n)})):t.surfaces.forEach(((e,i)=>{const n=this.drawSurface({surface:e,colours:t.colours,updatable:t.updatable,opacity:t.opacity,hidden:t.hidden});t.surfacesMesh.add(n)})),t.surfacesMesh}createPointSpheresMesh(t,e,i,n,r,s){const o=e.map(((t,e)=>({position:t,color:i[e],index:e}))),a=Array.from(new Set(i)),c=a.map(((t,e)=>{const i=new qs({name:`mat-${Math.random()}`});i.opacity=n,i.color=new Hs(t);const r=o.filter((e=>e.color===t));return{hex:a,material:i,positions:r}})),l=new Zo;return l.name=t,this.context.scene.add(l),c.forEach((t=>{const e=t.positions.length>1e3?1:6,i=new mh(r,e,e);t.positions.forEach(((e,n)=>{const r=new Xa(i,t.material,1);r.name=`point-${n}-${Math.random()}`,r.position.set(e.position[0],e.position[1],e.position[2]),r.userData={index:e.index},r.visible=!0,l.add(r)}))})),l}createOrUpdateSurfacesMesh(t,e,i,n,r,s){const o=()=>{const e=[];t.forEach((t=>{const i=new xo;i.setAttribute("position",new io(Float32Array.from(t.positions),3)),i.setAttribute("normal",new io(Float32Array.from(t.normals),3)),t.uvs&&(i.setAttribute("uv",new io(Uint32Array.from(t.uvs),2)),i.setAttribute("uv2",new io(Uint32Array.from(t.uvs),2))),i.setIndex(new io(Uint32Array.from(t.indices),1)),e.push(i)}));const i=function(t,e=!1){const i=null!==t[0].index,n=new Set(Object.keys(t[0].attributes)),r=new Set(Object.keys(t[0].morphAttributes)),s={},o={},a=t[0].morphTargetsRelative,c=new xo;let l=0;for(let h=0;h<t.length;++h){const u=t[h];let d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in u.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[t]&&(s[t]=[]),s[t].push(u.attributes[t]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in u.morphAttributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[t]&&(o[t]=[]),o[t].push(u.morphAttributes[t])}if(e){let t;if(i)t=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;t=u.attributes.position.count}c.addGroup(l,t,h),l+=t}}if(i){let e=0;const i=[];for(let n=0;n<t.length;++n){const r=t[n].index;for(let t=0;t<r.count;++t)i.push(r.getX(t)+e);e+=t[n].attributes.position.count}c.setIndex(i)}for(const t in s){const e=R_(s[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+t+" attribute."),null;c.setAttribute(t,e)}for(const t in o){const e=o[t][0].length;if(0===e)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[t]=[];for(let i=0;i<e;++i){const e=[];for(let n=0;n<o[t].length;++n)e.push(o[t][n][i]);const n=R_(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+t+" morphAttribute."),null;c.morphAttributes[t].push(n)}}return c}(e,!1);return i};if(e&&i){e.clear();const t=o();n?e.add(new ko(t,n)):e.add(new ko(t))}else{let t=null;r&&(t=this.context.scene),(e=new Zo).name=`surface-${Math.random()}`,t.add(e);const i=o();n?e.add(new ko(i,n)):e.add(new ko(i))}return s&&(e.visible=!1),e}drawSurface(t){const e=t.surface.tessellate(),i={positions:[],indices:[],normals:[]};let n=0;e.faces.forEach((t=>{n=this.parseFaces(t,e,i,n)}));const r=new Eh;return r.name=`pbr-${Math.random()}`,r.color=new Hs(Array.isArray(t.colours)?t.colours[0]:t.colours),r.metalness=.5,r.roughness=.7,r.opacity=t.opacity,r.alphaTest=1,this.createOrUpdateSurfacesMesh([i],t.surfaceMesh,t.updatable,r,!0,t.hidden)}parseFaces(t,e,i,n){return t.reverse().forEach((t=>{const r=e.normals[t];i.normals.push(r[0],r[1],r[2]);const s=e.points[t];i.positions.push(s[0],s[1],s[2]),i.indices.push(n),n++})),n}makeMesh(t,e,i){const n=new Eh;return n.name=`jscadMaterial-${Math.random()}`,n.color=new Hs(t.colour),n.metalness=.4,n.roughness=.6,n.alphaTest=t.opacity,n.polygonOffsetFactor=0,this.createMesh(i.positions,i.indices,i.normals,e,i.transforms,t.updatable,n),t.hidden&&(e.visible=!1),e}createMesh(t,e,i,n,r,s,o){const a=new xo;a.setAttribute("position",new io(Float32Array.from(t),3)),a.setIndex(new io(Uint32Array.from(e),1)),a.computeVertexNormals();const c=new Jr;c.fromArray(r),n.clear(),n.add(new ko(a,o)),n.applyMatrix4(c)}handleDecomposedMesh(t,e,i){return k_(this,void 0,void 0,(function*(){const n=new Zo;if(n.name="brepMesh-"+Math.random(),this.context.scene.add(n),t.drawFaces&&e&&e.faceList&&e.faceList.length){let r;if(i.faceMaterial)r=i.faceMaterial;else{const e=Array.isArray(t.faceColour)?t.faceColour[0]:t.faceColour,i=t.faceOpacity,n=t.drawEdges?2:0,s=this.usedMaterials.find((t=>t.sceneId===this.context.scene.id&&t.hex===e&&t.alpha===i&&t.zOffset===n));if(this.usedMaterials=this.usedMaterials.filter((t=>t.sceneId===this.context.scene.id)),s)r=s.material;else{const t=new Eh;t.color=new Hs(e),t.metalness=.4,t.roughness=.8,t.alphaTest=i,t.polygonOffset=!0,t.polygonOffsetFactor=n,this.usedMaterials.push({sceneId:this.context.scene.id,hex:e,alpha:i,zOffset:n,material:t}),r=t}}const s=e.faceList.map((t=>({positions:t.vertex_coord,normals:t.normal_coord,indices:t.tri_indexes,uvs:t.uvs}))),o=this.createOrUpdateSurfacesMesh(s,void 0,!1,r,!0,!1);n.add(o)}if(t.drawEdges&&e&&e.edgeList&&e.edgeList.length){const i=[];e.edgeList.forEach((t=>{const e=t.vertex_coord.filter((t=>void 0!==t));i.push(e)}));const r=this.drawPolylines(void 0,i,!1,t.edgeWidth,t.edgeOpacity,t.edgeColour);n.add(r)}if(t.drawVertices&&e&&e.pointsList&&e.pointsList.length){const i=this.drawPoints({points:e.pointsList,opacity:1,size:t.vertexSize,colours:t.vertexColour,updatable:!1});n.add(i)}if(t.drawEdgeIndexes){const i=e.edgeList.map((e=>k_(this,void 0,void 0,(function*(){let i=e.middle_point;void 0===i&&(i=this.computeEdgeMiddlePos(e));const n=new t_.TextDto;return n.text=`${e.edge_index+1}`,n.height=t.edgeIndexHeight,n.lineSpacing=1.5,(yield this.solidText.createVectorText(n)).map((t=>t.map((t=>[t[0],t[1]+.05,0])).map((t=>this.vector.add({first:t,second:i})))))})))),r=yield Promise.all(i),s=this.drawPolylines(void 0,r.flat(),!1,.2,1,t.edgeIndexColour);n.add(s)}if(t.drawFaceIndexes){const i=e.faceList.map((e=>k_(this,void 0,void 0,(function*(){let i=e.center_point;void 0===i&&(i=this.computeFaceMiddlePos(e.vertex_coord_vec));const n=new t_.TextDto;return n.text=`${e.face_index}`,n.height=t.faceIndexHeight,n.lineSpacing=1.5,(yield this.solidText.createVectorText(n)).map((t=>t.map((t=>[t[0],t[1]+.05,0])).map((t=>this.vector.add({first:t,second:i})))))})))),r=yield Promise.all(i);this.drawPolylines(void 0,r.flat(),!1,.2,1,t.faceIndexColour).parent=n}return n}))}drawPolylines(t,e,i,n,r,s){var o;if(e&&e.length>0){const r=[];let a;return e.forEach((t=>{for(let e=0;e<t.length-1;e++){const i=t[e],n=t[e+1];r.push(new br(i[0],i[1],i[2])),r.push(new br(n[0],n[1],n[2]))}})),t&&i&&(null===(o=null==t?void 0:t.userData)||void 0===o?void 0:o.linesForRenderLengths)===e.map((t=>t.length)).toString()?(t.geometry.clearGroups(),t.geometry.setFromPoints(r),t):(a=this.createLineGeometry(r,s,n),a.userData={linesForRenderLengths:e.map((t=>t.length)).toString()},a)}}createLineGeometry(t,e,i){const n=(new xo).setFromPoints(t),r=Array.isArray(e)?new Hs(e[0]):new Hs(e),s=[];for(let e=0;e<t.length;e++)s.push(r.r,r.g,r.b);n.setAttribute("color",new uo(s,3));const o=new Mc({color:16777215,linewidth:i,vertexColors:!0}),a=new Oc(n,o);return a.name="lines-"+Math.random(),a}handleDecomposedManifold(t,e){if(t.vertProperties){const i=t;if(0!==i.triVerts.length){const t=new xo;t.setAttribute("position",new io(i.vertProperties,3)),t.setIndex(new io(i.triVerts,1)),t.computeVertexNormals();const n=new Zo;if(n.name=`manifoldMesh-${Math.random()}`,void 0===e.faceMaterial){const i=new Eh;i.name=`pbr-${Math.random()}`,i.color=new Hs(e.faceColour),i.metalness=.5,i.roughness=.7,i.opacity=e.faceOpacity,i.alphaTest=1,e.computeNormals||(i.flatShading=!0),n.add(new ko(t,i))}else n.add(new ko(t,e.faceMaterial));return this.context.scene.add(n),n}}else{const i=t;if(i.length>0){const t=new Zo;t.name=`manifoldCrossSection-${Math.random()}`;const n=i.map((t=>({points:t.map((t=>[t[0],t[1],0])),isClosed:!0})));return this.drawPolylinesWithColours({polylinesMesh:void 0,polylines:n,updatable:!1,size:e.crossSectionWidth,opacity:e.crossSectionOpacity,colours:e.crossSectionColour}).parent=t,this.context.scene.add(t),t}}}deleteFaceMaterialForWorker(t){const e=Object.assign({},t);return t.faceMaterial&&delete t.faceMaterial,e}}class O_{static get version(){return"1.3.9"}static toString(){return"JavaScript Expression Parser (JSEP) v"+O_.version}static addUnaryOp(t){return O_.max_unop_len=Math.max(t.length,O_.max_unop_len),O_.unary_ops[t]=1,O_}static addBinaryOp(t,e,i){return O_.max_binop_len=Math.max(t.length,O_.max_binop_len),O_.binary_ops[t]=e,i?O_.right_associative.add(t):O_.right_associative.delete(t),O_}static addIdentifierChar(t){return O_.additional_identifier_chars.add(t),O_}static addLiteral(t,e){return O_.literals[t]=e,O_}static removeUnaryOp(t){return delete O_.unary_ops[t],t.length===O_.max_unop_len&&(O_.max_unop_len=O_.getMaxKeyLen(O_.unary_ops)),O_}static removeAllUnaryOps(){return O_.unary_ops={},O_.max_unop_len=0,O_}static removeIdentifierChar(t){return O_.additional_identifier_chars.delete(t),O_}static removeBinaryOp(t){return delete O_.binary_ops[t],t.length===O_.max_binop_len&&(O_.max_binop_len=O_.getMaxKeyLen(O_.binary_ops)),O_.right_associative.delete(t),O_}static removeAllBinaryOps(){return O_.binary_ops={},O_.max_binop_len=0,O_}static removeLiteral(t){return delete O_.literals[t],O_}static removeAllLiterals(){return O_.literals={},O_}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new O_(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map((t=>t.length)))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return O_.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!O_.binary_ops[String.fromCharCode(t)]||O_.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return O_.isIdentifierStart(t)||O_.isDecimalDigit(t)}throwError(t){const e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(O_.hooks[t]){const i={context:this,node:e};return O_.hooks.run(t,i),i.node}return e}searchHook(t){if(O_.hooks[t]){const e={context:this};return O_.hooks[t].find((function(t){return t.call(e.context,e),e.node})),e.node}}gobbleSpaces(){let t=this.code;for(;t===O_.SPACE_CODE||t===O_.TAB_CODE||t===O_.LF_CODE||t===O_.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const t=this.gobbleExpressions(),e=1===t.length?t[0]:{type:O_.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e,i,n=[];for(;this.index<this.expr.length;)if(e=this.code,e===O_.SEMCOL_CODE||e===O_.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())n.push(i);else if(this.index<this.expr.length){if(e===t)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){const t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,O_.max_binop_len),e=t.length;for(;e>0;){if(O_.binary_ops.hasOwnProperty(t)&&(!O_.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!O_.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,n,r,s,o,a,c;if(s=this.gobbleToken(),!s)return s;if(e=this.gobbleBinaryOp(),!e)return s;for(r={value:e,prec:O_.binaryPrecedence(e),right_a:O_.right_associative.has(e)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+e),n=[s,r,o];e=this.gobbleBinaryOp();){if(i=O_.binaryPrecedence(e),0===i){this.index-=e.length;break}r={value:e,prec:i,right_a:O_.right_associative.has(e)},c=e;const a=t=>r.right_a&&t.right_a?i>t.prec:i<=t.prec;for(;n.length>2&&a(n[n.length-2]);)o=n.pop(),e=n.pop().value,s=n.pop(),t={type:O_.BINARY_EXP,operator:e,left:s,right:o},n.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+c),n.push(r,t)}for(a=n.length-1,t=n[a];a>1;)t={type:O_.BINARY_EXP,operator:n[a-1].value,left:n[a-2],right:t},a-=2;return t}gobbleToken(){let t,e,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(t=this.code,O_.isDecimalDigit(t)||t===O_.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===O_.SQUOTE_CODE||t===O_.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===O_.OBRACK_CODE)n=this.gobbleArray();else{for(e=this.expr.substr(this.index,O_.max_unop_len),i=e.length;i>0;){if(O_.unary_ops.hasOwnProperty(e)&&(!O_.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!O_.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;const t=this.gobbleToken();return t||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:O_.UNARY_EXP,operator:e,argument:t,prefix:!0})}e=e.substr(0,--i)}O_.isIdentifierStart(t)?(n=this.gobbleIdentifier(),O_.literals.hasOwnProperty(n.name)?n={type:O_.LITERAL,value:O_.literals[n.name],raw:n.name}:n.name===O_.this_str&&(n={type:O_.THIS_EXP})):t===O_.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===O_.PERIOD_CODE||e===O_.OBRACK_CODE||e===O_.OPAREN_CODE||e===O_.QUMARK_CODE;){let i;if(e===O_.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==O_.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===O_.OBRACK_CODE?((t={type:O_.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()}).property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),e=this.code,e!==O_.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===O_.OPAREN_CODE?t={type:O_.CALL_EXP,arguments:this.gobbleArguments(O_.CPAREN_CODE),callee:t}:(e===O_.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:O_.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t,e,i="";for(;O_.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(this.code===O_.PERIOD_CODE)for(i+=this.expr.charAt(this.index++);O_.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(t=this.char,"e"===t||"E"===t){for(i+=this.expr.charAt(this.index++),t=this.char,"+"!==t&&"-"!==t||(i+=this.expr.charAt(this.index++));O_.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);O_.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+i+this.char+")")}return e=this.code,O_.isIdentifierStart(e)?this.throwError("Variable names cannot start with a number ("+i+this.char+")"):(e===O_.PERIOD_CODE||1===i.length&&i.charCodeAt(0)===O_.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:O_.LITERAL,value:parseFloat(i),raw:i}}gobbleStringLiteral(){let t="";const e=this.index,i=this.expr.charAt(this.index++);let n=!1;for(;this.index<this.expr.length;){let e=this.expr.charAt(this.index++);if(e===i){n=!0;break}if("\\"===e)switch(e=this.expr.charAt(this.index++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return n||this.throwError('Unclosed quote after "'+t+'"'),{type:O_.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(O_.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,O_.isIdentifierPart(t));)this.index++;return{type:O_.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){const e=[];let i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===t){i=!0,this.index++,t===O_.CPAREN_CODE&&n&&n>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}if(r===O_.COMMA_CODE){if(this.index++,n++,n!==e.length)if(t===O_.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===O_.CBRACK_CODE)for(let t=e.length;t<n;t++)e.push(null)}else if(e.length!==n&&0!==n)this.throwError("Expected comma");else{const t=this.gobbleExpression();t&&t.type!==O_.COMPOUND||this.throwError("Expected comma"),e.push(t)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(O_.CPAREN_CODE);if(this.code===O_.CPAREN_CODE)return this.index++,1===t.length?t[0]:!!t.length&&{type:O_.SEQUENCE_EXP,expressions:t};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:O_.ARRAY_EXP,elements:this.gobbleArguments(O_.CBRACK_CODE)}}}const L_=new class{add(t,e,i){if("string"!=typeof arguments[0])for(let t in arguments[0])this.add(t,arguments[0][t],arguments[1]);else(Array.isArray(t)?t:[t]).forEach((function(t){this[t]=this[t]||[],e&&this[t][i?"unshift":"push"](e)}),this)}run(t,e){this[t]=this[t]||[],this[t].forEach((function(t){t.call(e&&e.context?e.context:e,e)}))}};Object.assign(O_,{hooks:L_,plugins:new class{constructor(t){this.jsep=t,this.registered={}}register(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{if("object"!=typeof t||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)}))}}(O_),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),O_.max_unop_len=O_.getMaxKeyLen(O_.unary_ops),O_.max_binop_len=O_.getMaxKeyLen(O_.binary_ops);const U_=t=>new O_(t).parse(),N_=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(O_).filter((t=>!N_.includes(t)&&void 0===U_[t])).forEach((t=>{U_[t]=O_[t]})),U_.Jsep=O_;var W_={name:"ternary",init(t){t.hooks.add("after-expression",(function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;const i=e.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;const r=this.gobbleExpression();if(r||this.throwError("Expected expression"),e.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&t.binary_ops[i.operator]<=.9){let n=i;for(;n.right.operator&&t.binary_ops[n.right.operator]<=.9;)n=n.right;e.node.test=n.right,n.right=e.node,e.node=i}}else this.throwError("Expected :")}}))}};U_.plugins.register(W_);var F_={name:"regex",init(t){t.hooks.add("gobble-token",(function(e){if(47===this.code){const i=++this.index;let n=!1;for(;this.index<this.expr.length;){if(47===this.code&&!n){const n=this.expr.slice(i,this.index);let r,s="";for(;++this.index<this.expr.length;){const t=this.code;if(!(t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57))break;s+=this.char}try{r=new RegExp(n,s)}catch(t){this.throwError(t.message)}return e.node={type:t.LITERAL,value:r,raw:this.expr.slice(i-1,this.index)},e.node=this.gobbleTokenProperty(e.node),e.node}this.code===t.OBRACK_CODE?n=!0:n&&this.code===t.CBRACK_CODE&&(n=!1),this.index+=92===this.code?2:1}this.throwError("Unclosed Regex")}}))}};const B_={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|="]),updateOperators:[43,45],assignmentPrecedence:.9,init(t){const e=[t.IDENTIFIER,t.MEMBER_EXP];function i(t){B_.assignmentOperators.has(t.operator)?(t.type="AssignmentExpression",i(t.left),i(t.right)):t.operator||Object.values(t).forEach((t=>{t&&"object"==typeof t&&i(t)}))}B_.assignmentOperators.forEach((e=>t.addBinaryOp(e,B_.assignmentPrecedence,!0))),t.hooks.add("gobble-token",(function(t){const i=this.code;B_.updateOperators.some((t=>t===i&&t===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,t.node={type:"UpdateExpression",operator:43===i?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},t.node.argument&&e.includes(t.node.argument.type)||this.throwError(`Unexpected ${t.node.operator}`))})),t.hooks.add("after-token",(function(t){if(t.node){const i=this.code;B_.updateOperators.some((t=>t===i&&t===this.expr.charCodeAt(this.index+1)))&&(e.includes(t.node.type)||this.throwError(`Unexpected ${t.node.operator}`),this.index+=2,t.node={type:"UpdateExpression",operator:43===i?"++":"--",argument:t.node,prefix:!1})}})),t.hooks.add("after-expression",(function(t){t.node&&i(t.node)}))}};U_.plugins.register(F_,B_),U_.addUnaryOp("typeof"),U_.addLiteral("null",null),U_.addLiteral("undefined",void 0);const z_={evalAst(t,e){switch(t.type){case"BinaryExpression":case"LogicalExpression":return z_.evalBinaryExpression(t,e);case"Compound":return z_.evalCompound(t,e);case"ConditionalExpression":return z_.evalConditionalExpression(t,e);case"Identifier":return z_.evalIdentifier(t,e);case"Literal":return z_.evalLiteral(t,e);case"MemberExpression":return z_.evalMemberExpression(t,e);case"UnaryExpression":return z_.evalUnaryExpression(t,e);case"ArrayExpression":return z_.evalArrayExpression(t,e);case"CallExpression":return z_.evalCallExpression(t,e);case"AssignmentExpression":return z_.evalAssignmentExpression(t,e);default:throw SyntaxError("Unexpected expression",t)}},evalBinaryExpression:(t,e)=>({"||":(t,e)=>t||e(),"&&":(t,e)=>t&&e(),"|":(t,e)=>t|e(),"^":(t,e)=>t^e(),"&":(t,e)=>t&e(),"==":(t,e)=>t==e(),"!=":(t,e)=>t!=e(),"===":(t,e)=>t===e(),"!==":(t,e)=>t!==e(),"<":(t,e)=>t<e(),">":(t,e)=>t>e(),"<=":(t,e)=>t<=e(),">=":(t,e)=>t>=e(),"<<":(t,e)=>t<<e(),">>":(t,e)=>t>>e(),">>>":(t,e)=>t>>>e(),"+":(t,e)=>t+e(),"-":(t,e)=>t-e(),"*":(t,e)=>t*e(),"/":(t,e)=>t/e(),"%":(t,e)=>t%e()}[t.operator](z_.evalAst(t.left,e),(()=>z_.evalAst(t.right,e)))),evalCompound(t,e){let i;for(let n=0;n<t.body.length;n++){"Identifier"===t.body[n].type&&["var","let","const"].includes(t.body[n].name)&&t.body[n+1]&&"AssignmentExpression"===t.body[n+1].type&&(n+=1);const r=t.body[n];i=z_.evalAst(r,e)}return i},evalConditionalExpression:(t,e)=>z_.evalAst(t.test,e)?z_.evalAst(t.consequent,e):z_.evalAst(t.alternate,e),evalIdentifier(t,e){if(t.name in e)return e[t.name];throw ReferenceError(`${t.name} is not defined`)},evalLiteral:t=>t.value,evalMemberExpression(t,e){if("Identifier"===t.property.type&&"constructor"===t.property.name||"Identifier"===t.object.type&&"constructor"===t.object.name)throw new Error("'constructor' property is disabled");const i=t.computed?z_.evalAst(t.property):t.property.name,n=z_.evalAst(t.object,e),r=n[i];if("function"==typeof r){if(n===Function&&"bind"===i)throw new Error("Function.prototype.bind is disabled");if(n===Function&&("call"===i||"apply"===i))throw new Error("Function.prototype.call and Function.prototype.apply are disabled");return r===Function?r:r.bind(n)}return r},evalUnaryExpression:(t,e)=>({"-":t=>-z_.evalAst(t,e),"!":t=>!z_.evalAst(t,e),"~":t=>~z_.evalAst(t,e),"+":t=>+z_.evalAst(t,e),typeof:t=>typeof z_.evalAst(t,e)}[t.operator](t.argument)),evalArrayExpression:(t,e)=>t.elements.map((t=>z_.evalAst(t,e))),evalCallExpression(t,e){const i=t.arguments.map((t=>z_.evalAst(t,e))),n=z_.evalAst(t.callee,e);if(n===Function)throw new Error("Function constructor is disabled");return n(...i)},evalAssignmentExpression(t,e){if("Identifier"!==t.left.type)throw SyntaxError("Invalid left-hand side in assignment");const i=t.left.name;if("__proto__"===i)throw new Error("Assignment to __proto__ is disabled");const n=z_.evalAst(t.right,e);return e[i]=n,e[i]}};function V_(t,e){return(t=t.slice()).push(e),t}function H_(t,e){return(e=e.slice()).unshift(t),e}class G_ extends Error{constructor(t){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=t,this.name="NewError"}}function j_(t,e,i,n,r){if(!(this instanceof j_))try{return new j_(t,e,i,n,r)}catch(t){if(!t.avoidNew)throw t;return t.value}"string"==typeof t&&(r=n,n=i,i=e,e=t,t=null);const s=t&&"object"==typeof t;if(t=t||{},this.json=t.json||i,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=!Object.hasOwn(t,"wrap")||t.wrap,this.sandbox=t.sandbox||{},this.eval=void 0===t.eval?"safe":t.eval,this.ignoreEvalErrors=void 0!==t.ignoreEvalErrors&&t.ignoreEvalErrors,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||n||null,this.otherTypeCallback=t.otherTypeCallback||r||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},!1!==t.autostart){const n={path:s?t.path:e};s?"json"in t&&(n.json=t.json):n.json=i;const r=this.evaluate(n);if(!r||"object"!=typeof r)throw new G_(r);return r}}j_.prototype.evaluate=function(t,e,i,n){let r=this.parent,s=this.parentProperty,{flatten:o,wrap:a}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,i=i||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,e=e||this.json,(t=t||this.path)&&"object"==typeof t&&!Array.isArray(t)){if(!t.path&&""!==t.path)throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=t),o=Object.hasOwn(t,"flatten")?t.flatten:o,this.currResultType=Object.hasOwn(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=Object.hasOwn(t,"sandbox")?t.sandbox:this.currSandbox,a=Object.hasOwn(t,"wrap")?t.wrap:a,this.currEval=Object.hasOwn(t,"eval")?t.eval:this.currEval,i=Object.hasOwn(t,"callback")?t.callback:i,this.currOtherTypeCallback=Object.hasOwn(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,r=Object.hasOwn(t,"parent")?t.parent:r,s=Object.hasOwn(t,"parentProperty")?t.parentProperty:s,t=t.path}if(r=r||null,s=s||null,Array.isArray(t)&&(t=j_.toPathString(t)),!t&&""!==t||!e)return;const c=j_.toPathArray(t);"$"===c[0]&&c.length>1&&c.shift(),this._hasParentSelector=null;const l=this._trace(c,e,["$"],r,s,i).filter((function(t){return t&&!t.isParentSelector}));return l.length?a||1!==l.length||l[0].hasArrExpr?l.reduce(((t,e)=>{const i=this._getPreferredOutput(e);return o&&Array.isArray(i)?t=t.concat(i):t.push(i),t}),[]):this._getPreferredOutput(l[0]):a?[]:void 0},j_.prototype._getPreferredOutput=function(t){const e=this.currResultType;switch(e){case"all":{const e=Array.isArray(t.path)?t.path:j_.toPathArray(t.path);return t.pointer=j_.toPointer(e),t.path="string"==typeof t.path?t.path:j_.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return j_.toPathString(t[e]);case"pointer":return j_.toPointer(t.path);default:throw new TypeError("Unknown result type")}},j_.prototype._handleCallback=function(t,e,i){if(e){const n=this._getPreferredOutput(t);t.path="string"==typeof t.path?t.path:j_.toPathString(t.path),e(n,i,t)}},j_.prototype._trace=function(t,e,i,n,r,s,o,a){let c;if(!t.length)return c={path:i,value:e,parent:n,parentProperty:r,hasArrExpr:o},this._handleCallback(c,s,"value"),c;const l=t[0],h=t.slice(1),u=[];function d(t){Array.isArray(t)?t.forEach((t=>{u.push(t)})):u.push(t)}if(("string"!=typeof l||a)&&e&&Object.hasOwn(e,l))d(this._trace(h,e[l],V_(i,l),e,l,s,o));else if("*"===l)this._walk(e,(t=>{d(this._trace(h,e[t],V_(i,t),e,t,s,!0,!0))}));else if(".."===l)d(this._trace(h,e,i,n,r,s,o)),this._walk(e,(n=>{"object"==typeof e[n]&&d(this._trace(t.slice(),e[n],V_(i,n),e,n,s,!0))}));else{if("^"===l)return this._hasParentSelector=!0,{path:i.slice(0,-1),expr:h,isParentSelector:!0};if("~"===l)return c={path:V_(i,l),value:r,parent:n,parentProperty:null},this._handleCallback(c,s,"property"),c;if("$"===l)d(this._trace(h,e,i,null,null,s,o));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(l))d(this._slice(l,h,e,i,n,r,s));else if(0===l.indexOf("?(")){if(!1===this.currEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const t=l.replace(/^\?\((.*?)\)$/u,"$1"),o=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(t);o?this._walk(e,(t=>{const a=[o[2]],c=o[1]?e[t][o[1]]:e[t];this._trace(a,c,i,n,r,s,!0).length>0&&d(this._trace(h,e[t],V_(i,t),e,t,s,!0))})):this._walk(e,(o=>{this._eval(t,e[o],o,i,n,r)&&d(this._trace(h,e[o],V_(i,o),e,o,s,!0))}))}else if("("===l[0]){if(!1===this.currEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");d(this._trace(H_(this._eval(l,e,i.at(-1),i.slice(0,-1),n,r),h),e,i,n,r,s,o))}else if("@"===l[0]){let t=!1;const o=l.slice(1,-2);switch(o){case"scalar":e&&["object","function"].includes(typeof e)||(t=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===o&&(t=!0);break;case"integer":!Number.isFinite(e)||e%1||(t=!0);break;case"number":Number.isFinite(e)&&(t=!0);break;case"nonFinite":"number"!=typeof e||Number.isFinite(e)||(t=!0);break;case"object":e&&typeof e===o&&(t=!0);break;case"array":Array.isArray(e)&&(t=!0);break;case"other":t=this.currOtherTypeCallback(e,i,n,r);break;case"null":null===e&&(t=!0);break;default:throw new TypeError("Unknown value type "+o)}if(t)return c={path:i,value:e,parent:n,parentProperty:r},this._handleCallback(c,s,"value"),c}else if("`"===l[0]&&e&&Object.hasOwn(e,l.slice(1))){const t=l.slice(1);d(this._trace(h,e[t],V_(i,t),e,t,s,o,!0))}else if(l.includes(",")){const t=l.split(",");for(const o of t)d(this._trace(H_(o,h),e,i,n,r,s,!0))}else!a&&e&&Object.hasOwn(e,l)&&d(this._trace(h,e[l],V_(i,l),e,l,s,o,!0))}if(this._hasParentSelector)for(let t=0;t<u.length;t++){const i=u[t];if(i&&i.isParentSelector){const a=this._trace(i.expr,e,i.path,n,r,s,o);if(Array.isArray(a)){u[t]=a[0];const e=a.length;for(let i=1;i<e;i++)t++,u.splice(t,0,a[i])}else u[t]=a}}return u},j_.prototype._walk=function(t,e){if(Array.isArray(t)){const i=t.length;for(let t=0;t<i;t++)e(t)}else t&&"object"==typeof t&&Object.keys(t).forEach((t=>{e(t)}))},j_.prototype._slice=function(t,e,i,n,r,s,o){if(!Array.isArray(i))return;const a=i.length,c=t.split(":"),l=c[2]&&Number.parseInt(c[2])||1;let h=c[0]&&Number.parseInt(c[0])||0,u=c[1]&&Number.parseInt(c[1])||a;h=h<0?Math.max(0,h+a):Math.min(a,h),u=u<0?Math.max(0,u+a):Math.min(a,u);const d=[];for(let t=h;t<u;t+=l)this._trace(H_(t,e),i,n,r,s,o,!0).forEach((t=>{d.push(t)}));return d},j_.prototype._eval=function(t,e,i,n,r,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=r,this.currSandbox._$_property=i,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const o=t.includes("@path");o&&(this.currSandbox._$_path=j_.toPathString(n.concat([i])));const a=this.currEval+"Script:"+t;if(!j_.cache[a]){let e=t.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(o&&(e=e.replaceAll("@path","_$_path")),"safe"===this.currEval||!0===this.currEval||void 0===this.currEval)j_.cache[a]=new this.safeVm.Script(e);else if("native"===this.currEval)j_.cache[a]=new this.vm.Script(e);else if("function"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const t=this.currEval;j_.cache[a]=new t(e)}else{if("function"!=typeof this.currEval)throw new TypeError(`Unknown "eval" property "${this.currEval}"`);j_.cache[a]={runInNewContext:t=>this.currEval(e,t)}}}try{return j_.cache[a].runInNewContext(this.currSandbox)}catch(e){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+e.message+": "+t)}},j_.cache={},j_.toPathString=function(t){const e=t,i=e.length;let n="$";for(let t=1;t<i;t++)/^(~|\^|@.*?\(\))$/u.test(e[t])||(n+=/^[0-9*]+$/u.test(e[t])?"["+e[t]+"]":"['"+e[t]+"']");return n},j_.toPointer=function(t){const e=t,i=e.length;let n="";for(let t=1;t<i;t++)/^(~|\^|@.*?\(\))$/u.test(e[t])||(n+="/"+e[t].toString().replaceAll("~","~0").replaceAll("/","~1"));return n},j_.toPathArray=function(t){const{cache:e}=j_;if(e[t])return e[t].concat();const i=[],n=t.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,(function(t,e){return"[#"+(i.push(e)-1)+"]"})).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,(function(t,e){return"['"+e.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"})).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,(function(t,e){return";"+e.split("").join(";")+";"})).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map((function(t){const e=t.match(/#(\d+)/u);return e&&e[1]?i[e[1]]:t}));return e[t]=n,e[t].concat()},j_.prototype.safeVm={Script:class{constructor(t){this.code=t,this.ast=U_(this.code)}runInNewContext(t){const e={...t};return z_.evalAst(this.ast,e)}}},j_.prototype.vm={Script:class{constructor(t){this.code=t}runInNewContext(t){let e=this.code;const i=Object.keys(t),n=[];!function(e,i,n){const r=e.length;for(let n=0;n<r;n++)s=e[n],"function"==typeof t[s]&&i.push(e.splice(n--,1)[0]);var s}(i,n);const r=i.map((e=>t[e]));e=n.reduce(((e,i)=>{let n=t[i].toString();return/function/u.test(n)||(n="function "+n),"var "+i+"="+n+";"+e}),"")+e,/(['"])use strict\1/u.test(e)||i.includes("arguments")||(e="var arguments = undefined;"+e),e=e.replace(/;\s*$/u,"");const s=e.lastIndexOf(";"),o=s>-1?e.slice(0,s+1)+" return "+e.slice(s+1):" return "+e;return new Function(...i,o)(...r)}}};var X_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class q_{constructor(t){this.jscadWorkerManager=t}intersect(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.intersect",t)}))}subtract(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtract",t)}))}union(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.union",t)}))}intersectTwo(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.intersectTwo",t)}))}subtractTwo(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtractTwo",t)}))}unionTwo(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.unionTwo",t)}))}subtractFrom(t){return X_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtractFrom",t)}))}}var Y_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Z_{constructor(t){this.jscadWorkerManager=t}expand(t){return Y_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("expansions.expand",t)}))}offset(t){return Y_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("expansions.offset",t)}))}}var K_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class J_{constructor(t){this.jscadWorkerManager=t}extrudeLinear(t){return K_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeLinear",t)}))}extrudeRectangular(t){return K_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRectangular",t)}))}extrudeRectangularPoints(t){return K_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRectangularPoints",t)}))}extrudeRotate(t){return K_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRotate",t)}))}}var $_=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Q_{constructor(t){this.jscadWorkerManager=t}hullChain(t){return $_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("hulls.hullChain",t)}))}hull(t){return $_(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("hulls.hullChain",t)}))}}var ty=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ey{constructor(t){this.jscadWorkerManager=t}createFromPoints(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createFromPoints",t)}))}createPathsFromPoints(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createPathsFromPoints",t)}))}createFromPolyline(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createFromPolyline",t)}))}createEmpty(){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createEmpty",{})}))}close(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.close",t)}))}appendPoints(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendPoints",t)}))}appendPolyline(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendPolyline",t)}))}appendArc(t){return ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendArc",t)}))}}var iy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ny{constructor(t){this.jscadWorkerManager=t}createFromPoints(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPoints",t)}))}createFromPolyline(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPolyline",t)}))}createFromCurve(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromCurve",t)}))}createFromPath(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPath",t)}))}circle(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.circle",t)}))}ellipse(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.ellipse",t)}))}rectangle(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.rectangle",t)}))}roundedRectangle(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.roundedRectangle",t)}))}square(t){return iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.square",t)}))}star(t){return iy(this,void 0,void 0,(function*(){return yield this.jscadWorkerManager.genericCallToWorkerPromise("polygon.star",t)}))}}var ry=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class sy{constructor(t){this.jscadWorkerManager=t}cube(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cube",t)}))}cubesOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cubesOnCenterPoints",t)}))}cuboid(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cuboid",t)}))}cuboidsOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cuboidsOnCenterPoints",t)}))}cylinderElliptic(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinderElliptic",t)}))}cylinderEllipticOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinderEllipticOnCenterPoints",t)}))}cylinder(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinder",t)}))}cylindersOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylindersOnCenterPoints",t)}))}ellipsoid(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.ellipsoid",t)}))}ellipsoidsOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.ellipsoidsOnCenterPoints",t)}))}geodesicSphere(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.geodesicSphere",t)}))}geodesicSpheresOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.geodesicSpheresOnCenterPoints",t)}))}roundedCuboid(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCuboid",t)}))}roundedCuboidsOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCuboidsOnCenterPoints",t)}))}roundedCylinder(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCylinder",t)}))}roundedCylindersOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCylindersOnCenterPoints",t)}))}sphere(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.sphere",t)}))}spheresOnCenterPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.spheresOnCenterPoints",t)}))}torus(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.torus",t)}))}fromPolygonPoints(t){return ry(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.fromPolygonPoints",t)}))}}var oy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ay{constructor(t){this.jscadWorkerManager=t}cylindricalText(t){return oy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.cylindricalText",t)}))}sphericalText(t){return oy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.sphericalText",t)}))}createVectorText(t){return oy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.createVectorText",t)}))}}class cy{constructor(t){this.jscadWorkerManager=t}colorize(t){return e=this,i=void 0,r=function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("colors.colorize",t)},new((n=void 0)||(n=Promise))((function(t,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}c((r=r.apply(e,i||[])).next())}));var e,i,n,r}}var ly,hy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class uy{constructor(t){this.jscadWorkerManager=t,this.booleans=new q_(t),this.expansions=new Z_(t),this.extrusions=new J_(t),this.hulls=new Q_(t),this.path=new ey(t),this.polygon=new ny(t),this.shapes=new sy(t),this.text=new ay(t),this.colors=new cy(t)}toPolygonPoints(t){return hy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("toPolygonPoints",t)}))}transformSolids(t){return hy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("transformSolids",t)}))}transformSolid(t){return hy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("transformSolid",t)}))}downloadSolidSTL(t){return hy(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadSolidSTL",t);this.downloadFile(e.blob,t.fileName,"stl")}))}downloadSolidsSTL(t){return hy(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadSolidsSTL",t);this.downloadFile(e.blob,t.fileName,"stl")}))}downloadGeometryDxf(t){return hy(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadGeometryDxf",t);this.downloadFile(e.blob,t.fileName,"dxf")}))}downloadGeometry3MF(t){return hy(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadGeometry3MF",t);this.downloadFile(e.blob,t.fileName,"3mf")}))}downloadFile(t,e,i){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.target="_self",r.download=e+"."+i,r.click(),r.remove()}}!function(t){t[t.loading=0]="loading",t[t.loaded=1]="loaded",t[t.initialised=2]="initialised",t[t.computing=3]="computing"}(ly||(ly={}));class dy{constructor(){this.jscadWorkerState$=new kv,this.promisesMade=[]}jscadWorkerAlreadyInitialised(){return!!this.jscadWorker}setJscadWorker(t){this.jscadWorker=t,this.jscadWorker.onmessage=({data:t})=>{if("jscad-initialised"===t)this.jscadWorkerState$.next({state:ly.initialised});else if("busy"===t)this.jscadWorkerState$.next({state:ly.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.jscadWorkerState$.next({state:ly.loaded}):this.jscadWorkerState$.next({state:ly.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,n={uid:i},r=new Promise(((t,e)=>{n.resolve=t,n.reject=e}));return n.promise=r,this.promisesMade.push(n),this.jscadWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),r}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}var py=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class fy{constructor(t){this.manifoldWorkerManager=t}manifoldFromMesh(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.manifoldFromMesh",t)}fromPolygonPoints(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.fromPolygonPoints",t)}cube(t){return py(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.cube",t)}))}sphere(t){return py(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.sphere",t)}))}tetrahedron(){return py(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.tetrahedron",{})}))}cylinder(t){return py(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.cylinder",t)}))}}var my=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class gy{constructor(t){this.manifoldWorkerManager=t}subtract(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.subtract",t)}))}add(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.add",t)}))}intersect(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersect",t)}))}differenceTwo(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.differenceTwo",t)}))}unionTwo(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.unionTwo",t)}))}intersectionTwo(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersectionTwo",t)}))}difference(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.difference",t)}))}union(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.union",t)}))}intersection(t){return my(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersection",t)}))}split(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.split",t)}splitByPlane(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.splitByPlane",t)}splitByPlaneOnOffsets(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.splitByPlaneOnOffsets",t)}trimByPlane(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.trimByPlane",t)}}var vy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class _y{constructor(t){this.manifoldWorkerManager=t}hull(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.hull",t)}))}hullPoints(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.hullPoints",t)}slice(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.slice",t)}))}project(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.project",t)}))}setTolerance(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.setTolerance",t)}))}reserveIds(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.reserveIds",t)}))}asOriginal(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.asOriginal",t)}))}compose(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.compose",t)}))}decompose(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.decompose",t)}))}calculateNormals(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.calculateNormals",t)}))}calculateCurvature(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.calculateCurvature",t)}))}refineToTolerance(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refineToTolerance",t)}))}refineToLength(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refineToLength",t)}))}refine(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refine",t)}))}smoothOut(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.smoothOut",t)}))}smoothByNormals(t){return vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.smoothByNormals",t)}))}}var yy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class xy{constructor(t){this.manifoldWorkerManager=t}scale3D(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.scale3D",t)}))}scale(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.scale",t)}))}mirror(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.mirror",t)}))}translate(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translate",t)}))}translateByVectors(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translateByVectors",t)}))}translateXYZ(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translateXYZ",t)}))}rotate(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.rotate",t)}))}rotateXYZ(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.rotateXYZ",t)}))}transform(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.transform",t)}))}transforms(t){return yy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.transforms",t)}))}}var by=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class My{constructor(t){this.manifoldWorkerManager=t}surfaceArea(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.surfaceArea",t)}))}volume(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.volume",t)}))}isEmpty(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.isEmpty",t)}))}numVert(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numVert",t)}))}numTri(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numTri",t)}))}numEdge(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numEdge",t)}))}numProp(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numProp",t)}))}numPropVert(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numPropVert",t)}))}boundingBox(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.boundingBox",t)}))}tolerance(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.tolerance",t)}))}genus(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.genus",t)}))}minGap(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.minGap",t)}))}originalID(t){return by(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.originalID",t)}))}}var Sy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class wy{constructor(t){this.manifoldWorkerManager=t,this.shapes=new fy(t),this.booleans=new gy(t),this.operations=new _y(t),this.transforms=new xy(t),this.evaluate=new My(t)}manifoldToMesh(t){return Sy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.manifoldToMesh",t)}))}manifoldsToMeshes(t){return Sy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.manifoldsToMeshes",t)}))}}var Ty=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Ey{constructor(t){this.manifoldWorkerManager=t}hull(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.hull",t)}))}extrude(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.extrude",t)}))}revolve(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.revolve",t)}))}offset(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.offset",t)}))}simplify(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.simplify",t)}))}compose(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.compose",t)}))}decompose(t){return Ty(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.decompose",t)}))}}var Cy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Py{constructor(t){this.manifoldWorkerManager=t}create(t){return Cy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.create",t)}))}square(t){return Cy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.square",t)}))}circle(t){return Cy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.circle",t)}))}rectangle(t){return Cy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.rectangle",t)}))}}var Ay=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Dy{constructor(t){this.manifoldWorkerManager=t}scale2D(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.scale2D",t)}))}scale(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.scale",t)}))}mirror(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.mirror",t)}))}translate(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.translate",t)}))}translateXY(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.translateXY",t)}))}rotate(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.rotate",t)}))}transform(t){return Ay(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.transform",t)}))}}var Ry=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ky{constructor(t){this.manifoldWorkerManager=t}subtract(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.subtract",t)}))}add(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.add",t)}))}intersect(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersect",t)}))}differenceTwo(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.differenceTwo",t)}))}unionTwo(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.unionTwo",t)}))}intersectionTwo(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersectionTwo",t)}))}difference(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.difference",t)}))}union(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.union",t)}))}intersection(t){return Ry(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersection",t)}))}}var Iy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Oy{constructor(t){this.manifoldWorkerManager=t}area(t){return Iy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.area",t)}))}isEmpty(t){return Iy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.isEmpty",t)}))}numVert(t){return Iy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.numVert",t)}))}numContour(t){return Iy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.numContour",t)}))}bounds(t){return Iy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.bounds",t)}))}}var Ly=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Uy{constructor(t){this.manifoldWorkerManager=t,this.shapes=new Py(t),this.operations=new Ey(t),this.booleans=new ky(t),this.transforms=new Dy(t),this.evaluate=new Oy(t)}crossSectionToPolygons(t){return Ly(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionToPolygons",t)}))}crossSectionsToPolygons(t){return Ly(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionsToPolygons",t)}))}}class Ny{constructor(t){this.manifoldWorkerManager=t}merge(t){return e=this,i=void 0,r=function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.operations.merge",t)},new((n=void 0)||(n=Promise))((function(t,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}c((r=r.apply(e,i||[])).next())}));var e,i,n,r}}var Wy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Fy{constructor(t){this.manifoldWorkerManager=t}position(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.position",t)}))}verts(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.verts",t)}))}tangent(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.tangent",t)}))}extras(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.extras",t)}))}transform(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.transform",t)}))}numProp(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numProp",t)}))}numVert(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numVert",t)}))}numTri(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numTri",t)}))}numRun(t){return Wy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numRun",t)}))}}class By{constructor(t){this.manifoldWorkerManager=t,this.operations=new Ny(t),this.evaluate=new Fy(t)}}var zy,Vy=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Hy{constructor(t){this.manifoldWorkerManager=t,this.manifold=new wy(t),this.crossSection=new Uy(t),this.mesh=new By(t)}manifoldToMeshPointer(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifoldToMeshPointer",t)}))}decomposeManifoldOrCrossSection(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldOrCrossSection",t)}))}toPolygonPoints(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("toPolygonPoints",t)}))}decomposeManifoldsOrCrossSections(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldsOrCrossSections",t)}))}deleteManifoldOrCrossSection(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("deleteManifoldOrCrossSection",t)}))}deleteManifoldsOrCrossSections(t){return Vy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("deleteManifoldsOrCrossSections",t)}))}}!function(t){t[t.loading=0]="loading",t[t.loaded=1]="loaded",t[t.initialised=2]="initialised",t[t.computing=3]="computing"}(zy||(zy={}));class Gy{constructor(){this.manifoldWorkerState$=new kv,this.promisesMade=[]}manifoldWorkerAlreadyInitialised(){return!!this.manifoldWorker}setManifoldWorker(t){this.manifoldWorker=t,this.manifoldWorker.onmessage=({data:t})=>{if("manifold-initialised"===t)this.manifoldWorkerState$.next({state:zy.initialised});else if("busy"===t)this.manifoldWorkerState$.next({state:zy.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&void 0!==t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.manifoldWorkerState$.next({state:zy.loaded}):this.manifoldWorkerState$.next({state:zy.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,n={uid:i},r=new Promise(((t,e)=>{n.resolve=t,n.reject=e}));return n.promise=r,this.promisesMade.push(n),this.manifoldWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),r}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}var jy,Xy,qy,Yy,Zy,Ky,Jy=i(258);class $y{constructor(t){this.drawHelper=t}}class Qy{constructor(){this.context=new D_,this.jscadWorkerManager=new dy,this.manifoldWorkerManager=new Gy,this.occtWorkerManager=new Ov,this.jscad=new uy(this.jscadWorkerManager),this.manifold=new Hy(this.manifoldWorkerManager);const t=new jv;this.math=new Wv,this.vector=new Hv(this.math,t);const e=new I_(this.context,this.jscad.text,this.vector,this.jscadWorkerManager,this.manifoldWorkerManager,this.occtWorkerManager);this.three=new $y(e),this.tag=new S_(this.context),this.draw=new A_(e,this.context,this.tag),this.color=new Lv(this.math),this.line=new Xv(this.vector,this.point,t),this.transforms=new Gv(this.vector,this.math),this.lists=new Uv,this.point=new Fv(t,this.transforms,this.vector,this.lists),this.polyline=new qv(this.vector,this.point,this.line,t),this.verb=new m_(this.context,t,this.math),this.time=new w_(this.context),this.occt=new n_(this.context,this.occtWorkerManager),this.asset=new b_,this.logic=new Nv,this.json=new M_(this.context),this.text=new zv(this.point),this.dates=new Vv,this.mesh=new Yv(this.vector,this.polyline)}init(t,e,i,n){const r={geom:Jy.geom,core:Jy.core};this.context.scene=t,this.context.verb=r,this.context.jsonpath=j_,e&&this.occtWorkerManager.setOccWorker(e),i&&this.jscadWorkerManager.setJscadWorker(i),n&&this.manifoldWorkerManager.setManifoldWorker(n)}}!function(t){t.low="low",t.middle="middle",t.high="high"}(jy||(jy={}));class tx{constructor(){this.lod=jy.low}}class ex{}class ix{constructor(t,e,i,n,r,s,o,a,c){this.swirl=.6,this.nrOfDivisions=10,this.addRadiusNarrow=.4,this.addRadiusWide=.2,this.addMiddleHeight=1.6,this.addTopHeight=1.5,this.thickness=1,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.swirl=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.addRadiusNarrow=i),void 0!==n&&(this.addRadiusWide=n),void 0!==r&&(this.addMiddleHeight=r),void 0!==s&&(this.addTopHeight=s),void 0!==o&&(this.thickness=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.origin=c)}}class nx{constructor(){this.type="parametric-model",this.name="serenitySwirl"}}class rx{}class sx{constructor(t,e,i,n,r,s,o,a,c,l,h,u){this.profilePoints=[[2,0,0],[4,5,0],[1.5,10,0],[3,14,0]],this.nrOfSides=6,this.nrOfVerticalArches=4,this.archCenterThickness=.8,this.edgesThickness=.2,this.thickness=1,this.baseHeight=.4,this.patchHoles=!0,this.lod=jy.high,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],this.scale=[1,1,1],void 0!==t&&(this.nrOfSides=t),void 0!==e&&(this.nrOfVerticalArches=e),void 0!==i&&(this.archCenterThickness=i),void 0!==n&&(this.edgesThickness=n),void 0!==r&&(this.thickness=r),void 0!==s&&(this.baseHeight=s),void 0!==o&&(this.patchHoles=o),void 0!==a&&(this.lod=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.origin=l),void 0!==h&&(this.direction=h),void 0!==u&&(this.scale=u)}}class ox{constructor(){this.type="parametric-model",this.name="arabicArchway"}}class ax{}class cx{}class lx{}class hx{constructor(t,e,i,n,r,s,o,a){this.textHeading="LOVE YOU",this.textName="NORA",this.fullModel=!0,this.thickness=6,this.decorationThickness=1,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.textHeading=t),void 0!==e&&(this.textName=e),void 0!==i&&(this.fullModel=i),void 0!==n&&(this.thickness=n),void 0!==r&&(this.decorationThickness=r),void 0!==s&&(this.rotation=s),void 0!==o&&(this.origin=o),void 0!==a&&(this.direction=a)}}class ux{constructor(){this.type="parametric-model",this.name="eternalLove"}}class dx{}class px{constructor(t,e,i,n,r,s,o,a,c,l,h,u){this.height=6,this.radiusBottom=4,this.radiusTopOffset=2,this.thickness=.6,this.fillet=.2,this.nrOfHandles=1,this.handleDist=2,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.radiusBottom=e),void 0!==i&&(this.radiusTopOffset=i),void 0!==n&&(this.thickness=n),void 0!==r&&(this.fillet=r),void 0!==s&&(this.nrOfHandles=s),void 0!==o&&(this.handleDist=o),void 0!==a&&(this.precision=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.scale=l),void 0!==h&&(this.origin=h),void 0!==u&&(this.direction=u)}}class fx{constructor(){this.type="parametric-model",this.name="calmCup"}}class mx{}class gx{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x){this.height=8,this.radiusBottom=4,this.radiusTopOffset=2,this.radiusMidOffset=2,this.rotationTopAngle=20,this.rotationMidAngle=20,this.nrSkinCellsVertical=5,this.nrSkinCellsHorizontal=10,this.nrSkinCellDivisionsTop=1,this.nrSkinCellDivisionsBottom=3,this.skinCellOuterHeight=.4,this.skinCellInnerHeight=.3,this.skinCellBottomHeight=.4,this.skinCellTopHeight=.4,this.thickness=.6,this.bottomThickness=1,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.radiusBottom=e),void 0!==i&&(this.radiusTopOffset=i),void 0!==n&&(this.radiusMidOffset=n),void 0!==r&&(this.rotationTopAngle=r),void 0!==s&&(this.rotationMidAngle=s),void 0!==o&&(this.nrSkinCellsVertical=o),void 0!==a&&(this.nrSkinCellsHorizontal=a),void 0!==c&&(this.nrSkinCellDivisionsTop=c),void 0!==l&&(this.nrSkinCellDivisionsBottom=l),void 0!==h&&(this.skinCellOuterHeight=h),void 0!==u&&(this.skinCellInnerHeight=u),void 0!==d&&(this.skinCellBottomHeight=d),void 0!==p&&(this.skinCellTopHeight=p),void 0!==f&&(this.thickness=f),void 0!==m&&(this.bottomThickness=m),void 0!==g&&(this.precision=g),void 0!==v&&(this.rotation=v),void 0!==_&&(this.scale=_),void 0!==y&&(this.origin=y),void 0!==x&&(this.direction=x)}}class vx{constructor(){this.type="parametric-model",this.name="dragonCup"}}class _x{}class yx{}class xx{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v){this.heightBottom=5,this.heightTop=16,this.widthBack=25,this.widthFront=10,this.length=16,this.backOffset=6,this.thickness=.4,this.applyOrnaments=!1,this.filletRadius=2,this.phoneHeight=16.8,this.phoneWidth=7.8,this.phoneThickness=.7,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.heightBottom=t),void 0!==e&&(this.heightTop=e),void 0!==i&&(this.widthBack=i),void 0!==n&&(this.widthFront=n),void 0!==r&&(this.length=r),void 0!==s&&(this.backOffset=s),void 0!==o&&(this.thickness=o),void 0!==a&&(this.applyOrnaments=a),void 0!==c&&(this.filletRadius=c),void 0!==l&&(this.phoneHeight=l),void 0!==h&&(this.phoneWidth=h),void 0!==u&&(this.phoneThickness=u),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdges=p),void 0!==f&&(this.rotation=f),void 0!==m&&(this.scale=m),void 0!==g&&(this.origin=g),void 0!==v&&(this.direction=v)}}class bx{constructor(){this.type="parametric-model",this.name="phoneNest"}}class Mx extends ex{}class Sx{}class wx extends ex{}class Tx{}class Ex{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class Cx{}class Px{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_){this.textTop="Pepper",this.textFront="For Your Spicy Needs",this.nrSides=4,this.nrOffsets=1,this.height=6,this.radiusBase=4,this.radiusOffset=2,this.coverHeight=1,this.baseHeight=1,this.thickness=.6,this.ornamentalThickness=.1,this.nrOrnamnetsPerSide=10,this.invertOrnaments=!1,this.fillet=.2,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.textTop=t),void 0!==e&&(this.textFront=e),void 0!==i&&(this.nrSides=i),void 0!==n&&(this.nrOffsets=n),void 0!==r&&(this.height=r),void 0!==s&&(this.coverHeight=s),void 0!==o&&(this.baseHeight=o),void 0!==a&&(this.radiusBase=a),void 0!==c&&(this.radiusOffset=c),void 0!==l&&(this.thickness=l),void 0!==h&&(this.ornamentalThickness=h),void 0!==u&&(this.nrOrnamnetsPerSide=u),void 0!==d&&(this.invertOrnaments=d),void 0!==p&&(this.fillet=p),void 0!==f&&(this.precision=f),void 0!==m&&(this.rotation=m),void 0!==g&&(this.scale=g),void 0!==v&&(this.origin=v),void 0!==_&&(this.direction=_)}}class Ax{constructor(){this.type="parametric-model",this.name="spicyBox"}}class Dx{}class Rx{}class kx{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b,M,S,w){this.title="Your Name",this.subtitle="And Message",this.includeLogo=!0,this.thickness=.4,this.kerf=.01,this.phoneWidth=8,this.phoneHeight=16,this.phoneThickness=1,this.backLength=10,this.angle=20,this.offsetAroundPhone=.5,this.penShelf=1,this.phoneLockHeight=.5,this.filletRadius=.3,this.includePattern=!1,this.densityPattern=.4,this.holesForWire=!0,this.wireInputThickness=1.5,this.includeModel=!0,this.includeDrawings=!0,this.spacingDrawings=.5,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],this.scale=[1,1,1],void 0!==t&&(this.title=t),void 0!==e&&(this.subtitle=e),void 0!==i&&(this.includeLogo=i),void 0!==n&&(this.thickness=n),void 0!==r&&(this.kerf=r),void 0!==s&&(this.phoneWidth=s),void 0!==o&&(this.phoneHeight=o),void 0!==a&&(this.phoneThickness=a),void 0!==c&&(this.backLength=c),void 0!==l&&(this.angle=l),void 0!==h&&(this.offsetAroundPhone=h),void 0!==u&&(this.penShelf=u),void 0!==d&&(this.phoneLockHeight=d),void 0!==p&&(this.filletRadius=p),void 0!==f&&(this.includePattern=f),void 0!==m&&(this.densityPattern=m),void 0!==g&&(this.holesForWire=g),void 0!==v&&(this.wireInputThickness=v),void 0!==_&&(this.includeModel=_),void 0!==y&&(this.includeDrawings=y),void 0!==x&&(this.spacingDrawings=x),void 0!==b&&(this.rotation=b),void 0!==M&&(this.origin=M),void 0!==S&&(this.direction=S),void 0!==w&&(this.scale=w)}}class Ix{}class Ox{constructor(){this.cutWiresColor="#000000",this.engravingWiresColor="#0000ff",this.fileName="bitbybit-droplets-phone-holder",this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7}}class Lx{constructor(){this.fileName="bitbybit-droplets-phone-holder",this.adjustYZ=!0}}class Ux{constructor(){this.type="parametric-model",this.name="dropletsPhoneHolder"}}class Nx{}class Wx{}class Fx{}class Bx{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b,M,S,w,T,E,C,P,A){this.widthFirstWing=4,this.lengthFirstWing=10,this.terraceWidth=3,this.widthSecondWing=5,this.lengthSecondWing=10,this.heightWalls=3,this.roofAngleFirstWing=15,this.roofAngleSecondWing=25,this.roofOffset=.5,this.roofInsideOverhang=.5,this.roofMaxDistAttachmentBeams=.8,this.roofAttachmentBeamWidth=.2,this.roofAttachmentBeamHeight=.05,this.roofOutsideOverhang=.5,this.columnSize=.3,this.ceilingBeamHeight=.25,this.ceilingBeamWidth=.1,this.nrCeilingBeamsBetweenColumns=3,this.distBetweenColumns=2,this.floorHeight=.1,this.groundLevel=.6,this.facadePanelThickness=.05,this.windowWidthOffset=.1,this.windowHeightOffset=.2,this.windowFrameThickness=.1,this.windowGlassFrameThickness=.05,this.lod=jy.high,this.skinOpacity=1,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.widthFirstWing=t),void 0!==e&&(this.lengthFirstWing=e),void 0!==i&&(this.terraceWidth=i),void 0!==n&&(this.widthSecondWing=n),void 0!==r&&(this.lengthSecondWing=r),void 0!==s&&(this.heightWalls=s),void 0!==o&&(this.roofAngleFirstWing=o),void 0!==a&&(this.roofAngleSecondWing=a),void 0!==c&&(this.roofOffset=c),void 0!==l&&(this.roofInsideOverhang=l),void 0!==h&&(this.roofMaxDistAttachmentBeams=h),void 0!==u&&(this.roofAttachmentBeamWidth=u),void 0!==d&&(this.roofAttachmentBeamHeight=d),void 0!==p&&(this.roofOutsideOverhang=p),void 0!==f&&(this.columnSize=f),void 0!==m&&(this.ceilingBeamHeight=m),void 0!==g&&(this.ceilingBeamWidth=g),void 0!==v&&(this.nrCeilingBeamsBetweenColumns=v),void 0!==_&&(this.distBetweenColumns=_),void 0!==y&&(this.floorHeight=y),void 0!==x&&(this.groundLevel=x),void 0!==b&&(this.facadePanelThickness=b),void 0!==M&&(this.windowWidthOffset=M),void 0!==S&&(this.windowHeightOffset=S),void 0!==w&&(this.windowFrameThickness=w),void 0!==T&&(this.windowGlassFrameThickness=T),void 0!==E&&(this.lod=E),void 0!==C&&(this.skinOpacity=C),void 0!==P&&(this.rotation=P),void 0!==A&&(this.origin=A)}}class zx{constructor(){this.type="parametric-model",this.name="zenHideout"}}class Vx{}class Hx{}class Gx{constructor(){this.wallThickness=.4,this.facadePanelThickness=.05,this.glassFrameThickness=.02,this.glassThickness=.005,this.frameThckness=.05,this.height=3,this.lengthFirst=1,this.lengthSecond=2,this.rotation=0}}class jx{constructor(){this.thickness=.3,this.glassFrameThickness=.02,this.glassThickness=.005,this.frameThickness=.05,this.height=3,this.width=1,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0]}}class Xx extends jx{}class qx extends Gx{}class Yx{constructor(){this.name="sandwitch-panel",this.createWindow=!0,this.createInnerPanel=!0,this.createExteriorPanel=!0,this.wallWidth=.3,this.exteriorPanelWidth=.4,this.exteriorPanelHeight=3,this.exteriorPanelThickness=.05,this.exteriorPanelBottomOffset=0,this.interiorPanelWidth=.4,this.interiorPanelHeight=3,this.interiorPanelThickness=.05,this.interiorPanelBottomOffset=0,this.windowWidthOffset=0,this.windowHeightOffset=0,this.windowFrameThickness=.1,this.windowGlassFrameThickness=.05}}class Zx{constructor(){this.name="sandwitch-panel-flex",this.createInteriorPanel=!0,this.createExteriorPanel=!0,this.wallWidth=.3,this.exteriorPanelThickness=.05,this.interiorPanelThickness=.05,this.interiorPanelPolygonPoints=[],this.exteriorPanelPolygonPoints=[]}}class Kx extends Yx{}class Jx extends Zx{}class $x{}class Qx{}class tb{}class eb{}class ib{}class nb{}class rb{constructor(){this.invert=!1,this.widthFirstLanding=1,this.widthSecondLanding=1,this.lengthFirstWing=2,this.lengthSecondWing=1,this.maxWishedStepHeight=.25,this.stepHeightWidthProportion=1.35,this.totalHeight=1,this.rotation=0,this.origin=[0,0,0]}}class sb extends rb{}class ob{}class ab{constructor(){this.name="roof-cover",this.roofAngle=15,this.roofLength=3,this.roofWidth=3,this.roofOutsideOverhang=.5,this.roofInsideOverhang=1,this.roofOverhangFacade=.1,this.roofThickness=.05,this.roofCoverHeight=.3,this.rotation=0,this.lod=jy.high,this.center=[0,0,0],this.direction=[0,1,0]}}class cb extends ab{}class lb{}class hb{}class ub{constructor(){this.widthFirstWing=1,this.widthSecondWing=2,this.lengthStairFirstWing=2,this.lengthStairSecondWing=1,this.lengthWallFirstWing=2,this.lengthWallSecondWing=1,this.facadePanelThickness=.05,this.wallThickness=3,this.wallHeightExterior=3,this.wallHeightInterior=3,this.windowFrameOffsetTop=.3,this.windowFrameThickness=.1,this.glassFrameThickness=.05,this.doorWidth=1,this.windowWidthOffset=.3,this.stairTotalHeight=1,this.createStair=!1,this.flipDirection=!1,this.rotation=0,this.origin=[0,0,0]}}class db{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d){this.interiorWidth=3,this.interiorLength=3,this.interiorHeight=5,this.thickness=.5,this.holeDiameter=1.5,this.holeDistToBottom=2.5,this.stickLength=1.2,this.stickDiameter=.5,this.baseAttachmentHeight=2,this.roofOverhang=1,this.rotation=0,this.chimneyHeight=1,this.origin=[0,0,0],void 0!==t&&(this.interiorWidth=t),void 0!==e&&(this.interiorLength=e),void 0!==i&&(this.interiorHeight=i),void 0!==n&&(this.thickness=n),void 0!==r&&(this.holeDiameter=r),void 0!==s&&(this.holeDistToBottom=s),void 0!==o&&(this.stickLength=o),void 0!==a&&(this.stickDiameter=a),void 0!==c&&(this.baseAttachmentHeight=c),void 0!==l&&(this.roofOverhang=l),void 0!==h&&(this.rotation=h),void 0!==u&&(this.chimneyHeight=u),void 0!==d&&(this.origin=d)}}class pb{constructor(){this.type="parametric-model",this.name="wingtipVilla"}}class fb{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d){this.interiorWidth=3,this.interiorLength=3,this.interiorHeight=5,this.thickness=.3,this.holeDiameter=1.2,this.holeDistToBottom=2.5,this.stickLength=.9,this.stickDiameter=.3,this.baseAttachmentHeight=2,this.roofOverhang=.5,this.roofAngle=20,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.interiorWidth=t),void 0!==e&&(this.interiorLength=e),void 0!==i&&(this.interiorHeight=i),void 0!==n&&(this.thickness=n),void 0!==r&&(this.holeDiameter=r),void 0!==s&&(this.holeDistToBottom=s),void 0!==o&&(this.stickLength=o),void 0!==a&&(this.stickDiameter=a),void 0!==c&&(this.baseAttachmentHeight=c),void 0!==l&&(this.roofOverhang=l),void 0!==h&&(this.roofAngle=h),void 0!==u&&(this.rotation=u),void 0!==d&&(this.origin=d)}}class mb{constructor(){this.type="parametric-model",this.name="chirpyChalet"}}class gb{}class vb{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f){this.sittingHeight=.45,this.backRestOffset=.1,this.backRestHeight=.7,this.width=.45,this.length=.45,this.thickness=.05,this.nrOrnamentPlanks=7,this.ornamentDepth=.01,this.filletRadius=.05,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.sittingHeight=t),void 0!==e&&(this.backRestOffset=e),void 0!==i&&(this.backRestHeight=i),void 0!==n&&(this.width=n),void 0!==r&&(this.length=r),void 0!==s&&(this.thickness=s),void 0!==o&&(this.nrOrnamentPlanks=o),void 0!==a&&(this.ornamentDepth=a),void 0!==c&&(this.filletRadius=c),void 0!==l&&(this.precision=l),void 0!==h&&(this.drawEdges=h),void 0!==u&&(this.rotation=u),void 0!==d&&(this.scale=d),void 0!==p&&(this.origin=p),void 0!==f&&(this.direction=f)}}class _b{constructor(){this.type="parametric-model",this.name="snakeChair"}}class yb extends ex{}class xb{}class bb extends ex{}class Mb{}class Sb{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class wb{}class Tb{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m){this.height=.74,this.width=1,this.length=2,this.topThickness=.02,this.topOffset=.03,this.bottomThickness=.05,this.minFillet=.2,this.radiusLegTop=.03,this.radiusLegBottom=.01,this.nrLegPairs=2,this.precision=.001,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==n&&(this.topThickness=n),void 0!==r&&(this.topOffset=r),void 0!==s&&(this.bottomThickness=s),void 0!==o&&(this.minFillet=o),void 0!==a&&(this.radiusLegTop=a),void 0!==c&&(this.radiusLegBottom=c),void 0!==l&&(this.nrLegPairs=l),void 0!==h&&(this.precision=h),void 0!==u&&(this.drawEdges=u),void 0!==d&&(this.rotation=d),void 0!==p&&(this.scale=p),void 0!==f&&(this.origin=f),void 0!==m&&(this.direction=m)}}class Eb{constructor(){this.type="parametric-model",this.name="elegantTable"}}class Cb extends ex{}class Pb{}class Ab extends ex{}class Db extends ex{}class Rb{constructor(){this.index=0}}class kb{}class Ib{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class Ob{}class Lb{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g,v){this.height=.4,this.width=1,this.length=1.2,this.chamfer=.01,this.topThickness=.05,this.topGlassOffset=.2,this.glassThickness=.005,this.glassHolderLength=.02,this.shelfTopOffset=.15,this.shelfThickness=.03,this.legWidth=.1,this.legDepth=.05,this.precision=.001,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==n&&(this.chamfer=n),void 0!==r&&(this.topThickness=r),void 0!==s&&(this.topGlassOffset=s),void 0!==o&&(this.glassThickness=o),void 0!==a&&(this.glassHolderLength=a),void 0!==c&&(this.shelfTopOffset=c),void 0!==l&&(this.shelfThickness=l),void 0!==h&&(this.legWidth=h),void 0!==u&&(this.legDepth=u),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdges=p),void 0!==f&&(this.rotation=f),void 0!==m&&(this.scale=m),void 0!==g&&(this.origin=g),void 0!==v&&(this.direction=v)}}class Ub{constructor(){this.type="parametric-model",this.name="goodCoffeeTable"}}class Nb extends ex{}class Wb{}class Fb extends ex{}class Bb extends ex{}class zb extends ex{}class Vb{constructor(){this.index=0}}class Hb{}class Gb{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class jb{}class Xb{constructor(t,e,i,n,r,s,o,a,c,l,h,u,d,p,f,m,g){this.height=.74,this.width=1,this.length=2,this.supportLength=.5,this.shelfHeight=.2,this.thickness=.05,this.glassThickness=.005,this.glassOffset=0,this.nrOrnamentPlanks=7,this.ornamentDepth=.01,this.filletRadius=.05,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==n&&(this.supportLength=n),void 0!==r&&(this.shelfHeight=r),void 0!==s&&(this.thickness=s),void 0!==o&&(this.glassThickness=o),void 0!==a&&(this.glassOffset=a),void 0!==c&&(this.nrOrnamentPlanks=c),void 0!==l&&(this.ornamentDepth=l),void 0!==h&&(this.filletRadius=h),void 0!==u&&(this.precision=u),void 0!==d&&(this.drawEdges=d),void 0!==p&&(this.rotation=p),void 0!==f&&(this.scale=f),void 0!==m&&(this.origin=m),void 0!==g&&(this.direction=g)}}class qb{constructor(){this.type="parametric-model",this.name="snakeTable"}}class Yb extends ex{}class Zb{}class Kb extends ex{}class Jb{}class $b{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}!function(t){t.Aboreto="Aboreto",t.Bungee="Bungee",t.IndieFlower="IndieFlower",t.Lugrasimo="Lugrasimo",t.Orbitron="Orbitron",t.Roboto="Roboto",t.RobotoSlab="RobotoSlab",t.Silkscreen="Silkscreen",t.Tektur="Tektur",t.Workbench="Workbench"}(Xy||(Xy={})),function(t){t.Regular="Regular",t.Black="Black",t.Bold="Bold",t.ExtraBold="ExtraBold",t.Medium="Medium",t.SemiBold="SemiBold",t.BlackItalic="BlackItalic",t.BoldItalic="BoldItalic",t.Italic="Italic",t.Light="Light",t.LightItalic="LightItalic",t.MediumItalic="MediumItalic",t.Thin="Thin",t.ThinItalic="ThinItalic",t.ExtraLight="ExtraLight"}(qy||(qy={})),function(t){t.separatedExtrusion="separatedExtrusion",t.integratedExtrusion="integratedExtrusion",t.cutout="cutout"}(Yy||(Yy={})),function(t){t.compound="compound",t.cutout="originalCutout",t.cutoutInsideCharacter="cutoutInsideCharacter"}(Zy||(Zy={})),function(t){t.leftTop="leftTop",t.leftMiddle="leftMiddle",t.leftBottom="leftBottom",t.centerTop="centerTop",t.centerMiddle="centerMiddle",t.centerBottom="centerBottom",t.rightTop="rightTop",t.rightMiddle="rightMiddle",t.rightBottom="rightBottom"}(Ky||(Ky={}));const Qb=[{key:"Aboreto",variants:["Regular"]},{key:"Bungee",variants:["Regular"]},{key:"IndieFlower",variants:["Regular"]},{key:"Lugrasimo",variants:["Regular"]},{key:"Orbitron",variants:["Black","Bold","ExtraBold","Medium","Regular","SemiBold"]},{key:"Roboto",variants:["Black","BlackItalic","Bold","BoldItalic","Italic","Light","LightItalic","Medium","MediumItalic","Regular","Thin","ThinItalic"]},{key:"RobotoSlab",variants:["Black","Bold","ExtraBold","ExtraLight","Light","Medium","Regular","SemiBold","Thin"]},{key:"Silkscreen",variants:["Bold","Regular"]},{key:"Tektur",variants:["Black","Bold","ExtraBold","Medium","Regular","SemiBold"]},{key:"Workbench",variants:["Regular"]}];class tM{constructor(t,e,i,n,r,s,o,a,c){this.text="bitbybit.dev",this.fontType=Xy.Roboto,this.fontVariant=qy.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.origin=[0,0,0],this.direction=[0,1,0],this.originAlignment=Ky.centerMiddle,void 0!==t&&(this.text=t),void 0!==e&&(this.fontType=e),void 0!==i&&(this.fontVariant=i),void 0!==n&&(this.fontSize=n),void 0!==r&&(this.height=r),void 0!==s&&(this.rotation=s),void 0!==o&&(this.origin=o),void 0!==a&&(this.direction=a),void 0!==c&&(this.originAlignment=c)}}class eM{constructor(t,e,i,n,r,s,o,a,c,l,h,u){this.facePlanar=!1,this.faceTextVar=Yy.separatedExtrusion,this.text="bitbybit.dev",this.fontType=Xy.Roboto,this.fontVariant=qy.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=Ky.centerMiddle,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.faceTextVar=i),void 0!==n&&(this.text=n),void 0!==r&&(this.fontType=r),void 0!==s&&(this.fontVariant=s),void 0!==o&&(this.fontSize=o),void 0!==a&&(this.height=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.originParamU=l),void 0!==h&&(this.originParamV=h),void 0!==u&&(this.originAlignment=u)}}class iM{constructor(){this.type="parametric-model",this.name="text3d"}}class nM{constructor(){this.index=0}}class rM{}class sM{}class oM{constructor(t,e,i,n,r,s,o,a,c,l){this.faceTextVar=Yy.separatedExtrusion,this.text="bitbybit.dev",this.fontType=Xy.Roboto,this.fontVariant=qy.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=Ky.centerMiddle,void 0!==t&&(this.faceTextVar=t),void 0!==e&&(this.text=e),void 0!==i&&(this.fontType=i),void 0!==n&&(this.fontVariant=n),void 0!==r&&(this.fontSize=r),void 0!==s&&(this.height=s),void 0!==o&&(this.rotation=o),void 0!==a&&(this.originParamU=a),void 0!==c&&(this.originParamV=c),void 0!==l&&(this.originAlignment=l)}}class aM{constructor(t,e,i){this.facePlanar=!1,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.definitions=i)}}class cM{constructor(t,e,i,n){this.uNumber=10,this.vNumber=10,this.height=.2,this.precision=.01,void 0!==t&&(this.faces=t),void 0!==n&&(this.height=n)}}class lM{constructor(t,e,i,n,r,s,o){this.uNumber=10,this.vNumber=5,this.defaultHeight=.2,this.affectMinHeight=0,this.affectMaxHeight=1,this.precision=.01,void 0!==t&&(this.faces=t),void 0!==e&&(this.affectorPoints=e),void 0!==i&&(this.uNumber=i),void 0!==n&&(this.vNumber=n),void 0!==r&&(this.affectMinHeight=r),void 0!==s&&(this.affectMaxHeight=s),void 0!==o&&(this.precision=o)}}class hM{constructor(){this.type="parametric-model",this.name="patternsFacePatternPyramidSimple"}}class uM{constructor(){this.index=0}}class dM{}class pM{}class fM{}class mM{}class gM{constructor(){this.faceIndex=0}}class vM{constructor(){this.faceIndex=0,this.uIndex=0,this.vIndex=0}}class _M{constructor(){this.faceIndex=0,this.uIndex=0}}class yM{constructor(){this.faceIndex=0,this.vIndex=0}}class xM{}class bM{}var MM;!function(t){t.wire="wire",t.face="face",t.solid="solid"}(MM||(MM={}));class SM{static parse(t,e){var i;const n=[t],r=new Set;for(;n.length>0;){const t=n.pop();if("object"==typeof t&&null!==t&&!r.has(t))if(r.add(t),Array.isArray(t))for(let e=0;e<t.length;e++)n.push(t[e]);else{if(Object.keys(t).includes("shapes")){const n=t.shapes;if("object"==typeof n&&null!==n)for(const r in n)t.shapes[r]&&(t.shapes[r]=null===(i=e.find((e=>e.id===t.shapes[r])))||void 0===i?void 0:i.shape)}for(const e in t)n.push(t[e])}}return t}}var wM=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class TM{constructor(t,e,i,n){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=n}create(t){return wM(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.text3d",t),i=SM.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createTextOnFace(t){return wM(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.text3dFace",t),i=SM.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createTextsOnFace(t){return wM(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.texts3dFace",t),i=SM.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}definition3dTextOnFace(t){return t}drawModel(t,e=.003){return wM(this,void 0,void 0,(function*(){const i=new Zo;i.name="brepMesh"+Math.random(),this.context.scene.add(i);const n=new y_.DrawOcctShapeOptions;n.faceOpacity=0,n.edgeColour="#bc7e5b",n.edgeWidth=.6,n.precision=e;const r=yield this.draw.drawAnyAsync({entity:t.compound,options:n}),s=new Eh;return s.name="brepMaterial"+Math.random(),s.color=new Hs(1,1,1),s.specularColor=new Hs("#ffffff"),s.metalness=0,s.roughness=.7,s.polygonOffset=!0,s.polygonOffsetUnits=2,r.children[0].material=s,i.add(r),i}))}getCompoundShape(t){return t.model.compound}getCharacterShape(t){if(t.index<0||t.index>=t.model.characterParts.length)throw new Error("Index is out of bounds.");return t.model.characterParts[t.index].shapes.compound}getCharacterShapes(t){return t.model.characterParts.map((t=>t.shapes.compound))}getCharacterCenterCoordinates(t){return t.model.characterCenterCoordinates}getFaceCutout(t){if(t.model.faceParts){const e=t.model.faceParts.filter((t=>t.type===Zy.cutout)).map((t=>t.shapes.face));if(e.length>0)return e[0];throw new Error("No cutout was found.")}throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getAllFacesOfCutout(t){if(t.model.faceParts)return t.model.faceParts.filter((t=>t.type===Zy.cutout||t.type===Zy.cutoutInsideCharacter)).map((t=>t.shapes.face));throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getCutoutsInsideCharacters(t){if(t.model.faceParts)return t.model.faceParts.filter((t=>t.type===Zy.cutoutInsideCharacter)).map((t=>t.shapes.face));throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getAdvanceWidth(t){return t.model.advanceWidth}}var EM,CM=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class PM{constructor(t,e,i,n){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=n}createPyramidSimple(t){return CM(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.pyramidSimple",t),i=SM.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createPyramidSimpleAffectors(t){return CM(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.pyramidSimpleAffectors",t),i=SM.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}drawModel(t){return CM(this,void 0,void 0,(function*(){const e=new Zo;e.name="brepMesh"+Math.random(),this.context.scene.add(e);const i=new y_.DrawOcctShapeOptions;i.faceOpacity=0,i.edgeColour="#bc7e5b",i.edgeWidth=1,i.precision=t.originalInputs.precision;const n=yield this.draw.drawAnyAsync({entity:t.compound,options:i}),r=new Eh;return r.name="brepMaterial"+Math.random(),r.color=new Hs(1,1,1),r.specularColor=new Hs("#ffffff"),r.metalness=.3,r.roughness=.6,r.polygonOffset=!0,r.polygonOffsetUnits=2,n.children[0].material=r,e.add(n),e}))}getCompoundShape(t){return t.model.compound}getCompoundShapeOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compound;throw new Error("Face index is out of range")}getCompoundShapeCellOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length){if(t.uIndex<t.model.originalInputs.uNumber&&t.vIndex<t.model.originalInputs.vNumber){const e=t.model.faceParts[t.faceIndex].cells.find((e=>e.uIndex===t.uIndex&&e.vIndex===t.vIndex));if(e)return e.shapes.compound;throw new Error("Cell does not exist on the face")}throw new Error("Cell u or v index is out of range")}throw new Error("Face index is out of range")}getAllPyramidCells(t){return t.model.faceParts.map((t=>t.cells)).flat()}getAllPyramidCellsOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells;throw new Error("Face index is out of range")}getAllPyramidUCellsOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells;throw new Error("Face index is out of range")}getAllPyramidUCellsOnFaceAtU(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells.filter((e=>e.uIndex===t.uIndex));throw new Error("Face index is out of range")}getAllPyramidUCellsOnFaceAtV(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells.filter((e=>e.vIndex===t.vIndex));throw new Error("Face index is out of range")}getCellOnIndex(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length){if(t.uIndex<t.model.originalInputs.uNumber&&t.vIndex<t.model.originalInputs.vNumber){const e=t.model.faceParts[t.faceIndex].cells.find((e=>e.uIndex===t.uIndex&&e.vIndex===t.vIndex));if(e)return e;throw new Error("Cell does not exist on the face")}throw new Error("Cell u or v index is out of range")}throw new Error("Face index is out of range")}getTopPointsOfCells(t){return t.cells.map((t=>t.topPoint))}getCenterPointsOfCells(t){return t.cells.map((t=>t.centerPoint))}getCornerPointsOfCells(t){return t.cells.map((t=>[t.cornerPoint1,t.cornerPoint2,t.cornerPoint3,t.cornerPoint4].filter((t=>void 0!==t))))}getCornerPointOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.cornerPoint1:1===t.index?e.cornerPoint2:2===t.index?e.cornerPoint3:3===t.index?e.cornerPoint4:void 0));throw new Error("Corner index is out of range")}getCornerNormalOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.cornerNormal1:1===t.index?e.cornerNormal2:2===t.index?e.cornerNormal3:3===t.index?e.cornerNormal4:void 0));throw new Error("Corner index is out of range")}getCornerNormalsOfCells(t){return t.cells.map((t=>[t.cornerNormal1,t.cornerNormal2,t.cornerNormal3,t.cornerNormal4].filter((t=>void 0!==t))))}getCompoundShapesOfCells(t){return t.cells.map((t=>t.shapes.compound))}getFaceShapesOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.shapes.face1:1===t.index?e.shapes.face2:2===t.index?e.shapes.face3:3===t.index?e.shapes.face4:void 0));throw new Error("Face index is out of range")}getWireShapesOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.shapes.wire1:1===t.index?e.shapes.wire2:2===t.index?e.shapes.wire3:3===t.index?e.shapes.wire4:void 0));throw new Error("Wire index is out of range")}getStartPolylineWireU(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.startPolylineWireU;throw new Error("Face index is out of bounds")}getEndPolylineWireU(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.endPolylineWireU;throw new Error("Face index is out of bounds")}getStartPolylineWireV(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.startPolylineWireV;throw new Error("Face index is out of bounds")}getEndPolylineWireV(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.endPolylineWireV;throw new Error("Face index is out of bounds")}getPolylineWiresUCompound(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compoundPolylineWiresU;throw new Error("Face index is out of bounds")}getPolylineWiresVCompound(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compoundPolylineWiresV;throw new Error("Face index is out of bounds")}}class AM{constructor(t,e,i,n){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=n,this.pyramidSimple=new PM(this.occWorkerManager,this.context,this.draw,this.occt)}}class DM{constructor(t,e,i,n){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=n,this.facePatterns=new AM(this.occWorkerManager,this.context,this.draw,this.occt)}}class RM{constructor(t,e,i,n){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=n,this.text3d=new TM(this.occWorkerManager,this.context,this.draw,this.occt),this.patterns=new DM(this.occWorkerManager,this.context,this.draw,this.occt)}}!function(t){t.wingtipVilla="wingtipVilla",t.chirpyChalet="chirpyChalet",t.serenitySwirl="serenitySwirl",t.arabicArchway="arabicArchway",t.zenHideout="zenHideout",t.calmCup="calmCup",t.dragonCup="dragonCup",t.spicyBox="spicyBox",t.phoneNest="phoneNest",t.elegantTable="elegantTable",t.goodCoffeeTable="goodCoffeeTable",t.snakeChair="snakeChair",t.snakeTable="snakeTable",t.eternalLove="eternalLove",t.text3d="text3d",t.patternsFacePatternPyramidSimple="patternsFacePatternPyramidSimple"}(EM||(EM={}));class kM{constructor(t,e,i){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.paths=i)}}class IM{constructor(t,e,i){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.chars=i)}}class OM{}class LM{}class UM{}class NM{constructor(){this.type="text",this.name="text"}}class WM{}class FM extends A_{constructor(t,e,i,n){super(t,n,e),this.drawHelper=t,this.tag=e,this.advanced=i,this.context=n}drawAnyAsync(t){const e=t.entity;if(!e||!e.type||"parametric-model"!==e.type)return super.drawAnyAsync(t);switch(t.options,e.name){case EM.text3d:return this.advanced.text3d.drawModel(e);case EM.patternsFacePatternPyramidSimple:return this.advanced.patterns.facePatterns.pyramidSimple.drawModel(e);default:throw new Error(`Unknown parametric model "${e.name}"`)}}optionsSimple(t){return super.optionsSimple(t)}optionsOcctShape(t){return super.optionsOcctShape(t)}}class BM extends Qy{constructor(){super(),this.advanced=new RM(this.occtWorkerManager,this.context,this.draw,this.occt);const t=new I_(this.context,this.jscad.text,this.vector,this.jscadWorkerManager,this.manifoldWorkerManager,this.occtWorkerManager);this.draw=new FM(t,this.tag,this.advanced,this.context)}}var zM,VM=function(){return VM=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},VM.apply(this,arguments)},HM=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))},GM=function(t,e){var i,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){t.flat="flat"}(zM||(zM={}));var jM=function(){function t(){}return t.handleBlock=function(t,e,i){},t.inputAwaiter=function(e,i,n){return HM(this,void 0,void 0,(function(){var r,s;return GM(this,(function(o){return r=Object.keys(e),s=[],r.forEach((function(t){if(e[t])if(e[t].then)e[t].then((function(i){return e[t]=i,i})),s.push(e[t]);else if(e[t].length&&e[t].length>0&&"string"!=typeof e[t])for(var i=function(i){var n=e[t][i];"object"==typeof n&&null!==n&&n.then&&(n.then((function(n){return e[t][i]=n,n})),s.push(e[t][i]))},n=0;n<e[t].length;n++)i(n)})),s.length>0&&t.startedAsyncTask(i,n,"#eeeeff"),s.length>0?[2,Promise.all(s).then((function(e){return t.finishedAsyncTask(i,n),e}))]:[2,null]}))}))},t.finishedAsyncTask=function(t,e){},t.startedAsyncTask=function(t,e,i){},t.runtimeValidation=function(t,e){},t.validate=function(t,e,i){},t.handleBlockException=function(t,e){},t.errorHappened=function(t,e,i){},t.updateListInputs=function(t){Object.keys(t).forEach((function(e){if(Array.isArray(t[e])){var i=[];t[e].forEach((function(t){if(t&&t.result){var e=t.result;t.transformers&&t.transformers.length&&t.transformers.forEach((function(t){t.type===zM.flat&&(e=e.flat())})),e instanceof Array?i.push.apply(i,e):i.push(e)}})),t[e]=i}}))},t.executeBasedOnTypeAsync=function(t,e,i){return HM(this,void 0,void 0,(function(){var n,r,s,o,a,c,l,h,u;return GM(this,(function(d){switch(d.label){case 0:if(e)return[3,5];c=this.performActionOnAllVariationsSimplified(t,i),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.all(c)];case 2:return n=d.sent(),[3,4];case 3:throw r=d.sent(),new Error(r);case 4:return[3,9];case 5:if(!e)return[3,9];for(s=Object.keys(t),o=s.map((function(e){return t[e]})),a=this.normalizeListsToEqualLength(o),c=[],l=function(t){var e={};s.forEach((function(i,n){e[i]=o[n][t]})),c.push(i(e,t))},h=0;h<a;h++)l(h);d.label=6;case 6:return d.trys.push([6,8,,9]),[4,Promise.all(c)];case 7:return n=d.sent(),[3,9];case 8:throw u=d.sent(),new Error(u);case 9:return[2,n]}}))}))},t.executeBasedOnType=function(t,e,i){var n;if(e){if(e){var r=Object.keys(t),s=r.map((function(e){return t[e]})),o=this.normalizeListsToEqualLength(s);try{n=[];for(var a=function(t){var e={};r.forEach((function(i,n){e[i]=s[n][t]})),n.push(i(e))},c=0;c<o;c++)a(c)}catch(t){throw new Error(t)}}}else try{n=this.performActionOnAllVariationsSimplified(t,i)}catch(t){throw new Error(t)}return n},t.performActionOnAllVariationsSimplified=function(t,e){var i=Object.keys(t),n=[],r=function(s,o){var a,c=0;if(s===i.length)return n.push(e(o,c)),void c++;for(var l=i[s],h=0,u=t[l];h<u.length;h++){var d=u[h],p=VM(VM({},o),((a={})[l]=d,a));r(s+1,p)}};return r(0,t),n},t.normalizeListsToEqualLength=function(t){var e=this.getLongestListLength(t);return t.forEach((function(t){if(t.length<e)for(var i=t[t.length-1],n=e-t.length,r=0;r<n;r++)t.push(i)})),e},t.getLongestListLength=function(t){var e=0;return t.forEach((function(t){t.length>e&&(e=t.length)})),e},t.drawNodeMeshes=function(t,e){return HM(this,void 0,void 0,(function(){var i,n=this;return GM(this,(function(r){switch(r.label){case 0:return i=t.map((function(t){return HM(n,void 0,void 0,(function(){var i,n,r;return GM(this,(function(s){switch(s.label){case 0:return i=t.result,n=[],i instanceof Array&&i.length>0&&i[0]&&i[0].hash?i.forEach((function(t){var i=e.draw.drawAnyAsync({entity:t,options:void 0});n.push(i)})):(r=e.draw.drawAnyAsync({entity:i,options:void 0}),n.push(r)),[4,Promise.all(n)];case 1:return[2,s.sent()]}}))}))})),[4,Promise.all(i)];case 1:return r.sent(),[2]}}))}))},t}();const XM={type:"change"},qM={type:"start"},YM={type:"end"},ZM=new Kr,KM=new Ka,JM=Math.cos(70*Hn.DEG2RAD),$M=new br,QM=2*Math.PI,tS=-1,eS=1e-6;class iS extends xp{constructor(t,e=null){super(t,e),this.state=tS,this.target=new br,this.cursor=new br,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Y.ROTATE,MIDDLE:Y.DOLLY,RIGHT:Y.PAN},this.touches={ONE:Z.ROTATE,TWO:Z.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new br,this._lastQuaternion=new xr,this._lastTargetPosition=new br,this._quat=(new xr).setFromUnitVectors(t.up,new br(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Od,this._sphericalDelta=new Od,this._scale=1,this._panOffset=new br,this._rotateStart=new Gn,this._rotateEnd=new Gn,this._rotateDelta=new Gn,this._panStart=new Gn,this._panEnd=new Gn,this._panDelta=new Gn,this._dollyStart=new Gn,this._dollyEnd=new Gn,this._dollyDelta=new Gn,this._dollyDirection=new br,this._mouse=new Gn,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=rS.bind(this),this._onPointerDown=nS.bind(this),this._onPointerUp=sS.bind(this),this._onContextMenu=dS.bind(this),this._onMouseWheel=cS.bind(this),this._onKeyDown=lS.bind(this),this._onTouchStart=hS.bind(this),this._onTouchMove=uS.bind(this),this._onMouseDown=oS.bind(this),this._onMouseMove=aS.bind(this),this._interceptControlDown=pS.bind(this),this._interceptControlUp=fS.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(XM),this.update(),this.state=tS}update(t=null){const e=this.object.position;$M.copy(e).sub(this.target),$M.applyQuaternion(this._quat),this._spherical.setFromVector3($M),this.autoRotate&&this.state===tS&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=QM:i>Math.PI&&(i-=QM),n<-Math.PI?n+=QM:n>Math.PI&&(n-=QM),this._spherical.theta=i<=n?Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=t!=this._spherical.radius}if($M.setFromSpherical(this._spherical),$M.applyQuaternion(this._quatInverse),e.copy(this.target).add($M),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=$M.length();t=this._clampDistance(e*this._scale);const i=e-t;this.object.position.addScaledVector(this._dollyDirection,i),this.object.updateMatrixWorld(),r=!!i}else if(this.object.isOrthographicCamera){const e=new br(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=i!==this.object.zoom;const n=new br(this._mouse.x,this._mouse.y,0);n.unproject(this.object),this.object.position.sub(n).add(e),this.object.updateMatrixWorld(),t=$M.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(ZM.origin.copy(this.object.position),ZM.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ZM.direction))<JM?this.object.lookAt(this.target):(KM.setFromNormalAndCoplanarPoint(this.object.up,this.target),ZM.intersectPlane(KM,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,!!(r||this._lastPosition.distanceToSquared(this.object.position)>eS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>eS||this._lastTargetPosition.distanceToSquared(this.target)>eS)&&(this.dispatchEvent(XM),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?QM/60*this.autoRotateSpeed*t:QM/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){$M.setFromMatrixColumn(e,0),$M.multiplyScalar(-t),this._panOffset.add($M)}_panUp(t,e){!0===this.screenSpacePanning?$M.setFromMatrixColumn(e,1):($M.setFromMatrixColumn(e,0),$M.crossVectors(this.object.up,$M)),$M.multiplyScalar(t),this._panOffset.add($M)}_pan(t,e){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;$M.copy(n).sub(this.target);let r=$M.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*r/i.clientHeight,this.object.matrix),this._panUp(2*e*r/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=t-i.left,r=e-i.top,s=i.width,o=i.height;this._mouse.x=n/s*2-1,this._mouse.y=-r/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(QM*this._rotateDelta.x/e.clientHeight),this._rotateUp(QM*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(QM*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-QM*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(QM*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-QM*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._panStart.set(i,n)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,n=t.pageY-e.y,r=Math.sqrt(i*i+n*n);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._rotateEnd.set(i,n)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(QM*this._rotateDelta.x/e.clientHeight),this._rotateUp(QM*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,n=t.pageY-e.y,r=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new Gn,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,i={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function nS(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function rS(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function sS(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(YM),this.state=tS;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y})}}function oS(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Y.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=1;break;case Y.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}break;case Y.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}break;default:this.state=tS}this.state!==tS&&this.dispatchEvent(qM)}function aS(t){switch(this.state){case 0:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case 1:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case 2:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function cS(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===tS&&(t.preventDefault(),this.dispatchEvent(qM),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(YM))}function lS(t){!1!==this.enabled&&this._handleKeyDown(t)}function hS(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Z.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=3;break;case Z.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=4;break;default:this.state=tS}break;case 2:switch(this.touches.TWO){case Z.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=5;break;case Z.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=6;break;default:this.state=tS}break;default:this.state=tS}this.state!==tS&&this.dispatchEvent(qM)}function uS(t){switch(this._trackPointer(t),this.state){case 3:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case 4:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=tS}}function dS(t){!1!==this.enabled&&t.preventDefault()}function pS(t){"Control"===t.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function fS(t){"Control"===t.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var mS=Og((function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}}));function gS(t){return function(e){if(function(t){return Ig(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}function vS(t,e,i,n,r){return new _S(t,e,i,n,r)}var _S=function(t){function e(e,i,n,r,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=i?function(t){try{i(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return Ag(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}($g),yS=new cv((function(t){return t.complete()}));function xS(){return new mS}function bS(t,e){var i=arguments.length>=2;return function(n){return n.pipe(t?function(t,e){return gS((function(e,i){var n=0;e.subscribe(vS(i,(function(e){return t.call(undefined,e,n++)&&i.next(e)})))}))}((function(e,i){return t(e,i,n)})):av,1<=0?function(){return yS}:gS((function(t,e){var i=0;t.subscribe(vS(e,(function(t){++i<=1&&(e.next(t),1<=i&&e.complete())})))})),i?function(t){return gS((function(e,i){var n=!1;e.subscribe(vS(i,(function(t){n=!0,i.next(t)}),(function(){n||i.next(t),i.complete()})))}))}(e):(void 0===(r=function(){return new mS})&&(r=xS),gS((function(t,e){var i=!1;t.subscribe(vS(e,(function(t){i=!0,e.next(t)}),(function(){return i?e.complete():e.error(r())})))}))));var r}}var MS,SS,wS=function(){return wS=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},wS.apply(this,arguments)},TS=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))},ES=function(t,e){var i,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){t.rete="rete",t.blockly="blockly",t.typescript="typescript"}(MS||(MS={})),function(t){t.Aboreto="Aboreto",t.Bungee="Bungee",t.IndieFlower="IndieFlower",t.Lugrasimo="Lugrasimo",t.Orbitron="Orbitron",t.Roboto="Roboto",t.RobotoSlab="RobotoSlab",t.Silkscreen="Silkscreen",t.Tektur="Tektur",t.Workbench="Workbench"}(SS||(SS={}));var CS=function(){this.canvasZoneClass="canvasZone",this.enableJSCAD=!0,this.enableOCCT=!0,this.enableManifold=!0,this.enableKeyEventListeners=!0,this.cameraPosition=[0,10,-20],this.cameraTarget=[0,0,0],this.backgroundColor="#ffffff",this.loadFonts=Object.keys(SS)},PS={Things:L,Advanced:z,Inputs:X,Models:j};function AS(){return new DS}var DS=function(){function e(){var t=this;this.bitbybit=new BM,this.registerBeforeRender=function(e){t.bitbybit.context.renderLoopBag.forEach((function(t){return t(e)}))},this.initWithExternalScene=function(e,i){return t.bitbybit.context.scene=e,{scene:e,camera:i}},this.initScene=function(e,i){var n=new ta;e.setClearColor(new Hs(t.options.backgroundColor),1);var r=new Go(70,i.clientWidth/i.clientHeight,.01,1e3),s=t.options.cameraPosition;r.position.set(s[0],s[1],s[2]);var o=t.options.cameraTarget;r.lookAt(new br(o[0],o[1],o[2])),r.aspect=i.clientWidth/i.clientHeight,r.updateProjectionMatrix();var a=new iS(r,e.domElement);window.addEventListener("resize",(function(){r.aspect=i.clientWidth/i.clientHeight,r.updateProjectionMatrix(),e.setSize(i.clientWidth,i.clientHeight)}),!1);var c=new Au(16772863,20);return c.position.set(35,12,-15),n.add(c),t.bitbybit.context.scene=n,e.setAnimationLoop((function(i){t.registerBeforeRender(i),e.render(n,r),a.update()})),{scene:n,camera:r}}}return e.prototype.run=function(e){return TS(this,void 0,void 0,(function(){var i=this;return ES(this,(function(n){return this.options=wS(wS({},new CS),e),[2,new Promise((function(e,n){function r(t){var e='importScripts( "'.concat(t,'" );');return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}try{if(i.options.enableOCCT){var s=r("https://cdn.jsdelivr.net/gh/bitbybit-dev/bitbybit-assets@0.20.3/workers/bitbybit-occt-webworker.js"),o=new Worker(s);o.postMessage({type:"initialise",loadFonts:i.options.loadFonts}),URL.revokeObjectURL(s),i.bitbybit.occtWorkerManager.setOccWorker(o)}if(i.options.enableJSCAD){var a=r("https://cdn.jsdelivr.net/gh/bitbybit-dev/bitbybit-assets@0.20.3/workers/bitbybit-jscad-webworker.js"),c=new Worker(a);URL.revokeObjectURL(a),i.bitbybit.jscadWorkerManager.setJscadWorker(c)}if(i.options.enableManifold){var l=r("https://cdn.jsdelivr.net/gh/bitbybit-dev/bitbybit-assets@0.20.3/workers/bitbybit-manifold-webworker.js"),h=new Worker(l);URL.revokeObjectURL(l),i.bitbybit.manifoldWorkerManager.setManifoldWorker(h)}var u,d,p;if(i.options.externalThreeJSSettings){var f=i.initWithExternalScene(i.options.externalThreeJSSettings.scene,i.options.externalThreeJSSettings.camera);p=i.options.externalThreeJSSettings.renderer,u=f.scene,d=f.camera}else{var m=document.getElementById(i.options.canvasId);m.addEventListener("wheel",(function(t){return t.preventDefault()}));var g=new rg({antialias:!0,canvas:m});g.setSize(m.clientWidth,m.clientHeight),g.setPixelRatio(window.devicePixelRatio/1.5),p=g,f=i.initScene(g,m),u=f.scene,d=f.camera}i.bitbybit.init(u),i.bitbybit.context.canvasZoneClass=i.options.canvasZoneClass,i.bitbybit.context.promptPrintSave=function(t){return console.log("Print save dialog can not be opened in the runner.")},i.bitbybit.context.promptPrint=function(t){return console.log("Print dialog can not be opened in the runner.")},i.options.enableKeyEventListeners&&(document.addEventListener("keypress",(function(t){i.bitbybit.context.keyPressBag.forEach((function(e){e.key===t.key&&e.fn()}))})),document.addEventListener("keydown",(function(t){i.bitbybit.context.currentlyPressedKeys.includes(t.key)||i.bitbybit.context.currentlyPressedKeys.push(t.key),i.bitbybit.context.keyDownBag.forEach((function(e){e.key===t.key&&e.fn()}))})),document.addEventListener("keyup",(function(t){i.bitbybit.context.currentlyPressedKeys.includes(t.key)&&(i.bitbybit.context.currentlyPressedKeys=i.bitbybit.context.currentlyPressedKeys.filter((function(e){return t.key!==e}))),i.bitbybit.context.keyUpBag.forEach((function(e){e.key===t.key&&e.fn()}))})));var v=i.bitbybit.occtWorkerManager.occWorkerState$,_=i.bitbybit.jscadWorkerManager.jscadWorkerState$,y=i.bitbybit.manifoldWorkerManager.manifoldWorkerState$,x=0,b=0,M=function(){x===b&&e({bitbybit:i.bitbybit,Bit:PS,scene:u,camera:d,renderer:p,THREEJS:t})};i.options.enableOCCT&&(b++,v.pipe(bS()).subscribe((function(t){t.state===hv.initialised&&(x++,M())}))),i.options.enableJSCAD&&(b++,_.pipe(bS()).subscribe((function(t){t.state===ly.initialised&&(x++,M())}))),i.options.enableManifold&&(b++,y.pipe(bS()).subscribe((function(t){t.state===zy.initialised&&(x++,M())}))),0===b&&e({bitbybit:i.bitbybit,Bit:PS,scene:u,camera:d,renderer:p,THREEJS:t})}catch(t){n(t)}}))]}))}))},e.prototype.executeScript=function(e,i){return TS(this,void 0,void 0,(function(){var n,r,s,o,a;return ES(this,(function(c){return n=JSON.parse(e),r=function(t){throw new Error(t)},s='\n            "use strict";\n    \n            // make all global things undefined\n    \n            const bitbybitRunnerStart = async () => {\n    \n                const bitbybitRunnerInputs = '.concat(i&&Object.keys(i).length>0?JSON.stringify(i):"{}",';\n                let bitbybitRunnerResult = {};\n                const runContext = "runner";\n                const mockBitbybitRunnerInputs = (inputs) => {\n                }\n                const getBitbybitRunnerInputs = () => {\n                    return bitbybitRunnerInputs;\n                }\n                const setBitbybitRunnerResult = (result) => {\n                    bitbybitRunnerResult = result;\n                }\n                const setBitbybitRunnerResultValue = (prop, value) => {\n                    bitbybitRunnerResult[prop] = value;\n                }\n    \n                const bitbybit = this.bitbybit;\n                const Bit = this.Bit;\n                Bit.mockBitbybitRunnerInputs = mockBitbybitRunnerInputs;\n                Bit.getBitbybitRunnerInputs = getBitbybitRunnerInputs;\n                Bit.setBitbybitRunnerResult = setBitbybitRunnerResult;\n                Bit.setBitbybitRunnerResultValue = setBitbybitRunnerResultValue;\n    \n                const BitByBit = this.BitByBit;\n                const errorHandle = this.errorHandle;\n        \n                const resolve = this.resolve;\n    \n                await ').concat(n.script,"\n                if(bitbybitRunnerResult !== undefined){\n                    resolve(bitbybitRunnerResult);\n                } else {\n                    resolve(undefined);\n                }\n            }\n            \n            bitbybitRunnerStart();\n        "),o={HS:jM,BitByBitContextHelperService:this.bitbybit.context},a={bitbybit:this.bitbybit,THREEJS:t,Bit:PS,BitByBit:o,errorHandle:r},[2,new Promise((function(t){return a.resolve=t,new Function(s).apply(a)}))]}))}))},e.prototype.resetRunnerContext=function(t,e){void 0===e&&(e=!0),e&&this.bitbybit.context.scene.clear();var i=document.getElementById(this.options.canvasId);this.initScene(t,i),this.bitbybit.context.intervalBag.forEach((function(t){return clearInterval(t)})),this.bitbybit.context.timeoutBag.forEach((function(t){return clearTimeout(t)})),this.bitbybit.context.intervalBag.length=0,this.bitbybit.context.timeoutBag.length=0,this.bitbybit.context.renderLoopBag.length=0,this.bitbybit.context.keyPressBag.length=0,this.bitbybit.context.keyDownBag.length=0,this.bitbybit.context.keyUpBag.length=0},e.prototype.cleanOCCTCache=function(){return TS(this,void 0,void 0,(function(){return ES(this,(function(t){return[2,this.bitbybit.occtWorkerManager.cleanAllCache()]}))}))},e.prototype.cleanJSCADCache=function(){return TS(this,void 0,void 0,(function(){return ES(this,(function(t){return[2,this.bitbybit.jscadWorkerManager.cleanAllCache()]}))}))},e.prototype.cleanManifoldCache=function(){return TS(this,void 0,void 0,(function(){return ES(this,(function(t){return[2,this.bitbybit.manifoldWorkerManager.cleanAllCache()]}))}))},e}()})(),n})()));