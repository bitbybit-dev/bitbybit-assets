/*! For license information please see bitbybit-runner-threejs.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.bitbybitRunner=e():t.bitbybitRunner=e()}(this,(()=>(()=>{var t,e,i,r,n={258:t=>{t.exports=function(){var t={},e=this,i=(new Function("try {return this===window;}catch(e){ return false;}"),new Function("try {return this===global;}catch(e){return false;}")),r=new Function("try {return typeof importScripts === 'function';}catch(e){return false;}");if(i()&&r(),i()||r()){var n=e;if(r()){onmessage=function(t){if(t.data.className&&t.data.methodName){var i=(r=t.data.className,n=t.data.methodName,s=e,r.split(".").forEach((function(t){s&&(s=s[t])})),s?s[n]:null);if(!i)return console.error("could not find "+t.data.className+"."+t.data.methodName);postMessage({result:i.apply(null,t.data.args),id:t.data.id})}var r,n,s}}}return function(t,e,i){"use strict";e.geom=e.geom||{},e.exe=e.exe||{},e.eval=e.eval||{},e.core=e.core||{},e.promhx=e.promhx||{};var r={},n=function(){return E.__string_rec(this,"")};function s(t,e){function i(){}i.prototype=t;var r=new i;for(var n in e)r[n]=e[n];return e.toString!==Object.prototype.toString&&(r.toString=e.toString),r}var o=function(){};r.HxOverrides=o,o.__name__=["HxOverrides"],o.strDate=function(t){switch(t.length){case 8:var e=t.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),i.setUTCSeconds(e[2]),i;case 10:var r=t.split("-");return new Date(r[0],r[1]-1,r[2],0,0,0);case 19:var n=t.split(" "),s=n[0].split("-"),o=n[1].split(":");return new Date(s[0],s[1]-1,s[2],o[0],o[1],o[2]);default:throw new C("Invalid date format : "+t)}},o.cca=function(t,e){var i=t.charCodeAt(e);if(i==i)return i},o.substr=function(t,e,i){return null!=e&&0!=e&&null!=i&&i<0?"":(null==i&&(i=t.length),e<0?(e=t.length+e)<0&&(e=0):i<0&&(i=t.length+i-e),t.substr(e,i))},o.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var a=function(){};r.Lambda=a,a.__name__=["Lambda"],a.fold=function(t,e,i){for(var r=se(t)();r.hasNext();)i=e(r.next(),i);return i};var c=function(){this.length=0};r.List=c,c.__name__=["List"],c.prototype={add:function(t){var e=[t];null==this.h?this.h=e:this.q[1]=e,this.q=e,this.length++},pop:function(){if(null==this.h)return null;var t=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,t},isEmpty:function(){return null==this.h},__class__:c},Math.__name__=["Math"];var l=function(){};r.Reflect=l,l.__name__=["Reflect"],l.field=function(t,e){try{return t[e]}catch(t){return t instanceof C&&(t=t.val),null}},l.callMethod=function(t,e,i){return e.apply(t,i)},l.fields=function(t){var e=[];if(null!=t){var i=Object.prototype.hasOwnProperty;for(var r in t)"__id__"!=r&&"hx__closures__"!=r&&i.call(t,r)&&e.push(r)}return e},l.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},l.deleteField=function(t,e){return!!Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],!0)};var h=function(){};r.Std=h,h.__name__=["Std"],h.string=function(t){return E.__string_rec(t,"")},h.parseFloat=function(t){return parseFloat(t)};var u=function(){this.b=""};r.StringBuf=u,u.__name__=["StringBuf"],u.prototype={add:function(t){this.b+=h.string(t)},__class__:u};var d=function(){};r.StringTools=d,d.__name__=["StringTools"],d.fastCodeAt=function(t,e){return t.charCodeAt(e)};var p=r.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};p.TNull=["TNull",0],p.TNull.toString=n,p.TNull.__enum__=p,p.TInt=["TInt",1],p.TInt.toString=n,p.TInt.__enum__=p,p.TFloat=["TFloat",2],p.TFloat.toString=n,p.TFloat.__enum__=p,p.TBool=["TBool",3],p.TBool.toString=n,p.TBool.__enum__=p,p.TObject=["TObject",4],p.TObject.toString=n,p.TObject.__enum__=p,p.TFunction=["TFunction",5],p.TFunction.toString=n,p.TFunction.__enum__=p,p.TClass=function(t){var e=["TClass",6,t];return e.__enum__=p,e.toString=n,e},p.TEnum=function(t){var e=["TEnum",7,t];return e.__enum__=p,e.toString=n,e},p.TUnknown=["TUnknown",8],p.TUnknown.toString=n,p.TUnknown.__enum__=p;var f=function(){};r.Type=f,f.__name__=["Type"],f.getClassName=function(t){var e=t.__name__;return null==e?null:e.join(".")},f.getEnumName=function(t){return t.__ename__.join(".")},f.resolveClass=function(t){var e=r[t];return null!=e&&e.__name__?e:null},f.resolveEnum=function(t){var e=r[t];return null!=e&&e.__ename__?e:null},f.createEmptyInstance=function(t){function e(){}return e.prototype=t.prototype,new e},f.createEnum=function(t,e,i){var r=l.field(t,e);if(null==r)throw new C("No such constructor "+e);if(l.isFunction(r)){if(null==i)throw new C("Constructor "+e+" need parameters");return l.callMethod(t,r,i)}if(null!=i&&0!=i.length)throw new C("Constructor "+e+" does not need parameters");return r},f.getEnumConstructs=function(t){return t.__constructs__.slice()},f.typeof=function(t){switch(typeof t){case"boolean":return p.TBool;case"string":return p.TClass(String);case"number":return Math.ceil(t)==t%2147483648?p.TInt:p.TFloat;case"object":if(null==t)return p.TNull;var e=t.__enum__;if(null!=e)return p.TEnum(e);var i=E.getClass(t);return null!=i?p.TClass(i):p.TObject;case"function":return t.__name__||t.__ename__?p.TObject:p.TFunction;case"undefined":return p.TNull;default:return p.TUnknown}};var m=function(){};r["haxe.IMap"]=m,m.__name__=["haxe","IMap"];var g=function(t,e){this.high=t,this.low=e};r["haxe._Int64.___Int64"]=g,g.__name__=["haxe","_Int64","___Int64"],g.prototype={__class__:g};var v=function(){this.buf=new u,this.cache=[],this.useCache=v.USE_CACHE,this.useEnumIndex=v.USE_ENUM_INDEX,this.shash=new M,this.scount=0};r["haxe.Serializer"]=v,v.__name__=["haxe","Serializer"],v.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.get(t);if(null!=e)return this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e);this.shash.set(t,this.scount++),this.buf.b+="y",null==(t=encodeURIComponent(t)).length?this.buf.b+="null":this.buf.b+=""+t.length,this.buf.b+=":",this.buf.b+=null==t?"null":""+t},serializeRef:function(t){for(var e=typeof t,i=0,r=this.cache.length;i<r;){var n=i++,s=this.cache[n];if(typeof s==e&&s==t)return this.buf.b+="r",this.buf.b+=null==n?"null":""+n,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,i=l.fields(t);e<i.length;){var r=i[e];++e,this.serializeString(r),this.serialize(l.field(t,r))}this.buf.b+="g"},serialize:function(t){var e=f.typeof(t);switch(e[1]){case 0:this.buf.b+="n";break;case 1:var i=t;if(0==i)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==i?"null":""+i;break;case 2:var r=t;isNaN(r)?this.buf.b+="k":isFinite(r)?(this.buf.b+="d",this.buf.b+=null==r?"null":""+r):this.buf.b+=r<0?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 6:var n=e[2];if(n==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(n){case Array:var s=0;this.buf.b+="a";for(var o=t.length,a=0;a<o;){var d=a++;null==t[d]?s++:(s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s),s=0),this.serialize(t[d]))}s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s)),this.buf.b+="h";break;case c:this.buf.b+="l";for(var p=t.h,m=null;null!=p;){var g;m=p[0],p=p[1],g=m,this.serialize(g)}this.buf.b+="h";break;case Date:var _=t;this.buf.b+="v",this.buf.add(_.getTime());break;case M:this.buf.b+="b";for(var b=t,w=b.keys();w.hasNext();){var T=w.next();this.serializeString(T),this.serialize(null!=me[T]?b.getReserved(T):b.h[T])}this.buf.b+="h";break;case y:this.buf.b+="q";for(var P=t,A=P.keys();A.hasNext();){var D=A.next();this.buf.b+=":",this.buf.b+=null==D?"null":""+D,this.serialize(P.h[D])}this.buf.b+="h";break;case x:this.buf.b+="M";for(var k=t,R=k.keys();R.hasNext();){var I=R.next(),O=l.field(I,"__id__");l.deleteField(I,"__id__"),this.serialize(I),I.__id__=O,this.serialize(k.h[I.__id__])}this.buf.b+="h";break;case S:for(var L=t,N=0,F=L.length-2,U=new u,W=v.BASE64;N<F;){var B=L.get(N++),z=L.get(N++),V=L.get(N++);U.add(W.charAt(B>>2)),U.add(W.charAt(63&(B<<4|z>>4))),U.add(W.charAt(63&(z<<2|V>>6))),U.add(W.charAt(63&V))}if(N==F){var H=L.get(N++),G=L.get(N++);U.add(W.charAt(H>>2)),U.add(W.charAt(63&(H<<4|G>>4))),U.add(W.charAt(G<<2&63))}else if(N==F+1){var j=L.get(N++);U.add(W.charAt(j>>2)),U.add(W.charAt(j<<4&63))}var X=U.b;this.buf.b+="s",null==X.length?this.buf.b+="null":this.buf.b+=""+X.length,this.buf.b+=":",this.buf.b+=null==X?"null":""+X;break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(f.getClassName(n)),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(f.getClassName(n)),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 4:if(E.__instanceof(t,pe)){var q=f.getClassName(t);this.buf.b+="A",this.serializeString(q)}else if(E.__instanceof(t,fe))this.buf.b+="B",this.serializeString(f.getEnumName(t));else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 7:var Y=e[2];if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}this.useEnumIndex?this.buf.b+="j":this.buf.b+="w",this.serializeString(f.getEnumName(Y)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=h.string(t[1])):this.serializeString(t[0]),this.buf.b+=":";var Z=t.length;this.buf.b+=h.string(Z-2);for(var J=2;J<Z;){var K=J++;this.serialize(t[K])}this.useCache&&this.cache.push(t);break;case 5:throw new C("Cannot serialize function");default:throw new C("Cannot serialize "+h.string(t))}},__class__:v};var _=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];var e=_.DEFAULT_RESOLVER;null==e&&(e=f,_.DEFAULT_RESOLVER=e),this.setResolver(e)};r["haxe.Unserializer"]=_,_.__name__=["haxe","Unserializer"],_.initCodes=function(){for(var t=[],e=0,i=_.BASE64.length;e<i;){var r=e++;t[_.BASE64.charCodeAt(r)]=r}return t},_.prototype={setResolver:function(t){this.resolver=null==t?{resolveClass:function(t){return null},resolveEnum:function(t){return null}}:t},get:function(t){return this.buf.charCodeAt(t)},readDigits:function(){for(var t=0,e=!1,i=this.pos;;){var r=this.buf.charCodeAt(this.pos);if(r!=r)break;if(45!=r){if(r<48||r>57)break;t=10*t+(r-48),this.pos++}else{if(this.pos!=i)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if(!(e>=43&&e<58||101==e||69==e))break;this.pos++}return h.parseFloat(o.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw new C("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw new C("Invalid object key");var i=this.unserialize();t[e]=i}this.pos++},unserializeEnum:function(t,e){if(58!=this.get(this.pos++))throw new C("Invalid enum format");var i=this.readDigits();if(0==i)return f.createEnum(t,e);for(var r=[];i-- >0;)r.push(this.unserialize());return f.createEnum(t,e,r)},unserialize:function(){switch(this.get(this.pos++)){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var t=this.readDigits();if(58!=this.get(this.pos++)||this.length-this.pos<t)throw new C("Invalid string length");var e=o.substr(this.buf,this.pos,t);return this.pos+=t,e=decodeURIComponent(e.split("+").join(" ")),this.scache.push(e),e;case 107:return NaN;case 109:return-1/0;case 112:return 1/0;case 97:this.buf;var i=[];for(this.cache.push(i);;){var r=this.buf.charCodeAt(this.pos);if(104==r){this.pos++;break}if(117==r){this.pos++;var n=this.readDigits();i[i.length+n-1]=null}else i.push(this.unserialize())}return i;case 111:var s={};return this.cache.push(s),this.unserializeObject(s),s;case 114:var a=this.readDigits();if(a<0||a>=this.cache.length)throw new C("Invalid reference");return this.cache[a];case 82:var l=this.readDigits();if(l<0||l>=this.scache.length)throw new C("Invalid string reference");return this.scache[l];case 120:throw new C(this.unserialize());case 99:var h=this.unserialize(),u=this.resolver.resolveClass(h);if(null==u)throw new C("Class not found "+h);var p=f.createEmptyInstance(u);return this.cache.push(p),this.unserializeObject(p),p;case 119:var m=this.unserialize(),g=this.resolver.resolveEnum(m);if(null==g)throw new C("Enum not found "+m);var v=this.unserializeEnum(g,this.unserialize());return this.cache.push(v),v;case 106:var b=this.unserialize(),w=this.resolver.resolveEnum(b);if(null==w)throw new C("Enum not found "+b);this.pos++;var T=this.readDigits(),E=f.getEnumConstructs(w)[T];if(null==E)throw new C("Unknown enum index "+b+"@"+T);var P=this.unserializeEnum(w,E);return this.cache.push(P),P;case 108:var A=new c;for(this.cache.push(A),this.buf;104!=this.buf.charCodeAt(this.pos);)A.add(this.unserialize());return this.pos++,A;case 98:var D=new M;for(this.cache.push(D),this.buf;104!=this.buf.charCodeAt(this.pos);){var k=this.unserialize();D.set(k,this.unserialize())}return this.pos++,D;case 113:var R=new y;this.cache.push(R),this.buf;for(var I=this.get(this.pos++);58==I;){var O=this.readDigits();R.set(O,this.unserialize()),I=this.get(this.pos++)}if(104!=I)throw new C("Invalid IntMap format");return R;case 77:var L=new x;for(this.cache.push(L),this.buf;104!=this.buf.charCodeAt(this.pos);){var N=this.unserialize();L.set(N,this.unserialize())}return this.pos++,L;case 118:var F;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)){var U=o.substr(this.buf,this.pos,19);F=o.strDate(U),this.pos+=19}else{var W=this.readFloat(),B=new Date;B.setTime(W),F=B}return this.cache.push(F),F;case 115:var z=this.readDigits(),V=this.buf;if(58!=this.get(this.pos++)||this.length-this.pos<z)throw new C("Invalid bytes length");var H=_.CODES;null==H&&(H=_.initCodes(),_.CODES=H);var G,j=this.pos,X=3&z;G=3*(z>>2)+(X>=2?X-1:0);for(var q=j+(z-X),Y=S.alloc(G),Z=0;j<q;){var J=H[d.fastCodeAt(V,j++)],K=H[d.fastCodeAt(V,j++)];Y.set(Z++,J<<2|K>>4);var $=H[d.fastCodeAt(V,j++)];Y.set(Z++,K<<4|$>>2);var Q=H[d.fastCodeAt(V,j++)];Y.set(Z++,$<<6|Q)}if(X>=2){var tt=H[d.fastCodeAt(V,j++)],et=H[d.fastCodeAt(V,j++)];if(Y.set(Z++,tt<<2|et>>4),3==X){var it=H[d.fastCodeAt(V,j++)];Y.set(Z++,et<<4|it>>2)}}return this.pos+=z,this.cache.push(Y),Y;case 67:var rt=this.unserialize(),nt=this.resolver.resolveClass(rt);if(null==nt)throw new C("Class not found "+rt);var st=f.createEmptyInstance(nt);if(this.cache.push(st),st.hxUnserialize(this),103!=this.get(this.pos++))throw new C("Invalid custom data");return st;case 65:var ot=this.unserialize(),at=this.resolver.resolveClass(ot);if(null==at)throw new C("Class not found "+ot);return at;case 66:var ct=this.unserialize(),lt=this.resolver.resolveEnum(ct);if(null==lt)throw new C("Enum not found "+ct);return lt}throw this.pos--,new C("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:_};var y=function(){this.h={}};r["haxe.ds.IntMap"]=y,y.__name__=["haxe","ds","IntMap"],y.__interfaces__=[m],y.prototype={set:function(t,e){this.h[t]=e},remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(0|e);return o.iter(t)},__class__:y};var x=function(){this.h={},this.h.__keys__={}};r["haxe.ds.ObjectMap"]=x,x.__name__=["haxe","ds","ObjectMap"],x.__interfaces__=[m],x.prototype={set:function(t,e){var i=t.__id__||(t.__id__=++x.count);this.h[i]=e,this.h.__keys__[i]=t},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return o.iter(t)},__class__:x};var b=r["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};b.Some=function(t){var e=["Some",0,t];return e.__enum__=b,e.toString=n,e},b.None=["None",1],b.None.toString=n,b.None.__enum__=b;var M=function(){this.h={}};r["haxe.ds.StringMap"]=M,M.__name__=["haxe","ds","StringMap"],M.__interfaces__=[m],M.prototype={set:function(t,e){null!=me[t]?this.setReserved(t,e):this.h[t]=e},get:function(t){return null!=me[t]?this.getReserved(t):this.h[t]},setReserved:function(t,e){null==this.rh&&(this.rh={}),this.rh["$"+t]=e},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},keys:function(){var t=this.arrayKeys();return o.iter(t)},arrayKeys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(e);if(null!=this.rh)for(var e in this.rh)36==e.charCodeAt(0)&&t.push(e.substr(1));return t},__class__:M};var S=function(t){this.length=t.byteLength,this.b=new ve(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};r["haxe.io.Bytes"]=S,S.__name__=["haxe","io","Bytes"],S.alloc=function(t){return new S(new ge(t))},S.prototype={get:function(t){return this.b[t]},set:function(t,e){this.b[t]=255&e},__class__:S};var w=r["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};w.Blocked=["Blocked",0],w.Blocked.toString=n,w.Blocked.__enum__=w,w.Overflow=["Overflow",1],w.Overflow.toString=n,w.Overflow.__enum__=w,w.OutsideBounds=["OutsideBounds",2],w.OutsideBounds.toString=n,w.OutsideBounds.__enum__=w,w.Custom=function(t){var e=["Custom",3,t];return e.__enum__=w,e.toString=n,e};var T=function(){};r["haxe.io.FPHelper"]=T,T.__name__=["haxe","io","FPHelper"],T.i32ToFloat=function(t){var e=t>>>23&255,i=8388607&t;return 0==i&&0==e?0:(1-(t>>>31<<1))*(1+Math.pow(2,-23)*i)*Math.pow(2,e-127)},T.floatToI32=function(t){if(0==t)return 0;var e;e=t<0?-t:t;var i=Math.floor(Math.log(e)/.6931471805599453);return i<-127?i=-127:i>128&&(i=128),(t<0?-2147483648:0)|i+127<<23|8388607&Math.round(8388608*(e/Math.pow(2,i)-1))},T.i64ToDouble=function(t,e){var i=(e>>20&2047)-1023,r=4294967296*(1048575&e)+2147483648*(t>>>31)+(2147483647&t);return 0==r&&-1023==i?0:(1-(e>>>31<<1))*(1+Math.pow(2,-52)*r)*Math.pow(2,i)},T.doubleToI64=function(t){var e=T.i64tmp;if(0==t)e.low=0,e.high=0;else{var i;i=t<0?-t:t;var r,n=Math.floor(Math.log(i)/.6931471805599453),s=4503599627370496*(i/Math.pow(2,n)-1),o=0|(r=Math.round(s)),a=r/4294967296|0;e.low=o,e.high=(t<0?-2147483648:0)|n+1023<<20|a}return e};var C=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,C)};r["js._Boot.HaxeError"]=C,C.__name__=["js","_Boot","HaxeError"],C.__super__=Error,C.prototype=s(Error.prototype,{__class__:C});var E=function(){};r["js.Boot"]=E,E.__name__=["js","Boot"],E.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;var i=E.__nativeClassName(t);return null!=i?E.__resolveNativeClass(i):null},E.__string_rec=function(t,e){if(null==t)return"null";if(e.length>=5)return"<...>";var i=typeof t;switch("function"==i&&(t.__name__||t.__ename__)&&(i="object"),i){case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var r=t[0]+"(";e+="\t";for(var n=2,s=t.length;n<s;){var o=n++;r+=2!=o?","+E.__string_rec(t[o],e):E.__string_rec(t[o],e)}return r+")"}var a=t.length,c="[";e+="\t";for(var l=0;l<a;){var h=l++;c+=(h>0?",":"")+E.__string_rec(t[h],e)}return c+"]"}var u;try{u=t.toString}catch(t){return t instanceof C&&(t=t.val),"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var d=t.toString();if("[object Object]"!=d)return d}var p=null,f="{\n";e+="\t";var m=null!=t.hasOwnProperty;for(var p in t)m&&!t.hasOwnProperty(p)||"prototype"!=p&&"__class__"!=p&&"__super__"!=p&&"__interfaces__"!=p&&"__properties__"!=p&&(2!=f.length&&(f+=", \n"),f+=e+p+" : "+E.__string_rec(t[p],e));return f+"\n"+(e=e.substring(1))+"}";case"function":return"<function>";case"string":return t;default:return String(t)}},E.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var r=0,n=i.length;r<n;){var s=i[r++];if(s==e||E.__interfLoop(s,e))return!0}return E.__interfLoop(t.__super__,e)},E.__instanceof=function(t,e){if(null==e)return!1;switch(e){case le:return(0|t)===t;case ue:return"number"==typeof t;case de:return"boolean"==typeof t;case String:return"string"==typeof t;case Array:return t instanceof Array&&null==t.__enum__;case he:return!0;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(E.__interfLoop(E.getClass(t),e))return!0}else if("object"==typeof e&&E.__isNativeObj(e)&&t instanceof e)return!0;return e==pe&&null!=t.__name__||e==fe&&null!=t.__ename__||t.__enum__==e}},E.__nativeClassName=function(t){var e=E.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},E.__isNativeObj=function(t){return null!=E.__nativeClassName(t)},E.__resolveNativeClass=function(t){return i[t]};var P=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var e=t;this.a=[];for(var i=0;i<e;){var r=i++;this.a[r]=0}this.byteLength=e}};r["js.html.compat.ArrayBuffer"]=P,P.__name__=["js","html","compat","ArrayBuffer"],P.sliceImpl=function(t,e){var i=new ve(this,t,null==e?null:e-t),r=new ge(i.byteLength);return new ve(r).set(i),r},P.prototype={slice:function(t,e){return new P(this.a.slice(t,e))},__class__:P};var A=function(t,e,i){if(this.buf=t,this.offset=null==e?0:e,this.length=null==i?t.byteLength-this.offset:i,this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new C(w.OutsideBounds)};r["js.html.compat.DataView"]=A,A.__name__=["js","html","compat","DataView"],A.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];return e>=128?e-256:e},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var i=this.getUint16(t,e);return i>=32768?i-65536:i},getUint16:function(t,e){return e?this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8:this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var i=this.offset+t,r=this.buf.a[i++],n=this.buf.a[i++],s=this.buf.a[i++],o=this.buf.a[i++];return e?r|n<<8|s<<16|o<<24:o|s<<8|n<<16|r<<24},getUint32:function(t,e){var i=this.getInt32(t,e);return i<0?i+4294967296:i},getFloat32:function(t,e){return T.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var i=this.getInt32(t,e),r=this.getInt32(t+4,e);return T.i64ToDouble(e?i:r,e?r:i)},setInt8:function(t,e){this.buf.a[t+this.offset]=e<0?e+128&255:255&e},setUint8:function(t,e){this.buf.a[t+this.offset]=255&e},setInt16:function(t,e,i){this.setUint16(t,e<0?e+65536:e,i)},setUint16:function(t,e,i){var r=t+this.offset;i?(this.buf.a[r]=255&e,this.buf.a[r++]=e>>8&255):(this.buf.a[r++]=e>>8&255,this.buf.a[r]=255&e)},setInt32:function(t,e,i){this.setUint32(t,e,i)},setUint32:function(t,e,i){var r=t+this.offset;i?(this.buf.a[r++]=255&e,this.buf.a[r++]=e>>8&255,this.buf.a[r++]=e>>16&255,this.buf.a[r++]=e>>>24):(this.buf.a[r++]=e>>>24,this.buf.a[r++]=e>>16&255,this.buf.a[r++]=e>>8&255,this.buf.a[r++]=255&e)},setFloat32:function(t,e,i){this.setUint32(t,T.floatToI32(e),i)},setFloat64:function(t,e,i){var r=T.doubleToI64(e);i?(this.setUint32(t,r.low),this.setUint32(t,r.high)):(this.setUint32(t,r.high),this.setUint32(t,r.low))},__class__:A};var D=function(){};r["js.html.compat.Uint8Array"]=D,D.__name__=["js","html","compat","Uint8Array"],D._new=function(t,e,i){var r;if("number"==typeof t){r=[];for(var n=0;n<t;)r[n++]=0;r.byteLength=r.length,r.byteOffset=0,r.buffer=new P(r)}else if(E.__instanceof(t,P)){var s=t;null==e&&(e=0),null==i&&(i=s.byteLength-e),(r=0==e?s.a:s.a.slice(e,e+i)).byteLength=r.length,r.byteOffset=e,r.buffer=s}else{if(!(t instanceof Array&&null==t.__enum__))throw new C("TODO "+h.string(t));(r=t.slice()).byteLength=r.length,r.byteOffset=0,r.buffer=new P(r)}return r.subarray=D._subarray,r.set=D._set,r},D._set=function(t,e){var i=this;if(E.__instanceof(t.buffer,P)){var r=t;if(t.byteLength+e>i.byteLength)throw new C("set() outside of range");for(var n=0,s=t.byteLength;n<s;){var o=n++;i[o+e]=r[o]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new C("TODO");var a=t;if(a.length+e>i.byteLength)throw new C("set() outside of range");for(var c=0,l=a.length;c<l;){var h=c++;i[h+e]=a[h]}}},D._subarray=function(t,e){var i=D._new(this.slice(t,e));return i.byteOffset=t,i};var k=function(t){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=t&&k.link(t,this,(function(t){return t}))};r["promhx.base.AsyncBase"]=k,k.__name__=["promhx","base","AsyncBase"],k.link=function(t,e,i){t._update.push({async:e,linkf:function(t){e.handleResolve(i(t))}}),k.immediateLinkUpdate(t,e,i)},k.immediateLinkUpdate=function(t,e,i){if(!t._errored||t._errorPending||t._error.length>0||e.handleError(t._errorVal),t._resolved&&!t._pending)try{e.handleResolve(i(t._val))}catch(t){t instanceof C&&(t=t.val),e.handleError(t)}},k.linkAll=function(t,e){for(var i=function(i,r,n){if(0==i.length||k.allFulfilled(i)){for(var s,o=[],a=se(t)();a.hasNext();){var c=a.next();o.push(c==r?n:c._val)}s=o,e.handleResolve(s)}},r=se(t)();r.hasNext();){var n=r.next();n._update.push({async:e,linkf:function(t,e,i){return function(r){t(e,i,r)}}(i,function(e){for(var i=[],r=se(t)();r.hasNext();){var s=r.next();s!=n&&i.push(s)}return i}(),n)})}k.allFulfilled(t)&&e.handleResolve(function(e){for(var i=[],r=se(t)();r.hasNext();){var n=r.next();i.push(n._val)}return i}())},k.pipeLink=function(t,e,i){var r=!1,n=function(t){if(!r){r=!0;var n=i(t);n._update.push({async:e,linkf:ce(e,e.handleResolve)}),k.immediateLinkUpdate(n,e,(function(t){return t}))}};if(t._update.push({async:e,linkf:n}),t._resolved&&!t._pending)try{n(t._val)}catch(t){t instanceof C&&(t=t.val),e.handleError(t)}},k.allResolved=function(t){for(var e=se(t)();e.hasNext();)if(!e.next()._resolved)return!1;return!0},k.allFulfilled=function(t){for(var e=se(t)();e.hasNext();)if(!e.next()._fulfilled)return!1;return!0},k.prototype={catchError:function(t){return this._error.push(t),this},errorThen:function(t){return this._errorMap=t,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return this._error.length>0},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(t){this._resolve(t)},_resolve:function(t){var e,i,r=this;this._pending?N.enqueue((e=ce(this,this._resolve),i=t,function(){e(i)})):(this._resolved=!0,this._pending=!0,N.queue.add((function(){r._val=t;for(var e=0,i=r._update;e<i.length;){var n=i[e];++e;try{n.linkf(t)}catch(t){t instanceof C&&(t=t.val),n.async.handleError(t)}}r._fulfilled=!0,r._pending=!1})),N.continueOnNextLoop())},handleError:function(t){this._handleError(t)},_handleError:function(t){var e=this,i=function(t){if(e._error.length>0)for(var i=0,r=e._error;i<r.length;){var n=r[i];++i,n(t)}else{if(!(e._update.length>0))throw new C(t);for(var s=0,o=e._update;s<o.length;){var a=o[s];++s,a.async.handleError(t)}}e._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=t,N.queue.add((function(){if(null!=e._errorMap)try{e._resolve(e._errorMap(t))}catch(t){t instanceof C&&(t=t.val),i(t)}else i(t)})),N.continueOnNextLoop())},then:function(t){var e=new k(null);return k.link(this,e,t),e},unlink:function(t){var e=this;N.queue.add((function(){e._update=e._update.filter((function(e){return e.async!=t}))})),N.continueOnNextLoop()},isLinked:function(t){for(var e=0,i=this._update;e<i.length;){var r=i[e];if(++e,r.async==t)return!0}return!1},__class__:k};var R=e.promhx.Deferred=function(){k.call(this)};r["promhx.Deferred"]=R,R.__name__=["promhx","Deferred"],R.__super__=k,R.prototype=s(k.prototype,{resolve:function(t){this.handleResolve(t)},throwError:function(t){this.handleError(t)},promise:function(){return new I(this)},stream:function(){return new O(this)},publicStream:function(){return new L(this)},__class__:R});var I=e.promhx.Promise=function(t){k.call(this,t),this._rejected=!1};r["promhx.Promise"]=I,I.__name__=["promhx","Promise"],I.whenAll=function(t){var e=new I(null);return k.linkAll(t,e),e},I.promise=function(t){var e=new I;return e.handleResolve(t),e},I.__super__=k,I.prototype=s(k.prototype,{isRejected:function(){return this._rejected},reject:function(t){this._rejected=!0,this.handleError(t)},handleResolve:function(t){if(this._resolved){throw new C(F.AlreadyResolved("Promise has already been resolved"))}this._resolve(t)},then:function(t){var e=new I(null);return k.link(this,e,t),e},unlink:function(t){var e=this;N.queue.add((function(){if(e._fulfilled)e._update=e._update.filter((function(e){return e.async!=t}));else{e.handleError(F.DownstreamNotFullfilled("Downstream Promise is not fullfilled"))}})),N.continueOnNextLoop()},handleError:function(t){this._rejected=!0,this._handleError(t)},pipe:function(t){var e=new I(null);return k.pipeLink(this,e,t),e},errorPipe:function(t){var e=new I;return this.catchError((function(i){t(i).then(ce(e,e._resolve))})),this.then(ce(e,e._resolve)),e},__class__:I});var O=e.promhx.Stream=function(t){k.call(this,t),this._end_promise=new I};r["promhx.Stream"]=O,O.__name__=["promhx","Stream"],O.foreach=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var r=i.next();e.handleResolve(r)}return e.end(),e},O.wheneverAll=function(t){var e=new O(null);return k.linkAll(t,e),e},O.concatAll=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var r=i.next();e.concat(r)}return e},O.mergeAll=function(t){for(var e=new O(null),i=se(t)();i.hasNext();){var r=i.next();e.merge(r)}return e},O.stream=function(t){var e=new O(null);return e.handleResolve(t),e},O.__super__=k,O.prototype=s(k.prototype,{then:function(t){var e=new O(null);return k.link(this,e,t),this._end_promise._update.push({async:e._end_promise,linkf:function(t){e.end()}}),e},detachStream:function(t){for(var e=[],i=!1,r=0,n=this._update;r<n.length;){var s=n[r];++r,s.async==t?(this._end_promise._update=this._end_promise._update.filter((function(e){return e.async!=t._end_promise})),i=!0):e.push(s)}return this._update=e,i},first:function(){var t=new I(null);return this.then((function(e){t._resolved||t.handleResolve(e)})),t},handleResolve:function(t){this._end||this._pause||this._resolve(t)},pause:function(t){null==t&&(t=!this._pause),this._pause=t},pipe:function(t){var e=new O(null);return k.pipeLink(this,e,t),this._end_promise.then((function(t){e.end()})),e},errorPipe:function(t){var e=new O(null);return this.catchError((function(i){var r=t(i);r.then(ce(e,e._resolve)),r._end_promise.then(ce(oe=e._end_promise,oe._resolve))})),this.then(ce(e,e._resolve)),this._end_promise.then((function(t){e.end()})),e},handleEnd:function(){if(this._pending)N.queue.add(ce(this,this.handleEnd)),N.continueOnNextLoop();else{if(this._end_promise._resolved)return;var t;this._end=!0,t=this._resolved?b.Some(this._val):b.None,this._end_promise.handleResolve(t),this._update=[],this._error=[]}},end:function(){return N.queue.add(ce(this,this.handleEnd)),N.continueOnNextLoop(),this},endThen:function(t){return this._end_promise.then(t)},filter:function(t){var e=new O(null);return this._update.push({async:e,linkf:function(i){t(i)&&e.handleResolve(i)}}),k.immediateLinkUpdate(this,e,(function(t){return t})),e},concat:function(t){var e=new O(null);return this._update.push({async:e,linkf:ce(e,e.handleResolve)}),k.immediateLinkUpdate(this,e,(function(t){return t})),this._end_promise.then((function(i){t.pipe((function(t){return e.handleResolve(t),e})),t._end_promise.then((function(t){e.end()}))})),e},merge:function(t){var e=new O(null);return this._update.push({async:e,linkf:ce(e,e.handleResolve)}),t._update.push({async:e,linkf:ce(e,e.handleResolve)}),k.immediateLinkUpdate(this,e,(function(t){return t})),k.immediateLinkUpdate(t,e,(function(t){return t})),e},__class__:O});var L=e.promhx.PublicStream=function(t){O.call(this,t)};r["promhx.PublicStream"]=L,L.__name__=["promhx","PublicStream"],L.publicstream=function(t){var e=new L(null);return e.handleResolve(t),e},L.__super__=O,L.prototype=s(O.prototype,{resolve:function(t){this.handleResolve(t)},throwError:function(t){this.handleError(t)},update:function(t){this.handleResolve(t)},__class__:L});var N=function(){};r["promhx.base.EventLoop"]=N,N.__name__=["promhx","base","EventLoop"],N.enqueue=function(t){N.queue.add(t),N.continueOnNextLoop()},N.set_nextLoop=function(t){if(null!=N.nextLoop)throw new C("nextLoop has already been set");return N.nextLoop=t,N.nextLoop},N.queueEmpty=function(){return N.queue.isEmpty()},N.finish=function(t){null==t&&(t=1e3);for(var e=null;t-- >0&&null!=(e=N.queue.pop());)e();return N.queue.isEmpty()},N.clear=function(){N.queue=new c},N.f=function(){var t=N.queue.pop();null!=t&&t(),N.queue.isEmpty()||N.continueOnNextLoop()},N.continueOnNextLoop=function(){null!=N.nextLoop?N.nextLoop(N.f):setImmediate(N.f)};var F=r["promhx.error.PromiseError"]={__ename__:["promhx","error","PromiseError"],__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};F.AlreadyResolved=function(t){var e=["AlreadyResolved",0,t];return e.__enum__=F,e.toString=n,e},F.DownstreamNotFullfilled=function(t){var e=["DownstreamNotFullfilled",1,t];return e.__enum__=F,e.toString=n,e};var U=function(){};r["verb.Verb"]=U,U.__name__=["verb","Verb"],U.main=function(){t.log("verb 2.1.0")};var W=function(){};r["verb.core.ArrayExtensions"]=W,W.__name__=["verb","core","ArrayExtensions"],W.alloc=function(t,e){if(!(e<0))for(;t.length<e;)t.push(null)},W.reversed=function(t){var e=t.slice();return e.reverse(),e},W.last=function(t){return t[t.length-1]},W.first=function(t){return t[0]},W.spliceAndInsert=function(t,e,i,r){t.splice(e,i),t.splice(e,0,r)},W.left=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(0,e)},W.right=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e)},W.rightWithPivot=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e-1)},W.unique=function(t,e){if(0==t.length)return[];for(var i=[t.pop()];t.length>0;){for(var r=t.pop(),n=!0,s=0;s<i.length;){var o=i[s];if(++s,e(r,o)){n=!1;break}}n&&i.push(r)}return i};var B=function(){};r["verb.core.Binomial"]=B,B.__name__=["verb","core","Binomial"],B.get=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;if(e>t-e&&(e=t-e),B.memo_exists(t,e))return B.get_memo(t,e);for(var i=1,r=t,n=1,s=e+1;n<s;){var o=n++;B.memo_exists(r,o)?(t--,i=B.get_memo(r,o)):(i*=t--,B.memoize(r,o,i/=o))}return i},B.get_no_memo=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;e>t-e&&(e=t-e);for(var i=1,r=1,n=e+1;r<n;)i*=t--,i/=r++;return i},B.memo_exists=function(t,e){return B.memo.h.hasOwnProperty(t)&&B.memo.h[t].h.hasOwnProperty(e)},B.get_memo=function(t,e){return B.memo.h[t].h[e]},B.memoize=function(t,e,i){B.memo.h.hasOwnProperty(t)||B.memo.set(t,new y),B.memo.h[t].h[e]=i};var z=e.core.BoundingBox=function(t){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=t&&this.addRange(t)};r["verb.core.BoundingBox"]=z,z.__name__=["verb","core","BoundingBox"],z.intervalsOverlap=function(t,e,i,r,n){var s;null==n&&(n=-1),s=n<-.5?V.TOLERANCE:n;var o=Math.min(t,e)-s,a=Math.max(t,e)+s,c=Math.min(i,r)-s,l=Math.max(i,r)+s;return o>=c&&o<=l||a>=c&&a<=l||c>=o&&c<=a||l>=o&&l<=a},z.prototype={fromPoint:function(t){return new z([t])},add:function(t){if(!this.initialized)return this.dim=t.length,this.min=t.slice(0),this.max=t.slice(0),this.initialized=!0,this;for(var e=0,i=this.dim;e<i;){var r=e++;t[r]>this.max[r]&&(this.max[r]=t[r]),t[r]<this.min[r]&&(this.min[r]=t[r])}return this},addRange:function(t){for(var e=t.length,i=0;i<e;){var r=i++;this.add(t[r])}return this},contains:function(t,e){return null==e&&(e=-1),!!this.initialized&&this.intersects(new z([t]),e)},intersects:function(t,e){if(null==e&&(e=-1),!this.initialized||!t.initialized)return!1;for(var i=this.min,r=this.max,n=t.min,s=t.max,o=0,a=this.dim;o<a;){var c=o++;if(!z.intervalsOverlap(i[c],r[c],n[c],s[c],e))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var t=0,e=0,i=0,r=this.dim;i<r;){var n=i++,s=this.getAxisLength(n);s>t&&(t=s,e=n)}return e},getAxisLength:function(t){return t<0||t>this.dim-1?0:Math.abs(this.min[t]-this.max[t])},intersect:function(t,e){if(!this.initialized)return null;var i=this.min,r=this.max,n=t.min,s=t.max;if(!this.intersects(t,e))return null;for(var o=[],a=[],c=0,l=this.dim;c<l;){var h=c++;o.push(Math.min(r[h],s[h])),a.push(Math.max(i[h],n[h]))}return new z([a,o])},__class__:z};var V=e.core.Constants=function(){};r["verb.core.Constants"]=V,V.__name__=["verb","core","Constants"];var H=e.core.SerializableBase=function(){};r["verb.core.SerializableBase"]=H,H.__name__=["verb","core","SerializableBase"],H.prototype={serialize:function(){var t=new v;return t.serialize(this),t.toString()},__class__:H};var G=e.core.Plane=function(t,e){this.origin=t,this.normal=e};r["verb.core.Plane"]=G,G.__name__=["verb","core","Plane"],G.__super__=H,G.prototype=s(H.prototype,{__class__:G});var j=e.core.Ray=function(t,e){this.origin=t,this.dir=e};r["verb.core.Ray"]=j,j.__name__=["verb","core","Ray"],j.__super__=H,j.prototype=s(H.prototype,{__class__:j});var X=e.core.NurbsCurveData=function(t,e,i){this.degree=t,this.controlPoints=i,this.knots=e};r["verb.core.NurbsCurveData"]=X,X.__name__=["verb","core","NurbsCurveData"],X.__super__=H,X.prototype=s(H.prototype,{__class__:X});var q=e.core.NurbsSurfaceData=function(t,e,i,r,n){this.degreeU=t,this.degreeV=e,this.knotsU=i,this.knotsV=r,this.controlPoints=n};r["verb.core.NurbsSurfaceData"]=q,q.__name__=["verb","core","NurbsSurfaceData"],q.__super__=H,q.prototype=s(H.prototype,{__class__:q});var Y=e.core.MeshData=function(t,e,i,r){this.faces=t,this.points=e,this.normals=i,this.uvs=r};r["verb.core.MeshData"]=Y,Y.__name__=["verb","core","MeshData"],Y.empty=function(){return new Y([],[],[],[])},Y.__super__=H,Y.prototype=s(H.prototype,{__class__:Y});var Z=e.core.PolylineData=function(t,e){this.points=t,this.params=e};r["verb.core.PolylineData"]=Z,Z.__name__=["verb","core","PolylineData"],Z.__super__=H,Z.prototype=s(H.prototype,{__class__:Z});var J=e.core.VolumeData=function(t,e,i,r,n,s,o){this.degreeU=t,this.degreeV=e,this.degreeW=i,this.knotsU=r,this.knotsV=n,this.knotsW=s,this.controlPoints=o};r["verb.core.VolumeData"]=J,J.__name__=["verb","core","VolumeData"],J.__super__=H,J.prototype=s(H.prototype,{__class__:J});var K=e.core.Pair=function(t,e){this.item0=t,this.item1=e};r["verb.core.Pair"]=K,K.__name__=["verb","core","Pair"],K.prototype={__class__:K};var $=e.core.Interval=function(t,e){this.min=t,this.max=e};r["verb.core.Interval"]=$,$.__name__=["verb","core","Interval"],$.prototype={__class__:$};var Q=e.core.CurveCurveIntersection=function(t,e,i,r){this.point0=t,this.point1=e,this.u0=i,this.u1=r};r["verb.core.CurveCurveIntersection"]=Q,Q.__name__=["verb","core","CurveCurveIntersection"],Q.prototype={__class__:Q};var tt=e.core.CurveSurfaceIntersection=function(t,e,i,r){this.u=t,this.uv=e,this.curvePoint=i,this.surfacePoint=r};r["verb.core.CurveSurfaceIntersection"]=tt,tt.__name__=["verb","core","CurveSurfaceIntersection"],tt.prototype={__class__:tt};var et=e.core.MeshIntersectionPoint=function(t,e,i,r,n){this.visited=!1,this.adj=null,this.opp=null,this.uv0=t,this.uv1=e,this.point=i,this.faceIndex0,this.faceIndex1};r["verb.core.MeshIntersectionPoint"]=et,et.__name__=["verb","core","MeshIntersectionPoint"],et.prototype={__class__:et};var it=e.core.PolylineMeshIntersection=function(t,e,i,r,n){this.point=t,this.u=e,this.uv=i,this.polylineIndex=r,this.faceIndex=n};r["verb.core.PolylineMeshIntersection"]=it,it.__name__=["verb","core","PolylineMeshIntersection"],it.prototype={__class__:it};var rt=e.core.SurfaceSurfaceIntersectionPoint=function(t,e,i,r){this.uv0=t,this.uv1=e,this.point=i,this.dist=r};r["verb.core.SurfaceSurfaceIntersectionPoint"]=rt,rt.__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],rt.prototype={__class__:rt};var nt=e.core.TriSegmentIntersection=function(t,e,i,r){this.point=t,this.s=e,this.t=i,this.p=r};r["verb.core.TriSegmentIntersection"]=nt,nt.__name__=["verb","core","TriSegmentIntersection"],nt.prototype={__class__:nt};var st=e.core.CurveTriPoint=function(t,e,i){this.u=t,this.point=e,this.uv=i};r["verb.core.CurveTriPoint"]=st,st.__name__=["verb","core","CurveTriPoint"],st.prototype={__class__:st};var ot=function(t,e,i,r,n){null==n&&(n=!1),null==r&&(r=-1),this.uv=i,this.point=t,this.normal=e,this.id=r,this.degen=n};r["verb.core.SurfacePoint"]=ot,ot.__name__=["verb","core","SurfacePoint"],ot.fromUv=function(t,e){return new ot(null,null,[t,e])},ot.prototype={__class__:ot};var at=e.core.CurvePoint=function(t,e){this.u=t,this.pt=e};r["verb.core.CurvePoint"]=at,at.__name__=["verb","core","CurvePoint"],at.prototype={__class__:at};var ct=e.core.KdTree=function(t,e){this.dim=3,this.points=t,this.distanceFunction=e,this.dim=t[0].point.length,this.root=this.buildTree(t,0,null)};r["verb.core.KdTree"]=ct,ct.__name__=["verb","core","KdTree"],ct.prototype={buildTree:function(t,e,i){var r,n,s=e%this.dim;return 0==t.length?null:1==t.length?new ut(t[0],s,i):(t.sort((function(t,e){var i=t.point[s]-e.point[s];return 0==i?0:i>0?1:-1})),r=Math.floor(t.length/2),(n=new ut(t[r],s,i)).left=this.buildTree(t.slice(0,r),e+1,n),n.right=this.buildTree(t.slice(r+1),e+1,n),n)},nearest:function(t,e,i){var r,n=this,s=new lt((function(t){return-t.item1})),o=null;r=o=function(i){for(var r,a,c,l,h=i.dimension,u=n.distanceFunction(t,i.kdPoint.point),d=[],p=0,f=n.dim;p<f;)p++,d.push(0);a=d;for(var m=function(t,i){s.push(new K(t,i)),s.size()>e&&s.pop()},g=0,v=n.dim;g<v;){var _=g++;_==i.dimension?a[_]=t[_]:a[_]=i.kdPoint.point[_]}c=n.distanceFunction(a,i.kdPoint.point),null!=i.right||null!=i.left?(r=null==i.right?i.left:null==i.left?i.right:t[h]<i.kdPoint.point[h]?i.left:i.right,o(r),(s.size()<e||u<s.peek().item1)&&m(i,u),(s.size()<e||Math.abs(c)<s.peek().item1)&&null!=(l=r==i.left?i.right:i.left)&&o(l)):(s.size()<e||u<s.peek().item1)&&m(i,u)};for(var a=0;a<e;)a++,s.push(new K(null,i));r(this.root);for(var c=[],l=0;l<e;){var h=l++;null!=s.content[h].item0&&c.push(new K(s.content[h].item0.kdPoint,s.content[h].item1))}return c},__class__:ct};var lt=function(t){this.content=[],this.scoreFunction=t};r["verb.core.BinaryHeap"]=lt,lt.__name__=["verb","core","BinaryHeap"],lt.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,i=0;i<e;){var r=i++;if(this.content[r]==t){var n=this.content.pop();return void(r!=e-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.bubbleUp(r):this.sinkDown(r)))}}throw new C("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var i=Math.floor((t+1)/2)-1,r=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[i]=e,this.content[t]=r,t=i}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],r=this.scoreFunction(i);;){var n=2*(t+1),s=n-1,o=-1,a=0;if(s<e){var c=this.content[s];(a=this.scoreFunction(c))<r&&(o=s)}if(n<e){var l=this.content[n];this.scoreFunction(l)<(-1==o?r:a)&&(o=n)}if(-1==o)break;this.content[t]=this.content[o],this.content[o]=i,t=o}},__class__:lt};var ht=e.core.KdPoint=function(t,e){this.point=t,this.obj=e};r["verb.core.KdPoint"]=ht,ht.__name__=["verb","core","KdPoint"],ht.prototype={__class__:ht};var ut=e.core.KdNode=function(t,e,i){this.kdPoint=t,this.left=null,this.right=null,this.parent=i,this.dimension=e};r["verb.core.KdNode"]=ut,ut.__name__=["verb","core","KdNode"],ut.prototype={__class__:ut};var dt=function(){};r["verb.eval.IBoundingBoxTree"]=dt,dt.__name__=["verb","eval","IBoundingBoxTree"],dt.prototype={__class__:dt};var pt=function(t,e){this._boundingBox=null,this._curve=t,null==e&&(e=Ct.domain(this._curve.knots)/64),this._knotTol=e};r["verb.core.LazyCurveBoundingBoxTree"]=pt,pt.__name__=["verb","core","LazyCurveBoundingBoxTree"],pt.__interfaces__=[dt],pt.prototype={split:function(){var t=W.first(this._curve.knots),e=W.last(this._curve.knots),i=e-t,r=Dt.curveSplit(this._curve,(e+t)/2+.1*i*Math.random());return new K(new pt(r[0],this._knotTol),new pt(r[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new z(Rt.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(t){return Ct.domain(this._curve.knots)<this._knotTol},empty:function(){return!1},__class__:pt};var ft=function(t,e){if(this._boundingBox=null,this._mesh=t,null==e){for(var i=[],r=0,n=t.faces.length;r<n;){var s=r++;i.push(s)}e=i}this._faceIndices=e};r["verb.core.LazyMeshBoundingBoxTree"]=ft,ft.__name__=["verb","core","LazyMeshBoundingBoxTree"],ft.__interfaces__=[dt],ft.prototype={split:function(){var t=yt.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),e=W.left(t),i=W.right(t);return new K(new ft(this._mesh,e),new ft(this._mesh,i))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=yt.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(t){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length},__class__:ft};var mt=function(t,e){this._boundingBox=null,this._polyline=t,null==e&&(e=new $(0,0!=t.points.length?t.points.length-1:0)),this._interval=e};r["verb.core.LazyPolylineBoundingBoxTree"]=mt,mt.__name__=["verb","core","LazyPolylineBoundingBoxTree"],mt.__interfaces__=[dt],mt.prototype={split:function(){var t=this._interval.min,e=this._interval.max,i=t+Math.ceil((e-t)/2),r=new $(t,i),n=new $(i,e);return new K(new mt(this._polyline,r),new mt(this._polyline,n))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new z(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(t){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:mt};var gt=function(t,e,i,r){null==e&&(e=!1),this._boundingBox=null,this._surface=t,this._splitV=e,null==i&&(i=Ct.domain(t.knotsU)/16),null==r&&(r=Ct.domain(t.knotsV)/16),this._knotTolU=i,this._knotTolV=r};r["verb.core.LazySurfaceBoundingBoxTree"]=gt,gt.__name__=["verb","core","LazySurfaceBoundingBoxTree"],gt.__interfaces__=[dt],gt.prototype={split:function(){var t,e;this._splitV?(t=W.first(this._surface.knotsV),e=W.last(this._surface.knotsV)):(t=W.first(this._surface.knotsU),e=W.last(this._surface.knotsU));var i=(t+e)/2,r=Dt.surfaceSplit(this._surface,i,this._splitV);return new K(new gt(r[0],!this._splitV,this._knotTolU,this._knotTolV),new gt(r[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new z;for(var t=0,e=this._surface.controlPoints;t<e.length;){var i=e[t];++t,this._boundingBox.addRange(Rt.dehomogenize1d(i))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(t){return Ct.domain(this._surface.knotsV)<this._knotTolV&&Ct.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1},__class__:gt};var vt=e.core.Mat=function(){};r["verb.core.Mat"]=vt,vt.__name__=["verb","core","Mat"],vt.mul=function(t,e){for(var i=[],r=0,n=e.length;r<n;){var s=r++;i.push(Ct.mul(t,e[s]))}return i},vt.mult=function(t,e){var i,r,n,s,o,a,c,l;i=t.length,r=e.length,n=e[0].length,s=[];for(var h=i-1,u=0,d=0;h>=0;){for(o=[],a=t[h],d=n-1;d>=0;){for(c=a[r-1]*e[r-1][d],u=r-2;u>=1;)l=u-1,c+=a[u]*e[u][d]+a[l]*e[l][d],u-=2;0==u&&(c+=a[0]*e[0][d]),o[d]=c,d--}s[h]=o,h--}return s},vt.add=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(Ct.add(t[s],e[s]))}return i},vt.div=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(Ct.div(t[s],e))}return i},vt.sub=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(Ct.sub(t[s],e[s]))}return i},vt.dot=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(Ct.dot(t[s],e))}return i},vt.identity=function(t){for(var e=Ct.zeros2d(t,t),i=0;i<t;){var r=i++;e[r][r]=1}return e},vt.transpose=function(t){if(0==t.length)return[];for(var e=[],i=0,r=t[0].length;i<r;){var n=i++;e.push(function(e){for(var i=[],r=0,s=t.length;r<s;){var o=r++;i.push(t[o][n])}return i}())}return e},vt.solve=function(t,e){return vt.LUsolve(vt.LU(t),e)},vt.LUsolve=function(t,e){var i,r,n,s,o,a=t.LU,c=a.length,l=e.slice(),h=t.P;for(i=c-1;-1!=i;)l[i]=e[i],--i;for(i=0;i<c;){for(n=h[i],h[i]!=i&&(o=l[i],l[i]=l[n],l[n]=o),s=a[i],r=0;r<i;)l[i]-=l[r]*s[r],++r;++i}for(i=c-1;i>=0;){for(s=a[i],r=i+1;r<c;)l[i]-=l[r]*s[r],++r;l[i]/=s[i],--i}return l},vt.LU=function(t){Math.abs;for(var e,i,r,n,s,o,a,c,l,h=[],u=0,d=t.length;u<d;){var p=u++;h.push(t[p].slice())}var f=(t=h).length,m=f-1,g=[];for(r=0;r<f;){for(a=r,o=t[r],l=Math.abs(o[r]),i=r+1;i<f;)l<(n=Math.abs(t[i][r]))&&(l=n,a=i),++i;for(g[r]=a,a!=r&&(t[r]=t[a],t[a]=o,o=t[r]),s=o[r],e=r+1;e<f;)t[e][r]/=s,++e;for(e=r+1;e<f;){for(c=t[e],i=r+1;i<m;)c[i]-=c[r]*o[i],c[++i]-=c[r]*o[i],++i;i==m&&(c[i]-=c[r]*o[i]),++e}++r}return new _t(t,g)};var _t=function(t,e){this.LU=t,this.P=e};r["verb.core._Mat.LUDecomp"]=_t,_t.__name__=["verb","core","_Mat","LUDecomp"],_t.prototype={__class__:_t};var yt=e.core.Mesh=function(){};r["verb.core.Mesh"]=yt,yt.__name__=["verb","core","Mesh"],yt.getTriangleNorm=function(t,e){var i=t[e[0]],r=t[e[1]],n=t[e[2]],s=Ct.sub(r,i),o=Ct.sub(n,i),a=Ct.cross(s,o);return Ct.mul(1/Ct.norm(a),a)},yt.makeMeshAabb=function(t,e){for(var i=new z,r=0;r<e.length;){var n=e[r];++r,i.add(t.points[t.faces[n][0]]),i.add(t.points[t.faces[n][1]]),i.add(t.points[t.faces[n][2]])}return i},yt.sortTrianglesOnLongestAxis=function(t,e,i){for(var r=t.getLongestAxis(),n=[],s=0;s<i.length;){var o=i[s];++s;var a=yt.getMinCoordOnAxis(e.points,e.faces[o],r);n.push(new K(a,o))}n.sort((function(t,e){var i=t.item0,r=e.item0;return i==r?0:i>r?1:-1}));for(var c=[],l=0,h=n.length;l<h;){var u=l++;c.push(n[u].item1)}return c},yt.getMinCoordOnAxis=function(t,e,i){for(var r=1/0,n=0;n<3;){var s=t[e[n++]][i];s<r&&(r=s)}return r},yt.getTriangleCentroid=function(t,e){for(var i=[0,0,0],r=0;r<3;)for(var n=r++,s=0;s<3;){var o=s++;i[o]+=t[e[n]][o]}for(var a=0;a<3;)i[a++]/=3;return i},yt.triangleUVFromPoint=function(t,e,i){var r=t.faces[e],n=t.points[r[0]],s=t.points[r[1]],o=t.points[r[2]],a=t.uvs[r[0]],c=t.uvs[r[1]],l=t.uvs[r[2]],h=Ct.sub(n,i),u=Ct.sub(s,i),d=Ct.sub(o,i),p=Ct.norm(Ct.cross(Ct.sub(n,s),Ct.sub(n,o))),f=Ct.norm(Ct.cross(u,d))/p,m=Ct.norm(Ct.cross(d,h))/p,g=Ct.norm(Ct.cross(h,u))/p;return Ct.add(Ct.mul(f,a),Ct.add(Ct.mul(m,c),Ct.mul(g,l)))};var xt=function(t,e){if(this._empty=!1,this._face=-1,null==e){for(var i=[],r=0,n=t.faces.length;r<n;){var s=r++;i.push(s)}e=i}if(this._boundingBox=yt.makeMeshAabb(t,e),e.length<1)this._empty=!0;else if(e.length<2)this._face=e[0];else{var o=yt.sortTrianglesOnLongestAxis(this._boundingBox,t,e),a=W.left(o),c=W.right(o);this._children=new K(new xt(t,a),new xt(t,c))}};r["verb.core.MeshBoundingBoxTree"]=xt,xt.__name__=["verb","core","MeshBoundingBoxTree"],xt.__interfaces__=[dt],xt.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(t){return null==this._children},empty:function(){return this._empty},__class__:xt};var bt=e.core.Minimizer=function(){};r["verb.core.Minimizer"]=bt,bt.__name__=["verb","core","Minimizer"],bt.uncmin=function(t,e,i,r,n){null==i&&(i=1e-8),null==r&&(r=function(e){return bt.numericalGradient(t,e)}),null==n&&(n=1e3);var s,o,a,c,l=(e=e.slice(0)).length,h=t(e),u=h;if(isNaN(h))throw new C("uncmin: f(x0) is a NaN!");i=Math.max(i,V.EPSILON);var d,p,f,m,g,v,_=vt.identity(l),y=0,x=[],b="";for(a=r(e);y<n;){if(!Ct.all(Ct.finite(a))){b="Gradient has Infinity or NaN";break}if(o=Ct.neg(vt.dot(_,a)),!Ct.all(Ct.finite(o))){b="Search direction has Infinity or NaN";break}if((v=Ct.norm(o))<i){b="Newton step smaller than tol";break}for(g=1,s=Ct.dot(a,o),d=e;y<n&&!(g*v<i)&&(x=Ct.mul(g,o),d=Ct.add(e,x),(u=t(d))-h>=.1*g*s||isNaN(u));)g*=.5,++y;if(g*v<i){b="Line search step size smaller than tol";break}if(y==n){b="maxit reached during line search";break}c=r(d),p=Ct.sub(c,a),m=Ct.dot(p,x),f=vt.dot(_,p),_=vt.sub(vt.add(_,vt.mul((m+Ct.dot(p,f))/(m*m),bt.tensor(x,x))),vt.div(vt.add(bt.tensor(f,x),bt.tensor(x,f)),m)),e=d,h=u,a=c,++y}return new Mt(e,h,a,_,y,b)},bt.numericalGradient=function(t,e){var i=e.length,r=t(e);if(NaN==r)throw new C("gradient: f(x) is a NaN!");for(var n,s,o,a,c,l,h,u,d=e.slice(0),p=[],f=0,m=0;m<i;)for(var g=m++,v=Math.max(1e-6*r,1e-8);;){if(++f>20)throw new C("Numerical gradient fails");if(d[g]=e[g]+v,n=t(d),d[g]=e[g]-v,s=t(d),d[g]=e[g],isNaN(n)||isNaN(s))v/=16;else{if(p[g]=(n-s)/(2*v),o=e[g]-v,a=e[g],c=e[g]+v,l=(n-r)/v,h=(r-s)/v,u=Ct.max([Math.abs(p[g]),Math.abs(r),Math.abs(n),Math.abs(s),Math.abs(o),Math.abs(a),Math.abs(c),1e-8]),!(Math.min(Ct.max([Math.abs(l-p[g]),Math.abs(h-p[g]),Math.abs(l-h)])/u,v/u)>.001))break;v/=16}}return p},bt.tensor=function(t,e){for(var i,r,n=t.length,s=e.length,o=[],a=n-1;a>=0;){i=[],r=t[a];for(var c=s-1;c>=3;)i[c]=r*e[c],i[--c]=r*e[c],i[--c]=r*e[c],i[--c]=r*e[c],--c;for(;c>=0;)i[c]=r*e[c],--c;o[a]=i,a--}return o};var Mt=function(t,e,i,r,n,s){this.solution=t,this.value=e,this.gradient=i,this.invHessian=r,this.iterations=n,this.message=s};r["verb.core.MinimizationResult"]=Mt,Mt.__name__=["verb","core","MinimizationResult"],Mt.prototype={__class__:Mt};var St=function(){};r["verb.core.ISerializable"]=St,St.__name__=["verb","core","ISerializable"],St.prototype={__class__:St};var wt=e.core.Deserializer=function(){};r["verb.core.Deserializer"]=wt,wt.__name__=["verb","core","Deserializer"],wt.deserialize=function(t){return new _(t).unserialize()};var Tt=e.core.Trig=function(){};r["verb.core.Trig"]=Tt,Tt.__name__=["verb","core","Trig"],Tt.isPointInPlane=function(t,e,i){return Math.abs(Ct.dot(Ct.sub(t,e.origin),e.normal))<i},Tt.distToSegment=function(t,e,i){var r=Tt.segmentClosestPoint(e,t,i,0,1);return Ct.dist(e,r.pt)},Tt.rayClosestPoint=function(t,e,i){var r=Ct.sub(t,e),n=Ct.dot(r,i);return Ct.add(e,Ct.mul(n,i))},Tt.distToRay=function(t,e,i){var r=Tt.rayClosestPoint(t,e,i),n=Ct.sub(r,t);return Ct.norm(n)},Tt.threePointsAreFlat=function(t,e,i,r){var n=Ct.sub(e,t),s=Ct.sub(i,t),o=Ct.cross(n,s);return Ct.dot(o,o)<r},Tt.segmentClosestPoint=function(t,e,i,r,n){var s=Ct.sub(i,e),o=Ct.norm(s);if(o<V.EPSILON)return{u:r,pt:e};var a=e,c=Ct.mul(1/o,s),l=Ct.sub(t,a),h=Ct.dot(l,c);return h<0?{u:r,pt:e}:h>o?{u:n,pt:i}:{u:r+(n-r)*h/o,pt:Ct.add(a,Ct.mul(h,c))}};var Ct=e.core.Vec=function(){};r["verb.core.Vec"]=Ct,Ct.__name__=["verb","core","Vec"],Ct.angleBetween=function(t,e){return Math.acos(Ct.dot(t,e)/(Ct.norm(t)*Ct.norm(e)))},Ct.positiveAngleBetween=function(t,e,i){var r=Ct.cross(t,e),n=Ct.norm(t)*Ct.norm(e),s=Ct.dot(t,e),o=Ct.norm(r)/n,a=s/n,c=Math.atan2(o,a),l=Ct.dot(i,r);return Math.abs(l)<V.EPSILON||l>0?c:-c},Ct.signedAngleBetween=function(t,e,i){var r=Ct.cross(t,e),n=Ct.norm(t)*Ct.norm(e),s=Ct.dot(t,e),o=Ct.norm(r)/n,a=s/n,c=Math.atan2(o,a);return Ct.dot(i,r)>0?c:2*Math.PI-c},Ct.angleBetweenNormalized2d=function(t,e){var i=t[0]*e[1]-t[1]*e[0];return Math.atan2(i,Ct.dot(t,e))},Ct.domain=function(t){return W.last(t)-W.first(t)},Ct.range=function(t){for(var e=[],i=0,r=0;r<t;)r++,e.push(i),i+=1;return e},Ct.span=function(t,e,i){if(null==i)return[];if(i<V.EPSILON)return[];if(t>e&&i>0)return[];if(e>t&&i<0)return[];for(var r=[],n=t;n<=e;)r.push(n),n+=i;return r},Ct.neg=function(t){return t.map((function(t){return-t}))},Ct.min=function(t){return a.fold(t,(function(t,e){return Math.min(t,e)}),1/0)},Ct.max=function(t){return a.fold(t,(function(t,e){return Math.max(t,e)}),-1/0)},Ct.all=function(t){return a.fold(t,(function(t,e){return e&&t}),!0)},Ct.finite=function(t){return t.map((function(t){return isFinite(t)}))},Ct.onRay=function(t,e,i){return Ct.add(t,Ct.mul(i,e))},Ct.lerp=function(t,e,i){return Ct.add(Ct.mul(t,e),Ct.mul(1-t,i))},Ct.normalized=function(t){return Ct.div(t,Ct.norm(t))},Ct.cross=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},Ct.dist=function(t,e){return Ct.norm(Ct.sub(t,e))},Ct.distSquared=function(t,e){return Ct.normSquared(Ct.sub(t,e))},Ct.sum=function(t){return a.fold(t,(function(t,e){return e+t}),0)},Ct.addAll=function(t){var e=se(t)();if(!e.hasNext())return null;var i=e.next().length;return a.fold(t,(function(t,e){return Ct.add(e,t)}),Ct.rep(i,0))},Ct.addAllMutate=function(t){for(var e=t[0],i=1,r=t.length;i<r;){var n=i++;Ct.addMutate(e,t[n])}},Ct.addMulMutate=function(t,e,i){for(var r=0,n=t.length;r<n;){var s=r++;t[s]=t[s]+e*i[s]}},Ct.subMulMutate=function(t,e,i){for(var r=0,n=t.length;r<n;){var s=r++;t[s]=t[s]-e*i[s]}},Ct.addMutate=function(t,e){for(var i=0,r=t.length;i<r;){var n=i++;t[n]=t[n]+e[n]}},Ct.subMutate=function(t,e){for(var i=0,r=t.length;i<r;){var n=i++;t[n]=t[n]-e[n]}},Ct.mulMutate=function(t,e){for(var i=0,r=e.length;i<r;){var n=i++;e[n]=e[n]*t}},Ct.norm=function(t){var e=Ct.normSquared(t);return 0!=e?Math.sqrt(e):e},Ct.normSquared=function(t){return a.fold(t,(function(t,e){return e+t*t}),0)},Ct.rep=function(t,e){for(var i=[],r=0;r<t;)r++,i.push(e);return i},Ct.zeros1d=function(t){for(var e=[],i=0;i<t;)i++,e.push(0);return e},Ct.zeros2d=function(t,e){for(var i=[],r=0;r<t;)r++,i.push(Ct.zeros1d(e));return i},Ct.zeros3d=function(t,e,i){for(var r=[],n=0;n<t;)n++,r.push(Ct.zeros2d(e,i));return r},Ct.dot=function(t,e){for(var i=0,r=0,n=t.length;r<n;){var s=r++;i+=t[s]*e[s]}return i},Ct.add=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(t[s]+e[s])}return i},Ct.mul=function(t,e){for(var i=[],r=0,n=e.length;r<n;){var s=r++;i.push(t*e[s])}return i},Ct.div=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(t[s]/e)}return i},Ct.sub=function(t,e){for(var i=[],r=0,n=t.length;r<n;){var s=r++;i.push(t[s]-e[s])}return i},Ct.isZero=function(t){for(var e=0,i=t.length;e<i;){var r=e++;if(Math.abs(t[r])>V.TOLERANCE)return!1}return!0},Ct.sortedSetUnion=function(t,e){for(var i=[],r=0,n=0;r<t.length||n<e.length;)if(r>=t.length)i.push(e[n]),n++;else if(n>=e.length)i.push(t[r]),r++;else{var s=t[r]-e[n];Math.abs(s)<V.EPSILON?(i.push(t[r]),r++,n++):s>0?(i.push(e[n]),n++):(i.push(t[r]),r++)}return i},Ct.sortedSetSub=function(t,e){for(var i=[],r=0,n=0;r<t.length;)n>=e.length?(i.push(t[r]),r++):Math.abs(t[r]-e[n])<V.EPSILON?(r++,n++):(i.push(t[r]),r++);return i};var Et=e.eval.Analyze=function(){};r["verb.eval.Analyze"]=Et,Et.__name__=["verb","eval","Analyze"],Et.knotMultiplicities=function(t){for(var e=[new Pt(t[0],0)],i=e[0],r=0;r<t.length;){var n=t[r];++r,Math.abs(n-i.knot)>V.EPSILON&&(i=new Pt(n,0),e.push(i)),i.inc()}return e},Et.isRationalSurfaceClosed=function(t,e){var i;null==e&&(e=!0);for(var r=0,n=(i=e?t.controlPoints:vt.transpose(t.controlPoints))[0].length;r<n;){var s=r++;if(!(Ct.dist(W.first(i)[s],W.last(i)[s])<V.EPSILON))return!1}return!0},Et.rationalSurfaceClosestPoint=function(t,e){var i=Et.rationalSurfaceClosestParam(t,e);return Rt.rationalSurfacePoint(t,i[0],i[1])},Et.rationalSurfaceClosestParam=function(t,e){for(var i,r,n,s=0,o=1e-4,a=5e-4,c=t.knotsU[0],l=W.last(t.knotsU),h=t.knotsV[0],u=W.last(t.knotsV),d=Et.isRationalSurfaceClosed(t),p=Et.isRationalSurfaceClosed(t,!1),f=Nt.rationalSurfaceAdaptive(t,new Ft),m=1/0,g=0,v=f.points.length;g<v;){var _=g++,y=f.points[_],x=Ct.normSquared(Ct.sub(e,y));x<m&&(m=x,n=f.uvs[_])}for(;s<5;){B=n,i=Rt.rationalSurfaceDerivatives(t,B[0],B[1],2),r=Ct.sub(i[0][0],e);var b=Ct.norm(r),M=Ct.dot(i[1][0],r),S=Ct.norm(i[1][0])*b,w=Ct.dot(i[0][1],r),T=Ct.norm(i[0][1])*b;if(b<o&&M/S<a&&w/T<a)return n;var C=(E=n,A=r,D=void 0,k=void 0,R=void 0,I=void 0,O=void 0,L=void 0,N=void 0,F=void 0,U=void 0,D=(P=i)[1][0],k=P[0][1],R=P[2][0],I=P[0][2],O=P[1][1],L=P[1][1],N=[-Ct.dot(D,A),-Ct.dot(k,A)],F=[[Ct.dot(D,D)+Ct.dot(R,A),Ct.dot(D,k)+Ct.dot(O,A)],[Ct.dot(D,k)+Ct.dot(L,A),Ct.dot(k,k)+Ct.dot(I,A)]],U=vt.solve(F,N),Ct.add(U,E));if(C[0]<c?C=d?[l-(C[0]-c),C[1]]:[c+V.EPSILON,C[1]]:C[0]>l&&(C=d?[c+(C[0]-l),C[1]]:[l-V.EPSILON,C[1]]),C[1]<h?C=p?[C[0],u-(C[1]-h)]:[C[0],h+V.EPSILON]:C[1]>u&&(C=p?[C[0],h+(C[0]-u)]:[C[0],u-V.EPSILON]),Ct.norm(Ct.mul(C[0]-n[0],i[1][0]))+Ct.norm(Ct.mul(C[1]-n[1],i[0][1]))<o)return n;n=C,s++}var E,P,A,D,k,R,I,O,L,N,F,U,B;return n},Et.rationalCurveClosestPoint=function(t,e){return Rt.rationalCurvePoint(t,Et.rationalCurveClosestParam(t,e))},Et.rationalCurveClosestParam=function(t,e){for(var i=1/0,r=0,n=Nt.rationalCurveRegularSample(t,t.controlPoints.length*t.degree,!0),s=0,o=n.length-1;s<o;){var a=s++,c=n[a][0],l=n[a+1][0],h=n[a].slice(1),u=n[a+1].slice(1),d=Tt.segmentClosestPoint(e,h,u,c,l),p=Ct.norm(Ct.sub(e,d.pt));p<i&&(i=p,r=d.u)}for(var f,m,g=0,v=1e-4,_=t.knots[0],y=W.last(t.knots),x=Ct.normSquared(Ct.sub(t.controlPoints[0],W.last(t.controlPoints)))<V.EPSILON,b=r;g<5;){A=b,f=Rt.rationalCurveDerivatives(t,A,2),m=Ct.sub(f[0],e);var M=Ct.norm(m),S=Ct.dot(f[1],m)/(Ct.norm(f[1])*M),w=M<v,T=Math.abs(S)<5e-4;if(w&&T)return b;var C=(E=f,P=m,b-Ct.dot(E[1],P)/(Ct.dot(E[2],P)+Ct.dot(E[1],E[1])));if(C<_?C=x?y-(C-_):_:C>y&&(C=x?_+(C-y):y),Ct.norm(Ct.mul(C-b,f[1]))<v)return b;b=C,g++}var E,P,A;return b},Et.rationalCurveParamAtArcLength=function(t,e,i,r,n){if(null==i&&(i=.001),e<V.EPSILON)return t.knots[0];var s,o,a=0,c=((s=null!=r?r:Lt.decomposeCurveIntoBeziers(t))[a],-V.EPSILON);for(o=null!=n?n:[];c<e&&a<s.length;){if(a<o.length?o[a]=o[a]:o[a]=Et.rationalBezierCurveArcLength(t),e<(c+=o[a])+V.EPSILON)return Et.rationalBezierCurveParamAtArcLength(t,e,i,o[a]);a++}return-1},Et.rationalBezierCurveParamAtArcLength=function(t,e,i,r){if(e<0)return t.knots[0];var n;if(e>(n=null!=r?r:Et.rationalBezierCurveArcLength(t)))return W.last(t.knots);var s,o=t.knots[0],a=0,c=W.last(t.knots),l=n,h=0,u=0;for(s=null!=i?i:2*V.TOLERANCE;l-a>s;)h=(o+c)/2,(u=Et.rationalBezierCurveArcLength(t,h))>e?(c=h,l=u):(o=h,a=u);return(o+c)/2},Et.rationalCurveArcLength=function(t,e,i){null==i&&(i=16),null==e&&(e=W.last(t.knots));for(var r=Lt.decomposeCurveIntoBeziers(t),n=0,s=r[0],o=0;n<r.length&&s.knots[0]+V.EPSILON<e;){var a=Math.min(W.last(s.knots),e);o+=Et.rationalBezierCurveArcLength(s,a,i),s=r[++n]}return o},Et.rationalBezierCurveArcLength=function(t,e,i){null==i&&(i=16);for(var r,n,s=((null==e?W.last(t.knots):e)-t.knots[0])/2,o=0,a=t.degree+i,c=0;c<a;){var l=c++;r=s*Et.Tvalues[a][l]+s+t.knots[0],n=Rt.rationalCurveDerivatives(t,r,1),o+=Et.Cvalues[a][l]*Ct.norm(n[1])}return s*o};var Pt=e.eval.KnotMultiplicity=function(t,e){this.knot=t,this.mult=e};r["verb.eval.KnotMultiplicity"]=Pt,Pt.__name__=["verb","eval","KnotMultiplicity"],Pt.prototype={inc:function(){this.mult++},__class__:Pt};var At=e.eval.Check=function(){};r["verb.eval.Check"]=At,At.__name__=["verb","eval","Check"],At.isValidKnotVector=function(t,e){if(0==t.length)return!1;if(t.length<2*(e+1))return!1;for(var i=W.first(t),r=0,n=e+1;r<n;){var s=r++;if(Math.abs(t[s]-i)>V.EPSILON)return!1}i=W.last(t);for(var o=t.length-e-1,a=t.length;o<a;){var c=o++;if(Math.abs(t[c]-i)>V.EPSILON)return!1}return At.isNonDecreasing(t)},At.isNonDecreasing=function(t){for(var e=W.first(t),i=0,r=t.length;i<r;){var n=i++;if(t[n]<e-V.EPSILON)return!1;e=t[n]}return!0},At.isValidNurbsCurveData=function(t){if(null==t.controlPoints)throw new C("Control points array cannot be null!");if(null==t.degree)throw new C("Degree cannot be null!");if(t.degree<1)throw new C("Degree must be greater than 1!");if(null==t.knots)throw new C("Knots cannot be null!");if(t.knots.length!=t.controlPoints.length+t.degree+1)throw new C("controlPoints.length + degree + 1 must equal knots.length!");if(!At.isValidKnotVector(t.knots,t.degree))throw new C("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t},At.isValidNurbsSurfaceData=function(t){if(null==t.controlPoints)throw new C("Control points array cannot be null!");if(null==t.degreeU)throw new C("DegreeU cannot be null!");if(null==t.degreeV)throw new C("DegreeV cannot be null!");if(t.degreeU<1)throw new C("DegreeU must be greater than 1!");if(t.degreeV<1)throw new C("DegreeV must be greater than 1!");if(null==t.knotsU)throw new C("KnotsU cannot be null!");if(null==t.knotsV)throw new C("KnotsV cannot be null!");if(t.knotsU.length!=t.controlPoints.length+t.degreeU+1)throw new C("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(t.knotsV.length!=t.controlPoints[0].length+t.degreeV+1)throw new C("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!At.isValidKnotVector(t.knotsU,t.degreeU)||!At.isValidKnotVector(t.knotsV,t.degreeV))throw new C("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t};var Dt=e.eval.Divide=function(){};r["verb.eval.Divide"]=Dt,Dt.__name__=["verb","eval","Divide"],Dt.surfaceSplit=function(t,e,i){var r,n,s,o;null==i&&(i=!1),i?(s=t.controlPoints,r=t.knotsV,n=t.degreeV):(s=vt.transpose(t.controlPoints),r=t.knotsU,n=t.degreeU);for(var a=[],c=0,l=n+1;c<l;)c++,a.push(e);o=a;for(var h=[],u=[],d=Rt.knotSpan(n,e,r),p=null,f=0;f<s.length;){var m=s[f];++f,p=Lt.curveKnotRefine(new X(n,r,m),o),h.push(p.controlPoints.slice(0,d+1)),u.push(p.controlPoints.slice(d+1))}var g=p.knots.slice(0,d+n+2),v=p.knots.slice(d+1);return i?[new q(t.degreeU,n,t.knotsU.slice(),g,h),new q(t.degreeU,n,t.knotsU.slice(),v,u)]:(h=vt.transpose(h),u=vt.transpose(u),[new q(n,t.degreeV,g,t.knotsV.slice(),h),new q(n,t.degreeV,v,t.knotsV.slice(),u)])},Dt.curveSplit=function(t,e){for(var i,r=t.degree,n=(t.controlPoints,t.knots),s=[],o=0,a=r+1;o<a;)o++,s.push(e);i=s;var c=Lt.curveKnotRefine(t,i),l=Rt.knotSpan(r,e,n),h=c.knots.slice(0,l+r+2),u=c.knots.slice(l+1),d=c.controlPoints.slice(0,l+1),p=c.controlPoints.slice(l+1);return[new X(r,h,d),new X(r,u,p)]},Dt.rationalCurveByEqualArcLength=function(t,e){var i=Et.rationalCurveArcLength(t)/e;return Dt.rationalCurveByArcLength(t,i)},Dt.rationalCurveByArcLength=function(t,e){var i=Lt.decomposeCurveIntoBeziers(t),r=i.map((function(t){return Et.rationalBezierCurveArcLength(t)})),n=Ct.sum(r),s=[new kt(t.knots[0],0)];if(e>n)return s;for(var o,a=e,c=0,l=a,h=0,u=0;c<i.length;){for(h+=r[c];l<h+V.EPSILON;)o=Et.rationalBezierCurveParamAtArcLength(i[c],l-u,V.TOLERANCE,r[c]),s.push(new kt(o,l)),l+=a;u+=r[c],c++}return s};var kt=e.eval.CurveLengthSample=function(t,e){this.u=t,this.len=e};r["verb.eval.CurveLengthSample"]=kt,kt.__name__=["verb","eval","CurveLengthSample"],kt.prototype={__class__:kt};var Rt=e.eval.Eval=function(){};r["verb.eval.Eval"]=Rt,Rt.__name__=["verb","eval","Eval"],Rt.rationalCurveTangent=function(t,e){return Rt.rationalCurveDerivatives(t,e,1)[1]},Rt.rationalSurfaceNormal=function(t,e,i){var r=Rt.rationalSurfaceDerivatives(t,e,i,1);return Ct.cross(r[1][0],r[0][1])},Rt.rationalSurfaceDerivatives=function(t,e,i,r){null==r&&(r=1);for(var n=Rt.surfaceDerivatives(t,e,i,r),s=Rt.rational2d(n),o=Rt.weight2d(n),a=[],c=s[0][0].length,l=0,h=r+1;l<h;){var u=l++;a.push([]);for(var d=0,p=r-u+1;d<p;){for(var f=d++,m=s[u][f],g=1,v=f+1;g<v;){var _=g++;Ct.subMulMutate(m,B.get(f,_)*o[0][_],a[u][f-_])}for(var y=1,x=u+1;y<x;){var b=y++;Ct.subMulMutate(m,B.get(u,b)*o[b][0],a[u-b][f]);for(var M=Ct.zeros1d(c),S=1,w=f+1;S<w;){var T=S++;Ct.addMulMutate(M,B.get(f,T)*o[b][T],a[u-b][f-T])}Ct.subMulMutate(m,B.get(u,b),M)}Ct.mulMutate(1/o[0][0],m),a[u].push(m)}}return a},Rt.rationalSurfacePoint=function(t,e,i){return Rt.dehomogenize(Rt.surfacePoint(t,e,i))},Rt.rationalCurveDerivatives=function(t,e,i){null==i&&(i=1);for(var r=Rt.curveDerivatives(t,e,i),n=Rt.rational1d(r),s=Rt.weight1d(r),o=[],a=0,c=i+1;a<c;){for(var l=a++,h=n[l],u=1,d=l+1;u<d;){var p=u++;Ct.subMulMutate(h,B.get(l,p)*s[p],o[l-p])}Ct.mulMutate(1/s[0],h),o.push(h)}return o},Rt.rationalCurvePoint=function(t,e){return Rt.dehomogenize(Rt.curvePoint(t,e))},Rt.surfaceDerivatives=function(t,e,i,r){var n=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2;return Rt.surfaceDerivativesGivenNM(n,s,t,e,i,r)},Rt.surfaceDerivativesGivenNM=function(t,e,i,r,n,s){var o=i.degreeU,a=i.degreeV,c=i.controlPoints,l=i.knotsU,h=i.knotsV;if(!Rt.areValidRelations(o,c.length,l.length)||!Rt.areValidRelations(a,c[0].length,h.length))throw new C("Invalid relations between control points, knot vector, and n");var u,d,p=c[0][0].length;u=s<o?s:o,d=s<a?s:a;for(var f=Ct.zeros3d(s+1,s+1,p),m=Rt.knotSpanGivenN(t,o,r,l),g=Rt.knotSpanGivenN(e,a,n,h),v=Rt.derivativeBasisFunctionsGivenNI(m,r,o,t,l),_=Rt.derivativeBasisFunctionsGivenNI(g,n,a,e,h),y=Ct.zeros2d(a+1,p),x=0,b=u+1;x<b;){for(var M=x++,S=0,w=a+1;S<w;){var T=S++;y[T]=Ct.zeros1d(p);for(var E=0,P=o+1;E<P;){var A=E++;Ct.addMulMutate(y[T],v[M][A],c[m-o+A][g-a+T])}}for(var D=s-M,k=0,R=(D<d?D:d)+1;k<R;){var I=k++;f[M][I]=Ct.zeros1d(p);for(var O=0,L=a+1;O<L;){var N=O++;Ct.addMulMutate(f[M][I],_[I][N],y[N])}}}return f},Rt.surfacePoint=function(t,e,i){var r=t.knotsU.length-t.degreeU-2,n=t.knotsV.length-t.degreeV-2;return Rt.surfacePointGivenNM(r,n,t,e,i)},Rt.surfacePointGivenNM=function(t,e,i,r,n){var s=i.degreeU,o=i.degreeV,a=i.controlPoints,c=i.knotsU,l=i.knotsV;if(!Rt.areValidRelations(s,a.length,c.length)||!Rt.areValidRelations(o,a[0].length,l.length))throw new C("Invalid relations between control points, knot vector, and n");for(var h=a[0][0].length,u=Rt.knotSpanGivenN(t,s,r,c),d=Rt.knotSpanGivenN(e,o,n,l),p=Rt.basisFunctionsGivenKnotSpanIndex(u,r,s,c),f=Rt.basisFunctionsGivenKnotSpanIndex(d,n,o,l),m=u-s,g=d,v=Ct.zeros1d(h),_=Ct.zeros1d(h),y=0,x=o+1;y<x;){var b=y++;_=Ct.zeros1d(h),g=d-o+b;for(var M=0,S=s+1;M<S;){var w=M++;Ct.addMulMutate(_,p[w],a[m+w][g])}Ct.addMulMutate(v,f[b],_)}return v},Rt.curveRegularSamplePoints=function(t,e){for(var i=Rt.curveDerivatives(t,t.knots[0],t.degree),r=1/e,n=r*r,s=i[0],o=Ct.mul(r,i[1]),a=Ct.mul(.5*n,i[2]),c=Ct.mul(n*r*.5,i[3]),l=Ct.add(a,a),h=Ct.add(c,c),u=Ct.mul(.3333333333333333,c),d=[],p=0,f=e+1;p<f;)p++,d.push(Rt.dehomogenize(s)),Ct.addAllMutate([s,o,a,u]),Ct.addAllMutate([o,l,c]),Ct.addAllMutate([l,h]),Ct.addAllMutate([a,c]);return d},Rt.curveRegularSamplePoints2=function(t,e){for(var i=Rt.curveDerivatives(t,t.knots[0],t.degree),r=1/e,n=r*r,s=i[0],o=Ct.mul(r,i[1]),a=Ct.mul(.5*n,i[2]),c=Ct.mul(n*r*.5,i[3]),l=Ct.add(a,a),h=Ct.add(c,c),u=Ct.mul(.3333333333333333,c),d=[],p=0,f=e+1;p<f;)p++,d.push(Rt.dehomogenize(s)),Ct.addAllMutate([s,o,a,u]),Ct.addAllMutate([o,l,c]),Ct.addAllMutate([l,h]),Ct.addAllMutate([a,c]);return d},Rt.rationalSurfaceRegularSampleDerivatives=function(t,e,i,r){for(var n=Rt.surfaceRegularSampleDerivatives(t,e,i,r),s=[],o=e+1,a=i+1,c=r+1,l=0;l<o;){var h=l++,u=[];s.push(u);for(var d=0;d<a;){for(var p=d++,f=n[h][p],m=Rt.rational2d(f),g=Rt.weight2d(f),v=[],_=m[0][0].length,y=0;y<c;){var x=y++;v.push([]);for(var b=0,M=c-x;b<M;){for(var S=b++,w=m[x][S],T=1,C=S+1;T<C;){var E=T++;Ct.subMulMutate(w,B.get(S,E)*g[0][E],v[x][S-E])}for(var P=1,A=x+1;P<A;){var D=P++;Ct.subMulMutate(w,B.get(x,D)*g[D][0],v[x-D][S]);for(var k=Ct.zeros1d(_),R=1,I=S+1;R<I;){var O=R++;Ct.addMulMutate(k,B.get(S,O)*g[D][O],v[x-D][S-O])}Ct.subMulMutate(w,B.get(x,D),k)}Ct.mulMutate(1/g[0][0],w),v[x].push(w)}}u.push(v)}}return s},Rt.surfaceRegularSampleDerivatives=function(t,e,i,r){for(var n=t.degreeU,s=t.degreeV,o=t.controlPoints,a=t.knotsU,c=t.knotsV,l=o[0][0].length,h=(W.last(a),a[0],W.last(c),c[0],Rt.regularlySpacedDerivativeBasisFunctions(n,a,e)),u=h.item0,d=h.item1,p=Rt.regularlySpacedDerivativeBasisFunctions(s,c,i),f=p.item0,m=p.item1,g=[],v=e+1,_=i+1,y=0;y<v;){var x=y++,b=[];g.push(b);for(var M=0;M<_;){var S=M++;b.push(Rt.surfaceDerivativesGivenBasesKnotSpans(n,s,o,u[x],f[S],d[x],m[S],l,r))}}return g},Rt.rationalSurfaceRegularSamplePoints=function(t,e,i){return Rt.dehomogenize2d(Rt.surfaceRegularSamplePoints(t,e,i))},Rt.surfaceRegularSamplePoints=function(t,e,i){for(var r=t.degreeU,n=t.degreeV,s=t.controlPoints,o=t.knotsU,a=t.knotsV,c=s[0][0].length,l=(W.last(o),o[0],W.last(a),a[0],Rt.regularlySpacedBasisFunctions(r,o,e)),h=l.item0,u=l.item1,d=Rt.regularlySpacedBasisFunctions(n,a,i),p=d.item0,f=d.item1,m=[],g=e+1,v=i+1,_=0;_<g;){var y=_++,x=[];m.push(x);for(var b=0;b<v;){var M=b++;x.push(Rt.surfacePointGivenBasesKnotSpans(r,n,s,h[y],p[M],u[y],f[M],c))}}return m},Rt.regularlySpacedBasisFunctions=function(t,e,i){for(var r=e.length-t-2,n=(W.last(e)-e[0])/i,s=[],o=[],a=e[0],c=Rt.knotSpanGivenN(r,t,a,e),l=i+1,h=0;h<l;){for(h++;a>=e[c+1];)c++;o.push(c),s.push(Rt.basisFunctionsGivenKnotSpanIndex(c,a,t,e)),a+=n}return new K(o,s)},Rt.regularlySpacedDerivativeBasisFunctions=function(t,e,i){for(var r=e.length-t-2,n=(W.last(e)-e[0])/i,s=[],o=[],a=e[0],c=Rt.knotSpanGivenN(r,t,a,e),l=i+1,h=0;h<l;){for(h++;a>=e[c+1];)c++;o.push(c),s.push(Rt.derivativeBasisFunctionsGivenNI(c,a,t,r,e)),a+=n}return new K(o,s)},Rt.surfacePointGivenBasesKnotSpans=function(t,e,i,r,n,s,o,a){for(var c,l=Ct.zeros1d(a),h=r-t,u=n-e,d=0,p=e+1;d<p;){var f=d++;c=Ct.zeros1d(a);for(var m=0,g=t+1;m<g;){var v=m++;Ct.addMulMutate(c,s[v],i[h+v][u])}u++,Ct.addMulMutate(l,o[f],c)}return l},Rt.surfaceDerivativesGivenBasesKnotSpans=function(t,e,i,r,n,s,o,a,c){var l,h,u=i[0][0].length;l=c<t?c:t,h=c<e?c:e;for(var d=Ct.zeros3d(l+1,h+1,u),p=Ct.zeros2d(e+1,u),f=0,m=l+1;f<m;){for(var g=f++,v=0,_=e+1;v<_;){var y=v++;p[y]=Ct.zeros1d(u);for(var x=0,b=t+1;x<b;){var M=x++;Ct.addMulMutate(p[y],s[g][M],i[r-t+M][n-e+y])}}for(var S=c-g,w=0,T=(S<h?S:h)+1;w<T;){var C=w++;d[g][C]=Ct.zeros1d(u);for(var E=0,P=e+1;E<P;){var A=E++;Ct.addMulMutate(d[g][C],o[C][A],p[A])}}}return d},Rt.curveDerivatives=function(t,e,i){var r=t.knots.length-t.degree-2;return Rt.curveDerivativesGivenN(r,t,e,i)},Rt.curveDerivativesGivenN=function(t,e,i,r){var n=e.degree,s=e.controlPoints,o=e.knots;if(!Rt.areValidRelations(n,s.length,o.length))throw new C("Invalid relations between control points, knot vector, and n");var a,c=s[0].length;a=r<n?r:n;for(var l=Ct.zeros2d(r+1,c),h=Rt.knotSpanGivenN(t,n,i,o),u=Rt.derivativeBasisFunctionsGivenNI(h,i,n,a,o),d=0,p=a+1;d<p;)for(var f=d++,m=0,g=n+1;m<g;){var v=m++;Ct.addMulMutate(l[f],u[f][v],s[h-n+v])}return l},Rt.curvePoint=function(t,e){var i=t.knots.length-t.degree-2;return Rt.curvePointGivenN(i,t,e)},Rt.areValidRelations=function(t,e,i){return e+t+1-i==0},Rt.curvePointGivenN=function(t,e,i){var r=e.degree,n=e.controlPoints,s=e.knots;if(!Rt.areValidRelations(r,n.length,s.length))throw new C("Invalid relations between control points, knot Array, and n");for(var o=Rt.knotSpanGivenN(t,r,i,s),a=Rt.basisFunctionsGivenKnotSpanIndex(o,i,r,s),c=Ct.zeros1d(n[0].length),l=0,h=r+1;l<h;){var u=l++;Ct.addMulMutate(c,a[u],n[o-r+u])}return c},Rt.volumePoint=function(t,e,i,r){var n=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2,o=t.knotsW.length-t.degreeW-2;return Rt.volumePointGivenNML(t,n,s,o,e,i,r)},Rt.volumePointGivenNML=function(t,e,i,r,n,s,o){if(!Rt.areValidRelations(t.degreeU,t.controlPoints.length,t.knotsU.length)||!Rt.areValidRelations(t.degreeV,t.controlPoints[0].length,t.knotsV.length)||!Rt.areValidRelations(t.degreeW,t.controlPoints[0][0].length,t.knotsW.length))throw new C("Invalid relations between control points and knot vector");for(var a=t.controlPoints,c=t.degreeU,l=t.degreeV,h=t.degreeW,u=t.knotsU,d=t.knotsV,p=t.knotsW,f=a[0][0][0].length,m=Rt.knotSpanGivenN(e,c,n,u),g=Rt.knotSpanGivenN(i,l,s,d),v=Rt.knotSpanGivenN(r,h,o,p),_=Rt.basisFunctionsGivenKnotSpanIndex(m,n,c,u),y=Rt.basisFunctionsGivenKnotSpanIndex(g,s,l,d),x=Rt.basisFunctionsGivenKnotSpanIndex(v,o,h,p),b=m-c,M=Ct.zeros1d(f),S=Ct.zeros1d(f),w=Ct.zeros1d(f),T=0,E=h+1;T<E;){var P=T++;w=Ct.zeros1d(f);for(var A=v-h+P,D=0,k=l+1;D<k;){var R=D++;S=Ct.zeros1d(f);for(var I=g-l+R,O=0,L=c+1;O<L;){var N=O++;Ct.addMulMutate(S,_[N],a[b+N][I][A])}Ct.addMulMutate(w,y[R],S)}Ct.addMulMutate(M,x[P],w)}return M},Rt.derivativeBasisFunctions=function(t,e,i){var r=Rt.knotSpan(e,t,i),n=i.length-1-e-1;return Rt.derivativeBasisFunctionsGivenNI(r,t,e,n,i)},Rt.derivativeBasisFunctionsGivenNI=function(t,e,i,r,n){var s=Ct.zeros2d(i+1,i+1),o=Ct.zeros1d(i+1),a=Ct.zeros1d(i+1),c=0,l=0;s[0][0]=1;for(var h=1,u=i+1;h<u;){var d=h++;o[d]=e-n[t+1-d],a[d]=n[t+d]-e,c=0;for(var p=0;p<d;){var f=p++;s[d][f]=a[f+1]+o[d-f],l=s[f][d-1]/s[d][f],s[f][d]=c+a[f+1]*l,c=o[d-f]*l}s[d][d]=c}for(var m=Ct.zeros2d(r+1,i+1),g=Ct.zeros2d(2,i+1),v=0,_=1,y=0,x=0,b=0,M=0,S=i+1;M<S;){var w=M++;m[0][w]=s[w][i]}for(var T=0,C=i+1;T<C;){var E=T++;v=0,_=1,g[0][0]=1;for(var P=1,A=r+1;P<A;){var D=P++;y=0,x=E-D,b=i-D,E>=D&&(g[_][0]=g[v][0]/s[b+1][x],y=g[_][0]*s[x][b]);for(var k=x>=-1?1:-x,R=1+(E-1<=b?D-1:i-E);k<R;){var I=k++;g[_][I]=(g[v][I]-g[v][I-1])/s[b+1][x+I],y+=g[_][I]*s[x+I][b]}E<=b&&(g[_][D]=-g[v][D-1]/s[b+1][E],y+=g[_][D]*s[E][b]),m[D][E]=y;var O=v;v=_,_=O}}for(var L=i,N=1,F=r+1;N<F;){for(var U=N++,W=0,B=i+1;W<B;){var z=W++;m[U][z]*=L}L*=i-U}return m},Rt.basisFunctions=function(t,e,i){var r=Rt.knotSpan(e,t,i);return Rt.basisFunctionsGivenKnotSpanIndex(r,t,e,i)},Rt.basisFunctionsGivenKnotSpanIndex=function(t,e,i,r){var n=Ct.zeros1d(i+1),s=Ct.zeros1d(i+1),o=Ct.zeros1d(i+1),a=0,c=0;n[0]=1;for(var l=1,h=i+1;l<h;){var u=l++;s[u]=e-r[t+1-u],o[u]=r[t+u]-e,a=0;for(var d=0;d<u;){var p=d++;c=n[p]/(o[p+1]+s[u-p]),n[p]=a+o[p+1]*c,a=s[u-p]*c}n[u]=a}return n},Rt.knotSpan=function(t,e,i){return Rt.knotSpanGivenN(i.length-t-2,t,e,i)},Rt.knotSpanGivenN=function(t,e,i,r){if(i>r[t+1]-V.EPSILON)return t;if(i<r[e]+V.EPSILON)return e;for(var n=e,s=t+1,o=Math.floor((n+s)/2);i<r[o]||i>=r[o+1];)i<r[o]?s=o:n=o,o=Math.floor((n+s)/2);return o},Rt.dehomogenize=function(t){for(var e=[],i=t[t.length-1],r=t.length-1,n=0;n<r;){var s=n++;e.push(t[s]/i)}return e},Rt.rational1d=function(t){var e=t[0].length-1;return t.map((function(t){return t.slice(0,e)}))},Rt.rational2d=function(t){return t.map(Rt.rational1d)},Rt.weight1d=function(t){var e=t[0].length-1;return t.map((function(t){return t[e]}))},Rt.weight2d=function(t){return t.map(Rt.weight1d)},Rt.dehomogenize1d=function(t){return t.map(Rt.dehomogenize)},Rt.dehomogenize2d=function(t){return t.map(Rt.dehomogenize1d)},Rt.homogenize1d=function(t,e){var i,r=t.length,n=t[0].length,s=[],o=0,a=[];i=null!=e?e:Ct.rep(t.length,1);for(var c=0;c<r;){var l=c++,h=[];a=t[l],o=i[l];for(var u=0;u<n;){var d=u++;h.push(a[d]*o)}h.push(o),s.push(h)}return s},Rt.homogenize2d=function(t,e){var i,r=t.length,n=[];if(null!=e)i=e;else{for(var s=[],o=0;o<r;)o++,s.push(Ct.rep(t[0].length,1));i=s}for(var a=0;a<r;){var c=a++;n.push(Rt.homogenize1d(t[c],i[c]))}return n};var It=e.eval.Intersect=function(){};r["verb.eval.Intersect"]=It,It.__name__=["verb","eval","Intersect"],It.surfaces=function(t,e,i){var r=Nt.rationalSurfaceAdaptive(t),n=Nt.rationalSurfaceAdaptive(e);return It.meshes(r,n).map((function(r){return r.map((function(r){return It.surfacesAtPointWithEstimate(t,e,r.uv0,r.uv1,i)}))})).map((function(t){return Ot.rationalInterpCurve(t.map((function(t){return t.point})),3)}))},It.surfacesAtPointWithEstimate=function(t,e,i,r,n){var s,o,a,c,l,h,u,d,p,f,m,g,v,_=0;do{if(o=(s=Rt.rationalSurfaceDerivatives(t,i[0],i[1],1))[0][0],c=s[1][0],l=s[0][1],a=Ct.normalized(Ct.cross(c,l)),h=Ct.dot(a,o),d=(u=Rt.rationalSurfaceDerivatives(e,r[0],r[1],1))[0][0],f=u[1][0],m=u[0][1],p=Ct.normalized(Ct.cross(f,m)),g=Ct.dot(p,d),(v=Ct.distSquared(o,d))<n*n)break;var y=Ct.normalized(Ct.cross(a,p)),x=Ct.dot(y,o),b=It.threePlanes(a,h,p,g,y,x);if(null==b)throw new C("panic!");var M=Ct.sub(b,o),S=Ct.sub(b,d),w=Ct.cross(c,a),T=Ct.cross(l,a),E=Ct.cross(f,p),P=Ct.cross(m,p),A=Ct.dot(T,M)/Ct.dot(T,c),D=Ct.dot(w,M)/Ct.dot(w,l),k=Ct.dot(P,S)/Ct.dot(P,f),R=Ct.dot(E,S)/Ct.dot(E,m);i=Ct.add([A,D],i),r=Ct.add([k,R],r),_++}while(_<5);return new rt(i,r,o,v)},It.meshes=function(t,e,i,r){null==i&&(i=new ft(t)),null==r&&(r=new ft(e));var n=It.boundingBoxTrees(i,r,0),s=W.unique(n.map((function(i){return It.triangles(t,i.item0,e,i.item1)})).filter((function(t){return null!=t})).filter((function(t){return Ct.distSquared(t.min.point,t.max.point)>V.EPSILON})),(function(t,e){var i=Ct.sub(t.min.uv0,e.min.uv0),r=Ct.dot(i,i),n=Ct.sub(t.max.uv0,e.max.uv0),s=Ct.dot(n,n),o=Ct.sub(t.min.uv0,e.max.uv0),a=Ct.dot(o,o),c=Ct.sub(t.max.uv0,e.min.uv0),l=Ct.dot(c,c);return r<V.EPSILON&&s<V.EPSILON||a<V.EPSILON&&l<V.EPSILON}));return It.makeMeshIntersectionPolylines(s)},It.meshSlices=function(t,e,i,r){for(var n=new xt(t),s=n.boundingBox(),o=s.min[0],a=s.min[1],c=s.max[0],l=s.max[1],h=Ct.span(e,i,r),u=[],d=0;d<h.length;){var p=h[d];++d;var f=new Y([[0,1,2],[0,2,3]],[[o,a,p],[c,a,p],[c,l,p],[o,l,p]],null,[[0,0],[1,0],[1,1],[0,1]]);u.push(It.meshes(t,f,n))}return u},It.makeMeshIntersectionPolylines=function(t){if(0==t.length)return[];for(var e=0;e<t.length;){var i=t[e];++e,i.max.opp=i.min,i.min.opp=i.max}for(var r=It.kdTreeFromSegments(t),n=[],s=0;s<t.length;){var o=t[s];++s,n.push(o.min),n.push(o.max)}for(var a=0;a<n.length;){var c=n[a];if(++a,null==c.adj){var l=It.lookupAdjacentSegment(c,r,t.length);null!=l&&null==l.adj&&(c.adj=l,l.adj=c)}}var h=n.filter((function(t){return null==t.adj}));0==h.length&&(h=n);for(var u=[],d=0,p=!1;0!=h.length;){var f=h.pop();if(!f.visited){for(var m=[],g=f;null!=g&&!g.visited&&(g.visited=!0,g.opp.visited=!0,m.push(g),d+=2,(g=g.opp.adj)!=f););m.length>0&&(m.push(m[m.length-1].opp),u.push(m))}if(0==h.length&&n.length>0&&(p||d<n.length)){p=!0;var v=n.pop();h.push(v)}}return u},It.kdTreeFromSegments=function(t){for(var e=[],i=0;i<t.length;){var r=t[i];++i,e.push(new ht(r.min.point,r.min)),e.push(new ht(r.max.point,r.max))}return new ct(e,Ct.distSquared)},It.lookupAdjacentSegment=function(t,e,i){var r=e.nearest(t.point,i,V.EPSILON).filter((function(e){return t!=e.item0.obj})).map((function(t){return t.item0.obj}));return 1==r.length?r[0]:null},It.curveAndSurface=function(t,e,i,r,n){null==i&&(i=.001),null!=r||(r=new pt(t)),null!=n||(n=new gt(e));var s=It.boundingBoxTrees(r,n,i);return W.unique(s.map((function(t){var e=t.item0,r=t.item1,n=(W.first(e.knots)+W.last(e.knots))/2,s=[(W.first(r.knotsU)+W.last(r.knotsU))/2,(W.first(r.knotsV)+W.last(r.knotsV))/2];return It.curveAndSurfaceWithEstimate(e,r,[n].concat(s),i)})).filter((function(t){return Ct.distSquared(t.curvePoint,t.surfacePoint)<i*i})),(function(t,e){return Math.abs(t.u-e.u)<.5*i}))},It.curveAndSurfaceWithEstimate=function(t,e,i,r){null==r&&(r=.001);var n=bt.uncmin((function(i){var r=Rt.rationalCurvePoint(t,i[0]),n=Rt.rationalSurfacePoint(e,i[1],i[2]),s=Ct.sub(r,n);return Ct.dot(s,s)}),i,r*r,(function(i){var r=Rt.rationalCurveDerivatives(t,i[0],1),n=Rt.rationalSurfaceDerivatives(e,i[1],i[2],1),s=Ct.sub(n[0][0],r[0]),o=Ct.mul(-1,r[1]),a=n[1][0],c=n[0][1];return[2*Ct.dot(o,s),2*Ct.dot(a,s),2*Ct.dot(c,s)]})).solution;return new tt(n[0],[n[1],n[2]],Rt.rationalCurvePoint(t,n[0]),Rt.rationalSurfacePoint(e,n[1],n[2]))},It.polylineAndMesh=function(t,e,i){for(var r=It.boundingBoxTrees(new mt(t),new ft(e),i),n=[],s=0;s<r.length;){var o=r[s];++s;var a=o.item0,c=o.item1,l=It.segmentWithTriangle(t.points[a],t.points[a+1],e.points,e.faces[c]);if(null!=l){var h=l.point,u=Ct.lerp(l.p,[t.params[a]],[t.params[a+1]])[0],d=yt.triangleUVFromPoint(e,c,h);n.push(new it(h,u,d,a,c))}}return n},It.boundingBoxTrees=function(t,e,i){null==i&&(i=1e-9);var r=[],n=[];r.push(t),n.push(e);for(var s=[];r.length>0;){var o=r.pop(),a=n.pop();if(!o.empty()&&!a.empty()&&o.boundingBox().intersects(a.boundingBox(),i)){var c=o.indivisible(i),l=a.indivisible(i);if(c&&l)s.push(new K(o.yield(),a.yield()));else if(!c||l)if(c||!l){var h=o.split(),u=a.split();r.push(h.item1),n.push(u.item1),r.push(h.item1),n.push(u.item0),r.push(h.item0),n.push(u.item1),r.push(h.item0),n.push(u.item0)}else{var d=o.split();r.push(d.item1),n.push(a),r.push(d.item0),n.push(a)}else{var p=a.split();r.push(o),n.push(p.item1),r.push(o),n.push(p.item0)}}}return s},It.curves=function(t,e,i){var r=It.boundingBoxTrees(new pt(t),new pt(e),0);return W.unique(r.map((function(r){return It.curvesWithEstimate(t,e,W.first(r.item0.knots),W.first(r.item1.knots),i)})).filter((function(t){return Ct.distSquared(t.point0,t.point1)<i})),(function(t,e){return Math.abs(t.u0-e.u0)<5*i}))},It.curvesWithEstimate=function(t,e,i,r,n){var s=bt.uncmin((function(i){var r=Rt.rationalCurvePoint(t,i[0]),n=Rt.rationalCurvePoint(e,i[1]),s=Ct.sub(r,n);return Ct.dot(s,s)}),[i,r],n*n,(function(i){var r=Rt.rationalCurveDerivatives(t,i[0],1),n=Rt.rationalCurveDerivatives(e,i[1],1),s=Ct.sub(r[0],n[0]),o=r[1],a=Ct.mul(-1,n[1]);return[2*Ct.dot(o,s),2*Ct.dot(a,s)]})),o=s.solution[0],a=s.solution[1],c=Rt.rationalCurvePoint(t,o),l=Rt.rationalCurvePoint(e,a);return new Q(c,l,o,a)},It.triangles=function(t,e,i,r){var n=t.faces[e],s=i.faces[r],o=yt.getTriangleNorm(t.points,n),a=yt.getTriangleNorm(i.points,s),c=t.points[n[0]],l=i.points[s[0]],h=It.planes(c,o,l,a);if(null==h)return null;var u=It.clipRayInCoplanarTriangle(h,t,e);if(null==u)return null;var d=It.clipRayInCoplanarTriangle(h,i,r);if(null==d)return null;var p=It.mergeTriangleClipIntervals(u,d,t,e,i,r);return null==p?null:new $(new et(p.min.uv0,p.min.uv1,p.min.point,e,r),new et(p.max.uv0,p.max.uv1,p.max.point,e,r))},It.clipRayInCoplanarTriangle=function(t,e,i){for(var r=e.faces[i],n=[e.points[r[0]],e.points[r[1]],e.points[r[2]]],s=[e.uvs[r[0]],e.uvs[r[1]],e.uvs[r[2]]],o=[Ct.sub(s[1],s[0]),Ct.sub(s[2],s[1]),Ct.sub(s[0],s[2])],a=[Ct.sub(n[1],n[0]),Ct.sub(n[2],n[1]),Ct.sub(n[0],n[2])],c=a.map(Ct.normalized),l=a.map(Ct.norm),h=null,u=null,d=0;d<3;){var p=d++,f=n[p],m=c[p],g=It.rays(f,m,t.origin,t.dir);if(null!=g){var v=g.u0,_=g.u1;v<-V.EPSILON||v>l[p]+V.EPSILON||((null==h||_<h.u)&&(h=new st(_,Ct.onRay(t.origin,t.dir,_),Ct.onRay(s[p],o[p],v/l[p]))),(null==u||_>u.u)&&(u=new st(_,Ct.onRay(t.origin,t.dir,_),Ct.onRay(s[p],o[p],v/l[p]))))}}return null==u||null==h?null:new $(h,u)},It.mergeTriangleClipIntervals=function(t,e,i,r,n,s){if(e.min.u>t.max.u+V.EPSILON||t.min.u>e.max.u+V.EPSILON)return null;var o,a;o=t.min.u>e.min.u?new K(t.min,0):new K(e.min,1),a=t.max.u<e.max.u?new K(t.max,0):new K(e.max,1);var c=new $(new et(null,null,o.item0.point,r,s),new et(null,null,a.item0.point,r,s));return 0==o.item1?(c.min.uv0=o.item0.uv,c.min.uv1=yt.triangleUVFromPoint(n,s,o.item0.point)):(c.min.uv0=yt.triangleUVFromPoint(i,r,o.item0.point),c.min.uv1=o.item0.uv),0==a.item1?(c.max.uv0=a.item0.uv,c.max.uv1=yt.triangleUVFromPoint(n,s,a.item0.point)):(c.max.uv0=yt.triangleUVFromPoint(i,r,a.item0.point),c.max.uv1=a.item0.uv),c},It.planes=function(t,e,i,r){var n=Ct.cross(e,r);if(Ct.dot(n,n)<V.EPSILON)return null;var s,o,a,c,l=0,h=Math.abs(n[0]),u=Math.abs(n[1]),d=Math.abs(n[2]);u>h&&(l=1,h=u),d>h&&(l=2,h=d),0==l?(s=e[1],o=e[2],a=r[1],c=r[2]):1==l?(s=e[0],o=e[2],a=r[0],c=r[2]):(s=e[0],o=e[1],a=r[0],c=r[1]);var p=-Ct.dot(t,e),f=-Ct.dot(i,r),m=s*c-o*a,g=(o*f-p*c)/m,v=(p*a-s*f)/m;return new j(0==l?[0,g,v]:1==l?[g,0,v]:[g,v,0],Ct.normalized(n))},It.threePlanes=function(t,e,i,r,n,s){var o=Ct.cross(i,n),a=Ct.dot(t,o);if(Math.abs(a)<V.EPSILON)return null;var c=Ct.sub(Ct.mul(s,i),Ct.mul(r,n)),l=Ct.add(Ct.mul(e,o),Ct.cross(t,c));return Ct.mul(1/a,l)},It.polylines=function(t,e,i){for(var r=It.boundingBoxTrees(new mt(t),new mt(e),i),n=[],s=0;s<r.length;){var o=r[s];++s;var a=o.item0,c=o.item1,l=It.segments(t.points[a],t.points[a+1],e.points[c],e.points[c+1],i);null!=l&&(l.u0=Ct.lerp(l.u0,[t.params[a]],[t.params[a+1]])[0],l.u1=Ct.lerp(l.u1,[e.params[c]],[e.params[c+1]])[0],n.push(l))}return n},It.segments=function(t,e,i,r,n){var s=Ct.sub(e,t),o=Math.sqrt(Ct.dot(s,s)),a=Ct.mul(1/o,s),c=Ct.sub(r,i),l=Math.sqrt(Ct.dot(c,c)),h=Ct.mul(1/l,c),u=It.rays(t,a,i,h);if(null!=u){var d=Math.min(Math.max(0,u.u0/o),1),p=Math.min(Math.max(0,u.u1/l),1),f=Ct.onRay(t,s,d),m=Ct.onRay(i,c,p);if(Ct.distSquared(f,m)<n*n)return new Q(f,m,d,p)}return null},It.rays=function(t,e,i,r){var n=Ct.dot(e,r),s=Ct.dot(e,i),o=Ct.dot(e,t),a=Ct.dot(r,i),c=Ct.dot(r,t),l=Ct.dot(e,e),h=l*Ct.dot(r,r)-n*n;if(Math.abs(h)<V.EPSILON)return null;var u=(n*(s-o)-l*(a-c))/h,d=(s-o+u*n)/l,p=Ct.onRay(t,e,d),f=Ct.onRay(i,r,u);return new Q(p,f,d,u)},It.segmentWithTriangle=function(t,e,i,r){var n=i[r[0]],s=i[r[1]],o=i[r[2]],a=Ct.sub(s,n),c=Ct.sub(o,n),l=Ct.cross(a,c),h=Ct.sub(e,t),u=Ct.sub(t,n),d=-Ct.dot(l,u),p=Ct.dot(l,h);if(Math.abs(p)<V.EPSILON)return null;var f=d/p;if(f<0||f>1)return null;var m=Ct.add(t,Ct.mul(f,h)),g=Ct.dot(a,c),v=Ct.dot(a,a),_=Ct.dot(c,c),y=Ct.sub(m,n),x=Ct.dot(y,a),b=Ct.dot(y,c),M=g*g-v*_;if(Math.abs(M)<V.EPSILON)return null;var S=(g*b-_*x)/M,w=(g*x-v*b)/M;return S>1+V.EPSILON||w>1+V.EPSILON||w<-V.EPSILON||S<-V.EPSILON||S+w>1+V.EPSILON?null:new nt(m,S,w,f)},It.segmentAndPlane=function(t,e,i,r){var n=Ct.dot(r,Ct.sub(e,t));if(Math.abs(n)<V.EPSILON)return null;var s=Ct.dot(r,Ct.sub(i,t))/n;return s>1+V.EPSILON||s<-V.EPSILON?null:{p:s}};var Ot=e.eval.Make=function(){};r["verb.eval.Make"]=Ot,Ot.__name__=["verb","eval","Make"],Ot.rationalTranslationalSurface=function(t,e){for(var i=Rt.rationalCurvePoint(e,W.first(e.knots)),r=W.first(e.knots),n=W.last(e.knots),s=2*e.controlPoints.length,o=(n-r)/(s-1),a=[],c=0;c<s;){var l=c++,h=Ct.sub(Rt.rationalCurvePoint(e,r+l*o),i),u=Lt.rationalCurveTransform(t,[[1,0,0,h[0]],[0,1,0,h[1]],[0,0,1,h[2]],[0,0,0,1]]);a.push(u)}return Ot.loftedSurface(a)},Ot.surfaceBoundaryCurves=function(t){return[Ot.surfaceIsocurve(t,W.first(t.knotsU),!1),Ot.surfaceIsocurve(t,W.last(t.knotsU),!1),Ot.surfaceIsocurve(t,W.first(t.knotsV),!0),Ot.surfaceIsocurve(t,W.last(t.knotsV),!0)]},Ot.surfaceIsocurve=function(t,e,i){var r,n;null==i&&(i=!1),r=i?t.knotsV:t.knotsU,n=i?t.degreeV:t.degreeU;for(var s=Et.knotMultiplicities(r),o=-1,a=0,c=s.length;a<c;){var l=a++;if(Math.abs(e-s[l].knot)<V.EPSILON){o=l;break}}var h,u=n+1;o>=0&&(u-=s[o].mult),h=u>0?Lt.surfaceKnotRefine(t,Ct.rep(u,e),i):t;var d=Rt.knotSpan(n,e,r);return Math.abs(e-W.first(r))<V.EPSILON?d=0:Math.abs(e-W.last(r))<V.EPSILON&&(d=(i?h.controlPoints[0].length:h.controlPoints.length)-1),i?new X(h.degreeU,h.knotsU,function(t){for(var e=[],i=0,r=h.controlPoints;i<r.length;){var n=r[i];++i,e.push(n[d])}return e}()):new X(h.degreeV,h.knotsV,h.controlPoints[d])},Ot.loftedSurface=function(t,e){var i=(t=Lt.unifyCurveKnotVectors(t))[0].degree;null==e&&(e=3),e>t.length-1&&(e=t.length-1);for(var r=t[0].knots,n=[],s=[],o=0,a=t[0].controlPoints.length;o<a;){var c=[o++],l=t.map(function(t){return function(e){return e.controlPoints[t[0]]}}(c)),h=Ot.rationalInterpCurve(l,e,!0);s.push(h.controlPoints),n=h.knots}return new q(i,e,r,n,s)},Ot.clonedCurve=function(t){return new X(t.degree,t.knots.slice(),t.controlPoints.map((function(t){return t.slice()})))},Ot.rationalBezierCurve=function(t,e){for(var i=t.length-1,r=[],n=0,s=i+1;n<s;)n++,r.push(0);for(var o=0,a=i+1;o<a;)o++,r.push(1);return null==e&&(e=Ct.rep(t.length,1)),new X(i,r,Rt.homogenize1d(t,e))},Ot.fourPointSurface=function(t,e,i,r,n){null==n&&(n=3);for(var s=n,o=[],a=0,c=n+1;a<c;){for(var l=a++,h=[],u=0,d=n+1;u<d;){var p=u++,f=1-l/s,m=Ct.lerp(f,t,e),g=Ct.lerp(f,r,i),v=Ct.lerp(1-p/s,m,g);v.push(1),h.push(v)}o.push(h)}var _=Ct.rep(n+1,0),y=Ct.rep(n+1,1);return new q(n,n,_.concat(y),_.concat(y),o)},Ot.ellipseArc=function(t,e,i,r,n){var s=Ct.norm(e),o=Ct.norm(i);e=Ct.normalized(e),i=Ct.normalized(i),n<r&&(n=2*Math.PI+r);var a,c=n-r,l=c/(a=c<=Math.PI/2?1:c<=Math.PI?2:c<=3*Math.PI/2?3:4),h=Math.cos(l/2),u=Ct.add(t,Ct.add(Ct.mul(s*Math.cos(r),e),Ct.mul(o*Math.sin(r),i))),d=Ct.sub(Ct.mul(Math.cos(r),i),Ct.mul(Math.sin(r),e)),p=[],f=Ct.zeros1d(2*a+3),m=0,g=r,v=Ct.zeros1d(2*a);p[0]=u,v[0]=1;for(var _=1,y=a+1;_<y;){var x=_++;g+=l;var b=Ct.add(t,Ct.add(Ct.mul(s*Math.cos(g),e),Ct.mul(o*Math.sin(g),i)));v[m+2]=1,p[m+2]=b;var M=Ct.sub(Ct.mul(Math.cos(g),i),Ct.mul(Math.sin(g),e)),S=It.rays(u,Ct.mul(1/Ct.norm(d),d),b,Ct.mul(1/Ct.norm(M),M)),w=Ct.add(u,Ct.mul(S.u0,d));v[m+1]=h,p[m+1]=w,m+=2,x<a&&(u=b,d=M)}for(var T=2*a+1,C=0;C<3;){var E=C++;f[E]=0,f[E+T]=1}switch(a){case 2:f[3]=f[4]=.5;break;case 3:f[3]=f[4]=.3333333333333333,f[5]=f[6]=.6666666666666666;break;case 4:f[3]=f[4]=.25,f[5]=f[6]=.5,f[7]=f[8]=.75}return new X(2,f,Rt.homogenize1d(p,v))},Ot.arc=function(t,e,i,r,n,s){return Ot.ellipseArc(t,Ct.mul(r,Ct.normalized(e)),Ct.mul(r,Ct.normalized(i)),n,s)},Ot.polyline=function(t){for(var e,i=[0,0],r=0,n=0,s=t.length-1;n<s;){var o=n++;r+=Ct.dist(t[o],t[o+1]),i.push(r)}i.push(r),i=Ct.mul(1/r,i);for(var a=[],c=0,l=t.length;c<l;)c++,a.push(1);return e=a,new X(1,i,Rt.homogenize1d(t.slice(0),e))},Ot.extrudedSurface=function(t,e,i){for(var r=[[],[],[]],n=[[],[],[]],s=Rt.dehomogenize1d(i.controlPoints),o=Rt.weight1d(i.controlPoints),a=Ct.mul(e,t),c=Ct.mul(.5*e,t),l=0,h=s.length;l<h;){var u=l++;r[2][u]=s[u],r[1][u]=Ct.add(c,s[u]),r[0][u]=Ct.add(a,s[u]),n[0][u]=o[u],n[1][u]=o[u],n[2][u]=o[u]}return new q(2,i.degree,[0,0,0,1,1,1],i.knots,Rt.homogenize2d(r,n))},Ot.cylindricalSurface=function(t,e,i,r,n){var s=Ct.cross(t,e),o=(Math.PI,Ot.arc(i,e,s,n,0,2*Math.PI));return Ot.extrudedSurface(t,r,o)},Ot.revolvedSurface=function(t,e,i,r){var n,s,o=Rt.dehomogenize1d(t.controlPoints),a=Rt.weight1d(t.controlPoints);r<=Math.PI/2?(n=1,s=Ct.zeros1d(6+2*(n-1))):r<=Math.PI?(n=2,(s=Ct.zeros1d(6+2*(n-1)))[3]=s[4]=.5):r<=3*Math.PI/2?(n=3,(s=Ct.zeros1d(6+2*(n-1)))[3]=s[4]=.3333333333333333,s[5]=s[6]=.6666666666666666):(n=4,(s=Ct.zeros1d(6+2*(n-1)))[3]=s[4]=.25,s[5]=s[6]=.5,s[7]=s[8]=.75);for(var c=r/n,l=3+2*(n-1),h=0;h<3;){var u=h++;s[u]=0,s[l+u]=1}for(var d=Math.cos(c/2),p=0,f=Ct.zeros1d(n+1),m=Ct.zeros1d(n+1),g=Ct.zeros3d(2*n+1,o.length,3),v=Ct.zeros2d(2*n+1,o.length),_=1,y=n+1;_<y;){var x=_++;p+=c,m[x]=Math.cos(p),f[x]=Math.sin(p)}for(var b=0,M=o.length;b<M;){var S=b++,w=Tt.rayClosestPoint(o[S],e,i),T=Ct.sub(o[S],w),C=Ct.norm(T),E=Ct.cross(i,T);C>V.EPSILON&&(T=Ct.mul(1/C,T),E=Ct.mul(1/C,E)),g[0][S]=o[S];var P=o[S];v[0][S]=a[S];for(var A=E,D=0,k=1,R=n+1;k<R;){var I,O=k++;I=0==C?w:Ct.add(w,Ct.add(Ct.mul(C*m[O],T),Ct.mul(C*f[O],E))),g[D+2][S]=I,v[D+2][S]=a[S];var L=Ct.sub(Ct.mul(m[O],E),Ct.mul(f[O],T));if(0==C)g[D+1][S]=w;else{var N=It.rays(P,Ct.mul(1/Ct.norm(A),A),I,Ct.mul(1/Ct.norm(L),L)),F=Ct.add(P,Ct.mul(N.u0,A));g[D+1][S]=F}v[D+1][S]=d*a[S],D+=2,O<n&&(P=I,A=L)}}return new q(2,t.degree,s,t.knots,Rt.homogenize2d(g,v))},Ot.sphericalSurface=function(t,e,i,r){var n=Ot.arc(t,Ct.mul(-1,e),i,r,0,Math.PI);return Ot.revolvedSurface(n,t,e,2*Math.PI)},Ot.conicalSurface=function(t,e,i,r,n){var s=2*Math.PI,o=[Ct.add(i,Ct.mul(r,t)),Ct.add(i,Ct.mul(n,e))],a=new X(1,[0,0,1,1],Rt.homogenize1d(o,[1,1]));return Ot.revolvedSurface(a,i,t,s)},Ot.rationalInterpCurve=function(t,e,i,r,n){if(null==i&&(i=!1),null==e&&(e=3),t.length<e+1)throw new C("You need to supply at least degree + 1 points! You only supplied "+t.length+" points.");for(var s=[0],o=1,a=t.length;o<a;){var c=o++,l=Ct.norm(Ct.sub(t[c],t[c-1])),h=s[s.length-1];s.push(h+l)}for(var u=s[s.length-1],d=0,p=s.length;d<p;){var f=d++;s[f]=s[f]/u}var m,g,v=Ct.rep(e+1,0),_=null!=r&&null!=n;m=_?0:1,g=_?s.length-e+1:s.length-e;for(var y=m;y<g;){for(var x=y++,b=0,M=0;M<e;)b+=s[x+M++];v.push(1/e*b)}var S,w,T=v.concat(Ct.rep(e+1,1)),E=[];S=_?t.length+1:t.length-1,w=_?t.length-(e-1):t.length-(e+1);for(var P=0;P<s.length;){var A=s[P];++P;var D=Rt.knotSpanGivenN(S,e,A,T),k=Rt.basisFunctionsGivenKnotSpanIndex(D,A,e,T),R=D-e,I=Ct.zeros1d(R),O=Ct.zeros1d(w-R);E.push(I.concat(k).concat(O))}if(_){var L=E[0].length-2,N=[-1,1].concat(Ct.zeros1d(L)),F=Ct.zeros1d(L).concat([-1,1]);W.spliceAndInsert(E,1,0,N),W.spliceAndInsert(E,E.length-1,0,F)}for(var U=t[0].length,B=[],z=(1-T[T.length-e-2])/e,V=T[e+1]/e,H=0;H<U;){var G,j=[H++];if(_){(G=[t[0][j[0]]]).push(V*r[j[0]]);for(var q=1,Y=t.length-1;q<Y;){var Z=q++;G.push(t[Z][j[0]])}G.push(z*n[j[0]]),G.push(W.last(t)[j[0]])}else G=t.map(function(t){return function(e){return e[t[0]]}}(j));var J=vt.solve(E,G);B.push(J)}var K=vt.transpose(B);if(!i){var $=Ct.rep(K.length,1);K=Rt.homogenize1d(K,$)}return new X(e,T,K)};var Lt=e.eval.Modify=function(){};r["verb.eval.Modify"]=Lt,Lt.__name__=["verb","eval","Modify"],Lt.curveReverse=function(t){return new X(t.degree,Lt.knotsReverse(t.knots),W.reversed(t.controlPoints))},Lt.surfaceReverse=function(t,e){return null==e&&(e=!1),e?new q(t.degreeU,t.degreeV,t.knotsU,Lt.knotsReverse(t.knotsV),function(e){for(var i=[],r=0,n=t.controlPoints;r<n.length;){var s=n[r];++r,i.push(W.reversed(s))}return i}()):new q(t.degreeU,t.degreeV,Lt.knotsReverse(t.knotsU),t.knotsV,W.reversed(t.controlPoints))},Lt.knotsReverse=function(t){for(var e=W.first(t),i=(W.last(t),[e]),r=t.length,n=1;n<r;){var s=n++;i.push(i[s-1]+(t[r-s]-t[r-s-1]))}return i},Lt.unifyCurveKnotVectors=function(t){t=t.map(Ot.clonedCurve);for(var e,i=a.fold(t,(function(t,e){return Lt.imax(t.degree,e)}),0),r=0,n=t.length;r<n;){var s=r++;t[s].degree<i&&(t[s]=Lt.curveElevateDegree(t[s],i))}for(var o=[],c=0;c<t.length;){var l=t[c];++c,o.push(new $(W.first(l.knots),W.last(l.knots)))}e=o;for(var h=0,u=t.length;h<u;){var d=h++,p=[e[d].min];t[d].knots=t[d].knots.map(function(t){return function(e){return e-t[0]}}(p))}for(var f=e.map((function(t){return t.max-t.min})),m=a.fold(f,(function(t,e){return Math.max(t,e)}),0),g=0,v=t.length;g<v;){var _=g++,y=[m/f[_]];t[_].knots=t[_].knots.map(function(t){return function(e){return e*t[0]}}(y))}for(var x=a.fold(t,(function(t,e){return Ct.sortedSetUnion(t.knots,e)}),[]),b=0,M=t.length;b<M;){var S=b++,w=Ct.sortedSetSub(x,t[S].knots);0==w.length&&(t[S]=t[S]),t[S]=Lt.curveKnotRefine(t[S],w)}return t},Lt.imin=function(t,e){return t<e?t:e},Lt.imax=function(t,e){return t>e?t:e},Lt.curveElevateDegree=function(t,e){if(e<=t.degree)return t;var i=t.knots.length-t.degree-2,r=t.degree,n=t.knots,s=t.controlPoints,o=e-t.degree,a=t.controlPoints[0].length,c=Ct.zeros2d(r+o+1,r+1),l=[],h=[],u=[],d=i+r+1,p=e,f=Math.floor(p/2),m=[],g=[];c[0][0]=1,c[p][r]=1;for(var v=1,_=f+1;v<_;)for(var y=v++,x=1/B.get(p,y),b=Lt.imin(r,y),M=Lt.imax(0,y-o),S=b+1;M<S;){var w=M++;c[y][w]=x*B.get(r,w)*B.get(o,y-w)}for(var T=f+1;T<p;)for(var C=T++,E=Lt.imin(r,C),P=Lt.imax(0,C-o),A=E+1;P<A;){var D=P++;c[C][D]=c[p-C][r-D]}var k=p+1,R=-1,I=r,O=r+1,L=1,N=n[0];m[0]=s[0];for(var F=0,U=p+1;F<U;)g[F++]=N;for(var W=0,z=r+1;W<z;){var V=W++;l[V]=s[V]}for(;O<d;){for(var H=O;O<d&&n[O]==n[O+1];)O+=1;var G,j,q=O-H+1,Y=n[O],Z=R;if(R=r-q,G=Z>0?Math.floor((Z+2)/2):1,j=R>0?Math.floor(p-(R+1)/2):p,R>0){for(var J=Y-N,K=[],$=r;$>q;)K[$-q-1]=J/(n[I+$]-N),$--;for(var Q=1,tt=R+1;Q<tt;){for(var et=Q++,it=R-et,rt=q+et,nt=r;nt>=rt;)l[nt]=Ct.add(Ct.mul(K[nt-rt],l[nt]),Ct.mul(1-K[nt-rt],l[nt-1])),nt--;u[it]=l[r]}}for(var st=G,ot=p+1;st<ot;){var at=st++;h[at]=Ct.zeros1d(a);for(var ct=Lt.imin(r,at),lt=Lt.imax(0,at-o),ht=ct+1;lt<ht;){var ut=lt++;h[at]=Ct.add(h[at],Ct.mul(c[at][ut],l[ut]))}}if(Z>1)for(var dt=k-2,pt=k,ft=Y-N,mt=(Y-g[k-1])/ft,gt=1;gt<Z;){for(var vt=gt++,_t=dt,yt=pt,xt=yt-k+1;yt-_t>vt;){if(_t<L){var bt=(Y-g[_t])/(N-g[_t]);m[_t]=Ct.lerp(bt,m[_t],m[_t-1])}if(yt>=G){if(yt-vt<=k-p+Z){var Mt=(Y-g[yt-vt])/ft;h[xt]=Ct.lerp(Mt,h[xt],h[xt+1])}}else h[xt]=Ct.lerp(mt,h[xt],h[xt+1]);_t+=1,yt-=1,xt-=1}dt-=1,pt+=1}if(I!=r)for(var St=0,wt=p-Z;St<wt;)St++,g[k]=N,k+=1;for(var Tt=G,Et=j+1;Tt<Et;){var Pt=Tt++;m[L]=h[Pt],L+=1}if(O<d){for(var At=0;At<R;){var Dt=At++;l[Dt]=u[Dt]}for(var kt=R,Rt=r+1;kt<Rt;){var It=kt++;l[It]=s[O-r+It]}I=O,O+=1,N=Y}else for(var Ot=0,Nt=p+1;Ot<Nt;)g[k+Ot++]=Y}return new X(e,g,m)},Lt.rationalSurfaceTransform=function(t,e){for(var i=Rt.dehomogenize2d(t.controlPoints),r=0,n=i.length;r<n;)for(var s=r++,o=0,a=i[s].length;o<a;){var c=o++,l=i[s][c];l.push(1),i[s][c]=vt.dot(e,l).slice(0,l.length-1)}return new q(t.degreeU,t.degreeV,t.knotsU.slice(),t.knotsV.slice(),Rt.homogenize2d(i,Rt.weight2d(t.controlPoints)))},Lt.rationalCurveTransform=function(t,e){for(var i=Rt.dehomogenize1d(t.controlPoints),r=0,n=i.length;r<n;){var s=r++,o=i[s];o.push(1),i[s]=vt.dot(e,o).slice(0,o.length-1)}return new X(t.degree,t.knots.slice(),Rt.homogenize1d(i,Rt.weight1d(t.controlPoints)))},Lt.surfaceKnotRefine=function(t,e,i){var r,n,s,o=[];i?(s=t.controlPoints,r=t.knotsV,n=t.degreeV):(s=vt.transpose(t.controlPoints),r=t.knotsU,n=t.degreeU);for(var a=null,c=0;c<s.length;){var l=s[c];++c,a=Lt.curveKnotRefine(new X(n,r,l),e),o.push(a.controlPoints)}var h=a.knots;return i?new q(t.degreeU,t.degreeV,t.knotsU.slice(),h,o):(o=vt.transpose(o),new q(t.degreeU,t.degreeV,h,t.knotsV.slice(),o))},Lt.decomposeCurveIntoBeziers=function(t){for(var e=t.degree,i=t.controlPoints,r=t.knots,n=Et.knotMultiplicities(r),s=e+1,o=0;o<n.length;){var a=n[o];if(++o,a.mult<s){var c=Ct.rep(s-a.mult,a.knot),l=Lt.curveKnotRefine(new X(e,r,i),c);r=l.knots,i=l.controlPoints}}r.length;for(var h=2*s,u=[],d=0;d<i.length;){var p=r.slice(d,d+h),f=i.slice(d,d+s);u.push(new X(e,p,f)),d+=s}return u},Lt.curveKnotRefine=function(t,e){if(0==e.length)return Ot.clonedCurve(t);for(var i=t.degree,r=t.controlPoints,n=t.knots,s=r.length-1,o=s+i+1,a=e.length-1,c=Rt.knotSpan(i,e[0],n),l=Rt.knotSpan(i,e[a],n),h=[],u=[],d=0,p=c-i+1;d<p;){var f=d++;h[f]=r[f]}for(var m=l-1,g=s+1;m<g;){var v=m++;h[v+a+1]=r[v]}for(var _=0,y=c+1;_<y;){var x=_++;u[x]=n[x]}for(var b=l+i,M=o+1;b<M;){var S=b++;u[S+a+1]=n[S]}for(var w=l+i-1,T=l+i+a,C=a;C>=0;){for(;e[C]<=n[w]&&w>c;)h[T-i-1]=r[w-i-1],u[T]=n[w],T-=1,w-=1;h[T-i-1]=h[T-i];for(var E=1,P=i+1;E<P;){var A=E++,D=T-i+A,k=u[T+A]-e[C];Math.abs(k)<V.EPSILON?h[D-1]=h[D]:(k/=u[T+A]-n[w-i+A],h[D-1]=Ct.add(Ct.mul(k,h[D-1]),Ct.mul(1-k,h[D])))}u[T]=e[C],T-=1,C--}return new X(i,u,h)},Lt.curveKnotInsert=function(t,e,i){for(var r=t.degree,n=t.controlPoints,s=t.knots,o=n.length,a=Rt.knotSpan(r,e,s),c=[],l=[],h=[],u=1,d=a+1;u<d;){var p=u++;l[p]=s[p]}for(var f=1,m=i+1;f<m;)l[a+f++]=e;for(var g=a+1,v=s.length;g<v;){var _=g++;l[_+i]=s[_]}for(var y=0,x=a-r+1;y<x;){var b=y++;h[b]=n[b]}for(var M=a-0;M<o;){var S=M++;h[S+i]=n[S]}for(var w=0,T=r-0+1;w<T;){var C=w++;c[C]=n[a-r+C]}for(var E=0,P=0,A=1,D=i+1;A<D;){var k=A++;E=a-r+k;for(var R=0,I=r-k-0+1;R<I;){var O=R++;P=(e-s[E+O])/(s[O+a+1]-s[E+O]),c[O]=Ct.add(Ct.mul(P,c[O+1]),Ct.mul(1-P,c[O]))}h[E]=c[0],h[a+i-k-0]=c[r-k-0]}for(var L=E+1,N=a-0;L<N;){var F=L++;h[F]=c[F-E]}return new X(r,l,h)};var Nt=e.eval.Tess=function(){};r["verb.eval.Tess"]=Nt,Nt.__name__=["verb","eval","Tess"],Nt.rationalCurveRegularSample=function(t,e,i){return Nt.rationalCurveRegularSampleRange(t,t.knots[0],W.last(t.knots),e,i)},Nt.rationalCurveRegularSampleRange=function(t,e,i,r,n){r<1&&(r=2);for(var s=[],o=(i-e)/(r-1),a=0,c=0;c<r;)a=e+o*c++,n?s.push([a].concat(Rt.rationalCurvePoint(t,a))):s.push(Rt.rationalCurvePoint(t,a));return s},Nt.rationalCurveAdaptiveSample=function(t,e,i){if(null==i&&(i=!1),null==e&&(e=1e-6),1==t.degree){if(i){for(var r=[],n=0,s=t.controlPoints.length;n<s;){var o=n++;r.push([t.knots[o+1]].concat(Rt.dehomogenize(t.controlPoints[o])))}return r}return t.controlPoints.map(Rt.dehomogenize)}return Nt.rationalCurveAdaptiveSampleRange(t,t.knots[0],W.last(t.knots),e,i)},Nt.rationalCurveAdaptiveSampleRange=function(t,e,i,r,n){var s=Rt.rationalCurvePoint(t,e),o=Rt.rationalCurvePoint(t,i),a=e+(i-e)*(.5+.2*Math.random()),c=Rt.rationalCurvePoint(t,a),l=Ct.sub(s,o),h=Ct.sub(s,c);if(Ct.dot(l,l)<r&&Ct.dot(h,h)>r||!Tt.threePointsAreFlat(s,c,o,r)){var u=e+.5*(i-e),d=Nt.rationalCurveAdaptiveSampleRange(t,e,u,r,n),p=Nt.rationalCurveAdaptiveSampleRange(t,u,i,r,n);return d.slice(0,-1).concat(p)}return n?[[e].concat(s),[i].concat(o)]:[s,o]},Nt.rationalSurfaceNaive=function(t,e,i){e<1&&(e=1),i<1&&(i=1),t.degreeU,t.degreeV,t.controlPoints;for(var r=t.knotsU,n=t.knotsV,s=(W.last(r)-r[0])/e,o=(W.last(n)-n[0])/i,a=[],c=[],l=[],h=0,u=e+1;h<u;)for(var d=h++,p=0,f=i+1;p<f;){var m=d*s,g=p++*o;c.push([m,g]);var v=Rt.rationalSurfaceDerivatives(t,m,g,1),_=v[0][0];a.push(_);var y=Ct.normalized(Ct.cross(v[1][0],v[0][1]));l.push(y)}for(var x=[],b=0;b<e;)for(var M=b++,S=0;S<i;){var w=S++,T=M*(i+1)+w,C=(M+1)*(i+1)+w,E=C+1,P=[T,C,E],A=[T,E,T+1];x.push(P),x.push(A)}return new Y(x,a,l,c)},Nt.divideRationalSurfaceAdaptive=function(t,e){null==e&&(e=new Ft),null!=e.minDivsU?e.minDivsU=e.minDivsU:e.minDivsU=1,null!=e.minDivsV?e.minDivsU=e.minDivsV:e.minDivsU=1,null!=e.refine?e.refine=e.refine:e.refine=!0;var i,r,n=2*(t.controlPoints.length-1),s=2*(t.controlPoints[0].length-1);i=e.minDivsU>n?e.minDivsU=e.minDivsU:e.minDivsU=n,r=e.minDivsV>s?e.minDivsV=e.minDivsV:e.minDivsV=s;for(var o=W.last(t.knotsU),a=t.knotsU[0],c=W.last(t.knotsV),l=t.knotsV[0],h=(o-a)/i,u=(c-l)/r,d=[],p=[],f=0,m=r+1;f<m;){for(var g=f++,v=[],_=0,y=i+1;_<y;){var x=a+h*_++,b=l+u*g,M=Rt.rationalSurfaceDerivatives(t,x,b,1),S=Ct.normalized(Ct.cross(M[0][1],M[1][0]));v.push(new ot(M[0][0],S,[x,b],-1,Ct.isZero(S)))}p.push(v)}for(var w=0;w<r;)for(var T=w++,C=0;C<i;){var E=C++,P=[p[r-T-1][E],p[r-T-1][E+1],p[r-T][E+1],p[r-T][E]];d.push(new Ut(t,P))}if(!e.refine)return d;for(var A=0;A<r;)for(var D=A++,k=0;k<i;){var R=k++,I=D*i+R,O=Nt.north(I,D,R,i,r,d),L=Nt.east(I,D,R,i,r,d),N=Nt.south(I,D,R,i,r,d),F=Nt.west(I,D,R,i,r,d);d[I].neighbors=[N,L,O,F],d[I].divide(e)}return d},Nt.north=function(t,e,i,r,n,s){return 0==e?null:s[t-r]},Nt.south=function(t,e,i,r,n,s){return e==n-1?null:s[t+r]},Nt.east=function(t,e,i,r,n,s){return i==r-1?null:s[t+1]},Nt.west=function(t,e,i,r,n,s){return 0==i?null:s[t-1]},Nt.triangulateAdaptiveRefinementNodeTree=function(t){for(var e=Y.empty(),i=0;i<t.length;){var r=t[i];++i,r.triangulate(e)}return e},Nt.rationalSurfaceAdaptive=function(t,e){null!=e||(e=new Ft);var i=Nt.divideRationalSurfaceAdaptive(t,e);return Nt.triangulateAdaptiveRefinementNodeTree(i)};var Ft=e.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};r["verb.eval.AdaptiveRefinementOptions"]=Ft,Ft.__name__=["verb","eval","AdaptiveRefinementOptions"],Ft.prototype={__class__:Ft};var Ut=e.core.AdaptiveRefinementNode=function(t,e,i){if(this.srf=t,this.neighbors=null==i?[null,null,null,null]:i,this.corners=e,null==this.corners){var r=t.knotsU[0],n=W.last(t.knotsU),s=t.knotsV[0],o=W.last(t.knotsV);this.corners=[ot.fromUv(r,s),ot.fromUv(n,s),ot.fromUv(n,o),ot.fromUv(r,o)]}};r["verb.eval.AdaptiveRefinementNode"]=Ut,Ut.__name__=["verb","eval","AdaptiveRefinementNode"],Ut.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var t=0;t<4;){var e=t++;if(null==this.corners[e].point){var i=this.corners[e];this.evalSrf(i.uv[0],i.uv[1],i)}}},evalSrf:function(t,e,i){var r=Rt.rationalSurfaceDerivatives(this.srf,t,e,1),n=r[0][0],s=Ct.cross(r[0][1],r[1][0]),o=Ct.isZero(s);return o||(s=Ct.normalized(s)),null!=i?(i.degen=o,i.point=n,i.normal=s,i):new ot(n,s,[t,e],-1,o)},getEdgeCorners:function(t){if(this.isLeaf())return[this.corners[t]];if(this.horizontal)switch(t){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(t){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(t){var e=[this.corners[t]];if(null==this.neighbors[t])return e;var i=this.neighbors[t].getEdgeCorners((t+2)%4),r=t%2,n=V.EPSILON,s=this,o=[function(t){return t.uv[0]>s.corners[0].uv[0]+n&&t.uv[0]<s.corners[2].uv[0]-n},function(t){return t.uv[1]>s.corners[0].uv[1]+n&&t.uv[1]<s.corners[2].uv[1]-n}],a=i.filter(o[r]);return a.reverse(),e.concat(a)},midpoint:function(t){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[t])return this.midPoints[t];switch(t){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[t]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var t=this.corners.length,e=0;e<t;){var i=e++;if(this.corners[i],this.corners[i].degen){var r=this.corners[(i+1)%t],n=this.corners[(i+3)%t];r.degen?this.corners[i].normal=n.normal:this.corners[i].normal=r.normal}}},shouldDivide:function(t,e){if(e<t.minDepth)return!0;if(e>=t.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=Ct.normSquared(Ct.sub(this.corners[0].normal,this.corners[1].normal))>t.normTol||Ct.normSquared(Ct.sub(this.corners[2].normal,this.corners[3].normal))>t.normTol,this.splitHoriz=Ct.normSquared(Ct.sub(this.corners[1].normal,this.corners[2].normal))>t.normTol||Ct.normSquared(Ct.sub(this.corners[3].normal,this.corners[0].normal))>t.normTol,this.splitVert||this.splitHoriz)return!0;var i=this.center();return Ct.normSquared(Ct.sub(i.normal,this.corners[0].normal))>t.normTol||Ct.normSquared(Ct.sub(i.normal,this.corners[1].normal))>t.normTol||Ct.normSquared(Ct.sub(i.normal,this.corners[2].normal))>t.normTol||Ct.normSquared(Ct.sub(i.normal,this.corners[3].normal))>t.normTol},divide:function(t){null==t&&(t=new Ft),null==t.normTol&&(t.normTol=.085),null==t.minDepth&&(t.minDepth=0),null==t.maxDepth&&(t.maxDepth=10),this._divide(t,0,!0)},_divide:function(t,e,i){if(this.evalCorners(),this.shouldDivide(t,e)){if(e++,this.splitVert&&!this.splitHoriz?i=!1:!this.splitVert&&this.splitHoriz&&(i=!0),this.horizontal=i,this.horizontal){var r=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],n=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new Ut(this.srf,r),new Ut(this.srf,n)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var s=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],o=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new Ut(this.srf,s),new Ut(this.srf,o)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,c=this.children;a<c.length;){var l=c[a];++a,l._divide(t,e,!i)}}},triangulate:function(t){if(null==t&&(t=Y.empty()),this.isLeaf())return this.triangulateLeaf(t);for(var e=0,i=this.children;e<i.length;){var r=i[e];if(++e,null==r)break;r.triangulate(t)}return t},triangulateLeaf:function(t){for(var e=t.points.length,i=[],r=[],n=0,s=0;s<4;){var o=s++,a=this.getAllCorners(o);2==a.length&&(n=o+1);for(var c=0,l=a.length;c<l;){var h=c++;i.push(a[h])}}for(var u=0;u<i.length;){var d=i[u];++u,-1==d.id?(t.uvs.push(d.uv),t.points.push(d.point),t.normals.push(d.normal),d.id=e,r.push(e),e++):r.push(d.id)}if(4==i.length)return t.faces.push([r[0],r[3],r[1]]),t.faces.push([r[3],r[2],r[1]]),t;if(5==i.length){var p=r.length;return t.faces.push([r[n],r[(n+2)%p],r[(n+1)%p]]),t.faces.push([r[(n+4)%p],r[(n+3)%p],r[n]]),t.faces.push([r[n],r[(n+3)%p],r[(n+2)%p]]),t}var f=this.center();t.uvs.push(f.uv),t.points.push(f.point),t.normals.push(f.normal);for(var m=t.points.length-1,g=0,v=i.length-1;g<i.length;)t.faces.push([m,r[g],r[v]]),v=g++;return t},__class__:Ut};var Wt=e.exe.Dispatcher=function(){};r["verb.exe.Dispatcher"]=Wt,Wt.__name__=["verb","exe","Dispatcher"],Wt.init=function(){Wt._init||(Wt._workerPool=new Bt(Wt.THREADS),Wt._init=!0)},Wt.dispatchMethod=function(t,e,i){Wt.init();var r=new R;return Wt._workerPool.addWork(f.getClassName(t),e,i,(function(t){r.resolve(t)})),new I(r)};var Bt=e.exe.WorkerPool=function(t,e){null==e&&(e="verb.js"),null==t&&(t=1),this._callbacks=new y,this._working=new y,this._pool=[],this._queue=[];for(var i=0;i<t;){var r;i++;try{r=new Worker(Bt.basePath+e)}catch(t){t instanceof C&&(t=t.val),r=new Worker(Bt.basePath+e.substring(0,-3)+".min.js")}this._pool.push(r)}};r["verb.exe.WorkerPool"]=Bt,Bt.__name__=["verb","exe","WorkerPool"],Bt.prototype={addWork:function(t,e,i,r){var n=new zt(t,e,i);this._callbacks.set(n.id,r),this._queue.push(n),this.processQueue()},processQueue:function(){for(var e=this;this._queue.length>0&&this._pool.length>0;){var i=this._queue.shift(),r=[i.id],n=[this._pool.shift()];this._working.h[r[0]]=n[0],n[0].onmessage=function(i,r){return function(n){e._working.remove(r[0]),e._pool.push(i[0]);try{e._callbacks.h.hasOwnProperty(r[0])&&(e._callbacks.h[r[0]](n.data.result),e._callbacks.remove(r[0]))}catch(e){e instanceof C&&(e=e.val),t.log(e)}e.processQueue()}}(n,r),n[0].postMessage(i)}},__class__:Bt};var zt=function(t,e,i){this.className=t,this.methodName=e,this.args=i,this.id=zt.uuid++};r["verb.exe._WorkerPool.Work"]=zt,zt.__name__=["verb","exe","_WorkerPool","Work"],zt.prototype={__class__:zt};var Vt=function(){};r["verb.geom.ICurve"]=Vt,Vt.__name__=["verb","geom","ICurve"],Vt.__interfaces__=[St],Vt.prototype={__class__:Vt};var Ht=e.geom.NurbsCurve=function(t){this._data=At.isValidNurbsCurveData(t)};r["verb.geom.NurbsCurve"]=Ht,Ht.__name__=["verb","geom","NurbsCurve"],Ht.__interfaces__=[Vt],Ht.byKnotsControlPointsWeights=function(t,e,i,r){return new Ht(new X(t,e.slice(),Rt.homogenize1d(i,r)))},Ht.byPoints=function(t,e){return null==e&&(e=3),new Ht(Ot.rationalInterpCurve(t,e))},Ht.__super__=H,Ht.prototype=s(H.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return Rt.dehomogenize1d(this._data.controlPoints)},weights:function(){return Rt.weight1d(this._data.controlPoints)},asNurbs:function(){return new X(this.degree(),this.knots(),Rt.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Ht(this._data)},domain:function(){return new $(W.first(this._data.knots),W.last(this._data.knots))},transform:function(t){return new Ht(Lt.rationalCurveTransform(this._data,t))},transformAsync:function(t){return Wt.dispatchMethod(Lt,"rationalCurveTransform",[this._data,t]).then((function(t){return new Ht(t)}))},point:function(t){return Rt.rationalCurvePoint(this._data,t)},pointAsync:function(t){return Wt.dispatchMethod(Rt,"rationalCurvePoint",[this._data,t])},tangent:function(t){return Rt.rationalCurveTangent(this._data,t)},tangentAsync:function(t){return Wt.dispatchMethod(Rt,"rationalCurveTangent",[this._data,t])},derivatives:function(t,e){return null==e&&(e=1),Rt.rationalCurveDerivatives(this._data,t,e)},derivativesAsync:function(t,e){return null==e&&(e=1),Wt.dispatchMethod(Rt,"rationalCurveDerivatives",[this._data,t,e])},closestPoint:function(t){return Et.rationalCurveClosestPoint(this._data,t)},closestPointAsync:function(t){return Wt.dispatchMethod(Et,"rationalCurveClosestPoint",[this._data,t])},closestParam:function(t){return Et.rationalCurveClosestParam(this._data,t)},closestParamAsync:function(t){return Wt.dispatchMethod(Et,"rationalCurveClosestParam",[this._data,t])},length:function(){return Et.rationalCurveArcLength(this._data)},lengthAsync:function(){return Wt.dispatchMethod(Et,"rationalCurveArcLength",[this._data])},lengthAtParam:function(t){return Et.rationalCurveArcLength(this._data,t)},lengthAtParamAsync:function(){return Wt.dispatchMethod(Et,"rationalCurveArcLength",[this._data])},paramAtLength:function(t,e){return Et.rationalCurveParamAtArcLength(this._data,t,e)},paramAtLengthAsync:function(t,e){return Wt.dispatchMethod(Et,"rationalCurveParamAtArcLength",[this._data,t,e])},divideByEqualArcLength:function(t){return Dt.rationalCurveByEqualArcLength(this._data,t)},divideByEqualArcLengthAsync:function(t){return Wt.dispatchMethod(Dt,"rationalCurveByEqualArcLength",[this._data,t])},divideByArcLength:function(t){return Dt.rationalCurveByArcLength(this._data,t)},divideByArcLengthAsync:function(t){return Wt.dispatchMethod(Dt,"rationalCurveByArcLength",[this._data,t])},split:function(t){return Dt.curveSplit(this._data,t).map((function(t){return new Ht(t)}))},splitAsync:function(t){return Wt.dispatchMethod(Dt,"curveSplit",[this._data,t]).then((function(t){return t.map((function(t){return new Ht(t)}))}))},reverse:function(){return new Ht(Lt.curveReverse(this._data))},reverseAsync:function(){return Wt.dispatchMethod(Lt,"curveReverse",[this._data]).then((function(t){return new Ht(t)}))},tessellate:function(t){return Nt.rationalCurveAdaptiveSample(this._data,t,!1)},tessellateAsync:function(t){return Wt.dispatchMethod(Nt,"rationalCurveAdaptiveSample",[this._data,t,!1])},__class__:Ht});var Gt=e.geom.Arc=function(t,e,i,r,n,s){Ht.call(this,Ot.arc(t,e,i,r,n,s)),this._center=t,this._xaxis=e,this._yaxis=i,this._radius=r,this._minAngle=n,this._maxAngle=s};r["verb.geom.Arc"]=Gt,Gt.__name__=["verb","geom","Arc"],Gt.__super__=Ht,Gt.prototype=s(Ht.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Gt});var jt=e.geom.BezierCurve=function(t,e){Ht.call(this,Ot.rationalBezierCurve(t,e))};r["verb.geom.BezierCurve"]=jt,jt.__name__=["verb","geom","BezierCurve"],jt.__super__=Ht,jt.prototype=s(Ht.prototype,{__class__:jt});var Xt=e.geom.Circle=function(t,e,i,r){Gt.call(this,t,e,i,r,0,2*Math.PI)};r["verb.geom.Circle"]=Xt,Xt.__name__=["verb","geom","Circle"],Xt.__super__=Gt,Xt.prototype=s(Gt.prototype,{__class__:Xt});var qt=function(){};r["verb.geom.ISurface"]=qt,qt.__name__=["verb","geom","ISurface"],qt.__interfaces__=[St],qt.prototype={__class__:qt};var Yt=e.geom.NurbsSurface=function(t){this._data=At.isValidNurbsSurfaceData(t)};r["verb.geom.NurbsSurface"]=Yt,Yt.__name__=["verb","geom","NurbsSurface"],Yt.__interfaces__=[qt],Yt.byKnotsControlPointsWeights=function(t,e,i,r,n,s){return new Yt(new q(t,e,i,r,Rt.homogenize2d(n,s)))},Yt.byCorners=function(t,e,i,r){return new Yt(Ot.fourPointSurface(t,e,i,r))},Yt.byLoftingCurves=function(t,e){return new Yt(Ot.loftedSurface(function(e){for(var i=[],r=0;r<t.length;){var n=t[r];++r,i.push(n.asNurbs())}return i}(),e))},Yt.__super__=H,Yt.prototype=s(H.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return Rt.dehomogenize2d(this._data.controlPoints)},weights:function(){return Rt.weight2d(this._data.controlPoints)},asNurbs:function(){return new q(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),Rt.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Yt(this.asNurbs())},domainU:function(){return new $(W.first(this._data.knotsU),W.last(this._data.knotsU))},domainV:function(){return new $(W.first(this._data.knotsV),W.last(this._data.knotsV))},point:function(t,e){return Rt.rationalSurfacePoint(this._data,t,e)},pointAsync:function(t,e){return Wt.dispatchMethod(Rt,"rationalSurfacePoint",[this._data,t,e])},normal:function(t,e){return Rt.rationalSurfaceNormal(this._data,t,e)},normalAsync:function(t,e){return Wt.dispatchMethod(Rt,"rationalSurfaceNormal",[this._data,t,e])},derivatives:function(t,e,i){return null==i&&(i=1),Rt.rationalSurfaceDerivatives(this._data,t,e,i)},derivativesAsync:function(t,e,i){return null==i&&(i=1),Wt.dispatchMethod(Rt,"rationalSurfaceDerivatives",[this._data,t,e,i])},closestParam:function(t){return Et.rationalSurfaceClosestParam(this._data,t)},closestParamAsync:function(t){return Wt.dispatchMethod(Et,"rationalSurfaceClosestParam",[this._data,t])},closestPoint:function(t){return Et.rationalSurfaceClosestPoint(this._data,t)},closestPointAsync:function(t){return Wt.dispatchMethod(Et,"rationalSurfaceClosestPoint",[this._data,t])},split:function(t,e){return null==e&&(e=!1),Dt.surfaceSplit(this._data,t,e).map((function(t){return new Yt(t)}))},splitAsync:function(t,e){return null==e&&(e=!1),Wt.dispatchMethod(Dt,"surfaceSplit",[this._data,t,e]).then((function(t){return t.map((function(t){return new Yt(t)}))}))},reverse:function(t){return null==t&&(t=!1),new Yt(Lt.surfaceReverse(this._data,t))},reverseAsync:function(t){return null==t&&(t=!1),Wt.dispatchMethod(Lt,"surfaceReverse",[this._data,t]).then((function(t){return new Yt(t)}))},isocurve:function(t,e){return null==e&&(e=!1),new Ht(Ot.surfaceIsocurve(this._data,t,e))},isocurveAsync:function(t,e){return null==e&&(e=!1),Wt.dispatchMethod(Ot,"surfaceIsocurve",[this._data,t,e]).then((function(t){return new Ht(t)}))},boundaries:function(t){return Ot.surfaceBoundaryCurves(this._data).map((function(t){return new Ht(t)}))},boundariesAsync:function(t){return Wt.dispatchMethod(Ot,"surfaceBoundaryCurves",[this._data]).then((function(t){return t.map((function(t){return new Ht(t)}))}))},tessellate:function(t){return Nt.rationalSurfaceAdaptive(this._data,t)},tessellateAsync:function(t){return Wt.dispatchMethod(Nt,"rationalSurfaceAdaptive",[this._data,t])},transform:function(t){return new Yt(Lt.rationalSurfaceTransform(this._data,t))},transformAsync:function(t){return Wt.dispatchMethod(Lt,"rationalSurfaceTransform",[this._data,t]).then((function(t){return new Yt(t)}))},__class__:Yt});var Zt=e.geom.ConicalSurface=function(t,e,i,r,n){Yt.call(this,Ot.conicalSurface(t,e,i,r,n)),this._axis=t,this._xaxis=e,this._base=i,this._height=r,this._radius=n};r["verb.geom.ConicalSurface"]=Zt,Zt.__name__=["verb","geom","ConicalSurface"],Zt.__super__=Yt,Zt.prototype=s(Yt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Zt});var Jt=e.geom.CylindricalSurface=function(t,e,i,r,n){Yt.call(this,Ot.cylindricalSurface(t,e,i,r,n)),this._axis=t,this._xaxis=e,this._base=i,this._height=r,this._radius=n};r["verb.geom.CylindricalSurface"]=Jt,Jt.__name__=["verb","geom","CylindricalSurface"],Jt.__super__=Yt,Jt.prototype=s(Yt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Jt});var Kt=e.geom.EllipseArc=function(t,e,i,r,n){Ht.call(this,Ot.ellipseArc(t,e,i,r,n)),this._center=t,this._xaxis=e,this._yaxis=i,this._minAngle=r,this._maxAngle=n};r["verb.geom.EllipseArc"]=Kt,Kt.__name__=["verb","geom","EllipseArc"],Kt.__super__=Ht,Kt.prototype=s(Ht.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Kt});var $t=e.geom.Ellipse=function(t,e,i){Kt.call(this,t,e,i,0,2*Math.PI)};r["verb.geom.Ellipse"]=$t,$t.__name__=["verb","geom","Ellipse"],$t.__super__=Kt,$t.prototype=s(Kt.prototype,{__class__:$t});var Qt=e.geom.ExtrudedSurface=function(t,e){Yt.call(this,Ot.extrudedSurface(Ct.normalized(e),Ct.norm(e),t.asNurbs())),this._profile=t,this._direction=e};r["verb.geom.ExtrudedSurface"]=Qt,Qt.__name__=["verb","geom","ExtrudedSurface"],Qt.__super__=Yt,Qt.prototype=s(Yt.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:Qt});var te=e.geom.Intersect=function(){};r["verb.geom.Intersect"]=te,te.__name__=["verb","geom","Intersect"],te.curves=function(t,e,i){return null==i&&(i=.001),It.curves(t.asNurbs(),e.asNurbs(),i)},te.curvesAsync=function(t,e,i){return null==i&&(i=.001),Wt.dispatchMethod(It,"curves",[t.asNurbs(),e.asNurbs(),i])},te.curveAndSurface=function(t,e,i){return null==i&&(i=.001),It.curveAndSurface(t.asNurbs(),e.asNurbs(),i)},te.curveAndSurfaceAsync=function(t,e,i){return null==i&&(i=.001),Wt.dispatchMethod(It,"curveAndSurface",[t.asNurbs(),e.asNurbs(),i])},te.surfaces=function(t,e,i){return null==i&&(i=.001),It.surfaces(t.asNurbs(),e.asNurbs(),i).map((function(t){return new Ht(t)}))},te.surfacesAsync=function(t,e,i){return null==i&&(i=.001),Wt.dispatchMethod(It,"surfaces",[t.asNurbs(),e.asNurbs(),i]).then((function(t){return t.map((function(t){return new Ht(t)}))}))};var ee=e.geom.Line=function(t,e){Ht.call(this,Ot.polyline([t,e])),this._start=t,this._end=e};r["verb.geom.Line"]=ee,ee.__name__=["verb","geom","Line"],ee.__super__=Ht,ee.prototype=s(Ht.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:ee});var ie=e.geom.RevolvedSurface=function(t,e,i,r){Yt.call(this,Ot.revolvedSurface(t.asNurbs(),e,i,r)),this._profile=t,this._center=e,this._axis=i,this._angle=r};r["verb.geom.RevolvedSurface"]=ie,ie.__name__=["verb","geom","RevolvedSurface"],ie.__super__=Yt,ie.prototype=s(Yt.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:ie});var re=e.geom.SphericalSurface=function(t,e){Yt.call(this,Ot.sphericalSurface(t,[0,0,1],[1,0,0],e)),this._center=t,this._radius=e};r["verb.geom.SphericalSurface"]=re,re.__name__=["verb","geom","SphericalSurface"],re.__super__=Yt,re.prototype=s(Yt.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:re});var ne=e.geom.SweptSurface=function(t,e){Yt.call(this,Ot.rationalTranslationalSurface(t.asNurbs(),e.asNurbs())),this._profile=t,this._rail=e};function se(t){return t instanceof Array?function(){return o.iter(t)}:"function"==typeof t.iterator?ce(t,t.iterator):t.iterator}r["verb.geom.SweptSurface"]=ne,ne.__name__=["verb","geom","SweptSurface"],ne.__super__=Yt,ne.prototype=s(Yt.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:ne});var oe,ae=0;function ce(t,e){return null==e?null:(null==e.__id__&&(e.__id__=ae++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=t,i.method=e,t.hx__closures__[e.__id__]=i),i);var i}r.Math=Math,String.prototype.__class__=r.String=String,String.__name__=["String"],r.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=r.Date=Date,Date.__name__=["Date"];var le=r.Int={__name__:["Int"]},he=r.Dynamic={__name__:["Dynamic"]},ue=r.Float=Number;ue.__name__=["Float"];var de=r.Bool=Boolean;de.__ename__=["Bool"];var pe=r.Class={__name__:["Class"]},fe={};null==Array.prototype.map&&(Array.prototype.map=function(t){for(var e=[],i=0,r=this.length;i<r;){var n=i++;e[n]=t(this[n])}return e}),null==Array.prototype.filter&&(Array.prototype.filter=function(t){for(var e=[],i=0,r=this.length;i<r;){var n=this[i++];t(n)&&e.push(n)}return e});var me={},ge=i.ArrayBuffer||P;null==ge.prototype.slice&&(ge.prototype.slice=P.sliceImpl),i.DataView;var ve=i.Uint8Array||D._new;!function(t,e){if(!t.setImmediate){var i,r=1,n={},s=!1,o=t.document,a=Object.getPrototypeOf&&Object.getPrototypeOf(t);a=a&&a.setTimeout?a:t,"[object process]"==={}.toString.call(t.process)?i=function(){var t=d(arguments);return process.nextTick(p(f,t)),t}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(h="setImmediate$"+Math.random()+"$",u=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(h)&&f(+e.data.slice(h.length))},t.addEventListener?t.addEventListener("message",u,!1):t.attachEvent("onmessage",u),i=function(){var e=d(arguments);return t.postMessage(h+e,"*"),e}):t.MessageChannel?((l=new MessageChannel).port1.onmessage=function(t){f(t.data)},i=function(){var t=d(arguments);return l.port2.postMessage(t),t}):o&&"onreadystatechange"in o.createElement("script")?(c=o.documentElement,i=function(){var t=d(arguments),e=o.createElement("script");return e.onreadystatechange=function(){f(t),e.onreadystatechange=null,c.removeChild(e),e=null},c.appendChild(e),t}):i=function(){var t=d(arguments);return setTimeout(p(f,t),0),t},a.setImmediate=i,a.clearImmediate=m}var c,l,h,u;function d(t){return n[r]=p.apply(e,t),r++}function p(t){var i=[].slice.call(arguments,1);return function(){"function"==typeof t?t.apply(e,i):new Function(""+t)()}}function f(t){if(s)setTimeout(p(f,t),0);else{var e=n[t];if(e){s=!0;try{e()}finally{m(t),s=!1}}}}function m(t){delete n[t]}}(new Function("return this")()),v.USE_CACHE=!1,v.USE_ENUM_INDEX=!1,v.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_.DEFAULT_RESOLVER=f,_.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",x.count=0,T.i64tmp=new g(0,0),E.__toStr={}.toString,D.BYTES_PER_ELEMENT=1,N.queue=new c,B.memo=new y,V.TOLERANCE=1e-6,V.EPSILON=1e-10,V.VERSION="2.0.0",Et.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],Et.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Wt.THREADS=1,Wt._init=!1,Bt.basePath="",zt.uuid=0,U.main()}("undefined"!=typeof console?console:{log:function(){}},t,void 0!==n?n:void 0!==e?e:"undefined"!=typeof self?self:this),t}()}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={exports:{}};return n[t](i,i.exports,o),i.exports}o.m=n,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"==typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"==typeof i.then)return i}var n=Object.create(null);o.r(n);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>i[t]));return s.default=()=>i,o.d(n,s),n},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,i)=>(o.f[i](t,e),e)),[])),o.u=t=>t+".bitbybit-runner-threejs.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},r="bitbybitRunner:",o.l=(t,e,n,s)=>{if(i[t])i[t].push(e);else{var a,c;if(void 0!==n)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var u=l[h];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==r+n){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+n),a.src=t),i[t]=[e];var d=(e,r)=>{a.onerror=a.onload=null,clearTimeout(p);var n=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((t=>t(r))),e)return e(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=i[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={792:0};o.f.j=(e,i)=>{var r=o.o(t,e)?t[e]:void 0;if(0!==r)if(r)i.push(r[2]);else{var n=new Promise(((i,n)=>r=t[e]=[i,n]));i.push(r[2]=n);var s=o.p+o.u(e),a=new Error;o.l(s,(i=>{if(o.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var n=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+n+": "+s+")",a.name="ChunkLoadError",a.type=n,a.request=s,r[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var r,n,[s,a,c]=i,l=0;if(s.some((e=>0!==t[e]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);c&&c(o)}for(e&&e(i);l<s.length;l++)n=s[l],o.o(t,n)&&t[n]&&t[n][0](),t[n]=0},i=this.webpackChunkbitbybitRunner=this.webpackChunkbitbybitRunner||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a={};return(()=>{"use strict";o.r(a),o.d(a,{Runner:()=>Hw,fontsEnum:()=>Nw,getRunnerInstance:()=>Vw});var t={};o.r(t),o.d(t,{ACESFilmicToneMapping:()=>Yt,AddEquation:()=>pt,AddOperation:()=>Ht,AdditiveAnimationBlendMode:()=>Li,AdditiveBlending:()=>lt,AgXToneMapping:()=>Jt,AlphaFormat:()=>Re,AlwaysCompare:()=>Mr,AlwaysDepth:()=>Ot,AlwaysStencilFunc:()=>fr,AmbientLight:()=>ju,AnimationAction:()=>Nd,AnimationClip:()=>gu,AnimationLoader:()=>Tu,AnimationMixer:()=>Ud,AnimationObjectGroup:()=>Ld,AnimationUtils:()=>ru,ArcCurve:()=>Al,ArrayCamera:()=>dd,ArrowHelper:()=>Wp,AttachedBindMode:()=>$t,Audio:()=>xd,AudioAnalyser:()=>Cd,AudioContext:()=>od,AudioListener:()=>yd,AudioLoader:()=>ad,AxesHelper:()=>Bp,BackSide:()=>st,BasicDepthPacking:()=>Wi,BasicShadowMap:()=>tt,BatchedMesh:()=>Uc,Bone:()=>Za,BooleanKeyframeTrack:()=>lu,Box2:()=>ep,Box3:()=>Bn,Box3Helper:()=>Op,BoxGeometry:()=>Jo,BoxHelper:()=>Ip,BufferAttribute:()=>yo,BufferGeometry:()=>No,BufferGeometryLoader:()=>$u,ByteType:()=>xe,Cache:()=>_u,Camera:()=>ia,CameraHelper:()=>Dp,CanvasTexture:()=>dl,CapsuleGeometry:()=>gl,CatmullRomCurve3:()=>Ll,CineonToneMapping:()=>qt,CircleGeometry:()=>vl,ClampToEdgeWrapping:()=>ae,Clock:()=>pd,Color:()=>so,ColorKeyframeTrack:()=>hu,ColorManagement:()=>Mn,CompressedArrayTexture:()=>hl,CompressedCubeTexture:()=>ul,CompressedTexture:()=>ll,CompressedTextureLoader:()=>Cu,ConeGeometry:()=>yl,ConstantAlphaFactor:()=>kt,ConstantColorFactor:()=>At,Controls:()=>Vp,CubeCamera:()=>ca,CubeDepthTexture:()=>fl,CubeReflectionMapping:()=>ee,CubeRefractionMapping:()=>ie,CubeTexture:()=>la,CubeTextureLoader:()=>Au,CubeUVReflectionMapping:()=>se,CubicBezierCurve:()=>Wl,CubicBezierCurve3:()=>Bl,CubicInterpolant:()=>su,CullFaceBack:()=>K,CullFaceFront:()=>$,CullFaceFrontBack:()=>Q,CullFaceNone:()=>J,Curve:()=>El,CurvePath:()=>ql,CustomBlending:()=>dt,CustomToneMapping:()=>Zt,CylinderGeometry:()=>_l,Cylindrical:()=>$d,Data3DTexture:()=>Un,DataArrayTexture:()=>Nn,DataTexture:()=>Ja,DataTextureLoader:()=>Du,DataUtils:()=>mo,DecrementStencilOp:()=>rr,DecrementWrapStencilOp:()=>sr,DefaultLoadingManager:()=>xu,DepthFormat:()=>Le,DepthStencilFormat:()=>Ne,DepthTexture:()=>pl,DetachedBindMode:()=>Qt,DirectionalLight:()=>Gu,DirectionalLightHelper:()=>Ep,DiscreteInterpolant:()=>au,DodecahedronGeometry:()=>bl,DoubleSide:()=>ot,DstAlphaFactor:()=>wt,DstColorFactor:()=>Ct,DynamicCopyUsage:()=>Dr,DynamicDrawUsage:()=>wr,DynamicReadUsage:()=>Er,EdgesGeometry:()=>Cl,EllipseCurve:()=>Pl,EqualCompare:()=>vr,EqualDepth:()=>Ft,EqualStencilFunc:()=>lr,EquirectangularReflectionMapping:()=>re,EquirectangularRefractionMapping:()=>ne,Euler:()=>Ss,EventDispatcher:()=>Qr,ExternalTexture:()=>ml,ExtrudeGeometry:()=>Th,FileLoader:()=>wu,Float16BufferAttribute:()=>Eo,Float32BufferAttribute:()=>Po,FloatType:()=>Te,Fog:()=>ma,FogExp2:()=>fa,FramebufferTexture:()=>cl,FrontSide:()=>nt,Frustum:()=>gc,FrustumArray:()=>yc,GLBufferAttribute:()=>Gd,GLSL1:()=>Rr,GLSL3:()=>Ir,GreaterCompare:()=>yr,GreaterDepth:()=>Wt,GreaterEqualCompare:()=>br,GreaterEqualDepth:()=>Ut,GreaterEqualStencilFunc:()=>pr,GreaterStencilFunc:()=>ur,GridHelper:()=>Mp,Group:()=>ua,HalfFloatType:()=>Ce,HemisphereLight:()=>Iu,HemisphereLightHelper:()=>bp,IcosahedronGeometry:()=>Eh,ImageBitmapLoader:()=>nd,ImageLoader:()=>Pu,ImageUtils:()=>Cn,IncrementStencilOp:()=>ir,IncrementWrapStencilOp:()=>nr,InstancedBufferAttribute:()=>tc,InstancedBufferGeometry:()=>Ku,InstancedInterleavedBuffer:()=>Hd,InstancedMesh:()=>cc,Int16BufferAttribute:()=>So,Int32BufferAttribute:()=>To,Int8BufferAttribute:()=>xo,IntType:()=>Se,InterleavedBuffer:()=>va,InterleavedBufferAttribute:()=>ya,Interpolant:()=>nu,InterpolateDiscrete:()=>Pi,InterpolateLinear:()=>Ai,InterpolateSmooth:()=>Di,InterpolationSamplingMode:()=>Ur,InterpolationSamplingType:()=>Fr,InvertStencilOp:()=>or,KeepStencilOp:()=>tr,KeyframeTrack:()=>cu,LOD:()=>Ua,LatheGeometry:()=>Ph,Layers:()=>ws,LessCompare:()=>gr,LessDepth:()=>Lt,LessEqualCompare:()=>_r,LessEqualDepth:()=>Nt,LessEqualStencilFunc:()=>hr,LessStencilFunc:()=>cr,Light:()=>Ru,LightProbe:()=>Yu,Line:()=>qc,Line3:()=>lp,LineBasicMaterial:()=>Wc,LineCurve:()=>zl,LineCurve3:()=>Vl,LineDashedMaterial:()=>$h,LineLoop:()=>$c,LineSegments:()=>Kc,LinearFilter:()=>fe,LinearInterpolant:()=>ou,LinearMipMapLinearFilter:()=>_e,LinearMipMapNearestFilter:()=>ge,LinearMipmapLinearFilter:()=>ve,LinearMipmapNearestFilter:()=>me,LinearSRGBColorSpace:()=>qi,LinearToneMapping:()=>jt,LinearTransfer:()=>Yi,Loader:()=>bu,LoaderUtils:()=>Ju,LoadingManager:()=>yu,LoopOnce:()=>Ti,LoopPingPong:()=>Ei,LoopRepeat:()=>Ci,MOUSE:()=>Y,Material:()=>co,MaterialLoader:()=>Zu,MathUtils:()=>un,Matrix2:()=>Qd,Matrix3:()=>vn,Matrix4:()=>ps,MaxEquation:()=>vt,Mesh:()=>Yo,MeshBasicMaterial:()=>lo,MeshDepthMaterial:()=>Zh,MeshDistanceMaterial:()=>Jh,MeshLambertMaterial:()=>Yh,MeshMatcapMaterial:()=>Kh,MeshNormalMaterial:()=>qh,MeshPhongMaterial:()=>jh,MeshPhysicalMaterial:()=>Gh,MeshStandardMaterial:()=>Hh,MeshToonMaterial:()=>Xh,MinEquation:()=>gt,MirroredRepeatWrapping:()=>ce,MixOperation:()=>Vt,MultiplyBlending:()=>ut,MultiplyOperation:()=>zt,NearestFilter:()=>le,NearestMipMapLinearFilter:()=>pe,NearestMipMapNearestFilter:()=>ue,NearestMipmapLinearFilter:()=>de,NearestMipmapNearestFilter:()=>he,NeutralToneMapping:()=>Kt,NeverCompare:()=>mr,NeverDepth:()=>It,NeverStencilFunc:()=>ar,NoBlending:()=>at,NoColorSpace:()=>ji,NoNormalPacking:()=>Ji,NoToneMapping:()=>Gt,NormalAnimationBlendMode:()=>Oi,NormalBlending:()=>ct,NormalGAPacking:()=>$i,NormalRGPacking:()=>Ki,NotEqualCompare:()=>xr,NotEqualDepth:()=>Bt,NotEqualStencilFunc:()=>dr,NumberKeyframeTrack:()=>uu,Object3D:()=>Bs,ObjectLoader:()=>Qu,ObjectSpaceNormalMap:()=>Gi,OctahedronGeometry:()=>Ah,OneFactor:()=>yt,OneMinusConstantAlphaFactor:()=>Rt,OneMinusConstantColorFactor:()=>Dt,OneMinusDstAlphaFactor:()=>Tt,OneMinusDstColorFactor:()=>Et,OneMinusSrcAlphaFactor:()=>St,OneMinusSrcColorFactor:()=>bt,OrthographicCamera:()=>Vu,PCFShadowMap:()=>et,PCFSoftShadowMap:()=>it,PMREMGenerator:()=>ff,Path:()=>Yl,PerspectiveCamera:()=>oa,Plane:()=>dc,PlaneGeometry:()=>Dh,PlaneHelper:()=>Lp,PointLight:()=>zu,PointLightHelper:()=>vp,Points:()=>nl,PointsMaterial:()=>Qc,PolarGridHelper:()=>Sp,PolyhedronGeometry:()=>xl,PositionalAudio:()=>Td,PropertyBinding:()=>Od,PropertyMixer:()=>Ed,QuadraticBezierCurve:()=>Hl,QuadraticBezierCurve3:()=>Gl,Quaternion:()=>pn,QuaternionKeyframeTrack:()=>pu,QuaternionLinearInterpolant:()=>du,R11_EAC_Format:()=>ti,RED_GREEN_RGTC2_Format:()=>Si,RED_RGTC1_Format:()=>bi,REVISION:()=>q,RG11_EAC_Format:()=>ii,RGBADepthPacking:()=>Bi,RGBAFormat:()=>Oe,RGBAIntegerFormat:()=>Ve,RGBA_ASTC_10x10_Format:()=>mi,RGBA_ASTC_10x5_Format:()=>di,RGBA_ASTC_10x6_Format:()=>pi,RGBA_ASTC_10x8_Format:()=>fi,RGBA_ASTC_12x10_Format:()=>gi,RGBA_ASTC_12x12_Format:()=>vi,RGBA_ASTC_4x4_Format:()=>ni,RGBA_ASTC_5x4_Format:()=>si,RGBA_ASTC_5x5_Format:()=>oi,RGBA_ASTC_6x5_Format:()=>ai,RGBA_ASTC_6x6_Format:()=>ci,RGBA_ASTC_8x5_Format:()=>li,RGBA_ASTC_8x6_Format:()=>hi,RGBA_ASTC_8x8_Format:()=>ui,RGBA_BPTC_Format:()=>_i,RGBA_ETC2_EAC_Format:()=>Qe,RGBA_PVRTC_2BPPV1_Format:()=>Je,RGBA_PVRTC_4BPPV1_Format:()=>Ze,RGBA_S3TC_DXT1_Format:()=>Ge,RGBA_S3TC_DXT3_Format:()=>je,RGBA_S3TC_DXT5_Format:()=>Xe,RGBDepthPacking:()=>zi,RGBFormat:()=>Ie,RGBIntegerFormat:()=>ze,RGB_BPTC_SIGNED_Format:()=>yi,RGB_BPTC_UNSIGNED_Format:()=>xi,RGB_ETC1_Format:()=>Ke,RGB_ETC2_Format:()=>$e,RGB_PVRTC_2BPPV1_Format:()=>Ye,RGB_PVRTC_4BPPV1_Format:()=>qe,RGB_S3TC_DXT1_Format:()=>He,RGDepthPacking:()=>Vi,RGFormat:()=>We,RGIntegerFormat:()=>Be,RawShaderMaterial:()=>Vh,Ray:()=>ds,Raycaster:()=>Xd,RectAreaLight:()=>Xu,RedFormat:()=>Fe,RedIntegerFormat:()=>Ue,ReinhardToneMapping:()=>Xt,RenderTarget:()=>On,RenderTarget3D:()=>Wd,RepeatWrapping:()=>oe,ReplaceStencilOp:()=>er,ReverseSubtractEquation:()=>mt,RingGeometry:()=>kh,SIGNED_R11_EAC_Format:()=>ei,SIGNED_RED_GREEN_RGTC2_Format:()=>wi,SIGNED_RED_RGTC1_Format:()=>Mi,SIGNED_RG11_EAC_Format:()=>ri,SRGBColorSpace:()=>Xi,SRGBTransfer:()=>Zi,Scene:()=>ga,ShaderChunk:()=>qp,ShaderLib:()=>Zp,ShaderMaterial:()=>ea,ShadowMaterial:()=>zh,Shape:()=>Zl,ShapeGeometry:()=>Rh,ShapePath:()=>zp,ShapeUtils:()=>Mh,ShortType:()=>be,Skeleton:()=>Qa,SkeletonHelper:()=>mp,SkinnedMesh:()=>Ya,Source:()=>Pn,Sphere:()=>ns,SphereGeometry:()=>Ih,Spherical:()=>Kd,SphericalHarmonics3:()=>qu,SplineCurve:()=>jl,SpotLight:()=>Wu,SpotLightHelper:()=>up,Sprite:()=>Oa,SpriteMaterial:()=>xa,SrcAlphaFactor:()=>Mt,SrcAlphaSaturateFactor:()=>Pt,SrcColorFactor:()=>xt,StaticCopyUsage:()=>Ar,StaticDrawUsage:()=>Sr,StaticReadUsage:()=>Cr,StereoCamera:()=>ud,StreamCopyUsage:()=>kr,StreamDrawUsage:()=>Tr,StreamReadUsage:()=>Pr,StringKeyframeTrack:()=>fu,SubtractEquation:()=>ft,SubtractiveBlending:()=>ht,TOUCH:()=>Z,TangentSpaceNormalMap:()=>Hi,TetrahedronGeometry:()=>Oh,Texture:()=>Rn,TextureLoader:()=>ku,TextureUtils:()=>Gp,Timer:()=>Zd,TimestampQuery:()=>Nr,TorusGeometry:()=>Lh,TorusKnotGeometry:()=>Nh,Triangle:()=>to,TriangleFanDrawMode:()=>Ui,TriangleStripDrawMode:()=>Fi,TrianglesDrawMode:()=>Ni,TubeGeometry:()=>Fh,UVMapping:()=>te,Uint16BufferAttribute:()=>wo,Uint32BufferAttribute:()=>Co,Uint8BufferAttribute:()=>bo,Uint8ClampedBufferAttribute:()=>Mo,Uniform:()=>Bd,UniformsGroup:()=>Vd,UniformsLib:()=>Yp,UniformsUtils:()=>ta,UnsignedByteType:()=>ye,UnsignedInt101111Type:()=>ke,UnsignedInt248Type:()=>Ae,UnsignedInt5999Type:()=>De,UnsignedIntType:()=>we,UnsignedShort4444Type:()=>Ee,UnsignedShort5551Type:()=>Pe,UnsignedShortType:()=>Me,VSMShadowMap:()=>rt,Vector2:()=>dn,Vector3:()=>fn,Vector4:()=>In,VectorKeyframeTrack:()=>mu,VideoFrameTexture:()=>al,VideoTexture:()=>ol,WebGL3DRenderTarget:()=>Wn,WebGLArrayRenderTarget:()=>Fn,WebGLCoordinateSystem:()=>Or,WebGLCubeRenderTarget:()=>ha,WebGLRenderTarget:()=>Ln,WebGLRenderer:()=>Fg,WebGLUtils:()=>Pg,WebGPUCoordinateSystem:()=>Lr,WebXRController:()=>pa,WireframeGeometry:()=>Uh,WrapAroundEnding:()=>Ii,ZeroCurvatureEnding:()=>ki,ZeroFactor:()=>_t,ZeroSlopeEnding:()=>Ri,ZeroStencilOp:()=>Qi,createCanvasElement:()=>Gr,error:()=>Kr,getConsoleFunction:()=>Yr,log:()=>Zr,setConsoleFunction:()=>qr,warn:()=>Jr,warnOnce:()=>$r});var e={};o.r(e),o.d(e,{LodDto:()=>sb,lodEnum:()=>Kx});var i={};o.r(i),o.d(i,{Part:()=>ob});var r={};o.r(r),o.d(r,{SerenitySwirlData:()=>cb,SerenitySwirlDto:()=>ab});var n={};o.r(n),o.d(n,{ArabicArchwayData:()=>ub,ArabicArchwayDrawingPart:()=>db,ArabicArchwayDrawingPartShapes:()=>pb,ArabicArchwayDto:()=>hb,ArabicArchwayDtoBase:()=>lb});var s={};o.r(s),o.d(s,{ArabicArchway:()=>n,SerenitySwirl:()=>r});var c={};o.r(c),o.d(c,{EternalLoveData:()=>gb,EternalLoveDto:()=>mb,EternalLoveDtoBase:()=>fb});var l={};o.r(l),o.d(l,{EternalLove:()=>c});var h={};o.r(h),o.d(h,{CalmCupData:()=>yb,CalmCupDto:()=>_b,CalmCupDtoBase:()=>vb});var u={};o.r(u),o.d(u,{DragonCupData:()=>Mb,DragonCupDto:()=>bb,DragonCupDtoBase:()=>xb,DragonCupModelDto:()=>Sb});var d={};o.r(d),o.d(d,{CalmCup:()=>h,DragonCup:()=>u});var p={};o.r(p),o.d(p,{PhoneNestData:()=>Cb,PhoneNestDrawDto:()=>kb,PhoneNestDrawingPart:()=>Eb,PhoneNestDrawingPartShapes:()=>Pb,PhoneNestDto:()=>Tb,PhoneNestDtoBase:()=>wb,PhoneNestMainPart:()=>Ab,PhoneNestModelDto:()=>Db});var f={};o.r(f),o.d(f,{PhoneNest:()=>p});var m={};o.r(m),o.d(m,{SpicyBoxData:()=>Ob,SpicyBoxDto:()=>Ib,SpicyBoxDtoBase:()=>Rb,SpicyBoxModelDto:()=>Lb});var g={};o.r(g),o.d(g,{SpicyBox:()=>m});var v={};o.r(v),o.d(v,{Boxes:()=>g,Cups:()=>d,Desktop:()=>f,Medals:()=>l,Vases:()=>s});var _={};o.r(_),o.d(_,{DropletsPhoneHolderData:()=>zb,DropletsPhoneHolderDrawingPart:()=>Vb,DropletsPhoneHolderDrawingPartShapes:()=>Hb,DropletsPhoneHolderDto:()=>Fb,DropletsPhoneHolderDtoBase:()=>Nb,DropletsPhoneHolderModelDto:()=>Ub,DropletsPhoneHolderModelDxfDto:()=>Wb,DropletsPhoneHolderModelStepDto:()=>Bb});var y={};o.r(y),o.d(y,{DropletsPhoneHolder:()=>_});var x={};o.r(x),o.d(x,{Gadgets:()=>y});var b={};o.r(b),o.d(b,{ZenHideoutData:()=>Xb,ZenHideoutDrawingPart:()=>qb,ZenHideoutDrawingPartShapes:()=>Yb,ZenHideoutDto:()=>jb,ZenHideoutDtoBase:()=>Gb});var M={};o.r(M),o.d(M,{ZenHideout:()=>b});var S={};o.r(S),o.d(S,{BeamPart:()=>sM,CeilingPart:()=>fM,ColumnPart:()=>nM,CornerEntranceDto:()=>gM,CornerEntrancePart:()=>uM,CornerPart:()=>rM,CornerStairDto:()=>lM,CornerStairPart:()=>hM,FloorPart:()=>mM,Houses:()=>M,RoofBeamsPart:()=>aM,RoofCoverOneSidedDto:()=>dM,RoofCoverPart:()=>pM,RoofPanelPart:()=>cM,RoofPart:()=>oM,SandwitchPanelDto:()=>Qb,SandwitchPanelFlexDto:()=>tM,SandwitchPart:()=>eM,SandwitchPartFlex:()=>iM,WindowCornerDto:()=>Zb,WindowCornerPart:()=>$b,WindowRectangularDto:()=>Jb,WindowRectangularPart:()=>Kb});var w={};o.r(w),o.d(w,{WingtipVillaData:()=>_M,WingtipVillaDto:()=>vM});var T={};o.r(T),o.d(T,{ChirpyChaletData:()=>xM,ChirpyChaletDto:()=>yM});var C={};o.r(C),o.d(C,{ChirpyChalet:()=>T,WingtipVilla:()=>w});var E={};o.r(E),o.d(E,{BirdHouses:()=>C});var P={};o.r(P),o.d(P,{SnakeChairData:()=>SM,SnakeChairDrawDto:()=>PM,SnakeChairDrawingPart:()=>wM,SnakeChairDrawingPartShapes:()=>TM,SnakeChairDto:()=>MM,SnakeChairDtoBase:()=>bM,SnakeChairMainPart:()=>CM,SnakeChairModelDto:()=>EM});var A={};o.r(A),o.d(A,{SnakeChair:()=>P});var D={};o.r(D),o.d(D,{ElegantTableData:()=>kM,ElegantTableDrawDto:()=>UM,ElegantTableDrawingPart:()=>RM,ElegantTableDrawingPartShapes:()=>IM,ElegantTableDto:()=>DM,ElegantTableDtoBase:()=>AM,ElegantTableLegByIndexDto:()=>NM,ElegantTableLegPart:()=>OM,ElegantTableModelDto:()=>FM,ElegantTableTopPart:()=>LM});var k={};o.r(k),o.d(k,{GoodCoffeeTableData:()=>zM,GoodCoffeeTableDrawDto:()=>ZM,GoodCoffeeTableDrawingPart:()=>VM,GoodCoffeeTableDrawingPartShapes:()=>HM,GoodCoffeeTableDto:()=>BM,GoodCoffeeTableDtoBase:()=>WM,GoodCoffeeTableLegByIndexDto:()=>qM,GoodCoffeeTableLegPart:()=>GM,GoodCoffeeTableModelDto:()=>YM,GoodCoffeeTableShelfPart:()=>jM,GoodCoffeeTableTopPart:()=>XM});var R={};o.r(R),o.d(R,{SnakeTableData:()=>$M,SnakeTableDrawDto:()=>rS,SnakeTableDrawingPart:()=>QM,SnakeTableDrawingPartShapes:()=>tS,SnakeTableDto:()=>KM,SnakeTableDtoBase:()=>JM,SnakeTableMainPart:()=>eS,SnakeTableModelDto:()=>iS});var I={};o.r(I),o.d(I,{ElegantTable:()=>D,GoodCoffeeTable:()=>k,SnakeTable:()=>R});var O={};o.r(O),o.d(O,{Chairs:()=>A,Tables:()=>I});var L={};o.r(L),o.d(L,{Architecture:()=>S,Enums:()=>e,Furniture:()=>O,KidsCorner:()=>E,LaserCutting:()=>x,Shared:()=>i,ThreeDPrinting:()=>v});var N={};o.r(N),o.d(N,{FontDefinition:()=>pS,Text3DData:()=>uS,Text3DDto:()=>sS,Text3DFaceDefinitionDto:()=>mS,Text3DFaceDefinitionUrlDto:()=>gS,Text3DFaceDefinitionUrlParsedDto:()=>vS,Text3DFaceDto:()=>cS,Text3DFaceUrlDto:()=>lS,Text3DFaceUrlParsedDto:()=>hS,Text3DLetterByIndexDto:()=>dS,Text3DModelDto:()=>fS,Text3DUrlDto:()=>oS,Text3DUrlParsedDto:()=>aS,Texts3DFaceDto:()=>_S,Texts3DFaceUrlDto:()=>yS,Texts3DFaceUrlParsedDto:()=>xS,faceTextVarEnum:()=>tb,faceTypeEnum:()=>eb,fontVariantsEnum:()=>Qx,fontsEnum:()=>$x,fontsModel:()=>nS,recAlignmentEnum:()=>ib});var F={};o.r(F),o.d(F,{PyramidSimpeByIndexDto:()=>wS,PyramidSimpleAffectorsDto:()=>MS,PyramidSimpleCellPart:()=>IS,PyramidSimpleData:()=>SS,PyramidSimpleDto:()=>bS,PyramidSimpleFacePart:()=>OS,PyramidSimpleModelCellDto:()=>PS,PyramidSimpleModelCellsDto:()=>CS,PyramidSimpleModelCellsIndexDto:()=>ES,PyramidSimpleModelDto:()=>TS,PyramidSimpleModelFaceCellIndexDto:()=>DS,PyramidSimpleModelFaceCellsUIndexDto:()=>kS,PyramidSimpleModelFaceCellsVIndexDto:()=>RS,PyramidSimpleModelFaceIndexDto:()=>AS});var U={};o.r(U),o.d(U,{PyramidSimple:()=>F});var W={};o.r(W),o.d(W,{FacePatterns:()=>U});var B={};o.r(B),o.d(B,{outputShapeEnum:()=>LS});var z={};o.r(z),o.d(z,{Enums:()=>B,Patterns:()=>W,Text3D:()=>N});var V={};o.r(V),o.d(V,{VectorCharData:()=>jS,VectorTextData:()=>XS});var H={};o.r(H),o.d(H,{HexGridData:()=>qS});var G={};o.r(G),o.d(G,{ObjectDefinition:()=>ZS,ShapeWithId:()=>YS,TextWiresCharShapePart:()=>KS,TextWiresDataDto:()=>JS});var j={};o.r(j),o.d(j,{OCCT:()=>G,Point:()=>H,Text:()=>V,renderableModels:()=>WS});var X={};o.r(X),o.d(X,{Asset:()=>k_,Base:()=>yx,CSV:()=>R_,Color:()=>Gv,Dates:()=>Qv,Draw:()=>xx,IO:()=>r_,JSCAD:()=>U_,JSON:()=>I_,Line:()=>t_,Lists:()=>jv,Logic:()=>Xv,Manifold:()=>W_,Math:()=>qv,Mesh:()=>i_,OCCT:()=>D_,Point:()=>Yv,Polyline:()=>e_,Tag:()=>O_,Text:()=>Zv,ThreeJSCamera:()=>bx,ThreeJSScene:()=>Mx,Time:()=>L_,Transforms:()=>Kv,Vector:()=>Jv,Verb:()=>N_});const q="182",Y={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Z={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},J=0,K=1,$=2,Q=3,tt=0,et=1,it=2,rt=3,nt=0,st=1,ot=2,at=0,ct=1,lt=2,ht=3,ut=4,dt=5,pt=100,ft=101,mt=102,gt=103,vt=104,_t=200,yt=201,xt=202,bt=203,Mt=204,St=205,wt=206,Tt=207,Ct=208,Et=209,Pt=210,At=211,Dt=212,kt=213,Rt=214,It=0,Ot=1,Lt=2,Nt=3,Ft=4,Ut=5,Wt=6,Bt=7,zt=0,Vt=1,Ht=2,Gt=0,jt=1,Xt=2,qt=3,Yt=4,Zt=5,Jt=6,Kt=7,$t="attached",Qt="detached",te=300,ee=301,ie=302,re=303,ne=304,se=306,oe=1e3,ae=1001,ce=1002,le=1003,he=1004,ue=1004,de=1005,pe=1005,fe=1006,me=1007,ge=1007,ve=1008,_e=1008,ye=1009,xe=1010,be=1011,Me=1012,Se=1013,we=1014,Te=1015,Ce=1016,Ee=1017,Pe=1018,Ae=1020,De=35902,ke=35899,Re=1021,Ie=1022,Oe=1023,Le=1026,Ne=1027,Fe=1028,Ue=1029,We=1030,Be=1031,ze=1032,Ve=1033,He=33776,Ge=33777,je=33778,Xe=33779,qe=35840,Ye=35841,Ze=35842,Je=35843,Ke=36196,$e=37492,Qe=37496,ti=37488,ei=37489,ii=37490,ri=37491,ni=37808,si=37809,oi=37810,ai=37811,ci=37812,li=37813,hi=37814,ui=37815,di=37816,pi=37817,fi=37818,mi=37819,gi=37820,vi=37821,_i=36492,yi=36494,xi=36495,bi=36283,Mi=36284,Si=36285,wi=36286,Ti=2200,Ci=2201,Ei=2202,Pi=2300,Ai=2301,Di=2302,ki=2400,Ri=2401,Ii=2402,Oi=2500,Li=2501,Ni=0,Fi=1,Ui=2,Wi=3200,Bi=3201,zi=3202,Vi=3203,Hi=0,Gi=1,ji="",Xi="srgb",qi="srgb-linear",Yi="linear",Zi="srgb",Ji="",Ki="rg",$i="ga",Qi=0,tr=7680,er=7681,ir=7682,rr=7683,nr=34055,sr=34056,or=5386,ar=512,cr=513,lr=514,hr=515,ur=516,dr=517,pr=518,fr=519,mr=512,gr=513,vr=514,_r=515,yr=516,xr=517,br=518,Mr=519,Sr=35044,wr=35048,Tr=35040,Cr=35045,Er=35049,Pr=35041,Ar=35046,Dr=35050,kr=35042,Rr="100",Ir="300 es",Or=2e3,Lr=2001,Nr={COMPUTE:"compute",RENDER:"render"},Fr={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Ur={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function Wr(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const Br={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function zr(t,e){return new Br[t](e)}function Vr(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hr(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Gr(){const t=Hr("canvas");return t.style.display="block",t}const jr={};let Xr=null;function qr(t){Xr=t}function Yr(){return Xr}function Zr(...t){const e="THREE."+t.shift();Xr?Xr("log",e,...t):console.log(e,...t)}function Jr(...t){const e="THREE."+t.shift();Xr?Xr("warn",e,...t):console.warn(e,...t)}function Kr(...t){const e="THREE."+t.shift();Xr?Xr("error",e,...t):console.error(e,...t)}function $r(...t){const e=t.join(" ");e in jr||(jr[e]=!0,Jr(...t))}class Qr{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return void 0!==i&&void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){const i=this._listeners;if(void 0===i)return;const r=i[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const i=e[t.type];if(void 0!==i){t.target=this;const e=i.slice(0);for(let i=0,r=e.length;i<r;i++)e[i].call(this,t);t.target=null}}}const tn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let en=1234567;const rn=Math.PI/180,nn=180/Math.PI;function sn(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(tn[255&t]+tn[t>>8&255]+tn[t>>16&255]+tn[t>>24&255]+"-"+tn[255&e]+tn[e>>8&255]+"-"+tn[e>>16&15|64]+tn[e>>24&255]+"-"+tn[63&i|128]+tn[i>>8&255]+"-"+tn[i>>16&255]+tn[i>>24&255]+tn[255&r]+tn[r>>8&255]+tn[r>>16&255]+tn[r>>24&255]).toLowerCase()}function on(t,e,i){return Math.max(e,Math.min(i,t))}function an(t,e){return(t%e+e)%e}function cn(t,e,i){return(1-i)*t+i*e}function ln(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function hn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const un={DEG2RAD:rn,RAD2DEG:nn,generateUUID:sn,clamp:on,euclideanModulo:an,mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:cn,damp:function(t,e,i,r){return cn(t,e,1-Math.exp(-i*r))},pingpong:function(t,e=1){return e-Math.abs(an(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(en=t);let e=en+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*rn},radToDeg:function(t){return t*nn},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,r,n){const s=Math.cos,o=Math.sin,a=s(i/2),c=o(i/2),l=s((e+r)/2),h=o((e+r)/2),u=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(n){case"XYX":t.set(a*h,c*u,c*d,a*l);break;case"YZY":t.set(c*d,a*h,c*u,a*l);break;case"ZXZ":t.set(c*u,c*d,a*h,a*l);break;case"XZX":t.set(a*h,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*h,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*h,a*l);break;default:Jr("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}},normalize:hn,denormalize:ln};class dn{constructor(t=0,e=0){dn.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=on(this.x,t.x,e.x),this.y=on(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=on(this.x,t,e),this.y=on(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(on(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(on(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*i-s*r+t.x,this.y=n*r+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pn{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,n,s,o){let a=i[r+0],c=i[r+1],l=i[r+2],h=i[r+3],u=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(o<=0)return t[e+0]=a,t[e+1]=c,t[e+2]=l,void(t[e+3]=h);if(o>=1)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||c!==d||l!==p){let t=a*u+c*d+l*p+h*f;t<0&&(u=-u,d=-d,p=-p,f=-f,t=-t);let e=1-o;if(t<.9995){const i=Math.acos(t),r=Math.sin(i);e=Math.sin(e*i)/r,a=a*e+u*(o=Math.sin(o*i)/r),c=c*e+d*o,l=l*e+p*o,h=h*e+f*o}else{a=a*e+u*o,c=c*e+d*o,l=l*e+p*o,h=h*e+f*o;const t=1/Math.sqrt(a*a+c*c+l*l+h*h);a*=t,c*=t,l*=t,h*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,r,n,s){const o=i[r],a=i[r+1],c=i[r+2],l=i[r+3],h=n[s],u=n[s+1],d=n[s+2],p=n[s+3];return t[e]=o*p+l*h+a*d-c*u,t[e+1]=a*p+l*u+c*h-o*d,t[e+2]=c*p+l*d+o*u-a*h,t[e+3]=l*p-o*h-a*u-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,r=t._y,n=t._z,s=t._order,o=Math.cos,a=Math.sin,c=o(i/2),l=o(r/2),h=o(n/2),u=a(i/2),d=a(r/2),p=a(n/2);switch(s){case"XYZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"YXZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"ZXY":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"ZYX":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"YZX":this._x=u*l*h+c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h-u*d*p;break;case"XZY":this._x=u*l*h-c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h+u*d*p;break;default:Jr("Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],n=e[8],s=e[1],o=e[5],a=e[9],c=e[2],l=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(n-c)*t,this._z=(s-r)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(l-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(n+c)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(n-c)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-r)/t,this._x=(n+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-8?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(on(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,r=t._y,n=t._z,s=t._w,o=e._x,a=e._y,c=e._z,l=e._w;return this._x=i*l+s*o+r*c-n*a,this._y=r*l+s*a+n*o-i*c,this._z=n*l+s*c+i*a-r*o,this._w=s*l-i*o-r*a-n*c,this._onChangeCallback(),this}slerp(t,e){if(e<=0)return this;if(e>=1)return this.copy(t);let i=t._x,r=t._y,n=t._z,s=t._w,o=this.dot(t);o<0&&(i=-i,r=-r,n=-n,s=-s,o=-o);let a=1-e;if(o<.9995){const t=Math.acos(o),c=Math.sin(t);a=Math.sin(a*t)/c,e=Math.sin(e*t)/c,this._x=this._x*a+i*e,this._y=this._y*a+r*e,this._z=this._z*a+n*e,this._w=this._w*a+s*e,this._onChangeCallback()}else this._x=this._x*a+i*e,this._y=this._y*a+r*e,this._z=this._z*a+n*e,this._w=this._w*a+s*e,this.normalize();return this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),n=Math.sqrt(i);return this.set(r*Math.sin(t),r*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class fn{constructor(t=0,e=0,i=0){fn.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(gn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(gn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,o=t.z,a=t.w,c=2*(s*r-o*i),l=2*(o*e-n*r),h=2*(n*i-s*e);return this.x=e+a*c+s*h-o*l,this.y=i+a*l+o*c-n*h,this.z=r+a*h+n*l-s*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=on(this.x,t.x,e.x),this.y=on(this.y,t.y,e.y),this.z=on(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=on(this.x,t,e),this.y=on(this.y,t,e),this.z=on(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(on(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,r=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-n*o,this.y=n*s-i*a,this.z=i*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return mn.copy(this).projectOnVector(t),this.sub(mn)}reflect(t){return this.sub(mn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(on(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const mn=new fn,gn=new pn;class vn{constructor(t,e,i,r,n,s,o,a,c){vn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,r,n,s,o,a,c)}set(t,e,i,r,n,s,o,a,c){const l=this.elements;return l[0]=t,l[1]=r,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=i,l[7]=s,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[3],a=i[6],c=i[1],l=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=r[0],m=r[3],g=r[6],v=r[1],_=r[4],y=r[7],x=r[2],b=r[5],M=r[8];return n[0]=s*f+o*v+a*x,n[3]=s*m+o*_+a*b,n[6]=s*g+o*y+a*M,n[1]=c*f+l*v+h*x,n[4]=c*m+l*_+h*b,n[7]=c*g+l*y+h*M,n[2]=u*f+d*v+p*x,n[5]=u*m+d*_+p*b,n[8]=u*g+d*y+p*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*s*l-e*o*c-i*n*l+i*o*a+r*n*c-r*s*a}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=l*s-o*c,u=o*a-l*n,d=c*n-s*a,p=e*h+i*u+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(r*c-l*i)*f,t[2]=(o*i-r*s)*f,t[3]=u*f,t[4]=(l*e-r*a)*f,t[5]=(r*n-o*e)*f,t[6]=d*f,t[7]=(i*a-c*e)*f,t[8]=(s*e-i*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,s,o){const a=Math.cos(n),c=Math.sin(n);return this.set(i*a,i*c,-i*(a*s+c*o)+s+t,-r*c,r*a,-r*(-c*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(_n.makeScale(t,e)),this}rotate(t){return this.premultiply(_n.makeRotation(-t)),this}translate(t,e){return this.premultiply(_n.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const _n=new vn,yn=(new vn).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),xn=(new vn).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function bn(){const t={enabled:!0,workingColorSpace:qi,spaces:{},convert:function(t,e,i){return!1!==this.enabled&&e!==i&&e&&i?(this.spaces[e].transfer===Zi&&(t.r=Sn(t.r),t.g=Sn(t.g),t.b=Sn(t.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===Zi&&(t.r=wn(t.r),t.g=wn(t.g),t.b=wn(t.b)),t):t},workingToColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},colorSpaceToWorking:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===ji?Yi:this.spaces[t].transfer},getToneMappingMode:function(t){return this.spaces[t].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,i){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,i){return $r("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,i)},toWorkingColorSpace:function(e,i){return $r("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,i)}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[qi]:{primaries:e,whitePoint:r,transfer:Yi,toXYZ:yn,fromXYZ:xn,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:Xi},outputColorSpaceConfig:{drawingBufferColorSpace:Xi}},[Xi]:{primaries:e,whitePoint:r,transfer:Zi,toXYZ:yn,fromXYZ:xn,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:Xi}}}),t}const Mn=bn();function Sn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function wn(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Tn;class Cn{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{void 0===Tn&&(Tn=Hr("canvas")),Tn.width=t.width,Tn.height=t.height;const e=Tn.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),i=Tn}return i.toDataURL(e)}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Hr("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let t=0;t<n.length;t++)n[t]=255*Sn(n[t]/255);return i.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Sn(e[t]/255)):e[t]=Sn(e[t]);return{data:e,width:t.width,height:t.height}}return Jr("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let En=0;class Pn{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:En++}),this.uuid=sn(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,i=r.length;e<i;e++)r[e].isDataTexture?t.push(An(r[e].image)):t.push(An(r[e]))}else t=An(r);i.url=t}return e||(t.images[this.uuid]=i),i}}function An(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Cn.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(Jr("Texture: Unable to serialize Texture."),{})}let Dn=0;const kn=new fn;class Rn extends Qr{constructor(t=Rn.DEFAULT_IMAGE,e=Rn.DEFAULT_MAPPING,i=ae,r=ae,n=fe,s=ve,o=Oe,a=ye,c=Rn.DEFAULT_ANISOTROPY,l=ji){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Dn++}),this.uuid=sn(),this.name="",this.source=new Pn(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=a,this.offset=new dn(0,0),this.repeat=new dn(1,1),this.center=new dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new vn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(kn).x}get height(){return this.source.getSize(kn).y}get depth(){return this.source.getSize(kn).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const i=t[e];if(void 0===i){Jr(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[e]=i:Jr(`Texture.setValues(): property '${e}' does not exist.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==te)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case oe:t.x=t.x-Math.floor(t.x);break;case ae:t.x=t.x<0?0:1;break;case ce:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case oe:t.y=t.y-Math.floor(t.y);break;case ae:t.y=t.y<0?0:1;break;case ce:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Rn.DEFAULT_IMAGE=null,Rn.DEFAULT_MAPPING=te,Rn.DEFAULT_ANISOTROPY=1;class In{constructor(t=0,e=0,i=0,r=1){In.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*e+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*e+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*e+s[7]*i+s[11]*r+s[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n;const s=.01,o=.1,a=t.elements,c=a[0],l=a[4],h=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(l-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(l+u)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(c+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(c+1)/2,a=(d+1)/2,v=(g+1)/2,_=(l+u)/4,y=(h+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(t),r=_/i,n=y/i):a>v?a<s?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(a),i=_/r,n=x/r):v<s?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(v),i=y/n,r=x/n),this.set(i,r,n,e),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-l)*(u-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-l)/v,this.w=Math.acos((c+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=on(this.x,t.x,e.x),this.y=on(this.y,t.y,e.y),this.z=on(this.z,t.z,e.z),this.w=on(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=on(this.x,t,e),this.y=on(this.y,t,e),this.z=on(this.z,t,e),this.w=on(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(on(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class On extends Qr{constructor(t=1,e=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:fe,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=i.depth,this.scissor=new In(0,0,t,e),this.scissorTest=!1,this.viewport=new In(0,0,t,e);const r={width:t,height:e,depth:i.depth},n=new Rn(r);this.textures=[];const s=i.count;for(let t=0;t<s;t++)this.textures[t]=n.clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(t={}){const e={minFilter:fe,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==t.mapping&&(e.mapping=t.mapping),void 0!==t.wrapS&&(e.wrapS=t.wrapS),void 0!==t.wrapT&&(e.wrapT=t.wrapT),void 0!==t.wrapR&&(e.wrapR=t.wrapR),void 0!==t.magFilter&&(e.magFilter=t.magFilter),void 0!==t.minFilter&&(e.minFilter=t.minFilter),void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.anisotropy&&(e.anisotropy=t.anisotropy),void 0!==t.colorSpace&&(e.colorSpace=t.colorSpace),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.generateMipmaps&&(e.generateMipmaps=t.generateMipmaps),void 0!==t.internalFormat&&(e.internalFormat=t.internalFormat);for(let t=0;t<this.textures.length;t++)this.textures[t].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,n=this.textures.length;r<n;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=i,!0!==this.textures[r].isData3DTexture&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,i=t.textures.length;e<i;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const i=Object.assign({},t.textures[e].image);this.textures[e].source=new Pn(i)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ln extends On{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class Nn extends Rn{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Fn extends Ln{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Nn(null,t,e,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Un extends Rn{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Wn extends Ln{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new Un(null,t,e,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Bn{constructor(t=new fn(1/0,1/0,1/0),e=new fn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Vn.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Vn.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Vn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i){const r=i.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,i=r.count;e<i;e++)!0===t.isMesh?t.getVertexPosition(e,Vn):Vn.fromBufferAttribute(r,e),Vn.applyMatrix4(t.matrixWorld),this.expandByPoint(Vn);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Hn.copy(t.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),Hn.copy(i.boundingBox)),Hn.applyMatrix4(t.matrixWorld),this.union(Hn)}const r=t.children;for(let t=0,i=r.length;t<i;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Vn),Vn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Jn),Kn.subVectors(this.max,Jn),Gn.subVectors(t.a,Jn),jn.subVectors(t.b,Jn),Xn.subVectors(t.c,Jn),qn.subVectors(jn,Gn),Yn.subVectors(Xn,jn),Zn.subVectors(Gn,Xn);let e=[0,-qn.z,qn.y,0,-Yn.z,Yn.y,0,-Zn.z,Zn.y,qn.z,0,-qn.x,Yn.z,0,-Yn.x,Zn.z,0,-Zn.x,-qn.y,qn.x,0,-Yn.y,Yn.x,0,-Zn.y,Zn.x,0];return!!ts(e,Gn,jn,Xn,Kn)&&(e=[1,0,0,0,1,0,0,0,1],!!ts(e,Gn,jn,Xn,Kn)&&($n.crossVectors(qn,Yn),e=[$n.x,$n.y,$n.z],ts(e,Gn,jn,Xn,Kn)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Vn).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Vn).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(zn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),zn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),zn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),zn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),zn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),zn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),zn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),zn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(zn)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const zn=[new fn,new fn,new fn,new fn,new fn,new fn,new fn,new fn],Vn=new fn,Hn=new Bn,Gn=new fn,jn=new fn,Xn=new fn,qn=new fn,Yn=new fn,Zn=new fn,Jn=new fn,Kn=new fn,$n=new fn,Qn=new fn;function ts(t,e,i,r,n){for(let s=0,o=t.length-3;s<=o;s+=3){Qn.fromArray(t,s);const o=n.x*Math.abs(Qn.x)+n.y*Math.abs(Qn.y)+n.z*Math.abs(Qn.z),a=e.dot(Qn),c=i.dot(Qn),l=r.dot(Qn);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>o)return!1}return!0}const es=new Bn,is=new fn,rs=new fn;class ns{constructor(t=new fn,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):es.setFromPoints(t).getCenter(i);let r=0;for(let e=0,n=t.length;e<n;e++)r=Math.max(r,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;is.subVectors(t,this.center);const e=is.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(is,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(rs.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(is.copy(t.center).add(rs)),this.expandByPoint(is.copy(t.center).sub(rs))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const ss=new fn,os=new fn,as=new fn,cs=new fn,ls=new fn,hs=new fn,us=new fn;class ds{constructor(t=new fn,e=new fn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ss)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ss.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ss.copy(this.origin).addScaledVector(this.direction,e),ss.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){os.copy(t).add(e).multiplyScalar(.5),as.copy(e).sub(t).normalize(),cs.copy(this.origin).sub(os);const n=.5*t.distanceTo(e),s=-this.direction.dot(as),o=cs.dot(this.direction),a=-cs.dot(as),c=cs.lengthSq(),l=Math.abs(1-s*s);let h,u,d,p;if(l>0)if(h=s*a-o,u=s*o-a,p=n*l,h>=0)if(u>=-p)if(u<=p){const t=1/l;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+c}else u=n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;else u=-n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;else u<=-p?(h=Math.max(0,-(-s*n+o)),u=h>0?-n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+c):u<=p?(h=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+c):(h=Math.max(0,-(s*n+o)),u=h>0?n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+c);else u=s>0?-n:n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(os).addScaledVector(as,u),d}intersectSphere(t,e){ss.subVectors(t.center,this.origin);const i=ss.dot(this.direction),r=ss.dot(ss)-i*i,n=t.radius*t.radius;if(r>n)return null;const s=Math.sqrt(n-r),o=i-s,a=i+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return!(t.radius<0)&&this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,s,o,a;const c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(i=(t.min.x-u.x)*c,r=(t.max.x-u.x)*c):(i=(t.max.x-u.x)*c,r=(t.min.x-u.x)*c),l>=0?(n=(t.min.y-u.y)*l,s=(t.max.y-u.y)*l):(n=(t.max.y-u.y)*l,s=(t.min.y-u.y)*l),i>s||n>r?null:((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>r?null:((o>i||i!=i)&&(i=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,ss)}intersectTriangle(t,e,i,r,n){ls.subVectors(e,t),hs.subVectors(i,t),us.crossVectors(ls,hs);let s,o=this.direction.dot(us);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}cs.subVectors(this.origin,t);const a=s*this.direction.dot(hs.crossVectors(cs,hs));if(a<0)return null;const c=s*this.direction.dot(ls.cross(cs));if(c<0)return null;if(a+c>o)return null;const l=-s*cs.dot(us);return l<0?null:this.at(l/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ps{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m){ps.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m)}set(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=n,g[5]=s,g[9]=o,g[13]=a,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ps).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return 0===this.determinant()?(t.set(1,0,0),e.set(0,1,0),i.set(0,0,1),this):(t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){if(0===t.determinant())return this.identity();const e=this.elements,i=t.elements,r=1/fs.setFromMatrixColumn(t,0).length(),n=1/fs.setFromMatrixColumn(t,1).length(),s=1/fs.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(r),c=Math.sin(r),l=Math.cos(n),h=Math.sin(n);if("XYZ"===t.order){const t=s*l,i=s*h,r=o*l,n=o*h;e[0]=a*l,e[4]=-a*h,e[8]=c,e[1]=i+r*c,e[5]=t-n*c,e[9]=-o*a,e[2]=n-t*c,e[6]=r+i*c,e[10]=s*a}else if("YXZ"===t.order){const t=a*l,i=a*h,r=c*l,n=c*h;e[0]=t+n*o,e[4]=r*o-i,e[8]=s*c,e[1]=s*h,e[5]=s*l,e[9]=-o,e[2]=i*o-r,e[6]=n+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*l,i=a*h,r=c*l,n=c*h;e[0]=t-n*o,e[4]=-s*h,e[8]=r+i*o,e[1]=i+r*o,e[5]=s*l,e[9]=n-t*o,e[2]=-s*c,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*l,i=s*h,r=o*l,n=o*h;e[0]=a*l,e[4]=r*c-i,e[8]=t*c+n,e[1]=a*h,e[5]=n*c+t,e[9]=i*c-r,e[2]=-c,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*c,r=o*a,n=o*c;e[0]=a*l,e[4]=n-t*h,e[8]=r*h+i,e[1]=h,e[5]=s*l,e[9]=-o*l,e[2]=-c*l,e[6]=i*h+r,e[10]=t-n*h}else if("XZY"===t.order){const t=s*a,i=s*c,r=o*a,n=o*c;e[0]=a*l,e[4]=-h,e[8]=c*l,e[1]=t*h+n,e[5]=s*l,e[9]=i*h-r,e[2]=r*h-i,e[6]=o*l,e[10]=n*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(gs,t,vs)}lookAt(t,e,i){const r=this.elements;return xs.subVectors(t,e),0===xs.lengthSq()&&(xs.z=1),xs.normalize(),_s.crossVectors(i,xs),0===_s.lengthSq()&&(1===Math.abs(i.z)?xs.x+=1e-4:xs.z+=1e-4,xs.normalize(),_s.crossVectors(i,xs)),_s.normalize(),ys.crossVectors(xs,_s),r[0]=_s.x,r[4]=ys.x,r[8]=xs.x,r[1]=_s.y,r[5]=ys.y,r[9]=xs.y,r[2]=_s.z,r[6]=ys.z,r[10]=xs.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[4],a=i[8],c=i[12],l=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],_=i[7],y=i[11],x=i[15],b=r[0],M=r[4],S=r[8],w=r[12],T=r[1],C=r[5],E=r[9],P=r[13],A=r[2],D=r[6],k=r[10],R=r[14],I=r[3],O=r[7],L=r[11],N=r[15];return n[0]=s*b+o*T+a*A+c*I,n[4]=s*M+o*C+a*D+c*O,n[8]=s*S+o*E+a*k+c*L,n[12]=s*w+o*P+a*R+c*N,n[1]=l*b+h*T+u*A+d*I,n[5]=l*M+h*C+u*D+d*O,n[9]=l*S+h*E+u*k+d*L,n[13]=l*w+h*P+u*R+d*N,n[2]=p*b+f*T+m*A+g*I,n[6]=p*M+f*C+m*D+g*O,n[10]=p*S+f*E+m*k+g*L,n[14]=p*w+f*P+m*R+g*N,n[3]=v*b+_*T+y*A+x*I,n[7]=v*M+_*C+y*D+x*O,n[11]=v*S+_*E+y*k+x*L,n[15]=v*w+_*P+y*R+x*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],o=t[5],a=t[9],c=t[13],l=t[2],h=t[6],u=t[10],d=t[14],p=t[3],f=t[7],m=t[11],g=t[15],v=a*d-c*u,_=o*d-c*h,y=o*u-a*h,x=s*d-c*l,b=s*u-a*l,M=s*h-o*l;return e*(f*v-m*_+g*y)-i*(p*v-m*x+g*b)+r*(p*_-f*x+g*M)-n*(p*y-f*b+m*M)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*c-f*u*c+f*a*d-o*m*d-h*a*g+o*u*g,_=p*u*c-l*m*c-p*a*d+s*m*d+l*a*g-s*u*g,y=l*f*c-p*h*c+p*o*d-s*f*d-l*o*g+s*h*g,x=p*h*a-l*f*a-p*o*u+s*f*u+l*o*m-s*h*m,b=e*v+i*_+r*y+n*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=v*M,t[1]=(f*u*n-h*m*n-f*r*d+i*m*d+h*r*g-i*u*g)*M,t[2]=(o*m*n-f*a*n+f*r*c-i*m*c-o*r*g+i*a*g)*M,t[3]=(h*a*n-o*u*n-h*r*c+i*u*c+o*r*d-i*a*d)*M,t[4]=_*M,t[5]=(l*m*n-p*u*n+p*r*d-e*m*d-l*r*g+e*u*g)*M,t[6]=(p*a*n-s*m*n-p*r*c+e*m*c+s*r*g-e*a*g)*M,t[7]=(s*u*n-l*a*n+l*r*c-e*u*c-s*r*d+e*a*d)*M,t[8]=y*M,t[9]=(p*h*n-l*f*n-p*i*d+e*f*d+l*i*g-e*h*g)*M,t[10]=(s*f*n-p*o*n+p*i*c-e*f*c-s*i*g+e*o*g)*M,t[11]=(l*o*n-s*h*n-l*i*c+e*h*c+s*i*d-e*o*d)*M,t[12]=x*M,t[13]=(l*f*r-p*h*r+p*i*u-e*f*u-l*i*m+e*h*m)*M,t[14]=(p*o*r-s*f*r-p*i*a+e*f*a+s*i*m-e*o*m)*M,t[15]=(s*h*r-l*o*r+l*i*a-e*h*a-s*i*u+e*o*u)*M,this}scale(t){const e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,o=t.y,a=t.z,c=n*s,l=n*o;return this.set(c*s+i,c*o-r*a,c*a+r*o,0,c*o+r*a,l*o+i,l*a-r*s,0,c*a-r*o,l*a+r*s,n*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,s){return this.set(1,i,n,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){const r=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,c=n+n,l=s+s,h=o+o,u=n*c,d=n*l,p=n*h,f=s*l,m=s*h,g=o*h,v=a*c,_=a*l,y=a*h,x=i.x,b=i.y,M=i.z;return r[0]=(1-(f+g))*x,r[1]=(d+y)*x,r[2]=(p-_)*x,r[3]=0,r[4]=(d-y)*b,r[5]=(1-(u+g))*b,r[6]=(m+v)*b,r[7]=0,r[8]=(p+_)*M,r[9]=(m-v)*M,r[10]=(1-(u+f))*M,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){const r=this.elements;if(t.x=r[12],t.y=r[13],t.z=r[14],0===this.determinant())return i.set(1,1,1),e.identity(),this;let n=fs.set(r[0],r[1],r[2]).length();const s=fs.set(r[4],r[5],r[6]).length(),o=fs.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),ms.copy(this);const a=1/n,c=1/s,l=1/o;return ms.elements[0]*=a,ms.elements[1]*=a,ms.elements[2]*=a,ms.elements[4]*=c,ms.elements[5]*=c,ms.elements[6]*=c,ms.elements[8]*=l,ms.elements[9]*=l,ms.elements[10]*=l,e.setFromRotationMatrix(ms),i.x=n,i.y=s,i.z=o,this}makePerspective(t,e,i,r,n,s,o=Or,a=!1){const c=this.elements,l=2*n/(e-t),h=2*n/(i-r),u=(e+t)/(e-t),d=(i+r)/(i-r);let p,f;if(a)p=n/(s-n),f=s*n/(s-n);else if(o===Or)p=-(s+n)/(s-n),f=-2*s*n/(s-n);else{if(o!==Lr)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-s/(s-n),f=-s*n/(s-n)}return c[0]=l,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=h,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,i,r,n,s,o=Or,a=!1){const c=this.elements,l=2/(e-t),h=2/(i-r),u=-(e+t)/(e-t),d=-(i+r)/(i-r);let p,f;if(a)p=1/(s-n),f=s/(s-n);else if(o===Or)p=-2/(s-n),f=-(s+n)/(s-n);else{if(o!==Lr)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=-1/(s-n),f=-n/(s-n)}return c[0]=l,c[4]=0,c[8]=0,c[12]=u,c[1]=0,c[5]=h,c[9]=0,c[13]=d,c[2]=0,c[6]=0,c[10]=p,c[14]=f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const fs=new fn,ms=new ps,gs=new fn(0,0,0),vs=new fn(1,1,1),_s=new fn,ys=new fn,xs=new fn,bs=new ps,Ms=new pn;class Ss{constructor(t=0,e=0,i=0,r=Ss.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const r=t.elements,n=r[0],s=r[4],o=r[8],a=r[1],c=r[5],l=r[9],h=r[2],u=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(on(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-on(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(on(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-on(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(on(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-on(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,d),this._y=0);break;default:Jr("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return bs.makeRotationFromQuaternion(t),this.setFromRotationMatrix(bs,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ms.setFromEuler(this),this.setFromQuaternion(Ms,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ss.DEFAULT_ORDER="XYZ";class ws{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Ts=0;const Cs=new fn,Es=new pn,Ps=new ps,As=new fn,Ds=new fn,ks=new fn,Rs=new pn,Is=new fn(1,0,0),Os=new fn(0,1,0),Ls=new fn(0,0,1),Ns={type:"added"},Fs={type:"removed"},Us={type:"childadded",child:null},Ws={type:"childremoved",child:null};class Bs extends Qr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ts++}),this.uuid=sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Bs.DEFAULT_UP.clone();const t=new fn,e=new Ss,i=new pn,r=new fn(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ps},normalMatrix:{value:new vn}}),this.matrix=new ps,this.matrixWorld=new ps,this.matrixAutoUpdate=Bs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Bs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ws,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Es.setFromAxisAngle(t,e),this.quaternion.multiply(Es),this}rotateOnWorldAxis(t,e){return Es.setFromAxisAngle(t,e),this.quaternion.premultiply(Es),this}rotateX(t){return this.rotateOnAxis(Is,t)}rotateY(t){return this.rotateOnAxis(Os,t)}rotateZ(t){return this.rotateOnAxis(Ls,t)}translateOnAxis(t,e){return Cs.copy(t).applyQuaternion(this.quaternion),this.position.add(Cs.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Is,t)}translateY(t){return this.translateOnAxis(Os,t)}translateZ(t){return this.translateOnAxis(Ls,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ps.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?As.copy(t):As.set(t,e,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Ds.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ps.lookAt(Ds,As,this.up):Ps.lookAt(As,Ds,this.up),this.quaternion.setFromRotationMatrix(Ps),r&&(Ps.extractRotation(r.matrixWorld),Es.setFromRotationMatrix(Ps),this.quaternion.premultiply(Es.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(Kr("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Ns),Us.child=t,this.dispatchEvent(Us),Us.child=null):Kr("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Fs),Ws.child=t,this.dispatchEvent(Ws),Ws.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ps.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ps.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ps),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Ns),Us.child=t,this.dispatchEvent(Us),Us.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const r=this.children;for(let n=0,s=r.length;n<s;n++)r[n].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ds,t,ks),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ds,Rs,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function n(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map((t=>({...t,boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0}))),r.instanceInfo=this._instanceInfo.map((t=>({...t}))),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(t),r.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,r=i.length;e<r;e++){const r=i[e];n(t.shapes,r)}else n(t.shapes,i)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,r=this.material.length;i<r;i++)e.push(n(t.materials,this.material[i]));r.material=e}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];r.animations.push(n(t.animations,i))}}if(e){const e=s(t.geometries),r=s(t.materials),n=s(t.textures),o=s(t.images),a=s(t.shapes),c=s(t.skeletons),l=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),r.length>0&&(i.materials=r),n.length>0&&(i.textures=n),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),c.length>0&&(i.skeletons=c),l.length>0&&(i.animations=l),h.length>0&&(i.nodes=h)}return i.object=r,i;function s(t){const e=[];for(const i in t){const r=t[i];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Bs.DEFAULT_UP=new fn(0,1,0),Bs.DEFAULT_MATRIX_AUTO_UPDATE=!0,Bs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const zs=new fn,Vs=new fn,Hs=new fn,Gs=new fn,js=new fn,Xs=new fn,qs=new fn,Ys=new fn,Zs=new fn,Js=new fn,Ks=new In,$s=new In,Qs=new In;class to{constructor(t=new fn,e=new fn,i=new fn){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),zs.subVectors(t,e),r.cross(zs);const n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){zs.subVectors(r,e),Vs.subVectors(i,e),Hs.subVectors(t,e);const s=zs.dot(zs),o=zs.dot(Vs),a=zs.dot(Hs),c=Vs.dot(Vs),l=Vs.dot(Hs),h=s*c-o*o;if(0===h)return n.set(0,0,0),null;const u=1/h,d=(c*a-o*l)*u,p=(s*l-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(t,e,i,r){return null!==this.getBarycoord(t,e,i,r,Gs)&&Gs.x>=0&&Gs.y>=0&&Gs.x+Gs.y<=1}static getInterpolation(t,e,i,r,n,s,o,a){return null===this.getBarycoord(t,e,i,r,Gs)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(n,Gs.x),a.addScaledVector(s,Gs.y),a.addScaledVector(o,Gs.z),a)}static getInterpolatedAttribute(t,e,i,r,n,s){return Ks.setScalar(0),$s.setScalar(0),Qs.setScalar(0),Ks.fromBufferAttribute(t,e),$s.fromBufferAttribute(t,i),Qs.fromBufferAttribute(t,r),s.setScalar(0),s.addScaledVector(Ks,n.x),s.addScaledVector($s,n.y),s.addScaledVector(Qs,n.z),s}static isFrontFacing(t,e,i,r){return zs.subVectors(i,e),Vs.subVectors(t,e),zs.cross(Vs).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return zs.subVectors(this.c,this.b),Vs.subVectors(this.a,this.b),.5*zs.cross(Vs).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return to.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return to.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,r,n){return to.getInterpolation(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return to.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return to.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,r=this.b,n=this.c;let s,o;js.subVectors(r,i),Xs.subVectors(n,i),Ys.subVectors(t,i);const a=js.dot(Ys),c=Xs.dot(Ys);if(a<=0&&c<=0)return e.copy(i);Zs.subVectors(t,r);const l=js.dot(Zs),h=Xs.dot(Zs);if(l>=0&&h<=l)return e.copy(r);const u=a*h-l*c;if(u<=0&&a>=0&&l<=0)return s=a/(a-l),e.copy(i).addScaledVector(js,s);Js.subVectors(t,n);const d=js.dot(Js),p=Xs.dot(Js);if(p>=0&&d<=p)return e.copy(n);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return o=c/(c-p),e.copy(i).addScaledVector(Xs,o);const m=l*p-d*h;if(m<=0&&h-l>=0&&d-p>=0)return qs.subVectors(n,r),o=(h-l)/(h-l+(d-p)),e.copy(r).addScaledVector(qs,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(i).addScaledVector(js,s).addScaledVector(Xs,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const eo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},io={h:0,s:0,l:0},ro={h:0,s:0,l:0};function no(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class so{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Xi){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Mn.colorSpaceToWorking(this,e),this}setRGB(t,e,i,r=Mn.workingColorSpace){return this.r=t,this.g=e,this.b=i,Mn.colorSpaceToWorking(this,r),this}setHSL(t,e,i,r=Mn.workingColorSpace){if(t=an(t,1),e=on(e,0,1),i=on(i,0,1),0===e)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,n=2*i-r;this.r=no(n,r,t+1/3),this.g=no(n,r,t),this.b=no(n,r,t-1/3)}return Mn.colorSpaceToWorking(this,r),this}setStyle(t,e=Xi){function i(e){void 0!==e&&parseFloat(e)<1&&Jr("Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:Jr("Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=r[1],n=i.length;if(3===n)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(i,16),e);Jr("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Xi){const i=eo[t.toLowerCase()];return void 0!==i?this.setHex(i,e):Jr("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Sn(t.r),this.g=Sn(t.g),this.b=Sn(t.b),this}copyLinearToSRGB(t){return this.r=wn(t.r),this.g=wn(t.g),this.b=wn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Xi){return Mn.workingToColorSpace(oo.copy(this),t),65536*Math.round(on(255*oo.r,0,255))+256*Math.round(on(255*oo.g,0,255))+Math.round(on(255*oo.b,0,255))}getHexString(t=Xi){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Mn.workingColorSpace){Mn.workingToColorSpace(oo.copy(this),e);const i=oo.r,r=oo.g,n=oo.b,s=Math.max(i,r,n),o=Math.min(i,r,n);let a,c;const l=(o+s)/2;if(o===s)a=0,c=0;else{const t=s-o;switch(c=l<=.5?t/(s+o):t/(2-s-o),s){case i:a=(r-n)/t+(r<n?6:0);break;case r:a=(n-i)/t+2;break;case n:a=(i-r)/t+4}a/=6}return t.h=a,t.s=c,t.l=l,t}getRGB(t,e=Mn.workingColorSpace){return Mn.workingToColorSpace(oo.copy(this),e),t.r=oo.r,t.g=oo.g,t.b=oo.b,t}getStyle(t=Xi){Mn.workingToColorSpace(oo.copy(this),t);const e=oo.r,i=oo.g,r=oo.b;return t!==Xi?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(t,e,i){return this.getHSL(io),this.setHSL(io.h+t,io.s+e,io.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(io),t.getHSL(ro);const i=cn(io.h,ro.h,e),r=cn(io.s,ro.s,e),n=cn(io.l,ro.l,e);return this.setHSL(i,r,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,r=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*r,this.g=n[1]*e+n[4]*i+n[7]*r,this.b=n[2]*e+n[5]*i+n[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const oo=new so;so.NAMES=eo;let ao=0;class co extends Qr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ao++}),this.uuid=sn(),this.name="",this.type="Material",this.blending=ct,this.side=nt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Mt,this.blendDst=St,this.blendEquation=pt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new so(0,0,0),this.blendAlpha=0,this.depthFunc=Nt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tr,this.stencilZFail=tr,this.stencilZPass=tr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){Jr(`Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i:Jr(`Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const i in t){const r=t[i];delete r.metadata,e.push(r)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ct&&(i.blending=this.blending),this.side!==nt&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),this.blendSrc!==Mt&&(i.blendSrc=this.blendSrc),this.blendDst!==St&&(i.blendDst=this.blendDst),this.blendEquation!==pt&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Nt&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==fr&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tr&&(i.stencilFail=this.stencilFail),this.stencilZFail!==tr&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==tr&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!1===this.allowOverride&&(i.allowOverride=!1),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=r(t.textures),n=r(t.images);e.length>0&&(i.textures=e),n.length>0&&(i.images=n)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let r=0;r!==t;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.allowOverride=t.allowOverride,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class lo extends co{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new so(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ss,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ho=uo();function uo(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(r[t]=0,r[256|t]=32768,n[t]=24,n[256|t]=24):e<-14?(r[t]=1024>>-e-14,r[256|t]=1024>>-e-14|32768,n[t]=-e-1,n[256|t]=-e-1):e<=15?(r[t]=e+15<<10,r[256|t]=e+15<<10|32768,n[t]=13,n[256|t]=13):e<128?(r[t]=31744,r[256|t]=64512,n[t]=24,n[256|t]=24):(r[t]=31744,r[256|t]=64512,n[t]=13,n[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;!(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,s[t]=e|i}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:o,offsetTable:a}}function po(t){Math.abs(t)>65504&&Jr("DataUtils.toHalfFloat(): Value out of range."),t=on(t,-65504,65504),ho.floatView[0]=t;const e=ho.uint32View[0],i=e>>23&511;return ho.baseTable[i]+((8388607&e)>>ho.shiftTable[i])}function fo(t){const e=t>>10;return ho.uint32View[0]=ho.mantissaTable[ho.offsetTable[e]+(1023&t)]+ho.exponentTable[e],ho.floatView[0]}class mo{static toHalfFloat(t){return po(t)}static fromHalfFloat(t){return fo(t)}}const go=new fn,vo=new dn;let _o=0;class yo{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_o++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=Sr,this.updateRanges=[],this.gpuType=Te,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)vo.fromBufferAttribute(this,e),vo.applyMatrix3(t),this.setXY(e,vo.x,vo.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)go.fromBufferAttribute(this,e),go.applyMatrix3(t),this.setXYZ(e,go.x,go.y,go.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)go.fromBufferAttribute(this,e),go.applyMatrix4(t),this.setXYZ(e,go.x,go.y,go.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)go.fromBufferAttribute(this,e),go.applyNormalMatrix(t),this.setXYZ(e,go.x,go.y,go.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)go.fromBufferAttribute(this,e),go.transformDirection(t),this.setXYZ(e,go.x,go.y,go.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=ln(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=hn(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ln(e,this.array)),e}setX(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ln(e,this.array)),e}setY(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ln(e,this.array)),e}setZ(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ln(e,this.array)),e}setW(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array),n=hn(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Sr&&(t.usage=this.usage),t}}class xo extends yo{constructor(t,e,i){super(new Int8Array(t),e,i)}}class bo extends yo{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class Mo extends yo{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class So extends yo{constructor(t,e,i){super(new Int16Array(t),e,i)}}class wo extends yo{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class To extends yo{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Co extends yo{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Eo extends yo{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}getX(t){let e=fo(this.array[t*this.itemSize]);return this.normalized&&(e=ln(e,this.array)),e}setX(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize]=po(e),this}getY(t){let e=fo(this.array[t*this.itemSize+1]);return this.normalized&&(e=ln(e,this.array)),e}setY(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+1]=po(e),this}getZ(t){let e=fo(this.array[t*this.itemSize+2]);return this.normalized&&(e=ln(e,this.array)),e}setZ(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+2]=po(e),this}getW(t){let e=fo(this.array[t*this.itemSize+3]);return this.normalized&&(e=ln(e,this.array)),e}setW(t,e){return this.normalized&&(e=hn(e,this.array)),this.array[t*this.itemSize+3]=po(e),this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array)),this.array[t+0]=po(e),this.array[t+1]=po(i),this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array)),this.array[t+0]=po(e),this.array[t+1]=po(i),this.array[t+2]=po(r),this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array),n=hn(n,this.array)),this.array[t+0]=po(e),this.array[t+1]=po(i),this.array[t+2]=po(r),this.array[t+3]=po(n),this}}class Po extends yo{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Ao=0;const Do=new ps,ko=new Bs,Ro=new fn,Io=new Bn,Oo=new Bn,Lo=new fn;class No extends Qr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ao++}),this.uuid=sn(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Wr(t)?Co:wo)(t,1):this.index=t,this}setIndirect(t,e=0){return this.indirect=t,this.indirectOffset=e,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new vn).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Do.makeRotationFromQuaternion(t),this.applyMatrix4(Do),this}rotateX(t){return Do.makeRotationX(t),this.applyMatrix4(Do),this}rotateY(t){return Do.makeRotationY(t),this.applyMatrix4(Do),this}rotateZ(t){return Do.makeRotationZ(t),this.applyMatrix4(Do),this}translate(t,e,i){return Do.makeTranslation(t,e,i),this.applyMatrix4(Do),this}scale(t,e,i){return Do.makeScale(t,e,i),this.applyMatrix4(Do),this}lookAt(t){return ko.lookAt(t),ko.updateMatrix(),this.applyMatrix4(ko.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ro).negate(),this.translate(Ro.x,Ro.y,Ro.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];e.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Po(e,3))}else{const i=Math.min(t.length,e.count);for(let r=0;r<i;r++){const i=t[r];e.setXYZ(r,i.x,i.y,i.z||0)}t.length>e.count&&Jr("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Bn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return Kr("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new fn(-1/0,-1/0,-1/0),new fn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Io.setFromBufferAttribute(i),this.morphTargetsRelative?(Lo.addVectors(this.boundingBox.min,Io.min),this.boundingBox.expandByPoint(Lo),Lo.addVectors(this.boundingBox.max,Io.max),this.boundingBox.expandByPoint(Lo)):(this.boundingBox.expandByPoint(Io.min),this.boundingBox.expandByPoint(Io.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Kr('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ns);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return Kr("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new fn,1/0);if(t){const i=this.boundingSphere.center;if(Io.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Oo.setFromBufferAttribute(i),this.morphTargetsRelative?(Lo.addVectors(Io.min,Oo.min),Io.expandByPoint(Lo),Lo.addVectors(Io.max,Oo.max),Io.expandByPoint(Lo)):(Io.expandByPoint(Oo.min),Io.expandByPoint(Oo.max))}Io.getCenter(i);let r=0;for(let e=0,n=t.count;e<n;e++)Lo.fromBufferAttribute(t,e),r=Math.max(r,i.distanceToSquared(Lo));if(e)for(let n=0,s=e.length;n<s;n++){const s=e[n],o=this.morphTargetsRelative;for(let e=0,n=s.count;e<n;e++)Lo.fromBufferAttribute(s,e),o&&(Ro.fromBufferAttribute(t,e),Lo.add(Ro)),r=Math.max(r,i.distanceToSquared(Lo))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&Kr('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void Kr("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.position,r=e.normal,n=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new yo(new Float32Array(4*i.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<i.count;t++)o[t]=new fn,a[t]=new fn;const c=new fn,l=new fn,h=new fn,u=new dn,d=new dn,p=new dn,f=new fn,m=new fn;function g(t,e,r){c.fromBufferAttribute(i,t),l.fromBufferAttribute(i,e),h.fromBufferAttribute(i,r),u.fromBufferAttribute(n,t),d.fromBufferAttribute(n,e),p.fromBufferAttribute(n,r),l.sub(c),h.sub(c),d.sub(u),p.sub(u);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,i=v.length;e<i;++e){const i=v[e],r=i.start;for(let e=r,n=r+i.count;e<n;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const _=new fn,y=new fn,x=new fn,b=new fn;function M(t){x.fromBufferAttribute(r,t),b.copy(x);const e=o[t];_.copy(e),_.sub(x.multiplyScalar(x.dot(e))).normalize(),y.crossVectors(b,e);const i=y.dot(a[t])<0?-1:1;s.setXYZW(t,_.x,_.y,_.z,i)}for(let e=0,i=v.length;e<i;++e){const i=v[e],r=i.start;for(let e=r,n=r+i.count;e<n;e+=3)M(t.getX(e+0)),M(t.getX(e+1)),M(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new yo(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const r=new fn,n=new fn,s=new fn,o=new fn,a=new fn,c=new fn,l=new fn,h=new fn;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);r.fromBufferAttribute(e,d),n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),l.subVectors(s,n),h.subVectors(r,n),l.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),c.fromBufferAttribute(i,f),o.add(l),a.add(l),c.add(l),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),l.subVectors(s,n),h.subVectors(r,n),l.cross(h),i.setXYZ(t+0,l.x,l.y,l.z),i.setXYZ(t+1,l.x,l.y,l.z),i.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Lo.fromBufferAttribute(t,e),Lo.normalize(),t.setXYZ(e,Lo.x,Lo.y,Lo.z)}toNonIndexed(){function t(t,e){const i=t.array,r=t.itemSize,n=t.normalized,s=new i.constructor(e.length*r);let o=0,a=0;for(let n=0,c=e.length;n<c;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*r;for(let t=0;t<r;t++)s[a++]=i[o++]}return new yo(s,r,n)}if(null===this.index)return Jr("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new No,i=this.index.array,r=this.attributes;for(const n in r){const s=t(r[n],i);e.setAttribute(n,s)}const n=this.morphAttributes;for(const r in n){const s=[],o=n[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],i);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const r=i[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let n=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere=o.toJSON()),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone());const r=t.attributes;for(const t in r){const i=r[t];this.setAttribute(t,i.clone(e))}const n=t.morphAttributes;for(const t in n){const i=[],r=n[t];for(let t=0,n=r.length;t<n;t++)i.push(r[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Fo=new ps,Uo=new ds,Wo=new ns,Bo=new fn,zo=new fn,Vo=new fn,Ho=new fn,Go=new fn,jo=new fn,Xo=new fn,qo=new fn;class Yo extends Bs{constructor(t=new No,e=new lo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(n&&o){jo.set(0,0,0);for(let i=0,r=n.length;i<r;i++){const r=o[i],a=n[i];0!==r&&(Go.fromBufferAttribute(a,t),s?jo.addScaledVector(Go,r):jo.addScaledVector(Go.sub(e),r))}e.add(jo)}return e}raycast(t,e){const i=this.geometry,r=this.material,n=this.matrixWorld;if(void 0!==r){if(null===i.boundingSphere&&i.computeBoundingSphere(),Wo.copy(i.boundingSphere),Wo.applyMatrix4(n),Uo.copy(t.ray).recast(t.near),!1===Wo.containsPoint(Uo.origin)){if(null===Uo.intersectSphere(Wo,Bo))return;if(Uo.origin.distanceToSquared(Bo)>(t.far-t.near)**2)return}Fo.copy(n).invert(),Uo.copy(t.ray).applyMatrix4(Fo),null!==i.boundingBox&&!1===Uo.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,Uo)}}_computeIntersections(t,e,i){let r;const n=this.geometry,s=this.material,o=n.index,a=n.attributes.position,c=n.attributes.uv,l=n.attributes.uv1,h=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(s))for(let n=0,a=u.length;n<a;n++){const a=u[n],p=s[a.materialIndex];for(let n=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));n<s;n+=3)r=Zo(this,p,t,i,c,l,h,o.getX(n),o.getX(n+1),o.getX(n+2)),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=a.materialIndex,e.push(r))}else for(let n=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);n<a;n+=3)r=Zo(this,s,t,i,c,l,h,o.getX(n),o.getX(n+1),o.getX(n+2)),r&&(r.faceIndex=Math.floor(n/3),e.push(r));else if(void 0!==a)if(Array.isArray(s))for(let n=0,o=u.length;n<o;n++){const o=u[n],p=s[o.materialIndex];for(let n=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));n<s;n+=3)r=Zo(this,p,t,i,c,l,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=o.materialIndex,e.push(r))}else for(let n=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);n<o;n+=3)r=Zo(this,s,t,i,c,l,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),e.push(r))}}function Zo(t,e,i,r,n,s,o,a,c,l){t.getVertexPosition(a,zo),t.getVertexPosition(c,Vo),t.getVertexPosition(l,Ho);const h=function(t,e,i,r,n,s,o,a){let c;if(c=e.side===st?r.intersectTriangle(o,s,n,!0,a):r.intersectTriangle(n,s,o,e.side===nt,a),null===c)return null;qo.copy(a),qo.applyMatrix4(t.matrixWorld);const l=i.ray.origin.distanceTo(qo);return l<i.near||l>i.far?null:{distance:l,point:qo.clone(),object:t}}(t,e,i,r,zo,Vo,Ho,Xo);if(h){const t=new fn;to.getBarycoord(Xo,zo,Vo,Ho,t),n&&(h.uv=to.getInterpolatedAttribute(n,a,c,l,t,new dn)),s&&(h.uv1=to.getInterpolatedAttribute(s,a,c,l,t,new dn)),o&&(h.normal=to.getInterpolatedAttribute(o,a,c,l,t,new fn),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const e={a,b:c,c:l,normal:new fn,materialIndex:0};to.getNormal(zo,Vo,Ho,e.normal),h.face=e,h.barycoord=t}return h}class Jo extends No{constructor(t=1,e=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};const o=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);const a=[],c=[],l=[],h=[];let u=0,d=0;function p(t,e,i,r,n,s,p,f,m,g,v){const _=s/m,y=p/g,x=s/2,b=p/2,M=f/2,S=m+1,w=g+1;let T=0,C=0;const E=new fn;for(let s=0;s<w;s++){const o=s*y-b;for(let a=0;a<S;a++){const u=a*_-x;E[t]=u*r,E[e]=o*n,E[i]=M,c.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=f>0?1:-1,l.push(E.x,E.y,E.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+S*t,r=u+e+S*(t+1),n=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;a.push(i,r,s),a.push(r,n,s),C+=6}o.addGroup(d,C,v),d+=C,u+=T}p("z","y","x",-1,-1,i,e,t,s,n,0),p("z","y","x",1,-1,i,e,-t,s,n,1),p("x","z","y",1,1,t,i,e,r,s,2),p("x","z","y",1,-1,t,i,-e,r,s,3),p("x","y","z",1,-1,t,e,i,r,n,4),p("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(a),this.setAttribute("position",new Po(c,3)),this.setAttribute("normal",new Po(l,3)),this.setAttribute("uv",new Po(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Jo(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ko(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(Jr("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function $o(t){const e={};for(let i=0;i<t.length;i++){const r=Ko(t[i]);for(const t in r)e[t]=r[t]}return e}function Qo(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:Mn.workingColorSpace}const ta={clone:Ko,merge:$o};class ea extends co{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ko(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this.defaultAttributeValues=Object.assign({},t.defaultAttributeValues),this.index0AttributeName=t.index0AttributeName,this.uniformsNeedUpdate=t.uniformsNeedUpdate,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class ia extends Bs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ps,this.projectionMatrix=new ps,this.projectionMatrixInverse=new ps,this.coordinateSystem=Or,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const ra=new fn,na=new dn,sa=new dn;class oa extends ia{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*nn*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*rn*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*nn*Math.atan(Math.tan(.5*rn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){ra.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(ra.x,ra.y).multiplyScalar(-t/ra.z),ra.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ra.x,ra.y).multiplyScalar(-t/ra.z)}getViewSize(t,e){return this.getViewBounds(t,na,sa),e.subVectors(sa,na)}setViewOffset(t,e,i,r,n,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*rn*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;n+=s.offsetX*r/t,e-=s.offsetY*i/o,r*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(n+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const aa=-90;class ca extends Bs{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new oa(aa,1,t,e);r.layers=this.layers,this.add(r);const n=new oa(aa,1,t,e);n.layers=this.layers,this.add(n);const s=new oa(aa,1,t,e);s.layers=this.layers,this.add(s);const o=new oa(aa,1,t,e);o.layers=this.layers,this.add(o);const a=new oa(aa,1,t,e);a.layers=this.layers,this.add(a);const c=new oa(aa,1,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,r,n,s,o,a]=e;for(const t of e)this.remove(t);if(t===Or)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Lr)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,s,o,a,c,l]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,r),t.render(e,n),t.setRenderTarget(i,1,r),t.render(e,s),t.setRenderTarget(i,2,r),t.render(e,o),t.setRenderTarget(i,3,r),t.render(e,a),t.setRenderTarget(i,4,r),t.render(e,c),i.texture.generateMipmaps=f,t.setRenderTarget(i,5,r),t.render(e,l),t.setRenderTarget(h,u,d),t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class la extends Rn{constructor(t=[],e=ee,i,r,n,s,o,a,c,l){super(t,e,i,r,n,s,o,a,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ha extends Ln{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new la(r),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Jo(5,5,5),o=new ea({name:"CubemapFromEquirect",uniforms:Ko(i),vertexShader:r,fragmentShader:n,side:st,blending:at});o.uniforms.tEquirect.value=e;const a=new Yo(s,o),c=e.minFilter;return e.minFilter===ve&&(e.minFilter=fe),new ca(1,10,this).update(t,a),e.minFilter=c,a.geometry.dispose(),a.material.dispose(),this}clear(t,e=!0,i=!0,r=!0){const n=t.getRenderTarget();for(let n=0;n<6;n++)t.setRenderTarget(this,n),t.clear(e,i,r);t.setRenderTarget(n)}}class ua extends Bs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const da={type:"move"};class pa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ua,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ua,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ua,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let r=null,n=null,s=null;const o=this._targetRay,a=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(c&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,i),n=this._getHandJoint(c,r);null!==t&&(n.matrix.fromArray(t.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.matrixWorldNeedsUpdate=!0,n.jointRadius=t.radius),n.visible=null!==t}const r=c.joints["index-finger-tip"],n=c.joints["thumb-tip"],o=r.position.distanceTo(n.position),a=.02,l=.005;c.inputState.pinching&&o>a+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&o<=a-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(n=e.getPose(t.gripSpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(r=e.getPose(t.targetRaySpace,i),null===r&&null!==n&&(r=n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(da)))}return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==n),null!==c&&(c.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new ua;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class fa{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new so(t),this.density=e}clone(){return new fa(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class ma{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new so(t),this.near=e,this.far=i}clone(){return new ma(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ga extends Bs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ss,this.environmentIntensity=1,this.environmentRotation=new Ss,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class va{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Sr,this.updateRanges=[],this.version=0,this.uuid=sn()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=sn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=sn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _a=new fn;class ya{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)_a.fromBufferAttribute(this,e),_a.applyMatrix4(t),this.setXYZ(e,_a.x,_a.y,_a.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)_a.fromBufferAttribute(this,e),_a.applyNormalMatrix(t),this.setXYZ(e,_a.x,_a.y,_a.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)_a.fromBufferAttribute(this,e),_a.transformDirection(t),this.setXYZ(e,_a.x,_a.y,_a.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=ln(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=hn(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=hn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ln(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ln(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ln(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ln(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=hn(e,this.array),i=hn(i,this.array),r=hn(r,this.array),n=hn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(void 0===t){Zr("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new yo(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ya(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){Zr("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class xa extends co{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new so(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let ba;const Ma=new fn,Sa=new fn,wa=new fn,Ta=new dn,Ca=new dn,Ea=new ps,Pa=new fn,Aa=new fn,Da=new fn,ka=new dn,Ra=new dn,Ia=new dn;class Oa extends Bs{constructor(t=new xa){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ba){ba=new No;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new va(t,5);ba.setIndex([0,1,2,0,2,3]),ba.setAttribute("position",new ya(e,3,0,!1)),ba.setAttribute("uv",new ya(e,2,3,!1))}this.geometry=ba,this.material=t,this.center=new dn(.5,.5),this.count=1}raycast(t,e){null===t.camera&&Kr('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sa.setFromMatrixScale(this.matrixWorld),Ea.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),wa.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Sa.multiplyScalar(-wa.z);const i=this.material.rotation;let r,n;0!==i&&(n=Math.cos(i),r=Math.sin(i));const s=this.center;La(Pa.set(-.5,-.5,0),wa,s,Sa,r,n),La(Aa.set(.5,-.5,0),wa,s,Sa,r,n),La(Da.set(.5,.5,0),wa,s,Sa,r,n),ka.set(0,0),Ra.set(1,0),Ia.set(1,1);let o=t.ray.intersectTriangle(Pa,Aa,Da,!1,Ma);if(null===o&&(La(Aa.set(-.5,.5,0),wa,s,Sa,r,n),Ra.set(0,1),o=t.ray.intersectTriangle(Pa,Da,Aa,!1,Ma),null===o))return;const a=t.ray.origin.distanceTo(Ma);a<t.near||a>t.far||e.push({distance:a,point:Ma.clone(),uv:to.getInterpolation(Ma,Pa,Aa,Da,ka,Ra,Ia,new dn),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function La(t,e,i,r,n,s){Ta.subVectors(t,i).addScalar(.5).multiply(r),void 0!==n?(Ca.x=s*Ta.x-n*Ta.y,Ca.y=n*Ta.x+s*Ta.y):Ca.copy(Ta),t.copy(e),t.x+=Ca.x,t.y+=Ca.y,t.applyMatrix4(Ea)}const Na=new fn,Fa=new fn;class Ua extends Bs{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,i=0){e=Math.abs(e);const r=this.levels;let n;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,hysteresis:i,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let i=0;i<e.length;i++)if(e[i].distance===t){const t=e.splice(i,1);return this.remove(t[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,r;for(i=1,r=e.length;i<r;i++){let r=e[i].distance;if(e[i].object.visible&&(r-=r*e[i].hysteresis),t<r)break}return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){Na.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Na);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Na.setFromMatrixPosition(t.matrixWorld),Fa.setFromMatrixPosition(this.matrixWorld);const i=Na.distanceTo(Fa)/t.zoom;let r,n;for(e[0].object.visible=!0,r=1,n=e.length;r<n;r++){let t=e[r].distance;if(e[r].object.visible&&(t-=t*e[r].hysteresis),!(i>=t))break;e[r-1].object.visible=!1,e[r].object.visible=!0}for(this._currentLevel=r-1;r<n;r++)e[r].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,r=i.length;t<r;t++){const r=i[t];e.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return e}}const Wa=new fn,Ba=new In,za=new In,Va=new fn,Ha=new ps,Ga=new fn,ja=new ns,Xa=new ps,qa=new ds;class Ya extends Yo{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=$t,this.bindMatrix=new ps,this.bindMatrixInverse=new ps,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Bn),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Ga),this.boundingBox.expandByPoint(Ga)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ns),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Ga),this.boundingSphere.expandByPoint(Ga)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,r=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),ja.copy(this.boundingSphere),ja.applyMatrix4(r),!1!==t.ray.intersectsSphere(ja)&&(Xa.copy(r).invert(),qa.copy(t.ray).applyMatrix4(Xa),null!==this.boundingBox&&!1===qa.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,qa)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new In,e=this.geometry.attributes.skinWeight;for(let i=0,r=e.count;i<r;i++){t.fromBufferAttribute(e,i);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===$t?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Qt?this.bindMatrixInverse.copy(this.bindMatrix).invert():Jr("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,r=this.geometry;Ba.fromBufferAttribute(r.attributes.skinIndex,t),za.fromBufferAttribute(r.attributes.skinWeight,t),Wa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=za.getComponent(t);if(0!==r){const n=Ba.getComponent(t);Ha.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),e.addScaledVector(Va.copy(Wa).applyMatrix4(Ha),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Za extends Bs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ja extends Rn{constructor(t=null,e=1,i=1,r,n,s,o,a,c=le,l=le,h,u){super(null,s,o,a,c,l,r,n,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ka=new ps,$a=new ps;class Qa{constructor(t=[],e=[]){this.uuid=sn(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){Jr("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ps)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ps;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let r=0,n=t.length;r<n;r++){const n=t[r]?t[r].matrixWorld:$a;Ka.multiplyMatrices(n,e[r]),Ka.toArray(i,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Qa(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Ja(e,t,t,Oe,Te);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){const r=t.bones[i];let n=e[r];void 0===n&&(Jr("Skeleton: No bone found with UUID:",r),n=new Za),this.bones.push(n),this.boneInverses.push((new ps).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){const n=e[r];t.bones.push(n.uuid);const s=i[r];t.boneInverses.push(s.toArray())}return t}}class tc extends yo{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const ec=new ps,ic=new ps,rc=[],nc=new Bn,sc=new ps,oc=new Yo,ac=new ns;class cc extends Yo{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new tc(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,sc)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Bn),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,ec),nc.copy(t.boundingBox).applyMatrix4(ec),this.boundingBox.union(nc)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new ns),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,ec),ac.copy(t.boundingSphere).applyMatrix4(ec),this.boundingSphere.union(ac)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const i=e.morphTargetInfluences,r=this.morphTexture.source.data.data,n=t*(i.length+1)+1;for(let t=0;t<i.length;t++)i[t]=r[n+t]}raycast(t,e){const i=this.matrixWorld,r=this.count;if(oc.geometry=this.geometry,oc.material=this.material,void 0!==oc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ac.copy(this.boundingSphere),ac.applyMatrix4(i),!1!==t.ray.intersectsSphere(ac)))for(let n=0;n<r;n++){this.getMatrixAt(n,ec),ic.multiplyMatrices(i,ec),oc.matrixWorld=ic,oc.raycast(t,rc);for(let t=0,i=rc.length;t<i;t++){const i=rc[t];i.instanceId=n,i.object=this,e.push(i)}rc.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new tc(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const i=e.morphTargetInfluences,r=i.length+1;null===this.morphTexture&&(this.morphTexture=new Ja(new Float32Array(r*this.count),r,this.count,Fe,Te));const n=this.morphTexture.source.data.data;let s=0;for(let t=0;t<i.length;t++)s+=i[t];const o=this.geometry.morphTargetsRelative?1:1-s,a=r*t;n[a]=o,n.set(i,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const lc=new fn,hc=new fn,uc=new vn;class dc{constructor(t=new fn(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const r=lc.subVectors(i,e).cross(hc.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(lc),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(t.start).addScaledVector(i,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||uc.getNormalMatrix(t),r=this.coplanarPoint(lc).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const pc=new ns,fc=new dn(.5,.5),mc=new fn;class gc{constructor(t=new dc,e=new dc,i=new dc,r=new dc,n=new dc,s=new dc){this.planes=[t,e,i,r,n,s]}set(t,e,i,r,n,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=Or,i=!1){const r=this.planes,n=t.elements,s=n[0],o=n[1],a=n[2],c=n[3],l=n[4],h=n[5],u=n[6],d=n[7],p=n[8],f=n[9],m=n[10],g=n[11],v=n[12],_=n[13],y=n[14],x=n[15];if(r[0].setComponents(c-s,d-l,g-p,x-v).normalize(),r[1].setComponents(c+s,d+l,g+p,x+v).normalize(),r[2].setComponents(c+o,d+h,g+f,x+_).normalize(),r[3].setComponents(c-o,d-h,g-f,x-_).normalize(),i)r[4].setComponents(a,u,m,y).normalize(),r[5].setComponents(c-a,d-u,g-m,x-y).normalize();else if(r[4].setComponents(c-a,d-u,g-m,x-y).normalize(),e===Or)r[5].setComponents(c+a,d+u,g+m,x+y).normalize();else{if(e!==Lr)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);r[5].setComponents(a,u,m,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),pc.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),pc.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(pc)}intersectsSprite(t){pc.center.set(0,0,0);const e=fc.distanceTo(t.center);return pc.radius=.7071067811865476+e,pc.applyMatrix4(t.matrixWorld),this.intersectsSphere(pc)}intersectsSphere(t){const e=this.planes,i=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const r=e[i];if(mc.x=r.normal.x>0?t.max.x:t.min.x,mc.y=r.normal.y>0?t.max.y:t.min.y,mc.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(mc)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const vc=new ps,_c=new gc;class yc{constructor(){this.coordinateSystem=Or}intersectsObject(t,e){if(!e.isArrayCamera||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const r=e.cameras[i];if(vc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_c.setFromProjectionMatrix(vc,r.coordinateSystem,r.reversedDepth),_c.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const r=e.cameras[i];if(vc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_c.setFromProjectionMatrix(vc,r.coordinateSystem,r.reversedDepth),_c.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const r=e.cameras[i];if(vc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_c.setFromProjectionMatrix(vc,r.coordinateSystem,r.reversedDepth),_c.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const r=e.cameras[i];if(vc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_c.setFromProjectionMatrix(vc,r.coordinateSystem,r.reversedDepth),_c.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let i=0;i<e.cameras.length;i++){const r=e.cameras[i];if(vc.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_c.setFromProjectionMatrix(vc,r.coordinateSystem,r.reversedDepth),_c.containsPoint(t))return!0}return!1}clone(){return new yc}}function xc(t,e){return t-e}function bc(t,e){return t.z-e.z}function Mc(t,e){return e.z-t.z}class Sc{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,i,r){const n=this.pool,s=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const o=n[this.index];s.push(o),this.index++,o.start=t,o.count=e,o.z=i,o.index=r}reset(){this.list.length=0,this.index=0}}const wc=new ps,Tc=new so(1,1,1),Cc=new gc,Ec=new yc,Pc=new Bn,Ac=new ns,Dc=new fn,kc=new fn,Rc=new fn,Ic=new Sc,Oc=new Yo,Lc=[];function Nc(t,e,i=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const n=t.count;for(let s=0;s<n;s++)for(let n=0;n<r;n++)e.setComponent(s+i,n,t.getComponent(s,n))}else e.array.set(t.array,i*r);e.needsUpdate=!0}function Fc(t,e){if(t.constructor!==e.constructor){const i=Math.min(t.length,e.length);for(let r=0;r<i;r++)e[r]=t[r]}else{const i=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,i))}}class Uc extends Yo{constructor(t,e,i=2*e,r){super(new No,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),i=new Ja(e,t,t,Oe,Te);this._matricesTexture=i}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),i=new Ja(e,t,t,Ue,we);this._indirectTexture=i}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),i=new Ja(e,t,t,Oe,Te);i.colorSpace=Mn.workingColorSpace,this._colorsTexture=i}_initializeGeometry(t){const e=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in t.attributes){const n=t.getAttribute(r),{array:s,itemSize:o,normalized:a}=n,c=new s.constructor(i*o),l=new yo(c,o,a);e.setAttribute(r,l)}if(null!==t.getIndex()){const t=i>65535?new Uint32Array(r):new Uint16Array(r);e.setIndex(new yo(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in e.attributes){if(!t.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=t.getAttribute(i),n=e.getAttribute(i);if(r.itemSize!==n.itemSize||r.normalized!==n.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Bn);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let i=0,r=e.length;i<r;i++){if(!1===e[i].active)continue;const r=e[i].geometryIndex;this.getMatrixAt(i,wc),this.getBoundingBoxAt(r,Pc).applyMatrix4(wc),t.union(Pc)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ns);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let i=0,r=e.length;i<r;i++){if(!1===e[i].active)continue;const r=e[i].geometryIndex;this.getMatrixAt(i,wc),this.getBoundingSphereAt(r,Ac).applyMatrix4(wc),t.union(Ac)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(xc),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=e):(i=this._instanceInfo.length,this._instanceInfo.push(e));const r=this._matricesTexture;wc.identity().toArray(r.image.data,16*i),r.needsUpdate=!0;const n=this._colorsTexture;return n&&(Tc.toArray(n.image.data,4*i),n.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(t,e=-1,i=-1){this._initializeGeometry(t),this._validateGeometry(t);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},n=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const s=t.getIndex();if(null!==s&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=-1===i?s.count:i),-1!==r.indexStart&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(xc),o=this._availableGeometryIds.shift(),n[o]=r):(o=this._geometryCount,this._geometryCount++,n.push(r)),this.setGeometryAt(o,t),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const i=this.geometry,r=null!==i.getIndex(),n=i.getIndex(),s=e.getIndex(),o=this._geometryInfo[t];if(r&&s.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const t in i.attributes){const r=e.getAttribute(t),n=i.getAttribute(t);Nc(r,n,a);const s=r.itemSize;for(let t=r.count,e=c;t<e;t++){const e=a+t;for(let t=0;t<s;t++)n.setComponent(e,t,0)}n.needsUpdate=!0,n.addUpdateRange(a*s,c*s)}if(r){const t=o.indexStart,i=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<s.count;e++)n.setX(t+e,a+s.getX(e));for(let e=s.count,r=i;e<r;e++)n.setX(t+e,a);n.needsUpdate=!0,n.addUpdateRange(t,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const i=this._instanceInfo;for(let e=0,r=i.length;e<r;e++)i[e].active&&i[e].geometryIndex===t&&this.deleteInstance(e);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const i=this._geometryInfo,r=i.map(((t,e)=>e)).sort(((t,e)=>i[t].vertexStart-i[e].vertexStart)),n=this.geometry;for(let s=0,o=i.length;s<o;s++){const o=r[s],a=i[o];if(!1!==a.active){if(null!==n.index){if(a.indexStart!==e){const{indexStart:i,vertexStart:r,reservedIndexCount:s}=a,o=n.index,c=o.array,l=t-r;for(let t=i;t<i+s;t++)c[t]=c[t]+l;o.array.copyWithin(e,i,i+s),o.addUpdateRange(e,s),o.needsUpdate=!0,a.indexStart=e}e+=a.reservedIndexCount}if(a.vertexStart!==t){const{vertexStart:e,reservedVertexCount:i}=a,r=n.attributes;for(const n in r){const s=r[n],{array:o,itemSize:a}=s;o.copyWithin(t*a,e*a,(e+i)*a),s.addUpdateRange(t*a,i*a),s.needsUpdate=!0}a.vertexStart=t}t+=a.reservedVertexCount,a.start=n.index?a.indexStart:a.vertexStart,this._nextIndexStart=n.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[t];if(null===r.boundingBox){const t=new Bn,e=i.index,n=i.attributes.position;for(let i=r.start,s=r.start+r.count;i<s;i++){let r=i;e&&(r=e.getX(r)),t.expandByPoint(Dc.fromBufferAttribute(n,r))}r.boundingBox=t}return e.copy(r.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[t];if(null===r.boundingSphere){const e=new ns;this.getBoundingBoxAt(t,Pc),Pc.getCenter(e.center);const n=i.index,s=i.attributes.position;let o=0;for(let t=r.start,i=r.start+r.count;t<i;t++){let i=t;n&&(i=n.getX(i)),Dc.fromBufferAttribute(s,i),o=Math.max(o,e.center.distanceToSquared(Dc))}e.radius=Math.sqrt(o),r.boundingSphere=e}return e.copy(r.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const i=this._matricesTexture,r=this._matricesTexture.image.data;return e.toArray(r,16*t),i.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,e={}){this.validateGeometryId(t);const i=this._geometryInfo[t];return e.vertexStart=i.vertexStart,e.vertexCount=i.vertexCount,e.reservedVertexCount=i.reservedVertexCount,e.indexStart=i.indexStart,e.indexCount=i.indexCount,e.reservedIndexCount=i.reservedIndexCount,e.start=i.start,e.count=i.count,e}setInstanceCount(t){const e=this._availableInstanceIds,i=this._instanceInfo;for(e.sort(xc);e[e.length-1]===i.length-1;)i.pop(),e.pop();if(t<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const r=new Int32Array(t),n=new Int32Array(t);Fc(this._multiDrawCounts,r),Fc(this._multiDrawStarts,n),this._multiDrawCounts=r,this._multiDrawStarts=n,this._maxInstanceCount=t;const s=this._indirectTexture,o=this._matricesTexture,a=this._colorsTexture;s.dispose(),this._initIndirectTexture(),Fc(s.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Fc(o.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),Fc(a.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const i=[...this._geometryInfo].filter((t=>t.active));if(Math.max(...i.map((t=>t.vertexStart+t.reservedVertexCount)))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map((t=>t.indexStart+t.reservedIndexCount)))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new No,this._initializeGeometry(r));const n=this.geometry;r.index&&Fc(r.index.array,n.index.array);for(const t in r.attributes)Fc(r.attributes[t].array,n.attributes[t].array)}raycast(t,e){const i=this._instanceInfo,r=this._geometryInfo,n=this.matrixWorld,s=this.geometry;Oc.material=this.material,Oc.geometry.index=s.index,Oc.geometry.attributes=s.attributes,null===Oc.geometry.boundingBox&&(Oc.geometry.boundingBox=new Bn),null===Oc.geometry.boundingSphere&&(Oc.geometry.boundingSphere=new ns);for(let s=0,o=i.length;s<o;s++){if(!i[s].visible||!i[s].active)continue;const o=i[s].geometryIndex,a=r[o];Oc.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(s,Oc.matrixWorld).premultiply(n),this.getBoundingBoxAt(o,Oc.geometry.boundingBox),this.getBoundingSphereAt(o,Oc.geometry.boundingSphere),Oc.raycast(t,Lc);for(let t=0,i=Lc.length;t<i;t++){const i=Lc[t];i.object=this,i.batchId=s,e.push(i)}Lc.length=0}Oc.material=null,Oc.geometry.index=null,Oc.geometry.attributes={},Oc.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map((t=>({...t,boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null}))),this._instanceInfo=t._instanceInfo.map((t=>({...t}))),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,i,r,n){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=r.getIndex(),o=null===s?1:s.array.BYTES_PER_ELEMENT,a=this._instanceInfo,c=this._multiDrawStarts,l=this._multiDrawCounts,h=this._geometryInfo,u=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data,f=i.isArrayCamera?Ec:Cc;u&&!i.isArrayCamera&&(wc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),Cc.setFromProjectionMatrix(wc,i.coordinateSystem,i.reversedDepth));let m=0;if(this.sortObjects){wc.copy(this.matrixWorld).invert(),Dc.setFromMatrixPosition(i.matrixWorld).applyMatrix4(wc),kc.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(wc);for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;this.getMatrixAt(t,wc),this.getBoundingSphereAt(e,Ac).applyMatrix4(wc);let r=!1;if(u&&(r=!f.intersectsSphere(Ac,i)),!r){const i=h[e],r=Rc.subVectors(Ac.center,Dc).dot(kc);Ic.push(i.start,i.count,r,t)}}const t=Ic.list,e=this.customSort;null===e?t.sort(n.transparent?Mc:bc):e.call(this,t,i);for(let e=0,i=t.length;e<i;e++){const i=t[e];c[m]=i.start*o,l[m]=i.count,p[m]=i.index,m++}Ic.reset()}else for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;let r=!1;if(u&&(this.getMatrixAt(t,wc),this.getBoundingSphereAt(e,Ac).applyMatrix4(wc),r=!f.intersectsSphere(Ac,i)),!r){const i=h[e];c[m]=i.start*o,l[m]=i.count,p[m]=t,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(t,e,i,r,n,s){this.onBeforeRender(t,null,r,n,s)}}class Wc extends co{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new so(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Bc=new fn,zc=new fn,Vc=new ps,Hc=new ds,Gc=new ns,jc=new fn,Xc=new fn;class qc extends Bs{constructor(t=new No,e=new Wc){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,r=e.count;t<r;t++)Bc.fromBufferAttribute(e,t-1),zc.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Bc.distanceTo(zc);t.setAttribute("lineDistance",new Po(i,1))}else Jr("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Gc.copy(i.boundingSphere),Gc.applyMatrix4(r),Gc.radius+=n,!1===t.ray.intersectsSphere(Gc))return;Vc.copy(r).invert(),Hc.copy(t.ray).applyMatrix4(Vc);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=this.isLineSegments?2:1,l=i.index,h=i.attributes.position;if(null!==l){const i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);for(let n=i,s=r-1;n<s;n+=c){const i=l.getX(n),r=l.getX(n+1),s=Yc(this,t,Hc,a,i,r,n);s&&e.push(s)}if(this.isLineLoop){const n=l.getX(r-1),s=l.getX(i),o=Yc(this,t,Hc,a,n,s,r-1);o&&e.push(o)}}else{const i=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);for(let n=i,s=r-1;n<s;n+=c){const i=Yc(this,t,Hc,a,n,n+1,n);i&&e.push(i)}if(this.isLineLoop){const n=Yc(this,t,Hc,a,r-1,i,r-1);n&&e.push(n)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Yc(t,e,i,r,n,s,o){const a=t.geometry.attributes.position;if(Bc.fromBufferAttribute(a,n),zc.fromBufferAttribute(a,s),i.distanceSqToSegment(Bc,zc,jc,Xc)>r)return;jc.applyMatrix4(t.matrixWorld);const c=e.ray.origin.distanceTo(jc);return c<e.near||c>e.far?void 0:{distance:c,point:Xc.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const Zc=new fn,Jc=new fn;class Kc extends qc{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,r=e.count;t<r;t+=2)Zc.fromBufferAttribute(e,t),Jc.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Zc.distanceTo(Jc);t.setAttribute("lineDistance",new Po(i,1))}else Jr("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $c extends qc{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Qc extends co{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new so(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const tl=new ps,el=new ds,il=new ns,rl=new fn;class nl extends Bs{constructor(t=new No,e=new Qc){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,n=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),il.copy(i.boundingSphere),il.applyMatrix4(r),il.radius+=n,!1===t.ray.intersectsSphere(il))return;tl.copy(r).invert(),el.copy(t.ray).applyMatrix4(tl);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=i.index,l=i.attributes.position;if(null!==c)for(let i=Math.max(0,s.start),n=Math.min(c.count,s.start+s.count);i<n;i++){const n=c.getX(i);rl.fromBufferAttribute(l,n),sl(rl,n,a,r,t,e,this)}else for(let i=Math.max(0,s.start),n=Math.min(l.count,s.start+s.count);i<n;i++)rl.fromBufferAttribute(l,i),sl(rl,i,a,r,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function sl(t,e,i,r,n,s,o){const a=el.distanceSqToPoint(t);if(a<i){const i=new fn;el.closestPointToPoint(t,i),i.applyMatrix4(r);const c=n.ray.origin.distanceTo(i);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class ol extends Rn{constructor(t,e,i,r,n=fe,s=fe,o,a,c){super(t,e,i,r,n,s,o,a,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const l=this;"requestVideoFrameCallback"in t&&(this._requestVideoFrameCallbackId=t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,l._requestVideoFrameCallbackId=t.requestVideoFrameCallback(e)})))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class al extends ol{constructor(t,e,i,r,n,s,o,a){super({},t,e,i,r,n,s,o,a),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class cl extends Rn{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=le,this.minFilter=le,this.generateMipmaps=!1,this.needsUpdate=!0}}class ll extends Rn{constructor(t,e,i,r,n,s,o,a,c,l,h,u){super(null,s,o,a,c,l,r,n,h,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class hl extends ll{constructor(t,e,i,r,n,s){super(t,e,i,n,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ae,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class ul extends ll{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,ee),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class dl extends Rn{constructor(t,e,i,r,n,s,o,a,c){super(t,e,i,r,n,s,o,a,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class pl extends Rn{constructor(t,e,i=we,r,n,s,o=le,a=le,c,l=Le,h=1){if(l!==Le&&l!==Ne)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:t,height:e,depth:h},r,n,s,o,a,l,i,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Pn(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class fl extends pl{constructor(t,e=we,i=ee,r,n,s=le,o=le,a,c=Le){const l={width:t,height:t,depth:1},h=[l,l,l,l,l,l];super(t,t,e,i,r,n,s,o,a,c),this.image=h,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(t){this.image=t}}class ml extends Rn{constructor(t=null){super(),this.sourceTexture=t,this.isExternalTexture=!0}copy(t){return super.copy(t),this.sourceTexture=t.sourceTexture,this}}class gl extends No{constructor(t=1,e=1,i=4,r=8,n=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:i,radialSegments:r,heightSegments:n},e=Math.max(0,e),i=Math.max(1,Math.floor(i)),r=Math.max(3,Math.floor(r)),n=Math.max(1,Math.floor(n));const s=[],o=[],a=[],c=[],l=e/2,h=Math.PI/2*t,u=e,d=2*h+u,p=2*i+n,f=r+1,m=new fn,g=new fn;for(let v=0;v<=p;v++){let _=0,y=0,x=0,b=0;if(v<=i){const e=v/i,r=e*Math.PI/2;y=-l-t*Math.cos(r),x=t*Math.sin(r),b=-t*Math.cos(r),_=e*h}else if(v<=i+n){const r=(v-i)/n;y=r*e-l,x=t,b=0,_=h+r*u}else{const e=(v-i-n)/i,r=e*Math.PI/2;y=l+t*Math.sin(r),x=t*Math.cos(r),b=t*Math.sin(r),_=h+u+e*h}const M=Math.max(0,Math.min(1,_/d));let S=0;0===v?S=.5/r:v===p&&(S=-.5/r);for(let t=0;t<=r;t++){const e=t/r,i=e*Math.PI*2,n=Math.sin(i),s=Math.cos(i);g.x=-x*s,g.y=y,g.z=x*n,o.push(g.x,g.y,g.z),m.set(-x*s,b,x*n),m.normalize(),a.push(m.x,m.y,m.z),c.push(e+S,M)}if(v>0){const t=(v-1)*f;for(let e=0;e<r;e++){const i=t+e,r=t+e+1,n=v*f+e,o=v*f+e+1;s.push(i,r,n),s.push(r,o,n)}}}this.setIndex(s),this.setAttribute("position",new Po(o,3)),this.setAttribute("normal",new Po(a,3)),this.setAttribute("uv",new Po(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new gl(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class vl extends No{constructor(t=1,e=32,i=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:r},e=Math.max(3,e);const n=[],s=[],o=[],a=[],c=new fn,l=new dn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let n=0,h=3;n<=e;n++,h+=3){const u=i+n/e*r;c.x=t*Math.cos(u),c.y=t*Math.sin(u),s.push(c.x,c.y,c.z),o.push(0,0,1),l.x=(s[h]/t+1)/2,l.y=(s[h+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)n.push(t,t+1,0);this.setIndex(n),this.setAttribute("position",new Po(s,3)),this.setAttribute("normal",new Po(o,3)),this.setAttribute("uv",new Po(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vl(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class _l extends No{constructor(t=1,e=1,i=1,r=32,n=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:a};const c=this;r=Math.floor(r),n=Math.floor(n);const l=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function v(i){const n=p,s=new dn,f=new fn;let v=0;const _=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=r;t++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=r;t++){const e=t/r*a+o,i=Math.cos(e),n=Math.sin(e);f.x=_*n,f.y=m*y,f.z=_*i,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*n*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=n+t,r=x+t;!0===i?l.push(r,r+1,e):l.push(r+1,r,e),v+=3}c.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new fn,v=new fn;let _=0;const y=(e-t)/i;for(let c=0;c<=n;c++){const l=[],g=c/n,_=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,n=e*a+o,c=Math.sin(n),f=Math.cos(n);v.x=_*c,v.y=-g*i+m,v.z=_*f,h.push(v.x,v.y,v.z),s.set(c,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),l.push(p++)}f.push(l)}for(let i=0;i<r;i++)for(let r=0;r<n;r++){const s=f[r][i],o=f[r+1][i],a=f[r+1][i+1],c=f[r][i+1];(t>0||0!==r)&&(l.push(s,o,c),_+=3),(e>0||r!==n-1)&&(l.push(o,a,c),_+=3)}c.addGroup(g,_,0),g+=_}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Po(h,3)),this.setAttribute("normal",new Po(u,3)),this.setAttribute("uv",new Po(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _l(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class yl extends _l{constructor(t=1,e=1,i=32,r=1,n=!1,s=0,o=2*Math.PI){super(0,t,e,i,r,n,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:o}}static fromJSON(t){return new yl(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class xl extends No{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};const n=[],s=[];function o(t,e,i,r){const n=r+1,s=[];for(let r=0;r<=n;r++){s[r]=[];const o=t.clone().lerp(i,r/n),a=e.clone().lerp(i,r/n),c=n-r;for(let t=0;t<=c;t++)s[r][t]=0===t&&r===n?o:o.clone().lerp(a,t/c)}for(let t=0;t<n;t++)for(let e=0;e<2*(n-t)-1;e++){const i=Math.floor(e/2);e%2==0?(a(s[t][i+1]),a(s[t+1][i]),a(s[t][i])):(a(s[t][i+1]),a(s[t+1][i+1]),a(s[t+1][i]))}}function a(t){n.push(t.x,t.y,t.z)}function c(e,i){const r=3*e;i.x=t[r+0],i.y=t[r+1],i.z=t[r+2]}function l(t,e,i,r){r<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=r/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new fn,r=new fn,n=new fn;for(let s=0;s<e.length;s+=3)c(e[s+0],i),c(e[s+1],r),c(e[s+2],n),o(i,r,n,t)}(r),function(t){const e=new fn;for(let i=0;i<n.length;i+=3)e.x=n[i+0],e.y=n[i+1],e.z=n[i+2],e.normalize().multiplyScalar(t),n[i+0]=e.x,n[i+1]=e.y,n[i+2]=e.z}(i),function(){const t=new fn;for(let i=0;i<n.length;i+=3){t.x=n[i+0],t.y=n[i+1],t.z=n[i+2];const r=h(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new fn,e=new fn,i=new fn,r=new fn,o=new dn,a=new dn,c=new dn;for(let u=0,d=0;u<n.length;u+=9,d+=6){t.set(n[u+0],n[u+1],n[u+2]),e.set(n[u+3],n[u+4],n[u+5]),i.set(n[u+6],n[u+7],n[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),c.set(s[d+4],s[d+5]),r.copy(t).add(e).add(i).divideScalar(3);const p=h(r);l(o,d+0,t,p),l(a,d+2,e,p),l(c,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],r=s[t+4],n=Math.max(e,i,r),o=Math.min(e,i,r);n>.9&&o<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Po(n,3)),this.setAttribute("normal",new Po(n.slice(),3)),this.setAttribute("uv",new Po(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xl(t.vertices,t.indices,t.radius,t.detail)}}class bl extends xl{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,r=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new bl(t.radius,t.detail)}}const Ml=new fn,Sl=new fn,wl=new fn,Tl=new to;class Cl extends No{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,r=Math.pow(10,i),n=Math.cos(rn*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,c=[0,0,0],l=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(c[0]=s.getX(t),c[1]=s.getX(t+1),c[2]=s.getX(t+2)):(c[0]=t,c[1]=t+1,c[2]=t+2);const{a:e,b:i,c:a}=Tl;if(e.fromBufferAttribute(o,c[0]),i.fromBufferAttribute(o,c[1]),a.fromBufferAttribute(o,c[2]),Tl.getNormal(wl),h[0]=`${Math.round(e.x*r)},${Math.round(e.y*r)},${Math.round(e.z*r)}`,h[1]=`${Math.round(i.x*r)},${Math.round(i.y*r)},${Math.round(i.z*r)}`,h[2]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],r=h[e],s=Tl[l[t]],o=Tl[l[e]],a=`${i}_${r}`,p=`${r}_${i}`;p in u&&u[p]?(wl.dot(u[p].normal)<=n&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:c[t],index1:c[e],normal:wl.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];Ml.fromBufferAttribute(o,e),Sl.fromBufferAttribute(o,i),d.push(Ml.x,Ml.y,Ml.z),d.push(Sl.x,Sl.y,Sl.z)}this.setAttribute("position",new Po(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class El{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Jr("Curve: .getPoint() not implemented.")}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,r=this.getPoint(0),n=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),n+=i.distanceTo(r),e.push(n),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const i=this.getLengths();let r=0;const n=i.length;let s;s=e||t*i[n-1];let o,a=0,c=n-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),o=i[r]-s,o<0)a=r+1;else{if(!(o>0)){c=r;break}c=r-1}if(r=c,i[r]===s)return r/(n-1);const l=i[r];return(r+(s-l)/(i[r+1]-l))/(n-1)}getTangent(t,e){const i=1e-4;let r=t-i,n=t+i;r<0&&(r=0),n>1&&(n=1);const s=this.getPoint(r),o=this.getPoint(n),a=e||(s.isVector2?new dn:new fn);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e=!1){const i=new fn,r=[],n=[],s=[],o=new fn,a=new ps;for(let e=0;e<=t;e++){const i=e/t;r[e]=this.getTangentAt(i,new fn)}n[0]=new fn,s[0]=new fn;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),h=Math.abs(r[0].y),u=Math.abs(r[0].z);l<=c&&(c=l,i.set(1,0,0)),h<=c&&(c=h,i.set(0,1,0)),u<=c&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],o),s[0].crossVectors(r[0],n[0]);for(let e=1;e<=t;e++){if(n[e]=n[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(on(r[e-1].dot(r[e]),-1,1));n[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],n[e])}if(!0===e){let e=Math.acos(on(n[0].dot(n[t]),-1,1));e/=t,r[0].dot(o.crossVectors(n[0],n[t]))>0&&(e=-e);for(let i=1;i<=t;i++)n[i].applyMatrix4(a.makeRotationAxis(r[i],e*i)),s[i].crossVectors(r[i],n[i])}return{tangents:r,normals:n,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Pl extends El{constructor(t=0,e=0,i=1,r=1,n=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new dn){const i=e,r=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=s?0:r),!0!==this.aClockwise||s||(n===r?n=-r:n-=r);const o=this.aStartAngle+t*n;let a=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,r=c-this.aY;a=i*t-r*e+this.aX,c=i*e+r*t+this.aY}return i.set(a,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Al extends Pl{constructor(t,e,i,r,n,s){super(t,e,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Dl(){let t=0,e=0,i=0,r=0;function n(n,s,o,a){t=n,e=o,i=-3*n+3*s-2*o-a,r=2*n-2*s+o+a}return{initCatmullRom:function(t,e,i,r,s){n(e,i,s*(i-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,i,r,s,o,a){let c=(e-t)/s-(i-t)/(s+o)+(i-e)/o,l=(i-e)/o-(r-e)/(o+a)+(r-i)/a;c*=o,l*=o,n(e,i,c,l)},calc:function(n){const s=n*n;return t+e*n+i*s+r*(s*n)}}}const kl=new fn,Rl=new Dl,Il=new Dl,Ol=new Dl;class Ll extends El{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new fn){const i=e,r=this.points,n=r.length,s=(n-(this.closed?0:1))*t;let o,a,c=Math.floor(s),l=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/n)+1)*n:0===l&&c===n-1&&(c=n-2,l=1),this.closed||c>0?o=r[(c-1)%n]:(kl.subVectors(r[0],r[1]).add(r[0]),o=kl);const h=r[c%n],u=r[(c+1)%n];if(this.closed||c+2<n?a=r[(c+2)%n]:(kl.subVectors(r[n-1],r[n-2]).add(r[n-1]),a=kl),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),r=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),r<1e-4&&(r=i),Rl.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,r),Il.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,r),Ol.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,r)}else"catmullrom"===this.curveType&&(Rl.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),Il.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),Ol.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(Rl.calc(l),Il.calc(l),Ol.calc(l)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new fn).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Nl(t,e,i,r,n){const s=.5*(r-e),o=.5*(n-i),a=t*t;return(2*i-2*r+s+o)*(t*a)+(-3*i+3*r-2*s-o)*a+s*t+i}function Fl(t,e,i,r){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,r)}function Ul(t,e,i,r,n){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,n)}class Wl extends El{constructor(t=new dn,e=new dn,i=new dn,r=new dn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new dn){const i=e,r=this.v0,n=this.v1,s=this.v2,o=this.v3;return i.set(Ul(t,r.x,n.x,s.x,o.x),Ul(t,r.y,n.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Bl extends El{constructor(t=new fn,e=new fn,i=new fn,r=new fn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new fn){const i=e,r=this.v0,n=this.v1,s=this.v2,o=this.v3;return i.set(Ul(t,r.x,n.x,s.x,o.x),Ul(t,r.y,n.y,s.y,o.y),Ul(t,r.z,n.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class zl extends El{constructor(t=new dn,e=new dn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new dn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new dn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Vl extends El{constructor(t=new fn,e=new fn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new fn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new fn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Hl extends El{constructor(t=new dn,e=new dn,i=new dn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new dn){const i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(Fl(t,r.x,n.x,s.x),Fl(t,r.y,n.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Gl extends El{constructor(t=new fn,e=new fn,i=new fn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new fn){const i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(Fl(t,r.x,n.x,s.x),Fl(t,r.y,n.y,s.y),Fl(t,r.z,n.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class jl extends El{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new dn){const i=e,r=this.points,n=(r.length-1)*t,s=Math.floor(n),o=n-s,a=r[0===s?s:s-1],c=r[s],l=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return i.set(Nl(o,a.x,c.x,l.x,h.x),Nl(o,a.y,c.y,l.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new dn).fromArray(i))}return this}}var Xl=Object.freeze({__proto__:null,ArcCurve:Al,CatmullRomCurve3:Ll,CubicBezierCurve:Wl,CubicBezierCurve3:Bl,EllipseCurve:Pl,LineCurve:zl,LineCurve3:Vl,QuadraticBezierCurve:Hl,QuadraticBezierCurve3:Gl,SplineCurve:jl});class ql extends El{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const i=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Xl[i](e,t))}return this}getPoint(t,e){const i=t*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=i){const t=r[n]-i,s=this.curves[n],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let r=0,n=this.curves;r<n.length;r++){const s=n[r],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];i&&i.equals(r)||(e.push(r),i=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Xl[i.type]).fromJSON(i))}return this}}class Yl extends ql{constructor(t){super(),this.type="Path",this.currentPoint=new dn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new zl(this.currentPoint.clone(),new dn(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){const n=new Hl(this.currentPoint.clone(),new dn(t,e),new dn(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,n,s){const o=new Wl(this.currentPoint.clone(),new dn(t,e),new dn(i,r),new dn(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new jl(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,n,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,r,n,s),this}absarc(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this}ellipse(t,e,i,r,n,s,o,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,i,r,n,s,o,a),this}absellipse(t,e,i,r,n,s,o,a){const c=new Pl(t,e,i,r,n,s,o,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Zl extends Yl{constructor(t){super(t),this.uuid=sn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Yl).fromJSON(i))}return this}}function Jl(t,e,i,r,n){let s;if(n===function(t,e,i,r){let n=0;for(let s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}(t,e,i,r)>0)for(let n=e;n<i;n+=r)s=_h(n/r|0,t[n],t[n+1],s);else for(let n=i-r;n>=e;n-=r)s=_h(n/r|0,t[n],t[n+1],s);return s&&dh(s,s.next)&&(yh(s),s=s.next),s}function Kl(t,e){if(!t)return t;e||(e=t);let i,r=t;do{if(i=!1,r.steiner||!dh(r,r.next)&&0!==uh(r.prev,r,r.next))r=r.next;else{if(yh(r),r=e=r.prev,r===r.next)break;i=!0}}while(i||r!==e);return e}function $l(t,e,i,r,n,s,o){if(!t)return;!o&&s&&function(t,e,i,r){let n=t;do{0===n.z&&(n.z=oh(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,i=1;do{let r,n=t;t=null;let s=null;for(e=0;n;){e++;let o=n,a=0;for(let t=0;t<i&&(a++,o=o.nextZ,o);t++);let c=i;for(;a>0||c>0&&o;)0!==a&&(0===c||!o||n.z<=o.z)?(r=n,n=n.nextZ,a--):(r=o,o=o.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=o}s.nextZ=null,i*=2}while(e>1)}(n)}(t,r,n,s);let a=t;for(;t.prev!==t.next;){const c=t.prev,l=t.next;if(s?th(t,r,n,s):Ql(t))e.push(c.i,t.i,l.i),yh(t),t=l.next,a=l.next;else if((t=l)===a){o?1===o?$l(t=eh(Kl(t),e),e,i,r,n,s,2):2===o&&ih(t,e,i,r,n,s):$l(Kl(t),e,i,r,n,s,1);break}}}function Ql(t){const e=t.prev,i=t,r=t.next;if(uh(e,i,r)>=0)return!1;const n=e.x,s=i.x,o=r.x,a=e.y,c=i.y,l=r.y,h=Math.min(n,s,o),u=Math.min(a,c,l),d=Math.max(n,s,o),p=Math.max(a,c,l);let f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&lh(n,a,s,c,o,l,f.x,f.y)&&uh(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function th(t,e,i,r){const n=t.prev,s=t,o=t.next;if(uh(n,s,o)>=0)return!1;const a=n.x,c=s.x,l=o.x,h=n.y,u=s.y,d=o.y,p=Math.min(a,c,l),f=Math.min(h,u,d),m=Math.max(a,c,l),g=Math.max(h,u,d),v=oh(p,f,e,i,r),_=oh(m,g,e,i,r);let y=t.prevZ,x=t.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&lh(a,h,c,u,l,d,y.x,y.y)&&uh(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&lh(a,h,c,u,l,d,x.x,x.y)&&uh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&lh(a,h,c,u,l,d,y.x,y.y)&&uh(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&lh(a,h,c,u,l,d,x.x,x.y)&&uh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function eh(t,e){let i=t;do{const r=i.prev,n=i.next.next;!dh(r,n)&&ph(r,i,i.next,n)&&gh(r,n)&&gh(n,r)&&(e.push(r.i,i.i,n.i),yh(i),yh(i.next),i=t=n),i=i.next}while(i!==t);return Kl(i)}function ih(t,e,i,r,n,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&hh(o,t)){let a=vh(o,t);return o=Kl(o,o.next),a=Kl(a,a.next),$l(o,e,i,r,n,s,0),void $l(a,e,i,r,n,s,0)}t=t.next}o=o.next}while(o!==t)}function rh(t,e){let i=t.x-e.x;return 0===i&&(i=t.y-e.y,0===i)&&(i=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function nh(t,e){const i=function(t,e){let i=e;const r=t.x,n=t.y;let s,o=-1/0;if(dh(t,i))return i;do{if(dh(t,i.next))return i.next;if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const t=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=r&&t>o&&(o=t,s=i.x<i.next.x?i:i.next,t===r))return s}i=i.next}while(i!==e);if(!s)return null;const a=s,c=s.x,l=s.y;let h=1/0;i=s;do{if(r>=i.x&&i.x>=c&&r!==i.x&&ch(n<l?r:o,n,c,l,n<l?o:r,n,i.x,i.y)){const e=Math.abs(n-i.y)/(r-i.x);gh(i,t)&&(e<h||e===h&&(i.x>s.x||i.x===s.x&&sh(s,i)))&&(s=i,h=e)}i=i.next}while(i!==a);return s}(t,e);if(!i)return e;const r=vh(i,t);return Kl(r,r.next),Kl(i,i.next)}function sh(t,e){return uh(t.prev,t,e.prev)<0&&uh(e.next,t,t.next)<0}function oh(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ah(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ch(t,e,i,r,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(n-o)*(r-a)}function lh(t,e,i,r,n,s,o,a){return!(t===o&&e===a)&&ch(t,e,i,r,n,s,o,a)}function hh(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ph(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(gh(t,e)&&gh(e,t)&&function(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(uh(t.prev,t,e.prev)||uh(t,e.prev,e))||dh(t,e)&&uh(t.prev,t,t.next)>0&&uh(e.prev,e,e.next)>0)}function uh(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function dh(t,e){return t.x===e.x&&t.y===e.y}function ph(t,e,i,r){const n=mh(uh(t,e,i)),s=mh(uh(t,e,r)),o=mh(uh(i,r,t)),a=mh(uh(i,r,e));return n!==s&&o!==a||!(0!==n||!fh(t,i,e))||!(0!==s||!fh(t,r,e))||!(0!==o||!fh(i,t,r))||!(0!==a||!fh(i,e,r))}function fh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function mh(t){return t>0?1:t<0?-1:0}function gh(t,e){return uh(t.prev,t,t.next)<0?uh(t,e,t.next)>=0&&uh(t,t.prev,e)>=0:uh(t,e,t.prev)<0||uh(t,t.next,e)<0}function vh(t,e){const i=xh(t.i,t.x,t.y),r=xh(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function _h(t,e,i,r){const n=xh(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function yh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function xh(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class bh{static triangulate(t,e,i=2){return function(t,e,i=2){const r=e&&e.length,n=r?e[0]*i:t.length;let s=Jl(t,0,n,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l;if(r&&(s=function(t,e,i,r){const n=[];for(let i=0,s=e.length;i<s;i++){const o=Jl(t,e[i]*r,i<s-1?e[i+1]*r:t.length,r,!1);o===o.next&&(o.steiner=!0),n.push(ah(o))}n.sort(rh);for(let t=0;t<n.length;t++)i=nh(n[t],i);return i}(t,e,s,i)),t.length>80*i){a=t[0],c=t[1];let e=a,r=c;for(let s=i;s<n;s+=i){const i=t[s],n=t[s+1];i<a&&(a=i),n<c&&(c=n),i>e&&(e=i),n>r&&(r=n)}l=Math.max(e-a,r-c),l=0!==l?32767/l:0}return $l(s,o,i,a,c,l,0),o}(t,e,i)}}class Mh{static area(t){const e=t.length;let i=0;for(let r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return.5*i}static isClockWise(t){return Mh.area(t)<0}static triangulateShape(t,e){const i=[],r=[],n=[];Sh(t),wh(i,t);let s=t.length;e.forEach(Sh);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,wh(i,e[t]);const o=bh.triangulate(i,r);for(let t=0;t<o.length;t+=3)n.push(o.slice(t,t+3));return n}}function Sh(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function wh(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Th extends No{constructor(t=new Zl([new dn(.5,.5),new dn(-.5,.5),new dn(-.5,-.5),new dn(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,r=[],n=[];for(let e=0,i=t.length;e<i;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,c=void 0!==e.depth?e.depth:1;let l=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Ch;let g,v,_,y,x,b=!1;if(f){g=f.getSpacedPoints(a),b=!0,l=!1;const t=!!f.isCatmullRomCurve3&&f.closed;v=f.computeFrenetFrames(a,t),_=new fn,y=new fn,x=new fn}l||(p=0,h=0,u=0,d=0);const M=t.extractPoints(o);let S=M.shape;const w=M.holes;if(!Mh.isClockWise(S)){S=S.reverse();for(let t=0,e=w.length;t<e;t++){const e=w[t];Mh.isClockWise(e)&&(w[t]=e.reverse())}}function T(t){const e=1e-10*1e-10;let i=t[0];for(let r=1;r<=t.length;r++){const n=r%t.length,s=t[n],o=s.x-i.x,a=s.y-i.y,c=o*o+a*a,l=Math.max(Math.abs(s.x),Math.abs(s.y),Math.abs(i.x),Math.abs(i.y));c<=e*l*l?(t.splice(n,1),r--):i=s}}T(S),w.forEach(T);const C=w.length,E=S;for(let t=0;t<C;t++){const e=w[t];S=S.concat(e)}function P(t,e,i){return e||Kr("ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,i)}const A=S.length;function D(t,e,i){let r,n,s;const o=t.x-e.x,a=t.y-e.y,c=i.x-t.x,l=i.y-t.y,h=o*o+a*a,u=o*l-a*c;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(c*c+l*l),p=e.x-a/u,f=e.y+o/u,m=((i.x-l/d-p)*l-(i.y+c/d-f)*c)/(o*l-a*c);r=p+o*m-t.x,n=f+a*m-t.y;const g=r*r+n*n;if(g<=2)return new dn(r,n);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?c>Number.EPSILON&&(t=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(r=-a,n=o,s=Math.sqrt(h)):(r=o,n=a,s=Math.sqrt(h/2))}return new dn(r/s,n/s)}const k=[];for(let t=0,e=E.length,i=e-1,r=t+1;t<e;t++,i++,r++)i===e&&(i=0),r===e&&(r=0),k[t]=D(E[t],E[i],E[r]);const R=[];let I,O,L=k.concat();for(let t=0,e=C;t<e;t++){const e=w[t];I=[];for(let t=0,i=e.length,r=i-1,n=t+1;t<i;t++,r++,n++)r===i&&(r=0),n===i&&(n=0),I[t]=D(e[t],e[r],e[n]);R.push(I),L=L.concat(I)}if(0===p)O=Mh.triangulateShape(E,w);else{const t=[],e=[];for(let i=0;i<p;i++){const r=i/p,n=h*Math.cos(r*Math.PI/2),s=u*Math.sin(r*Math.PI/2)+d;for(let e=0,i=E.length;e<i;e++){const i=P(E[e],k[e],s);W(i.x,i.y,-n),0===r&&t.push(i)}for(let t=0,i=C;t<i;t++){const i=w[t];I=R[t];const o=[];for(let t=0,e=i.length;t<e;t++){const e=P(i[t],I[t],s);W(e.x,e.y,-n),0===r&&o.push(e)}0===r&&e.push(o)}}O=Mh.triangulateShape(t,e)}const N=O.length,F=u+d;for(let t=0;t<A;t++){const e=l?P(S[t],L[t],F):S[t];b?(y.copy(v.normals[0]).multiplyScalar(e.x),_.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(y).add(_),W(x.x,x.y,x.z)):W(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<A;e++){const i=l?P(S[e],L[e],F):S[e];b?(y.copy(v.normals[t]).multiplyScalar(i.x),_.copy(v.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(y).add(_),W(x.x,x.y,x.z)):W(i.x,i.y,c/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),r=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=P(E[t],k[t],r);W(e.x,e.y,c+i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];I=R[t];for(let t=0,n=e.length;t<n;t++){const n=P(e[t],I[t],r);b?W(n.x,n.y+g[a-1].y,g[a-1].x+i):W(n.x,n.y,c+i)}}}function U(t,e){let i=t.length;for(;--i>=0;){const r=i;let n=i-1;n<0&&(n=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=A*t,s=A*(t+1);z(e+r+i,e+n+i,e+n+s,e+r+s)}}}function W(t,e,i){s.push(t),s.push(e),s.push(i)}function B(t,e,n){V(t),V(e),V(n);const s=r.length/3,o=m.generateTopUV(i,r,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[2])}function z(t,e,n,s){V(t),V(e),V(s),V(e),V(n),V(s);const o=r.length/3,a=m.generateSideWallUV(i,r,o-6,o-3,o-2,o-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function V(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function H(t){n.push(t.x),n.push(t.y)}!function(){const t=r.length/3;if(l){let t=0,e=A*t;for(let t=0;t<N;t++){const i=O[t];B(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=A*t;for(let t=0;t<N;t++){const i=O[t];B(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<N;t++){const e=O[t];B(e[2],e[1],e[0])}for(let t=0;t<N;t++){const e=O[t];B(e[0]+A*a,e[1]+A*a,e[2]+A*a)}}i.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;U(E,e),e+=E.length;for(let t=0,i=w.length;t<i;t++){const i=w[t];U(i,e),e+=i.length}i.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Po(r,3)),this.setAttribute("uv",new Po(n,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];i.shapes.push(r.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let r=0,n=t.shapes.length;r<n;r++){const n=e[t.shapes[r]];i.push(n)}const r=t.options.extrudePath;return void 0!==r&&(t.options.extrudePath=(new Xl[r.type]).fromJSON(r)),new Th(i,t.options)}}const Ch={generateTopUV:function(t,e,i,r,n){const s=e[3*i],o=e[3*i+1],a=e[3*r],c=e[3*r+1],l=e[3*n],h=e[3*n+1];return[new dn(s,o),new dn(a,c),new dn(l,h)]},generateSideWallUV:function(t,e,i,r,n,s){const o=e[3*i],a=e[3*i+1],c=e[3*i+2],l=e[3*r],h=e[3*r+1],u=e[3*r+2],d=e[3*n],p=e[3*n+1],f=e[3*n+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-l)?[new dn(o,1-c),new dn(l,1-u),new dn(d,1-f),new dn(m,1-v)]:[new dn(a,1-c),new dn(h,1-u),new dn(p,1-f),new dn(g,1-v)]}};class Eh extends xl{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Eh(t.radius,t.detail)}}class Ph extends No{constructor(t=[new dn(0,-.5),new dn(.5,0),new dn(0,.5)],e=12,i=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=on(r,0,2*Math.PI);const n=[],s=[],o=[],a=[],c=[],l=1/e,h=new fn,u=new dn,d=new fn,p=new fn,f=new fn;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case t.length-1:a.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let n=0;n<=e;n++){const d=i+n*l*r,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*f,s.push(h.x,h.y,h.z),u.x=n/e,u.y=i/(t.length-1),o.push(u.x,u.y);const r=a[3*i+0]*p,l=a[3*i+1],d=a[3*i+0]*f;c.push(r,l,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const r=e+i*t.length,s=r,o=r+t.length,a=r+t.length+1,c=r+1;n.push(s,o,c),n.push(a,c,o)}this.setIndex(n),this.setAttribute("position",new Po(s,3)),this.setAttribute("uv",new Po(o,2)),this.setAttribute("normal",new Po(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ph(t.points,t.segments,t.phiStart,t.phiLength)}}class Ah extends xl{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ah(t.radius,t.detail)}}class Dh extends No{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};const n=t/2,s=e/2,o=Math.floor(i),a=Math.floor(r),c=o+1,l=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<l;t++){const e=t*u-s;for(let i=0;i<c;i++){const r=i*h-n;p.push(r,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+c*t,r=e+c*(t+1),n=e+1+c*(t+1),s=e+1+c*t;d.push(i,r,s),d.push(r,n,s)}this.setIndex(d),this.setAttribute("position",new Po(p,3)),this.setAttribute("normal",new Po(f,3)),this.setAttribute("uv",new Po(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Dh(t.width,t.height,t.widthSegments,t.heightSegments)}}class kh extends No{constructor(t=.5,e=1,i=32,r=1,n=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:s},i=Math.max(3,i);const o=[],a=[],c=[],l=[];let h=t;const u=(e-t)/(r=Math.max(1,r)),d=new fn,p=new dn;for(let t=0;t<=r;t++){for(let t=0;t<=i;t++){const r=n+t/i*s;d.x=h*Math.cos(r),d.y=h*Math.sin(r),a.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,l.push(p.x,p.y)}h+=u}for(let t=0;t<r;t++){const e=t*(i+1);for(let t=0;t<i;t++){const r=t+e,n=r,s=r+i+1,a=r+i+2,c=r+1;o.push(n,s,c),o.push(s,a,c)}}this.setIndex(o),this.setAttribute("position",new Po(a,3)),this.setAttribute("normal",new Po(c,3)),this.setAttribute("uv",new Po(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new kh(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Rh extends No{constructor(t=new Zl([new dn(0,.5),new dn(-.5,-.5),new dn(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],r=[],n=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(o,a,e),o+=a,a=0;function c(t){const o=r.length/3,c=t.extractPoints(e);let l=c.shape;const h=c.holes;!1===Mh.isClockWise(l)&&(l=l.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===Mh.isClockWise(e)&&(h[t]=e.reverse())}const u=Mh.triangulateShape(l,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];r.push(e.x,e.y,0),n.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],r=e[0]+o,n=e[1]+o,s=e[2]+o;i.push(r,n,s),a+=3}}this.setIndex(i),this.setAttribute("position",new Po(r,3)),this.setAttribute("normal",new Po(n,3)),this.setAttribute("uv",new Po(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const r=t[i];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let r=0,n=t.shapes.length;r<n;r++){const n=e[t.shapes[r]];i.push(n)}return new Rh(i,t.curveSegments)}}class Ih extends No{constructor(t=1,e=32,i=16,r=0,n=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let c=0;const l=[],h=new fn,u=new fn,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let _=0;0===d&&0===s?_=.5/e:d===i&&a===Math.PI&&(_=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(r+a*n)*Math.sin(s+v*o),h.y=t*Math.cos(s+v*o),h.z=t*Math.sin(r+a*n)*Math.sin(s+v*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+_,1-v),g.push(c++)}l.push(g)}for(let t=0;t<i;t++)for(let r=0;r<e;r++){const e=l[t][r+1],n=l[t][r],o=l[t+1][r],c=l[t+1][r+1];(0!==t||s>0)&&d.push(e,n,c),(t!==i-1||a<Math.PI)&&d.push(n,o,c)}this.setIndex(d),this.setAttribute("position",new Po(p,3)),this.setAttribute("normal",new Po(f,3)),this.setAttribute("uv",new Po(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ih(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Oh extends xl{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Oh(t.radius,t.detail)}}class Lh extends No{constructor(t=1,e=.4,i=12,r=48,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);const s=[],o=[],a=[],c=[],l=new fn,h=new fn,u=new fn;for(let s=0;s<=i;s++)for(let d=0;d<=r;d++){const p=d/r*n,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),o.push(h.x,h.y,h.z),l.x=t*Math.cos(p),l.y=t*Math.sin(p),u.subVectors(h,l).normalize(),a.push(u.x,u.y,u.z),c.push(d/r),c.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=r;e++){const i=(r+1)*t+e-1,n=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(i,n,a),s.push(n,o,a)}this.setIndex(s),this.setAttribute("position",new Po(o,3)),this.setAttribute("normal",new Po(a,3)),this.setAttribute("uv",new Po(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Lh(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Nh extends No{constructor(t=1,e=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],c=[],l=[],h=new fn,u=new fn,d=new fn,p=new fn,f=new fn,m=new fn,g=new fn;for(let o=0;o<=i;++o){const _=o/i*n*Math.PI*2;v(_,n,s,t,d),v(_+.01,n,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=r;++t){const n=t/r*Math.PI*2,s=-e*Math.cos(n),p=e*Math.sin(n);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),c.push(u.x,u.y,u.z),l.push(o/i),l.push(t/r)}}for(let t=1;t<=i;t++)for(let e=1;e<=r;e++){const i=(r+1)*(t-1)+(e-1),n=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(i,n,a),o.push(n,s,a)}function v(t,e,i,r,n){const s=Math.cos(t),o=Math.sin(t),a=i/e*t,c=Math.cos(a);n.x=r*(2+c)*.5*s,n.y=r*(2+c)*o*.5,n.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Po(a,3)),this.setAttribute("normal",new Po(c,3)),this.setAttribute("uv",new Po(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Nh(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Fh extends No{constructor(t=new Gl(new fn(-1,-1,0),new fn(-1,1,0),new fn(1,1,0)),e=64,i=1,r=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:r,closed:n};const s=t.computeFrenetFrames(e,n);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new fn,a=new fn,c=new dn;let l=new fn;const h=[],u=[],d=[],p=[];function f(n){l=t.getPointAt(n/e,l);const c=s.normals[n],d=s.binormals[n];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,n=Math.sin(e),s=-Math.cos(e);a.x=s*c.x+n*d.x,a.y=s*c.y+n*d.y,a.z=s*c.z+n*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=l.x+i*a.x,o.y=l.y+i*a.y,o.z=l.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===n?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=r;i++)c.x=t/e,c.y=i/r,d.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const i=(r+1)*(t-1)+(e-1),n=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(i,n,o),p.push(n,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Po(h,3)),this.setAttribute("normal",new Po(u,3)),this.setAttribute("uv",new Po(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Fh((new Xl[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Uh extends No{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,r=new fn,n=new fn;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,c=a.length;t<c;++t){const c=a[t],l=c.start;for(let t=l,a=l+c.count;t<a;t+=3)for(let a=0;a<3;a++){const c=o.getX(t+a),l=o.getX(t+(a+1)%3);r.fromBufferAttribute(s,c),n.fromBufferAttribute(s,l),!0===Wh(r,n,i)&&(e.push(r.x,r.y,r.z),e.push(n.x,n.y,n.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,c=3*t+(o+1)%3;r.fromBufferAttribute(s,a),n.fromBufferAttribute(s,c),!0===Wh(r,n,i)&&(e.push(r.x,r.y,r.z),e.push(n.x,n.y,n.z))}}this.setAttribute("position",new Po(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Wh(t,e,i){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(r)&&!0!==i.has(n)&&(i.add(r),i.add(n),!0)}var Bh=Object.freeze({__proto__:null,BoxGeometry:Jo,CapsuleGeometry:gl,CircleGeometry:vl,ConeGeometry:yl,CylinderGeometry:_l,DodecahedronGeometry:bl,EdgesGeometry:Cl,ExtrudeGeometry:Th,IcosahedronGeometry:Eh,LatheGeometry:Ph,OctahedronGeometry:Ah,PlaneGeometry:Dh,PolyhedronGeometry:xl,RingGeometry:kh,ShapeGeometry:Rh,SphereGeometry:Ih,TetrahedronGeometry:Oh,TorusGeometry:Lh,TorusKnotGeometry:Nh,TubeGeometry:Fh,WireframeGeometry:Uh});class zh extends co{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new so(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Vh extends ea{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Hh extends co{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new so(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new so(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ss,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Gh extends Hh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return on(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new so(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new so(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new so(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class jh extends co{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new so(16777215),this.specular=new so(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new so(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ss,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Xh extends co{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new so(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new so(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class qh extends co{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Yh extends co{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new so(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new so(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ss,this.combine=zt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Zh extends co{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Wi,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Jh extends co{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class Kh extends co{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new so(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this.fog=t.fog,this}}class $h extends Wc{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Qh(t,e){return t&&t.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function tu(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function eu(t,e,i){const r=t.length,n=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=i[s]*e;for(let i=0;i!==e;++i)n[o++]=t[r+i]}return n}function iu(t,e,i,r){let n=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[n++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),i.push(...o)),s=t[n++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(i,i.length)),s=t[n++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),i.push(o)),s=t[n++]}while(void 0!==s)}class ru{static convertArray(t,e){return Qh(t,e)}static isTypedArray(t){return Vr(t)}static getKeyframeOrder(t){return tu(t)}static sortedArray(t,e,i){return eu(t,e,i)}static flattenJSON(t,e,i,r){iu(t,e,i,r)}static subclip(t,e,i,r,n=30){return function(t,e,i,r,n=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*n;if(!(s<i||s>=r)){c.push(e.times[t]);for(let i=0;i<a;++i)l.push(e.values[t*a+i])}}0!==c.length&&(e.times=Qh(c,e.times.constructor),e.values=Qh(l,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s}(t,e,i,r,n)}static makeClipAdditive(t,e=0,i=t,r=30){return function(t,e=0,i=t,r=30){r<=0&&(r=30);const n=i.tracks.length,s=e/r;for(let e=0;e<n;++e){const r=i.tracks[e],n=r.ValueTypeName;if("bool"===n||"string"===n)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===n}));if(void 0===o)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);const u=r.times.length-1;let d;if(s<=r.times[0]){const t=a,e=c-a;d=r.values.slice(t,e)}else if(s>=r.times[u]){const t=u*c+a,e=t+c-a;d=r.values.slice(t,e)}else{const t=r.createInterpolant(),e=a,i=c-a;t.evaluate(s),d=t.resultBuffer.slice(e,i)}"quaternion"===n&&(new pn).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+l;if("quaternion"===n)pn.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*l;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=Li,t}(t,e,i,r)}}class nu{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,r=e[i],n=e[i-1];t:{e:{let s;i:{r:if(!(t<r)){for(let s=i+2;;){if(void 0===r){if(t<n)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(n=r,r=e[++i],t<r)break e}s=e.length;break i}if(t>=n)break t;{const o=e[1];t<o&&(i=2,n=o);for(let s=i-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(r=n,n=e[--i-1],t>=n)break e}s=i,i=0}}for(;i<s;){const r=i+s>>>1;t<e[r]?s=r:i=r+1}if(r=e[i],n=e[i-1],void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let t=0;t!==r;++t)e[t]=i[n+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class su extends nu{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ki,endingEnd:ki}}intervalChanged_(t,e,i){const r=this.parameterPositions;let n=t-2,s=t+1,o=r[n],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Ri:n=t,o=2*e-i;break;case Ii:n=r.length-2,o=e+r[n]-r[n+1];break;default:n=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Ri:s=t,a=2*i-e;break;case Ii:s=1,a=i+r[1]-r[0];break;default:s=t-1,a=e}const c=.5*(i-e),l=this.valueSize;this._weightPrev=c/(e-o),this._weightNext=c/(a-i),this._offsetPrev=n*l,this._offsetNext=s*l}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(r-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,_=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let t=0;t!==o;++t)n[t]=g*s[l+t]+v*s[c+t]+_*s[a+t]+y*s[h+t];return n}}class ou extends nu{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=(i-e)/(r-e),h=1-l;for(let t=0;t!==o;++t)n[t]=s[c+t]*h+s[a+t]*l;return n}}class au extends nu{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class cu{constructor(t,e,i,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Qh(e,this.TimeBufferType),this.values=Qh(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Qh(t.times,Array),values:Qh(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new au(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new ou(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new su(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Pi:e=this.InterpolantFactoryMethodDiscrete;break;case Ai:e=this.InterpolantFactoryMethodLinear;break;case Di:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return Jr("KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pi;case this.InterpolantFactoryMethodLinear:return Ai;case this.InterpolantFactoryMethodSmooth:return Di}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){const i=this.times,r=i.length;let n=0,s=r-1;for(;n!==r&&i[n]<t;)++n;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==n||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);const t=this.getValueSize();this.times=i.slice(n,s),this.values=this.values.slice(n*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(Kr("KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,r=this.values,n=i.length;0===n&&(Kr("KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==n;e++){const r=i[e];if("number"==typeof r&&isNaN(r)){Kr("KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){Kr("KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&Vr(r))for(let e=0,i=r.length;e!==i;++e){const i=r[e];if(isNaN(i)){Kr("KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===Di,n=t.length-1;let s=1;for(let o=1;o<n;++o){let n=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)n=!0;else{const t=o*i,r=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[r+o]||i!==e[s+o]){n=!0;break}}}if(n){if(o!==s){t[s]=t[o];const r=o*i,n=s*i;for(let t=0;t!==i;++t)e[n+t]=e[r+t]}++s}}if(n>0){t[s]=t[n];for(let t=n*i,r=s*i,o=0;o!==i;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}cu.prototype.ValueTypeName="",cu.prototype.TimeBufferType=Float32Array,cu.prototype.ValueBufferType=Float32Array,cu.prototype.DefaultInterpolation=Ai;class lu extends cu{constructor(t,e,i){super(t,e,i)}}lu.prototype.ValueTypeName="bool",lu.prototype.ValueBufferType=Array,lu.prototype.DefaultInterpolation=Pi,lu.prototype.InterpolantFactoryMethodLinear=void 0,lu.prototype.InterpolantFactoryMethodSmooth=void 0;class hu extends cu{constructor(t,e,i,r){super(t,e,i,r)}}hu.prototype.ValueTypeName="color";class uu extends cu{constructor(t,e,i,r){super(t,e,i,r)}}uu.prototype.ValueTypeName="number";class du extends nu{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(r-e);let c=t*o;for(let t=c+o;c!==t;c+=4)pn.slerpFlat(n,0,s,c-o,s,c,a);return n}}class pu extends cu{constructor(t,e,i,r){super(t,e,i,r)}InterpolantFactoryMethodLinear(t){return new du(this.times,this.values,this.getValueSize(),t)}}pu.prototype.ValueTypeName="quaternion",pu.prototype.InterpolantFactoryMethodSmooth=void 0;class fu extends cu{constructor(t,e,i){super(t,e,i)}}fu.prototype.ValueTypeName="string",fu.prototype.ValueBufferType=Array,fu.prototype.DefaultInterpolation=Pi,fu.prototype.InterpolantFactoryMethodLinear=void 0,fu.prototype.InterpolantFactoryMethodSmooth=void 0;class mu extends cu{constructor(t,e,i,r){super(t,e,i,r)}}mu.prototype.ValueTypeName="vector";class gu{constructor(t="",e=-1,i=[],r=Oi){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=sn(),this.userData={},this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,r=1/(t.fps||1);for(let t=0,n=i.length;t!==n;++t)e.push(vu(i[t]).scale(r));const n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n.userData=JSON.parse(t.userData||"{}"),n}static toJSON(t){const e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode,userData:JSON.stringify(t.userData)};for(let t=0,r=i.length;t!==r;++t)e.push(cu.toJSON(i[t]));return r}static CreateFromMorphTargetSequence(t,e,i,r){const n=e.length,s=[];for(let t=0;t<n;t++){let o=[],a=[];o.push((t+n-1)%n,t,(t+1)%n),a.push(0,1,0);const c=tu(o);o=eu(o,1,c),a=eu(a,1,c),r||0!==o[0]||(o.push(n),a.push(a[0])),s.push(new uu(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const r={},n=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(n);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(i)}}const s=[];for(const t in r)s.push(this.CreateFromMorphTargetSequence(t,r[t],e,i));return s}static parseAnimation(t,e){if(Jr("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return Kr("AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,r,n){if(0!==i.length){const s=[],o=[];iu(i,s,o,r),0!==s.length&&n.push(new t(e,s,o))}},r=[],n=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const n=c[t].keys;if(n&&0!==n.length)if(n[0].morphTargets){const t={};let e;for(e=0;e<n.length;e++)if(n[e].morphTargets)for(let i=0;i<n[e].morphTargets.length;i++)t[n[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let r=0;r!==n[e].morphTargets.length;++r){const r=n[e];t.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new uu(".morphTargetInfluence["+i+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";i(mu,s+".position",n,"pos",r),i(pu,s+".quaternion",n,"rot",r),i(mu,s+".scale",n,"scl",r)}}return 0===r.length?null:new this(n,a,r,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());const e=new this.constructor(this.name,this.duration,t,this.blendMode);return e.userData=JSON.parse(JSON.stringify(this.userData)),e}toJSON(){return this.constructor.toJSON(this)}}function vu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uu;case"vector":case"vector2":case"vector3":case"vector4":return mu;case"color":return hu;case"quaternion":return pu;case"bool":case"boolean":return lu;case"string":return fu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];iu(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const _u={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class yu{constructor(t,e,i){const r=this;let n,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this._abortController=null,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return n?n(t):t},this.setURLModifier=function(t){return n=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=c.length;e<i;e+=2){const i=c[e],r=c[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const xu=new yu;class bu{constructor(t){this.manager=void 0!==t?t:xu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(r,n){i.load(t,r,e,n)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}bu.DEFAULT_MATERIAL_NAME="__DEFAULT";const Mu={};class Su extends Error{constructor(t,e){super(t),this.response=e}}class wu extends bu{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=_u.get(`file:${t}`);if(void 0!==n)return this.manager.itemStart(t),setTimeout((()=>{e&&e(n),this.manager.itemEnd(t)}),0),n;if(void 0!==Mu[t])return void Mu[t].push({onLoad:e,onProgress:i,onError:r});Mu[t]=[],Mu[t].push({onLoad:e,onProgress:i,onError:r});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&Jr("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=Mu[t],r=e.body.getReader(),n=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s;let a=0;const c=new ReadableStream({start(t){!function e(){r.read().then((({done:r,value:n})=>{if(r)t.close();else{a+=n.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(r)}t.enqueue(n),e()}}),(e=>{t.error(e)}))}()}});return new Response(c)}throw new Su(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(""===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(i);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{_u.add(`file:${t}`,e);const i=Mu[t];delete Mu[t];for(let t=0,r=i.length;t<r;t++){const r=i[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{const i=Mu[t];if(void 0===i)throw this.manager.itemError(t),e;delete Mu[t];for(let t=0,r=i.length;t<r;t++){const r=i[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class Tu extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new wu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):Kr(e),n.manager.itemError(t)}}),i,r)}parse(t){const e=[];for(let i=0;i<t.length;i++){const r=gu.parse(t[i]);e.push(r)}return e}}class Cu extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=[],o=new ll,a=new wu(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(n.withCredentials);let c=0;function l(l){a.load(t[l],(function(t){const i=n.parse(t,!0);s[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},c+=1,6===c&&(1===i.mipmapCount&&(o.minFilter=fe),o.image=s,o.format=i.format,o.needsUpdate=!0,e&&e(o))}),i,r)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)l(e);else a.load(t,(function(t){const i=n.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=fe),o.format=i.format,o.needsUpdate=!0,e&&e(o)}),i,r);return o}}const Eu=new WeakMap;class Pu extends bu{constructor(t){super(t)}load(t,e,i,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,s=_u.get(`image:${t}`);if(void 0!==s){if(!0===s.complete)n.manager.itemStart(t),setTimeout((function(){e&&e(s),n.manager.itemEnd(t)}),0);else{let t=Eu.get(s);void 0===t&&(t=[],Eu.set(s,t)),t.push({onLoad:e,onError:r})}return s}const o=Hr("img");function a(){l(),e&&e(this);const i=Eu.get(this)||[];for(let t=0;t<i.length;t++){const e=i[t];e.onLoad&&e.onLoad(this)}Eu.delete(this),n.manager.itemEnd(t)}function c(e){l(),r&&r(e),_u.remove(`image:${t}`);const i=Eu.get(this)||[];for(let t=0;t<i.length;t++){const r=i[t];r.onError&&r.onError(e)}Eu.delete(this),n.manager.itemError(t),n.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),_u.add(`image:${t}`,o),n.manager.itemStart(t),o.src=t,o}}class Au extends bu{constructor(t){super(t)}load(t,e,i,r){const n=new la;n.colorSpace=Xi;const s=new Pu(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(t[i],(function(t){n.images[i]=t,o++,6===o&&(n.needsUpdate=!0,e&&e(n))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return n}}class Du extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new Ja,o=new wu(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(n.withCredentials),o.load(t,(function(t){let i;try{i=n.parse(t)}catch(t){if(void 0===r)return void t(t);r(t)}void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:ae,s.wrapT=void 0!==i.wrapT?i.wrapT:ae,s.magFilter=void 0!==i.magFilter?i.magFilter:fe,s.minFilter=void 0!==i.minFilter?i.minFilter:fe,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace&&(s.colorSpace=i.colorSpace),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=ve),1===i.mipmapCount&&(s.minFilter=fe),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i)}),i,r),s}}class ku extends bu{constructor(t){super(t)}load(t,e,i,r){const n=new Rn,s=new Pu(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){n.image=t,n.needsUpdate=!0,void 0!==e&&e(n)}),i,r),n}}class Ru extends Bs{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new so(t),this.intensity=e}dispose(){this.dispatchEvent({type:"dispose"})}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e}}class Iu extends Ru{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Bs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new so(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}toJSON(t){const e=super.toJSON(t);return e.object.groundColor=this.groundColor.getHex(),e}}const Ou=new ps,Lu=new fn,Nu=new fn;class Fu{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new dn(512,512),this.mapType=ye,this.map=null,this.mapPass=null,this.matrix=new ps,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new gc,this._frameExtents=new dn(1,1),this._viewportCount=1,this._viewports=[new In(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Lu.setFromMatrixPosition(t.matrixWorld),e.position.copy(Lu),Nu.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Nu),e.updateMatrixWorld(),Ou.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ou,e.coordinateSystem,e.reversedDepth),e.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Ou)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Uu extends Fu{constructor(){super(new oa(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,i=2*nn*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,n=t.distance||e.far;i===e.fov&&r===e.aspect&&n===e.far||(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Wu extends Ru{constructor(t,e,i=0,r=Math.PI/3,n=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Bs.DEFAULT_UP),this.updateMatrix(),this.target=new Bs,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new Uu}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.map=t.map,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.angle=this.angle,e.object.decay=this.decay,e.object.penumbra=this.penumbra,e.object.target=this.target.uuid,this.map&&this.map.isTexture&&(e.object.map=this.map.toJSON(t).uuid),e.object.shadow=this.shadow.toJSON(),e}}class Bu extends Fu{constructor(){super(new oa(90,1,.5,500)),this.isPointLightShadow=!0}}class zu extends Ru{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Bu}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.decay=this.decay,e.object.shadow=this.shadow.toJSON(),e}}class Vu extends ia{constructor(t=-1,e=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let n=i-t,s=i+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=t*this.view.offsetX,s=n+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(n,s,o,a,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class Hu extends Fu{constructor(){super(new Vu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Gu extends Ru{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Bs.DEFAULT_UP),this.updateMatrix(),this.target=new Bs,this.shadow=new Hu}dispose(){super.dispose(),this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.shadow=this.shadow.toJSON(),e.object.target=this.target.uuid,e}}class ju extends Ru{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Xu extends Ru{constructor(t,e,i=10,r=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class qu{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new fn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,r=t.y,n=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*n),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*r*1.092548),e.addScaledVector(s[5],r*n*1.092548),e.addScaledVector(s[6],.315392*(3*n*n-1)),e.addScaledVector(s[7],i*n*1.092548),e.addScaledVector(s[8],.546274*(i*i-r*r)),e}getIrradianceAt(t,e){const i=t.x,r=t.y,n=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*n),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*r),e.addScaledVector(s[5],.858086*r*n),e.addScaledVector(s[6],.743125*n*n-.247708),e.addScaledVector(s[7],.858086*i*n),e.addScaledVector(s[8],.429043*(i*i-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const i=t.x,r=t.y,n=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*n,e[3]=.488603*i,e[4]=1.092548*i*r,e[5]=1.092548*r*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*i*n,e[8]=.546274*(i*i-r*r)}}class Yu extends Ru{constructor(t=new qu,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Zu extends bu{constructor(t){super(t),this.textures={}}load(t,e,i,r){const n=this,s=new wu(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):Kr(e),n.manager.itemError(t)}}),i,r)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&Jr("MaterialLoader: Undefined texture",t),e[t]}const r=this.createMaterialFromType(t.type);if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=t.sheen),void 0!==t.sheenColor&&(r.sheenColor=(new so).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(r.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.specularIntensity&&(r.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(r.dispersion=t.dispersion),void 0!==t.iridescence&&(r.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(r.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(r.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(r.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(r.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(r.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(r.depthFunc=t.depthFunc),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(r.blendSrc=t.blendSrc),void 0!==t.blendDst&&(r.blendDst=t.blendDst),void 0!==t.blendEquation&&(r.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(r.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(r.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(r.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(r.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),void 0!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(r.forceSinglePass=t.forceSinglePass),void 0!==t.allowOverride&&(r.allowOverride=t.allowOverride),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const n=t.uniforms[e];switch(r.uniforms[e]={},n.type){case"t":r.uniforms[e].value=i(n.value);break;case"c":r.uniforms[e].value=(new so).setHex(n.value);break;case"v2":r.uniforms[e].value=(new dn).fromArray(n.value);break;case"v3":r.uniforms[e].value=(new fn).fromArray(n.value);break;case"v4":r.uniforms[e].value=(new In).fromArray(n.value);break;case"m3":r.uniforms[e].value=(new vn).fromArray(n.value);break;case"m4":r.uniforms[e].value=(new ps).fromArray(n.value);break;default:r.uniforms[e].value=n.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(r.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(r.lights=t.lights),void 0!==t.clipping&&(r.clipping=t.clipping),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=i(t.map)),void 0!==t.matcap&&(r.matcap=i(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new dn).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(r.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(r.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(r.envMap=i(t.envMap)),void 0!==t.envMapRotation&&r.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new dn).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(r.iridescenceMap=i(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(r.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=i(t.thicknessMap)),void 0!==t.anisotropyMap&&(r.anisotropyMap=i(t.anisotropyMap)),void 0!==t.sheenColorMap&&(r.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(r.sheenRoughnessMap=i(t.sheenRoughnessMap)),r}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return Zu.createMaterialFromType(t)}static createMaterialFromType(t){return new{ShadowMaterial:zh,SpriteMaterial:xa,RawShaderMaterial:Vh,ShaderMaterial:ea,PointsMaterial:Qc,MeshPhysicalMaterial:Gh,MeshStandardMaterial:Hh,MeshPhongMaterial:jh,MeshToonMaterial:Xh,MeshNormalMaterial:qh,MeshLambertMaterial:Yh,MeshDepthMaterial:Zh,MeshDistanceMaterial:Jh,MeshBasicMaterial:lo,MeshMatcapMaterial:Kh,LineDashedMaterial:$h,LineBasicMaterial:Wc,Material:co}[t]}}class Ju{static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Ku extends No{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class $u extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new wu(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):Kr(e),n.manager.itemError(t)}}),i,r)}parse(t){const e={},i={};function r(t,r){if(void 0!==e[r])return e[r];const n=t.interleavedBuffers[r],s=function(t,e){if(void 0!==i[e])return i[e];const r=t.arrayBuffers[e],n=new Uint32Array(r).buffer;return i[e]=n,n}(t,n.buffer),o=zr(n.type,s),a=new va(o,n.stride);return a.uuid=n.uuid,e[r]=a,a}const n=t.isInstancedBufferGeometry?new Ku:new No,s=t.data.index;if(void 0!==s){const t=zr(s.type,s.array);n.setIndex(new yo(t,1))}const o=t.data.attributes;for(const e in o){const i=o[e];let s;if(i.isInterleavedBufferAttribute){const e=r(t.data,i.data);s=new ya(e,i.itemSize,i.offset,i.normalized)}else{const t=zr(i.type,i.array);s=new(i.isInstancedBufferAttribute?tc:yo)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),n.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const i=a[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];let o;if(n.isInterleavedBufferAttribute){const e=r(t.data,n.data);o=new ya(e,n.itemSize,n.offset,n.normalized)}else{const t=zr(n.type,n.array);o=new yo(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),s.push(o)}n.morphAttributes[e]=s}t.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];n.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;return void 0!==l&&(n.boundingSphere=(new ns).fromJSON(l)),t.name&&(n.name=t.name),t.userData&&(n.userData=t.userData),n}}class Qu extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=""===this.path?Ju.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new wu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==r&&r(e),void e("ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+t)),void Kr("ObjectLoader: Can't load "+t);n.parse(s,e)}),i,r)}async loadAsync(t,e){const i=""===this.path?Ju.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const r=new wu(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const n=await r.loadAsync(t,e),s=JSON.parse(n),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=this.parseImages(t.images,(function(){void 0!==e&&e(c)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,n,a,o,i),l=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,l),this.bindLightTargets(c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(c)}return c}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),n=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,r,o,s,e),c=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,c),this.bindLightTargets(a),a}parseShapes(t){const e={};if(void 0!==t)for(let i=0,r=t.length;i<r;i++){const r=(new Zl).fromJSON(t[i]);e[r.uuid]=r}return e}parseSkeletons(t,e){const i={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,n=t.length;e<n;e++){const n=(new Qa).fromJSON(t[e],r);i[n.uuid]=n}return i}parseGeometries(t,e){const i={};if(void 0!==t){const r=new $u;for(let n=0,s=t.length;n<s;n++){let s;const o=t[n];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;default:o.type in Bh?s=Bh[o.type].fromJSON(o,e):Jr(`ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},r={};if(void 0!==t){const n=new Zu;n.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const r=t[i],n=gu.parse(r);e[n.uuid]=n}return e}parseImages(t,e){const i=this,r={};let n;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),n.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:zr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new yu(e);n=new Pu(i),n.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.url;if(Array.isArray(n)){const t=[];for(let e=0,i=n.length;e<i;e++){const i=s(n[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Ja(i.data,i.width,i.height)))}r[i.uuid]=new Pn(t)}else{const t=s(i.url);r[i.uuid]=new Pn(t)}}}return r}async parseImagesAsync(t){const e=this,i={};let r;async function n(t){if("string"==typeof t){const i=t,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await r.loadAsync(n)}return t.data?{data:zr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){r=new Pu(this.manager),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],r=await n(i);null!==r&&(r instanceof HTMLImageElement?t.push(r):t.push(new Ja(r.data,r.width,r.height)))}i[r.uuid]=new Pn(t)}else{const t=await n(r.url);i[r.uuid]=new Pn(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(Jr("ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let n=0,s=t.length;n<s;n++){const s=t[n];void 0===s.image&&Jr('ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&Jr("ObjectLoader: Undefined image",s.image);const o=e[s.image],a=o.data;let c;Array.isArray(a)?(c=new la,6===a.length&&(c.needsUpdate=!0)):(c=a&&a.data?new Ja:new Rn,a&&(c.needsUpdate=!0)),c.source=o,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=i(s.mapping,td)),void 0!==s.channel&&(c.channel=s.channel),void 0!==s.offset&&c.offset.fromArray(s.offset),void 0!==s.repeat&&c.repeat.fromArray(s.repeat),void 0!==s.center&&c.center.fromArray(s.center),void 0!==s.rotation&&(c.rotation=s.rotation),void 0!==s.wrap&&(c.wrapS=i(s.wrap[0],ed),c.wrapT=i(s.wrap[1],ed)),void 0!==s.format&&(c.format=s.format),void 0!==s.internalFormat&&(c.internalFormat=s.internalFormat),void 0!==s.type&&(c.type=s.type),void 0!==s.colorSpace&&(c.colorSpace=s.colorSpace),void 0!==s.minFilter&&(c.minFilter=i(s.minFilter,id)),void 0!==s.magFilter&&(c.magFilter=i(s.magFilter,id)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),void 0!==s.flipY&&(c.flipY=s.flipY),void 0!==s.generateMipmaps&&(c.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(c.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(c.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(c.compareFunction=s.compareFunction),void 0!==s.userData&&(c.userData=s.userData),r[s.uuid]=c}return r}parseObject(t,e,i,r,n){let s,o,a;function c(t){return void 0===e[t]&&Jr("ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];void 0===i[n]&&Jr("ObjectLoader: Undefined material",n),e.push(i[n])}return e}return void 0===i[t]&&Jr("ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===r[t]&&Jr("ObjectLoader: Undefined texture",t),r[t]}switch(t.type){case"Scene":s=new ga,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new so(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new ma(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new fa(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&s.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(s.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&s.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":s=new oa(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Vu(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new ju(t.color,t.intensity);break;case"DirectionalLight":s=new Gu(t.color,t.intensity),s.target=t.target||"";break;case"PointLight":s=new zu(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Xu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Wu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),s.target=t.target||"";break;case"HemisphereLight":s=new Iu(t.color,t.groundColor,t.intensity);break;case"LightProbe":const e=(new qu).fromArray(t.sh);s=new Yu(e,t.intensity);break;case"SkinnedMesh":o=c(t.geometry),a=l(t.material),s=new Ya(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=c(t.geometry),a=l(t.material),s=new Yo(o,a);break;case"InstancedMesh":o=c(t.geometry),a=l(t.material);const i=t.count,r=t.instanceMatrix,n=t.instanceColor;s=new cc(o,a,i),s.instanceMatrix=new tc(new Float32Array(r.array),16),void 0!==n&&(s.instanceColor=new tc(new Float32Array(n.array),n.itemSize));break;case"BatchedMesh":o=c(t.geometry),a=l(t.material),s=new Uc(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,a),s.geometry=o,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._geometryInfo=t.geometryInfo.map((t=>{let e=null,i=null;return void 0!==t.boundingBox&&(e=(new Bn).fromJSON(t.boundingBox)),void 0!==t.boundingSphere&&(i=(new ns).fromJSON(t.boundingSphere)),{...t,boundingBox:e,boundingSphere:i}})),s._instanceInfo=t.instanceInfo,s._availableInstanceIds=t._availableInstanceIds,s._availableGeometryIds=t._availableGeometryIds,s._nextIndexStart=t.nextIndexStart,s._nextVertexStart=t.nextVertexStart,s._geometryCount=t.geometryCount,s._maxInstanceCount=t.maxInstanceCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._matricesTexture=h(t.matricesTexture.uuid),s._indirectTexture=h(t.indirectTexture.uuid),void 0!==t.colorsTexture&&(s._colorsTexture=h(t.colorsTexture.uuid)),void 0!==t.boundingSphere&&(s.boundingSphere=(new ns).fromJSON(t.boundingSphere)),void 0!==t.boundingBox&&(s.boundingBox=(new Bn).fromJSON(t.boundingBox));break;case"LOD":s=new Ua;break;case"Line":s=new qc(c(t.geometry),l(t.material));break;case"LineLoop":s=new $c(c(t.geometry),l(t.material));break;case"LineSegments":s=new Kc(c(t.geometry),l(t.material));break;case"PointCloud":case"Points":s=new nl(c(t.geometry),l(t.material));break;case"Sprite":s=new Oa(l(t.material));break;case"Group":s=new ua;break;case"Bone":s=new Za;break;default:s=new Bs}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(s.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,i,r,n))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(n[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],r=s.getObjectByProperty("uuid",i.object);void 0!==r&&s.addLevel(r,i.distance,i.hysteresis)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?Jr("ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}bindLightTargets(t){t.traverse((function(e){if(e.isDirectionalLight||e.isSpotLight){const i=e.target,r=t.getObjectByProperty("uuid",i);e.target=void 0!==r?r:new Bs}}))}}const td={UVMapping:te,CubeReflectionMapping:ee,CubeRefractionMapping:ie,EquirectangularReflectionMapping:re,EquirectangularRefractionMapping:ne,CubeUVReflectionMapping:se},ed={RepeatWrapping:oe,ClampToEdgeWrapping:ae,MirroredRepeatWrapping:ce},id={NearestFilter:le,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:de,LinearFilter:fe,LinearMipmapNearestFilter:me,LinearMipmapLinearFilter:ve},rd=new WeakMap;class nd extends bu{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&Jr("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&Jr("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,s=_u.get(`image-bitmap:${t}`);if(void 0!==s)return n.manager.itemStart(t),s.then?void s.then((i=>{if(!0!==rd.has(s))return e&&e(i),n.manager.itemEnd(t),i;r&&r(rd.get(s)),n.manager.itemError(t),n.manager.itemEnd(t)})):(setTimeout((function(){e&&e(s),n.manager.itemEnd(t)}),0),s);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,o.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(n.options,{colorSpaceConversion:"none"}))})).then((function(i){return _u.add(`image-bitmap:${t}`,i),e&&e(i),n.manager.itemEnd(t),i})).catch((function(e){r&&r(e),rd.set(a,e),_u.remove(`image-bitmap:${t}`),n.manager.itemError(t),n.manager.itemEnd(t)}));_u.add(`image-bitmap:${t}`,a),n.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let sd;class od{static getContext(){return void 0===sd&&(sd=new(window.AudioContext||window.webkitAudioContext)),sd}static setContext(t){sd=t}}class ad extends bu{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new wu(this.manager);function o(e){r?r(e):Kr(e),n.manager.itemError(t)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){try{const i=t.slice(0);od.getContext().decodeAudioData(i,(function(t){e(t)})).catch(o)}catch(t){o(t)}}),i,r)}}const cd=new ps,ld=new ps,hd=new ps;class ud{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new oa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new oa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,hd.copy(t.projectionMatrix);const i=e.eyeSep/2,r=i*e.near/e.focus,n=e.near*Math.tan(rn*e.fov*.5)/e.zoom;let s,o;ld.elements[12]=-i,cd.elements[12]=i,s=-n*e.aspect+r,o=n*e.aspect+r,hd.elements[0]=2*e.near/(o-s),hd.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(hd),s=-n*e.aspect-r,o=n*e.aspect-r,hd.elements[0]=2*e.near/(o-s),hd.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(hd)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ld),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(cd)}}class dd extends oa{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class pd{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const fd=new fn,md=new pn,gd=new fn,vd=new fn,_d=new fn;class yd extends Bs{constructor(){super(),this.type="AudioListener",this.context=od.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new pd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(fd,md,gd),vd.set(0,0,-1).applyQuaternion(md),_d.set(0,1,0).applyQuaternion(md),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(fd.x,t),e.positionY.linearRampToValueAtTime(fd.y,t),e.positionZ.linearRampToValueAtTime(fd.z,t),e.forwardX.linearRampToValueAtTime(vd.x,t),e.forwardY.linearRampToValueAtTime(vd.y,t),e.forwardZ.linearRampToValueAtTime(vd.z,t),e.upX.linearRampToValueAtTime(_d.x,t),e.upY.linearRampToValueAtTime(_d.y,t),e.upZ.linearRampToValueAtTime(_d.z,t)}else e.setPosition(fd.x,fd.y,fd.z),e.setOrientation(vd.x,vd.y,vd.z,_d.x,_d.y,_d.z)}}class xd extends Bs{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void Jr("Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void Jr("Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;Jr("Audio: this Audio has no playback control.")}stop(t=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this;Jr("Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;Jr("Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(Jr("Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;Jr("Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),"buffer"!==t.sourceType?(Jr("Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const bd=new fn,Md=new pn,Sd=new fn,wd=new fn;class Td extends xd{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(bd,Md,Sd),wd.set(0,0,1).applyQuaternion(Md);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(bd.x,t),e.positionY.linearRampToValueAtTime(bd.y,t),e.positionZ.linearRampToValueAtTime(bd.z,t),e.orientationX.linearRampToValueAtTime(wd.x,t),e.orientationY.linearRampToValueAtTime(wd.y,t),e.orientationZ.linearRampToValueAtTime(wd.z,t)}else e.setPosition(bd.x,bd.y,bd.z),e.setOrientation(wd.x,wd.y,wd.z)}}class Cd{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class Ed{constructor(t,e,i){let r,n,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,r=this.valueSize,n=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)i[n+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,n,0,t,r)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,r=t*e+e,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const t=e*this._origIndex;this._mixBufferRegion(i,r,t,1-n,e)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let t=e,n=e+e;t!==n;++t)if(i[t]!==i[t+e]){o.setValue(i,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let t=i,n=r;t!==n;++t)e[t]=e[r+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,n){if(r>=.5)for(let r=0;r!==n;++r)t[e+r]=t[i+r]}_slerp(t,e,i,r){pn.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,n){const s=this._workIndex*n;pn.multiplyQuaternionsFlat(t,s,t,e,t,i),pn.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,i,r,n){const s=1-r;for(let o=0;o!==n;++o){const n=e+o;t[n]=t[n]*s+t[i+o]*r}}_lerpAdditive(t,e,i,r,n){for(let s=0;s!==n;++s){const n=e+s;t[n]=t[n]+t[i+s]*r}}}const Pd="\\[\\]\\.:\\/",Ad=new RegExp("["+Pd+"]","g"),Dd="[^"+Pd+"]",kd="[^"+Pd.replace("\\.","")+"]",Rd=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Dd)+/(WCOD+)?/.source.replace("WCOD",kd)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Dd)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Dd)+"$"),Id=["material","materials","bones","map"];class Od{constructor(t,e,i){this.path=e,this.parsedPath=i||Od.parseTrackName(e),this.node=Od.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Od.Composite(t,e,i):new Od(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Ad,"")}static parseTrackName(t){const e=Rd.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=i.nodeName.substring(r+1);-1!==Id.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let r=0;r<t.length;r++){const n=t[r];if(n.name===e||n.uuid===e)return n;const s=i(n.children);if(s)return s}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,r=e.propertyName;let n=e.propertyIndex;if(t||(t=Od.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void Jr("PropertyBinding: No target node found for track: "+this.path+".");if(i){let r=e.objectIndex;switch(i){case"materials":if(!t.material)return void Kr("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void Kr("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void Kr("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void Kr("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void Kr("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void Kr("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==r){if(void 0===t[r])return void Kr("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s)return void Kr("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+r+" but it wasn't found.",t);let o=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?o=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!t.geometry)return void Kr("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void Kr("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[n]&&(n=t.morphTargetDictionary[n])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Od.Composite=class{constructor(t,e,i){const r=i||Od.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Od.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Od.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Od.prototype.GetterByBindingType=[Od.prototype._getValue_direct,Od.prototype._getValue_array,Od.prototype._getValue_arrayElement,Od.prototype._getValue_toArray],Od.prototype.SetterByBindingTypeAndVersioning=[[Od.prototype._setValue_direct,Od.prototype._setValue_direct_setNeedsUpdate,Od.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Od.prototype._setValue_array,Od.prototype._setValue_array_setNeedsUpdate,Od.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Od.prototype._setValue_arrayElement,Od.prototype._setValue_arrayElement_setNeedsUpdate,Od.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Od.prototype._setValue_fromArray,Od.prototype._setValue_fromArray_setNeedsUpdate,Od.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ld{constructor(){this.isAnimationObjectGroup=!0,this.uuid=sn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,s=n.length;let o,a=t.length,c=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const h=arguments[l],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)n[t].push(new Od(h,i[t],r[t]))}else if(d<c){o=t[d];const a=--c,l=t[a];e[l.uuid]=d,t[d]=l,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=n[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new Od(h,i[t],r[t])),e[a]=o}}else t[d]!==o&&Kr("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,c=e[a];if(void 0!==c&&c>=n){const s=n++,l=t[s];e[l.uuid]=c,t[c]=l,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=i[t],r=e[s],n=e[c];e[c]=r,e[s]=n}}}this.nCachedObjects_=n}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<n){const o=--n,a=t[o],l=--s,h=t[l];e[a.uuid]=c,t[c]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=r;t!==e;++t){const e=i[t],r=e[o],n=e[l];e[c]=r,e[o]=n,e.pop()}}else{const n=--s,o=t[n];n>0&&(e[o.uuid]=c),t[c]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=i[t];e[c]=e[n],e.pop()}}}this.nCachedObjects_=n}subscribe_(t,e){const i=this._bindingsIndicesByPath;let r=i[t];const n=this._bindings;if(void 0!==r)return n[r];const s=this._paths,o=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,h=new Array(c);r=n.length,i[t]=r,s.push(t),o.push(e),n.push(h);for(let i=l,r=a.length;i!==r;++i){const r=a[i];h[i]=new Od(r,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const r=this._paths,n=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=i,s[i]=a,s.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}}class Nd{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;const n=e.tracks,s=n.length,o=new Array(s),a={endingStart:ki,endingEnd:ki};for(let t=0;t!==s;++t){const e=n[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ci,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i=!1){if(t.fadeOut(e),this.fadeIn(e),!0===i){const i=this._clip.duration,r=t._clip.duration,n=r/i,s=i/r;t.warp(1,n,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i=!1){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const r=this._mixer,n=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=n,a[1]=n+i,c[0]=t/s,c[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled)return void this._updateWeight(t);const n=this._startTime;if(null!==n){const r=(t-n)*i;r<0||0===i?e=0:(this._startTime=null,e=i*r)}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===Li)for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);else for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let r=this.time+t,n=this._loopCount;const s=i===Ei;if(0===t)return-1===n||!s||1&~n?r:e-r;if(i===Ti){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===n&&(t>=0?(n=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const i=Math.floor(r/e);r-=e*i,n+=Math.abs(i);const o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(s&&!(1&~n))return e-r}return r}_setEndings(t,e,i){const r=this._interpolantSettings;i?(r.endingStart=Ri,r.endingEnd=Ri):(r.endingStart=t?this.zeroSlopeAtStart?Ri:ki:Ii,r.endingEnd=e?this.zeroSlopeAtEnd?Ri:ki:Ii)}_scheduleFading(t,e,i){const r=this._mixer,n=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=n,a[0]=e,o[1]=n+t,a[1]=i,this}}const Fd=new Float32Array(1);class Ud extends Qr{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==n;++t){const n=r[t],c=n.name;let h=l[c];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,c));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;h=new Ed(Od.create(i,c,r),n.ValueTypeName,n.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,c),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,r=this._actionsByClip[i];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const r=this._actions,n=this._actionsByClip;let s=n[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;const n=t._clip.uuid,s=this._actionsByClip,o=s[n],a=o.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){const r=this._bindingsByRootAndName,n=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[n],0===Object.keys(o).length&&delete s[r]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new ou(new Float32Array(2),new Float32Array(2),1,Fd),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){const r=e||this._root,n=r.uuid;let s="string"==typeof t?gu.findByName(r,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let c=null;if(void 0===i&&(i=null!==s?s.blendMode:Oi),void 0!==a){const t=a.actionByRoot[n];if(void 0!==t&&t.blendMode===i)return t;c=a.knownActions[0],null===s&&(s=c._clip)}if(null===s)return null;const l=new Nd(this,s,e,i);return this._bindAction(l,c),this._addInactiveAction(l,o,n),l}existingAction(t,e){const i=e||this._root,r=i.uuid,n="string"==typeof t?gu.findByName(i,t):t,s=n?n.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o)e[o]._update(r,t,n,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){const t=n.knownActions;for(let i=0,r=t.length;i!==r;++i){const r=t[i];this._deactivateAction(r);const n=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=n,e[n]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const r=i[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Wd extends On{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isRenderTarget3D=!0,this.depth=i,this.texture=new Un(null,t,e,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Bd{constructor(t){this.value=t}clone(){return new Bd(void 0===this.value.clone?this.value:this.value.clone())}}let zd=0;class Vd extends Qr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:zd++}),this.name="",this.usage=Sr,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,i=e.length;t<i;t++){const i=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0;t<i.length;t++)this.uniforms.push(i[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class Hd extends va{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class Gd{constructor(t,e,i,r,n,s=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=r,this.count=n,this.normalized=s,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const jd=new ps;class Xd{constructor(t,e,i=0,r=1/0){this.ray=new ds(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new ws,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):Kr("Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return jd.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(jd),this}intersectObject(t,e=!0,i=[]){return Yd(t,this,i,e),i.sort(qd),i}intersectObjects(t,e=!0,i=[]){for(let r=0,n=t.length;r<n;r++)Yd(t[r],this,i,e);return i.sort(qd),i}}function qd(t,e){return t.distance-e.distance}function Yd(t,e,i,r){let n=!0;if(t.layers.test(e.layers)&&!1===t.raycast(e,i)&&(n=!1),!0===n&&!0===r){const r=t.children;for(let t=0,n=r.length;t<n;t++)Yd(r[t],e,i,!0)}}class Zd{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(t){this._document=t,void 0!==t.hidden&&(this._pageVisibilityHandler=Jd.bind(this),t.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(t){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==t?t:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function Jd(){!1===this._document.hidden&&this.reset()}class Kd{constructor(t=1,e=0,i=0){this.radius=t,this.phi=e,this.theta=i}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=on(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(on(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class $d{constructor(t=1,e=0,i=0){this.radius=t,this.theta=e,this.y=i}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class Qd{constructor(t,e,i,r){Qd.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let i=0;i<4;i++)this.elements[i]=t[i+e];return this}set(t,e,i,r){const n=this.elements;return n[0]=t,n[2]=e,n[1]=i,n[3]=r,this}}const tp=new dn;class ep{constructor(t=new dn(1/0,1/0),e=new dn(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=tp.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,tp).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ip=new fn,rp=new fn,np=new fn,sp=new fn,op=new fn,ap=new fn,cp=new fn;class lp{constructor(t=new fn,e=new fn){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){ip.subVectors(t,this.start),rp.subVectors(this.end,this.start);const i=rp.dot(rp);let r=rp.dot(ip)/i;return e&&(r=on(r,0,1)),r}closestPointToPoint(t,e,i){const r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}distanceSqToLine3(t,e=ap,i=cp){const r=1e-8*1e-8;let n,s;const o=this.start,a=t.start,c=this.end,l=t.end;np.subVectors(c,o),sp.subVectors(l,a),op.subVectors(o,a);const h=np.dot(np),u=sp.dot(sp),d=sp.dot(op);if(h<=r&&u<=r)return e.copy(o),i.copy(a),e.sub(i),e.dot(e);if(h<=r)n=0,s=d/u,s=on(s,0,1);else{const t=np.dot(op);if(u<=r)s=0,n=on(-t/h,0,1);else{const e=np.dot(sp),i=h*u-e*e;n=0!==i?on((e*d-t*u)/i,0,1):0,s=(e*n+d)/u,s<0?(s=0,n=on(-t/h,0,1)):s>1&&(s=1,n=on((e-t)/h,0,1))}}return e.copy(o).add(np.multiplyScalar(n)),i.copy(a).add(sp.multiplyScalar(s)),e.sub(i),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const hp=new fn;class up extends Bs{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const i=new No,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const n=t/i*Math.PI*2,s=e/i*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Po(r,3));const n=new Wc({fog:!1,toneMapped:!1});this.cone=new Kc(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),hp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const dp=new fn,pp=new ps,fp=new ps;class mp extends Kc{constructor(t){const e=gp(t),i=new No,r=[],n=[];for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(0,0,0),n.push(0,0,0))}i.setAttribute("position",new Po(r,3)),i.setAttribute("color",new Po(n,3)),super(i,new Wc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const s=new so(255),o=new so(65280);this.setColors(s,o)}updateMatrixWorld(t){const e=this.bones,i=this.geometry,r=i.getAttribute("position");fp.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(pp.multiplyMatrices(fp,n.matrixWorld),dp.setFromMatrixPosition(pp),r.setXYZ(i,dp.x,dp.y,dp.z),pp.multiplyMatrices(fp,n.parent.matrixWorld),dp.setFromMatrixPosition(pp),r.setXYZ(i+1,dp.x,dp.y,dp.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const i=this.geometry.getAttribute("color");for(let r=0;r<i.count;r+=2)i.setXYZ(r,t.r,t.g,t.b),i.setXYZ(r+1,e.r,e.g,e.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function gp(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push(...gp(t.children[i]));return e}class vp extends Yo{constructor(t,e,i){super(new Ih(e,4,2),new lo({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _p=new fn,yp=new so,xp=new so;class bp extends Bs{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new Ah(e);r.rotateY(.5*Math.PI),this.material=new lo({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const n=r.getAttribute("position"),s=new Float32Array(3*n.count);r.setAttribute("color",new yo(s,3)),this.add(new Yo(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");yp.copy(this.light.color),xp.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const r=t<i/2?yp:xp;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(_p.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Mp extends Kc{constructor(t=10,e=10,i=4473924,r=8947848){i=new so(i),r=new so(r);const n=e/2,s=t/e,o=t/2,a=[],c=[];for(let t=0,l=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===n?i:r;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new No;l.setAttribute("position",new Po(a,3)),l.setAttribute("color",new Po(c,3)),super(l,new Wc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Sp extends Kc{constructor(t=10,e=16,i=8,r=64,n=4473924,s=8947848){n=new so(n),s=new so(s);const o=[],a=[];if(e>1)for(let i=0;i<e;i++){const r=i/e*(2*Math.PI),c=Math.sin(r)*t,l=Math.cos(r)*t;o.push(0,0,0),o.push(c,0,l);const h=1&i?n:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<i;e++){const c=1&e?n:s,l=t-t/i*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),i=Math.sin(e)*l,n=Math.cos(e)*l;o.push(i,0,n),a.push(c.r,c.g,c.b),e=(t+1)/r*(2*Math.PI),i=Math.sin(e)*l,n=Math.cos(e)*l,o.push(i,0,n),a.push(c.r,c.g,c.b)}}const c=new No;c.setAttribute("position",new Po(o,3)),c.setAttribute("color",new Po(a,3)),super(c,new Wc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const wp=new fn,Tp=new fn,Cp=new fn;class Ep extends Bs{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===e&&(e=1);let r=new No;r.setAttribute("position",new Po([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const n=new Wc({fog:!1,toneMapped:!1});this.lightPlane=new qc(r,n),this.add(this.lightPlane),r=new No,r.setAttribute("position",new Po([0,0,0,0,0,1],3)),this.targetLine=new qc(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),wp.setFromMatrixPosition(this.light.matrixWorld),Tp.setFromMatrixPosition(this.light.target.matrixWorld),Cp.subVectors(Tp,wp),this.lightPlane.lookAt(Tp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tp),this.targetLine.scale.z=Cp.length()}}const Pp=new fn,Ap=new ia;class Dp extends Kc{constructor(t){const e=new No,i=new Wc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};function o(t,e){a(t),a(e)}function a(t){r.push(0,0,0),n.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new Po(r,3)),e.setAttribute("color",new Po(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const c=new so(16755200),l=new so(16711680),h=new so(43775),u=new so(16777215),d=new so(3355443);this.setColors(c,l,h,u,d)}setColors(t,e,i,r,n){const s=this.geometry.getAttribute("color");return s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0,this}update(){const t=this.geometry,e=this.pointMap;let i,r;if(Ap.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)i=1,r=0;else if(this.camera.coordinateSystem===Or)i=-1,r=1;else{if(this.camera.coordinateSystem!==Lr)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);i=0,r=1}kp("c",e,t,Ap,0,0,i),kp("t",e,t,Ap,0,0,r),kp("n1",e,t,Ap,-1,-1,i),kp("n2",e,t,Ap,1,-1,i),kp("n3",e,t,Ap,-1,1,i),kp("n4",e,t,Ap,1,1,i),kp("f1",e,t,Ap,-1,-1,r),kp("f2",e,t,Ap,1,-1,r),kp("f3",e,t,Ap,-1,1,r),kp("f4",e,t,Ap,1,1,r),kp("u1",e,t,Ap,.7,1.1,i),kp("u2",e,t,Ap,-.7,1.1,i),kp("u3",e,t,Ap,0,2,i),kp("cf1",e,t,Ap,-1,0,r),kp("cf2",e,t,Ap,1,0,r),kp("cf3",e,t,Ap,0,-1,r),kp("cf4",e,t,Ap,0,1,r),kp("cn1",e,t,Ap,-1,0,i),kp("cn2",e,t,Ap,1,0,i),kp("cn3",e,t,Ap,0,-1,i),kp("cn4",e,t,Ap,0,1,i),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function kp(t,e,i,r,n,s,o){Pp.set(n,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=i.getAttribute("position");for(let e=0,i=a.length;e<i;e++)t.setXYZ(a[e],Pp.x,Pp.y,Pp.z)}}const Rp=new Bn;class Ip extends Kc{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new No;n.setIndex(new yo(i,1)),n.setAttribute("position",new yo(r,3)),super(n,new Wc({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Rp.setFromObject(this.object),Rp.isEmpty())return;const t=Rp.min,e=Rp.max,i=this.geometry.attributes.position,r=i.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Op extends Kc{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new No;r.setIndex(new yo(i,1)),r.setAttribute("position",new Po([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Wc({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Lp extends qc{constructor(t,e=1,i=16776960){const r=i,n=new No;n.setAttribute("position",new Po([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new Wc({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new No;s.setAttribute("position",new Po([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Yo(s,new lo({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Np=new fn;let Fp,Up;class Wp extends Bs{constructor(t=new fn(0,0,1),e=new fn(0,0,0),i=1,r=16776960,n=.2*i,s=.2*n){super(),this.type="ArrowHelper",void 0===Fp&&(Fp=new No,Fp.setAttribute("position",new Po([0,0,0,0,1,0],3)),Up=new yl(.5,1,5,1),Up.translate(0,-.5,0)),this.position.copy(e),this.line=new qc(Fp,new Wc({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Yo(Up,new lo({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,n,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Np.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Np,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Bp extends Kc{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new No;i.setAttribute("position",new Po(e,3)),i.setAttribute("color",new Po([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Wc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const r=new so,n=this.geometry.attributes.color.array;return r.set(t),r.toArray(n,0),r.toArray(n,3),r.set(e),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class zp{constructor(){this.type="ShapePath",this.color=new so,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Yl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.currentPath.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,n,s){return this.currentPath.bezierCurveTo(t,e,i,r,n,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const i=e.length;let r=!1;for(let n=i-1,s=0;s<i;n=s++){let i=e[n],o=e[s],a=o.x-i.x,c=o.y-i.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(i=e[s],a=-a,o=e[n],c=-c),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=c*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return r}const i=Mh.isClockWise,r=this.subPaths;if(0===r.length)return[];let n,s,o;const a=[];if(1===r.length)return s=r[0],o=new Zl,o.curves=s.curves,a.push(o),a;let c=!i(r[0].getPoints());c=t?!c:c;const l=[],h=[];let u,d,p=[],f=0;h[f]=void 0,p[f]=[];for(let e=0,o=r.length;e<o;e++)s=r[e],u=s.getPoints(),n=i(u),n=t?!n:n,n?(!c&&h[f]&&f++,h[f]={s:new Zl,p:u},h[f].s.curves=s.curves,c&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],n=new Zl;n.curves=r.curves,e.push(n)}return e}(r);if(h.length>1){let t=!1,i=0;for(let t=0,e=h.length;t<e;t++)l[t]=[];for(let r=0,n=h.length;r<n;r++){const n=p[r];for(let s=0;s<n.length;s++){const o=n[s];let a=!0;for(let n=0;n<h.length;n++)e(o.p,h[n].p)&&(r!==n&&i++,a?(a=!1,l[n].push(o)):t=!0);a&&l[r].push(o)}}i>0&&!1===t&&(p=l)}for(let t=0,e=h.length;t<e;t++){o=h[t].s,a.push(o),d=p[t];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return a}}class Vp extends Qr{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){void 0!==t?(null!==this.domElement&&this.disconnect(),this.domElement=t):Jr("Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function Hp(t,e,i,r){const n=function(t){switch(t){case ye:case xe:return{byteLength:1,components:1};case Me:case be:case Ce:return{byteLength:2,components:1};case Ee:case Pe:return{byteLength:2,components:4};case we:case Se:case Te:return{byteLength:4,components:1};case De:case ke:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}(r);switch(i){case Re:return t*e;case Fe:case Ue:return t*e/n.components*n.byteLength;case We:case Be:return t*e*2/n.components*n.byteLength;case Ie:return t*e*3/n.components*n.byteLength;case Oe:case Ve:return t*e*4/n.components*n.byteLength;case He:case Ge:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case je:case Xe:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Ye:case Je:return Math.max(t,16)*Math.max(e,8)/4;case qe:case Ze:return Math.max(t,8)*Math.max(e,8)/2;case Ke:case $e:case ti:case ei:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Qe:case ii:case ri:case ni:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case si:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case oi:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case ai:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case ci:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case li:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case hi:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case ui:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case di:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case pi:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case fi:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case mi:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case gi:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case vi:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case _i:case yi:case xi:return Math.ceil(t/4)*Math.ceil(e/4)*16;case bi:case Mi:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Si:case wi:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}class Gp{static contain(t,e){return function(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}(t,e)}static cover(t,e){return function(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}(t,e)}static fill(t){return function(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}(t)}static getByteLength(t,e,i,r){return Hp(t,e,i,r)}}function jp(){let t=null,e=!1,i=null,r=null;function n(e,s){i(e,s),r=t.requestAnimationFrame(n)}return{start:function(){!0!==e&&null!==i&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Xp(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);const r=e.get(i);r&&(t.deleteBuffer(r.buffer),e.delete(i))},update:function(i,r){if(i.isInterleavedBufferAttribute&&(i=i.data),i.isGLBufferAttribute){const t=e.get(i);return void((!t||t.version<i.version)&&e.set(i,{buffer:i.buffer,type:i.type,bytesPerElement:i.elementSize,version:i.version}))}const n=e.get(i);if(void 0===n)e.set(i,function(e,i){const r=e.array,n=e.usage,s=r.byteLength,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,n),e.onUploadCallback(),r instanceof Float32Array)a=t.FLOAT;else if("undefined"!=typeof Float16Array&&r instanceof Float16Array)a=t.HALF_FLOAT;else if(r instanceof Uint16Array)a=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=t.SHORT;else if(r instanceof Uint32Array)a=t.UNSIGNED_INT;else if(r instanceof Int32Array)a=t.INT;else if(r instanceof Int8Array)a=t.BYTE;else if(r instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:s}}(i,r));else if(n.version<i.version){if(n.size!==i.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,i,r){const n=i.array,s=i.updateRanges;if(t.bindBuffer(r,e),0===s.length)t.bufferSubData(r,0,n);else{s.sort(((t,e)=>t.start-e.start));let e=0;for(let t=1;t<s.length;t++){const i=s[e],r=s[t];r.start<=i.start+i.count+1?i.count=Math.max(i.count,r.start+r.count-i.start):(++e,s[e]=r)}s.length=e+1;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.bufferSubData(r,i.start*n.BYTES_PER_ELEMENT,n,i.start,i.count)}i.clearUpdateRanges()}i.onUploadCallback()}(n.buffer,i,r),n.version=i.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:q}})),"undefined"!=typeof window&&(window.__THREE__?Jr("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=q);const qp={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.metalness = metalnessFactor;\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = vec3( 0.04 );\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"uniform sampler2D dfgLUT;\nstruct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tvec3 diffuseContribution;\n\tvec3 specularColor;\n\tvec3 specularColorBlended;\n\tfloat roughness;\n\tfloat metalness;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t\tvec3 iridescenceFresnelDielectric;\n\t\tvec3 iridescenceFresnelMetallic;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn v;\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColorBlended;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat rInv = 1.0 / ( roughness + 0.1 );\n\tfloat a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;\n\tfloat b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;\n\tfloat DG = exp( a * dotNV + b );\n\treturn saturate( DG );\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nvec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;\n\tvec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;\n\tvec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;\n\tvec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;\n\tfloat Ess_V = dfgV.x + dfgV.y;\n\tfloat Ess_L = dfgL.x + dfgL.y;\n\tfloat Ems_V = 1.0 - Ess_V;\n\tfloat Ems_L = 1.0 - Ess_L;\n\tvec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;\n\tvec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );\n\tfloat compensationFactor = Ems_V * Ems_L;\n\tvec3 multiScatter = Fms * compensationFactor;\n\treturn singleScatter + multiScatter;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n \n \t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n \n \t\tfloat sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n \t\tfloat sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );\n \n \t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );\n \n \t\tirradiance *= sheenEnergyComp;\n \n \t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tdiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectDiffuse += diffuse;\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;\n \t#endif\n\tvec3 singleScatteringDielectric = vec3( 0.0 );\n\tvec3 multiScatteringDielectric = vec3( 0.0 );\n\tvec3 singleScatteringMetallic = vec3( 0.0 );\n\tvec3 multiScatteringMetallic = vec3( 0.0 );\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#endif\n\tvec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );\n\tvec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );\n\tvec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;\n\tvec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tvec3 indirectSpecular = radiance * singleScattering;\n\tindirectSpecular += multiScattering * cosineWeightedIrradiance;\n\tvec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tindirectSpecular *= sheenEnergyComp;\n\t\tindirectDiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectSpecular += indirectSpecular;\n\treflectedLight.indirectDiffuse += indirectDiffuse;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );\n\t\tmaterial.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\t\t\tuniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat interleavedGradientNoise( vec2 position ) {\n\t\t\treturn fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );\n\t\t}\n\t\tvec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {\n\t\t\tconst float goldenAngle = 2.399963229728653;\n\t\t\tfloat r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );\n\t\t\tfloat theta = float( sampleIndex ) * goldenAngle + phi;\n\t\t\treturn vec2( cos( theta ), sin( theta ) ) * r;\n\t\t}\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\t\tfloat radius = shadowRadius * texelSize.x;\n\t\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )\n\t\t\t\t) * 0.2;\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;\n\t\t\t\tfloat mean = distribution.x;\n\t\t\t\tfloat variance = distribution.y * distribution.y;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tfloat hard_shadow = step( mean, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tfloat hard_shadow = step( shadowCoord.z, mean );\n\t\t\t\t#endif\n\t\t\t\tif ( hard_shadow == 1.0 ) {\n\t\t\t\t\tshadow = 1.0;\n\t\t\t\t} else {\n\t\t\t\t\tvariance = max( variance, 0.0000001 );\n\t\t\t\t\tfloat d = shadowCoord.z - mean;\n\t\t\t\t\tfloat p_max = variance / ( variance + d * d );\n\t\t\t\t\tp_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );\n\t\t\t\t\tshadow = max( hard_shadow, p_max );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#else\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tfloat depth = texture2D( shadowMap, shadowCoord.xy ).r;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tshadow = step( depth, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tshadow = step( shadowCoord.z, depth );\n\t\t\t\t#endif\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\tfloat getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat texelSize = shadowRadius / shadowMapSize.x;\n\t\t\tvec3 absDir = abs( bd3D );\n\t\t\tvec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );\n\t\t\ttangent = normalize( cross( bd3D, tangent ) );\n\t\t\tvec3 bitangent = cross( bd3D, tangent );\n\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\tshadow = (\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )\n\t\t\t) * 0.2;\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\tfloat getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat depth = textureCube( shadowMap, bd3D ).r;\n\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\tshadow = step( depth, dp );\n\t\t\t#else\n\t\t\t\tshadow = step( dp, depth );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#endif\n\t#endif\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distance_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distance_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n \n\t\toutgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;\n \n \t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Yp={common:{diffuse:{value:new so(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new vn},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new vn}},envmap:{envMap:{value:null},envMapRotation:{value:new vn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new vn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new vn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new vn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new vn},normalScale:{value:new dn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new vn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new vn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new vn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new vn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new so(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new so(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0},uvTransform:{value:new vn}},sprite:{diffuse:{value:new so(16777215)},opacity:{value:1},center:{value:new dn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new vn},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0}}},Zp={basic:{uniforms:$o([Yp.common,Yp.specularmap,Yp.envmap,Yp.aomap,Yp.lightmap,Yp.fog]),vertexShader:qp.meshbasic_vert,fragmentShader:qp.meshbasic_frag},lambert:{uniforms:$o([Yp.common,Yp.specularmap,Yp.envmap,Yp.aomap,Yp.lightmap,Yp.emissivemap,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,Yp.fog,Yp.lights,{emissive:{value:new so(0)}}]),vertexShader:qp.meshlambert_vert,fragmentShader:qp.meshlambert_frag},phong:{uniforms:$o([Yp.common,Yp.specularmap,Yp.envmap,Yp.aomap,Yp.lightmap,Yp.emissivemap,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,Yp.fog,Yp.lights,{emissive:{value:new so(0)},specular:{value:new so(1118481)},shininess:{value:30}}]),vertexShader:qp.meshphong_vert,fragmentShader:qp.meshphong_frag},standard:{uniforms:$o([Yp.common,Yp.envmap,Yp.aomap,Yp.lightmap,Yp.emissivemap,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,Yp.roughnessmap,Yp.metalnessmap,Yp.fog,Yp.lights,{emissive:{value:new so(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qp.meshphysical_vert,fragmentShader:qp.meshphysical_frag},toon:{uniforms:$o([Yp.common,Yp.aomap,Yp.lightmap,Yp.emissivemap,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,Yp.gradientmap,Yp.fog,Yp.lights,{emissive:{value:new so(0)}}]),vertexShader:qp.meshtoon_vert,fragmentShader:qp.meshtoon_frag},matcap:{uniforms:$o([Yp.common,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,Yp.fog,{matcap:{value:null}}]),vertexShader:qp.meshmatcap_vert,fragmentShader:qp.meshmatcap_frag},points:{uniforms:$o([Yp.points,Yp.fog]),vertexShader:qp.points_vert,fragmentShader:qp.points_frag},dashed:{uniforms:$o([Yp.common,Yp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qp.linedashed_vert,fragmentShader:qp.linedashed_frag},depth:{uniforms:$o([Yp.common,Yp.displacementmap]),vertexShader:qp.depth_vert,fragmentShader:qp.depth_frag},normal:{uniforms:$o([Yp.common,Yp.bumpmap,Yp.normalmap,Yp.displacementmap,{opacity:{value:1}}]),vertexShader:qp.meshnormal_vert,fragmentShader:qp.meshnormal_frag},sprite:{uniforms:$o([Yp.sprite,Yp.fog]),vertexShader:qp.sprite_vert,fragmentShader:qp.sprite_frag},background:{uniforms:{uvTransform:{value:new vn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qp.background_vert,fragmentShader:qp.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new vn}},vertexShader:qp.backgroundCube_vert,fragmentShader:qp.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qp.cube_vert,fragmentShader:qp.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qp.equirect_vert,fragmentShader:qp.equirect_frag},distance:{uniforms:$o([Yp.common,Yp.displacementmap,{referencePosition:{value:new fn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qp.distance_vert,fragmentShader:qp.distance_frag},shadow:{uniforms:$o([Yp.lights,Yp.fog,{color:{value:new so(0)},opacity:{value:1}}]),vertexShader:qp.shadow_vert,fragmentShader:qp.shadow_frag}};Zp.physical={uniforms:$o([Zp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new vn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new vn},clearcoatNormalScale:{value:new dn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new vn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new vn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new vn},sheen:{value:0},sheenColor:{value:new so(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new vn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new vn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new vn},transmissionSamplerSize:{value:new dn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new vn},attenuationDistance:{value:0},attenuationColor:{value:new so(0)},specularColor:{value:new so(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new vn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new vn},anisotropyVector:{value:new dn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new vn}}]),vertexShader:qp.meshphysical_vert,fragmentShader:qp.meshphysical_frag};const Jp={r:0,b:0,g:0},Kp=new Ss,$p=new ps;function Qp(t,e,i,r,n,s,o){const a=new so(0);let c,l,h=!0===s?0:1,u=null,d=0,p=null;function f(t){let r=!0===t.isScene?t.background:null;return r&&r.isTexture&&(r=(t.backgroundBlurriness>0?i:e).get(r)),r}function m(e,i){e.getRGB(Jp,Qo(t)),r.buffers.color.setClear(Jp.r,Jp.g,Jp.b,i,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(a,h)},render:function(e){let i=!1;const n=f(e);null===n?m(a,h):n&&n.isColor&&(m(n,1),i=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===s&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||i)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,i){const r=f(i);r&&(r.isCubeTexture||r.mapping===se)?(void 0===l&&(l=new Yo(new Jo(1,1,1),new ea({name:"BackgroundCubeMaterial",uniforms:Ko(Zp.backgroundCube.uniforms),vertexShader:Zp.backgroundCube.vertexShader,fragmentShader:Zp.backgroundCube.fragmentShader,side:st,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),Kp.copy(i.backgroundRotation),Kp.x*=-1,Kp.y*=-1,Kp.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(Kp.y*=-1,Kp.z*=-1),l.material.uniforms.envMap.value=r,l.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=i.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4($p.makeRotationFromEuler(Kp)),l.material.toneMapped=Mn.getTransfer(r.colorSpace)!==Zi,u===r&&d===r.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=r,d=r.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null)):r&&r.isTexture&&(void 0===c&&(c=new Yo(new Dh(2,2),new ea({name:"BackgroundMaterial",uniforms:Ko(Zp.background.uniforms),vertexShader:Zp.background.vertexShader,fragmentShader:Zp.background.fragmentShader,side:nt,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=r,c.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,c.material.toneMapped=Mn.getTransfer(r.colorSpace)!==Zi,!0===r.matrixAutoUpdate&&r.updateMatrix(),c.material.uniforms.uvTransform.value.copy(r.matrix),u===r&&d===r.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=r,d=r.version,p=t.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null))},dispose:function(){void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0),void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}}}function tf(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},n=l(null);let s=n,o=!1;function a(e){return t.bindVertexArray(e)}function c(e){return t.deleteVertexArray(e)}function l(t){const e=[],r=[],n=[];for(let t=0;t<i;t++)e[t]=0,r[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:r,attributeDivisors:n,object:t,attributes:{},index:null}}function h(){const t=s.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function u(t){d(t,0)}function d(e,i){const r=s.newAttributes,n=s.enabledAttributes,o=s.attributeDivisors;r[e]=1,0===n[e]&&(t.enableVertexAttribArray(e),n[e]=1),o[e]!==i&&(t.vertexAttribDivisor(e,i),o[e]=i)}function p(){const e=s.newAttributes,i=s.enabledAttributes;for(let r=0,n=i.length;r<n;r++)i[r]!==e[r]&&(t.disableVertexAttribArray(r),i[r]=0)}function f(e,i,r,n,s,o,a){!0===a?t.vertexAttribIPointer(e,i,r,s,o):t.vertexAttribPointer(e,i,r,n,s,o)}function m(){g(),o=!0,s!==n&&(s=n,a(s.object))}function g(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:function(i,n,c,m,g){let v=!1;const _=function(e,i,n){const s=!0===n.wireframe;let o=r[e.id];void 0===o&&(o={},r[e.id]=o);let a=o[i.id];void 0===a&&(a={},o[i.id]=a);let c=a[s];return void 0===c&&(c=l(t.createVertexArray()),a[s]=c),c}(m,c,n);s!==_&&(s=_,a(s.object)),v=function(t,e,i,r){const n=s.attributes,o=e.attributes;let a=0;const c=i.getAttributes();for(const e in c)if(c[e].location>=0){const i=n[e];let r=o[e];if(void 0===r&&("instanceMatrix"===e&&t.instanceMatrix&&(r=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(r=t.instanceColor)),void 0===i)return!0;if(i.attribute!==r)return!0;if(r&&i.data!==r.data)return!0;a++}return s.attributesNum!==a||s.index!==r}(i,m,c,g),v&&function(t,e,i,r){const n={},o=e.attributes;let a=0;const c=i.getAttributes();for(const e in c)if(c[e].location>=0){let i=o[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const r={};r.attribute=i,i&&i.data&&(r.data=i.data),n[e]=r,a++}s.attributes=n,s.attributesNum=a,s.index=r}(i,m,c,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(i,r,n,s){h();const o=s.attributes,a=n.getAttributes(),c=r.defaultAttributeValues;for(const r in a){const n=a[r];if(n.location>=0){let a=o[r];if(void 0===a&&("instanceMatrix"===r&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===r&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const r=a.normalized,o=a.itemSize,c=e.get(a);if(void 0===c)continue;const l=c.buffer,h=c.type,p=c.bytesPerElement,m=h===t.INT||h===t.UNSIGNED_INT||a.gpuType===Se;if(a.isInterleavedBufferAttribute){const e=a.data,c=e.stride,g=a.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)d(n.location+t,e.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<n.locationSize;t++)u(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<n.locationSize;t++)f(n.location+t,o/n.locationSize,h,r,c*p,(g+o/n.locationSize*t)*p,m)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)d(n.location+t,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<n.locationSize;t++)u(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<n.locationSize;t++)f(n.location+t,o/n.locationSize,h,r,o*p,o/n.locationSize*t*p,m)}}else if(void 0!==c){const e=c[r];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(n.location,e);break;case 3:t.vertexAttrib3fv(n.location,e);break;case 4:t.vertexAttrib4fv(n.location,e);break;default:t.vertexAttrib1fv(n.location,e)}}}}p()}(i,n,c,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in r){const e=r[t];for(const t in e){const i=e[t];for(const t in i)c(i[t].object),delete i[t];delete e[t]}delete r[t]}},releaseStatesOfGeometry:function(t){if(void 0===r[t.id])return;const e=r[t.id];for(const t in e){const i=e[t];for(const t in i)c(i[t].object),delete i[t];delete e[t]}delete r[t.id]},releaseStatesOfProgram:function(t){for(const e in r){const i=r[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)c(n[t].object),delete n[t];delete i[t.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function ef(t,e,i){let r;function n(e,n,s){0!==s&&(t.drawArraysInstanced(r,e,n,s),i.update(n,r,s))}this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.update(n,r,1)},this.renderInstances=n,this.renderMultiDraw=function(t,n,s){if(0===s)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,t,0,n,0,s);let o=0;for(let t=0;t<s;t++)o+=n[t];i.update(o,r,1)},this.renderMultiDrawInstances=function(t,s,o,a){if(0===o)return;const c=e.get("WEBGL_multi_draw");if(null===c)for(let e=0;e<t.length;e++)n(t[e],s[e],a[e]);else{c.multiDrawArraysInstancedWEBGL(r,t,0,s,0,a,0,o);let e=0;for(let t=0;t<o;t++)e+=s[t]*a[t];i.update(e,r,1)}}}function rf(t,e,i,r){let n;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==i.precision?i.precision:"highp";const a=s(o);return a!==o&&(Jr("WebGLRenderer:",o,"not supported, using",a,"instead."),o=a),{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,textureFormatReadable:function(e){return e===Oe||r.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(i){const n=i===Ce&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(i!==ye&&r.convert(i)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&i!==Te&&!n)},precision:o,logarithmicDepthBuffer:!0===i.logarithmicDepthBuffer,reversedDepthBuffer:!0===i.reversedDepthBuffer&&e.has("EXT_clip_control"),maxTextures:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),maxSamples:t.getParameter(t.MAX_SAMPLES),samples:t.getParameter(t.SAMPLES)}}function nf(t){const e=this;let i=null,r=0,n=!1,s=!1;const o=new dc,a=new vn,c={value:null,needsUpdate:!1};function l(t,i,r,n){const s=null!==t?t.length:0;let l=null;if(0!==s){if(l=c.value,!0!==n||null===l){const e=r+4*s,n=i.matrixWorldInverse;a.getNormalMatrix(n),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,i=r;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(n,a),o.normal.toArray(l,i),l[i+3]=o.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==r||n;return n=e,r=t.length,i},this.beginShadows=function(){s=!0,l(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){i=l(t,e,0)},this.setState=function(o,a,h){const u=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!n||null===u||0===u.length||s&&!p)s?l(null):(c.value!==i&&(c.value=i,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0);else{const t=s?0:r,e=4*t;let n=f.clippingState||null;c.value=n,n=l(u,a,e,h);for(let t=0;t!==e;++t)n[t]=i[t];f.clippingState=n,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function sf(t){let e=new WeakMap;function i(t,e){return e===re?t.mapping=ee:e===ne&&(t.mapping=ie),t}function r(t){const i=t.target;i.removeEventListener("dispose",r);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture){const s=n.mapping;if(s===re||s===ne){if(e.has(n))return i(e.get(n).texture,n.mapping);{const s=n.image;if(s&&s.height>0){const o=new ha(s.height);return o.fromEquirectangularTexture(t,n),e.set(n,o),n.addEventListener("dispose",r),i(o.texture,n.mapping)}return null}}}return n},dispose:function(){e=new WeakMap}}}const of=[.125,.215,.35,.446,.526,.582],af=new Vu,cf=new so;let lf=null,hf=0,uf=0,df=!1;const pf=new fn;class ff{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(t,e=0,i=.1,r=100,n={}){const{size:s=256,position:o=pf}=n;lf=this._renderer.getRenderTarget(),hf=this._renderer.getActiveCubeFace(),uf=this._renderer.getActiveMipmapLevel(),df=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(t,i,r,a,o),e>0&&this._blur(a,0,0,e),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=_f(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=vf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodMeshes.length;t++)this._lodMeshes[t].geometry.dispose()}_cleanup(t){this._renderer.setRenderTarget(lf,hf,uf),this._renderer.xr.enabled=df,t.scissorTest=!1,gf(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===ee||t.mapping===ie?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),lf=this._renderer.getRenderTarget(),hf=this._renderer.getActiveCubeFace(),uf=this._renderer.getActiveMipmapLevel(),df=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Ce,format:Oe,colorSpace:qi,depthBuffer:!1},r=mf(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=mf(t,e,i);const{_lodMax:r}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(t){const e=[],i=[],r=[];let n=t;const s=t-4+1+of.length;for(let o=0;o<s;o++){const s=Math.pow(2,n);e.push(s);let a=1/s;o>t-4?a=of[o-t+4-1]:0===o&&(a=0),i.push(a);const c=1/(s-2),l=-c,h=1+c,u=[l,l,h,l,h,h,l,l,h,h,l,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),_=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,r=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(r,f*p*t),_.set(u,m*p*t);const n=[t,t,t,t,t,t];y.set(n,g*p*t)}const x=new No;x.setAttribute("position",new yo(v,f)),x.setAttribute("uv",new yo(_,m)),x.setAttribute("faceIndex",new yo(y,g)),r.push(new Yo(x,null)),n>4&&n--}return{lodMeshes:r,sizeLods:e,sigmas:i}}(r)),this._blurMaterial=function(t,e,i){const r=new Float32Array(20),n=new fn(0,1,0);return new ea({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}(r,t,e),this._ggxMaterial=function(t,e,i){return new ea({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:256,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:'\n\n\t\t\tprecision highp float;\n\t\t\tprecision highp int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform float roughness;\n\t\t\tuniform float mipInt;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\t#define PI 3.14159265359\n\n\t\t\t// Van der Corput radical inverse\n\t\t\tfloat radicalInverse_VdC(uint bits) {\n\t\t\t\tbits = (bits << 16u) | (bits >> 16u);\n\t\t\t\tbits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n\t\t\t\tbits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n\t\t\t\tbits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n\t\t\t\tbits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n\t\t\t\treturn float(bits) * 2.3283064365386963e-10; // / 0x100000000\n\t\t\t}\n\n\t\t\t// Hammersley sequence\n\t\t\tvec2 hammersley(uint i, uint N) {\n\t\t\t\treturn vec2(float(i) / float(N), radicalInverse_VdC(i));\n\t\t\t}\n\n\t\t\t// GGX VNDF importance sampling (Eric Heitz 2018)\n\t\t\t// "Sampling the GGX Distribution of Visible Normals"\n\t\t\t// https://jcgt.org/published/0007/04/01/\n\t\t\tvec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {\n\t\t\t\tfloat alpha = roughness * roughness;\n\n\t\t\t\t// Section 3.2: Transform view direction to hemisphere configuration\n\t\t\t\tvec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));\n\n\t\t\t\t// Section 4.1: Orthonormal basis\n\t\t\t\tfloat lensq = Vh.x * Vh.x + Vh.y * Vh.y;\n\t\t\t\tvec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 T2 = cross(Vh, T1);\n\n\t\t\t\t// Section 4.2: Parameterization of projected area\n\t\t\t\tfloat r = sqrt(Xi.x);\n\t\t\t\tfloat phi = 2.0 * PI * Xi.y;\n\t\t\t\tfloat t1 = r * cos(phi);\n\t\t\t\tfloat t2 = r * sin(phi);\n\t\t\t\tfloat s = 0.5 * (1.0 + Vh.z);\n\t\t\t\tt2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;\n\n\t\t\t\t// Section 4.3: Reprojection onto hemisphere\n\t\t\t\tvec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;\n\n\t\t\t\t// Section 3.4: Transform back to ellipsoid configuration\n\t\t\t\treturn normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\tvec3 N = normalize(vOutputDirection);\n\t\t\t\tvec3 V = N; // Assume view direction equals normal for pre-filtering\n\n\t\t\t\tvec3 prefilteredColor = vec3(0.0);\n\t\t\t\tfloat totalWeight = 0.0;\n\n\t\t\t\t// For very low roughness, just sample the environment directly\n\t\t\t\tif (roughness < 0.001) {\n\t\t\t\t\tgl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Tangent space basis for VNDF sampling\n\t\t\t\tvec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 tangent = normalize(cross(up, N));\n\t\t\t\tvec3 bitangent = cross(N, tangent);\n\n\t\t\t\tfor(uint i = 0u; i < uint(GGX_SAMPLES); i++) {\n\t\t\t\t\tvec2 Xi = hammersley(i, uint(GGX_SAMPLES));\n\n\t\t\t\t\t// For PMREM, V = N, so in tangent space V is always (0, 0, 1)\n\t\t\t\t\tvec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);\n\n\t\t\t\t\t// Transform H back to world space\n\t\t\t\t\tvec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);\n\t\t\t\t\tvec3 L = normalize(2.0 * dot(V, H) * H - V);\n\n\t\t\t\t\tfloat NdotL = max(dot(N, L), 0.0);\n\n\t\t\t\t\tif(NdotL > 0.0) {\n\t\t\t\t\t\t// Sample environment at fixed mip level\n\t\t\t\t\t\t// VNDF importance sampling handles the distribution filtering\n\t\t\t\t\t\tvec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);\n\n\t\t\t\t\t\t// Weight by NdotL for the split-sum approximation\n\t\t\t\t\t\t// VNDF PDF naturally accounts for the visible microfacet distribution\n\t\t\t\t\t\tprefilteredColor += sampleColor * NdotL;\n\t\t\t\t\t\ttotalWeight += NdotL;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (totalWeight > 0.0) {\n\t\t\t\t\tprefilteredColor = prefilteredColor / totalWeight;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = vec4(prefilteredColor, 1.0);\n\t\t\t}\n\t\t',blending:at,depthTest:!1,depthWrite:!1})}(r,t,e)}return r}_compileMaterial(t){const e=new Yo(new No,t);this._renderer.compile(e,af)}_sceneToCubeUV(t,e,i,r,n){const s=new oa(90,1,e,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],c=this._renderer,l=c.autoClear,h=c.toneMapping;c.getClearColor(cf),c.toneMapping=Gt,c.autoClear=!1,c.state.buffers.depth.getReversed()&&(c.setRenderTarget(r),c.clearDepth(),c.setRenderTarget(null)),null===this._backgroundBox&&(this._backgroundBox=new Yo(new Jo,new lo({name:"PMREM.Background",side:st,depthWrite:!1,depthTest:!1})));const u=this._backgroundBox,d=u.material;let p=!1;const f=t.background;f?f.isColor&&(d.color.copy(f),t.background=null,p=!0):(d.color.copy(cf),p=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,o[e],0),s.position.set(n.x,n.y,n.z),s.lookAt(n.x+a[e],n.y,n.z)):1===i?(s.up.set(0,0,o[e]),s.position.set(n.x,n.y,n.z),s.lookAt(n.x,n.y+a[e],n.z)):(s.up.set(0,o[e],0),s.position.set(n.x,n.y,n.z),s.lookAt(n.x,n.y,n.z+a[e]));const l=this._cubeSize;gf(r,i*l,e>2?l:0,l,l),c.setRenderTarget(r),p&&c.render(u,s),c.render(t,s)}c.toneMapping=h,c.autoClear=l,t.background=f}_textureToCubeUV(t,e){const i=this._renderer,r=t.mapping===ee||t.mapping===ie;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=_f()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=vf());const n=r?this._cubemapMaterial:this._equirectMaterial,s=this._lodMeshes[0];s.material=n,n.uniforms.envMap.value=t;const o=this._cubeSize;gf(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,af)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const r=this._lodMeshes.length;for(let e=1;e<r;e++)this._applyGGXFilter(t,e-1,e);e.autoClear=i}_applyGGXFilter(t,e,i){const r=this._renderer,n=this._pingPongRenderTarget,s=this._ggxMaterial,o=this._lodMeshes[i];o.material=s;const a=s.uniforms,c=i/(this._lodMeshes.length-1),l=e/(this._lodMeshes.length-1),h=Math.sqrt(c*c-l*l)*(0+1.25*c),{_lodMax:u}=this,d=this._sizeLods[i],p=3*d*(i>u-4?i-u+4:0),f=4*(this._cubeSize-d);a.envMap.value=t.texture,a.roughness.value=h,a.mipInt.value=u-e,gf(n,p,f,3*d,2*d),r.setRenderTarget(n),r.render(o,af),a.envMap.value=n.texture,a.roughness.value=0,a.mipInt.value=u-i,gf(t,p,f,3*d,2*d),r.setRenderTarget(t),r.render(o,af)}_blur(t,e,i,r,n){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,r,"latitudinal",n),this._halfBlur(s,t,i,i,r,"longitudinal",n)}_halfBlur(t,e,i,r,n,s,o){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&Kr("blur direction must be either latitudinal or longitudinal!");const l=this._lodMeshes[r];l.material=c;const h=c.uniforms,u=this._sizeLods[i]-1,d=isFinite(n)?Math.PI/(2*u):2*Math.PI/39,p=n/d,f=isFinite(n)?1+Math.floor(3*p):20;f>20&&Jr(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;const _=this._sizeLods[r];gf(e,3*_*(r>v-4?r-v+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(e),a.render(l,af)}}function mf(t,e,i){const r=new Ln(t,e,i);return r.texture.mapping=se,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function gf(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function vf(){return new ea({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}function _f(){return new ea({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:at,depthTest:!1,depthWrite:!1})}function yf(t){let e=new WeakMap,i=null;function r(t){const i=t.target;i.removeEventListener("dispose",r);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture){const s=n.mapping,o=s===re||s===ne,a=s===ee||s===ie;if(o||a){let s=e.get(n);const c=void 0!==s?s.texture.pmremVersion:0;if(n.isRenderTargetTexture&&n.pmremVersion!==c)return null===i&&(i=new ff(t)),s=o?i.fromEquirectangular(n,s):i.fromCubemap(n,s),s.texture.pmremVersion=n.pmremVersion,e.set(n,s),s.texture;if(void 0!==s)return s.texture;{const c=n.image;return o&&c&&c.height>0||a&&c&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(c)?(null===i&&(i=new ff(t)),s=o?i.fromEquirectangular(n):i.fromCubemap(n),s.texture.pmremVersion=n.pmremVersion,e.set(n,s),n.addEventListener("dispose",r),s.texture):null}}}return n},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function xf(t){const e={};function i(i){if(void 0!==e[i])return e[i];const r=t.getExtension(i);return e[i]=r,r}return{has:function(t){return null!==i(t)},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(t){const e=i(t);return null===e&&$r("WebGLRenderer: "+t+" extension not supported."),e}}}function bf(t,e,i,r){const n={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete n[a.id];const c=s.get(a);c&&(e.remove(c),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],r=t.index,n=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],n=t[e+1],s=t[e+2];i.push(r,n,n,s,s,r)}}else{if(void 0===n)return;{const t=n.array;o=n.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,n=e+2;i.push(t,r,r,n,n,t)}}}const a=new(Wr(i)?Co:wo)(i,1);a.version=o;const c=s.get(t);c&&e.remove(c),s.set(t,a)}return{get:function(t,e){return!0===n[e.id]||(e.addEventListener("dispose",o),n[e.id]=!0,i.memory.geometries++),e},update:function(i){const r=i.attributes;for(const i in r)e.update(r[i],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return s.get(t)}}}function Mf(t,e,i){let r,n,s;function o(e,o,a){0!==a&&(t.drawElementsInstanced(r,o,n,e*s,a),i.update(o,r,a))}this.setMode=function(t){r=t},this.setIndex=function(t){n=t.type,s=t.bytesPerElement},this.render=function(e,o){t.drawElements(r,o,n,e*s),i.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(t,s,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,s,0,n,t,0,o);let a=0;for(let t=0;t<o;t++)a+=s[t];i.update(a,r,1)},this.renderMultiDrawInstances=function(t,a,c,l){if(0===c)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<t.length;e++)o(t[e]/s,a[e],l[e]);else{h.multiDrawElementsInstancedWEBGL(r,a,0,n,t,0,l,0,c);let e=0;for(let t=0;t<c;t++)e+=a[t]*l[t];i.update(e,r,1)}}}function Sf(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,r,n){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=n*(i/3);break;case t.LINES:e.lines+=n*(i/2);break;case t.LINE_STRIP:e.lines+=n*(i-1);break;case t.LINE_LOOP:e.lines+=n*i;break;case t.POINTS:e.points+=n*i;break;default:Kr("WebGLInfo: Unknown draw mode:",r)}}}}function wf(t,e,i){const r=new WeakMap,n=new In;return{update:function(s,o,a){const c=s.morphTargetInfluences,l=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=void 0!==l?l.length:0;let u=r.get(o);if(void 0===u||u.count!==h){void 0!==u&&u.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let _=0;!0===d&&(_=1),!0===p&&(_=2),!0===f&&(_=3);let y=o.attributes.position.count*_,x=1;y>e.maxTextureSize&&(x=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const b=new Float32Array(y*x*4*h),M=new Nn(b,y,x,h);M.type=Te,M.needsUpdate=!0;const S=4*_;for(let T=0;T<h;T++){const C=m[T],E=g[T],P=v[T],A=y*x*4*T;for(let D=0;D<C.count;D++){const k=D*S;!0===d&&(n.fromBufferAttribute(C,D),b[A+k+0]=n.x,b[A+k+1]=n.y,b[A+k+2]=n.z,b[A+k+3]=0),!0===p&&(n.fromBufferAttribute(E,D),b[A+k+4]=n.x,b[A+k+5]=n.y,b[A+k+6]=n.z,b[A+k+7]=0),!0===f&&(n.fromBufferAttribute(P,D),b[A+k+8]=n.x,b[A+k+9]=n.y,b[A+k+10]=n.z,b[A+k+11]=4===P.itemSize?n.w:1)}}function w(){M.dispose(),r.delete(o),o.removeEventListener("dispose",w)}u={count:h,texture:M,size:new dn(y,x)},r.set(o,u),o.addEventListener("dispose",w)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)a.getUniforms().setValue(t,"morphTexture",s.morphTexture,i);else{let R=0;for(let O=0;O<c.length;O++)R+=c[O];const I=o.morphTargetsRelative?1:1-R;a.getUniforms().setValue(t,"morphTargetBaseInfluence",I),a.getUniforms().setValue(t,"morphTargetInfluences",c)}a.getUniforms().setValue(t,"morphTargetsTexture",u.texture,i),a.getUniforms().setValue(t,"morphTargetsTextureSize",u.size)}}}function Tf(t,e,i,r){let n=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=r.render.frame,c=o.geometry,l=e.get(o,c);if(n.get(l)!==a&&(e.update(l),n.set(l,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),n.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),n.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;n.get(t)!==a&&(t.update(),n.set(t,a))}return l},dispose:function(){n=new WeakMap}}}const Cf={[jt]:"LINEAR_TONE_MAPPING",[Xt]:"REINHARD_TONE_MAPPING",[qt]:"CINEON_TONE_MAPPING",[Yt]:"ACES_FILMIC_TONE_MAPPING",[Jt]:"AGX_TONE_MAPPING",[Kt]:"NEUTRAL_TONE_MAPPING",[Zt]:"CUSTOM_TONE_MAPPING"};function Ef(t,e,i,r,n){const s=new Ln(e,i,{type:t,depthBuffer:r,stencilBuffer:n}),o=new Ln(e,i,{type:Ce,depthBuffer:!1,stencilBuffer:!1}),a=new No;a.setAttribute("position",new Po([-1,3,0,-1,-1,0,3,-1,0],3)),a.setAttribute("uv",new Po([0,2,0,0,2,0],2));const c=new Vh({uniforms:{tDiffuse:{value:null}},vertexShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main() {\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}",fragmentShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform sampler2D tDiffuse;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\t#include <tonemapping_pars_fragment>\n\t\t\t#include <colorspace_pars_fragment>\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t\t#ifdef LINEAR_TONE_MAPPING\n\t\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( AGX_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CUSTOM_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef SRGB_TRANSFER\n\t\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\t\t\t\t#endif\n\t\t\t}",depthTest:!1,depthWrite:!1}),l=new Yo(a,c),h=new Vu(-1,1,1,-1,0,1);let u,d=null,p=null,f=!1,m=null,g=[],v=!1;this.setSize=function(t,e){s.setSize(t,e),o.setSize(t,e);for(let i=0;i<g.length;i++){const r=g[i];r.setSize&&r.setSize(t,e)}},this.setEffects=function(t){g=t,v=g.length>0&&!0===g[0].isRenderPass;const e=s.width,i=s.height;for(let t=0;t<g.length;t++){const r=g[t];r.setSize&&r.setSize(e,i)}},this.begin=function(t,e){if(f)return!1;if(t.toneMapping===Gt&&0===g.length)return!1;if(m=e,null!==e){const t=e.width,i=e.height;s.width===t&&s.height===i||this.setSize(t,i)}return!1===v&&t.setRenderTarget(s),u=t.toneMapping,t.toneMapping=Gt,!0},this.hasRenderPass=function(){return v},this.end=function(t,e){t.toneMapping=u,f=!0;let i=s,r=o;for(let n=0;n<g.length;n++){const s=g[n];if(!1!==s.enabled&&(s.render(t,r,i,e),!1!==s.needsSwap)){const t=i;i=r,r=t}}if(d!==t.outputColorSpace||p!==t.toneMapping){d=t.outputColorSpace,p=t.toneMapping,c.defines={},Mn.getTransfer(d)===Zi&&(c.defines.SRGB_TRANSFER="");const e=Cf[p];e&&(c.defines[e]=""),c.needsUpdate=!0}c.uniforms.tDiffuse.value=i.texture,t.setRenderTarget(m),t.render(l,h),m=null,f=!1},this.isCompositing=function(){return f},this.dispose=function(){s.dispose(),o.dispose(),a.dispose(),c.dispose()}}const Pf=new Rn,Af=new pl(1,1),Df=new Nn,kf=new Un,Rf=new la,If=[],Of=[],Lf=new Float32Array(16),Nf=new Float32Array(9),Ff=new Float32Array(4);function Uf(t,e,i){const r=t[0];if(r<=0||r>0)return t;const n=e*i;let s=If[n];if(void 0===s&&(s=new Float32Array(n),If[n]=s),0!==e){r.toArray(s,0);for(let r=1,n=0;r!==e;++r)n+=i,t[r].toArray(s,n)}return s}function Wf(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function Bf(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function zf(t,e){let i=Of[e];void 0===i&&(i=new Int32Array(e),Of[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function Vf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Hf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Wf(i,e))return;t.uniform2fv(this.addr,e),Bf(i,e)}}function Gf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Wf(i,e))return;t.uniform3fv(this.addr,e),Bf(i,e)}}function jf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Wf(i,e))return;t.uniform4fv(this.addr,e),Bf(i,e)}}function Xf(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(Wf(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Bf(i,e)}else{if(Wf(i,r))return;Ff.set(r),t.uniformMatrix2fv(this.addr,!1,Ff),Bf(i,r)}}function qf(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(Wf(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Bf(i,e)}else{if(Wf(i,r))return;Nf.set(r),t.uniformMatrix3fv(this.addr,!1,Nf),Bf(i,r)}}function Yf(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(Wf(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Bf(i,e)}else{if(Wf(i,r))return;Lf.set(r),t.uniformMatrix4fv(this.addr,!1,Lf),Bf(i,r)}}function Zf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Jf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Wf(i,e))return;t.uniform2iv(this.addr,e),Bf(i,e)}}function Kf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Wf(i,e))return;t.uniform3iv(this.addr,e),Bf(i,e)}}function $f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Wf(i,e))return;t.uniform4iv(this.addr,e),Bf(i,e)}}function Qf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function tm(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Wf(i,e))return;t.uniform2uiv(this.addr,e),Bf(i,e)}}function em(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Wf(i,e))return;t.uniform3uiv(this.addr,e),Bf(i,e)}}function im(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Wf(i,e))return;t.uniform4uiv(this.addr,e),Bf(i,e)}}function rm(t,e,i){const r=this.cache,n=i.allocateTextureUnit();let s;r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),this.type===t.SAMPLER_2D_SHADOW?(Af.compareFunction=i.isReversedDepthBuffer()?br:_r,s=Af):s=Pf,i.setTexture2D(e||s,n)}function nm(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||kf,n)}function sm(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||Rf,n)}function om(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||Df,n)}function am(t,e){t.uniform1fv(this.addr,e)}function cm(t,e){const i=Uf(e,this.size,2);t.uniform2fv(this.addr,i)}function lm(t,e){const i=Uf(e,this.size,3);t.uniform3fv(this.addr,i)}function hm(t,e){const i=Uf(e,this.size,4);t.uniform4fv(this.addr,i)}function um(t,e){const i=Uf(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function dm(t,e){const i=Uf(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function pm(t,e){const i=Uf(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function fm(t,e){t.uniform1iv(this.addr,e)}function mm(t,e){t.uniform2iv(this.addr,e)}function gm(t,e){t.uniform3iv(this.addr,e)}function vm(t,e){t.uniform4iv(this.addr,e)}function _m(t,e){t.uniform1uiv(this.addr,e)}function ym(t,e){t.uniform2uiv(this.addr,e)}function xm(t,e){t.uniform3uiv(this.addr,e)}function bm(t,e){t.uniform4uiv(this.addr,e)}function Mm(t,e,i){const r=this.cache,n=e.length,s=zf(i,n);let o;Wf(r,s)||(t.uniform1iv(this.addr,s),Bf(r,s)),o=this.type===t.SAMPLER_2D_SHADOW?Af:Pf;for(let t=0;t!==n;++t)i.setTexture2D(e[t]||o,s[t])}function Sm(t,e,i){const r=this.cache,n=e.length,s=zf(i,n);Wf(r,s)||(t.uniform1iv(this.addr,s),Bf(r,s));for(let t=0;t!==n;++t)i.setTexture3D(e[t]||kf,s[t])}function wm(t,e,i){const r=this.cache,n=e.length,s=zf(i,n);Wf(r,s)||(t.uniform1iv(this.addr,s),Bf(r,s));for(let t=0;t!==n;++t)i.setTextureCube(e[t]||Rf,s[t])}function Tm(t,e,i){const r=this.cache,n=e.length,s=zf(i,n);Wf(r,s)||(t.uniform1iv(this.addr,s),Bf(r,s));for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||Df,s[t])}class Cm{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Vf;case 35664:return Hf;case 35665:return Gf;case 35666:return jf;case 35674:return Xf;case 35675:return qf;case 35676:return Yf;case 5124:case 35670:return Zf;case 35667:case 35671:return Jf;case 35668:case 35672:return Kf;case 35669:case 35673:return $f;case 5125:return Qf;case 36294:return tm;case 36295:return em;case 36296:return im;case 35678:case 36198:case 36298:case 36306:case 35682:return rm;case 35679:case 36299:case 36307:return nm;case 35680:case 36300:case 36308:case 36293:return sm;case 36289:case 36303:case 36311:case 36292:return om}}(e.type)}}class Em{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return am;case 35664:return cm;case 35665:return lm;case 35666:return hm;case 35674:return um;case 35675:return dm;case 35676:return pm;case 5124:case 35670:return fm;case 35667:case 35671:return mm;case 35668:case 35672:return gm;case 35669:case 35673:return vm;case 5125:return _m;case 36294:return ym;case 36295:return xm;case 36296:return bm;case 35678:case 36198:case 36298:case 36306:case 35682:return Mm;case 35679:case 36299:case 36307:return Sm;case 35680:case 36300:case 36308:case 36293:return wm;case 36289:case 36303:case 36311:case 36292:return Tm}}(e.type)}}class Pm{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const r=this.seq;for(let n=0,s=r.length;n!==s;++n){const s=r[n];s.setValue(t,e[s.id],i)}}}const Am=/(\w+)(\])?(\[|\.)?/g;function Dm(t,e){t.seq.push(e),t.map[e.id]=e}function km(t,e,i){const r=t.name,n=r.length;for(Am.lastIndex=0;;){const s=Am.exec(r),o=Am.lastIndex;let a=s[1];const c="]"===s[2],l=s[3];if(c&&(a|=0),void 0===l||"["===l&&o+2===n){Dm(i,void 0===l?new Cm(a,t,e):new Em(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new Pm(a),Dm(i,t)),i=t}}}class Rm{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const i=t.getActiveUniform(e,r);km(i,t.getUniformLocation(e,i.name),this)}const r=[],n=[];for(const e of this.seq)e.type===t.SAMPLER_2D_SHADOW||e.type===t.SAMPLER_CUBE_SHADOW||e.type===t.SAMPLER_2D_ARRAY_SHADOW?r.push(e):n.push(e);r.length>0&&(this.seq=r.concat(n))}setValue(t,e,i,r){const n=this.map[e];void 0!==n&&n.setValue(t,i,r)}setOptional(t,e,i){const r=e[i];void 0!==r&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let n=0,s=e.length;n!==s;++n){const s=e[n],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}}static seqWithValue(t,e){const i=[];for(let r=0,n=t.length;r!==n;++r){const n=t[r];n.id in e&&i.push(n)}return i}}function Im(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}const Om=37297;let Lm=0;const Nm=new vn;function Fm(t,e,i){const r=t.getShaderParameter(e,t.COMPILE_STATUS),n=(t.getShaderInfoLog(e)||"").trim();if(r&&""===n)return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const r=parseInt(s[1]);return i.toUpperCase()+"\n\n"+n+"\n\n"+function(t,e){const i=t.split("\n"),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=n;t<s;t++){const n=t+1;r.push(`${n===e?">":" "} ${n}: ${i[t]}`)}return r.join("\n")}(t.getShaderSource(e),r)}return n}function Um(t,e){const i=function(t){Mn._getMatrix(Nm,Mn.workingColorSpace,t);const e=`mat3( ${Nm.elements.map((t=>t.toFixed(4)))} )`;switch(Mn.getTransfer(t)){case Yi:return[e,"LinearTransferOETF"];case Zi:return[e,"sRGBTransferOETF"];default:return Jr("WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${t}( vec4 value ) {`,`\treturn ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join("\n")}const Wm={[jt]:"Linear",[Xt]:"Reinhard",[qt]:"Cineon",[Yt]:"ACESFilmic",[Jt]:"AgX",[Kt]:"Neutral",[Zt]:"Custom"};function Bm(t,e){const i=Wm[e];return void 0===i?(Jr("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+t+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const zm=new fn;function Vm(t){return""!==t}function Hm(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Gm(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const jm=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xm(t){return t.replace(jm,Ym)}const qm=new Map;function Ym(t,e){let i=qp[e];if(void 0===i){const t=qm.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=qp[t],Jr('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Xm(i)}const Zm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Jm(t){return t.replace(Zm,Km)}function Km(t,e,i,r){let n="";for(let t=parseInt(e);t<parseInt(i);t++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return n}function $m(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}const Qm={[et]:"SHADOWMAP_TYPE_PCF",[rt]:"SHADOWMAP_TYPE_VSM"},tg={[ee]:"ENVMAP_TYPE_CUBE",[ie]:"ENVMAP_TYPE_CUBE",[se]:"ENVMAP_TYPE_CUBE_UV"},eg={[ie]:"ENVMAP_MODE_REFRACTION"},ig={[zt]:"ENVMAP_BLENDING_MULTIPLY",[Vt]:"ENVMAP_BLENDING_MIX",[Ht]:"ENVMAP_BLENDING_ADD"};function rg(t,e,i,r){const n=t.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const c=function(t){return Qm[t.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}(i),l=function(t){return!1===t.envMap?"ENVMAP_TYPE_CUBE":tg[t.envMapMode]||"ENVMAP_TYPE_CUBE"}(i),h=function(t){return!1===t.envMap?"ENVMAP_MODE_REFLECTION":eg[t.envMapMode]||"ENVMAP_MODE_REFLECTION"}(i),u=function(t){return!1===t.envMap?"ENVMAP_BLENDING_NONE":ig[t.combine]||"ENVMAP_BLENDING_NONE"}(i),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}(i),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Vm).join("\n")}(i),f=function(t){const e=[];for(const i in t){const r=t[i];!1!==r&&e.push("#define "+i+" "+r)}return e.join("\n")}(s),m=n.createProgram();let g,v,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Vm).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Vm).join("\n"),v.length>0&&(v+="\n")):(g=[$m(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Vm).join("\n"),v=[$m(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Gt?"#define TONE_MAPPING":"",i.toneMapping!==Gt?qp.tonemapping_pars_fragment:"",i.toneMapping!==Gt?Bm("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",qp.colorspace_pars_fragment,Um("linearToOutputTexel",i.outputColorSpace),(Mn.getLuminanceCoefficients(zm),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${zm.x.toFixed(4)}, ${zm.y.toFixed(4)}, ${zm.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Vm).join("\n")),o=Xm(o),o=Hm(o,i),o=Gm(o,i),a=Xm(a),a=Hm(a,i),a=Gm(a,i),o=Jm(o),a=Jm(a),!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===Ir?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Ir?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=_+g+o,x=_+v+a,b=Im(n,n.VERTEX_SHADER,y),M=Im(n,n.FRAGMENT_SHADER,x);function S(e){if(t.debug.checkShaderErrors){const i=n.getProgramInfoLog(m)||"",r=n.getShaderInfoLog(b)||"",s=n.getShaderInfoLog(M)||"",o=i.trim(),a=r.trim(),c=s.trim();let l=!0,h=!0;if(!1===n.getProgramParameter(m,n.LINK_STATUS))if(l=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(n,m,b,M);else{const t=Fm(n,b,"vertex"),i=Fm(n,M,"fragment");Kr("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,n.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+o+"\n"+t+"\n"+i)}else""!==o?Jr("WebGLProgram: Program Info Log:",o):""!==a&&""!==c||(h=!1);h&&(e.diagnostics={runnable:l,programLog:o,vertexShader:{log:a,prefix:g},fragmentShader:{log:c,prefix:v}})}n.deleteShader(b),n.deleteShader(M),w=new Rm(n,m),T=function(t,e){const i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const r=t.getActiveAttrib(e,n),s=r.name;let o=1;r.type===t.FLOAT_MAT2&&(o=2),r.type===t.FLOAT_MAT3&&(o=3),r.type===t.FLOAT_MAT4&&(o=4),i[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}(n,m)}let w,T;n.attachShader(m,b),n.attachShader(m,M),void 0!==i.index0AttributeName?n.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),this.getUniforms=function(){return void 0===w&&S(this),w},this.getAttributes=function(){return void 0===T&&S(this),T};let C=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=n.getProgramParameter(m,Om)),C},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Lm++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=M,this}let ng=0;class sg{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(n)&&(s.add(n),n.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new og(t),e.set(t,i)),i}}class og{constructor(t){this.id=ng++,this.code=t,this.usedTimes=0}}function ag(t,e,i,r,n,s,o){const a=new ws,c=new sg,l=new Set,h=[],u=new Map,d=n.logarithmicDepthBuffer;let p=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return l.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,a,h,u,g){const v=u.fog,_=g.geometry,y=s.isMeshStandardMaterial?u.environment:null,x=(s.isMeshStandardMaterial?i:e).get(s.envMap||y),b=x&&x.mapping===se?x.image.height:null,M=f[s.type];null!==s.precision&&(p=n.getMaxPrecision(s.precision),p!==s.precision&&Jr("WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const S=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,w=void 0!==S?S.length:0;let T,C,E,P,A=0;if(void 0!==_.morphAttributes.position&&(A=1),void 0!==_.morphAttributes.normal&&(A=2),void 0!==_.morphAttributes.color&&(A=3),M){const t=Zp[M];T=t.vertexShader,C=t.fragmentShader}else T=s.vertexShader,C=s.fragmentShader,c.update(s),E=c.getVertexShaderID(s),P=c.getFragmentShaderID(s);const D=t.getRenderTarget(),k=t.state.buffers.depth.getReversed(),R=!0===g.isInstancedMesh,I=!0===g.isBatchedMesh,O=!!s.map,L=!!s.matcap,N=!!x,F=!!s.aoMap,U=!!s.lightMap,W=!!s.bumpMap,B=!!s.normalMap,z=!!s.displacementMap,V=!!s.emissiveMap,H=!!s.metalnessMap,G=!!s.roughnessMap,j=s.anisotropy>0,X=s.clearcoat>0,q=s.dispersion>0,Y=s.iridescence>0,Z=s.sheen>0,J=s.transmission>0,K=j&&!!s.anisotropyMap,$=X&&!!s.clearcoatMap,Q=X&&!!s.clearcoatNormalMap,tt=X&&!!s.clearcoatRoughnessMap,et=Y&&!!s.iridescenceMap,it=Y&&!!s.iridescenceThicknessMap,rt=Z&&!!s.sheenColorMap,nt=Z&&!!s.sheenRoughnessMap,at=!!s.specularMap,lt=!!s.specularColorMap,ht=!!s.specularIntensityMap,ut=J&&!!s.transmissionMap,dt=J&&!!s.thicknessMap,pt=!!s.gradientMap,ft=!!s.alphaMap,mt=s.alphaTest>0,gt=!!s.alphaHash,vt=!!s.extensions;let _t=Gt;s.toneMapped&&(null!==D&&!0!==D.isXRRenderTarget||(_t=t.toneMapping));const yt={shaderID:M,shaderType:s.type,shaderName:s.name,vertexShader:T,fragmentShader:C,defines:s.defines,customVertexShaderID:E,customFragmentShaderID:P,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:I,batchingColor:I&&null!==g._colorsTexture,instancing:R,instancingColor:R&&null!==g.instanceColor,instancingMorph:R&&null!==g.morphTexture,outputColorSpace:null===D?t.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:qi,alphaToCoverage:!!s.alphaToCoverage,map:O,matcap:L,envMap:N,envMapMode:N&&x.mapping,envMapCubeUVHeight:b,aoMap:F,lightMap:U,bumpMap:W,normalMap:B,displacementMap:z,emissiveMap:V,normalMapObjectSpace:B&&s.normalMapType===Gi,normalMapTangentSpace:B&&s.normalMapType===Hi,metalnessMap:H,roughnessMap:G,anisotropy:j,anisotropyMap:K,clearcoat:X,clearcoatMap:$,clearcoatNormalMap:Q,clearcoatRoughnessMap:tt,dispersion:q,iridescence:Y,iridescenceMap:et,iridescenceThicknessMap:it,sheen:Z,sheenColorMap:rt,sheenRoughnessMap:nt,specularMap:at,specularColorMap:lt,specularIntensityMap:ht,transmission:J,transmissionMap:ut,thicknessMap:dt,gradientMap:pt,opaque:!1===s.transparent&&s.blending===ct&&!1===s.alphaToCoverage,alphaMap:ft,alphaTest:mt,alphaHash:gt,combine:s.combine,mapUv:O&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:U&&m(s.lightMap.channel),bumpMapUv:W&&m(s.bumpMap.channel),normalMapUv:B&&m(s.normalMap.channel),displacementMapUv:z&&m(s.displacementMap.channel),emissiveMapUv:V&&m(s.emissiveMap.channel),metalnessMapUv:H&&m(s.metalnessMap.channel),roughnessMapUv:G&&m(s.roughnessMap.channel),anisotropyMapUv:K&&m(s.anisotropyMap.channel),clearcoatMapUv:$&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:tt&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:et&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:it&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:nt&&m(s.sheenRoughnessMap.channel),specularMapUv:at&&m(s.specularMap.channel),specularColorMapUv:lt&&m(s.specularColorMap.channel),specularIntensityMapUv:ht&&m(s.specularIntensityMap.channel),transmissionMapUv:ut&&m(s.transmissionMap.channel),thicknessMapUv:dt&&m(s.thicknessMap.channel),alphaMapUv:ft&&m(s.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(B||j),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===g.isPoints&&!!_.attributes.uv&&(O||ft),fog:!!v,useFog:!0===s.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===s.flatShading&&!1===s.wireframe,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,reversedDepthBuffer:k,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:w,morphTextureStride:A,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:_t,decodeVideoTexture:O&&!0===s.map.isVideoTexture&&Mn.getTransfer(s.map.colorSpace)===Zi,decodeVideoTextureEmissive:V&&!0===s.emissiveMap.isVideoTexture&&Mn.getTransfer(s.emissiveMap.colorSpace)===Zi,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===ot,flipSided:s.side===st,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:vt&&!0===s.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(vt&&!0===s.extensions.multiDraw||I)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return yt.vertexUv1s=l.has(1),yt.vertexUv2s=l.has(2),yt.vertexUv3s=l.has(3),l.clear(),yt},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){a.disableAll(),e.instancing&&a.enable(0),e.instancingColor&&a.enable(1),e.instancingMorph&&a.enable(2),e.matcap&&a.enable(3),e.envMap&&a.enable(4),e.normalMapObjectSpace&&a.enable(5),e.normalMapTangentSpace&&a.enable(6),e.clearcoat&&a.enable(7),e.iridescence&&a.enable(8),e.alphaTest&&a.enable(9),e.vertexColors&&a.enable(10),e.vertexAlphas&&a.enable(11),e.vertexUv1s&&a.enable(12),e.vertexUv2s&&a.enable(13),e.vertexUv3s&&a.enable(14),e.vertexTangents&&a.enable(15),e.anisotropy&&a.enable(16),e.alphaHash&&a.enable(17),e.batching&&a.enable(18),e.dispersion&&a.enable(19),e.batchingColor&&a.enable(20),e.gradientMap&&a.enable(21),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.reversedDepthBuffer&&a.enable(4),e.skinning&&a.enable(5),e.morphTargets&&a.enable(6),e.morphNormals&&a.enable(7),e.morphColors&&a.enable(8),e.premultipliedAlpha&&a.enable(9),e.shadowMapEnabled&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.transmission&&a.enable(15),e.sheen&&a.enable(16),e.opaque&&a.enable(17),e.pointsUvs&&a.enable(18),e.decodeVideoTexture&&a.enable(19),e.decodeVideoTextureEmissive&&a.enable(20),e.alphaToCoverage&&a.enable(21),t.push(a.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=Zp[e];i=ta.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let r=u.get(i);return void 0!==r?++r.usedTimes:(r=new rg(t,i,e,s),h.push(r),u.set(i,r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),u.delete(t.cacheKey),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function cg(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,r){t.get(e)[i]=r},dispose:function(){t=new WeakMap}}}function lg(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function hg(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ug(){const t=[];let e=0;const i=[],r=[],n=[];function s(i,r,n,s,o,a){let c=t[e];return void 0===c?(c={id:i.id,object:i,geometry:r,material:n,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},t[e]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=n,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=o,c.group=a),e++,c}return{opaque:i,transmissive:r,transparent:n,init:function(){e=0,i.length=0,r.length=0,n.length=0},push:function(t,e,o,a,c,l){const h=s(t,e,o,a,c,l);o.transmission>0?r.push(h):!0===o.transparent?n.push(h):i.push(h)},unshift:function(t,e,o,a,c,l){const h=s(t,e,o,a,c,l);o.transmission>0?r.unshift(h):!0===o.transparent?n.unshift(h):i.unshift(h)},finish:function(){for(let i=e,r=t.length;i<r;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||lg),r.length>1&&r.sort(e||hg),n.length>1&&n.sort(e||hg)}}}function dg(){let t=new WeakMap;return{get:function(e,i){const r=t.get(e);let n;return void 0===r?(n=new ug,t.set(e,[n])):i>=r.length?(n=new ug,r.push(n)):n=r[i],n},dispose:function(){t=new WeakMap}}}function pg(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new fn,color:new so};break;case"SpotLight":i={position:new fn,direction:new fn,color:new so,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new fn,color:new so,distance:0,decay:0};break;case"HemisphereLight":i={direction:new fn,skyColor:new so,groundColor:new so};break;case"RectAreaLight":i={color:new so,position:new fn,halfWidth:new fn,halfHeight:new fn}}return t[e.id]=i,i}}}let fg=0;function mg(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function gg(t){const e=new pg,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new fn);const n=new fn,s=new ps,o=new ps;return{setup:function(n){let s=0,o=0,a=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,l=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,_=0;n.sort(mg);for(let t=0,y=n.length;t<y;t++){const y=n[t],x=y.color,b=y.intensity,M=y.distance;let S=null;if(y.shadow&&y.shadow.map&&(S=y.shadow.map.texture.format===We?y.shadow.map.texture:y.shadow.map.depthTexture||y.shadow.map.texture),y.isAmbientLight)s+=x.r*b,o+=x.g*b,a+=x.b*b;else if(y.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(y.sh.coefficients[t],b);_++}else if(y.isDirectionalLight){const t=e.get(y);if(t.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const t=y.shadow,e=i.get(y);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,r.directionalShadow[c]=e,r.directionalShadowMap[c]=S,r.directionalShadowMatrix[c]=y.shadow.matrix,p++}r.directional[c]=t,c++}else if(y.isSpotLight){const t=e.get(y);t.position.setFromMatrixPosition(y.matrixWorld),t.color.copy(x).multiplyScalar(b),t.distance=M,t.coneCos=Math.cos(y.angle),t.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),t.decay=y.decay,r.spot[h]=t;const n=y.shadow;if(y.map&&(r.spotLightMap[g]=y.map,g++,n.updateMatrices(y),y.castShadow&&v++),r.spotLightMatrix[h]=n.matrix,y.castShadow){const t=i.get(y);t.shadowIntensity=n.intensity,t.shadowBias=n.bias,t.shadowNormalBias=n.normalBias,t.shadowRadius=n.radius,t.shadowMapSize=n.mapSize,r.spotShadow[h]=t,r.spotShadowMap[h]=S,m++}h++}else if(y.isRectAreaLight){const t=e.get(y);t.color.copy(x).multiplyScalar(b),t.halfWidth.set(.5*y.width,0,0),t.halfHeight.set(0,.5*y.height,0),r.rectArea[u]=t,u++}else if(y.isPointLight){const t=e.get(y);if(t.color.copy(y.color).multiplyScalar(y.intensity),t.distance=y.distance,t.decay=y.decay,y.castShadow){const t=y.shadow,e=i.get(y);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,r.pointShadow[l]=e,r.pointShadowMap[l]=S,r.pointShadowMatrix[l]=y.shadow.matrix,f++}r.point[l]=t,l++}else if(y.isHemisphereLight){const t=e.get(y);t.skyColor.copy(y.color).multiplyScalar(b),t.groundColor.copy(y.groundColor).multiplyScalar(b),r.hemi[d]=t,d++}}u>0&&(!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Yp.LTC_FLOAT_1,r.rectAreaLTC2=Yp.LTC_FLOAT_2):(r.rectAreaLTC1=Yp.LTC_HALF_1,r.rectAreaLTC2=Yp.LTC_HALF_2)),r.ambient[0]=s,r.ambient[1]=o,r.ambient[2]=a;const y=r.hash;y.directionalLength===c&&y.pointLength===l&&y.spotLength===h&&y.rectAreaLength===u&&y.hemiLength===d&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===_||(r.directional.length=c,r.spot.length=h,r.rectArea.length=u,r.point.length=l,r.hemi.length=d,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=_,y.directionalLength=c,y.pointLength=l,y.spotLength=h,y.rectAreaLength=u,y.hemiLength=d,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=_,r.version=fg++)},setupView:function(t,e){let i=0,a=0,c=0,l=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),n.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(n),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),n.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(n),t.direction.transformDirection(u),c++}else if(d.isRectAreaLight){const t=r.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),s.copy(d.matrixWorld),s.premultiply(u),o.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),l++}else if(d.isPointLight){const t=r.point[a];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:r}}function vg(t){const e=new gg(t),i=[],r=[],n={lightsArray:i,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){n.camera=t,i.length=0,r.length=0},state:n,setupLights:function(){e.setup(i)},setupLightsView:function(t){e.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function _g(t){let e=new WeakMap;return{get:function(i,r=0){const n=e.get(i);let s;return void 0===n?(s=new vg(t),e.set(i,[s])):r>=n.length?(s=new vg(t),n.push(s)):s=n[r],s},dispose:function(){e=new WeakMap}}}const yg=[new fn(1,0,0),new fn(-1,0,0),new fn(0,1,0),new fn(0,-1,0),new fn(0,0,1),new fn(0,0,-1)],xg=[new fn(0,-1,0),new fn(0,-1,0),new fn(0,0,1),new fn(0,0,-1),new fn(0,-1,0),new fn(0,-1,0)],bg=new ps,Mg=new fn,Sg=new fn;function wg(t,e,i){let r=new gc;const n=new dn,s=new dn,o=new In,a=new Zh,c=new Jh,l={},h=i.maxTextureSize,u={[nt]:st,[st]:nt,[ot]:ot},d=new ea({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new dn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );\n\tgl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new No;f.setAttribute("position",new yo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Yo(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=et;let v=this.type;function _(i,r){const s=e.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Ln(n.x,n.y,{format:We,type:Ce})),d.uniforms.shadow_pass.value=i.map.depthTexture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(r,null,s,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(r,null,s,p,m,null)}function y(e,i,r,n){let s=null;const o=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===r.isPointLight?c:a,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0||!0===i.alphaToCoverage){const t=s.uuid,e=i.uuid;let r=l[t];void 0===r&&(r={},l[t]=r);let n=r[e];void 0===n&&(n=s.clone(),r[e]=n,i.addEventListener("dispose",b)),s=n}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=n===rt?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],s.alphaMap=i.alphaMap,s.alphaTest=!0===i.alphaToCoverage?.5:i.alphaTest,s.map=i.map,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.displacementMap=i.displacementMap,s.displacementScale=i.displacementScale,s.displacementBias=i.displacementBias,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial&&(t.properties.get(s).light=r),s}function x(i,n,s,o,a){if(!1===i.visible)return;if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===rt)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const r=e.update(i),c=i.material;if(Array.isArray(c)){const e=r.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],u=c[h.materialIndex];if(u&&u.visible){const e=y(i,u,o,a);i.onBeforeShadow(t,i,n,s,r,e,h),t.renderBufferDirect(s,null,r,e,i,h),i.onAfterShadow(t,i,n,s,r,e,h)}}}else if(c.visible){const e=y(i,c,o,a);i.onBeforeShadow(t,i,n,s,r,e,null),t.renderBufferDirect(s,null,r,e,i,null),i.onAfterShadow(t,i,n,s,r,e,null)}}const c=i.children;for(let t=0,e=c.length;t<e;t++)x(c[t],n,s,o,a)}function b(t){t.target.removeEventListener("dispose",b);for(const e in l){const i=l[e],r=t.target.uuid;r in i&&(i[r].dispose(),delete i[r])}}this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;e.type===it&&(Jr("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),e.type=et);const c=t.getRenderTarget(),l=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(at),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==this.type;p&&i.traverse((function(t){t.material&&(Array.isArray(t.material)?t.material.forEach((t=>t.needsUpdate=!0)):t.material.needsUpdate=!0)}));for(let c=0,l=e.length;c<l;c++){const l=e[c],u=l.shadow;if(void 0===u){Jr("WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;n.copy(u.mapSize);const f=u.getFrameExtents();if(n.multiply(f),s.copy(u.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/f.x),n.x=s.x*f.x,u.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/f.y),n.y=s.y*f.y,u.mapSize.y=s.y)),null===u.map||!0===p){if(null!==u.map&&(null!==u.map.depthTexture&&(u.map.depthTexture.dispose(),u.map.depthTexture=null),u.map.dispose()),this.type===rt){if(l.isPointLight){Jr("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}u.map=new Ln(n.x,n.y,{format:We,type:Ce,minFilter:fe,magFilter:fe,generateMipmaps:!1}),u.map.texture.name=l.name+".shadowMap",u.map.depthTexture=new pl(n.x,n.y,Te),u.map.depthTexture.name=l.name+".shadowMapDepth",u.map.depthTexture.format=Le,u.map.depthTexture.compareFunction=null,u.map.depthTexture.minFilter=le,u.map.depthTexture.magFilter=le}else{l.isPointLight?(u.map=new ha(n.x),u.map.depthTexture=new fl(n.x,we)):(u.map=new Ln(n.x,n.y),u.map.depthTexture=new pl(n.x,n.y,we)),u.map.depthTexture.name=l.name+".shadowMap",u.map.depthTexture.format=Le;const e=t.state.buffers.depth.getReversed();this.type===et?(u.map.depthTexture.compareFunction=e?br:_r,u.map.depthTexture.minFilter=fe,u.map.depthTexture.magFilter=fe):(u.map.depthTexture.compareFunction=null,u.map.depthTexture.minFilter=le,u.map.depthTexture.magFilter=le)}u.camera.updateProjectionMatrix()}const m=u.map.isWebGLCubeRenderTarget?6:1;for(let e=0;e<m;e++){if(u.map.isWebGLCubeRenderTarget)t.setRenderTarget(u.map,e),t.clear();else{0===e&&(t.setRenderTarget(u.map),t.clear());const i=u.getViewport(e);o.set(s.x*i.x,s.y*i.y,s.x*i.z,s.y*i.w),d.viewport(o)}if(l.isPointLight){const t=u.camera,i=u.matrix,r=l.distance||t.far;r!==t.far&&(t.far=r,t.updateProjectionMatrix()),Mg.setFromMatrixPosition(l.matrixWorld),t.position.copy(Mg),Sg.copy(t.position),Sg.add(yg[e]),t.up.copy(xg[e]),t.lookAt(Sg),t.updateMatrixWorld(),i.makeTranslation(-Mg.x,-Mg.y,-Mg.z),bg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),u._frustum.setFromProjectionMatrix(bg,t.coordinateSystem,t.reversedDepth)}else u.updateMatrices(l);r=u.getFrustum(),x(i,a,u.camera,l,this.type)}!0!==u.isPointLightShadow&&this.type===rt&&_(u,a),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(c,l,u)}}const Tg={[It]:Ot,[Lt]:Wt,[Ft]:Bt,[Nt]:Ut,[Ot]:It,[Wt]:Lt,[Bt]:Ft,[Ut]:Nt};function Cg(t,e){const i=new function(){let e=!1;const i=new In;let r=null;const n=new In(0,0,0,0);return{setMask:function(i){r===i||e||(t.colorMask(i,i,i,i),r=i)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),i.set(e,r,s,o),!1===n.equals(i)&&(t.clearColor(e,r,s,o),n.copy(i))},reset:function(){e=!1,r=null,n.set(-1,0,0,0)}}},r=new function(){let i=!1,r=!1,n=null,s=null,o=null;return{setReversed:function(t){if(r!==t){const i=e.get("EXT_clip_control");t?i.clipControlEXT(i.LOWER_LEFT_EXT,i.ZERO_TO_ONE_EXT):i.clipControlEXT(i.LOWER_LEFT_EXT,i.NEGATIVE_ONE_TO_ONE_EXT),r=t;const n=o;o=null,this.setClear(n)}},getReversed:function(){return r},setTest:function(e){e?B(t.DEPTH_TEST):z(t.DEPTH_TEST)},setMask:function(e){n===e||i||(t.depthMask(e),n=e)},setFunc:function(e){if(r&&(e=Tg[e]),s!==e){switch(e){case It:t.depthFunc(t.NEVER);break;case Ot:t.depthFunc(t.ALWAYS);break;case Lt:t.depthFunc(t.LESS);break;case Nt:t.depthFunc(t.LEQUAL);break;case Ft:t.depthFunc(t.EQUAL);break;case Ut:t.depthFunc(t.GEQUAL);break;case Wt:t.depthFunc(t.GREATER);break;case Bt:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}s=e}},setLocked:function(t){i=t},setClear:function(e){o!==e&&(r&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){i=!1,n=null,s=null,o=null,r=!1}}},n=new function(){let e=!1,i=null,r=null,n=null,s=null,o=null,a=null,c=null,l=null;return{setTest:function(i){e||(i?B(t.STENCIL_TEST):z(t.STENCIL_TEST))},setMask:function(r){i===r||e||(t.stencilMask(r),i=r)},setFunc:function(e,i,o){r===e&&n===i&&s===o||(t.stencilFunc(e,i,o),r=e,n=i,s=o)},setOp:function(e,i,r){o===e&&a===i&&c===r||(t.stencilOp(e,i,r),o=e,a=i,c=r)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,i=null,r=null,n=null,s=null,o=null,a=null,c=null,l=null}}},s=new WeakMap,o=new WeakMap;let a={},c={},l=new WeakMap,h=[],u=null,d=!1,p=null,f=null,m=null,g=null,v=null,_=null,y=null,x=new so(0,0,0),b=0,M=!1,S=null,w=null,T=null,C=null,E=null;const P=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let A=!1,D=0;const k=t.getParameter(t.VERSION);-1!==k.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(k)[1]),A=D>=1):-1!==k.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),A=D>=2);let R=null,I={};const O=t.getParameter(t.SCISSOR_BOX),L=t.getParameter(t.VIEWPORT),N=(new In).fromArray(O),F=(new In).fromArray(L);function U(e,i,r,n){const s=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<r;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(i,0,t.RGBA,1,1,n,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(i+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return o}const W={};function B(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function z(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}W[t.TEXTURE_2D]=U(t.TEXTURE_2D,t.TEXTURE_2D,1),W[t.TEXTURE_CUBE_MAP]=U(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),W[t.TEXTURE_2D_ARRAY]=U(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),W[t.TEXTURE_3D]=U(t.TEXTURE_3D,t.TEXTURE_3D,1,1),i.setClear(0,0,0,1),r.setClear(1),n.setClear(0),B(t.DEPTH_TEST),r.setFunc(Nt),j(!1),X(K),B(t.CULL_FACE),G(at);const V={[pt]:t.FUNC_ADD,[ft]:t.FUNC_SUBTRACT,[mt]:t.FUNC_REVERSE_SUBTRACT};V[gt]=t.MIN,V[vt]=t.MAX;const H={[_t]:t.ZERO,[yt]:t.ONE,[xt]:t.SRC_COLOR,[Mt]:t.SRC_ALPHA,[Pt]:t.SRC_ALPHA_SATURATE,[Ct]:t.DST_COLOR,[wt]:t.DST_ALPHA,[bt]:t.ONE_MINUS_SRC_COLOR,[St]:t.ONE_MINUS_SRC_ALPHA,[Et]:t.ONE_MINUS_DST_COLOR,[Tt]:t.ONE_MINUS_DST_ALPHA,[At]:t.CONSTANT_COLOR,[Dt]:t.ONE_MINUS_CONSTANT_COLOR,[kt]:t.CONSTANT_ALPHA,[Rt]:t.ONE_MINUS_CONSTANT_ALPHA};function G(e,i,r,n,s,o,a,c,l,h){if(e!==at){if(!1===d&&(B(t.BLEND),d=!0),e===dt)s=s||i,o=o||r,a=a||n,i===f&&s===v||(t.blendEquationSeparate(V[i],V[s]),f=i,v=s),r===m&&n===g&&o===_&&a===y||(t.blendFuncSeparate(H[r],H[n],H[o],H[a]),m=r,g=n,_=o,y=a),!1!==c.equals(x)&&l===b||(t.blendColor(c.r,c.g,c.b,l),x.copy(c),b=l),p=e,M=!1;else if(e!==p||h!==M){if(f===pt&&v===pt||(t.blendEquation(t.FUNC_ADD),f=pt,v=pt),h)switch(e){case ct:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case lt:t.blendFunc(t.ONE,t.ONE);break;case ht:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case ut:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:Kr("WebGLState: Invalid blending: ",e)}else switch(e){case ct:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case lt:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case ht:Kr("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case ut:Kr("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Kr("WebGLState: Invalid blending: ",e)}m=null,g=null,_=null,y=null,x.set(0,0,0),b=0,p=e,M=h}}else!0===d&&(z(t.BLEND),d=!1)}function j(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function X(e){e!==J?(B(t.CULL_FACE),e!==w&&(e===K?t.cullFace(t.BACK):e===$?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):z(t.CULL_FACE),w=e}function q(e,i,r){e?(B(t.POLYGON_OFFSET_FILL),C===i&&E===r||(t.polygonOffset(i,r),C=i,E=r)):z(t.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:r,stencil:n},enable:B,disable:z,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=i),!0)},drawBuffers:function(e,i){let r=h,n=!1;if(e){r=l.get(i),void 0===r&&(r=[],l.set(i,r));const s=e.textures;if(r.length!==s.length||r[0]!==t.COLOR_ATTACHMENT0){for(let e=0,i=s.length;e<i;e++)r[e]=t.COLOR_ATTACHMENT0+e;r.length=s.length,n=!0}}else r[0]!==t.BACK&&(r[0]=t.BACK,n=!0);n&&t.drawBuffers(r)},useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:G,setMaterial:function(e,s){e.side===ot?z(t.CULL_FACE):B(t.CULL_FACE);let o=e.side===st;s&&(o=!o),j(o),e.blending===ct&&!1===e.transparent?G(at):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),i.setMask(e.colorWrite);const a=e.stencilWrite;n.setTest(a),a&&(n.setMask(e.stencilWriteMask),n.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),n.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(t.SAMPLE_ALPHA_TO_COVERAGE):z(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:j,setCullFace:X,setLineWidth:function(e){e!==T&&(A&&t.lineWidth(e),T=e)},setPolygonOffset:q,setScissorTest:function(e){e?B(t.SCISSOR_TEST):z(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+P-1),R!==e&&(t.activeTexture(e),R=e)},bindTexture:function(e,i,r){void 0===r&&(r=null===R?t.TEXTURE0+P-1:R);let n=I[r];void 0===n&&(n={type:void 0,texture:void 0},I[r]=n),n.type===e&&n.texture===i||(R!==r&&(t.activeTexture(r),R=r),t.bindTexture(e,i||W[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=I[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D(...arguments)}catch(t){Kr("WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D(...arguments)}catch(t){Kr("WebGLState:",t)}},texImage2D:function(){try{t.texImage2D(...arguments)}catch(t){Kr("WebGLState:",t)}},texImage3D:function(){try{t.texImage3D(...arguments)}catch(t){Kr("WebGLState:",t)}},updateUBOMapping:function(e,i){let r=o.get(i);void 0===r&&(r=new WeakMap,o.set(i,r));let n=r.get(e);void 0===n&&(n=t.getUniformBlockIndex(i,e.name),r.set(e,n))},uniformBlockBinding:function(e,i){const r=o.get(i).get(e);s.get(i)!==r&&(t.uniformBlockBinding(i,r,e.__bindingPointIndex),s.set(i,r))},texStorage2D:function(){try{t.texStorage2D(...arguments)}catch(t){Kr("WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D(...arguments)}catch(t){Kr("WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D(...arguments)}catch(t){Kr("WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D(...arguments)}catch(t){Kr("WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D(...arguments)}catch(t){Kr("WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D(...arguments)}catch(t){Kr("WebGLState:",t)}},scissor:function(e){!1===N.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),r.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},R=null,I={},c={},l=new WeakMap,h=[],u=null,d=!1,p=null,f=null,m=null,g=null,v=null,_=null,y=null,x=new so(0,0,0),b=0,M=!1,S=null,w=null,T=null,C=null,E=null,N.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),i.reset(),r.reset(),n.reset()}}}function Eg(t,e,i,r,n,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),l=new dn,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):Hr("canvas")}function m(t,e,i){let r=1;const n=H(t);if((n.width>i||n.height>i)&&(r=i/Math.max(n.width,n.height)),r<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const i=Math.floor(r*n.width),s=Math.floor(r*n.height);void 0===u&&(u=f(i,s));const o=e?f(i,s):u;return o.width=i,o.height=s,o.getContext("2d").drawImage(t,0,0,i,s),Jr("WebGLRenderer: Texture has been resized from ("+n.width+"x"+n.height+") to ("+i+"x"+s+")."),o}return"data"in t&&Jr("WebGLRenderer: Image in DataTexture is too big ("+n.width+"x"+n.height+")."),t}return t}function g(t){return t.generateMipmaps}function v(e){t.generateMipmap(e)}function _(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function y(i,r,n,s,o=!1){if(null!==i){if(void 0!==t[i])return t[i];Jr("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let a=r;if(r===t.RED&&(n===t.FLOAT&&(a=t.R32F),n===t.HALF_FLOAT&&(a=t.R16F),n===t.UNSIGNED_BYTE&&(a=t.R8)),r===t.RED_INTEGER&&(n===t.UNSIGNED_BYTE&&(a=t.R8UI),n===t.UNSIGNED_SHORT&&(a=t.R16UI),n===t.UNSIGNED_INT&&(a=t.R32UI),n===t.BYTE&&(a=t.R8I),n===t.SHORT&&(a=t.R16I),n===t.INT&&(a=t.R32I)),r===t.RG&&(n===t.FLOAT&&(a=t.RG32F),n===t.HALF_FLOAT&&(a=t.RG16F),n===t.UNSIGNED_BYTE&&(a=t.RG8)),r===t.RG_INTEGER&&(n===t.UNSIGNED_BYTE&&(a=t.RG8UI),n===t.UNSIGNED_SHORT&&(a=t.RG16UI),n===t.UNSIGNED_INT&&(a=t.RG32UI),n===t.BYTE&&(a=t.RG8I),n===t.SHORT&&(a=t.RG16I),n===t.INT&&(a=t.RG32I)),r===t.RGB_INTEGER&&(n===t.UNSIGNED_BYTE&&(a=t.RGB8UI),n===t.UNSIGNED_SHORT&&(a=t.RGB16UI),n===t.UNSIGNED_INT&&(a=t.RGB32UI),n===t.BYTE&&(a=t.RGB8I),n===t.SHORT&&(a=t.RGB16I),n===t.INT&&(a=t.RGB32I)),r===t.RGBA_INTEGER&&(n===t.UNSIGNED_BYTE&&(a=t.RGBA8UI),n===t.UNSIGNED_SHORT&&(a=t.RGBA16UI),n===t.UNSIGNED_INT&&(a=t.RGBA32UI),n===t.BYTE&&(a=t.RGBA8I),n===t.SHORT&&(a=t.RGBA16I),n===t.INT&&(a=t.RGBA32I)),r===t.RGB&&(n===t.UNSIGNED_INT_5_9_9_9_REV&&(a=t.RGB9_E5),n===t.UNSIGNED_INT_10F_11F_11F_REV&&(a=t.R11F_G11F_B10F)),r===t.RGBA){const e=o?Yi:Mn.getTransfer(s);n===t.FLOAT&&(a=t.RGBA32F),n===t.HALF_FLOAT&&(a=t.RGBA16F),n===t.UNSIGNED_BYTE&&(a=e===Zi?t.SRGB8_ALPHA8:t.RGBA8),n===t.UNSIGNED_SHORT_4_4_4_4&&(a=t.RGBA4),n===t.UNSIGNED_SHORT_5_5_5_1&&(a=t.RGB5_A1)}return a!==t.R16F&&a!==t.R32F&&a!==t.RG16F&&a!==t.RG32F&&a!==t.RGBA16F&&a!==t.RGBA32F||e.get("EXT_color_buffer_float"),a}function x(e,i){let r;return e?null===i||i===we||i===Ae?r=t.DEPTH24_STENCIL8:i===Te?r=t.DEPTH32F_STENCIL8:i===Me&&(r=t.DEPTH24_STENCIL8,Jr("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===i||i===we||i===Ae?r=t.DEPTH_COMPONENT24:i===Te?r=t.DEPTH_COMPONENT32F:i===Me&&(r=t.DEPTH_COMPONENT16),r}function b(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==le&&t.minFilter!==fe?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(t){const e=t.target;e.removeEventListener("dispose",M),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const i=t.source,n=d.get(i);if(n){const r=n[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&w(t),0===Object.keys(n).length&&d.delete(i)}r.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=r.get(e);if(e.depthTexture&&(e.depthTexture.dispose(),r.remove(e.depthTexture)),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(i.__webglFramebuffer[e]))for(let r=0;r<i.__webglFramebuffer[e].length;r++)t.deleteFramebuffer(i.__webglFramebuffer[e][r]);else t.deleteFramebuffer(i.__webglFramebuffer[e]);i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e])}else{if(Array.isArray(i.__webglFramebuffer))for(let e=0;e<i.__webglFramebuffer.length;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let e=0;e<i.__webglColorRenderbuffer.length;e++)i.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(i.__webglColorRenderbuffer[e]);i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer)}const n=e.textures;for(let e=0,i=n.length;e<i;e++){const i=r.get(n[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),o.memory.textures--),r.remove(n[e])}r.remove(e)}(i)}function w(e){const i=r.get(e);t.deleteTexture(i.__webglTexture);const n=e.source;delete d.get(n)[i.__cacheKey],o.memory.textures--}let T=0;function C(e,n){const s=r.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&!0!==e.isExternalTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)Jr("WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void I(s,e,n);Jr("WebGLRenderer: Texture marked for update but image is incomplete")}}else e.isExternalTexture&&(s.__webglTexture=e.sourceTexture?e.sourceTexture:null);i.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+n)}const E={[oe]:t.REPEAT,[ae]:t.CLAMP_TO_EDGE,[ce]:t.MIRRORED_REPEAT},P={[le]:t.NEAREST,[he]:t.NEAREST_MIPMAP_NEAREST,[de]:t.NEAREST_MIPMAP_LINEAR,[fe]:t.LINEAR,[me]:t.LINEAR_MIPMAP_NEAREST,[ve]:t.LINEAR_MIPMAP_LINEAR},A={[mr]:t.NEVER,[Mr]:t.ALWAYS,[gr]:t.LESS,[_r]:t.LEQUAL,[vr]:t.EQUAL,[br]:t.GEQUAL,[yr]:t.GREATER,[xr]:t.NOTEQUAL};function D(i,s){if(s.type!==Te||!1!==e.has("OES_texture_float_linear")||s.magFilter!==fe&&s.magFilter!==me&&s.magFilter!==de&&s.magFilter!==ve&&s.minFilter!==fe&&s.minFilter!==me&&s.minFilter!==de&&s.minFilter!==ve||Jr("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(i,t.TEXTURE_WRAP_S,E[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,E[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,E[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,P[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,P[s.minFilter]),s.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,A[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===le)return;if(s.minFilter!==de&&s.minFilter!==ve)return;if(s.type===Te&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy}}}function k(e,i){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",M));const n=i.source;let s=d.get(n);void 0===s&&(s={},d.set(n,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;const n=s[e.__cacheKey];void 0!==n&&(s[e.__cacheKey].usedTimes--,0===n.usedTimes&&w(i)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return r}function R(t,e,i){return Math.floor(Math.floor(t/i)/e)}function I(e,o,a){let c=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(c=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(c=t.TEXTURE_3D);const l=k(e,o),h=o.source;i.bindTexture(c,e.__webglTexture,t.TEXTURE0+a);const u=r.get(h);if(h.version!==u.__version||!0===l){i.activeTexture(t.TEXTURE0+a);const e=Mn.getPrimaries(Mn.workingColorSpace),r=o.colorSpace===ji?null:Mn.getPrimaries(o.colorSpace),d=o.colorSpace===ji||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,n.maxTextureSize);p=V(o,p);const f=s.convert(o.format,o.colorSpace),_=s.convert(o.type);let M,S=y(o.internalFormat,f,_,o.colorSpace,o.isVideoTexture);D(c,o);const w=o.mipmaps,T=!0!==o.isVideoTexture,C=void 0===u.__version||!0===l,E=h.dataReady,P=b(o,p);if(o.isDepthTexture)S=x(o.format===Ne,o.type),C&&(T?i.texStorage2D(t.TEXTURE_2D,1,S,p.width,p.height):i.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,null));else if(o.isDataTexture)if(w.length>0){T&&C&&i.texStorage2D(t.TEXTURE_2D,P,S,w[0].width,w[0].height);for(let e=0,r=w.length;e<r;e++)M=w[e],T?E&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,_,M.data):i.texImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,f,_,M.data);o.generateMipmaps=!1}else T?(C&&i.texStorage2D(t.TEXTURE_2D,P,S,p.width,p.height),E&&function(e,r,n,s){const o=e.updateRanges;if(0===o.length)i.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,n,s,r.data);else{o.sort(((t,e)=>t.start-e.start));let a=0;for(let t=1;t<o.length;t++){const e=o[a],i=o[t],n=e.start+e.count,s=R(i.start,r.width,4),c=R(e.start,r.width,4);i.start<=n+1&&s===c&&R(i.start+i.count-1,r.width,4)===s?e.count=Math.max(e.count,i.start+i.count-e.start):(++a,o[a]=i)}o.length=a+1;const c=t.getParameter(t.UNPACK_ROW_LENGTH),l=t.getParameter(t.UNPACK_SKIP_PIXELS),h=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,r.width);for(let e=0,a=o.length;e<a;e++){const a=o[e],c=Math.floor(a.start/4),l=Math.ceil(a.count/4),h=c%r.width,u=Math.floor(c/r.width),d=l,p=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,h),t.pixelStorei(t.UNPACK_SKIP_ROWS,u),i.texSubImage2D(t.TEXTURE_2D,0,h,u,d,p,n,s,r.data)}e.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,c),t.pixelStorei(t.UNPACK_SKIP_PIXELS,l),t.pixelStorei(t.UNPACK_SKIP_ROWS,h)}}(o,p,f,_)):i.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&C&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,S,w[0].width,w[0].height,p.depth);for(let e=0,r=w.length;e<r;e++)if(M=w[e],o.format!==Oe)if(null!==f)if(T){if(E)if(o.layerUpdates.size>0){const r=Hp(M.width,M.height,o.format,o.type);for(const n of o.layerUpdates){const s=M.data.subarray(n*r/M.data.BYTES_PER_ELEMENT,(n+1)*r/M.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,n,M.width,M.height,1,f,s)}o.clearLayerUpdates()}else i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,M.width,M.height,p.depth,f,M.data)}else i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,S,M.width,M.height,p.depth,0,M.data,0,0);else Jr("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?E&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,M.width,M.height,p.depth,f,_,M.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,S,M.width,M.height,p.depth,0,f,_,M.data)}else{T&&C&&i.texStorage2D(t.TEXTURE_2D,P,S,w[0].width,w[0].height);for(let e=0,r=w.length;e<r;e++)M=w[e],o.format!==Oe?null!==f?T?E&&i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,M.data):i.compressedTexImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,M.data):Jr("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?E&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,M.width,M.height,f,_,M.data):i.texImage2D(t.TEXTURE_2D,e,S,M.width,M.height,0,f,_,M.data)}else if(o.isDataArrayTexture)if(T){if(C&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,S,p.width,p.height,p.depth),E)if(o.layerUpdates.size>0){const e=Hp(p.width,p.height,o.format,o.type);for(const r of o.layerUpdates){const n=p.data.subarray(r*e/p.data.BYTES_PER_ELEMENT,(r+1)*e/p.data.BYTES_PER_ELEMENT);i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,_,n)}o.clearLayerUpdates()}else i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else i.texImage3D(t.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(o.isData3DTexture)T?(C&&i.texStorage3D(t.TEXTURE_3D,P,S,p.width,p.height,p.depth),E&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):i.texImage3D(t.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(o.isFramebufferTexture){if(C)if(T)i.texStorage2D(t.TEXTURE_2D,P,S,p.width,p.height);else{let e=p.width,r=p.height;for(let n=0;n<P;n++)i.texImage2D(t.TEXTURE_2D,n,S,e,r,0,f,_,null),e>>=1,r>>=1}}else if(w.length>0){if(T&&C){const e=H(w[0]);i.texStorage2D(t.TEXTURE_2D,P,S,e.width,e.height)}for(let e=0,r=w.length;e<r;e++)M=w[e],T?E&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,_,M):i.texImage2D(t.TEXTURE_2D,e,S,f,_,M);o.generateMipmaps=!1}else if(T){if(C){const e=H(p);i.texStorage2D(t.TEXTURE_2D,P,S,e.width,e.height)}E&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,_,p)}else i.texImage2D(t.TEXTURE_2D,0,S,f,_,p);g(o)&&v(c),u.__version=h.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function O(e,n,o,c,l,h){const u=s.convert(o.format,o.colorSpace),d=s.convert(o.type),p=y(o.internalFormat,u,d,o.colorSpace),f=r.get(n),m=r.get(o);if(m.__renderTarget=n,!f.__hasExternalTextures){const e=Math.max(1,n.width>>h),r=Math.max(1,n.height>>h);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,h,p,e,r,n.depth,0,u,d,null):i.texImage2D(l,h,p,e,r,0,u,d,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),z(n)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,c,l,m.__webglTexture,0,B(n)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,c,l,m.__webglTexture,h),i.bindFramebuffer(t.FRAMEBUFFER,null)}function L(e,i,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer){const n=i.depthTexture,s=n&&n.isDepthTexture?n.type:null,o=x(i.stencilBuffer,s),c=i.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;z(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,B(i),o,i.width,i.height):r?t.renderbufferStorageMultisample(t.RENDERBUFFER,B(i),o,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,o,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,c,t.RENDERBUFFER,e)}else{const e=i.textures;for(let n=0;n<e.length;n++){const o=e[n],c=s.convert(o.format,o.colorSpace),l=s.convert(o.type),h=y(o.internalFormat,c,l,o.colorSpace);z(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,B(i),h,i.width,i.height):r?t.renderbufferStorageMultisample(t.RENDERBUFFER,B(i),h,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,h,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function N(e,n,o){const c=!0===n.isWebGLCubeRenderTarget;if(i.bindFramebuffer(t.FRAMEBUFFER,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const l=r.get(n.depthTexture);if(l.__renderTarget=n,l.__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),c){if(void 0===l.__webglInit&&(l.__webglInit=!0,n.depthTexture.addEventListener("dispose",M)),void 0===l.__webglTexture){l.__webglTexture=t.createTexture(),i.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),D(t.TEXTURE_CUBE_MAP,n.depthTexture);const e=s.convert(n.depthTexture.format),r=s.convert(n.depthTexture.type);let o;n.depthTexture.format===Le?o=t.DEPTH_COMPONENT24:n.depthTexture.format===Ne&&(o=t.DEPTH24_STENCIL8);for(let i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,o,n.width,n.height,0,e,r,null)}}else C(n.depthTexture,0);const h=l.__webglTexture,u=B(n),d=c?t.TEXTURE_CUBE_MAP_POSITIVE_X+o:t.TEXTURE_2D,p=n.depthTexture.format===Ne?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(n.depthTexture.format===Le)z(n)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,p,d,h,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,p,d,h,0);else{if(n.depthTexture.format!==Ne)throw new Error("Unknown depthTexture format");z(n)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,p,d,h,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,p,d,h,0)}}function F(e){const n=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(n.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(n.__depthDisposeCallback&&n.__depthDisposeCallback(),t){const e=()=>{delete n.__boundDepthTexture,delete n.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),n.__depthDisposeCallback=e}n.__boundDepthTexture=t}if(e.depthTexture&&!n.__autoAllocateDepthBuffer)if(s)for(let t=0;t<6;t++)N(n.__webglFramebuffer[t],e,t);else{const t=e.texture.mipmaps;t&&t.length>0?N(n.__webglFramebuffer[0],e,0):N(n.__webglFramebuffer,e,0)}else if(s){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(i.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[r]),void 0===n.__webglDepthbuffer[r])n.__webglDepthbuffer[r]=t.createRenderbuffer(),L(n.__webglDepthbuffer[r],e,!1);else{const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,s=n.__webglDepthbuffer[r];t.bindRenderbuffer(t.RENDERBUFFER,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,s)}}else{const r=e.texture.mipmaps;if(r&&r.length>0?i.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[0]):i.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer),void 0===n.__webglDepthbuffer)n.__webglDepthbuffer=t.createRenderbuffer(),L(n.__webglDepthbuffer,e,!1);else{const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,r=n.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,r)}}i.bindFramebuffer(t.FRAMEBUFFER,null)}const U=[],W=[];function B(t){return Math.min(n.maxSamples,t.samples)}function z(t){const i=r.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function V(t,e){const i=t.colorSpace,r=t.format,n=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||i!==qi&&i!==ji&&(Mn.getTransfer(i)===Zi?r===Oe&&n===ye||Jr("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Kr("WebGLTextures: Unsupported texture color space:",i)),e}function H(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(l.width=t.naturalWidth||t.width,l.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(l.width=t.displayWidth,l.height=t.displayHeight):(l.width=t.width,l.height=t.height),l}this.allocateTextureUnit=function(){const t=T;return t>=n.maxTextures&&Jr("WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+n.maxTextures),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=C,this.setTexture2DArray=function(e,n){const s=r.get(e);!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version?I(s,e,n):(e.isExternalTexture&&(s.__webglTexture=e.sourceTexture?e.sourceTexture:null),i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+n))},this.setTexture3D=function(e,n){const s=r.get(e);!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version?I(s,e,n):i.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+n)},this.setTextureCube=function(e,o){const a=r.get(e);!0!==e.isCubeDepthTexture&&e.version>0&&a.__version!==e.version?function(e,o,a){if(6!==o.image.length)return;const c=k(e,o),l=o.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+a);const h=r.get(l);if(l.version!==h.__version||!0===c){i.activeTexture(t.TEXTURE0+a);const e=Mn.getPrimaries(Mn.workingColorSpace),r=o.colorSpace===ji?null:Mn.getPrimaries(o.colorSpace),u=o.colorSpace===ji||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:m(o.image[t],!0,n.maxCubemapSize),f[t]=V(o,f[t]);const _=f[0],x=s.convert(o.format,o.colorSpace),M=s.convert(o.type),S=y(o.internalFormat,x,M,o.colorSpace),w=!0!==o.isVideoTexture,T=void 0===h.__version||!0===c,C=l.dataReady;let E,P=b(o,_);if(D(t.TEXTURE_CUBE_MAP,o),d){w&&T&&i.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,_.width,_.height);for(let e=0;e<6;e++){E=f[e].mipmaps;for(let r=0;r<E.length;r++){const n=E[r];o.format!==Oe?null!==x?w?C&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,n.width,n.height,x,n.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,S,n.width,n.height,0,n.data):Jr("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?C&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,n.width,n.height,x,M,n.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,S,n.width,n.height,0,x,M,n.data)}}}else{if(E=o.mipmaps,w&&T){E.length>0&&P++;const e=H(f[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){w?C&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,x,M,f[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,f[e].width,f[e].height,0,x,M,f[e].data);for(let r=0;r<E.length;r++){const n=E[r].image[e].image;w?C&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,n.width,n.height,x,M,n.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,S,n.width,n.height,0,x,M,n.data)}}else{w?C&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,x,M,f[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,x,M,f[e]);for(let r=0;r<E.length;r++){const n=E[r];w?C&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,x,M,n.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,S,x,M,n.image[e])}}}g(o)&&v(t.TEXTURE_CUBE_MAP),h.__version=l.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(a,e,o):i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,i,n){const s=r.get(e);void 0!==i&&O(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==n&&F(e)},this.setupRenderTarget=function(e){const n=e.texture,a=r.get(e),c=r.get(n);e.addEventListener("dispose",S);const l=e.textures,h=!0===e.isWebGLCubeRenderTarget,u=l.length>1;if(u||(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=n.version,o.memory.textures++),h){a.__webglFramebuffer=[];for(let e=0;e<6;e++)if(n.mipmaps&&n.mipmaps.length>0){a.__webglFramebuffer[e]=[];for(let i=0;i<n.mipmaps.length;i++)a.__webglFramebuffer[e][i]=t.createFramebuffer()}else a.__webglFramebuffer[e]=t.createFramebuffer()}else{if(n.mipmaps&&n.mipmaps.length>0){a.__webglFramebuffer=[];for(let e=0;e<n.mipmaps.length;e++)a.__webglFramebuffer[e]=t.createFramebuffer()}else a.__webglFramebuffer=t.createFramebuffer();if(u)for(let e=0,i=l.length;e<i;e++){const i=r.get(l[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===z(e)){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let i=0;i<l.length;i++){const r=l[i];a.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,a.__webglColorRenderbuffer[i]);const n=s.convert(r.format,r.colorSpace),o=s.convert(r.type),c=y(r.internalFormat,n,o,r.colorSpace,!0===e.isXRRenderTarget),h=B(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,a.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),L(a.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),D(t.TEXTURE_CUBE_MAP,n);for(let i=0;i<6;i++)if(n.mipmaps&&n.mipmaps.length>0)for(let r=0;r<n.mipmaps.length;r++)O(a.__webglFramebuffer[i][r],e,n,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,r);else O(a.__webglFramebuffer[i],e,n,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);g(n)&&v(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(u){for(let n=0,s=l.length;n<s;n++){const s=l[n],o=r.get(s);let c=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(c=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(c,o.__webglTexture),D(c,s),O(a.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+n,c,0),g(s)&&v(c)}i.unbindTexture()}else{let r=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(r=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(r,c.__webglTexture),D(r,n),n.mipmaps&&n.mipmaps.length>0)for(let i=0;i<n.mipmaps.length;i++)O(a.__webglFramebuffer[i],e,n,t.COLOR_ATTACHMENT0,r,i);else O(a.__webglFramebuffer,e,n,t.COLOR_ATTACHMENT0,r,0);g(n)&&v(r),i.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let n=0,s=e.length;n<s;n++){const s=e[n];if(g(s)){const e=_(t),n=r.get(s).__webglTexture;i.bindTexture(e,n),v(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===z(e)){const n=e.textures,s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=r.get(e),u=n.length>1;if(u)for(let e=0;e<n.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer);const d=e.texture.mipmaps;d&&d.length>0?i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer[0]):i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<n.length;i++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),u){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[i]);const e=r.get(n[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),!0===c&&(U.length=0,W.length=0,U.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&!1===e.resolveDepthBuffer&&(U.push(l),W.push(l),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,W)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,U))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<n.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=r.get(n[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&c){const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[i])}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=O,this.useMultisampledRTT=z,this.isReversedDepthBuffer=function(){return i.buffers.depth.getReversed()}}function Pg(t,e){return{convert:function(i,r=ji){let n;const s=Mn.getTransfer(r);if(i===ye)return t.UNSIGNED_BYTE;if(i===Ee)return t.UNSIGNED_SHORT_4_4_4_4;if(i===Pe)return t.UNSIGNED_SHORT_5_5_5_1;if(i===De)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===ke)return t.UNSIGNED_INT_10F_11F_11F_REV;if(i===xe)return t.BYTE;if(i===be)return t.SHORT;if(i===Me)return t.UNSIGNED_SHORT;if(i===Se)return t.INT;if(i===we)return t.UNSIGNED_INT;if(i===Te)return t.FLOAT;if(i===Ce)return t.HALF_FLOAT;if(i===Re)return t.ALPHA;if(i===Ie)return t.RGB;if(i===Oe)return t.RGBA;if(i===Le)return t.DEPTH_COMPONENT;if(i===Ne)return t.DEPTH_STENCIL;if(i===Fe)return t.RED;if(i===Ue)return t.RED_INTEGER;if(i===We)return t.RG;if(i===Be)return t.RG_INTEGER;if(i===Ve)return t.RGBA_INTEGER;if(i===He||i===Ge||i===je||i===Xe)if(s===Zi){if(n=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===n)return null;if(i===He)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Ge)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===je)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Xe)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(i===He)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ge)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===je)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Xe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===qe||i===Ye||i===Ze||i===Je){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(i===qe)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Ye)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Ze)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Je)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===Ke||i===$e||i===Qe||i===ti||i===ei||i===ii||i===ri){if(n=e.get("WEBGL_compressed_texture_etc"),null===n)return null;if(i===Ke||i===$e)return s===Zi?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(i===Qe)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC;if(i===ti)return n.COMPRESSED_R11_EAC;if(i===ei)return n.COMPRESSED_SIGNED_R11_EAC;if(i===ii)return n.COMPRESSED_RG11_EAC;if(i===ri)return n.COMPRESSED_SIGNED_RG11_EAC}if(i===ni||i===si||i===oi||i===ai||i===ci||i===li||i===hi||i===ui||i===di||i===pi||i===fi||i===mi||i===gi||i===vi){if(n=e.get("WEBGL_compressed_texture_astc"),null===n)return null;if(i===ni)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===si)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===oi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===ai)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===ci)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===li)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===hi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===ui)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===di)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===pi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===fi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===mi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===gi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===vi)return s===Zi?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===_i||i===yi||i===xi){if(n=e.get("EXT_texture_compression_bptc"),null===n)return null;if(i===_i)return s===Zi?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===yi)return n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===xi)return n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===bi||i===Mi||i===Si||i===wi){if(n=e.get("EXT_texture_compression_rgtc"),null===n)return null;if(i===bi)return n.COMPRESSED_RED_RGTC1_EXT;if(i===Mi)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Si)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===wi)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Ae?t.UNSIGNED_INT_24_8:void 0!==t[i]?t[i]:null}}}class Ag{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e){if(null===this.texture){const i=new ml(t.texture);t.depthNear===e.depthNear&&t.depthFar===e.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,i=new ea({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new Yo(new Dh(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Dg extends Qr{constructor(t,e){super();const i=this;let r=null,n=1,s=null,o="local-floor",a=1,c=null,l=null,h=null,u=null,d=null,p=null;const f="undefined"!=typeof XRWebGLBinding,m=new Ag,g={},v=e.getContextAttributes();let _=null,y=null;const x=[],b=[],M=new dn;let S=null;const w=new oa;w.viewport=new In;const T=new oa;T.viewport=new In;const C=[w,T],E=new dd;let P=null,A=null;function D(t){const e=b.indexOf(t.inputSource);if(-1===e)return;const i=x[e];void 0!==i&&(i.update(t.inputSource,t.frame,c||s),i.dispatchEvent({type:t.type,data:t.inputSource}))}function k(){r.removeEventListener("select",D),r.removeEventListener("selectstart",D),r.removeEventListener("selectend",D),r.removeEventListener("squeeze",D),r.removeEventListener("squeezestart",D),r.removeEventListener("squeezeend",D),r.removeEventListener("end",k),r.removeEventListener("inputsourceschange",R);for(let t=0;t<x.length;t++){const e=b[t];null!==e&&(b[t]=null,x[t].disconnect(e))}P=null,A=null,m.reset();for(const t in g)delete g[t];t.setRenderTarget(_),d=null,u=null,h=null,r=null,y=null,F.stop(),i.isPresenting=!1,t.setPixelRatio(S),t.setSize(M.width,M.height,!1),i.dispatchEvent({type:"sessionend"})}function R(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],r=b.indexOf(i);r>=0&&(b[r]=null,x[r].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let r=b.indexOf(i);if(-1===r){for(let t=0;t<x.length;t++){if(t>=b.length){b.push(i),r=t;break}if(null===b[t]){b[t]=i,r=t;break}}if(-1===r)break}const n=x[r];n&&n.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=x[t];return void 0===e&&(e=new pa,x[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=x[t];return void 0===e&&(e=new pa,x[t]=e),e.getGripSpace()},this.getHand=function(t){let e=x[t];return void 0===e&&(e=new pa,x[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){n=t,!0===i.isPresenting&&Jr("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&Jr("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(t){c=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return null===h&&f&&(h=new XRWebGLBinding(r,e)),h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(l){if(r=l,null!==r){if(_=t.getRenderTarget(),r.addEventListener("select",D),r.addEventListener("selectstart",D),r.addEventListener("selectend",D),r.addEventListener("squeeze",D),r.addEventListener("squeezestart",D),r.addEventListener("squeezeend",D),r.addEventListener("end",k),r.addEventListener("inputsourceschange",R),!0!==v.xrCompatible&&await e.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(M),f&&"createProjectionLayer"in XRWebGLBinding.prototype){let i=null,s=null,o=null;v.depth&&(o=v.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=v.stencil?Ne:Le,s=v.stencil?Ae:we);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:n};h=this.getBinding(),u=h.createProjectionLayer(a),r.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),y=new Ln(u.textureWidth,u.textureHeight,{format:Oe,type:ye,depthTexture:new pl(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:v.stencil,colorSpace:t.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:!1===u.ignoreDepthValues,resolveStencilBuffer:!1===u.ignoreDepthValues})}else{const i={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,e,i),r.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),y=new Ln(d.framebufferWidth,d.framebufferHeight,{format:Oe,type:ye,colorSpace:t.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(a),c=null,s=await r.requestReferenceSpace(o),F.setContext(r),F.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const I=new fn,O=new fn;function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;let e=t.near,i=t.far;null!==m.texture&&(m.depthNear>0&&(e=m.depthNear),m.depthFar>0&&(i=m.depthFar)),E.near=T.near=w.near=e,E.far=T.far=w.far=i,P===E.near&&A===E.far||(r.updateRenderState({depthNear:E.near,depthFar:E.far}),P=E.near,A=E.far),E.layers.mask=6|t.layers.mask,w.layers.mask=3&E.layers.mask,T.layers.mask=5&E.layers.mask;const n=t.parent,s=E.cameras;L(E,n);for(let t=0;t<s.length;t++)L(s[t],n);2===s.length?function(t,e,i){I.setFromMatrixPosition(e.matrixWorld),O.setFromMatrixPosition(i.matrixWorld);const r=I.distanceTo(O),n=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=n[14]/(n[10]-1),a=n[14]/(n[10]+1),c=(n[9]+1)/n[5],l=(n[9]-1)/n[5],h=(n[8]-1)/n[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=r/(-h+u),m=f*-h;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===n[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,i=a+f,n=d-m,s=p+(r-m),h=c*a/i*e,u=l*a/i*e;t.projectionMatrix.makePerspective(n,s,h,u,e,i),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(E,w,T):E.projectionMatrix.copy(w.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*nn*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,E,n)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(t){a=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(E)},this.getCameraTexture=function(t){return g[t]};let N=null;const F=new jp;F.setAnimationLoop((function(e,n){if(l=n.getViewerPose(c||s),p=n,null!==l){const e=l.views;null!==d&&(t.setRenderTargetFramebuffer(y,d.framebuffer),t.setRenderTarget(y));let n=!1;e.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=h.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(y,e.colorTexture,e.depthStencilTexture),t.setRenderTarget(y))}let o=C[i];void 0===o&&(o=new oa,o.layers.enable(i),o.viewport=new In,C[i]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(o)}const s=r.enabledFeatures;if(s&&s.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&f){h=i.getBinding();const t=h.getDepthInformation(e[0]);t&&t.isValid&&t.texture&&m.init(t,r.renderState)}if(s&&s.includes("camera-access")&&f){t.state.unbindTexture(),h=i.getBinding();for(let t=0;t<e.length;t++){const i=e[t].camera;if(i){let t=g[i];t||(t=new ml,g[i]=t);const e=h.getCameraImage(i);t.sourceTexture=e}}}}for(let t=0;t<x.length;t++){const e=b[t],i=x[t];null!==e&&void 0!==i&&i.update(e,n,c||s)}N&&N(e,n),n.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:n}),p=null})),this.setAnimationLoop=function(t){N=t},this.dispose=function(){}}}const kg=new Ss,Rg=new ps;function Ig(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function r(t,r){t.opacity.value=r.opacity,r.color&&t.diffuse.value.copy(r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map,i(r.map,t.mapTransform)),r.alphaMap&&(t.alphaMap.value=r.alphaMap,i(r.alphaMap,t.alphaMapTransform)),r.bumpMap&&(t.bumpMap.value=r.bumpMap,i(r.bumpMap,t.bumpMapTransform),t.bumpScale.value=r.bumpScale,r.side===st&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,i(r.normalMap,t.normalMapTransform),t.normalScale.value.copy(r.normalScale),r.side===st&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,i(r.displacementMap,t.displacementMapTransform),t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap,i(r.emissiveMap,t.emissiveMapTransform)),r.specularMap&&(t.specularMap.value=r.specularMap,i(r.specularMap,t.specularMapTransform)),r.alphaTest>0&&(t.alphaTest.value=r.alphaTest);const n=e.get(r),s=n.envMap,o=n.envMapRotation;s&&(t.envMap.value=s,kg.copy(o),kg.x*=-1,kg.y*=-1,kg.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(kg.y*=-1,kg.z*=-1),t.envMapRotation.value.setFromMatrix4(Rg.makeRotationFromEuler(kg)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=r.reflectivity,t.ior.value=r.ior,t.refractionRatio.value=r.refractionRatio),r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity,i(r.lightMap,t.lightMapTransform)),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity,i(r.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,Qo(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,n,s,o,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?r(t,n):n.isMeshToonMaterial?(r(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(r(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(r(t,n),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,i(e.metalnessMap,t.metalnessMapTransform)),t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,i(e.roughnessMap,t.roughnessMapTransform)),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,r){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===st&&t.clearcoatNormalScale.value.negate())),e.dispersion>0&&(t.dispersion.value=e.dispersion),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,n,a)):n.isMeshMatcapMaterial?(r(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?r(t,n):n.isMeshDistanceMaterial?(r(t,n),function(t,i){const r=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(r.matrixWorld),t.nearDistance.value=r.shadow.camera.near,t.farDistance.value=r.shadow.camera.far}(t,n)):n.isMeshNormalMaterial?r(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,r,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*n,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,n,s,o):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Og(t,e,i,r){let n={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(t,e,i,r){const n=t.value,s=e+"_"+i;if(void 0===r[s])return r[s]="number"==typeof n||"boolean"==typeof n?n:n.clone(),!0;{const t=r[s];if("number"==typeof n||"boolean"==typeof n){if(t!==n)return r[s]=n,!0}else if(!1===t.equals(n))return t.copy(n),!0}return!1}function l(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?Jr("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Jr("WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const i=e.target;i.removeEventListener("dispose",h);const r=o.indexOf(i.__bindingPointIndex);o.splice(r,1),t.deleteBuffer(n[i.id]),delete n[i.id],delete s[i.id]}return{bind:function(t,e){const i=e.program;r.uniformBlockBinding(t,i)},update:function(i,u){let d=n[i.id];void 0===d&&(function(t){const e=t.uniforms;let i=0;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=r.length;t<e;t++){const e=r[t],n=Array.isArray(e.value)?e.value:[e.value];for(let t=0,r=n.length;t<r;t++){const r=l(n[t]),s=i%16,o=s%r.boundary,a=s+o;i+=o,0!==a&&16-a<r.storage&&(i+=16-a),e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,i+=r.storage}}}const r=i%16;r>0&&(i+=16-r),t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return Kr("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const r=t.createBuffer(),n=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,n,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,r),r}(i),n[i.id]=d,i.addEventListener("dispose",h));const p=u.program;r.updateUBOMapping(i,p);const f=e.render.frame;s[i.id]!==f&&(function(e){const i=n[e.id],r=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=r.length;e<i;e++){const i=Array.isArray(r[e])?r[e]:[r[e]];for(let r=0,n=i.length;r<n;r++){const n=i[r];if(!0===c(n,e,r,s)){const e=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let s=0;s<i.length;s++){const o=i[s],a=l(o);"number"==typeof o||"boolean"==typeof o?(n.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,n.__data)):o.isMatrix3?(n.__data[0]=o.elements[0],n.__data[1]=o.elements[1],n.__data[2]=o.elements[2],n.__data[3]=0,n.__data[4]=o.elements[3],n.__data[5]=o.elements[4],n.__data[6]=o.elements[5],n.__data[7]=0,n.__data[8]=o.elements[6],n.__data[9]=o.elements[7],n.__data[10]=o.elements[8],n.__data[11]=0):(o.toArray(n.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,n.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),s[i.id]=f)},dispose:function(){for(const e in n)t.deleteBuffer(n[e]);o=[],n={},s={}}}}const Lg=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Ng=null;class Fg{constructor(t={}){const{canvas:e=Gr(),context:i=null,depth:r=!0,stencil:n=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:c=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:u=!1,outputBufferType:d=ye}=t;let p;if(this.isWebGLRenderer=!0,null!==i){if("undefined"!=typeof WebGLRenderingContext&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=s;const f=d,m=new Set([Ve,Be,Ue]),g=new Set([ye,we,Me,Ae,Ee,Pe]),v=new Uint32Array(4),_=new Int32Array(4);let y=null,x=null;const b=[],M=[];let S=null;this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Gt,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const w=this;let T=!1;this._outputColorSpace=Xi;let C=0,E=0,P=null,A=-1,D=null;const k=new In,R=new In;let I=null;const O=new so(0);let L=0,N=e.width,F=e.height,U=1,W=null,B=null;const z=new In(0,0,N,F),V=new In(0,0,N,F);let H=!1;const G=new gc;let j=!1,X=!1;const Y=new ps,Z=new fn,J=new In,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let $=!1;function Q(){return null===P?U:1}let tt,et,it,rt,at,ct,lt,ht,ut,dt,pt,ft,mt,gt,vt,_t,yt,xt,bt,Mt,St,wt,Tt,Ct,Et=i;function Pt(t,i){return e.getContext(t,i)}try{const t={alpha:!0,depth:r,stencil:n,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${q}`),e.addEventListener("webglcontextlost",kt,!1),e.addEventListener("webglcontextrestored",Rt,!1),e.addEventListener("webglcontextcreationerror",It,!1),null===Et){const e="webgl2";if(Et=Pt(e,t),null===Et)throw Pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw Kr("WebGLRenderer: "+t.message),t}function At(){tt=new xf(Et),tt.init(),wt=new Pg(Et,tt),et=new rf(Et,tt,t,wt),it=new Cg(Et,tt),et.reversedDepthBuffer&&u&&it.buffers.depth.setReversed(!0),rt=new Sf(Et),at=new cg,ct=new Eg(Et,tt,it,at,et,wt,rt),lt=new sf(w),ht=new yf(w),ut=new Xp(Et),Tt=new tf(Et,ut),dt=new bf(Et,ut,rt,Tt),pt=new Tf(Et,dt,ut,rt),bt=new wf(Et,et,ct),_t=new nf(at),ft=new ag(w,lt,ht,tt,et,Tt,_t),mt=new Ig(w,at),gt=new dg,vt=new _g(tt),xt=new Qp(w,lt,ht,it,pt,p,a),yt=new wg(w,pt,et),Ct=new Og(Et,rt,et,it),Mt=new ef(Et,tt,rt),St=new Mf(Et,tt,rt),rt.programs=ft.programs,w.capabilities=et,w.extensions=tt,w.properties=at,w.renderLists=gt,w.shadowMap=yt,w.state=it,w.info=rt}At(),f!==ye&&(S=new Ef(f,e.width,e.height,r,n));const Dt=new Dg(w,Et);function kt(t){t.preventDefault(),Zr("WebGLRenderer: Context Lost."),T=!0}function Rt(){Zr("WebGLRenderer: Context Restored."),T=!1;const t=rt.autoReset,e=yt.enabled,i=yt.autoUpdate,r=yt.needsUpdate,n=yt.type;At(),rt.autoReset=t,yt.enabled=e,yt.autoUpdate=i,yt.needsUpdate=r,yt.type=n}function It(t){Kr("WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Ot(t){const e=t.target;e.removeEventListener("dispose",Ot),function(t){(function(t){const e=at.get(t).programs;void 0!==e&&(e.forEach((function(t){ft.releaseProgram(t)})),t.isShaderMaterial&&ft.releaseShaderCache(t))})(t),at.remove(t)}(e)}function Lt(t,e,i){!0===t.transparent&&t.side===ot&&!1===t.forceSinglePass?(t.side=st,t.needsUpdate=!0,Xt(t,e,i),t.side=nt,t.needsUpdate=!0,Xt(t,e,i),t.side=ot):Xt(t,e,i)}this.xr=Dt,this.getContext=function(){return Et},this.getContextAttributes=function(){return Et.getContextAttributes()},this.forceContextLoss=function(){const t=tt.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=tt.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(t){void 0!==t&&(U=t,this.setSize(N,F,!1))},this.getSize=function(t){return t.set(N,F)},this.setSize=function(t,i,r=!0){Dt.isPresenting?Jr("WebGLRenderer: Can't change size while VR device is presenting."):(N=t,F=i,e.width=Math.floor(t*U),e.height=Math.floor(i*U),!0===r&&(e.style.width=t+"px",e.style.height=i+"px"),null!==S&&S.setSize(e.width,e.height),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(N*U,F*U).floor()},this.setDrawingBufferSize=function(t,i,r){N=t,F=i,U=r,e.width=Math.floor(t*r),e.height=Math.floor(i*r),this.setViewport(0,0,t,i)},this.setEffects=function(t){if(f!==ye){if(t)for(let e=0;e<t.length;e++)if(!0===t[e].isOutputPass){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}S.setEffects(t||[])}else console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.")},this.getCurrentViewport=function(t){return t.copy(k)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,e,i,r){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,i,r),it.viewport(k.copy(z).multiplyScalar(U).round())},this.getScissor=function(t){return t.copy(V)},this.setScissor=function(t,e,i,r){t.isVector4?V.set(t.x,t.y,t.z,t.w):V.set(t,e,i,r),it.scissor(R.copy(V).multiplyScalar(U).round())},this.getScissorTest=function(){return H},this.setScissorTest=function(t){it.setScissorTest(H=t)},this.setOpaqueSort=function(t){W=t},this.setTransparentSort=function(t){B=t},this.getClearColor=function(t){return t.copy(xt.getClearColor())},this.setClearColor=function(){xt.setClearColor(...arguments)},this.getClearAlpha=function(){return xt.getClearAlpha()},this.setClearAlpha=function(){xt.setClearAlpha(...arguments)},this.clear=function(t=!0,e=!0,i=!0){let r=0;if(t){let t=!1;if(null!==P){const e=P.texture.format;t=m.has(e)}if(t){const t=P.texture.type,e=g.has(t),i=xt.getClearColor(),r=xt.getClearAlpha(),n=i.r,s=i.g,o=i.b;e?(v[0]=n,v[1]=s,v[2]=o,v[3]=r,Et.clearBufferuiv(Et.COLOR,0,v)):(_[0]=n,_[1]=s,_[2]=o,_[3]=r,Et.clearBufferiv(Et.COLOR,0,_))}else r|=Et.COLOR_BUFFER_BIT}e&&(r|=Et.DEPTH_BUFFER_BIT),i&&(r|=Et.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Et.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",kt,!1),e.removeEventListener("webglcontextrestored",Rt,!1),e.removeEventListener("webglcontextcreationerror",It,!1),xt.dispose(),gt.dispose(),vt.dispose(),at.dispose(),lt.dispose(),ht.dispose(),pt.dispose(),Tt.dispose(),Ct.dispose(),ft.dispose(),Dt.dispose(),Dt.removeEventListener("sessionstart",Ft),Dt.removeEventListener("sessionend",Ut),Wt.stop()},this.renderBufferDirect=function(t,e,i,r,n,s){null===e&&(e=K);const o=n.isMesh&&n.matrixWorld.determinant()<0,a=function(t,e,i,r,n){!0!==e.isScene&&(e=K),ct.resetTextureUnits();const s=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===P?w.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:qi,c=(r.isMeshStandardMaterial?ht:lt).get(r.envMap||o),l=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!i.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let f=Gt;r.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(f=w.toneMapping));const m=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,g=void 0!==m?m.length:0,v=at.get(r),_=x.state.lights;if(!0===j&&(!0===X||t!==D)){const e=t===D&&r.id===A;_t.setState(r,t,e)}let y=!1;r.version===v.__version?v.needsLights&&v.lightsStateVersion!==_.state.version||v.outputColorSpace!==a||n.isBatchedMesh&&!1===v.batching?y=!0:n.isBatchedMesh||!0!==v.batching?n.isBatchedMesh&&!0===v.batchingColor&&null===n.colorTexture||n.isBatchedMesh&&!1===v.batchingColor&&null!==n.colorTexture||n.isInstancedMesh&&!1===v.instancing?y=!0:n.isInstancedMesh||!0!==v.instancing?n.isSkinnedMesh&&!1===v.skinning?y=!0:n.isSkinnedMesh||!0!==v.skinning?n.isInstancedMesh&&!0===v.instancingColor&&null===n.instanceColor||n.isInstancedMesh&&!1===v.instancingColor&&null!==n.instanceColor||n.isInstancedMesh&&!0===v.instancingMorph&&null===n.morphTexture||n.isInstancedMesh&&!1===v.instancingMorph&&null!==n.morphTexture||v.envMap!==c||!0===r.fog&&v.fog!==s?y=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===_t.numPlanes&&v.numIntersection===_t.numIntersection?(v.vertexAlphas!==l||v.vertexTangents!==h||v.morphTargets!==u||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==g)&&(y=!0):y=!0:y=!0:y=!0:y=!0:(y=!0,v.__version=r.version);let b=v.currentProgram;!0===y&&(b=Xt(r,e,n));let M=!1,S=!1,T=!1;const C=b.getUniforms(),E=v.uniforms;if(it.useProgram(b.program)&&(M=!0,S=!0,T=!0),r.id!==A&&(A=r.id,S=!0),M||D!==t){it.buffers.depth.getReversed()&&!0!==t.reversedDepth&&(t._reversedDepth=!0,t.updateProjectionMatrix()),C.setValue(Et,"projectionMatrix",t.projectionMatrix),C.setValue(Et,"viewMatrix",t.matrixWorldInverse);const e=C.map.cameraPosition;void 0!==e&&e.setValue(Et,Z.setFromMatrixPosition(t.matrixWorld)),et.logarithmicDepthBuffer&&C.setValue(Et,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&C.setValue(Et,"isOrthographic",!0===t.isOrthographicCamera),D!==t&&(D=t,S=!0,T=!0)}if(v.needsLights&&(_.state.directionalShadowMap.length>0&&C.setValue(Et,"directionalShadowMap",_.state.directionalShadowMap,ct),_.state.spotShadowMap.length>0&&C.setValue(Et,"spotShadowMap",_.state.spotShadowMap,ct),_.state.pointShadowMap.length>0&&C.setValue(Et,"pointShadowMap",_.state.pointShadowMap,ct)),n.isSkinnedMesh){C.setOptional(Et,n,"bindMatrix"),C.setOptional(Et,n,"bindMatrixInverse");const t=n.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),C.setValue(Et,"boneTexture",t.boneTexture,ct))}n.isBatchedMesh&&(C.setOptional(Et,n,"batchingTexture"),C.setValue(Et,"batchingTexture",n._matricesTexture,ct),C.setOptional(Et,n,"batchingIdTexture"),C.setValue(Et,"batchingIdTexture",n._indirectTexture,ct),C.setOptional(Et,n,"batchingColorTexture"),null!==n._colorsTexture&&C.setValue(Et,"batchingColorTexture",n._colorsTexture,ct));const k=i.morphAttributes;var R,I;if(void 0===k.position&&void 0===k.normal&&void 0===k.color||bt.update(n,i,b),(S||v.receiveShadow!==n.receiveShadow)&&(v.receiveShadow=n.receiveShadow,C.setValue(Et,"receiveShadow",n.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(E.envMap.value=c,E.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==e.environment&&(E.envMapIntensity.value=e.environmentIntensity),void 0!==E.dfgLUT&&(E.dfgLUT.value=(null===Ng&&(Ng=new Ja(Lg,16,16,We,Ce),Ng.name="DFG_LUT",Ng.minFilter=fe,Ng.magFilter=fe,Ng.wrapS=ae,Ng.wrapT=ae,Ng.generateMipmaps=!1,Ng.needsUpdate=!0),Ng)),S&&(C.setValue(Et,"toneMappingExposure",w.toneMappingExposure),v.needsLights&&(I=T,(R=E).ambientLightColor.needsUpdate=I,R.lightProbe.needsUpdate=I,R.directionalLights.needsUpdate=I,R.directionalLightShadows.needsUpdate=I,R.pointLights.needsUpdate=I,R.pointLightShadows.needsUpdate=I,R.spotLights.needsUpdate=I,R.spotLightShadows.needsUpdate=I,R.rectAreaLights.needsUpdate=I,R.hemisphereLights.needsUpdate=I),s&&!0===r.fog&&mt.refreshFogUniforms(E,s),mt.refreshMaterialUniforms(E,r,U,F,x.state.transmissionRenderTarget[t.id]),Rm.upload(Et,qt(v),E,ct)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Rm.upload(Et,qt(v),E,ct),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&C.setValue(Et,"center",n.center),C.setValue(Et,"modelViewMatrix",n.modelViewMatrix),C.setValue(Et,"normalMatrix",n.normalMatrix),C.setValue(Et,"modelMatrix",n.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const t=r.uniformsGroups;for(let e=0,i=t.length;e<i;e++){const i=t[e];Ct.update(i,b),Ct.bind(i,b)}}return b}(t,e,i,r,n);it.setMaterial(r,o);let c=i.index,l=1;if(!0===r.wireframe){if(c=dt.getWireframeAttribute(i),void 0===c)return;l=2}const h=i.drawRange,u=i.attributes.position;let d=h.start*l,p=(h.start+h.count)*l;null!==s&&(d=Math.max(d,s.start*l),p=Math.min(p,(s.start+s.count)*l)),null!==c?(d=Math.max(d,0),p=Math.min(p,c.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let m;Tt.setup(n,r,a,i,c);let g=Mt;if(null!==c&&(m=ut.get(c),g=St,g.setIndex(m)),n.isMesh)!0===r.wireframe?(it.setLineWidth(r.wireframeLinewidth*Q()),g.setMode(Et.LINES)):g.setMode(Et.TRIANGLES);else if(n.isLine){let t=r.linewidth;void 0===t&&(t=1),it.setLineWidth(t*Q()),n.isLineSegments?g.setMode(Et.LINES):n.isLineLoop?g.setMode(Et.LINE_LOOP):g.setMode(Et.LINE_STRIP)}else n.isPoints?g.setMode(Et.POINTS):n.isSprite&&g.setMode(Et.TRIANGLES);if(n.isBatchedMesh)if(null!==n._multiDrawInstances)$r("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(n._multiDrawStarts,n._multiDrawCounts,n._multiDrawCount,n._multiDrawInstances);else if(tt.get("WEBGL_multi_draw"))g.renderMultiDraw(n._multiDrawStarts,n._multiDrawCounts,n._multiDrawCount);else{const t=n._multiDrawStarts,e=n._multiDrawCounts,i=n._multiDrawCount,s=c?ut.get(c).bytesPerElement:1,o=at.get(r).currentProgram.getUniforms();for(let r=0;r<i;r++)o.setValue(Et,"_gl_DrawID",r),g.render(t[r]/s,e[r])}else if(n.isInstancedMesh)g.renderInstances(d,f,n.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);g.renderInstances(d,f,e)}else g.render(d,f)},this.compile=function(t,e,i=null){null===i&&(i=t),x=vt.get(i),x.init(e),M.push(x),i.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))})),t!==i&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))})),x.setupLights();const r=new Set;return t.traverse((function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let n=0;n<e.length;n++){const s=e[n];Lt(s,i,t),r.add(s)}else Lt(e,i,t),r.add(e)})),x=M.pop(),r},this.compileAsync=function(t,e,i=null){const r=this.compile(t,e,i);return new Promise((e=>{function i(){r.forEach((function(t){at.get(t).currentProgram.isReady()&&r.delete(t)})),0!==r.size?setTimeout(i,10):e(t)}null!==tt.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)}))};let Nt=null;function Ft(){Wt.stop()}function Ut(){Wt.start()}const Wt=new jp;function Bt(t,e,i,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)x.pushLight(t),t.castShadow&&x.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||G.intersectsSprite(t)){r&&J.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Y);const e=pt.update(t),n=t.material;n.visible&&y.push(t,e,n,i,J.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||G.intersectsObject(t))){const e=pt.update(t),n=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),J.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),J.copy(e.boundingSphere.center)),J.applyMatrix4(t.matrixWorld).applyMatrix4(Y)),Array.isArray(n)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=n[o.materialIndex];a&&a.visible&&y.push(t,e,a,i,J.z,o)}}else n.visible&&y.push(t,e,n,i,J.z,null)}const n=t.children;for(let t=0,s=n.length;t<s;t++)Bt(n[t],e,i,r)}function zt(t,e,i,r){const{opaque:n,transmissive:s,transparent:o}=t;x.setupLightsView(i),!0===j&&_t.setGlobalState(w.clippingPlanes,i),r&&it.viewport(k.copy(r)),n.length>0&&Ht(n,e,i),s.length>0&&Ht(s,e,i),o.length>0&&Ht(o,e,i),it.buffers.depth.setTest(!0),it.buffers.depth.setMask(!0),it.buffers.color.setMask(!0),it.setPolygonOffset(!1)}function Vt(t,e,i,r){if(null!==(!0===i.isScene?i.overrideMaterial:null))return;if(void 0===x.state.transmissionRenderTarget[r.id]){const t=tt.has("EXT_color_buffer_half_float")||tt.has("EXT_color_buffer_float");x.state.transmissionRenderTarget[r.id]=new Ln(1,1,{generateMipmaps:!0,type:t?Ce:ye,minFilter:ve,samples:et.samples,stencilBuffer:n,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Mn.workingColorSpace})}const s=x.state.transmissionRenderTarget[r.id],o=r.viewport||k;s.setSize(o.z*w.transmissionResolutionScale,o.w*w.transmissionResolutionScale);const a=w.getRenderTarget(),c=w.getActiveCubeFace(),l=w.getActiveMipmapLevel();w.setRenderTarget(s),w.getClearColor(O),L=w.getClearAlpha(),L<1&&w.setClearColor(16777215,.5),w.clear(),$&&xt.render(i);const h=w.toneMapping;w.toneMapping=Gt;const u=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),x.setupLightsView(r),!0===j&&_t.setGlobalState(w.clippingPlanes,r),Ht(t,i,r),ct.updateMultisampleRenderTarget(s),ct.updateRenderTargetMipmap(s),!1===tt.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let n=0,s=e.length;n<s;n++){const s=e[n],{object:o,geometry:a,material:c,group:l}=s;if(c.side===ot&&o.layers.test(r.layers)){const e=c.side;c.side=st,c.needsUpdate=!0,jt(o,i,r,a,c,l),c.side=e,c.needsUpdate=!0,t=!0}}!0===t&&(ct.updateMultisampleRenderTarget(s),ct.updateRenderTargetMipmap(s))}w.setRenderTarget(a,c,l),w.setClearColor(O,L),void 0!==u&&(r.viewport=u),w.toneMapping=h}function Ht(t,e,i){const r=!0===e.isScene?e.overrideMaterial:null;for(let n=0,s=t.length;n<s;n++){const s=t[n],{object:o,geometry:a,group:c}=s;let l=s.material;!0===l.allowOverride&&null!==r&&(l=r),o.layers.test(i.layers)&&jt(o,e,i,a,l,c)}}function jt(t,e,i,r,n,s){t.onBeforeRender(w,e,i,r,n,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),n.onBeforeRender(w,e,i,r,t,s),!0===n.transparent&&n.side===ot&&!1===n.forceSinglePass?(n.side=st,n.needsUpdate=!0,w.renderBufferDirect(i,e,r,n,t,s),n.side=nt,n.needsUpdate=!0,w.renderBufferDirect(i,e,r,n,t,s),n.side=ot):w.renderBufferDirect(i,e,r,n,t,s),t.onAfterRender(w,e,i,r,n,s)}function Xt(t,e,i){!0!==e.isScene&&(e=K);const r=at.get(t),n=x.state.lights,s=x.state.shadowsArray,o=n.state.version,a=ft.getParameters(t,n.state,s,e,i),c=ft.getProgramCacheKey(a);let l=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?ht:lt).get(t.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===l&&(t.addEventListener("dispose",Ot),l=new Map,r.programs=l);let h=l.get(c);if(void 0!==h){if(r.currentProgram===h&&r.lightsStateVersion===o)return Yt(t,a),h}else a.uniforms=ft.getUniforms(t),t.onBeforeCompile(a,w),h=ft.acquireProgram(a,c),l.set(c,h),r.uniforms=a.uniforms;const u=r.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=_t.uniform),Yt(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(u.ambientLightColor.value=n.state.ambient,u.lightProbe.value=n.state.probe,u.directionalLights.value=n.state.directional,u.directionalLightShadows.value=n.state.directionalShadow,u.spotLights.value=n.state.spot,u.spotLightShadows.value=n.state.spotShadow,u.rectAreaLights.value=n.state.rectArea,u.ltc_1.value=n.state.rectAreaLTC1,u.ltc_2.value=n.state.rectAreaLTC2,u.pointLights.value=n.state.point,u.pointLightShadows.value=n.state.pointShadow,u.hemisphereLights.value=n.state.hemi,u.directionalShadowMap.value=n.state.directionalShadowMap,u.directionalShadowMatrix.value=n.state.directionalShadowMatrix,u.spotShadowMap.value=n.state.spotShadowMap,u.spotLightMatrix.value=n.state.spotLightMatrix,u.spotLightMap.value=n.state.spotLightMap,u.pointShadowMap.value=n.state.pointShadowMap,u.pointShadowMatrix.value=n.state.pointShadowMatrix),r.currentProgram=h,r.uniformsList=null,h}function qt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Rm.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Yt(t,e){const i=at.get(t);i.outputColorSpace=e.outputColorSpace,i.batching=e.batching,i.batchingColor=e.batchingColor,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.instancingMorph=e.instancingMorph,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Wt.setAnimationLoop((function(t){Nt&&Nt(t)})),"undefined"!=typeof self&&Wt.setContext(self),this.setAnimationLoop=function(t){Nt=t,Dt.setAnimationLoop(t),null===t?Wt.stop():Wt.start()},Dt.addEventListener("sessionstart",Ft),Dt.addEventListener("sessionend",Ut),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void Kr("WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===T)return;const i=!0===Dt.enabled&&!0===Dt.isPresenting,r=null!==S&&(null===P||i)&&S.begin(w,P);if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0!==Dt.enabled||!0!==Dt.isPresenting||null!==S&&!1!==S.isCompositing()||(!0===Dt.cameraAutoUpdate&&Dt.updateCamera(e),e=Dt.getCamera()),!0===t.isScene&&t.onBeforeRender(w,t,e,P),x=vt.get(t,M.length),x.init(e),M.push(x),Y.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),G.setFromProjectionMatrix(Y,Or,e.reversedDepth),X=this.localClippingEnabled,j=_t.init(this.clippingPlanes,X),y=gt.get(t,b.length),y.init(),b.push(y),!0===Dt.enabled&&!0===Dt.isPresenting){const t=w.xr.getDepthSensingMesh();null!==t&&Bt(t,e,-1/0,w.sortObjects)}Bt(t,e,0,w.sortObjects),y.finish(),!0===w.sortObjects&&y.sort(W,B),$=!1===Dt.enabled||!1===Dt.isPresenting||!1===Dt.hasDepthSensing(),$&&xt.addToRenderList(y,t),this.info.render.frame++,!0===j&&_t.beginShadows();const n=x.state.shadowsArray;if(yt.render(n,t,e),!0===j&&_t.endShadows(),!0===this.info.autoReset&&this.info.reset(),!1===(r&&S.hasRenderPass())){const i=y.opaque,r=y.transmissive;if(x.setupLights(),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,s=n.length;e<s;e++)Vt(i,r,t,n[e]);$&&xt.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];zt(y,t,i,i.viewport)}}else r.length>0&&Vt(i,r,t,e),$&&xt.render(t),zt(y,t,e)}null!==P&&0===E&&(ct.updateMultisampleRenderTarget(P),ct.updateRenderTargetMipmap(P)),r&&S.end(w),!0===t.isScene&&t.onAfterRender(w,t,e),Tt.resetDefaultState(),A=-1,D=null,M.pop(),M.length>0?(x=M[M.length-1],!0===j&&_t.setGlobalState(w.clippingPlanes,x.state.camera)):x=null,b.pop(),y=b.length>0?b[b.length-1]:null},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(t,e,i){const r=at.get(t);r.__autoAllocateDepthBuffer=!1===t.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),at.get(t.texture).__webglTexture=e,at.get(t.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:i,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(t,e){const i=at.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e};const Zt=Et.createFramebuffer();this.setRenderTarget=function(t,e=0,i=0){P=t,C=e,E=i;let r=null,n=!1,s=!1;if(t){const o=at.get(t);if(void 0!==o.__useDefaultFramebuffer)return it.bindFramebuffer(Et.FRAMEBUFFER,o.__webglFramebuffer),k.copy(t.viewport),R.copy(t.scissor),I=t.scissorTest,it.viewport(k),it.scissor(R),it.setScissorTest(I),void(A=-1);if(void 0===o.__webglFramebuffer)ct.setupRenderTarget(t);else if(o.__hasExternalTextures)ct.rebindTextures(t,at.get(t.texture).__webglTexture,at.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(o.__boundDepthTexture!==e){if(null!==e&&at.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ct.setupDepthRenderbuffer(t)}}const a=t.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(s=!0);const c=at.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][i]:c[e],n=!0):r=t.samples>0&&!1===ct.useMultisampledRTT(t)?at.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[i]:c,k.copy(t.viewport),R.copy(t.scissor),I=t.scissorTest}else k.copy(z).multiplyScalar(U).floor(),R.copy(V).multiplyScalar(U).floor(),I=H;if(0!==i&&(r=Zt),it.bindFramebuffer(Et.FRAMEBUFFER,r)&&it.drawBuffers(t,r),it.viewport(k),it.scissor(R),it.setScissorTest(I),n){const r=at.get(t.texture);Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,i)}else if(s){const r=e;for(let e=0;e<t.textures.length;e++){const n=at.get(t.textures[e]);Et.framebufferTextureLayer(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0+e,n.__webglTexture,i,r)}}else if(null!==t&&0!==i){const e=at.get(t.texture);Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_2D,e.__webglTexture,i)}A=-1},this.readRenderTargetPixels=function(t,e,i,r,n,s,o,a=0){if(!t||!t.isWebGLRenderTarget)return void Kr("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let c=at.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(c=c[o]),c){it.bindFramebuffer(Et.FRAMEBUFFER,c);try{const o=t.textures[a],c=o.format,l=o.type;if(!et.textureFormatReadable(c))return void Kr("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!et.textureTypeReadable(l))return void Kr("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&i>=0&&i<=t.height-n&&(t.textures.length>1&&Et.readBuffer(Et.COLOR_ATTACHMENT0+a),Et.readPixels(e,i,r,n,wt.convert(c),wt.convert(l),s))}finally{const t=null!==P?at.get(P).__webglFramebuffer:null;it.bindFramebuffer(Et.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,i,r,n,s,o,a=0){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let c=at.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(c=c[o]),c){if(e>=0&&e<=t.width-r&&i>=0&&i<=t.height-n){it.bindFramebuffer(Et.FRAMEBUFFER,c);const o=t.textures[a],l=o.format,h=o.type;if(!et.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!et.textureTypeReadable(h))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const u=Et.createBuffer();Et.bindBuffer(Et.PIXEL_PACK_BUFFER,u),Et.bufferData(Et.PIXEL_PACK_BUFFER,s.byteLength,Et.STREAM_READ),t.textures.length>1&&Et.readBuffer(Et.COLOR_ATTACHMENT0+a),Et.readPixels(e,i,r,n,wt.convert(l),wt.convert(h),0);const d=null!==P?at.get(P).__webglFramebuffer:null;it.bindFramebuffer(Et.FRAMEBUFFER,d);const p=Et.fenceSync(Et.SYNC_GPU_COMMANDS_COMPLETE,0);return Et.flush(),await function(t,e,i){return new Promise((function(i,r){setTimeout((function n(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(n,4);break;default:i()}}),4)}))}(Et,p),Et.bindBuffer(Et.PIXEL_PACK_BUFFER,u),Et.getBufferSubData(Et.PIXEL_PACK_BUFFER,0,s),Et.deleteBuffer(u),Et.deleteSync(p),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t,e=null,i=0){const r=Math.pow(2,-i),n=Math.floor(t.image.width*r),s=Math.floor(t.image.height*r),o=null!==e?e.x:0,a=null!==e?e.y:0;ct.setTexture2D(t,0),Et.copyTexSubImage2D(Et.TEXTURE_2D,i,0,0,o,a,n,s),it.unbindTexture()};const Jt=Et.createFramebuffer(),Kt=Et.createFramebuffer();this.copyTextureToTexture=function(t,e,i=null,r=null,n=0,s=null){let o,a,c,l,h,u,d,p,f;null===s&&(0!==n?($r("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),s=n,n=0):s=0);const m=t.isCompressedTexture?t.mipmaps[s]:t.image;if(null!==i)o=i.max.x-i.min.x,a=i.max.y-i.min.y,c=i.isBox3?i.max.z-i.min.z:1,l=i.min.x,h=i.min.y,u=i.isBox3?i.min.z:0;else{const e=Math.pow(2,-n);o=Math.floor(m.width*e),a=Math.floor(m.height*e),c=t.isDataArrayTexture?m.depth:t.isData3DTexture?Math.floor(m.depth*e):1,l=0,h=0,u=0}null!==r?(d=r.x,p=r.y,f=r.z):(d=0,p=0,f=0);const g=wt.convert(e.format),v=wt.convert(e.type);let _;e.isData3DTexture?(ct.setTexture3D(e,0),_=Et.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(ct.setTexture2DArray(e,0),_=Et.TEXTURE_2D_ARRAY):(ct.setTexture2D(e,0),_=Et.TEXTURE_2D),Et.pixelStorei(Et.UNPACK_FLIP_Y_WEBGL,e.flipY),Et.pixelStorei(Et.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Et.pixelStorei(Et.UNPACK_ALIGNMENT,e.unpackAlignment);const y=Et.getParameter(Et.UNPACK_ROW_LENGTH),x=Et.getParameter(Et.UNPACK_IMAGE_HEIGHT),b=Et.getParameter(Et.UNPACK_SKIP_PIXELS),M=Et.getParameter(Et.UNPACK_SKIP_ROWS),S=Et.getParameter(Et.UNPACK_SKIP_IMAGES);Et.pixelStorei(Et.UNPACK_ROW_LENGTH,m.width),Et.pixelStorei(Et.UNPACK_IMAGE_HEIGHT,m.height),Et.pixelStorei(Et.UNPACK_SKIP_PIXELS,l),Et.pixelStorei(Et.UNPACK_SKIP_ROWS,h),Et.pixelStorei(Et.UNPACK_SKIP_IMAGES,u);const w=t.isDataArrayTexture||t.isData3DTexture,T=e.isDataArrayTexture||e.isData3DTexture;if(t.isDepthTexture){const i=at.get(t),r=at.get(e),m=at.get(i.__renderTarget),g=at.get(r.__renderTarget);it.bindFramebuffer(Et.READ_FRAMEBUFFER,m.__webglFramebuffer),it.bindFramebuffer(Et.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let i=0;i<c;i++)w&&(Et.framebufferTextureLayer(Et.READ_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,at.get(t).__webglTexture,n,u+i),Et.framebufferTextureLayer(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,at.get(e).__webglTexture,s,f+i)),Et.blitFramebuffer(l,h,o,a,d,p,o,a,Et.DEPTH_BUFFER_BIT,Et.NEAREST);it.bindFramebuffer(Et.READ_FRAMEBUFFER,null),it.bindFramebuffer(Et.DRAW_FRAMEBUFFER,null)}else if(0!==n||t.isRenderTargetTexture||at.has(t)){const i=at.get(t),r=at.get(e);it.bindFramebuffer(Et.READ_FRAMEBUFFER,Jt),it.bindFramebuffer(Et.DRAW_FRAMEBUFFER,Kt);for(let t=0;t<c;t++)w?Et.framebufferTextureLayer(Et.READ_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,i.__webglTexture,n,u+t):Et.framebufferTexture2D(Et.READ_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_2D,i.__webglTexture,n),T?Et.framebufferTextureLayer(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,r.__webglTexture,s,f+t):Et.framebufferTexture2D(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_2D,r.__webglTexture,s),0!==n?Et.blitFramebuffer(l,h,o,a,d,p,o,a,Et.COLOR_BUFFER_BIT,Et.NEAREST):T?Et.copyTexSubImage3D(_,s,d,p,f+t,l,h,o,a):Et.copyTexSubImage2D(_,s,d,p,l,h,o,a);it.bindFramebuffer(Et.READ_FRAMEBUFFER,null),it.bindFramebuffer(Et.DRAW_FRAMEBUFFER,null)}else T?t.isDataTexture||t.isData3DTexture?Et.texSubImage3D(_,s,d,p,f,o,a,c,g,v,m.data):e.isCompressedArrayTexture?Et.compressedTexSubImage3D(_,s,d,p,f,o,a,c,g,m.data):Et.texSubImage3D(_,s,d,p,f,o,a,c,g,v,m):t.isDataTexture?Et.texSubImage2D(Et.TEXTURE_2D,s,d,p,o,a,g,v,m.data):t.isCompressedTexture?Et.compressedTexSubImage2D(Et.TEXTURE_2D,s,d,p,m.width,m.height,g,m.data):Et.texSubImage2D(Et.TEXTURE_2D,s,d,p,o,a,g,v,m);Et.pixelStorei(Et.UNPACK_ROW_LENGTH,y),Et.pixelStorei(Et.UNPACK_IMAGE_HEIGHT,x),Et.pixelStorei(Et.UNPACK_SKIP_PIXELS,b),Et.pixelStorei(Et.UNPACK_SKIP_ROWS,M),Et.pixelStorei(Et.UNPACK_SKIP_IMAGES,S),0===s&&e.generateMipmaps&&Et.generateMipmap(_),it.unbindTexture()},this.initRenderTarget=function(t){void 0===at.get(t).__webglFramebuffer&&ct.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?ct.setTextureCube(t,0):t.isData3DTexture?ct.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?ct.setTexture2DArray(t,0):ct.setTexture2D(t,0),it.unbindTexture()},this.resetState=function(){C=0,E=0,P=null,it.reset(),Tt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Or}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=Mn._getDrawingBufferColorSpace(t),e.unpackColorSpace=Mn._getUnpackColorSpace()}}class Ug{constructor(t){this.occWorkerManager=t}makeCompound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.compound.makeCompound",t)}getShapesOfCompound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.compound.getShapesOfCompound",t)}}class Wg{constructor(t){this.occWorkerManager=t}fromBaseLine(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseLine",t)}fromBaseLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseLines",t)}fromBaseSegment(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseSegment",t)}fromBaseSegments(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseSegments",t)}fromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromPoints",t)}fromBasePolyline(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBasePolyline",t)}fromBaseTriangle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseTriangle",t)}fromBaseMesh(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.fromBaseMesh",t)}line(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.line",t)}arcThroughThreePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcThroughThreePoints",t)}arcThroughTwoPointsAndTangent(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcThroughTwoPointsAndTangent",t)}arcFromCircleAndTwoPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCircleAndTwoPoints",t)}arcFromCircleAndTwoAngles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCircleAndTwoAngles",t)}arcFromCirclePointAndAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.arcFromCirclePointAndAngle",t)}createCircleEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.createCircleEdge",t)}createEllipseEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.createEllipseEdge",t)}removeInternalEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.removeInternalEdges",t)}makeEdgeFromGeom2dCurveAndSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.makeEdgeFromGeom2dCurveAndSurface",t)}getEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdge",t)}getEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdges",t)}getEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesAlongWire",t)}getCircularEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgesAlongWire",t)}getLinearEdgesAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getLinearEdgesAlongWire",t)}getCornerPointsOfEdgesForShape(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCornerPointsOfEdgesForShape",t)}getEdgeLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeLength",t)}getEdgeLengthsOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeLengthsOfShape",t)}getEdgesLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesLengths",t)}getEdgeCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgeCenterOfMass",t)}getEdgesCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getEdgesCentersOfMass",t)}getCircularEdgeCenterPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgeCenterPoint",t)}getCircularEdgeRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgeRadius",t)}getCircularEdgePlaneDirection(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.getCircularEdgePlaneDirection",t)}pointOnEdgeAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointOnEdgeAtParam",t)}pointsOnEdgesAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointsOnEdgesAtParam",t)}edgesToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.edgesToPoints",t)}reversedEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.reversedEdge",t)}tangentOnEdgeAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentOnEdgeAtParam",t)}tangentsOnEdgesAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentsOnEdgesAtParam",t)}pointOnEdgeAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointOnEdgeAtLength",t)}pointsOnEdgesAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.pointsOnEdgesAtLength",t)}tangentOnEdgeAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentOnEdgeAtLength",t)}tangentsOnEdgesAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.tangentsOnEdgesAtLength",t)}startPointOnEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.startPointOnEdge",t)}startPointsOnEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.startPointsOnEdges",t)}endPointOnEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.endPointOnEdge",t)}endPointsOnEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.endPointsOnEdges",t)}divideEdgeByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgeByParamsToPoints",t)}divideEdgesByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgesByParamsToPoints",t)}divideEdgeByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgeByEqualDistanceToPoints",t)}divideEdgesByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.divideEdgesByEqualDistanceToPoints",t)}constraintTanLinesFromTwoPtsToCircle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesFromTwoPtsToCircle",t)}constraintTanLinesFromPtToCircle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesFromPtToCircle",t)}constraintTanLinesOnTwoCircles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanLinesOnTwoCircles",t)}constraintTanCirclesOnTwoCircles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanCirclesOnTwoCircles",t)}constraintTanCirclesOnCircleAndPnt(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.constraintTanCirclesOnCircleAndPnt",t)}isEdgeLinear(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.isEdgeLinear",t)}isEdgeCircular(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.edge.isEdgeCircular",t)}}class Bg{constructor(t){this.occWorkerManager=t}fromBaseTriangle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.fromBaseTriangle",t)}fromBaseMesh(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.fromBaseMesh",t)}createFacesFromWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFacesFromWiresOnFace",t)}createFaceFromWireOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWireOnFace",t)}createFaceFromWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWire",t)}createFaceFromWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWires",t)}createFaceFromWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromWiresOnFace",t)}createFacesFromWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFacesFromWires",t)}createFaceFromMultipleCircleTanWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromMultipleCircleTanWires",t)}createFaceFromMultipleCircleTanWireCollections(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createFaceFromMultipleCircleTanWireCollections",t)}faceFromSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.faceFromSurface",t)}faceFromSurfaceAndWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.faceFromSurfaceAndWire",t)}createPolygonFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createPolygonFace",t)}createCircleFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createCircleFace",t)}hexagonsInGrid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.hexagonsInGrid",t)}createEllipseFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createEllipseFace",t)}createSquareFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createSquareFace",t)}createRectangleFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createRectangleFace",t)}createLPolygonFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createLPolygonFace",t)}createStarFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createStarFace",t)}createChristmasTreeFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createChristmasTreeFace",t)}createParallelogramFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createParallelogramFace",t)}createHeartFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createHeartFace",t)}createNGonFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createNGonFace",t)}createIBeamProfileFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createIBeamProfileFace",t)}createHBeamProfileFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createHBeamProfileFace",t)}createTBeamProfileFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createTBeamProfileFace",t)}createUBeamProfileFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.createUBeamProfileFace",t)}getFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFace",t)}getFaces(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaces",t)}reversedFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.reversedFace",t)}subdivideToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPoints",t)}subdivideToWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToWires",t)}subdivideToRectangleWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToRectangleWires",t)}subdivideToRectangleHoles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToRectangleHoles",t)}subdivideToHexagonWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToHexagonWires",t)}subdivideToHexagonHoles(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToHexagonHoles",t)}subdivideToPointsControlled(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPointsControlled",t)}subdivideToNormals(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToNormals",t)}subdivideToUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToUV",t)}pointOnUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.pointOnUV",t)}normalOnUV(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.normalOnUV",t)}pointsOnUVs(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.pointsOnUVs",t)}normalsOnUVs(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.normalsOnUVs",t)}subdivideToPointsOnParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.subdivideToPointsOnParam",t)}wireAlongParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.wireAlongParam",t)}wiresAlongParams(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.wiresAlongParams",t)}getUMinBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getUMinBound",t)}getUMaxBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getUMaxBound",t)}getVMinBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getVMinBound",t)}getVMaxBound(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getVMaxBound",t)}getFaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaceArea",t)}getFacesAreas(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFacesAreas",t)}getFaceCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFaceCenterOfMass",t)}getFacesCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.getFacesCentersOfMass",t)}filterFacePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.filterFacePoints",t)}filterFacesPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.face.filterFacesPoints",t)}}class zg{constructor(t){this.occWorkerManager=t}fromClosedShell(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.fromClosedShell",t)}createBox(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createBox",t)}createCube(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCube",t)}createBoxFromCorner(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createBoxFromCorner",t)}createCylinder(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCylinder",t)}createCylindersOnLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCylindersOnLines",t)}createSphere(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createSphere",t)}createCone(t){return t.angle=t.angle*(Math.PI/180),this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createCone",t)}createTorus(t){return t.angle=t.angle*(Math.PI/180),this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createTorus",t)}createStarSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createStarSolid",t)}createNGonSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createNGonSolid",t)}createParallelogramSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createParallelogramSolid",t)}createHeartSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createHeartSolid",t)}createChristmasTreeSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createChristmasTreeSolid",t)}createLPolygonSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createLPolygonSolid",t)}createIBeamProfileSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createIBeamProfileSolid",t)}createHBeamProfileSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createHBeamProfileSolid",t)}createTBeamProfileSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createTBeamProfileSolid",t)}createUBeamProfileSolid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.createUBeamProfileSolid",t)}getSolidSurfaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidSurfaceArea",t)}getSolidVolume(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidVolume",t)}getSolidsVolumes(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidsVolumes",t)}getSolidCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidCenterOfMass",t)}getSolidsCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolidsCentersOfMass",t)}getSolids(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.getSolids",t)}filterSolidPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.solid.filterSolidPoints",t)}}class Vg{static parse(t,e){var i;const r=[t],n=new Set;for(;r.length>0;){const t=r.pop();if("object"==typeof t&&null!==t&&!n.has(t))if(n.add(t),Array.isArray(t))for(let e=0;e<t.length;e++)r.push(t[e]);else{if(Object.keys(t).includes("shapes")){const r=t.shapes;if("object"==typeof r&&null!==r)for(const n in r)t.shapes[n]&&(t.shapes[n]=null===(i=e.find((e=>e.id===t.shapes[n])))||void 0===i?void 0:i.shape)}for(const e in t)r.push(t[e])}}return t}}class Hg{constructor(t){this.occWorkerManager=t}fromBaseLine(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseLine",t)}fromBaseLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseLines",t)}fromBaseSegment(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseSegment",t)}fromBaseSegments(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseSegments",t)}fromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromPoints",t)}fromBasePolyline(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBasePolyline",t)}fromBaseTriangle(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseTriangle",t)}fromBaseMesh(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.fromBaseMesh",t)}createPolygonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolygonWire",t)}createPolygons(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolygons",t)}createLineWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLineWire",t)}createLineWireWithExtensions(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLineWireWithExtensions",t)}createLines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLines",t)}splitOnPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.splitOnPoints",t)}wiresToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.wiresToPoints",t)}createPolylineWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolylineWire",t)}createZigZagBetweenTwoWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createZigZagBetweenTwoWires",t)}createWireFromTwoCirclesTan(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createWireFromTwoCirclesTan",t)}createPolylines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createPolylines",t)}createBezier(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezier",t)}createBezierWeights(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezierWeights",t)}createBezierWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBezierWires",t)}interpolatePoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.interpolatePoints",t)}interpolateWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.interpolateWires",t)}createBSpline(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBSpline",t)}createBSplines(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createBSplines",t)}combineEdgesAndWiresIntoAWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.combineEdgesAndWiresIntoAWire",t)}createWireFromEdge(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createWireFromEdge",t)}addEdgesAndWiresToWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.addEdgesAndWiresToWire",t)}divideWireByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWireByParamsToPoints",t)}divideWiresByParamsToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWiresByParamsToPoints",t)}divideWireByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWireByEqualDistanceToPoints",t)}divideWiresByEqualDistanceToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.divideWiresByEqualDistanceToPoints",t)}pointOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointOnWireAtParam",t)}pointOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointOnWireAtLength",t)}pointsOnWireAtLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtLengths",t)}pointsOnWireAtEqualLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtEqualLength",t)}pointsOnWireAtPatternOfLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.pointsOnWireAtPatternOfLengths",t)}tangentOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.tangentOnWireAtParam",t)}tangentOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.tangentOnWireAtLength",t)}derivativesOnWireAtLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.derivativesOnWireAtLength",t)}derivativesOnWireAtParam(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.derivativesOnWireAtParam",t)}startPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.startPointOnWire",t)}midPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.midPointOnWire",t)}endPointOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.endPointOnWire",t)}createCircleWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createCircleWire",t)}hexagonsInGrid(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.hexagonsInGrid",t)}createSquareWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createSquareWire",t)}createStarWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createStarWire",t)}createChristmasTreeWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createChristmasTreeWire",t)}createNGonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createNGonWire",t)}createParallelogramWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createParallelogramWire",t)}createHeartWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createHeartWire",t)}createRectangleWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createRectangleWire",t)}createLPolygonWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createLPolygonWire",t)}createIBeamProfileWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createIBeamProfileWire",t)}createHBeamProfileWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createHBeamProfileWire",t)}createTBeamProfileWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createTBeamProfileWire",t)}createUBeamProfileWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createUBeamProfileWire",t)}createEllipseWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createEllipseWire",t)}createHelixWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createHelixWire",t)}createHelixWireByTurns(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createHelixWireByTurns",t)}createTaperedHelixWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createTaperedHelixWire",t)}createFlatSpiralWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.createFlatSpiralWire",t)}textWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.textWires",t)}textWiresWithData(t){return e=this,i=void 0,n=function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.textWiresWithData",t),i=Vg.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})},new((r=void 0)||(r=Promise))((function(t,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(o,a)}c((n=n.apply(e,i||[])).next())}));var e,i,r,n}getWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWire",t)}getWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWires",t)}getWireCenterOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWireCenterOfMass",t)}getWiresCentersOfMass(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWiresCentersOfMass",t)}reversedWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.reversedWire",t)}reversedWireFromReversedEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.reversedWireFromReversedEdges",t)}isWireClosed(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.isWireClosed",t)}getWireLength(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWireLength",t)}getWiresLengths(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.getWiresLengths",t)}placeWireOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.placeWireOnFace",t)}placeWiresOnFace(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.placeWiresOnFace",t)}closeOpenWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.closeOpenWire",t)}project(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.project",t)}projectWires(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.wire.projectWires",t)}}class Gg{constructor(t){this.occWorkerManager=t}sewFaces(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shell.sewFaces",t)}getShellSurfaceArea(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shell.getShellSurfaceArea",t)}}class jg{constructor(t){this.occWorkerManager=t}purgeInternalEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.purgeInternalEdges",t)}unifySameDomain(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.unifySameDomain",t)}isClosed(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isClosed",t)}isConvex(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isConvex",t)}isChecked(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isChecked",t)}isFree(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isFree",t)}isInfinite(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isInfinite",t)}isModified(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isModified",t)}isLocked(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isLocked",t)}isNull(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isNull",t)}isEqual(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isEqual",t)}isNotEqual(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isNotEqual",t)}isPartner(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isPartner",t)}isSame(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.isSame",t)}getOrientation(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.getOrientation",t)}getShapeType(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.shape.getShapeType",t)}}class Xg{constructor(t){this.occWorkerManager=t}vertexFromXYZ(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexFromXYZ",t)}vertexFromPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexFromPoint",t)}verticesFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesFromPoints",t)}verticesCompoundFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesCompoundFromPoints",t)}getVertices(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.getVertices",t)}getVerticesAsPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.getVerticesAsPoints",t)}verticesToPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.verticesToPoints",t)}vertexToPoint(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.vertexToPoint",t)}projectPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("shapes.vertex.projectPoints",t)}}class qg{constructor(t){this.vertex=new Xg(t),this.edge=new Wg(t),this.wire=new Hg(t),this.face=new Bg(t),this.shell=new Gg(t),this.solid=new zg(t),this.compound=new Ug(t),this.shape=new jg(t)}}var Yg=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Zg{constructor(t){this.occWorkerManager=t}saveShapeSTEP(t){return Yg(this,void 0,void 0,(function*(){this.saveSTEP(t)}))}saveShapeSTEPAndReturn(t){return Yg(this,void 0,void 0,(function*(){return this.saveSTEP(t)}))}saveShapeStl(t){return Yg(this,void 0,void 0,(function*(){this.saveStl(t)}))}saveShapeStlAndReturn(t){return Yg(this,void 0,void 0,(function*(){return this.saveStl(t)}))}saveSTEP(t){return this.occWorkerManager.genericCallToWorkerPromise("io.saveShapeSTEP",t).then((e=>{if(t.tryDownload&&document){const i=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(i);let n=t.fileName?t.fileName:"bitbybit-dev.step";n.toLowerCase().includes(".step")||(n+=".step");const s=document.createElement("a");s.href=r,s.target="_self",s.download=n,s.click(),s.remove()}return e}))}saveStl(t){return this.occWorkerManager.genericCallToWorkerPromise("io.saveShapeStl",t).then((e=>{if(t.tryDownload&&document){const i=new Blob([e],{type:"application/stl"}),r=URL.createObjectURL(i),n=t.fileName?t.fileName:"bitbybit-dev.stl",s=document.createElement("a");s.href=r,s.target="_self",s.download=n,s.click(),s.remove()}return e}))}shapeToDxfPaths(t){return this.occWorkerManager.genericCallToWorkerPromise("io.shapeToDxfPaths",t)}dxfPathsWithLayer(t){return this.occWorkerManager.genericCallToWorkerPromise("io.dxfPathsWithLayer",t)}dxfCreate(t){return this.occWorkerManager.genericCallToWorkerPromise("io.dxfCreate",t).then((e=>{if(t.tryDownload&&document){const i=new Blob([e],{type:"application/stl"}),r=URL.createObjectURL(i),n=t.fileName?t.fileName:"bitbybit-dev.dxf",s=document.createElement("a");s.href=r,s.target="_self",s.download=n,s.click(),s.remove()}return e}))}}class Jg{constructor(t){this.occWorkerManager=t}transform(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.transform",t)}rotate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotate",t)}rotateAroundCenter(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateAroundCenter",t)}align(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.align",t)}alignNormAndAxis(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignNormAndAxis",t)}alignAndTranslate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignAndTranslate",t)}translate(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.translate",t)}scale(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale",t)}scale3d(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale3d",t)}mirror(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirror",t)}mirrorAlongNormal(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorAlongNormal",t)}transformShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.transformShapes",t)}rotateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateShapes",t)}rotateAroundCenterShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.rotateAroundCenterShapes",t)}alignShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignShapes",t)}alignAndTranslateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.alignAndTranslateShapes",t)}translateShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.translateShapes",t)}scaleShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scaleShapes",t)}scale3dShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.scale3dShapes",t)}mirrorShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorShapes",t)}mirrorAlongNormalShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("transforms.mirrorAlongNormalShapes",t)}}class Kg{constructor(t){this.occWorkerManager=t}loft(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.loft",t)}loftAdvanced(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.loftAdvanced",t)}closestPointsBetweenTwoShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsBetweenTwoShapes",t)}closestPointsOnShapeFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsOnShapeFromPoints",t)}closestPointsOnShapesFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.closestPointsOnShapesFromPoints",t)}distancesToShapeFromPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.distancesToShapeFromPoints",t)}boundingBoxOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxOfShape",t)}boundingBoxMinOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxMinOfShape",t)}boundingBoxMaxOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxMaxOfShape",t)}boundingBoxCenterOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxCenterOfShape",t)}boundingBoxSizeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxSizeOfShape",t)}boundingBoxShapeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingBoxShapeOfShape",t)}boundingSphereOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereOfShape",t)}boundingSphereCenterOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereCenterOfShape",t)}boundingSphereRadiusOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereRadiusOfShape",t)}boundingSphereShapeOfShape(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.boundingSphereShapeOfShape",t)}extrude(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.extrude",t)}extrudeShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.extrudeShapes",t)}splitShapeWithShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.splitShapeWithShapes",t)}revolve(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.revolve",t)}rotatedExtrude(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.rotatedExtrude",t)}pipe(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipe",t)}pipePolylineWireNGon(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipePolylineWireNGon",t)}pipeWiresCylindrical(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipeWiresCylindrical",t)}pipeWireCylindrical(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.pipeWireCylindrical",t)}offset(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offset",t)}offsetAdv(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offsetAdv",t)}makeThickSolidSimple(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.makeThickSolidSimple",t)}makeThickSolidByJoin(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.makeThickSolidByJoin",t)}slice(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.slice",t)}sliceInStepPattern(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.sliceInStepPattern",t)}offset3DWire(t){return this.occWorkerManager.genericCallToWorkerPromise("operations.offset3DWire",t)}}class $g{constructor(t){this.occWorkerManager=t}union(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.union",t)}difference(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.difference",t)}intersection(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.intersection",t)}meshMeshIntersectionWires(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionWires",t)}meshMeshIntersectionPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionPoints",t)}meshMeshIntersectionOfShapesWires(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionOfShapesWires",t)}meshMeshIntersectionOfShapesPoints(t){return this.occWorkerManager.genericCallToWorkerPromise("booleans.meshMeshIntersectionOfShapesPoints",t)}}class Qg{constructor(t){this.occWorkerManager=t}geom2dEllipse(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dEllipse",t)}geom2dTrimmedCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dTrimmedCurve",t)}geom2dSegment(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geom2dSegment",t)}get2dPointFrom2dCurveOnParam(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.get2dPointFrom2dCurveOnParam",t)}geomCircleCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geomCircleCurve",t)}geomEllipseCurve(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.curves.geomEllipseCurve",t)}}class tv{constructor(t){this.occWorkerManager=t}cylindricalSurface(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.surfaces.cylindricalSurface",t)}surfaceFromFace(t){return this.occWorkerManager.genericCallToWorkerPromise("geom.surfaces.surfaceFromFace",t)}}class ev{constructor(t){this.curves=new Qg(t),this.surfaces=new tv(t)}}class iv{constructor(t){this.occWorkerManager=t}filletEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdges",t)}filletEdgesList(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesList",t)}filletEdgesListOneRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesListOneRadius",t)}filletEdgeVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgeVariableRadius",t)}filletEdgesSameVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesSameVariableRadius",t)}filletEdgesVariableRadius(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletEdgesVariableRadius",t)}fillet3DWire(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet3DWire",t)}fillet3DWires(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet3DWires",t)}chamferEdges(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdges",t)}chamferEdgesList(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesList",t)}chamferEdgeTwoDistances(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgeTwoDistances",t)}chamferEdgesTwoDistances(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesTwoDistances",t)}chamferEdgesTwoDistancesLists(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesTwoDistancesLists",t)}chamferEdgeDistAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgeDistAngle",t)}chamferEdgesDistAngle(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesDistAngle",t)}chamferEdgesDistsAngles(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.chamferEdgesDistsAngles",t)}fillet2d(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet2d",t)}fillet2dShapes(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.fillet2dShapes",t)}filletTwoEdgesInPlaneIntoAWire(t){return this.occWorkerManager.genericCallToWorkerPromise("fillets.filletTwoEdgesInPlaneIntoAWire",t)}}class rv{constructor(t){this.occWorkerManager=t}basicShapeRepair(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.basicShapeRepair",t)}fixSmallEdgeOnWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.fixSmallEdgeOnWire",t)}fixEdgeOrientationsAlongWire(t){return this.occWorkerManager.genericCallToWorkerPromise("shapeFix.fixEdgeOrientationsAlongWire",t)}}class nv{constructor(t){this.occWorkerManager=t}simpleLinearLengthDimension(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.simpleLinearLengthDimension",t)}simpleAngularDimension(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.simpleAngularDimension",t)}pinWithLabel(t){return this.occWorkerManager.genericCallToWorkerPromise("dimensions.pinWithLabel",t)}}var sv=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class ov{constructor(t){this.occWorkerManager=t,this.shapes=new qg(t),this.geom=new ev(t),this.transforms=new Jg(t),this.operations=new Kg(t),this.booleans=new $g(t),this.fillets=new iv(t),this.shapeFix=new rv(t),this.dimensions=new nv(t),this.io=new Zg(t)}shapeFacesToPolygonPoints(t){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapeFacesToPolygonPoints",t)}))}shapeToMesh(t){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapeToMesh",t)}))}shapesToMeshes(t){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("shapesToMeshes",t)}))}deleteShape(t){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("deleteShape",t)}))}deleteShapes(t){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("deleteShapes",t)}))}cleanAllCache(){return sv(this,void 0,void 0,(function*(){return yield this.occWorkerManager.genericCallToWorkerPromise("cleanAllCache",{})}))}}var av=function(t,e){return av=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},av(t,e)};function cv(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}av(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function lv(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function hv(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o}function uv(t,e,i){if(i||2===arguments.length)for(var r,n=0,s=e.length;n<s;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}function dv(t){return"function"==typeof t}function pv(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var fv=pv((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function mv(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var gv=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,i,r,n;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=lv(s),a=o.next();!a.done;a=o.next())a.value.remove(this)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(dv(c))try{c()}catch(t){n=t instanceof fv?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var h=lv(l),u=h.next();!u.done;u=h.next()){var d=u.value;try{yv(d)}catch(t){n=null!=n?n:[],t instanceof fv?n=uv(uv([],hv(n)),hv(t.errors)):n.push(t)}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(n)throw new fv(n)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)yv(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&mv(e,t)},t.prototype.remove=function(e){var i=this._finalizers;i&&mv(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),vv=gv.EMPTY;function _v(t){return t instanceof gv||t&&"closed"in t&&dv(t.remove)&&dv(t.add)&&dv(t.unsubscribe)}function yv(t){dv(t)?t():t.unsubscribe()}var xv=null,bv=null,Mv=void 0,Sv=!1,wv=!1,Tv={setTimeout:function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=Tv.delegate;return(null==n?void 0:n.setTimeout)?n.setTimeout.apply(n,uv([t,e],hv(i))):setTimeout.apply(void 0,uv([t,e],hv(i)))},clearTimeout:function(t){var e=Tv.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Cv(){}var Ev=Pv("C",void 0,void 0);function Pv(t,e,i){return{kind:t,value:e,error:i}}var Av=null;function Dv(t){if(Sv){var e=!Av;if(e&&(Av={errorThrown:!1,error:null}),t(),e){var i=Av,r=i.errorThrown,n=i.error;if(Av=null,r)throw n}}else t()}var kv=function(t){function e(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,_v(e)&&e.add(i)):i.destination=Uv,i}return cv(e,t),e.create=function(t,e,i){return new Lv(t,e,i)},e.prototype.next=function(t){this.isStopped?Fv(function(t){return Pv("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Fv(function(t){return Pv("E",void 0,t)}(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Fv(Ev,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(gv),Rv=Function.prototype.bind;function Iv(t,e){return Rv.call(t,e)}var Ov=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){Nv(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){Nv(t)}else Nv(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){Nv(t)}},t}(),Lv=function(t){function e(e,i,r){var n,s,o=t.call(this)||this;return dv(e)||!e?n={next:null!=e?e:void 0,error:null!=i?i:void 0,complete:null!=r?r:void 0}:o&&wv?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},n={next:e.next&&Iv(e.next,s),error:e.error&&Iv(e.error,s),complete:e.complete&&Iv(e.complete,s)}):n=e,o.destination=new Ov(n),o}return cv(e,t),e}(kv);function Nv(t){var e;Sv?(e=t,Sv&&Av&&(Av.errorThrown=!0,Av.error=e)):function(t){Tv.setTimeout((function(){if(!xv)throw t;xv(t)}))}(t)}function Fv(t,e){var i=bv;i&&Tv.setTimeout((function(){return i(t,e)}))}var Uv={closed:!0,next:Cv,error:function(t){throw t},complete:Cv},Wv="function"==typeof Symbol&&Symbol.observable||"@@observable";function Bv(t){return t}var zv=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var r,n=this,s=(r=t)&&r instanceof kv||function(t){return t&&dv(t.next)&&dv(t.error)&&dv(t.complete)}(r)&&_v(r)?t:new Lv(t,e,i);return Dv((function(){var t=n,e=t.operator,i=t.source;s.add(e?e.call(s,i):i?n._subscribe(s):n._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=Vv(e))((function(e,r){var n=new Lv({next:function(e){try{t(e)}catch(t){r(t),n.unsubscribe()}},error:r,complete:e});i.subscribe(n)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Wv]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(i=t).length?Bv:1===i.length?i[0]:function(t){return i.reduce((function(t,e){return e(t)}),t)})(this);var i},t.prototype.toPromise=function(t){var e=this;return new(t=Vv(t))((function(t,i){var r;e.subscribe((function(t){return r=t}),(function(t){return i(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function Vv(t){var e;return null!==(e=null!=t?t:Mv)&&void 0!==e?e:Promise}var Hv,Gv,jv,Xv,qv,Yv,Zv,Jv,Kv,$v,Qv,t_,e_,i_,r_,n_,s_,o_,a_,c_,l_,h_,u_=pv((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),d_=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return cv(e,t),e.prototype.lift=function(t){var e=new p_(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new u_},e.prototype.next=function(t){var e=this;Dv((function(){var i,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var n=lv(e.currentObservers),s=n.next();!s.done;s=n.next())s.value.next(t)}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}}}))},e.prototype.error=function(t){var e=this;Dv((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}}))},e.prototype.complete=function(){var t=this;Dv((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,i=this,r=i.hasError,n=i.isStopped,s=i.observers;return r||n?vv:(this.currentObservers=null,s.push(t),new gv((function(){e.currentObservers=null,mv(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,r=e.thrownError,n=e.isStopped;i?t.error(r):n&&t.complete()},e.prototype.asObservable=function(){var t=new zv;return t.source=this,t},e.create=function(t,e){return new p_(t,e)},e}(zv),p_=function(t){function e(e,i){var r=t.call(this)||this;return r.destination=e,r.source=i,r}return cv(e,t),e.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},e.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:vv},e}(d_);(n_=Hv||(Hv={})).loading="loading",n_.loaded="loaded",n_.initialised="initialised",n_.computing="computing";class f_{constructor(){this.occWorkerState$=new d_,this.promisesMade=[]}occWorkerAlreadyInitialised(){return!!this.occWorker}setOccWorker(t){this.occWorker=t,this.occWorker.onmessage=({data:t})=>{if("occ-initialised"===t)this.occWorkerState$.next({state:Hv.initialised});else if("busy"===t)this.occWorkerState$.next({state:Hv.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&void 0!==t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.occWorkerState$.next({state:Hv.loaded}):this.occWorkerState$.next({state:Hv.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,r={uid:i},n=new Promise(((t,e)=>{r.resolve=t,r.reject=e}));return r.promise=n,this.promisesMade.push(r),this.occWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),n}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}class m_{constructor(t){this.math=t}hexColor(t){return t.color}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t.color);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:void 0}rgbToHex(t){let e=t.r,i=t.g,r=t.b;return 255!==t.max&&(e=Math.round(this.math.remap({number:e,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255})),i=Math.round(this.math.remap({number:i,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255})),r=Math.round(this.math.remap({number:r,fromLow:t.min,fromHigh:t.max,toLow:0,toHigh:255}))),`#${Number(16777216+65536*e+256*i+r).toString(16).substring(1,7)}`}rgbObjToHex(t){return this.rgbToHex({r:t.rgb.r,g:t.rgb.g,b:t.rgb.b,min:t.min,max:t.max})}hexToRgbMapped(t){const e=this.hexToRgb(t);return{r:this.math.remap({number:e.r,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to}),g:this.math.remap({number:e.g,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to}),b:this.math.remap({number:e.b,fromLow:0,fromHigh:255,toLow:t.from,toHigh:t.to})}}getRedParam(t){return this.hexToRgbMapped(t).r}getGreenParam(t){return this.hexToRgbMapped(t).g}getBlueParam(t){return this.hexToRgbMapped(t).b}rgbToRed(t){return t.rgb.r}rgbToGreen(t){return t.rgb.g}rgbToBlue(t){return t.rgb.b}invert(t){const{r:e,g:i,b:r}=this.hexToRgbMapped({color:t.color,from:0,to:255});if(t.blackAndWhite)return.299*e+.587*i+.114*r>186?"#000000":"#ffffff";const n=255-e,s=255-i,o=255-r;return this.rgbToHex({r:n,g:s,b:o,min:0,max:255})}}!function(t){t.HexDto=class{constructor(t){this.color="#0000ff",void 0!==t&&(this.color=t)}},t.InvertHexDto=class{constructor(t){this.color="#0000ff",this.blackAndWhite=!1,void 0!==t&&(this.color=t)}},t.HexDtoMapped=class{constructor(t,e,i){this.color="#0000ff",this.from=0,this.to=255,void 0!==t&&(this.color=t),void 0!==e&&(this.from=e),void 0!==i&&(this.to=i)}},t.RGBObjectMaxDto=class{constructor(t,e){this.min=0,this.max=255,void 0!==t&&(this.rgb=t),void 0!==e&&(this.max=e)}},t.RGBMinMaxDto=class{constructor(t,e,i,r,n){this.r=255,this.g=255,this.b=255,this.min=0,this.max=255,void 0!==t&&(this.r=t),void 0!==e&&(this.g=e),void 0!==i&&(this.b=i),void 0!==r&&(this.min=r),void 0!==n&&(this.max=n)}},t.RGBObjectDto=class{constructor(t){void 0!==t&&(this.rgb=t)}}}(Gv||(Gv={})),function(t){let e;!function(t){t.first="first",t.last="last"}(e=t.firstLastEnum||(t.firstLastEnum={})),t.ListItemDto=class{constructor(t,e,i){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.index=e),void 0!==i&&(this.clone=i)}},t.SubListDto=class{constructor(t,e,i,r){this.indexStart=0,this.indexEnd=1,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.indexStart=e),void 0!==i&&(this.indexEnd=i),void 0!==r&&(this.clone=r)}},t.ListCloneDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e)}},t.RepeatInPatternDto=class{constructor(t){this.clone=!0,this.lengthLimit=100,void 0!==t&&(this.list=t)}},t.SortDto=class{constructor(t,e,i){this.clone=!0,this.orderAsc=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e),void 0!==i&&(this.orderAsc=i)}},t.SortJsonDto=class{constructor(t,e,i){this.clone=!0,this.orderAsc=!0,this.property="propName",void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e),void 0!==i&&(this.orderAsc=i)}},t.ListDto=class{constructor(t){void 0!==t&&(this.list=t)}},t.GroupListDto=class{constructor(t,e,i){this.nrElements=2,this.keepRemainder=!1,void 0!==t&&(this.list=t),void 0!==e&&(this.nrElements=e),void 0!==i&&(this.keepRemainder=i)}},t.MultiplyItemDto=class{constructor(t,e){void 0!==t&&(this.item=t),void 0!==e&&(this.times=e)}},t.AddItemAtIndexDto=class{constructor(t,e,i,r){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.index=i),void 0!==r&&(this.clone=r)}},t.AddItemAtIndexesDto=class{constructor(t,e,i,r){this.indexes=[0],this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.indexes=i),void 0!==r&&(this.clone=r)}},t.AddItemsAtIndexesDto=class{constructor(t,e,i,r){this.indexes=[0],this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.items=e),void 0!==i&&(this.indexes=i),void 0!==r&&(this.clone=r)}},t.RemoveItemAtIndexDto=class{constructor(t,e,i){this.index=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.index=e),void 0!==i&&(this.clone=i)}},t.RemoveItemsAtIndexesDto=class{constructor(t,e,i){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.indexes=e),void 0!==i&&(this.clone=i)}},t.RemoveNthItemDto=class{constructor(t,e,i,r){this.nth=2,this.offset=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.nth=e),void 0!==i&&(this.offset=i),void 0!==r&&(this.clone=r)}},t.RandomThresholdDto=class{constructor(t,e,i){this.threshold=1,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.threshold=e),void 0!==i&&(this.clone=i)}},t.RemoveDuplicatesDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.clone=e)}},t.RemoveDuplicatesToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,this.clone=!0,void 0!==t&&(this.list=t),void 0!==i&&(this.tolerance=i),void 0!==e&&(this.clone=e)}},t.GetByPatternDto=class{constructor(t,e){this.pattern=[!0,!0,!1],void 0!==t&&(this.list=t),void 0!==e&&(this.pattern=e)}},t.GetNthItemDto=class{constructor(t,e,i,r){this.nth=2,this.offset=0,this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.nth=e),void 0!==i&&(this.offset=i),void 0!==r&&(this.clone=r)}},t.GetLongestListLength=class{constructor(t){void 0!==t&&(this.lists=t)}},t.MergeElementsOfLists=class{constructor(t,e){this.level=0,void 0!==t&&(this.lists=t),void 0!==e&&(this.level=e)}},t.AddItemDto=class{constructor(t,e,i){this.clone=!0,void 0!==t&&(this.list=t),void 0!==e&&(this.item=e),void 0!==i&&(this.clone=i)}},t.AddItemFirstLastDto=class{constructor(t,i,r,n){this.position=e.last,this.clone=!0,void 0!==t&&(this.list=t),void 0!==i&&(this.item=i),void 0!==r&&(this.position=r),void 0!==n&&(this.clone=n)}},t.ConcatenateDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.lists=t),void 0!==e&&(this.clone=e)}},t.IncludesDto=class{constructor(t,e){void 0!==t&&(this.list=t),void 0!==e&&(this.item=e)}},t.InterleaveDto=class{constructor(t,e){this.clone=!0,void 0!==t&&(this.lists=t),void 0!==e&&(this.clone=e)}}}(jv||(jv={})),function(t){let e;!function(t){t.less="<",t.lessOrEqual="<=",t.greater=">",t.greaterOrEqual=">=",t.tripleEqual="===",t.tripleNotEqual="!==",t.equal="==",t.notEqual="!="}(e=t.BooleanOperatorsEnum||(t.BooleanOperatorsEnum={})),t.ComparisonDto=class{constructor(t,e,i){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e),void 0!==i&&(this.operator=i)}},t.BooleanDto=class{constructor(t){this.boolean=!1,void 0!==t&&(this.boolean=t)}},t.BooleanListDto=class{constructor(t){void 0!==t&&(this.booleans=t)}},t.ValueGateDto=class{constructor(t,e){this.boolean=!1,void 0!==t&&(this.value=t),void 0!==e&&(this.boolean=e)}},t.TwoValueGateDto=class{constructor(t,e){void 0!==t&&(this.value1=t),void 0!==e&&(this.value2=e)}},t.RandomBooleansDto=class{constructor(t){this.length=10,this.trueThreshold=.5,void 0!==t&&(this.length=t)}},t.TwoThresholdRandomGradientDto=class{},t.ThresholdBooleanListDto=class{},t.ThresholdGapsBooleanListDto=class{}}(Xv||(Xv={})),function(t){let e,i,r;!function(t){t.add="add",t.subtract="subtract",t.multiply="multiply",t.divide="divide",t.power="power",t.modulus="modulus"}(e=t.mathTwoNrOperatorEnum||(t.mathTwoNrOperatorEnum={})),function(t){t.absolute="absolute",t.negate="negate",t.ln="ln",t.log10="log10",t.tenPow="tenPow",t.round="round",t.floor="floor",t.ceil="ceil",t.sqrt="sqrt",t.sin="sin",t.cos="cos",t.tan="tan",t.asin="asin",t.acos="acos",t.atan="atan",t.log="log",t.exp="exp",t.radToDeg="radToDeg",t.degToRad="degToRad"}(i=t.mathOneNrOperatorEnum||(t.mathOneNrOperatorEnum={})),function(t){t.easeInSine="easeInSine",t.easeOutSine="easeOutSine",t.easeInOutSine="easeInOutSine",t.easeInQuad="easeInQuad",t.easeOutQuad="easeOutQuad",t.easeInOutQuad="easeInOutQuad",t.easeInCubic="easeInCubic",t.easeOutCubic="easeOutCubic",t.easeInOutCubic="easeInOutCubic",t.easeInQuart="easeInQuart",t.easeOutQuart="easeOutQuart",t.easeInOutQuart="easeInOutQuart",t.easeInQuint="easeInQuint",t.easeOutQuint="easeOutQuint",t.easeInOutQuint="easeInOutQuint",t.easeInExpo="easeInExpo",t.easeOutExpo="easeOutExpo",t.easeInOutExpo="easeInOutExpo",t.easeInCirc="easeInCirc",t.easeOutCirc="easeOutCirc",t.easeInOutCirc="easeInOutCirc",t.easeInElastic="easeInElastic",t.easeOutElastic="easeOutElastic",t.easeInOutElastic="easeInOutElastic",t.easeInBack="easeInBack",t.easeOutBack="easeOutBack",t.easeInOutBack="easeInOutBack",t.easeInBounce="easeInBounce",t.easeOutBounce="easeOutBounce",t.easeInOutBounce="easeInOutBounce"}(r=t.easeEnum||(t.easeEnum={})),t.ModulusDto=class{constructor(t,e){this.number=1,this.modulus=2,void 0!==t&&(this.number=t),void 0!==e&&(this.modulus=e)}},t.NumberDto=class{constructor(t){this.number=1,void 0!==t&&(this.number=t)}},t.EaseDto=class{constructor(t){this.x=.5,this.min=0,this.max=1,void 0!==t&&(this.x=t)}},t.RoundToDecimalsDto=class{constructor(t,e){this.number=1.123456,this.decimalPlaces=2,void 0!==t&&(this.number=t),void 0!==e&&(this.decimalPlaces=e)}},t.ActionOnTwoNumbersDto=class{constructor(t,e,i){this.first=1,this.second=1,void 0!==t&&(this.first=t),void 0!==e&&(this.second=e),void 0!==i&&(this.operation=i)}},t.TwoNumbersDto=class{constructor(t,e){this.first=1,this.second=2,void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},t.ActionOnOneNumberDto=class{constructor(t,e){this.number=1,void 0!==t&&(this.number=t),void 0!==e&&(this.operation=e)}},t.RemapNumberDto=class{constructor(t,e,i,r,n){this.number=.5,this.fromLow=0,this.fromHigh=1,this.toLow=1,this.toHigh=2,void 0!==t&&(this.number=t),void 0!==e&&(this.fromLow=e),void 0!==i&&(this.fromHigh=i),void 0!==r&&(this.toLow=r),void 0!==n&&(this.toHigh=n)}},t.RandomNumberDto=class{constructor(t,e){this.low=0,this.high=1,void 0!==t&&(this.low=t),void 0!==e&&(this.high=e)}},t.RandomNumbersDto=class{constructor(t,e,i){this.low=0,this.high=1,this.count=10,void 0!==t&&(this.low=t),void 0!==e&&(this.high=e),void 0!==i&&(this.count=i)}},t.ToFixedDto=class{constructor(t,e){this.decimalPlaces=2,void 0!==t&&(this.number=t),void 0!==e&&(this.decimalPlaces=e)}},t.ClampDto=class{constructor(t,e,i){this.number=.5,this.min=0,this.max=1,void 0!==t&&(this.number=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},t.LerpDto=class{constructor(t,e,i){this.start=0,this.end=1,this.t=.5,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.t=i)}},t.InverseLerpDto=class{constructor(t,e,i){this.start=0,this.end=1,this.value=.5,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.value=i)}},t.WrapDto=class{constructor(t,e,i){this.number=1.5,this.min=0,this.max=1,void 0!==t&&(this.number=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},t.PingPongDto=class{constructor(t,e){this.t=.5,this.length=1,void 0!==t&&(this.t=t),void 0!==e&&(this.length=e)}},t.MoveTowardsDto=class{constructor(t,e,i){this.current=0,this.target=1,this.maxDelta=.1,void 0!==t&&(this.current=t),void 0!==e&&(this.target=e),void 0!==i&&(this.maxDelta=i)}}}(qv||(qv={})),(h_=Yv||(Yv={})).PointDto=class{constructor(t){void 0!==t&&(this.point=t)}},h_.PointXYZDto=class{constructor(t,e,i){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},h_.PointXYDto=class{constructor(t,e){this.x=0,this.y=0,void 0!==t&&(this.x=t),void 0!==e&&(this.y=e)}},h_.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},h_.TwoPointsDto=class{constructor(t,e){void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e)}},h_.DrawPointDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.size=3,this.colours="#444444",this.updatable=!1,void 0!==t&&(this.point=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.size=i),void 0!==r&&(this.colours=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.pointMesh=s)}},h_.DrawPointsDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.size=.1,this.colours="#444444",this.updatable=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.size=i),void 0!==r&&(this.colours=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.pointsMesh=s)}},h_.TransformPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.transformation=e)}},h_.TransformPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.transformation=e)}},h_.TranslatePointsWithVectorsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.translations=e)}},h_.TranslatePointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.translation=e)}},h_.TranslateXYZPointsDto=class{constructor(t,e,i,r){this.x=0,this.y=1,this.z=0,void 0!==t&&(this.points=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r)}},h_.ScalePointsCenterXYZDto=class{constructor(t,e,i){this.center=[0,0,0],this.scaleXyz=[1,1,1],void 0!==t&&(this.points=t),void 0!==e&&(this.center=e),void 0!==i&&(this.scaleXyz=i)}},h_.StretchPointsDirFromCenterDto=class{constructor(t,e,i,r){this.center=[0,0,0],this.direction=[0,0,1],this.scale=2,void 0!==t&&(this.points=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.scale=r)}},h_.RotatePointsCenterAxisDto=class{constructor(t,e,i,r){this.angle=90,this.axis=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.points=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.axis=i),void 0!==r&&(this.center=r)}},h_.TransformsForPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.transformation=e)}},h_.ThreePointsNormalDto=class{constructor(t,e,i,r){this.reverseNormal=!1,void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.point3=i),void 0!==r&&(this.reverseNormal=r)}},h_.ThreePointsToleranceDto=class{constructor(t,e,i,r){this.tolerance=1e-7,void 0!==t&&(this.start=t),void 0!==e&&(this.center=e),void 0!==i&&(this.end=i),void 0!==r&&(this.tolerance=r)}},h_.PointsMaxFilletsHalfLineDto=class{constructor(t,e,i){this.checkLastWithFirst=!1,this.tolerance=1e-7,void 0!==t&&(this.points=t),void 0!==e&&(this.checkLastWithFirst=e),void 0!==i&&(this.tolerance=i)}},h_.RemoveConsecutiveDuplicatesDto=class{constructor(t,e,i){this.tolerance=1e-7,this.checkFirstAndLast=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.tolerance=e),void 0!==i&&(this.checkFirstAndLast=i)}},h_.ClosestPointFromPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.point=e)}},h_.TwoPointsToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.tolerance=i)}},h_.StartEndPointsDto=class{constructor(t,e){void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoint=e)}},h_.StartEndPointsListDto=class{constructor(t,e){void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoints=e)}},h_.MultiplyPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.amountOfPoints=e)}},h_.SpiralDto=class{constructor(t,e,i,r,n){this.phi=.9,this.numberPoints=200,this.widening=3,this.radius=6,this.factor=1,void 0!==t&&(this.radius=t),void 0!==e&&(this.numberPoints=e),void 0!==i&&(this.widening=i),void 0!==r&&(this.factor=r),void 0!==n&&(this.phi=n)}},h_.HexGridScaledToFitDto=class{constructor(t,e,i,r,n,s){this.width=10,this.height=10,this.nrHexagonsInWidth=10,this.nrHexagonsInHeight=10,this.flatTop=!1,this.extendTop=!1,this.extendBottom=!1,this.extendLeft=!1,this.extendRight=!1,this.centerGrid=!1,this.pointsOnGround=!1,void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.nrHexagonsInHeight=i),void 0!==r&&(this.nrHexagonsInWidth=r),void 0!==n&&(this.centerGrid=n),void 0!==s&&(this.pointsOnGround=s)}},h_.HexGridCentersDto=class{constructor(t,e,i,r,n){this.nrHexagonsY=21,this.nrHexagonsX=21,this.orientOnCenter=!1,this.pointsOnGround=!1,void 0!==t&&(this.nrHexagonsX=t),void 0!==e&&(this.nrHexagonsY=e),void 0!==i&&(this.radiusHexagon=i),void 0!==r&&(this.orientOnCenter=r),void 0!==n&&(this.pointsOnGround=n)}},function(t){t.TextDto=class{constructor(t){this.text="Hello World",void 0!==t&&(this.text=t)}},t.TextSplitDto=class{constructor(t,e){this.text="a,b,c",this.separator=",",void 0!==t&&(this.text=t),void 0!==e&&(this.separator=e)}},t.TextReplaceDto=class{constructor(t,e,i){this.text="a-c",this.search="-",this.replaceWith="b",void 0!==t&&(this.text=t),void 0!==e&&(this.search=e),void 0!==i&&(this.replaceWith=i)}},t.TextJoinDto=class{constructor(t,e){this.separator=",",void 0!==t&&(this.list=t),void 0!==e&&(this.separator=e)}},t.ToStringDto=class{constructor(t){void 0!==t&&(this.item=t)}},t.ToStringEachDto=class{constructor(t){void 0!==t&&(this.list=t)}},t.TextFormatDto=class{constructor(t,e){this.text="Hello {0}",this.values=["World"],void 0!==t&&(this.text=t),void 0!==e&&(this.values=e)}},t.TextSearchDto=class{constructor(t,e){this.text="hello world",this.search="world",void 0!==t&&(this.text=t),void 0!==e&&(this.search=e)}},t.TextSubstringDto=class{constructor(t,e,i){this.text="hello world",this.start=0,this.end=5,void 0!==t&&(this.text=t),void 0!==e&&(this.start=e),void 0!==i&&(this.end=i)}},t.TextIndexDto=class{constructor(t,e){this.text="hello",this.index=0,void 0!==t&&(this.text=t),void 0!==e&&(this.index=e)}},t.TextPadDto=class{constructor(t,e,i){this.text="x",this.length=3,this.padString="a",void 0!==t&&(this.text=t),void 0!==e&&(this.length=e),void 0!==i&&(this.padString=i)}},t.TextRepeatDto=class{constructor(t,e){this.text="ha",this.count=3,void 0!==t&&(this.text=t),void 0!==e&&(this.count=e)}},t.TextConcatDto=class{constructor(t){this.texts=["hello"," ","world"],void 0!==t&&(this.texts=t)}},t.TextRegexDto=class{constructor(t,e,i){this.text="hello123world",this.pattern="[0-9]+",this.flags="g",void 0!==t&&(this.text=t),void 0!==e&&(this.pattern=e),void 0!==i&&(this.flags=i)}},t.TextRegexReplaceDto=class{constructor(t,e,i,r){this.text="hello123world456",this.pattern="[0-9]+",this.flags="g",this.replaceWith="X",void 0!==t&&(this.text=t),void 0!==e&&(this.pattern=e),void 0!==i&&(this.flags=i),void 0!==r&&(this.replaceWith=r)}},t.VectorCharDto=class{constructor(t,e,i,r,n){this.char="A",this.xOffset=0,this.yOffset=0,this.height=1,this.extrudeOffset=0,void 0!==t&&(this.char=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==r&&(this.height=r),void 0!==n&&(this.extrudeOffset=n)}},t.VectorTextDto=class{constructor(t,e,i,r,n,s,o,a,c){this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=0,this.extrudeOffset=0,this.centerOnOrigin=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==r&&(this.height=r),void 0!==n&&(this.lineSpacing=n),void 0!==s&&(this.letterSpacing=s),void 0!==o&&(this.align=o),void 0!==a&&(this.extrudeOffset=a),void 0!==c&&(this.centerOnOrigin=c)}}}(Zv||(Zv={})),(l_=Jv||(Jv={})).TwoVectorsDto=class{constructor(t,e){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},l_.VectorBoolDto=class{constructor(t){void 0!==t&&(this.vector=t)}},l_.RemoveAllDuplicateVectorsDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.vectors=t),void 0!==e&&(this.tolerance=e)}},l_.RemoveConsecutiveDuplicateVectorsDto=class{constructor(t,e,i){this.checkFirstAndLast=!1,this.tolerance=1e-7,void 0!==t&&(this.vectors=t),void 0!==e&&(this.checkFirstAndLast=e),void 0!==i&&(this.tolerance=i)}},l_.VectorsTheSameDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.vec1=t),void 0!==e&&(this.vec2=e),void 0!==i&&(this.tolerance=i)}},l_.VectorDto=class{constructor(t){void 0!==t&&(this.vector=t)}},l_.VectorStringDto=class{constructor(t){void 0!==t&&(this.vector=t)}},l_.Vector3Dto=class{constructor(t){void 0!==t&&(this.vector=t)}},l_.RangeMaxDto=class{constructor(t){void 0!==t&&(this.max=t)}},l_.VectorXYZDto=class{constructor(t,e,i){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},l_.VectorXYDto=class{constructor(t,e){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e)}},l_.SpanDto=class{constructor(t,e,i){this.step=.1,this.min=0,this.max=1,void 0!==t&&(this.step=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},l_.SpanEaseItemsDto=class{constructor(t,e,i,r){this.nrItems=100,this.min=0,this.max=1,this.ease=qv.easeEnum.easeInSine,this.intervals=!1,void 0!==t&&(this.nrItems=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i),void 0!==r&&(this.ease=r)}},l_.SpanLinearItemsDto=class{constructor(t,e,i){this.nrItems=100,this.min=0,this.max=1,void 0!==t&&(this.nrItems=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},l_.RayPointDto=class{constructor(t,e,i){void 0!==t&&(this.point=t),void 0!==e&&(this.distance=e),void 0!==i&&(this.vector=i)}},l_.VectorsDto=class{constructor(t){void 0!==t&&(this.vectors=t)}},l_.FractionTwoVectorsDto=class{constructor(t,e,i){this.fraction=.5,void 0!==t&&(this.fraction=t),void 0!==e&&(this.first=e),void 0!==i&&(this.second=i)}},l_.VectorScalarDto=class{constructor(t,e){void 0!==t&&(this.scalar=t),void 0!==e&&(this.vector=e)}},l_.TwoVectorsReferenceDto=class{constructor(t,e,i){void 0!==t&&(this.reference=t),void 0!==e&&(this.first=e),void 0!==i&&(this.second=i)}},(c_=Kv||(Kv={})).RotationCenterAxisDto=class{constructor(t,e,i){this.angle=90,this.axis=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.angle=t),void 0!==e&&(this.axis=e),void 0!==i&&(this.center=i)}},c_.RotationCenterDto=class{constructor(t,e){this.angle=90,this.center=[0,0,0],void 0!==t&&(this.angle=t),void 0!==e&&(this.center=e)}},c_.RotationCenterYawPitchRollDto=class{constructor(t,e,i,r){this.yaw=0,this.pitch=0,this.roll=0,this.center=[0,0,0],void 0!==t&&(this.yaw=t),void 0!==e&&(this.pitch=e),void 0!==i&&(this.roll=i),void 0!==r&&(this.center=r)}},c_.ScaleXYZDto=class{constructor(t){this.scaleXyz=[1,1,1],void 0!==t&&(this.scaleXyz=t)}},c_.StretchDirCenterDto=class{constructor(t,e,i){this.center=[0,0,0],this.direction=[0,0,1],this.scale=2,void 0!==t&&(this.scale=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},c_.ScaleCenterXYZDto=class{constructor(t,e){this.center=[0,0,0],this.scaleXyz=[1,1,1],void 0!==t&&(this.center=t),void 0!==e&&(this.scaleXyz=e)}},c_.UniformScaleDto=class{constructor(t){this.scale=1,void 0!==t&&(this.scale=t)}},c_.UniformScaleFromCenterDto=class{constructor(t,e){this.scale=1,this.center=[0,0,0],void 0!==t&&(this.scale=t),void 0!==e&&(this.center=e)}},c_.TranslationXYZDto=class{constructor(t){this.translation=[0,0,0],void 0!==t&&(this.translation=t)}},c_.TranslationsXYZDto=class{constructor(t){void 0!==t&&(this.translations=t)}},function(t){let e,i,r,n;!function(t){t.left="left",t.center="center",t.right="right"}(e=t.horizontalAlignEnum||(t.horizontalAlignEnum={})),function(t){t.top="top",t.middle="middle",t.bottom="bottom"}(i=t.verticalAlignmentEnum||(t.verticalAlignmentEnum={})),function(t){t.top="top",t.bottom="bottom"}(r=t.topBottomEnum||(t.topBottomEnum={})),function(t){t.topLeft="topLeft",t.topMid="topMid",t.topRight="topRight",t.midLeft="midLeft",t.midMid="midMid",t.midRight="midRight",t.bottomLeft="bottomLeft",t.bottomMid="bottomMid",t.bottomRight="bottomRight"}(n=t.basicAlignmentEnum||(t.basicAlignmentEnum={}))}($v||($v={})),function(t){t.DateDto=class{constructor(t){void 0!==t&&(this.date=t)}},t.DateStringDto=class{constructor(t){void 0!==t&&(this.dateString=t)}},t.DateSecondsDto=class{constructor(t,e){this.seconds=30,void 0!==t&&(this.date=t),void 0!==e&&(this.seconds=e)}},t.DateDayDto=class{constructor(t,e){this.day=1,void 0!==t&&(this.date=t),void 0!==e&&(this.day=e)}},t.DateYearDto=class{constructor(t,e){this.year=1,void 0!==t&&(this.date=t),void 0!==e&&(this.year=e)}},t.DateMonthDto=class{constructor(t,e){this.month=1,void 0!==t&&(this.date=t),void 0!==e&&(this.month=e)}},t.DateHoursDto=class{constructor(t,e){this.hours=1,void 0!==t&&(this.date=t),void 0!==e&&(this.hours=e)}},t.DateMinutesDto=class{constructor(t,e){this.minutes=1,void 0!==t&&(this.date=t),void 0!==e&&(this.minutes=e)}},t.DateMillisecondsDto=class{constructor(t,e){this.milliseconds=1,void 0!==t&&(this.date=t),void 0!==e&&(this.milliseconds=e)}},t.DateTimeDto=class{constructor(t,e){this.time=1,void 0!==t&&(this.date=t),void 0!==e&&(this.time=e)}},t.CreateFromUnixTimeStampDto=class{constructor(t){this.unixTimeStamp=1,void 0!==t&&(this.unixTimeStamp=t)}},t.CreateDateDto=class{constructor(t,e,i,r,n,s,o){this.year=1,this.month=1,this.day=1,this.hours=1,this.minutes=1,this.seconds=1,this.milliseconds=1,void 0!==t&&(this.year=t),void 0!==e&&(this.month=e),void 0!==i&&(this.day=i),void 0!==r&&(this.hours=r),void 0!==n&&(this.minutes=n),void 0!==s&&(this.seconds=s),void 0!==o&&(this.milliseconds=o)}}}(Qv||(Qv={})),(a_=t_||(t_={})).LinePointsDto=class{constructor(t,e){void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},a_.LineStartEndPointsDto=class{constructor(t,e){void 0!==t&&(this.startPoints=t),void 0!==e&&(this.endPoints=e)}},a_.DrawLineDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.line=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.lineMesh=s)}},a_.DrawLinesDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.lines=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.linesMesh=s)}},a_.PointsLinesDto=class{constructor(t){void 0!==t&&(this.points=t)}},a_.LineDto=class{constructor(t){void 0!==t&&(this.line=t)}},a_.SegmentDto=class{constructor(t){void 0!==t&&(this.segment=t)}},a_.SegmentsDto=class{constructor(t){void 0!==t&&(this.segments=t)}},a_.LinesDto=class{constructor(t){void 0!==t&&(this.lines=t)}},a_.LineLineIntersectionDto=class{constructor(t,e,i){this.checkSegmentsOnly=!0,void 0!==t&&(this.line1=t),void 0!==e&&(this.line2=e),void 0!==i&&(this.tolerance=i)}},a_.PointOnLineDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.line=t),void 0!==e&&(this.param=e)}},a_.TransformLineDto=class{constructor(t,e){void 0!==t&&(this.line=t),void 0!==e&&(this.transformation=e)}},a_.TransformsLinesDto=class{constructor(t,e){void 0!==t&&(this.lines=t),void 0!==e&&(this.transformation=e)}},a_.TransformLinesDto=class{constructor(t,e){void 0!==t&&(this.lines=t),void 0!==e&&(this.transformation=e)}},(o_=e_||(e_={})).PolylineCreateDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},o_.PolylinePropertiesDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},o_.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},o_.PolylinesDto=class{constructor(t){void 0!==t&&(this.polylines=t)}},o_.TransformPolylineDto=class{constructor(t,e){void 0!==t&&(this.polyline=t),void 0!==e&&(this.transformation=e)}},o_.DrawPolylineDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.polyline=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.polylineMesh=s)}},o_.DrawPolylinesDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.polylines=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.polylinesMesh=s)}},o_.SegmentsToleranceDto=class{constructor(t){this.tolerance=1e-5,void 0!==t&&(this.segments=t)}},o_.PolylineToleranceDto=class{constructor(t,e){this.tolerance=1e-5,void 0!==t&&(this.polyline=t),void 0!==e&&(this.tolerance=e)}},o_.TwoPolylinesToleranceDto=class{constructor(t,e,i){this.tolerance=1e-5,void 0!==t&&(this.polyline1=t),void 0!==e&&(this.polyline2=e),void 0!==i&&(this.tolerance=i)}},(s_=i_||(i_={})).SignedDistanceFromPlaneToPointDto=class{constructor(t,e){void 0!==t&&(this.point=t),void 0!==e&&(this.plane=e)}},s_.TriangleDto=class{constructor(t){void 0!==t&&(this.triangle=t)}},s_.TriangleToleranceDto=class{constructor(t){this.tolerance=1e-7,void 0!==t&&(this.triangle=t)}},s_.TriangleTriangleToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.triangle1=t),void 0!==e&&(this.triangle2=e),void 0!==i&&(this.tolerance=i)}},s_.MeshMeshToleranceDto=class{constructor(t,e,i){this.tolerance=1e-7,void 0!==t&&(this.mesh1=t),void 0!==e&&(this.mesh2=e),void 0!==i&&(this.tolerance=i)}},function(t){t.DxfLineSegmentDto=class{constructor(t,e){void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},t.DxfArcSegmentDto=class{constructor(t,e,i,r){void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.startAngle=i),void 0!==r&&(this.endAngle=r)}},t.DxfCircleSegmentDto=class{constructor(t,e){void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e)}},t.DxfPolylineSegmentDto=class{constructor(t,e,i){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e),void 0!==i&&(this.bulges=i)}},t.DxfSplineSegmentDto=class{constructor(t,e,i){this.degree=3,this.closed=!1,void 0!==t&&(this.controlPoints=t),void 0!==e&&(this.degree=e),void 0!==i&&(this.closed=i)}},t.DxfPathDto=class{constructor(t){void 0!==t&&(this.segments=t)}},t.DxfPathsPartDto=class{constructor(t,e,i){this.layer="Default",this.color="#000000",void 0!==t&&(this.layer=t),void 0!==e&&(this.color=e),void 0!==i&&(this.paths=i)}},t.DxfModelDto=class{constructor(t,e,i){this.colorFormat="aci",this.acadVersion="AC1009",void 0!==t&&(this.dxfPathsParts=t),void 0!==e&&(this.colorFormat=e),void 0!==i&&(this.acadVersion=i)}}}(r_||(r_={}));class g_{getItem(t){if(t.index<0||t.index>=t.list.length)throw new Error("Index out of bounds");let e;return e=t.clone?structuredClone(t.list[t.index]):t.list[t.index],e}getFirstItem(t){if(0===t.list.length)throw new Error("List is empty");let e;return e=t.clone?structuredClone(t.list[0]):t.list[0],e}getLastItem(t){if(0===t.list.length)throw new Error("List is empty");let e;return e=t.clone?structuredClone(t.list[t.list.length-1]):t.list[t.list.length-1],e}randomGetThreshold(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let r=0;r<t.list.length;r++)Math.random()<t.threshold&&i.push(e[r]);return i}getSubList(t){let e;return e=t.clone?structuredClone(t.list.slice(t.indexStart,t.indexEnd)):t.list.slice(t.indexStart,t.indexEnd),e}getNthItem(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let r=0;r<e.length;r++)(r+t.offset)%t.nth==0&&i.push(e[r]);return i}getByPattern(t){const{list:e,pattern:i}=t;if(!i||0===i.length)throw new Error("Pattern is empty or does not exist");const r=i.length,n=e.length,s=[];if(r>=n)e.forEach(((t,e)=>{!0===i[e]&&s.push(t)}));else{const t=[],o=Math.ceil(n/r);for(let e=0;e<o;e++)t.push(...i);e.forEach(((e,i)=>{!0===t[i]&&s.push(e)}))}return s}mergeElementsOfLists(t){const e=t.lists,i=t.level,r=[],n=[];e.forEach((t=>{const e=t.flat(i);r.push(e)}));const s=this.getLongestListLength({lists:r});for(let t=0;t<s;t++){const e=[];for(let i=0;i<r.length;i++){const n=r[i][t];void 0!==n&&e.push(n)}e.length>0&&n.push(e)}let o=[];if(i>0)for(let t=0;t<i;t++)t===i-1&&0!==t?o[t-1].push(n):t===i-1?o.push(n):o.push([]);else o=n;return o}getLongestListLength(t){let e=0;return t.lists?(t.lists.forEach((t=>{t.length>e&&(e=t.length)})),e):void 0}reverse(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.reverse()}shuffle(t){let e=t.list;t.clone&&(e=structuredClone(t.list));for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}flipLists(t){if(t.list.length>0){const e=t.list[0].length;let i=!0;if(t.list.forEach((t=>{t.length!==e&&(i=!1)})),i){const i=[];for(let r=0;r<e;r++){const e=[];t.list.forEach((t=>{e.push(t[r])})),i.push(e)}return i}throw new Error("Lists are not of the same length")}throw new Error("List is empty")}groupNth(t){return(t=>{const{nrElements:e,list:i,keepRemainder:r}=t,n=e,s=[];let o=[];return i.forEach(((t,e)=>{o.push(t),(e+1)%n==0&&(s.push(o),o=[]),o.length>0&&r&&e===i.length-1&&s.push(o)})),s})(t)}includes(t){return t.list.includes(t.item)}findIndex(t){return t.list.indexOf(t.item)}getListDepth(t){let e=0,i=!0,r=t.list;for(;i;){let t=!1;for(let e=0;e<r.length;e++)Array.isArray(r[e])&&(t=!0);r=r.flat(),t?e++:(e++,i=!1)}return e}listLength(t){return t.list.length}addItemAtIndex(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.index>=0&&t.index<=e.length&&e.splice(t.index,0,t.item),e}addItemAtIndexes(t){let e=t.list;t.clone&&(e=structuredClone(t.list));let i=[...t.indexes];return i=i.filter((t=>t>=0&&t<=e.length)),i.sort(((t,e)=>t-e)),i.forEach(((i,r)=>{i>=0&&i+r<=e.length&&e.splice(i+r,0,t.item)})),e}addItemsAtIndexes(t){if(t.items.length!==t.indexes.length)throw new Error("Items and indexes must have the same length");for(let e=0;e<t.indexes.length;e++)if(e>0&&t.indexes[e-1]>t.indexes[e])throw new Error("Indexes must be in ascending order");let e=t.list;return t.clone&&(e=structuredClone(t.list)),[...t.indexes].forEach(((i,r)=>{i>=0&&i+r<=e.length&&e.splice(i+r,0,t.items[r])})),e}removeItemAtIndex(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.index>=0&&t.index<=e.length&&e.splice(t.index,1),e}removeFirstItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.length>0&&e.shift(),e}removeLastItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.length>0&&e.pop(),e}removeItemAtIndexFromEnd(t){let e=t.list;if(t.clone&&(e=structuredClone(t.list)),t.index>=0&&t.index<e.length){const i=e.length-1-t.index;e.splice(i,1)}return e}removeItemsAtIndexes(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[...t.indexes];return i.sort(((t,e)=>e-t)),i.forEach((t=>{t>=0&&t<e.length&&e.splice(t,1)})),e}removeAllItems(t){return t.list.length=0,t.list}removeNthItem(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let r=0;r<e.length;r++)(r+t.offset)%t.nth!=0&&i.push(e[r]);return i}randomRemoveThreshold(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];for(let r=0;r<t.list.length;r++)Math.random()>t.threshold&&i.push(e[r]);return i}removeDuplicateNumbers(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.filter(((t,e,i)=>i.indexOf(t)===e))}removeDuplicateNumbersTolerance(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.filter(((e,i,r)=>r.findIndex((i=>Math.abs(i-e)<t.tolerance))===i))}removeDuplicates(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.filter(((t,e,i)=>i.indexOf(t)===e))}addItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.push(t.item),e}prependItem(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),e.unshift(t.item),e}addItemFirstLast(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.position===jv.firstLastEnum.first?e.unshift(t.item):e.push(t.item),e}concatenate(t){let e=[];return t.clone?t.lists.forEach((t=>{e=e.concat(structuredClone(t))})):t.lists.forEach((t=>{e=e.concat(t)})),e}createEmptyList(){return[]}repeat(t){const e=[];for(let i=0;i<t.times;i++)e.push(t.item);return e}repeatInPattern(t){let e=t.list;t.clone&&(e=structuredClone(t.list));const i=[];let r=0,n=0;for(;r<t.lengthLimit;)i.push(e[n]),n++,n===e.length&&(n=0),r++;return i}sortNumber(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort(((t,e)=>t-e)):e.sort(((t,e)=>e-t))}sortTexts(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort():e.sort().reverse()}sortByPropValue(t){let e=t.list;return t.clone&&(e=structuredClone(t.list)),t.orderAsc?e.sort(((e,i)=>e[t.property]-i[t.property])):e.sort(((e,i)=>i[t.property]-e[t.property]))}interleave(t){const e=t.clone?structuredClone(t.lists):t.lists;if(!e||0===e.length)throw new Error("Lists array is empty or does not exist");const i=[],r=Math.max(...e.map((t=>t.length)));for(let t=0;t<r;t++)for(const r of e)t<r.length&&i.push(r[t]);return i}}class v_{boolean(t){return t.boolean}randomBooleans(t){const e=[];for(let i=0;i<t.length;i++)e.push(Math.random()<t.trueThreshold);return e}twoThresholdRandomGradient(t){const e=[];return t.numbers.forEach((i=>{if(i<t.thresholdTotalTrue)e.push(!0);else if(i>t.thresholdTotalFalse)e.push(!1);else{const r=i-t.thresholdTotalTrue,n=(t.thresholdTotalFalse-t.thresholdTotalTrue)/t.nrLevels,s=Math.ceil(r/n)/t.nrLevels;Math.random()>s?e.push(!0):e.push(!1)}})),e}thresholdBooleanList(t){const e=[];return t.numbers.forEach((i=>{i<t.threshold?e.push(!0):e.push(!1)})),t.inverse?e.map((t=>!t)):e}thresholdGapsBooleanList(t){const e=[];return t.numbers.forEach((i=>{let r=!1;t.gapThresholds.forEach((t=>{const n=t[0],s=t[1];i>=n&&i<=s&&(e.push(!0),r=!0)})),r||e.push(!1)})),t.inverse?e.map((t=>!t)):e}not(t){return!t.boolean}notList(t){return t.booleans.map((t=>!t))}compare(t){switch(t.operator){case"==":return t.first==t.second;case"!=":return t.first!=t.second;case"===":return t.first===t.second;case"!==":return t.first!==t.second;case"<":return t.first<t.second;case"<=":return t.first<=t.second;case">":return t.first>t.second;case">=":return t.first>=t.second;default:return!1}}valueGate(t){return t.boolean?t.value:void 0}firstDefinedValueGate(t){let e;return e=void 0!==t.value1?t.value1:void 0!==t.value2?t.value2:void 0,e}}class __{number(t){return t.number}twoNrOperation(t){let e;switch(t.operation){case qv.mathTwoNrOperatorEnum.add:e=t.first+t.second;break;case qv.mathTwoNrOperatorEnum.subtract:e=t.first-t.second;break;case qv.mathTwoNrOperatorEnum.multiply:e=t.first*t.second;break;case qv.mathTwoNrOperatorEnum.divide:e=t.first/t.second;break;case qv.mathTwoNrOperatorEnum.power:e=Math.pow(t.first,t.second);break;case qv.mathTwoNrOperatorEnum.modulus:e=t.first%t.second}return e}modulus(t){return this.twoNrOperation({first:t.number,second:t.modulus,operation:qv.mathTwoNrOperatorEnum.modulus})}roundToDecimals(t){return Math.round(t.number*Math.pow(10,t.decimalPlaces))/Math.pow(10,t.decimalPlaces)}roundAndRemoveTrailingZeros(t){const e=Math.round(t.number*Math.pow(10,t.decimalPlaces))/Math.pow(10,t.decimalPlaces);return parseFloat(e.toFixed(t.decimalPlaces))}oneNrOperation(t){let e;switch(t.operation){case qv.mathOneNrOperatorEnum.absolute:e=Math.abs(t.number);break;case qv.mathOneNrOperatorEnum.negate:e=-t.number;break;case qv.mathOneNrOperatorEnum.ln:e=Math.log(t.number);break;case qv.mathOneNrOperatorEnum.log10:e=Math.log10(t.number);break;case qv.mathOneNrOperatorEnum.tenPow:e=Math.pow(10,t.number);break;case qv.mathOneNrOperatorEnum.round:e=Math.round(t.number);break;case qv.mathOneNrOperatorEnum.floor:e=Math.floor(t.number);break;case qv.mathOneNrOperatorEnum.ceil:e=Math.ceil(t.number);break;case qv.mathOneNrOperatorEnum.sqrt:e=Math.sqrt(t.number);break;case qv.mathOneNrOperatorEnum.sin:e=Math.sin(t.number);break;case qv.mathOneNrOperatorEnum.cos:e=Math.cos(t.number);break;case qv.mathOneNrOperatorEnum.tan:e=Math.tan(t.number);break;case qv.mathOneNrOperatorEnum.asin:e=Math.asin(t.number);break;case qv.mathOneNrOperatorEnum.acos:e=Math.acos(t.number);break;case qv.mathOneNrOperatorEnum.atan:e=Math.atan(t.number);break;case qv.mathOneNrOperatorEnum.log:e=Math.log(t.number);break;case qv.mathOneNrOperatorEnum.exp:e=Math.exp(t.number);break;case qv.mathOneNrOperatorEnum.degToRad:e=t.number*Math.PI/180;break;case qv.mathOneNrOperatorEnum.radToDeg:e=180*t.number/Math.PI}return e}remap(t){return(t.number-t.fromLow)*(t.toHigh-t.toLow)/(t.fromHigh-t.fromLow)+t.toLow}random(){return Math.random()}randomNumber(t){return Math.random()*(t.high-t.low)+t.low}randomNumbers(t){const e=[];for(let i=0;i<t.count;i++)e.push(this.randomNumber(t));return e}pi(){return Math.PI}toFixed(t){return t.number.toFixed(t.decimalPlaces)}add(t){return t.first+t.second}subtract(t){return t.first-t.second}multiply(t){return t.first*t.second}divide(t){return t.first/t.second}power(t){return Math.pow(t.first,t.second)}sqrt(t){return Math.sqrt(t.number)}abs(t){return Math.abs(t.number)}round(t){return Math.round(t.number)}floor(t){return Math.floor(t.number)}ceil(t){return Math.ceil(t.number)}negate(t){return-t.number}ln(t){return Math.log(t.number)}log10(t){return Math.log10(t.number)}tenPow(t){return Math.pow(10,t.number)}sin(t){return Math.sin(t.number)}cos(t){return Math.cos(t.number)}tan(t){return Math.tan(t.number)}asin(t){return Math.asin(t.number)}acos(t){return Math.acos(t.number)}atan(t){return Math.atan(t.number)}exp(t){return Math.exp(t.number)}degToRad(t){return t.number*Math.PI/180}radToDeg(t){return 180*t.number/Math.PI}ease(t){const e=t.x,i=t.min,r=t.max,n=this[t.ease](e);return this.remap({number:n,fromLow:0,fromHigh:1,toLow:i,toHigh:r})}clamp(t){return Math.max(t.min,Math.min(t.max,t.number))}lerp(t){return t.start+(t.end-t.start)*t.t}inverseLerp(t){return t.start===t.end?0:(t.value-t.start)/(t.end-t.start)}smoothstep(t){const e=Math.max(0,Math.min(1,t.number));return e*e*(3-2*e)}sign(t){return Math.sign(t.number)}fract(t){return t.number-Math.floor(t.number)}wrap(t){const e=t.max-t.min;if(0===e)return t.min;const i=(t.number-t.min)%e;return i<0?i+t.max:i+t.min}pingPong(t){const e=Math.abs(t.t)%(2*t.length);return e>t.length?2*t.length-e:e}moveTowards(t){const e=t.target-t.current;return Math.abs(e)<=t.maxDelta?t.target:t.current+Math.sign(e)*t.maxDelta}easeInSine(t){return 1-Math.cos(t*Math.PI/2)}easeOutSine(t){return Math.sin(t*Math.PI/2)}easeInOutSine(t){return-(Math.cos(Math.PI*t)-1)/2}easeInQuad(t){return t*t}easeOutQuad(t){return 1-(1-t)*(1-t)}easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}easeInCubic(t){return t*t*t}easeOutCubic(t){return 1-Math.pow(1-t,3)}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}easeInQuart(t){return t*t*t*t}easeOutQuart(t){return 1-Math.pow(1-t,4)}easeInOutQuart(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2}easeInQuint(t){return t*t*t*t*t}easeOutQuint(t){return 1-Math.pow(1-t,5)}easeInOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}easeInExpo(t){return 0===t?0:Math.pow(2,10*t-10)}easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}easeInOutExpo(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}easeInCirc(t){return 1-Math.sqrt(1-t*t)}easeOutCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}easeInOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}easeInBack(t){return 2.70158*t*t*t-1.70158*t*t}easeOutBack(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}easeInOutBack(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2}easeInElastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)}easeOutElastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}easeInOutElastic(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1}easeInBounce(t){return 1-this.easeOutBounce(1-t)}easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}easeInOutBounce(t){return t<.5?(1-this.easeOutBounce(1-2*t))/2:(1+this.easeOutBounce(2*t-1))/2}}class y_{constructor(t,e,i,r){this.geometryHelper=t,this.transforms=e,this.vector=i,this.lists=r}transformPoint(t){const e=t.transformation;let i=[t.point];return i=this.geometryHelper.transformControlPoints(e,i),i[0]}transformPoints(t){return this.geometryHelper.transformControlPoints(t.transformation,t.points)}transformsForPoints(t){if(t.points.length!==t.transformation.length)throw new Error("You must provide equal nr of points and transformations");return t.points.map(((e,i)=>this.geometryHelper.transformControlPoints(t.transformation[i],[e])[0]))}translatePoints(t){const e=this.transforms.translationXYZ({translation:t.translation});return this.geometryHelper.transformControlPoints(e,t.points)}translatePointsWithVectors(t){if(t.points.length!==t.translations.length)throw new Error("You must provide equal nr of points and translations");const e=this.transforms.translationsXYZ({translations:t.translations});return t.points.map(((t,i)=>this.geometryHelper.transformControlPoints(e[i],[t])[0]))}translateXYZPoints(t){const e=this.transforms.translationXYZ({translation:[t.x,t.y,t.z]});return this.geometryHelper.transformControlPoints(e,t.points)}scalePointsCenterXYZ(t){const e=this.transforms.scaleCenterXYZ({center:t.center,scaleXyz:t.scaleXyz});return this.geometryHelper.transformControlPoints(e,t.points)}stretchPointsDirFromCenter(t){const e=this.transforms.stretchDirFromCenter({center:t.center,scale:t.scale,direction:t.direction});return this.geometryHelper.transformControlPoints(e,t.points)}rotatePointsCenterAxis(t){const e=this.transforms.rotationCenterAxis({center:t.center,axis:t.axis,angle:t.angle});return this.geometryHelper.transformControlPoints(e,t.points)}boundingBoxOfPoints(t){const e=[],i=[],r=[];t.points.forEach((t=>{e.push(t[0]),i.push(t[1]),r.push(t[2])}));const n=[Math.min(...e),Math.min(...i),Math.min(...r)],s=[Math.max(...e),Math.max(...i),Math.max(...r)];return{min:n,max:s,center:[(n[0]+s[0])/2,(n[1]+s[1])/2,(n[2]+s[2])/2],width:s[0]-n[0],height:s[1]-n[1],length:s[2]-n[2]}}closestPointFromPointsDistance(t){return this.closestPointFromPointData(t).distance}closestPointFromPointsIndex(t){return this.closestPointFromPointData(t).index}closestPointFromPoints(t){return this.closestPointFromPointData(t).point}distance(t){const e=t.endPoint[0]-t.startPoint[0],i=t.endPoint[1]-t.startPoint[1],r=t.endPoint[2]-t.startPoint[2];return Math.sqrt(e*e+i*i+r*r)}distancesToPoints(t){return t.endPoints.map((e=>this.distance({startPoint:t.startPoint,endPoint:e})))}multiplyPoint(t){const e=[];for(let i=0;i<t.amountOfPoints;i++)e.push([t.point[0],t.point[1],t.point[2]]);return e}getX(t){return t.point[0]}getY(t){return t.point[1]}getZ(t){return t.point[2]}averagePoint(t){const e=[],i=[],r=[];return t.points.forEach((t=>{e.push(t[0]),i.push(t[1]),r.push(t[2])})),[e.reduce(((t,e)=>t+e),0)/t.points.length,i.reduce(((t,e)=>t+e),0)/t.points.length,r.reduce(((t,e)=>t+e),0)/t.points.length]}pointXYZ(t){return[t.x,t.y,t.z]}pointXY(t){return[t.x,t.y]}spiral(t){const e=t.phi,i=Math.log(e)/(Math.PI/t.widening),r=[],n=t.radius/t.numberPoints;for(let e=0;e<t.radius;e+=n){const n=Math.log(e/t.factor)/i,s=e*Math.cos(n),o=e*Math.sin(n);r.push([s||0,o||0,0])}return r}hexGrid(t){const e=Math.sqrt(Math.pow(t.radiusHexagon,2)-Math.pow(t.radiusHexagon/2,2)),i=[];for(let r=0;r<t.nrHexagonsX;r++){const n=r*e*2;for(let r=0;r<t.nrHexagonsY;r++){const s=(t.radiusHexagon+t.radiusHexagon/2)*r,o=n+(r%2==0?0:e);i.push([o,s,0])}}if(t.orientOnCenter){const t=i[i.length-1][0]/2,e=i[i.length-1][1]/2;i.forEach(((r,n)=>{i[n]=[r[0]-t,r[1]-e,0]}))}return t.pointsOnGround&&i.forEach(((t,e)=>{i[e]=[t[0],0,t[1]]})),i}hexGridScaledToFit(t){var e,i,r,n;let s=t.width,o=t.height,a=t.nrHexagonsInHeight,c=t.nrHexagonsInWidth,l=null!==(e=t.extendTop)&&void 0!==e&&e,h=null!==(i=t.extendBottom)&&void 0!==i&&i,u=null!==(r=t.extendLeft)&&void 0!==r&&r,d=null!==(n=t.extendRight)&&void 0!==n&&n;const{flatTop:p=!1,centerGrid:f=!1,pointsOnGround:m=!1}=t;if(p){const e=s;s=t.height,o=e;const i=c;c=a,a=i;const r=l,n=h;l=u,h=d,u=n,d=r}if(s<=0||o<=0||c<1||a<1)return console.warn("Hex grid dimensions and counts must be positive."),{centers:[],hexagons:[],shortestDistEdge:void 0,longestDistEdge:void 0,maxFilletRadius:void 0};const g=this.hexGrid({radiusHexagon:1,nrHexagonsX:c,nrHexagonsY:a,orientOnCenter:!1,pointsOnGround:!1});if(0===g.length)return{centers:[],hexagons:[],shortestDistEdge:void 0,longestDistEdge:void 0,maxFilletRadius:void 0};const v=g.map((t=>this.getRegularHexagonVertices(t,1)));let _=1/0,y=-1/0,x=1/0,b=-1/0;for(const t of v)for(const e of t)e[0]<_&&(_=e[0]),e[0]>y&&(y=e[0]),e[1]<x&&(x=e[1]),e[1]>b&&(b=e[1]);const M=y-_,S=b-x,w=M>1e-9?s/M:1,T=S>1e-9?o/S:1;let C=g.map((t=>[(t[0]-_)*w,(t[1]-x)*T,0])),E=v.map((t=>t.map((t=>[(t[0]-_)*w,(t[1]-x)*T,0])))),P=1/0,A=-1/0,D=0;if(0!==E.length){const t=E[0];if(D=this.safestPointsMaxFilletHalfLine({points:t,checkLastWithFirst:!0,tolerance:1e-7}),t.forEach(((e,i)=>{const r=t[(i+1)%t.length],n=this.distance({startPoint:e,endPoint:r});n<P&&(P=n),n>A&&(A=n)})),l||h||u||d){const e=t[0],i=t[1],r=e[1]-i[1],n=i[0]-e[0];if(l&&!h){const t={center:[0,0,0],direction:[0,1,0],scale:o/(o-r)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}if(h&&!l){const t={center:[0,o,0],direction:[0,-1,0],scale:o/(o-r)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}if(l&&h){const t={center:[0,o/2,0],direction:[0,1,0],scale:o/(o-2*r)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}if(u&&!d){const t={center:[s,0,0],direction:[1,0,0],scale:s/(s-n)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}if(d&&!u){const t={center:[0,0,0],direction:[1,0,0],scale:s/(s-n)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}if(u&&d){const t={center:[s/2,0,0],direction:[1,0,0],scale:s/(s-2*n)};E=E.map((e=>(t.points=e,this.stretchPointsDirFromCenter(t)))),t.points=C,C=this.stretchPointsDirFromCenter(t)}}}if(p){C=this.rotatePointsCenterAxis({points:C,center:[s/2,o/2,0],axis:[0,0,1],angle:90}),E=E.map((t=>this.rotatePointsCenterAxis({points:t,center:[s/2,o/2,0],axis:[0,0,1],angle:90})));const t=this.vector.sub({first:[o/2,s/2,0],second:[s/2,o/2,0]});C=this.translatePoints({points:C,translation:t}),E=E.map((e=>this.translatePoints({points:e,translation:t})))}if(f){let t=s/2,e=o/2;p&&(t=o/2,e=s/2);for(let i=0;i<C.length;i++)C[i][0]-=t,C[i][1]-=e;for(let i=0;i<E.length;i++)for(let r=0;r<E[i].length;r++)E[i][r][0]-=t,E[i][r][1]-=e}if(m){for(let t=0;t<C.length;t++)C[t]=[C[t][0],0,C[t][1]];for(let t=0;t<E.length;t++)for(let e=0;e<E[t].length;e++)E[t][e]=[E[t][e][0],0,E[t][e][1]]}if(p){const e=this.lists.groupNth({list:E.reverse(),nrElements:t.nrHexagonsInWidth,keepRemainder:!0}),i=this.lists.flipLists({list:e});i.forEach((t=>t.reverse())),E=i.flat();const r=this.lists.groupNth({list:C.reverse(),nrElements:t.nrHexagonsInWidth,keepRemainder:!0}),n=this.lists.flipLists({list:r});n.forEach((t=>t.reverse())),C=n.flat()}return{centers:C,hexagons:E,shortestDistEdge:P,longestDistEdge:A,maxFilletRadius:D}}maxFilletRadius(t){const{start:e,center:i,end:r,tolerance:n=1e-7}=t,s=this.vector.sub({first:e,second:r}),o=this.vector.sub({first:i,second:r}),a=this.vector.length({vector:s}),c=this.vector.length({vector:o});if(a<n||c<n)return 0;const l=this.vector.normalized({vector:s}),h=this.vector.normalized({vector:o});if(!l||!h)return 0;const u=Math.max(-1,Math.min(1,this.vector.dot({first:l,second:h})));if(u>1-n)return 0;if(u<-1+n)return 0;const d=Math.acos(u),p=Math.tan(d/2);return p<n?0:Math.min(a,c)*p}maxFilletRadiusHalfLine(t){const{start:e,center:i,end:r,tolerance:n=1e-7}=t,s=this.vector.sub({first:e,second:r}),o=this.vector.sub({first:i,second:r}),a=this.vector.length({vector:s}),c=this.vector.length({vector:o});if(a<n||c<n)return 0;const l=this.vector.normalized({vector:s}),h=this.vector.normalized({vector:o});if(!l||!h)return 0;const u=Math.max(-1,Math.min(1,this.vector.dot({first:l,second:h})));if(u>1-n||u<-1+n)return 0;const d=Math.acos(u),p=Math.tan(d/2);return p<n?0:Math.min(a/2,c/2)*p}maxFilletsHalfLine(t){const{points:e,checkLastWithFirst:i=!1,tolerance:r=1e-7}=t,n=e.length,s=[];if(n<3)return s;for(let t=1;t<n-1;t++){const i=e[t-1],n=e[t],o={start:i,center:e[t+1],end:n,tolerance:r};s.push(this.maxFilletRadiusHalfLine(o))}if(i&&n>=3){const t=e[n-1],i=e[0],o={start:t,center:e[1],end:i,tolerance:r};s.push(this.maxFilletRadiusHalfLine(o));const a=e[n-2],c=e[n-1],l={start:a,center:e[0],end:c,tolerance:r};s.push(this.maxFilletRadiusHalfLine(l))}return s}safestPointsMaxFilletHalfLine(t){const e=this.maxFilletsHalfLine(t);if(0===e.length)return 0;const i=Math.min(...e);return Math.max(0,i)}removeConsecutiveDuplicates(t){return this.geometryHelper.removeConsecutivePointDuplicates(t.points,t.checkFirstAndLast,t.tolerance)}normalFromThreePoints(t){const e=t.point1,i=t.point2,r=t.point3;if(!e||!i||!r||3!==e.length||3!==i.length||3!==r.length)throw new Error("All points must be arrays of 3 numbers [x, y, z]");const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=r[0]-e[0],c=r[1]-e[1],l=r[2]-e[2];let h=s*l-o*c,u=o*a-n*l,d=n*c-s*a;if(0!==h||0!==u||0!==d)return t.reverseNormal&&(h=-h,u=-u,d=-d),this.vector.normalized({vector:[h,u,d]});console.warn("Points are collinear or coincident; cannot calculate a unique normal.")}closestPointFromPointData(t){let e,i,r=Number.MAX_SAFE_INTEGER;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=this.distance({startPoint:t.point,endPoint:s});o<r&&(r=o,e=n,i=s)}return{index:e+1,distance:r,point:i}}twoPointsAlmostEqual(t){const e=t.point1,i=t.point2;return this.distance({startPoint:e,endPoint:i})<t.tolerance}sortPoints(t){return[...t.points].sort(((t,e)=>t[0]!==e[0]?t[0]-e[0]:t[1]!==e[1]?t[1]-e[1]:t[2]-e[2]))}getRegularHexagonVertices(t,e){const i=[],r=t[0],n=t[1],s=t[2],o=Math.PI/3;for(let t=0;t<6;t++){const a=o*t;i.push([r+e*Math.sin(a),n+e*Math.cos(a),s])}return i}}const x_={xOffset:0,yOffset:0,input:"?",align:"left",font:{height:21,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12],176:[14,7,21,5,20,4,18,4,16,5,14,7,13,9,14,10,16,10,18,9,20,7,21],178:[14,5,17,5,18,6,19,7,20,9,21,10,21,11,20,12,19,12,18,11,17,10,16,6,14,12,14],179:[14,5,21,11,21,8,18,9,18,10,17,11,16,11,15,10,14,8,14,6,15,5,16],181:[19,4,14,4,-7,void 0,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],185:[14,7,19,8,20,10,21,10,14],188:[26,4,19,5,20,7,21,7,14,void 0,6,0,18,21,void 0,16,11,16,7,22,7,void 0,18,11,18,0,void 0,16,0,22,0],189:[26,4,19,5,20,7,21,7,14,void 0,6,0,18,21,void 0,15,4,15,5,16,6,17,7,19,7,20,6,20,5,19,4,17,2,15,0,21,0],190:[26,4,21,10,21,8,18,9,18,10,17,11,16,11,15,10,14,8,14,6,15,5,16,void 0,6,0,18,21,void 0,16,11,16,7,22,7,void 0,18,11,18,0,void 0,16,0,22,0],215:[18,3,15,15,3,void 0,15,15,3,3],247:[22,4,9,18,9,void 0,11,15,10,14,11,13,12,14,11,15,void 0,11,5,10,4,11,3,12,4,11,5],177:[26,13,18,13,6,void 0,4,12,22,12,void 0,4,3,22,3],8304:[14,8,21,7,20,6,19,5,17,5,15,6,14,8,14,9,14,11,15,12,17,12,19,11,20,9,21,8,21],8308:[14,10,21,6,17,12,17,void 0,10,21,10,14],8309:[14,11,21,6,21,5,17,6,17,7,18,9,18,10,17,11,16,11,15,10,14,8,14,6,15,5,16],8310:[14,11,19,10,20,9,21,7,21,6,20,5,18,5,15,6,14,8,14,9,14,10,15,11,16,11,17,10,18,9,18,8,17,7,16,6,15],8311:[14,11,21,7,14,void 0,5,21,11,21],8312:[14,8,21,7,20,6,19,6,18,7,17,8,17,9,18,10,19,10,20,9,21,8,21,7,20,void 0,8,17,7,16,6,15,6,14,7,13,8,13,9,14,10,15,10,16,9,17],8313:[14,10,17,9,16,8,16,7,17,6,18,6,19,7,20,8,20,9,19,10,18,10,15,9,14,7,14,6,15,5,16],8320:[14,8,7,7,6,6,5,5,3,5,1,6,0,8,0,9,0,11,1,12,3,12,5,11,6,9,7,8,7],8321:[14,7,5,8,6,10,7,10,0],8322:[14,5,4,5,5,6,6,7,7,9,7,10,6,11,5,11,4,10,3,9,2,6,0,12,0],8323:[14,5,7,11,7,8,4,10,4,11,3,12,2,12,1,11,0,9,0,7,1,6,2,5,3],8324:[14,10,7,6,3,12,3,void 0,10,7,10,0],8776:[24,3,11,4,13,6,14,8,14,10,13,14,10,16,9,18,9,20,10,21,12,void 0,3,5,4,7,6,8,8,8,10,7,14,4,16,3,18,3,20,4,21,6],8730:[20,4,12,6,8,8,0,void 0,8,0,10,21,void 0,10,21,20,21],8731:[24,2,21,5,21,4,19,5,18,6,17,6,16,5,15,3,15,2,16,void 0,8,12,10,8,12,0,void 0,12,0,14,21,void 0,14,21,24,21],8732:[24,5,21,3,18,6,18,void 0,5,21,5,15,void 0,8,12,10,8,12,0,void 0,12,0,14,21,void 0,14,21,24,21],8960:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,6,3,16,18]},height:21,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0};class b_{constructor(t){this.point=t}create(t){return t.text}split(t){return t.text.split(t.separator)}replaceAll(t){return t.text.split(t.search).join(t.replaceWith)}join(t){return t.list.join(t.separator)}toString(t){return t.item.toString()}toStringEach(t){return t.list.map((t=>t.toString()))}format(t){return t.text.replace(/{(\d+)}/g,((e,i)=>void 0!==t.values[i]?t.values[i]:e))}includes(t){return t.text.includes(t.search)}startsWith(t){return t.text.startsWith(t.search)}endsWith(t){return t.text.endsWith(t.search)}indexOf(t){return t.text.indexOf(t.search)}lastIndexOf(t){return t.text.lastIndexOf(t.search)}substring(t){return t.text.substring(t.start,t.end)}slice(t){return t.text.slice(t.start,t.end)}charAt(t){return t.text.charAt(t.index)}trim(t){return t.text.trim()}trimStart(t){return t.text.trimStart()}trimEnd(t){return t.text.trimEnd()}padStart(t){return t.text.padStart(t.length,t.padString)}padEnd(t){return t.text.padEnd(t.length,t.padString)}toUpperCase(t){return t.text.toUpperCase()}toLowerCase(t){return t.text.toLowerCase()}toUpperCaseFirst(t){return t.text?t.text.charAt(0).toUpperCase()+t.text.slice(1):t.text}toLowerCaseFirst(t){return t.text?t.text.charAt(0).toLowerCase()+t.text.slice(1):t.text}repeat(t){return t.text.repeat(t.count)}reverse(t){return t.text.split("").reverse().join("")}length(t){return t.text.length}isEmpty(t){return!t.text||0===t.text.trim().length}concat(t){return t.texts.join("")}regexTest(t){return new RegExp(t.pattern,t.flags).test(t.text)}regexMatch(t){const e=new RegExp(t.pattern,t.flags),i=t.text.match(e);return i?Array.from(i):null}regexReplace(t){const e=new RegExp(t.pattern,t.flags);return t.text.replace(e,t.replaceWith)}regexSearch(t){const e=new RegExp(t.pattern,t.flags);return t.text.search(e)}regexSplit(t){const e=new RegExp(t.pattern,t.flags);return t.text.split(e)}vectorChar(t){const{xOffset:e,yOffset:i,font:r,input:n,height:s,extrudeOffset:o}=this.vectorParamsChar(t);let a=n.charCodeAt(0);a&&r[a]||(a=63);const c=[].concat(r[a]),l=(s-o)/r.height,h=o/2,u=c.shift()*l,d=[];let p=[];for(let t=0,r=c.length;t<r;t+=2){const r=l*c[t]+e,n=l*c[t+1]+i+h;void 0===c[t]?(d.push(p),p=[],t--):p.push([r,0,n])}return p.length&&d.push(p),{width:u,height:s,paths:d}}vectorText(t){const{xOffset:e,yOffset:i,height:r,align:n,extrudeOffset:s,lineSpacing:o,letterSpacing:a}=Object.assign({},x_,t),c=t.text;if("string"!=typeof c)throw new Error("text must be a string");const l=r*a;let h=0,u={width:0,height:0,chars:[]},d=[];const p=()=>{h=Math.max(h,u.width),u.chars.length&&d.push(u),u={width:0,height:0,chars:[]}};let f,m=e,g=i;const v=c.length;for(let t=0;t<v;t++){const i=c[t];if("\n"===i){p(),m=e,g-=r*o;continue}f=this.vectorChar({xOffset:m,yOffset:g,height:r,extrudeOffset:s,char:i});const n=f.width+l;m+=n,u.width+=n,u.height=Math.max(u.height,f.height)," "!==i&&(u.chars=u.chars.concat(f))}if(u.chars.length&&p(),d=d.map((t=>{const e=h-t.width;return n===$v.horizontalAlignEnum.right?this.translateLine({x:e},t):n===$v.horizontalAlignEnum.center?this.translateLine({x:e/2},t):t})),t.centerOnOrigin){const t=[];d.forEach((e=>{e.chars.forEach((e=>{e.paths.forEach((e=>{t.push(...e)}))}))}));const e=this.point.boundingBoxOfPoints({points:t});d.forEach((t=>{t.chars.forEach((t=>(t.paths=t.paths.map((t=>this.point.translatePoints({points:t,translation:[-e.center[0],-e.center[1],-e.center[2]]}))),t)))}))}return d}vectorParamsChar(t){const e=Object.assign({},x_,t);return e.input=t.char||e.char,e}translateLine(t,e){const{x:i,y:r}=Object.assign({x:0,y:0},t);return e.chars=e.chars.map((t=>(t.paths=t.paths.map((t=>this.point.translatePoints({points:t,translation:[i,0,r]}))),t))),e}}class M_{toDateString(t){return t.date.toDateString()}toISOString(t){return t.date.toISOString()}toJSON(t){return t.date.toJSON()}toString(t){return t.date.toString()}toTimeString(t){return t.date.toTimeString()}toUTCString(t){return t.date.toUTCString()}now(){return new Date(Date.now())}createDate(t){return new Date(t.year,t.month,t.day,t.hours,t.minutes,t.seconds,t.milliseconds)}createDateUTC(t){return new Date(Date.UTC(t.year,t.month,t.day,t.hours,t.minutes,t.seconds,t.milliseconds))}createFromUnixTimeStamp(t){return new Date(t.unixTimeStamp)}parseDate(t){return Date.parse(t.dateString)}getDayOfMonth(t){return t.date.getDate()}getWeekday(t){return t.date.getDay()}getYear(t){return t.date.getFullYear()}getMonth(t){return t.date.getMonth()}getHours(t){return t.date.getHours()}getMinutes(t){return t.date.getMinutes()}getSeconds(t){return t.date.getSeconds()}getMilliseconds(t){return t.date.getMilliseconds()}getTime(t){return t.date.getTime()}getUTCYear(t){return t.date.getUTCFullYear()}getUTCMonth(t){return t.date.getUTCMonth()}getUTCDay(t){return t.date.getUTCDate()}getUTCHours(t){return t.date.getUTCHours()}getUTCMinutes(t){return t.date.getUTCMinutes()}getUTCSeconds(t){return t.date.getUTCSeconds()}getUTCMilliseconds(t){return t.date.getUTCMilliseconds()}setYear(t){const e=new Date(t.date.getTime());return e.setFullYear(t.year),e}setMonth(t){const e=new Date(t.date.getTime());return e.setMonth(t.month),e}setDayOfMonth(t){const e=new Date(t.date.getTime());return e.setDate(t.day),e}setHours(t){const e=new Date(t.date.getTime());return e.setHours(t.hours),e}setMinutes(t){const e=new Date(t.date.getTime());return e.setMinutes(t.minutes),e}setSeconds(t){const e=new Date(t.date.getTime());return e.setSeconds(t.seconds),e}setMilliseconds(t){const e=new Date(t.date.getTime());return e.setMilliseconds(t.milliseconds),e}setTime(t){const e=new Date(t.date.getTime());return e.setTime(t.time),e}setUTCYear(t){const e=new Date(t.date.getTime());return e.setUTCFullYear(t.year),e}setUTCMonth(t){const e=new Date(t.date.getTime());return e.setUTCMonth(t.month),e}setUTCDay(t){const e=new Date(t.date.getTime());return e.setUTCDate(t.day),e}setUTCHours(t){const e=new Date(t.date.getTime());return e.setUTCHours(t.hours),e}setUTCMinutes(t){const e=new Date(t.date.getTime());return e.setUTCMinutes(t.minutes),e}setUTCSeconds(t){const e=new Date(t.date.getTime());return e.setUTCSeconds(t.seconds),e}setUTCMilliseconds(t){const e=new Date(t.date.getTime());return e.setUTCMilliseconds(t.milliseconds),e}}class S_{constructor(t,e){this.math=t,this.geometryHelper=e}removeAllDuplicateVectors(t){return this.geometryHelper.removeAllDuplicateVectors(t.vectors,t.tolerance)}removeConsecutiveDuplicateVectors(t){return this.geometryHelper.removeConsecutiveVectorDuplicates(t.vectors,t.checkFirstAndLast,t.tolerance)}vectorsTheSame(t){return this.geometryHelper.vectorsTheSame(t.vec1,t.vec2,t.tolerance)}angleBetween(t){return this.math.radToDeg({number:Math.acos(this.dot({first:t.first,second:t.second})/(this.norm({vector:t.first})*this.norm({vector:t.second})))})}angleBetweenNormalized2d(t){const e=t.first[0]*t.second[1]-t.first[1]*t.second[0];return this.math.radToDeg({number:Math.atan2(e,this.dot({first:t.first,second:t.second}))})}positiveAngleBetween(t){const e=this.signedAngleBetween(t);return e<0?360+e:e}addAll(t){const e=[];for(let i=0;i<t.vectors[0].length;i++){let r=0;for(const e of t.vectors)r+=e[i];e.push(r)}return e}add(t){const e=[];for(let i=0;i<t.first.length;i++)e.push(t.first[i]+t.second[i]);return e}all(t){return t.vector.every((t=>t))}cross(t){const e=[];return e.push(t.first[1]*t.second[2]-t.first[2]*t.second[1]),e.push(t.first[2]*t.second[0]-t.first[0]*t.second[2]),e.push(t.first[0]*t.second[1]-t.first[1]*t.second[0]),e}distSquared(t){let e=0;for(let i=0;i<t.first.length;i++)e+=Math.pow(t.first[i]-t.second[i],2);return e}dist(t){return Math.sqrt(this.distSquared(t))}div(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(t.vector[i]/t.scalar);return e}domain(t){return t.vector[t.vector.length-1]-t.vector[0]}dot(t){let e=0;for(let i=0;i<t.first.length;i++)e+=t.first[i]*t.second[i];return e}finite(t){return t.vector.map((t=>isFinite(t)))}isZero(t){return 0===this.norm({vector:t.vector})}lerp(t){return this.add({first:this.mul({vector:t.first,scalar:t.fraction}),second:this.mul({vector:t.second,scalar:1-t.fraction})})}max(t){return Math.max(...t.vector)}min(t){return Math.min(...t.vector)}mul(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(t.vector[i]*t.scalar);return e}neg(t){const e=[];for(let i=0;i<t.vector.length;i++)e.push(-t.vector[i]);return e}normSquared(t){return this.dot({first:t.vector,second:t.vector})}norm(t){const e=this.normSquared(t);return 0!==e?Math.sqrt(e):e}normalized(t){if(!(this.length({vector:t.vector})<=1e-8))return this.div({scalar:this.norm(t),vector:t.vector})}onRay(t){return this.add({first:t.point,second:this.mul({vector:t.vector,scalar:t.distance})})}vectorXYZ(t){return[t.x,t.y,t.z]}vectorXY(t){return[t.x,t.y]}range(t){const e=[];for(let i=0;i<t.max;i++)e.push(i);return e}signedAngleBetween(t){const e=this.cross({first:t.first,second:t.second}),i=this.norm({vector:t.first})*this.norm({vector:t.second}),r=this.dot({first:t.first,second:t.second}),n=this.norm({vector:e})/i,s=r/i,o=Math.atan2(n,s),a=this.dot({first:t.reference,second:e})>0?o:2*Math.PI-o;return this.math.radToDeg({number:a})}span(t){const e=[];for(let i=t.min;i<=t.max;i+=t.step)e.push(i);return e}spanEaseItems(t){const e=[];for(let i=0;i<t.nrItems;i++){const r=1*i/(t.nrItems-1);e.push(this.math.ease({x:r,ease:t.ease,min:t.min,max:t.max}))}return t.intervals?e.map(((t,e,i)=>0===e?t:t-i[e-1])):e}spanLinearItems(t){const e=[],i=t.max-t.min;for(let r=0;r<t.nrItems;r++){const n=i*r/(t.nrItems-1);e.push(n+t.min)}return e}sub(t){const e=[];for(let i=0;i<t.first.length;i++)e.push(t.first[i]-t.second[i]);return e}sum(t){return t.vector.reduce(((t,e)=>t+e),0)}lengthSq(t){const e=t.vector;return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}length(t){return Math.sqrt(this.lengthSq(t))}parseNumbers(t){return t.vector.map((t=>parseFloat(t)))}}class w_{constructor(t,e){this.vector=t,this.math=e}rotationCenterAxis(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationAxis(t.axis,this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterX(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationX(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterY(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationY(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterZ(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationZ(this.math.degToRad({number:t.angle})),this.translation(t.center[0],t.center[1],t.center[2])]}rotationCenterYawPitchRoll(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.rotationYawPitchRoll(this.math.degToRad({number:t.yaw}),this.math.degToRad({number:t.pitch}),this.math.degToRad({number:t.roll})),this.translation(t.center[0],t.center[1],t.center[2])]}scaleCenterXYZ(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.scaling(t.scaleXyz[0],t.scaleXyz[1],t.scaleXyz[2]),this.translation(t.center[0],t.center[1],t.center[2])]}scaleXYZ(t){return[this.scaling(t.scaleXyz[0],t.scaleXyz[1],t.scaleXyz[2])]}stretchDirFromCenter(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.stretchDirection(t.direction,t.scale),this.translation(t.center[0],t.center[1],t.center[2])]}uniformScale(t){return[this.scaling(t.scale,t.scale,t.scale)]}uniformScaleFromCenter(t){return[this.translation(-t.center[0],-t.center[1],-t.center[2]),this.scaling(t.scale,t.scale,t.scale),this.translation(t.center[0],t.center[1],t.center[2])]}translationXYZ(t){return[this.translation(t.translation[0],t.translation[1],t.translation[2])]}translationsXYZ(t){return t.translations.map((t=>[this.translation(t[0],t[1],t[2])]))}identity(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}translation(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}scaling(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}rotationAxis(t,e){const i=Math.sin(-e),r=Math.cos(-e),n=1-r,s=this.vector.normalized({vector:t}),o=s[0],a=s[1],c=s[2],l=this.identity();return l[0]=o*o*n+r,l[1]=o*a*n-c*i,l[2]=o*c*n+a*i,l[3]=0,l[4]=a*o*n+c*i,l[5]=a*a*n+r,l[6]=a*c*n-o*i,l[7]=0,l[8]=c*o*n-a*i,l[9]=c*a*n+o*i,l[10]=c*c*n+r,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}rotationX(t){const e=Math.sin(t),i=Math.cos(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]}rotationY(t){const e=Math.sin(t),i=Math.cos(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]}rotationZ(t){const e=Math.sin(t),i=Math.cos(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]}rotationYawPitchRoll(t,e,i){const r=.5*i,n=.5*e,s=.5*t,o=Math.sin(r),a=Math.cos(r),c=Math.sin(n),l=Math.cos(n),h=Math.sin(s),u=Math.cos(s),d=u*c*a+h*l*o,p=h*l*a-u*c*o,f=u*l*o-h*c*a,m=u*l*a+h*c*o;return this.rotationMatrixFromQuat(d,p,f,m)}rotationMatrixFromQuat(t,e,i,r){const n=t*t,s=e*e,o=i*i,a=t*e,c=i*r,l=i*t,h=e*r,u=e*i,d=t*r,p=this.identity();return p[0]=1-2*(s+o),p[1]=2*(a+c),p[2]=2*(l-h),p[3]=0,p[4]=2*(a-c),p[5]=1-2*(o+n),p[6]=2*(u+d),p[7]=0,p[8]=2*(l+h),p[9]=2*(u-d),p[10]=1-2*(s+n),p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}stretchDirection(t,e){const i=this.vector.normalized({vector:t}),[r,n,s]=i;if(isNaN(r)||0===r&&0===n&&0===s)return console.warn("Stretch direction vector is zero or invalid. Returning identity matrix."),this.identity();const o=e-1;return[1+o*r*r,o*n*r,o*s*r,0,o*r*n,1+o*n*n,o*s*n,0,o*r*s,o*n*s,1+o*s*s,0,0,0,0,1]}}class T_{constructor(){this.getArrayDepth=t=>Array.isArray(t)?1+Math.max(...t.map(this.getArrayDepth)):0}transformControlPoints(t,e){return this.getFlatTransformations(t).forEach((t=>{e=this.transformPointsByMatrixArray(e,t)})),e}getFlatTransformations(t){let e=[];return 3===this.getArrayDepth(t)?t.forEach((t=>{e.push(...t)})):e=t,e}transformPointsByMatrixArray(t,e){return this.transformPointsCoordinates(t,e)}transformPointsCoordinates(t,e){const i=[];for(const r of t){const t=this.transformCoordinates(r[0],r[1],r[2],e);i.push(t)}return i}removeAllDuplicateVectors(t,e=1e-7){const i=[];return t.forEach((t=>{i.some((i=>this.vectorsTheSame(t,i,e)))||i.push(t)})),i}removeConsecutiveVectorDuplicates(t,e=!0,i=1e-7){const r=[];if(t.length>1){for(let e=1;e<t.length;e++){const n=t[e],s=t[e-1];this.vectorsTheSame(n,s,i)||r.push(s),e===t.length-1&&r.push(n)}if(e){const t=r[0],e=r[r.length-1];this.vectorsTheSame(t,e,i)&&r.pop()}}else 1===t.length&&r.push(...t);return r}vectorsTheSame(t,e,i){let r=!1;if(t.length!==e.length)return r;r=!0;for(let n=0;n<t.length;n++)if(!this.approxEq(t[n],e[n],i)){r=!1;break}return r}approxEq(t,e,i){return Math.abs(t-e)<i}removeConsecutivePointDuplicates(t,e=!0,i=1e-7){const r=[];if(t.length>1){for(let e=1;e<t.length;e++){const n=t[e],s=t[e-1];this.arePointsTheSame(n,s,i)||r.push(s),e===t.length-1&&r.push(n)}if(e){const t=r[0],e=r[r.length-1];this.arePointsTheSame(t,e,i)&&r.pop()}}else 1===t.length&&r.push(...t);return r}arePointsTheSame(t,e,i){let r=!1;return 2===t.length&&2===e.length?this.approxEq(t[0],e[0],i)&&this.approxEq(t[1],e[1],i)&&(r=!0):3===t.length&&3===e.length&&this.approxEq(t[0],e[0],i)&&this.approxEq(t[1],e[1],i)&&this.approxEq(t[2],e[2],i)&&(r=!0),r}transformCoordinates(t,e,i,r){const n=r,s=t*n[0]+e*n[4]+i*n[8]+n[12],o=t*n[1]+e*n[5]+i*n[9]+n[13],a=t*n[2]+e*n[6]+i*n[10]+n[14],c=1/(t*n[3]+e*n[7]+i*n[11]+n[15]);return[s*c,o*c,a*c]}}class C_{constructor(t,e,i){this.vector=t,this.point=e,this.geometryHelper=i}getStartPoint(t){return t.line.start}getEndPoint(t){return t.line.end}length(t){return this.point.distance({startPoint:t.line.start,endPoint:t.line.end})}reverse(t){return{start:t.line.end,end:t.line.start}}transformLine(t){const e=t.transformation;let i=[t.line.start,t.line.end];return i=this.geometryHelper.transformControlPoints(e,i),{start:i[0],end:i[1]}}transformsForLines(t){return t.lines.map(((e,i)=>{const r=t.transformation[i];let n=[e.start,e.end];return n=this.geometryHelper.transformControlPoints(r,n),{start:n[0],end:n[1]}}))}create(t){return{start:t.start,end:t.end}}createSegment(t){return[t.start,t.end]}getPointOnLine(t){const e=t.line.start,i=t.line.end,r=t.param,n=[i[0]-e[0],i[1]-e[1],i[2]-e[2]];return[e[0]+r*n[0],e[1]+r*n[1],e[2]+r*n[2]]}linesBetweenPoints(t){const e=[];for(let i=1;i<t.points.length;i++){const r=t.points[i-1],n=t.points[i];e.push({start:r,end:n})}return e}linesBetweenStartAndEndPoints(t){return t.startPoints.map(((e,i)=>({start:e,end:t.endPoints[i]}))).filter((t=>0!==this.point.distance({startPoint:t.start,endPoint:t.end})))}lineToSegment(t){return[t.line.start,t.line.end]}linesToSegments(t){return t.lines.map((t=>[t.start,t.end]))}segmentToLine(t){return{start:t.segment[0],end:t.segment[1]}}segmentsToLines(t){return t.segments.map((t=>({start:t[0],end:t[1]})))}lineLineIntersection(t){const e=t.tolerance||1e-6,i=t.checkSegmentsOnly,r=t.line1,n=t.line2;if(!((null==r?void 0:r.start)&&r.end&&(null==n?void 0:n.start)&&n.end&&3===r.start.length&&3===r.end.length&&3===n.start.length&&3===n.end.length))return void console.error("Invalid line input to lineLineIntersection");const s=r.start,o=this.vector.sub({first:r.end,second:r.start}),a=n.start,c=this.vector.sub({first:n.end,second:n.start}),l=this.vector.sub({first:a,second:s}),h=this.vector.lengthSq({vector:o}),u=this.vector.lengthSq({vector:c});if(h<e*e||u<e*e)return;const d=this.vector.cross({first:o,second:c});if(this.vector.lengthSq({vector:d})<e*e){const t=this.vector.cross({first:l,second:o}),r=e*e*h;if(this.vector.lengthSq({vector:t})<r){if(i){const t=h<e*e?1:h,i=this.vector.dot({first:o,second:l})/t,r=this.vector.sub({first:n.end,second:s}),a=this.vector.dot({first:o,second:r})/t,c=[Math.min(i,a),Math.max(i,a)],u=[0,1];return Math.max(u[0],c[0]),void Math.min(u[1],c[1])}return s}return}const p=this.vector.dot({first:l,second:d}),f=e*e*e;if(Math.abs(p)>f)return;const m=h,g=u,v=this.vector.dot({first:o,second:c}),_=this.vector.dot({first:o,second:l}),y=this.vector.dot({first:c,second:l}),x=m*g-v*v;if(Math.abs(x)<e*e)return void console.error("Internal error: Denominator near zero after non-parallel check.");const b=(g*_-v*y)/x,M=(v*_-m*y)/x;if(i&&(b<-e||b>1+e||M<-e||M>1+e))return;const S=this.getPointOnLine({param:b,line:r});return[Math.abs(S[0])<e?0:S[0],Math.abs(S[1])<e?0:S[1],Math.abs(S[2])<e?0:S[2]]}}class E_{constructor(t,e,i,r){this.vector=t,this.point=e,this.line=i,this.geometryHelper=r}length(t){let e=0;for(let i=1;i<t.polyline.points.length;i++){const r=t.polyline.points[i-1],n=t.polyline.points[i];e+=this.point.distance({startPoint:r,endPoint:n})}return e}countPoints(t){return t.polyline.points.length}getPoints(t){return t.polyline.points}reverse(t){return{points:t.polyline.points.reverse()}}transformPolyline(t){const e=t.transformation;let i=t.polyline.points;return i=this.geometryHelper.transformControlPoints(e,i),{points:i}}create(t){var e;return{points:t.points,isClosed:null!==(e=t.isClosed)&&void 0!==e&&e}}polylineToLines(t){return this.polylineToSegments(t).map((t=>({start:t[0],end:t[1]})))}polylineToSegments(t){const e=t.polyline,i=[],r=e.points,n=r.length;if(n<2)return i;for(let t=0;t<n-1;t++)i.push([r[t],r[t+1]]);return e.isClosed&&n>=2&&(this.point.twoPointsAlmostEqual({point1:r[n-1],point2:r[0],tolerance:1e-9})||i.push([r[n-1],r[0]])),i}polylineSelfIntersection(t){const{polyline:e,tolerance:i}=t,r=this.polylineToLines({polyline:e}),n=r.length;if(n<3)return[];const s=[],o=null!=i?i:1e-6;for(let t=0;t<n;t++)for(let i=t+1;i<n;i++){let a=i===t+1;if(!a&&e.isClosed&&0===t&&i===n-1&&(a=!0),a)continue;const c=this.line.lineLineIntersection({line1:r[t],line2:r[i],checkSegmentsOnly:!0,tolerance:o});if(c){let t=!1;for(const e of s)if(this.point.twoPointsAlmostEqual({point1:c,point2:e,tolerance:o})){t=!0;break}t||s.push(c)}}return s}twoPolylineIntersection(t){const{polyline1:e,polyline2:i,tolerance:r}=t,n=this.polylineToLines({polyline:e}),s=this.polylineToLines({polyline:i}),o=[],a=null!=r?r:1e-6;for(const t of n)for(const e of s){const i=this.line.lineLineIntersection({line1:t,line2:e,checkSegmentsOnly:!0,tolerance:a});if(i){let t=!1;for(const e of o)if(this.point.twoPointsAlmostEqual({point1:i,point2:e,tolerance:a})){t=!0;break}t||o.push(i)}}return o}sortSegmentsIntoPolylines(t){var e;const i=null!==(e=t.tolerance)&&void 0!==e?e:1e-5,r=t.segments;if(!r||0===r.length)return[];const n=i*i,s=r.length,o=new Array(s).fill(!1),a=[],c=new Map,l=1/i,h=t=>`${Math.round(t[0]*l)},${Math.round(t[1]*l)},${Math.round(t[2]*l)}`;for(let t=0;t<s;t++){const e=r[t];if(this.point.twoPointsAlmostEqual({point1:e[0],point2:e[1],tolerance:i})){o[t]=!0;continue}const n=h(e[0]),s=h(e[1]),a={segmentIndex:t,endpointIndex:0,coords:e[0]},l={segmentIndex:t,endpointIndex:1,coords:e[1]};c.has(n)||c.set(n,[]),c.get(n).push(a),s!==n?(c.has(s)||c.set(s,[]),c.get(s).push(l)):c.get(n).push(l)}const u=t=>{const e=[],r=Math.round(t[0]*l),s=Math.round(t[1]*l),a=Math.round(t[2]*l);for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++)for(let n=-1;n<=1;n++)e.push(`${r+t},${s+i},${a+n}`);let h,u=n;for(const r of e){const e=c.get(r);if(e)for(const r of e)if(!o[r.segmentIndex]){const e=this.vector.sub({first:r.coords,second:t}),n=this.vector.lengthSq({vector:e});n<u&&this.point.twoPointsAlmostEqual({point1:r.coords,point2:t,tolerance:i})&&(h=r,u=n)}}if(h&&!o[h.segmentIndex])return h};for(let t=0;t<s;t++){if(o[t])continue;o[t]=!0;const e=r[t],n=[e[0],e[1]];let c=e[0],l=e[1],h=!1,d=0;for(;d++<s;){const t=u(l);if(!t)break;const e=r[t.segmentIndex],s=0===t.endpointIndex?e[1]:e[0];if(this.point.twoPointsAlmostEqual({point1:s,point2:c,tolerance:i})){h=!0,o[t.segmentIndex]=!0;break}o[t.segmentIndex]=!0,n.push(s),l=s}if(d=0,!h)for(;d++<s;){const t=u(c);if(!t)break;const e=r[t.segmentIndex],s=0===t.endpointIndex?e[1]:e[0];if(this.point.twoPointsAlmostEqual({point1:s,point2:l,tolerance:i})){h=!0,o[t.segmentIndex]=!0;break}o[t.segmentIndex]=!0,n.unshift(s),c=s}!h&&n.length>=2&&(h=this.point.twoPointsAlmostEqual({point1:c,point2:l,tolerance:i})),h&&n.length>2&&this.point.twoPointsAlmostEqual({point1:n[n.length-1],point2:n[0],tolerance:i})&&n.pop(),a.push({points:n,isClosed:h})}return a}maxFilletsHalfLine(t){return this.point.maxFilletsHalfLine({points:t.polyline.points,checkLastWithFirst:t.polyline.isClosed,tolerance:t.tolerance})}safestFilletRadius(t){const e=this.maxFilletsHalfLine(t);if(0===e.length)return 0;const i=Math.min(...e);return Math.max(0,i)}}class P_{constructor(t,e){this.vector=t,this.polyline=e}signedDistanceToPlane(t){return this.vector.dot({first:t.plane.normal,second:t.point})-t.plane.d}calculateTrianglePlane(t){const e=Math.pow(t.tolerance||1e-7,2),i=this.vector.sub({first:t.triangle[1],second:t.triangle[0]}),r=this.vector.sub({first:t.triangle[2],second:t.triangle[0]}),n=this.vector.cross({first:i,second:r});if(this.vector.lengthSq({vector:n})<e)return;const s=this.vector.normalized({vector:n});return{normal:s,d:this.vector.dot({first:s,second:t.triangle[0]})}}triangleTriangleIntersection(t){const e=t.triangle1,i=t.triangle2,r=t.tolerance||1e-7,n=e[0],s=e[1],o=e[2],a=i[0],c=i[1],l=i[2],h=this.calculateTrianglePlane({triangle:e,tolerance:r}),u=this.calculateTrianglePlane({triangle:i,tolerance:r});if(!h||!u)return;const d=[this.signedDistanceToPlane({point:a,plane:h}),this.signedDistanceToPlane({point:c,plane:h}),this.signedDistanceToPlane({point:l,plane:h})];if(d[0]>r&&d[1]>r&&d[2]>r||d[0]<-r&&d[1]<-r&&d[2]<-r)return;const p=[this.signedDistanceToPlane({point:n,plane:u}),this.signedDistanceToPlane({point:s,plane:u}),this.signedDistanceToPlane({point:o,plane:u})];if(p[0]>r&&p[1]>r&&p[2]>r||p[0]<-r&&p[1]<-r&&p[2]<-r)return;const f=p.every((t=>Math.abs(t)<r)),m=d.every((t=>Math.abs(t)<r));if(f&&m)return;const g=this.vector.cross({first:h.normal,second:u.normal}),v=this.vector.dot({first:g,second:g});if(v<r*r)return;const _=[],y=[],x=[[n,s],[s,o],[o,n]],b=p;for(let t=0;t<3;++t){const e=x[t][0],i=x[t][1],n=b[t],s=b[(t+1)%3];if(Math.abs(n)<r&&_.push(e),n*s<0&&Math.abs(n-s)>r){const t=n/(n-s);_.push(this.computeIntersectionPoint(e,i,t))}}const M=[[a,c],[c,l],[l,a]],S=d;for(let t=0;t<3;++t){const e=M[t][0],i=M[t][1],n=S[t],s=S[(t+1)%3];if(Math.abs(n)<r&&y.push(e),n*s<0&&Math.abs(n-s)>r){const t=n/(n-s);y.push(this.computeIntersectionPoint(e,i,t))}}if(_.length<2||y.length<2)return;const w=h.normal,T=u.normal,C=h.d,E=u.d,P=this.vector.mul({vector:T,scalar:C}),A=this.vector.mul({vector:w,scalar:E}),D=this.vector.sub({first:P,second:A}),k=this.vector.cross({first:D,second:g}),R=this.vector.mul({vector:k,scalar:1/v}),I=_.map((t=>this.vector.dot({first:this.vector.sub({first:t,second:R}),second:g}))),O=y.map((t=>this.vector.dot({first:this.vector.sub({first:t,second:R}),second:g}))),L=[Math.min(...I),Math.max(...I)],N=[Math.min(...O),Math.max(...O)],F=Math.max(L[0],N[0]),U=Math.min(L[1],N[1]);if(F<U-r*v){const t=this.vector.add({first:R,second:this.vector.mul({vector:g,scalar:F/v})}),e=this.vector.add({first:R,second:this.vector.mul({vector:g,scalar:U/v})}),i=this.vector.sub({first:t,second:e});return this.vector.lengthSq({vector:i})>r*r?[t,e]:void 0}}meshMeshIntersectionSegments(t){const e=t.mesh1,i=t.mesh2,r=[];for(let n=0;n<e.length;++n)for(let s=0;s<i.length;++s){const o=e[n],a=i[s],c=this.triangleTriangleIntersection({triangle1:o,triangle2:a,tolerance:t.tolerance});c&&r.push(c)}return r}meshMeshIntersectionPolylines(t){const e=this.meshMeshIntersectionSegments(t);return this.polyline.sortSegmentsIntoPolylines({segments:e,tolerance:t.tolerance})}meshMeshIntersectionPoints(t){return this.meshMeshIntersectionPolylines(t).map((t=>t.isClosed?[...t.points,t.points[0]]:t.points))}computeIntersectionPoint(t,e,i){return this.vector.add({first:t,second:this.vector.mul({vector:this.vector.sub({first:e,second:t}),scalar:i})})}}class A_{}var D_,k_,R_,I_,O_,L_,N_,F_,U_,W_;A_.BITBYBIT_CDN_URL="https://git-cdn.bitbybit.dev/v1.0.0-rc.0",function(t){let e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b;!function(t){t.arc="arc",t.intersection="intersection",t.tangent="tangent"}(e=t.joinTypeEnum||(t.joinTypeEnum={})),function(t){t.skin="skin",t.pipe="pipe",t.rectoVerso="rectoVerso"}(i=t.bRepOffsetModeEnum||(t.bRepOffsetModeEnum={})),function(t){t.approxChordLength="approxChordLength",t.approxCentripetal="approxCentripetal",t.approxIsoParametric="approxIsoParametric"}(r=t.approxParametrizationTypeEnum||(t.approxParametrizationTypeEnum={})),function(t){t.outside="outside",t.inside="inside",t.middle="middle"}(n=t.directionEnum||(t.directionEnum={})),function(t){t.iges="iges",t.step="step"}(s=t.fileTypeEnum||(t.fileTypeEnum={})),function(t){t.forward="forward",t.reversed="reversed",t.internal="internal",t.external="external"}(o=t.topAbsOrientationEnum||(t.topAbsOrientationEnum={})),function(t){t.in="in",t.out="out",t.on="on",t.unknown="unknown"}(a=t.topAbsStateEnum||(t.topAbsStateEnum={})),function(t){t.unknown="unknown",t.vertex="vertex",t.edge="edge",t.wire="wire",t.face="face",t.shell="shell",t.solid="solid",t.compSolid="compSolid",t.compound="compound",t.shape="shape"}(c=t.shapeTypeEnum||(t.shapeTypeEnum={})),function(t){t.unqualified="unqualified",t.enclosing="enclosing",t.enclosed="enclosed",t.outside="outside",t.noqualifier="noqualifier"}(l=t.gccEntPositionEnum||(t.gccEntPositionEnum={})),function(t){t.keepSide1="keepSide1",t.keepSide2="keepSide2",t.all="all"}(h=t.positionResultEnum||(t.positionResultEnum={})),function(t){t.none="none",t.keepSide1="keepSide1",t.keepSide2="keepSide2"}(u=t.circleInclusionEnum||(t.circleInclusionEnum={})),function(t){t.none="none",t.outside="outside",t.inside="inside",t.outsideInside="outsideInside",t.insideOutside="insideOutside"}(d=t.twoCircleInclusionEnum||(t.twoCircleInclusionEnum={})),function(t){t.outside="outside",t.inside="inside",t.outsideInside="outsideInside",t.insideOutside="insideOutside"}(p=t.fourSidesStrictEnum||(t.fourSidesStrictEnum={})),function(t){t.outside="outside",t.inside="inside"}(f=t.twoSidesStrictEnum||(t.twoSidesStrictEnum={})),function(t){t.allWithAll="allWithAll",t.inOrder="inOrder",t.inOrderClosed="inOrderClosed"}(m=t.combinationCirclesForFaceEnum||(t.combinationCirclesForFaceEnum={})),function(t){t[t.curve=0]="curve",t[t.edge=1]="edge",t[t.wire=2]="wire",t[t.face=3]="face"}(g=t.typeSpecificityEnum||(t.typeSpecificityEnum={})),function(t){t.all="all",t.closest="closest",t.furthest="furthest",t.closestAndFurthest="closestAndFurthest"}(v=t.pointProjectionTypeEnum||(t.pointProjectionTypeEnum={})),function(t){t.isCorrectedFrenet="isCorrectedFrenet",t.isFixed="isFixed",t.isFrenet="isFrenet",t.isConstantNormal="isConstantNormal",t.isDarboux="isDarboux",t.isGuideAC="isGuideAC",t.isGuidePlan="isGuidePlan",t.isGuideACWithContact="isGuideACWithContact",t.isGuidePlanWithContact="isGuidePlanWithContact",t.isDiscreteTrihedron="isDiscreteTrihedron"}(_=t.geomFillTrihedronEnum||(t.geomFillTrihedronEnum={})),function(t){t.aci="aci",t.truecolor="truecolor"}(y=t.dxfColorFormatEnum||(t.dxfColorFormatEnum={})),function(t){t.AC1009="AC1009",t.AC1015="AC1015"}(x=t.dxfAcadVersionEnum||(t.dxfAcadVersionEnum={})),function(t){t.none="none",t.arrow="arrow"}(b=t.dimensionEndTypeEnum||(t.dimensionEndTypeEnum={})),t.DecomposedMeshDto=class{constructor(t,e){void 0!==t&&(this.faceList=t),void 0!==e&&(this.edgeList=e)}},t.DecomposedFaceDto=class{},t.DecomposedEdgeDto=class{},t.ShapesDto=class{constructor(t){void 0!==t&&(this.shapes=t)}},t.PointDto=class{constructor(t){this.point=[0,0,0],void 0!==t&&(this.point=t)}},t.XYZDto=class{constructor(t,e,i){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.z=i)}},t.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.ConstraintTanLinesFromPtToCircleDto=class{constructor(t,e,i,r,n){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainder=u.none,void 0!==t&&(this.circle=t),void 0!==e&&(this.point=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.positionResult=r),void 0!==n&&(this.circleRemainder=n)}},t.ConstraintTanLinesFromTwoPtsToCircleDto=class{constructor(t,e,i,r,n,s){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainder=u.none,void 0!==t&&(this.circle=t),void 0!==e&&(this.point1=e),void 0!==i&&(this.point1=i),void 0!==r&&(this.tolerance=r),void 0!==n&&(this.positionResult=n),void 0!==s&&(this.circleRemainder=s)}},t.ConstraintTanLinesOnTwoCirclesDto=class{constructor(t,e,i,r,n){this.tolerance=1e-7,this.positionResult=h.all,this.circleRemainders=d.none,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.positionResult=r),void 0!==n&&(this.circleRemainders=n)}},t.ConstraintTanCirclesOnTwoCirclesDto=class{constructor(t,e,i,r){this.tolerance=1e-7,this.radius=.3,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.radius=r)}},t.ConstraintTanCirclesOnCircleAndPntDto=class{constructor(t,e,i,r){this.tolerance=1e-7,this.radius=.3,void 0!==t&&(this.circle=t),void 0!==e&&(this.point=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.radius=r)}},t.CurveAndSurfaceDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.surface=e)}},t.FilletTwoEdgesInPlaneDto=class{constructor(t,e,i,r,n,s){this.planeOrigin=[0,0,0],this.planeDirection=[0,1,0],this.radius=.3,this.solution=-1,void 0!==t&&(this.edge1=t),void 0!==e&&(this.edge2=e),void 0!==i&&(this.planeOrigin=i),void 0!==r&&(this.planeDirection=r),void 0!==n&&(this.radius=n),void 0!==s&&(this.solution=s)}},t.ClosestPointsOnShapeFromPointsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e)}},t.BoundingBoxDto=class{constructor(t){void 0!==t&&(this.bbox=t)}},t.BoundingBoxPropsDto=class{constructor(t,e,i,r){this.min=[0,0,0],this.max=[0,0,0],this.center=[0,0,0],this.size=[0,0,0],void 0!==t&&(this.min=t),void 0!==e&&(this.max=e),void 0!==i&&(this.center=i),void 0!==r&&(this.size=r)}},t.BoundingSpherePropsDto=class{constructor(t,e){this.center=[0,0,0],this.radius=0,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e)}},t.SplitWireOnPointsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e)}},t.ClosestPointsOnShapesFromPointsDto=class{constructor(t,e){void 0!==t&&(this.shapes=t),void 0!==e&&(this.points=e)}},t.ClosestPointsBetweenTwoShapesDto=class{constructor(t,e){void 0!==t&&(this.shape1=t),void 0!==e&&(this.shape2=e)}},t.FaceFromSurfaceAndWireDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.surface=t),void 0!==e&&(this.wire=e),void 0!==i&&(this.inside=i)}},t.WireOnFaceDto=class{constructor(t,e){void 0!==t&&(this.wire=t),void 0!==e&&(this.face=e)}},t.DrawShapeDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.edgeWidth=2,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.vertexColour="#ffaaff",this.vertexSize=.03,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.edgeOpacity=i),void 0!==r&&(this.edgeColour=r),void 0!==n&&(this.faceMaterial=n),void 0!==s&&(this.faceColour=s),void 0!==h&&(this.vertexColour=h),void 0!==u&&(this.vertexSize=u),void 0!==o&&(this.edgeWidth=o),void 0!==a&&(this.drawEdges=a),void 0!==c&&(this.drawFaces=c),void 0!==l&&(this.drawVertices=l),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdgeIndexes=p),void 0!==f&&(this.edgeIndexHeight=f),void 0!==m&&(this.edgeIndexColour=m),void 0!==g&&(this.drawFaceIndexes=g),void 0!==v&&(this.faceIndexHeight=v),void 0!==_&&(this.faceIndexColour=_),void 0!==y&&(this.drawTwoSided=y),void 0!==x&&(this.backFaceColour=x),void 0!==b&&(this.backFaceOpacity=b)}},t.DrawShapesDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.edgeWidth=2,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.vertexColour="#ffaaff",this.vertexSize=.03,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.edgeOpacity=i),void 0!==r&&(this.edgeColour=r),void 0!==n&&(this.faceMaterial=n),void 0!==s&&(this.faceColour=s),void 0!==h&&(this.vertexColour=h),void 0!==u&&(this.vertexSize=u),void 0!==o&&(this.edgeWidth=o),void 0!==a&&(this.drawEdges=a),void 0!==c&&(this.drawFaces=c),void 0!==l&&(this.drawVertices=l),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdgeIndexes=p),void 0!==f&&(this.edgeIndexHeight=f),void 0!==m&&(this.edgeIndexColour=m),void 0!==g&&(this.drawFaceIndexes=g),void 0!==v&&(this.faceIndexHeight=v),void 0!==_&&(this.faceIndexColour=_),void 0!==y&&(this.drawTwoSided=y),void 0!==x&&(this.backFaceColour=x),void 0!==b&&(this.backFaceOpacity=b)}},t.FaceSubdivisionDto=class{constructor(t,e,i,r,n,s,o,a,c){this.nrDivisionsU=10,this.nrDivisionsV=10,this.shiftHalfStepU=!1,this.removeStartEdgeU=!1,this.removeEndEdgeU=!1,this.shiftHalfStepV=!1,this.removeStartEdgeV=!1,this.removeEndEdgeV=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisionsU=e),void 0!==i&&(this.nrDivisionsV=i),void 0!==r&&(this.shiftHalfStepU=r),void 0!==n&&(this.removeStartEdgeU=n),void 0!==s&&(this.removeEndEdgeU=s),void 0!==o&&(this.shiftHalfStepV=o),void 0!==a&&(this.removeStartEdgeV=a),void 0!==c&&(this.removeEndEdgeV=c)}},t.FaceSubdivisionToWiresDto=class{constructor(t,e,i,r,n,s){this.nrDivisions=10,this.isU=!0,this.shiftHalfStep=!1,this.removeStart=!1,this.removeEnd=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisions=e),void 0!==i&&(this.isU=i),void 0!==r&&(this.shiftHalfStep=r),void 0!==n&&(this.removeStart=n),void 0!==s&&(this.removeEnd=s)}},t.FaceSubdivideToRectangleWiresDto=class{constructor(t,e,i,r,n,s,o,a,c){this.nrRectanglesU=10,this.nrRectanglesV=10,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrRectanglesU=e),void 0!==i&&(this.nrRectanglesU=i),void 0!==r&&(this.scalePatternU=r),void 0!==n&&(this.scalePatternV=n),void 0!==s&&(this.filletPattern=s),void 0!==o&&(this.inclusionPattern=o),void 0!==a&&(this.offsetFromBorderU=a),void 0!==c&&(this.offsetFromBorderV=c)}},t.FaceSubdivideToHexagonWiresDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p){this.nrHexagonsU=10,this.nrHexagonsV=10,this.flatU=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,this.extendUUp=!1,this.extendUBottom=!1,this.extendVUp=!1,this.extendVBottom=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrHexagonsU=e),void 0!==i&&(this.nrHexagonsU=i),void 0!==r&&(this.flatU=r),void 0!==n&&(this.scalePatternU=n),void 0!==s&&(this.scalePatternV=s),void 0!==o&&(this.filletPattern=o),void 0!==a&&(this.inclusionPattern=a),void 0!==c&&(this.offsetFromBorderU=c),void 0!==l&&(this.offsetFromBorderV=l),void 0!==h&&(this.extendUUp=h),void 0!==u&&(this.extendUBottom=u),void 0!==d&&(this.extendVUp=d),void 0!==p&&(this.extendVBottom=p)}},t.FaceSubdivideToHexagonHolesDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h){this.nrHexagonsU=10,this.nrHexagonsV=10,this.flatU=!1,this.holesToFaces=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrHexagonsU=e),void 0!==i&&(this.nrHexagonsU=i),void 0!==r&&(this.flatU=r),void 0!==n&&(this.holesToFaces=n),void 0!==s&&(this.scalePatternU=s),void 0!==o&&(this.scalePatternV=o),void 0!==a&&(this.filletPattern=a),void 0!==c&&(this.inclusionPattern=c),void 0!==l&&(this.offsetFromBorderU=l),void 0!==h&&(this.offsetFromBorderV=h)}},t.FaceSubdivideToRectangleHolesDto=class{constructor(t,e,i,r,n,s,o,a,c,l){this.nrRectanglesU=10,this.nrRectanglesV=10,this.holesToFaces=!1,this.offsetFromBorderU=0,this.offsetFromBorderV=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrRectanglesU=e),void 0!==i&&(this.nrRectanglesU=i),void 0!==r&&(this.scalePatternU=r),void 0!==n&&(this.scalePatternV=n),void 0!==s&&(this.filletPattern=s),void 0!==o&&(this.inclusionPattern=o),void 0!==a&&(this.holesToFaces=a),void 0!==c&&(this.offsetFromBorderU=c),void 0!==l&&(this.offsetFromBorderV=l)}},t.FaceSubdivisionControlledDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f){this.nrDivisionsU=10,this.nrDivisionsV=10,this.shiftHalfStepNthU=0,this.shiftHalfStepUOffsetN=0,this.removeStartEdgeNthU=0,this.removeStartEdgeUOffsetN=0,this.removeEndEdgeNthU=0,this.removeEndEdgeUOffsetN=0,this.shiftHalfStepNthV=0,this.shiftHalfStepVOffsetN=0,this.removeStartEdgeNthV=0,this.removeStartEdgeVOffsetN=0,this.removeEndEdgeNthV=0,this.removeEndEdgeVOffsetN=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrDivisionsU=e),void 0!==i&&(this.nrDivisionsV=i),void 0!==r&&(this.shiftHalfStepNthU=r),void 0!==n&&(this.shiftHalfStepUOffsetN=n),void 0!==s&&(this.removeStartEdgeNthU=s),void 0!==o&&(this.removeStartEdgeUOffsetN=o),void 0!==a&&(this.removeEndEdgeNthU=a),void 0!==c&&(this.removeEndEdgeUOffsetN=c),void 0!==l&&(this.shiftHalfStepNthV=l),void 0!==h&&(this.shiftHalfStepVOffsetN=h),void 0!==u&&(this.removeStartEdgeNthV=u),void 0!==d&&(this.removeStartEdgeVOffsetN=d),void 0!==p&&(this.removeEndEdgeNthV=p),void 0!==f&&(this.removeEndEdgeVOffsetN=f)}},t.FaceLinearSubdivisionDto=class{constructor(t,e,i,r,n,s,o){this.isU=!0,this.param=.5,this.nrPoints=10,this.shiftHalfStep=!1,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.param=i),void 0!==r&&(this.nrPoints=r),void 0!==n&&(this.shiftHalfStep=n),void 0!==s&&(this.removeStartPoint=s),void 0!==o&&(this.removeEndPoint=o)}},t.WireAlongParamDto=class{constructor(t,e,i){this.isU=!0,this.param=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.param=i)}},t.WiresAlongParamsDto=class{constructor(t,e,i){this.isU=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.isU=e),void 0!==i&&(this.params=i)}},t.DataOnUVDto=class{constructor(t,e,i){this.paramU=.5,this.paramV=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.paramU=e),void 0!==i&&(this.paramV=i)}},t.DataOnUVsDto=class{constructor(t,e){this.paramsUV=[[.5,.5]],void 0!==t&&(this.shape=t),void 0!==e&&(this.paramsUV=e)}},t.PolygonDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PolygonsDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.polygons=t),void 0!==e&&(this.returnCompound=e)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PolylineBaseDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},t.PolylinesBaseDto=class{constructor(t){void 0!==t&&(this.polylines=t)}},t.LineBaseDto=class{constructor(t){void 0!==t&&(this.line=t)}},t.LinesBaseDto=class{constructor(t){void 0!==t&&(this.lines=t)}},t.SegmentBaseDto=class{constructor(t){void 0!==t&&(this.segment=t)}},t.SegmentsBaseDto=class{constructor(t){void 0!==t&&(this.segments=t)}},t.TriangleBaseDto=class{constructor(t){void 0!==t&&(this.triangle=t)}},t.MeshBaseDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.PolylinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.polylines=t),void 0!==e&&(this.returnCompound=e)}},t.SquareDto=class{constructor(t,e,i){this.size=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.size=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.RectangleDto=class{constructor(t,e,i,r){this.width=1,this.length=2,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.center=i),void 0!==r&&(this.direction=r)}};class M{constructor(t,e,i,r,s,o,a,c){this.widthFirst=1,this.lengthFirst=2,this.widthSecond=.5,this.lengthSecond=2,this.align=n.outside,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.widthFirst=t),void 0!==e&&(this.lengthFirst=e),void 0!==i&&(this.widthSecond=i),void 0!==r&&(this.lengthSecond=r),void 0!==s&&(this.align=s),void 0!==o&&(this.rotation=o),void 0!==a&&(this.center=a),void 0!==c&&(this.direction=c)}}t.LPolygonDto=M;class S{constructor(t,e,i,r,n,s,o,a){this.width=2,this.height=3,this.webThickness=.2,this.flangeThickness=.3,this.alignment=$v.basicAlignmentEnum.midMid,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.webThickness=i),void 0!==r&&(this.flangeThickness=r),void 0!==n&&(this.alignment=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.center=o),void 0!==a&&(this.direction=a)}}t.IBeamProfileDto=S;class w{constructor(t,e,i,r,n,s,o,a){this.width=2,this.height=3,this.webThickness=.2,this.flangeThickness=.3,this.alignment=$v.basicAlignmentEnum.midMid,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.webThickness=i),void 0!==r&&(this.flangeThickness=r),void 0!==n&&(this.alignment=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.center=o),void 0!==a&&(this.direction=a)}}t.HBeamProfileDto=w;class T{constructor(t,e,i,r,n,s,o,a){this.width=2,this.height=2,this.webThickness=.2,this.flangeThickness=.3,this.alignment=$v.basicAlignmentEnum.midMid,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.webThickness=i),void 0!==r&&(this.flangeThickness=r),void 0!==n&&(this.alignment=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.center=o),void 0!==a&&(this.direction=a)}}t.TBeamProfileDto=T;class C{constructor(t,e,i,r,n,s,o,a,c){this.width=2,this.height=3,this.webThickness=.2,this.flangeThickness=.3,this.flangeWidth=.5,this.alignment=$v.basicAlignmentEnum.midMid,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.webThickness=i),void 0!==r&&(this.flangeThickness=r),void 0!==n&&(this.flangeWidth=n),void 0!==s&&(this.alignment=s),void 0!==o&&(this.rotation=o),void 0!==a&&(this.center=a),void 0!==c&&(this.direction=c)}}t.UBeamProfileDto=C,t.ExtrudedSolidDto=class{constructor(t,e,i,r){this.extrusionLengthFront=1,this.extrusionLengthBack=0,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.extrusionLengthFront=t),void 0!==e&&(this.extrusionLengthBack=e),void 0!==i&&(this.center=i),void 0!==r&&(this.direction=r)}},t.IBeamProfileSolidDto=class extends S{constructor(t,e,i,r,n,s,o,a,c,l){super(t,e,i,r,n,s,o,a),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==c&&(this.extrusionLengthFront=c),void 0!==l&&(this.extrusionLengthBack=l)}},t.HBeamProfileSolidDto=class extends w{constructor(t,e,i,r,n,s,o,a,c,l){super(t,e,i,r,n,s,o,a),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==c&&(this.extrusionLengthFront=c),void 0!==l&&(this.extrusionLengthBack=l)}},t.TBeamProfileSolidDto=class extends T{constructor(t,e,i,r,n,s,o,a,c,l){super(t,e,i,r,n,s,o,a),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==c&&(this.extrusionLengthFront=c),void 0!==l&&(this.extrusionLengthBack=l)}},t.UBeamProfileSolidDto=class extends C{constructor(t,e,i,r,n,s,o,a,c,l,h){super(t,e,i,r,n,s,o,a,c),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==l&&(this.extrusionLengthFront=l),void 0!==h&&(this.extrusionLengthBack=h)}},t.BoxDto=class{constructor(t,e,i,r,n){this.width=1,this.length=2,this.height=3,this.center=[0,0,0],this.originOnCenter=!0,void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.height=i),void 0!==r&&(this.center=r),void 0!==n&&(this.originOnCenter=n)}},t.CubeDto=class{constructor(t,e,i){this.size=1,this.center=[0,0,0],this.originOnCenter=!0,void 0!==t&&(this.size=t),void 0!==e&&(this.center=e),void 0!==i&&(this.originOnCenter=i)}},t.BoxFromCornerDto=class{constructor(t,e,i,r){this.width=1,this.length=2,this.height=3,this.corner=[0,0,0],void 0!==t&&(this.width=t),void 0!==e&&(this.length=e),void 0!==i&&(this.height=i),void 0!==r&&(this.corner=r)}},t.SphereDto=class{constructor(t,e){this.radius=1,this.center=[0,0,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e)}},t.ConeDto=class{constructor(t,e,i,r,n,s){this.radius1=2,this.radius2=1,this.height=2,this.angle=360,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius1=t),void 0!==e&&(this.radius2=e),void 0!==i&&(this.height=i),void 0!==r&&(this.angle=r),void 0!==n&&(this.center=n),void 0!==s&&(this.direction=s)}},t.TorusDto=class{constructor(t,e,i,r,n){this.majorRadius=2,this.minorRadius=.5,this.center=[0,0,0],this.direction=[0,1,0],this.angle=360,void 0!==t&&(this.majorRadius=t),void 0!==e&&(this.minorRadius=e),void 0!==i&&(this.center=i),void 0!==r&&(this.direction=r),void 0!==n&&(this.angle=n)}},t.LineDto=class{constructor(t,e){this.start=[0,0,0],this.end=[0,1,0],void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},t.LineWithExtensionsDto=class{constructor(t,e,i,r){this.start=[0,0,0],this.end=[0,1,0],this.extensionStart=.1,this.extensionEnd=.1,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.extensionStart=i),void 0!==r&&(this.extensionEnd=r)}},t.LinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.lines=t),void 0!==e&&(this.returnCompound=e)}},t.ArcEdgeTwoPointsTangentDto=class{constructor(t,e,i){this.start=[0,0,0],this.tangentVec=[0,1,0],this.end=[0,0,1],void 0!==t&&(this.start=t),void 0!==e&&(this.tangentVec=e),void 0!==i&&(this.end=i)}},t.ArcEdgeCircleTwoPointsDto=class{constructor(t,e,i,r){this.start=[0,0,0],this.end=[0,0,1],this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.start=e),void 0!==i&&(this.end=i),void 0!==r&&(this.sense=r)}},t.ArcEdgeCircleTwoAnglesDto=class{constructor(t,e,i,r){this.alphaAngle1=0,this.alphaAngle2=90,this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.alphaAngle1=e),void 0!==i&&(this.alphaAngle2=i),void 0!==r&&(this.sense=r)}},t.ArcEdgeCirclePointAngleDto=class{constructor(t,e,i,r){this.alphaAngle=90,this.sense=!0,void 0!==t&&(this.circle=t),void 0!==e&&(this.alphaAngle=e),void 0!==r&&(this.sense=r)}},t.ArcEdgeThreePointsDto=class{constructor(t,e,i){this.start=[0,0,0],this.middle=[0,1,0],this.end=[0,0,1],void 0!==t&&(this.start=t),void 0!==e&&(this.middle=e),void 0!==i&&(this.end=i)}},t.CylinderDto=class{constructor(t,e,i,r,n,s){this.radius=1,this.height=2,this.center=[0,0,0],this.direction=[0,1,0],this.angle=360,this.originOnCenter=!1,void 0!==t&&(this.radius=t),void 0!==e&&(this.height=e),void 0!==i&&(this.center=i),void 0!==r&&(this.direction=r),void 0!==n&&(this.angle=n),void 0!==s&&(this.originOnCenter=s)}},t.CylindersOnLinesDto=class{constructor(t,e){void 0!==t&&(this.radius=t),void 0!==e&&(this.lines=e)}},t.FilletDto=class{constructor(t,e,i,r){this.radius=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.radiusList=i),void 0!==r&&(this.indexes=r)}},t.FilletShapesDto=class{constructor(t,e,i,r){this.radius=.1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.radiusList=i),void 0!==r&&(this.indexes=r)}},t.FilletEdgesListDto=class{constructor(t,e,i){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusList=i)}},t.FilletEdgesListOneRadiusDto=class{constructor(t,e,i){this.radius=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radius=i)}},t.FilletEdgeVariableRadiusDto=class{constructor(t,e,i,r){void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.radiusList=i),void 0!==r&&(this.paramsU=r)}},t.FilletEdgesVariableRadiusDto=class{constructor(t,e,i,r){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusLists=i),void 0!==r&&(this.paramsULists=r)}},t.FilletEdgesSameVariableRadiusDto=class{constructor(t,e,i,r){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.radiusList=i),void 0!==r&&(this.paramsU=r)}},t.Fillet3DWiresDto=class{constructor(t,e,i,r,n){this.radius=.1,this.direction=[0,1,0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.radiusList=r),void 0!==n&&(this.indexes=n)}},t.Fillet3DWireDto=class{constructor(t,e,i,r,n){this.radius=.1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.radiusList=r),void 0!==n&&(this.indexes=n)}},t.ChamferDto=class{constructor(t,e,i,r){this.distance=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.distance=e),void 0!==i&&(this.distanceList=i),void 0!==r&&(this.indexes=r)}},t.ChamferEdgesListDto=class{constructor(t,e,i){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.distanceList=i)}},t.ChamferEdgeDistAngleDto=class{constructor(t,e,i,r,n){this.distance=.1,this.angle=45,void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.face=i),void 0!==r&&(this.distance=r),void 0!==n&&(this.angle=n)}},t.ChamferEdgeTwoDistancesDto=class{constructor(t,e,i,r,n){this.distance1=.1,this.distance2=.2,void 0!==t&&(this.shape=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.face=i),void 0!==r&&(this.distance1=r),void 0!==n&&(this.distance2=n)}},t.ChamferEdgesTwoDistancesListsDto=class{constructor(t,e,i,r,n){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==r&&(this.distances1=r),void 0!==n&&(this.distances2=n)}},t.ChamferEdgesTwoDistancesDto=class{constructor(t,e,i,r,n){this.distance1=.1,this.distance2=.2,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==r&&(this.distance1=r),void 0!==n&&(this.distance2=n)}},t.ChamferEdgesDistsAnglesDto=class{constructor(t,e,i,r,n){void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==r&&(this.distances=r),void 0!==n&&(this.angles=n)}},t.ChamferEdgesDistAngleDto=class{constructor(t,e,i,r,n){this.distance=.1,this.angle=45,void 0!==t&&(this.shape=t),void 0!==e&&(this.edges=e),void 0!==i&&(this.faces=i),void 0!==r&&(this.distance=r),void 0!==n&&(this.angle=n)}},t.BSplineDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.BSplinesDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.bSplines=t),void 0!==e&&(this.returnCompound=e)}},t.WireFromTwoCirclesTanDto=class{constructor(t,e,i,r,n){this.keepLines=f.outside,this.circleRemainders=p.outside,this.tolerance=1e-7,void 0!==t&&(this.circle1=t),void 0!==e&&(this.circle2=e),void 0!==i&&(this.keepLines=i),void 0!==r&&(this.circleRemainders=r),void 0!==n&&(this.tolerance=n)}},t.FaceFromMultipleCircleTanWiresDto=class{constructor(t,e,i,r){this.combination=m.allWithAll,this.unify=!0,this.tolerance=1e-7,void 0!==t&&(this.circles=t),void 0!==e&&(this.combination=e),void 0!==i&&(this.unify=i),void 0!==r&&(this.tolerance=r)}},t.FaceFromMultipleCircleTanWireCollectionsDto=class{constructor(t,e,i,r){this.combination=m.allWithAll,this.unify=!0,this.tolerance=1e-7,void 0!==t&&(this.listsOfCircles=t),void 0!==e&&(this.combination=e),void 0!==i&&(this.unify=i),void 0!==r&&(this.tolerance=r)}},t.ZigZagBetweenTwoWiresDto=class{constructor(t,e,i,r,n,s){this.nrZigZags=20,this.divideByEqualDistance=!1,this.zigZagsPerEdge=!0,void 0!==t&&(this.wire1=t),void 0!==e&&(this.wire2=e),void 0!==i&&(this.nrZigZags=i),void 0!==r&&(this.inverse=r),void 0!==n&&(this.divideByEqualDistance=n),void 0!==s&&(this.zigZagsPerEdge=s)}},t.InterpolationDto=class{constructor(t,e,i){this.periodic=!1,this.tolerance=1e-7,void 0!==t&&(this.points=t),void 0!==e&&(this.periodic=e),void 0!==i&&(this.tolerance=i)}},t.InterpolateWiresDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.interpolations=t),void 0!==e&&(this.returnCompound=e)}},t.BezierDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.BezierWeightsDto=class{constructor(t,e,i){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.weights=e),void 0!==i&&(this.closed=i)}},t.BezierWiresDto=class{constructor(t,e){this.returnCompound=!1,void 0!==t&&(this.bezierWires=t),void 0!==e&&(this.returnCompound=e)}},t.DivideDto=class{constructor(t,e,i,r){this.nrOfDivisions=10,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.removeStartPoint=i),void 0!==r&&(this.removeEndPoint=r)}},t.ProjectWireDto=class{constructor(t,e,i){this.direction=[0,1,0],void 0!==t&&(this.wire=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i)}},t.ProjectPointsOnShapeDto=class{constructor(t,e,i,r){this.direction=[0,10,0],void 0!==t&&(this.points=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.projectionType=r)}},t.WiresToPointsDto=class{constructor(t,e,i,r,n,s){this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.angularDeflection=e),void 0!==i&&(this.curvatureDeflection=i),void 0!==r&&(this.minimumOfPoints=r),void 0!==n&&(this.uTolerance=n),void 0!==s&&(this.minimumLength=s)}},t.EdgesToPointsDto=class{constructor(t,e,i,r,n,s){this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.angularDeflection=e),void 0!==i&&(this.curvatureDeflection=i),void 0!==r&&(this.minimumOfPoints=r),void 0!==n&&(this.uTolerance=n),void 0!==s&&(this.minimumLength=s)}},t.ProjectWiresDto=class{constructor(t,e,i){this.direction=[0,1,0],void 0!==t&&(this.wires=t),void 0!==e&&(this.shape=e),void 0!==i&&(this.direction=i)}},t.DivideShapesDto=class{constructor(t,e,i,r){this.nrOfDivisions=10,this.removeStartPoint=!1,this.removeEndPoint=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.removeStartPoint=i),void 0!==r&&(this.removeEndPoint=r)}},t.DataOnGeometryAtParamDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.param=e)}},t.DataOnGeometryesAtParamDto=class{constructor(t,e){this.param=.5,void 0!==t&&(this.shapes=t),void 0!==e&&(this.param=e)}},t.PointInFaceDto=class{constructor(t,e,i,r){this.tEdgeParam=.5,this.distance2DParam=.5,void 0!==t&&(this.face=t),void 0!==e&&(this.edge=e),void 0!==i&&(this.tEdgeParam=i),void 0!==r&&(this.distance2DParam=r)}},t.PointsOnWireAtEqualLengthDto=class{constructor(t,e,i,r,n){this.length=.5,this.tryNext=!1,this.includeFirst=!1,this.includeLast=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.length=e),void 0!==i&&(this.tryNext=i),void 0!==r&&(this.includeFirst=r),void 0!==n&&(this.includeLast=n)}},t.PointsOnWireAtPatternOfLengthsDto=class{constructor(t,e,i,r,n){this.tryNext=!1,this.includeFirst=!1,this.includeLast=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.lengths=e),void 0!==i&&(this.tryNext=i),void 0!==r&&(this.includeLast=r),void 0!==n&&(this.includeLast=n)}},t.DataOnGeometryAtLengthDto=class{constructor(t,e){this.length=.5,void 0!==t&&(this.shape=t),void 0!==e&&(this.length=e)}},t.DataOnGeometryesAtLengthDto=class{constructor(t,e){this.length=.5,void 0!==t&&(this.shapes=t),void 0!==e&&(this.length=e)}},t.DataOnGeometryAtLengthsDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.lengths=e)}},t.CircleDto=class{constructor(t,e,i){this.radius=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.HexagonsInGridDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d){this.width=10,this.height=10,this.nrHexagonsInWidth=10,this.nrHexagonsInHeight=10,this.flatTop=!1,this.extendTop=!1,this.extendBottom=!1,this.extendLeft=!1,this.extendRight=!1,void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.nrHexagonsInHeight=i),void 0!==r&&(this.nrHexagonsInWidth=r),void 0!==n&&(this.flatTop=n),void 0!==s&&(this.extendTop=s),void 0!==o&&(this.extendBottom=o),void 0!==a&&(this.extendLeft=a),void 0!==c&&(this.extendRight=c),void 0!==l&&(this.scalePatternWidth=l),void 0!==h&&(this.scalePatternHeight=h),void 0!==u&&(this.filletPattern=u),void 0!==d&&(this.inclusionPattern=d)}},t.LoftDto=class{constructor(t,e){this.makeSolid=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.makeSolid=e)}},t.LoftAdvancedDto=class{constructor(t,e,i,n,s,o,a,c,l,h,u,d){this.makeSolid=!1,this.closed=!1,this.periodic=!1,this.straight=!1,this.nrPeriodicSections=10,this.useSmoothing=!1,this.maxUDegree=3,this.tolerance=1e-7,this.parType=r.approxCentripetal,void 0!==t&&(this.shapes=t),void 0!==e&&(this.makeSolid=e),void 0!==i&&(this.closed=i),void 0!==n&&(this.periodic=n),void 0!==s&&(this.straight=s),void 0!==o&&(this.nrPeriodicSections=o),void 0!==a&&(this.useSmoothing=a),void 0!==c&&(this.maxUDegree=c),void 0!==l&&(this.tolerance=l),void 0!==h&&(this.parType=h),void 0!==u&&(this.startVertex=u),void 0!==d&&(this.endVertex=d)}},t.OffsetDto=class{constructor(t,e,i,r){this.distance=.2,this.tolerance=.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.face=e),void 0!==i&&(this.distance=i),void 0!==r&&(this.tolerance=r)}},t.OffsetAdvancedDto=class{constructor(t,i,r,n,s,o){this.distance=.2,this.tolerance=.1,this.joinType=e.arc,this.removeIntEdges=!1,void 0!==t&&(this.shape=t),void 0!==i&&(this.face=i),void 0!==r&&(this.distance=r),void 0!==n&&(this.tolerance=n),void 0!==s&&(this.joinType=s),void 0!==o&&(this.removeIntEdges=o)}},t.RevolveDto=class{constructor(t,e,i,r){this.angle=360,this.direction=[0,1,0],this.copy=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.copy=r)}},t.ShapeShapesDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e)}},t.WiresOnFaceDto=class{constructor(t,e){void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e)}},t.PipeWiresCylindricalDto=class{constructor(t,e,i,r,n){this.radius=.1,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.makeSolid=i),void 0!==r&&(this.trihedronEnum=r),void 0!==n&&(this.forceApproxC1=n)}},t.PipeWireCylindricalDto=class{constructor(t,e,i,r,n){this.radius=.1,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.makeSolid=i),void 0!==r&&(this.trihedronEnum=r),void 0!==n&&(this.forceApproxC1=n)}},t.PipePolygonWireNGonDto=class{constructor(t,e,i,r,n,s){this.radius=.1,this.nrCorners=6,this.makeSolid=!0,this.trihedronEnum=_.isConstantNormal,this.forceApproxC1=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.nrCorners=i),void 0!==r&&(this.makeSolid=r),void 0!==n&&(this.trihedronEnum=n),void 0!==s&&(this.forceApproxC1=s)}},t.ExtrudeDto=class{constructor(t,e){this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.direction=e)}},t.ExtrudeShapesDto=class{constructor(t,e){this.direction=[0,1,0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.direction=e)}},t.SplitDto=class{constructor(t,e){this.localFuzzyTolerance=1e-4,this.nonDestructive=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e)}},t.UnionDto=class{constructor(t,e){this.keepEdges=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.keepEdges=e)}},t.DifferenceDto=class{constructor(t,e,i){this.keepEdges=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e),void 0!==i&&(this.keepEdges=i)}},t.IntersectionDto=class{constructor(t,e){this.keepEdges=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.keepEdges=e)}},t.ShapeDto=class{constructor(t){void 0!==t&&(this.shape=t)}},t.MeshMeshIntersectionTwoShapesDto=class{constructor(t,e,i,r){this.precision1=.01,this.precision2=.01,void 0!==t&&(this.shape1=t),void 0!==e&&(this.shape2=e),void 0!==i&&(this.precision1=i),void 0!==r&&(this.precision2=r)}},t.MeshMeshesIntersectionOfShapesDto=class{constructor(t,e,i,r){this.precision=.01,void 0!==t&&(this.shape=t),void 0!==e&&(this.shapes=e),void 0!==i&&(this.precision=i),void 0!==r&&(this.precisionShapes=r)}},t.CompareShapesDto=class{constructor(t,e){void 0!==t&&(this.shape=t),void 0!==e&&(this.otherShape=e)}},t.FixSmallEdgesInWireDto=class{constructor(t,e,i){this.lockvtx=!1,this.precsmall=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.lockvtx=e),void 0!==i&&(this.precsmall=i)}},t.BasicShapeRepairDto=class{constructor(t,e,i,r){this.precision=.001,this.maxTolerance=.01,this.minTolerance=1e-4,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.maxTolerance=i),void 0!==r&&(this.minTolerance=r)}},t.FixClosedDto=class{constructor(t,e){this.precision=-.1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e)}},t.ShapesWithToleranceDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shapes=t),void 0!==e&&(this.tolerance=e)}},t.ShapeWithToleranceDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.tolerance=e)}},t.ShapeIndexDto=class{constructor(t,e){this.index=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.index=e)}},t.EdgeIndexDto=class{constructor(t,e){this.index=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.index=e)}},t.RotationExtrudeDto=class{constructor(t,e,i,r){this.height=1,this.angle=360,this.makeSolid=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.height=e),void 0!==i&&(this.angle=i),void 0!==r&&(this.makeSolid=r)}},t.ThickSolidByJoinDto=class{constructor(t,i,r,n,s,o,a,c){this.offset=1,this.tolerance=.001,this.intersection=!1,this.selfIntersection=!1,this.joinType=e.arc,this.removeIntEdges=!1,void 0!==t&&(this.shape=t),void 0!==i&&(this.shapes=i),void 0!==r&&(this.offset=r),void 0!==n&&(this.tolerance=n),void 0!==s&&(this.intersection=s),void 0!==o&&(this.selfIntersection=o),void 0!==a&&(this.joinType=a),void 0!==c&&(this.removeIntEdges=c)}},t.TransformDto=class{constructor(t,e,i,r,n){this.translation=[0,0,0],this.rotationAxis=[0,1,0],this.rotationAngle=0,this.scaleFactor=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.translation=e),void 0!==i&&(this.rotationAxis=i),void 0!==r&&(this.rotationAngle=r),void 0!==n&&(this.scaleFactor=n)}},t.TransformShapesDto=class{constructor(t,e,i,r,n){this.translations=[[0,0,0]],this.rotationAxes=[[0,1,0]],this.rotationAngles=[0],this.scaleFactors=[1],void 0!==t&&(this.shapes=t),void 0!==e&&(this.translations=e),void 0!==i&&(this.rotationAxes=i),void 0!==r&&(this.rotationAngles=r),void 0!==n&&(this.scaleFactors=n)}},t.TranslateDto=class{constructor(t,e){this.translation=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.translation=e)}},t.TranslateShapesDto=class{constructor(t,e){this.translations=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.translations=e)}},t.AlignNormAndAxisDto=class{constructor(t,e,i,r,n,s,o){this.fromOrigin=[0,0,0],this.fromNorm=[1,0,0],this.fromAx=[0,0,1],this.toOrigin=[0,1,0],this.toNorm=[0,1,0],this.toAx=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.fromOrigin=e),void 0!==i&&(this.fromNorm=i),void 0!==r&&(this.fromAx=r),void 0!==n&&(this.toOrigin=n),void 0!==s&&(this.toNorm=s),void 0!==o&&(this.toAx=o)}},t.AlignDto=class{constructor(t,e,i,r,n){this.fromOrigin=[0,0,0],this.fromDirection=[0,0,1],this.toOrigin=[0,1,0],this.toDirection=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.fromOrigin=e),void 0!==i&&(this.fromDirection=i),void 0!==r&&(this.toOrigin=r),void 0!==n&&(this.toDirection=n)}},t.AlignShapesDto=class{constructor(t,e,i,r,n){this.fromOrigins=[[0,0,0]],this.fromDirections=[[0,0,1]],this.toOrigins=[[0,1,0]],this.toDirections=[[0,1,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.fromOrigins=e),void 0!==i&&(this.fromDirections=i),void 0!==r&&(this.toOrigins=r),void 0!==n&&(this.toDirections=n)}},t.MirrorDto=class{constructor(t,e,i){this.origin=[0,0,0],this.direction=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.origin=e),void 0!==i&&(this.direction=i)}},t.MirrorShapesDto=class{constructor(t,e,i){this.origins=[[0,0,0]],this.directions=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.origins=e),void 0!==i&&(this.directions=i)}},t.MirrorAlongNormalDto=class{constructor(t,e,i){this.origin=[0,0,0],this.normal=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.origin=e),void 0!==i&&(this.normal=i)}},t.MirrorAlongNormalShapesDto=class{constructor(t,e,i){this.origins=[[0,0,0]],this.normals=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.origins=e),void 0!==i&&(this.normals=i)}},t.AlignAndTranslateDto=class{constructor(t,e,i){this.direction=[0,1,0],this.center=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.center=i)}},t.UnifySameDomainDto=class{constructor(t,e,i,r){this.unifyEdges=!0,this.unifyFaces=!0,this.concatBSplines=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.unifyEdges=e),void 0!==i&&(this.unifyFaces=i),void 0!==r&&(this.concatBSplines=r)}},t.FilterFacesPointsDto=class{constructor(t,e,i,r,n,s,o,a,c,l){this.tolerance=1e-4,this.useBndBox=!1,this.gapTolerance=.1,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,this.flatPointsArray=!0,void 0!==t&&(this.shapes=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.useBndBox=r),void 0!==n&&(this.gapTolerance=n),void 0!==s&&(this.keepIn=s),void 0!==o&&(this.keepOn=o),void 0!==a&&(this.keepOut=a),void 0!==c&&(this.keepUnknown=c),void 0!==l&&(this.flatPointsArray=l)}},t.FilterFacePointsDto=class{constructor(t,e,i,r,n,s,o,a,c){this.tolerance=1e-4,this.useBndBox=!1,this.gapTolerance=.1,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.useBndBox=r),void 0!==n&&(this.gapTolerance=n),void 0!==s&&(this.keepIn=s),void 0!==o&&(this.keepOn=o),void 0!==a&&(this.keepOut=a),void 0!==c&&(this.keepUnknown=c)}},t.FilterSolidPointsDto=class{constructor(t,e,i,r,n,s,o){this.tolerance=1e-4,this.keepIn=!0,this.keepOn=!0,this.keepOut=!1,this.keepUnknown=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.points=e),void 0!==i&&(this.tolerance=i),void 0!==r&&(this.keepIn=r),void 0!==n&&(this.keepOn=n),void 0!==s&&(this.keepOut=s),void 0!==o&&(this.keepUnknown=o)}},t.AlignAndTranslateShapesDto=class{constructor(t,e,i){this.directions=[[0,1,0]],this.centers=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.directions=e),void 0!==i&&(this.centers=i)}},t.RotateDto=class{constructor(t,e,i){this.axis=[0,0,1],this.angle=0,void 0!==t&&(this.shape=t),void 0!==e&&(this.axis=e),void 0!==i&&(this.angle=i)}},t.RotateAroundCenterDto=class{constructor(t,e,i,r){this.angle=0,this.center=[0,0,0],this.axis=[0,0,1],void 0!==t&&(this.shape=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.center=i),void 0!==r&&(this.axis=r)}},t.RotateShapesDto=class{constructor(t,e,i){this.angles=[0],void 0!==t&&(this.shapes=t),void 0!==e&&(this.axes=e),void 0!==i&&(this.angles=i)}},t.RotateAroundCenterShapesDto=class{constructor(t,e,i,r){this.angles=[0],this.centers=[[0,0,0]],this.axes=[[0,0,1]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.angles=e),void 0!==i&&(this.centers=i),void 0!==r&&(this.axes=r)}},t.ScaleDto=class{constructor(t,e){this.factor=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.factor=e)}},t.ScaleShapesDto=class{constructor(t,e){this.factors=[1],void 0!==t&&(this.shapes=t),void 0!==e&&(this.factors=e)}},t.Scale3DDto=class{constructor(t,e,i){this.scale=[1,1,1],this.center=[0,0,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.scale=e),void 0!==i&&(this.center=i)}},t.Scale3DShapesDto=class{constructor(t,e,i){this.scales=[[1,1,1]],this.centers=[[0,0,0]],void 0!==t&&(this.shapes=t),void 0!==e&&(this.scales=e),void 0!==i&&(this.centers=i)}},t.ShapeToMeshDto=class{constructor(t,e,i){this.precision=.01,this.adjustYtoZ=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i)}},t.ShapeFacesToPolygonPointsDto=class{constructor(t,e,i,r){this.precision=.01,this.adjustYtoZ=!1,this.reversedPoints=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i),void 0!==r&&(this.reversedPoints=r)}},t.ShapesToMeshesDto=class{constructor(t,e,i){this.precision=.01,this.adjustYtoZ=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.precision=e),void 0!==i&&(this.adjustYtoZ=i)}},t.SaveStepDto=class{constructor(t,e,i,r){this.fileName="shape.step",this.adjustYtoZ=!1,this.fromRightHanded=!1,this.tryDownload=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.adjustYtoZ=i),void 0!==r&&(this.tryDownload=r)}},t.SaveStlDto=class{constructor(t,e,i,r,n,s){this.fileName="shape.stl",this.precision=.01,this.adjustYtoZ=!1,this.tryDownload=!0,this.binary=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.precision=i),void 0!==r&&(this.adjustYtoZ=r),void 0!==n&&(this.tryDownload=n),void 0!==s&&(this.binary=s)}},t.ShapeToDxfPathsDto=class{constructor(t,e,i,r,n,s){this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.angularDeflection=e),void 0!==i&&(this.curvatureDeflection=i),void 0!==r&&(this.minimumOfPoints=r),void 0!==n&&(this.uTolerance=n),void 0!==s&&(this.minimumLength=s)}},t.DxfPathsWithLayerDto=class{constructor(t,e,i){this.layer="Default",this.color="#000000",void 0!==t&&(this.paths=t),void 0!==e&&(this.layer=e),void 0!==i&&(this.color=i)}},t.DxfPathsPartsListDto=class{constructor(t,e,i,r){this.colorFormat=y.aci,this.acadVersion=x.AC1009,this.fileName="bitbybit-dev.dxf",this.tryDownload=!0,void 0!==t&&(this.pathsParts=t),void 0!==e&&(this.colorFormat=e),void 0!==i&&(this.acadVersion=i),void 0!==r&&(this.tryDownload=r)}},t.SaveDxfDto=class{constructor(t,e,i,r,n,s,o,a){this.fileName="shape.dxf",this.tryDownload=!0,this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7,void 0!==t&&(this.shape=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.tryDownload=i),void 0!==r&&(this.angularDeflection=r),void 0!==n&&(this.curvatureDeflection=n),void 0!==s&&(this.minimumOfPoints=s),void 0!==o&&(this.uTolerance=o),void 0!==a&&(this.minimumLength=a)}},t.ImportStepIgesFromTextDto=class{constructor(t,e,i){this.fileType=s.step,this.adjustZtoY=!0,void 0!==t&&(this.text=t),void 0!==e&&(this.fileType=e),void 0!==i&&(this.adjustZtoY=i)}},t.ImportStepIgesDto=class{constructor(t,e){this.adjustZtoY=!0,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.adjustZtoY=e)}},t.LoadStepOrIgesDto=class{constructor(t,e,i){this.fileName="shape.igs",this.adjustZtoY=!0,void 0!==t&&(this.filetext=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.adjustZtoY=i)}},t.CompoundShapesDto=class{constructor(t){void 0!==t&&(this.shapes=t)}},t.ThisckSolidSimpleDto=class{constructor(t,e){this.offset=1,void 0!==t&&(this.shape=t),void 0!==e&&(this.offset=e)}},t.Offset3DWireDto=class{constructor(t,e,i){this.offset=1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.offset=e),void 0!==i&&(this.direction=i)}},t.FaceFromWireDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.planar=e)}},t.FaceFromWireOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wire=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.FacesFromWiresOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.FaceFromWiresDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.planar=e)}},t.FacesFromWiresDto=class{constructor(t,e){this.planar=!1,void 0!==t&&(this.shapes=t),void 0!==e&&(this.planar=e)}},t.FaceFromWiresOnFaceDto=class{constructor(t,e,i){this.inside=!0,void 0!==t&&(this.wires=t),void 0!==e&&(this.face=e),void 0!==i&&(this.inside=i)}},t.SewDto=class{constructor(t,e){this.tolerance=1e-7,void 0!==t&&(this.shapes=t),void 0!==e&&(this.tolerance=e)}},t.FaceIsoCurveAtParamDto=class{constructor(t,e,i){this.dir="u",void 0!==t&&(this.shape=t),void 0!==e&&(this.param=e),void 0!==i&&(this.dir=i)}},t.DivideFaceToUVPointsDto=class{constructor(t,e,i,r){this.nrOfPointsU=10,this.nrOfPointsV=10,this.flat=!1,void 0!==t&&(this.shape=t),void 0!==e&&(this.nrOfPointsU=e),void 0!==i&&(this.nrOfPointsV=i),void 0!==r&&(this.flat=r)}},t.Geom2dEllipseDto=class{constructor(t,e,i,r,n){this.center=[0,0],this.direction=[1,0],this.radiusMinor=1,this.radiusMajor=2,this.sense=!1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radiusMinor=i),void 0!==r&&(this.radiusMajor=r),void 0!==n&&(this.sense=n)}},t.Geom2dCircleDto=class{constructor(t,e,i,r){this.center=[0,0],this.direction=[1,0],this.radius=1,this.sense=!1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radius=i),void 0!==r&&(this.sense=r)}};class E{constructor(t,e,i,r,n,s,o,a,c,l){this.height=6,this.innerDist=1.5,this.outerDist=3,this.nrSkirts=5,this.trunkHeight=1,this.trunkWidth=1,this.half=!1,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.innerDist=e),void 0!==i&&(this.outerDist=i),void 0!==r&&(this.nrSkirts=r),void 0!==n&&(this.trunkHeight=n),void 0!==s&&(this.trunkWidth=s),void 0!==o&&(this.half=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.origin=c),void 0!==l&&(this.direction=l)}}t.ChristmasTreeDto=E;class P{constructor(t,e,i,r,n,s,o){this.center=[0,0,0],this.direction=[0,1,0],this.numRays=7,this.half=!1,void 0!==t&&(this.outerRadius=t),void 0!==e&&(this.innerRadius=e),void 0!==i&&(this.numRays=i),void 0!==r&&(this.center=r),void 0!==n&&(this.direction=n),void 0!==s&&(this.offsetOuterEdges=s),void 0!==o&&(this.half=o)}}t.StarDto=P;class A{constructor(t,e,i,r,n,s){this.center=[0,0,0],this.direction=[0,1,0],this.aroundCenter=!0,this.width=2,this.height=1,this.angle=15,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.aroundCenter=i),void 0!==r&&(this.width=r),void 0!==n&&(this.height=n),void 0!==s&&(this.angle=s)}}t.ParallelogramDto=A;class D{constructor(t,e,i,r){this.center=[0,0,0],this.direction=[0,1,0],this.rotation=0,this.sizeApprox=2,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.rotation=i),void 0!==r&&(this.sizeApprox=r)}}t.Heart2DDto=D;class k{constructor(t,e,i,r){this.center=[0,0,0],this.direction=[0,1,0],this.nrCorners=6,this.radius=1,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.nrCorners=i),void 0!==r&&(this.radius=r)}}t.NGonWireDto=k,t.EllipseDto=class{constructor(t,e,i,r){this.center=[0,0,0],this.direction=[0,1,0],this.radiusMinor=1,this.radiusMajor=2,void 0!==t&&(this.center=t),void 0!==e&&(this.direction=e),void 0!==i&&(this.radiusMinor=i),void 0!==r&&(this.radiusMajor=r)}},t.HelixWireDto=class{constructor(t,e,i,r,n,s,o){this.radius=1,this.pitch=1,this.height=5,this.center=[0,0,0],this.direction=[0,1,0],this.clockwise=!1,this.tolerance=1e-4,void 0!==t&&(this.radius=t),void 0!==e&&(this.pitch=e),void 0!==i&&(this.height=i),void 0!==r&&(this.center=r),void 0!==n&&(this.direction=n),void 0!==s&&(this.clockwise=s),void 0!==o&&(this.tolerance=o)}},t.HelixWireByTurnsDto=class{constructor(t,e,i,r,n,s,o){this.radius=1,this.pitch=1,this.numTurns=5,this.center=[0,0,0],this.direction=[0,1,0],this.clockwise=!1,this.tolerance=1e-4,void 0!==t&&(this.radius=t),void 0!==e&&(this.pitch=e),void 0!==i&&(this.numTurns=i),void 0!==r&&(this.center=r),void 0!==n&&(this.direction=n),void 0!==s&&(this.clockwise=s),void 0!==o&&(this.tolerance=o)}},t.TaperedHelixWireDto=class{constructor(t,e,i,r,n,s,o,a){this.startRadius=2,this.endRadius=.5,this.pitch=1,this.height=5,this.center=[0,0,0],this.direction=[0,1,0],this.clockwise=!1,this.tolerance=1e-4,void 0!==t&&(this.startRadius=t),void 0!==e&&(this.endRadius=e),void 0!==i&&(this.pitch=i),void 0!==r&&(this.height=r),void 0!==n&&(this.center=n),void 0!==s&&(this.direction=s),void 0!==o&&(this.clockwise=o),void 0!==a&&(this.tolerance=a)}},t.FlatSpiralWireDto=class{constructor(t,e,i,r,n,s,o){this.startRadius=.5,this.endRadius=5,this.numTurns=5,this.center=[0,0,0],this.direction=[0,1,0],this.clockwise=!1,this.tolerance=1e-4,void 0!==t&&(this.startRadius=t),void 0!==e&&(this.endRadius=e),void 0!==i&&(this.numTurns=i),void 0!==r&&(this.center=r),void 0!==n&&(this.direction=n),void 0!==s&&(this.clockwise=s),void 0!==o&&(this.tolerance=o)}},t.TextWiresDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u){this.text="Hello World",this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=2,this.letterSpacing=0,this.extrudeOffset=0,this.centerOnOrigin=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.xOffset=e),void 0!==i&&(this.yOffset=i),void 0!==r&&(this.height=r),void 0!==n&&(this.lineSpacing=n),void 0!==s&&(this.letterSpacing=s),void 0!==o&&(this.align=o),void 0!==a&&(this.extrudeOffset=a),void 0!==u&&(this.centerOnOrigin=u)}},t.GeomCylindricalSurfaceDto=class{constructor(t,e,i){this.radius=1,this.center=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e),void 0!==i&&(this.direction=i)}},t.Geom2dTrimmedCurveDto=class{constructor(t,e,i,r,n){this.u1=0,this.u2=1,this.sense=!0,this.adjustPeriodic=!0,void 0!==t&&(this.shape=t),void 0!==e&&(this.u1=e),void 0!==i&&(this.u2=i),void 0!==r&&(this.sense=r),void 0!==n&&(this.adjustPeriodic=n)}},t.Geom2dSegmentDto=class{constructor(t,e){this.start=[0,0],this.end=[1,0],void 0!==t&&(this.start=t),void 0!==e&&(this.end=e)}},t.SliceDto=class{constructor(t,e,i){this.step=.1,this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.step=e),void 0!==i&&(this.direction=i)}},t.SliceInStepPatternDto=class{constructor(t,e,i){this.steps=[.1,.2],this.direction=[0,1,0],void 0!==t&&(this.shape=t),void 0!==e&&(this.steps=e),void 0!==i&&(this.direction=i)}},t.SimpleLinearLengthDimensionDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g){this.offsetFromPoints=0,this.crossingSize=.2,this.decimalPlaces=2,this.labelSuffix="(cm)",this.labelSize=.1,this.labelOffset=.3,this.labelRotation=0,this.endType=b.none,this.arrowSize=.3,this.arrowAngle=30,this.arrowsFlipped=!1,this.labelFlipHorizontal=!1,this.labelFlipVertical=!1,this.labelOverwrite="1*val",this.removeTrailingZeros=!1,void 0!==t&&(this.start=t),void 0!==e&&(this.end=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.offsetFromPoints=r),void 0!==n&&(this.crossingSize=n),void 0!==s&&(this.labelSuffix=s),void 0!==o&&(this.labelSize=o),void 0!==a&&(this.labelOffset=a),void 0!==c&&(this.labelRotation=c),void 0!==l&&(this.endType=l),void 0!==h&&(this.arrowSize=h),void 0!==u&&(this.arrowAngle=u),void 0!==d&&(this.arrowsFlipped=d),void 0!==p&&(this.labelFlipHorizontal=p),void 0!==f&&(this.labelFlipVertical=f),void 0!==m&&(this.labelOverwrite=m),void 0!==g&&(this.removeTrailingZeros=g)}},t.SimpleAngularDimensionDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_){this.direction1=[1,0,0],this.direction2=[0,0,1],this.center=[0,0,0],this.radius=4,this.offsetFromCenter=.5,this.extraSize=0,this.decimalPlaces=2,this.labelSuffix="(deg)",this.labelSize=.1,this.labelOffset=.3,this.radians=!1,this.endType=b.none,this.arrowSize=.3,this.arrowAngle=30,this.arrowsFlipped=!1,this.labelRotation=0,this.labelFlipHorizontal=!1,this.labelFlipVertical=!1,this.labelOverwrite="1*val",this.removeTrailingZeros=!1,void 0!==t&&(this.direction1=t),void 0!==e&&(this.direction2=e),void 0!==i&&(this.center=i),void 0!==r&&(this.radius=r),void 0!==n&&(this.offsetFromCenter=n),void 0!==s&&(this.extraSize=s),void 0!==o&&(this.radians=o),void 0!==a&&(this.labelSuffix=a),void 0!==c&&(this.labelSize=c),void 0!==l&&(this.labelOffset=l),void 0!==h&&(this.endType=h),void 0!==u&&(this.arrowSize=u),void 0!==d&&(this.arrowAngle=d),void 0!==p&&(this.arrowsFlipped=p),void 0!==f&&(this.labelRotation=f),void 0!==m&&(this.labelFlipHorizontal=m),void 0!==g&&(this.labelFlipVertical=g),void 0!==v&&(this.labelOverwrite=v),void 0!==_&&(this.removeTrailingZeros=_)}},t.PinWithLabelDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p){this.startPoint=[0,0,0],this.endPoint=[0,5,2],this.direction=[0,0,1],this.offsetFromStart=0,this.label="Pin",this.labelOffset=.3,this.labelSize=.1,this.endType=b.none,this.arrowSize=.3,this.arrowAngle=30,this.arrowsFlipped=!1,this.labelRotation=0,this.labelFlipHorizontal=!1,this.labelFlipVertical=!1,void 0!==t&&(this.startPoint=t),void 0!==e&&(this.endPoint=e),void 0!==i&&(this.direction=i),void 0!==r&&(this.offsetFromStart=r),void 0!==n&&(this.label=n),void 0!==s&&(this.labelOffset=s),void 0!==o&&(this.labelSize=o),void 0!==a&&(this.endType=a),void 0!==c&&(this.arrowSize=c),void 0!==l&&(this.arrowAngle=l),void 0!==h&&(this.arrowsFlipped=h),void 0!==u&&(this.labelRotation=u),void 0!==d&&(this.labelFlipHorizontal=d),void 0!==p&&(this.labelFlipVertical=p)}},t.StarSolidDto=class extends P{constructor(t,e,i,r,n,s,o,a,c){super(t,e,i,r,n,s,o),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==a&&(this.extrusionLengthFront=a),void 0!==c&&(this.extrusionLengthBack=c)}},t.NGonSolidDto=class extends k{constructor(t,e,i,r,n,s){super(t,e,i,r),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==n&&(this.extrusionLengthFront=n),void 0!==s&&(this.extrusionLengthBack=s)}},t.ParallelogramSolidDto=class extends A{constructor(t,e,i,r,n,s,o,a){super(t,e,i,r,n,s),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==o&&(this.extrusionLengthFront=o),void 0!==a&&(this.extrusionLengthBack=a)}},t.HeartSolidDto=class extends D{constructor(t,e,i,r,n,s){super(t,e,i,r),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==n&&(this.extrusionLengthFront=n),void 0!==s&&(this.extrusionLengthBack=s)}},t.ChristmasTreeSolidDto=class extends E{constructor(t,e,i,r,n,s,o,a,c,l,h,u){super(t,e,i,r,n,s,o,a,c,l),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==h&&(this.extrusionLengthFront=h),void 0!==u&&(this.extrusionLengthBack=u)}},t.LPolygonSolidDto=class extends M{constructor(t,e,i,r,n,s,o,a,c,l){super(t,e,i,r,n,s,o,a),this.extrusionLengthFront=1,this.extrusionLengthBack=0,void 0!==c&&(this.extrusionLengthFront=c),void 0!==l&&(this.extrusionLengthBack=l)}}}(D_||(D_={})),function(t){t.GetAssetDto=class{constructor(t){void 0!==t&&(this.fileName=t)}},t.FetchDto=class{constructor(t){void 0!==t&&(this.url=t)}},t.FileDto=class{constructor(t){void 0!==t&&(this.file=t)}},t.FilesDto=class{constructor(t){void 0!==t&&(this.files=t)}},t.AssetFileDto=class{constructor(t,e){this.hidden=!1,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.hidden=e)}},t.AssetFileByUrlDto=class{constructor(t,e,i){this.hidden=!1,void 0!==t&&(this.assetFile=t),void 0!==e&&(this.rootUrl=e),void 0!==i&&(this.hidden=i)}},t.DownloadDto=class{constructor(t,e,i,r){this.extension="txt",this.contentType="text/plain",void 0!==t&&(this.fileName=t),void 0!==e&&(this.content=e),void 0!==i&&(this.extension=i),void 0!==r&&(this.contentType=r)}}}(k_||(k_={})),function(t){t.ParseToArrayDto=class{constructor(t,e,i){this.csv="name,age\nJohn,30",this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.rowSeparator=e),void 0!==i&&(this.columnSeparator=i)}},t.ParseToJsonDto=class{constructor(t,e,i,r,n,s){this.csv="name,age\nJohn,30\nJane,25",this.headerRow=0,this.dataStartRow=1,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.headerRow=e),void 0!==i&&(this.dataStartRow=i),void 0!==r&&(this.rowSeparator=r),void 0!==n&&(this.columnSeparator=n),void 0!==s&&(this.numberColumns=s)}},t.ParseToJsonWithHeadersDto=class{constructor(t,e,i,r,n,s){this.csv="John,30\nJane,25",this.headers=["name","age"],this.dataStartRow=0,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.headers=e),void 0!==i&&(this.dataStartRow=i),void 0!==r&&(this.rowSeparator=r),void 0!==n&&(this.columnSeparator=n),void 0!==s&&(this.numberColumns=s)}},t.QueryColumnDto=class{constructor(t,e,i,r,n,s,o){this.csv="name,age\nJohn,30\nJane,25",this.column="name",this.headerRow=0,this.dataStartRow=1,this.rowSeparator="\n",this.columnSeparator=",",this.asNumber=!1,void 0!==t&&(this.csv=t),void 0!==e&&(this.column=e),void 0!==i&&(this.headerRow=i),void 0!==r&&(this.dataStartRow=r),void 0!==n&&(this.rowSeparator=n),void 0!==s&&(this.columnSeparator=s),void 0!==o&&(this.asNumber=o)}},t.QueryRowsByValueDto=class{constructor(t,e,i,r,n,s,o,a){this.csv="name,age\nJohn,30\nJane,25",this.column="age",this.value="30",this.headerRow=0,this.dataStartRow=1,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.column=e),void 0!==i&&(this.value=i),void 0!==r&&(this.headerRow=r),void 0!==n&&(this.dataStartRow=n),void 0!==s&&(this.rowSeparator=s),void 0!==o&&(this.columnSeparator=o),void 0!==a&&(this.numberColumns=a)}},t.ArrayToCsvDto=class{constructor(t,e,i){this.array=[["name","age"],["John","30"]],this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.array=t),void 0!==e&&(this.rowSeparator=e),void 0!==i&&(this.columnSeparator=i)}},t.JsonToCsvDto=class{constructor(t,e,i,r,n){this.json=[{name:"John",age:"30"}],this.headers=["name","age"],this.includeHeaders=!0,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.json=t),void 0!==e&&(this.headers=e),void 0!==i&&(this.includeHeaders=i),void 0!==r&&(this.rowSeparator=r),void 0!==n&&(this.columnSeparator=n)}},t.JsonToCsvAutoDto=class{constructor(t,e,i,r){this.json=[{name:"John",age:"30"}],this.includeHeaders=!0,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.json=t),void 0!==e&&(this.includeHeaders=e),void 0!==i&&(this.rowSeparator=i),void 0!==r&&(this.columnSeparator=r)}},t.GetHeadersDto=class{constructor(t,e,i,r){this.csv="name,age\nJohn,30",this.headerRow=0,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.headerRow=e),void 0!==i&&(this.rowSeparator=i),void 0!==r&&(this.columnSeparator=r)}},t.GetRowCountDto=class{constructor(t,e,i,r,n){this.csv="name,age\nJohn,30\nJane,25",this.hasHeaders=!0,this.rowSeparator="\n",this.columnSeparator=",",void 0!==t&&(this.csv=t),void 0!==e&&(this.hasHeaders=e),void 0!==i&&(this.dataStartRow=i),void 0!==r&&(this.rowSeparator=r),void 0!==n&&(this.columnSeparator=n)}}}(R_||(R_={})),function(t){t.StringifyDto=class{constructor(t){void 0!==t&&(this.json=t)}},t.ParseDto=class{constructor(t){this.text="[0, 0, 0]",void 0!==t&&(this.text=t)}},t.QueryDto=class{constructor(t,e){void 0!==t&&(this.json=t),void 0!==e&&(this.query=e)}},t.SetValueOnPropDto=class{constructor(t,e,i){this.property="propName",void 0!==t&&(this.json=t),void 0!==e&&(this.value=e),void 0!==i&&(this.property=i)}},t.GetJsonFromArrayByFirstPropMatchDto=class{constructor(t,e,i){this.property="propName",void 0!==t&&(this.jsonArray=t),void 0!==e&&(this.property=e),void 0!==i&&(this.match=i)}},t.GetValueOnPropDto=class{constructor(t,e){this.property="propName",void 0!==t&&(this.json=t),void 0!==e&&(this.property=e)}},t.SetValueDto=class{constructor(t,e,i,r){this.path="$.pathToParent",this.prop="propertyName",void 0!==t&&(this.json=t),void 0!==e&&(this.value=e),void 0!==i&&(this.path=i),void 0!==r&&(this.prop=r)}},t.SetValuesOnPathsDto=class{constructor(t,e,i,r){void 0!==t&&(this.json=t),void 0!==e&&(this.values=e),void 0!==i&&(this.paths=i),void 0!==r&&(this.props=r)}},t.PathsDto=class{constructor(t,e){void 0!==t&&(this.json=t),void 0!==e&&(this.query=e)}},t.JsonDto=class{constructor(t){void 0!==t&&(this.json=t)}}}(I_||(I_={})),function(t){t.DrawTagDto=class{constructor(t,e,i){this.updatable=!1,void 0!==t&&(this.tag=t),void 0!==e&&(this.updatable=e),void 0!==i&&(this.tagVariable=i)}},t.DrawTagsDto=class{constructor(t,e,i){this.updatable=!1,void 0!==t&&(this.tags=t),void 0!==e&&(this.updatable=e),void 0!==i&&(this.tagsVariable=i)}},t.TagDto=class{constructor(t,e,i,r,n,s,o){this.position=[0,0,0],this.colour="#444444",this.size=12,this.adaptDepth=!1,void 0!==t&&(this.text=t),void 0!==e&&(this.position=e),void 0!==i&&(this.colour=i),void 0!==r&&(this.size=r),void 0!==n&&(this.adaptDepth=n),void 0!==s&&(this.needsUpdate=s),void 0!==o&&(this.id=o)}}}(O_||(O_={})),function(t){t.PostFromIframe=class{constructor(t,e){void 0!==t&&(this.data=t),void 0!==e&&(this.targetOrigin=e)}}}(L_||(L_={})),function(t){t.CurveDto=class{constructor(t){void 0!==t&&(this.curve=t)}},t.LineDto=class{constructor(t){void 0!==t&&(this.line=t)}},t.LinesDto=class{constructor(t){void 0!==t&&(this.lines=t)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},t.PolylinesDto=class{constructor(t){void 0!==t&&(this.polylines=t)}},t.CurvesDto=class{constructor(t){void 0!==t&&(this.curves=t)}},t.ClosestPointDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.point=e)}},t.ClosestPointsDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.points=e)}},t.BezierCurveDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.weights=e)}},t.DrawCurveDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.curve=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.curveMesh=s)}},t.CurveParameterDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.parameter=e)}},t.CurvesParameterDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.parameter=e)}},t.CurveTransformDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.transformation=e)}},t.CurvesTransformDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.transformation=e)}},t.CurveToleranceDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.tolerance=e)}},t.CurveLengthToleranceDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.length=e),void 0!==i&&(this.tolerance=i)}},t.CurveDerivativesDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.parameter=e),void 0!==i&&(this.numDerivatives=i)}},t.CurveSubdivisionsDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.subdivision=e)}},t.CurvesSubdivisionsDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.subdivision=e)}},t.CurvesDivideLengthDto=class{constructor(t,e){void 0!==t&&(this.curves=t),void 0!==e&&(this.length=e)}},t.CurveDivideLengthDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.length=e)}},t.DrawCurvesDto=class{constructor(t,e,i,r,n,s){this.opacity=1,this.colours="#444444",this.size=3,this.updatable=!1,void 0!==t&&(this.curves=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.size=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.curvesMesh=s)}},t.CurveNurbsDataDto=class{constructor(t,e,i,r){void 0!==t&&(this.degree=t),void 0!==e&&(this.weights=e),void 0!==i&&(this.knots=i),void 0!==r&&(this.points=r)}},t.CurvePathDataDto=class{constructor(t,e){void 0!==t&&(this.degree=t),void 0!==e&&(this.points=e)}},t.EllipseDto=class{constructor(t){void 0!==t&&(this.ellipse=t)}},t.CircleDto=class{constructor(t){void 0!==t&&(this.circle=t)}},t.ArcDto=class{constructor(t){void 0!==t&&(this.arc=t)}},t.EllipseParametersDto=class{constructor(t,e,i){void 0!==t&&(this.xAxis=t),void 0!==e&&(this.yAxis=e),void 0!==i&&(this.center=i)}},t.CircleParametersDto=class{constructor(t,e,i,r){void 0!==t&&(this.xAxis=t),void 0!==e&&(this.yAxis=e),void 0!==i&&(this.radius=i),void 0!==r&&(this.center=r)}},t.ArcParametersDto=class{constructor(t,e,i,r,n,s){void 0!==t&&(this.minAngle=t),void 0!==e&&(this.maxAngle=e),void 0!==i&&(this.xAxis=i),void 0!==r&&(this.yAxis=r),void 0!==n&&(this.radius=n),void 0!==s&&(this.center=s)}},t.EllipseArcParametersDto=class{constructor(t,e,i,r,n){void 0!==t&&(this.minAngle=t),void 0!==e&&(this.maxAngle=e),void 0!==i&&(this.xAxis=i),void 0!==r&&(this.yAxis=r),void 0!==n&&(this.center=n)}},t.SurfaceDto=class{constructor(t){void 0!==t&&(this.surface=t)}},t.SurfaceTransformDto=class{constructor(t,e){void 0!==t&&(this.surface=t),void 0!==e&&(this.transformation=e)}},t.SurfaceParameterDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.parameter=e),void 0!==i&&(this.useV=i)}},t.IsocurvesParametersDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.parameters=e),void 0!==i&&(this.useV=i)}},t.IsocurveSubdivisionDto=class{constructor(t,e,i,r,n){this.useV=!1,this.includeLast=!0,this.includeFirst=!0,void 0!==t&&(this.surface=t),void 0!==e&&(this.useV=e),void 0!==i&&(this.includeLast=i),void 0!==r&&(this.includeFirst=r),void 0!==n&&(this.isocurveSegments=n)}},t.DerivativesDto=class{constructor(t,e,i,r){void 0!==t&&(this.surface=t),void 0!==e&&(this.u=e),void 0!==i&&(this.v=i),void 0!==r&&(this.numDerivatives=r)}},t.SurfaceLocationDto=class{constructor(t,e,i){void 0!==t&&(this.surface=t),void 0!==e&&(this.u=e),void 0!==i&&(this.v=i)}},t.CornersDto=class{constructor(t,e,i,r){void 0!==t&&(this.point1=t),void 0!==e&&(this.point2=e),void 0!==i&&(this.point3=i),void 0!==r&&(this.point4=r)}},t.SurfaceParamDto=class{constructor(t,e){void 0!==t&&(this.surface=t),void 0!==e&&(this.point=e)}},t.KnotsControlPointsWeightsDto=class{constructor(t,e,i,r,n,s){void 0!==t&&(this.degreeU=t),void 0!==e&&(this.degreeV=e),void 0!==i&&(this.knotsU=i),void 0!==r&&(this.knotsV=r),void 0!==n&&(this.points=n),void 0!==s&&(this.weights=s)}},t.LoftCurvesDto=class{constructor(t,e){void 0!==t&&(this.degreeV=t),void 0!==e&&(this.curves=e)}},t.DrawSurfaceDto=class{constructor(t,e,i,r,n,s,o,a,c){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.surface=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.surfaceMesh=s),void 0!==o&&(this.drawTwoSided=o),void 0!==a&&(this.backFaceColour=a),void 0!==c&&(this.backFaceOpacity=c)}},t.DrawSurfacesDto=class{constructor(t,e,i,r,n,s,o,a,c){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.surfaces=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.surfacesMesh=s),void 0!==o&&(this.drawTwoSided=o),void 0!==a&&(this.backFaceColour=a),void 0!==c&&(this.backFaceOpacity=c)}},t.DrawSurfacesColoursDto=class{constructor(t,e,i,r,n,s,o,a,c){this.opacity=1,this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.surfaces=t),void 0!==e&&(this.colours=e),void 0!==i&&(this.opacity=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.surfacesMesh=s),void 0!==o&&(this.drawTwoSided=o),void 0!==a&&(this.backFaceColour=a),void 0!==c&&(this.backFaceOpacity=c)}},t.ConeAndCylinderParametersDto=class{constructor(t,e,i,r,n){this.axis=[0,1,0],this.xAxis=[1,0,0],this.base=[0,0,0],this.height=2,this.radius=1,void 0!==t&&(this.axis=t),void 0!==e&&(this.xAxis=e),void 0!==i&&(this.base=i),void 0!==r&&(this.height=r),void 0!==n&&(this.radius=n)}},t.ConeDto=class{constructor(t){void 0!==t&&(this.cone=t)}},t.CylinderDto=class{constructor(t){void 0!==t&&(this.cylinder=t)}},t.ExtrusionParametersDto=class{constructor(t,e){void 0!==t&&(this.profile=t),void 0!==e&&(this.direction=e)}},t.ExtrusionDto=class{constructor(t){void 0!==t&&(this.extrusion=t)}},t.SphericalParametersDto=class{constructor(t,e){void 0!==t&&(this.radius=t),void 0!==e&&(this.center=e)}},t.SphereDto=class{constructor(t){void 0!==t&&(this.sphere=t)}},t.RevolutionParametersDto=class{constructor(t,e,i,r){void 0!==t&&(this.profile=t),void 0!==e&&(this.center=e),void 0!==i&&(this.axis=i),void 0!==r&&(this.angle=r)}},t.RevolutionDto=class{constructor(t){void 0!==t&&(this.revolution=t)}},t.SweepParametersDto=class{constructor(t,e){void 0!==t&&(this.profile=t),void 0!==e&&(this.rail=e)}},t.SweepDto=class{constructor(t){void 0!==t&&(this.sweep=t)}},t.CurveCurveDto=class{constructor(t,e,i){void 0!==t&&(this.firstCurve=t),void 0!==e&&(this.secondCurve=e),void 0!==i&&(this.tolerance=i)}},t.CurveSurfaceDto=class{constructor(t,e,i){void 0!==t&&(this.curve=t),void 0!==e&&(this.surface=e),void 0!==i&&(this.tolerance=i)}},t.SurfaceSurfaceDto=class{constructor(t,e,i){void 0!==t&&(this.firstSurface=t),void 0!==e&&(this.secondSurface=e),void 0!==i&&(this.tolerance=i)}},t.CurveCurveIntersectionsDto=class{constructor(t){void 0!==t&&(this.intersections=t)}},t.CurveSurfaceIntersectionsDto=class{constructor(t){void 0!==t&&(this.intersections=t)}}}(N_||(N_={})),function(t){let e;t.horizontalAlignEnum=$v.horizontalAlignEnum,t.verticalAlignmentEnum=$v.verticalAlignmentEnum,t.topBottomEnum=$v.topBottomEnum,t.basicAlignmentEnum=$v.basicAlignmentEnum,function(t){t.firstColorForAll="firstColorForAll",t.lastColorRemainder="lastColorRemainder",t.repeatColors="repeatColors",t.reversedColors="reversedColors"}(e=t.colorMapStrategyEnum||(t.colorMapStrategyEnum={}))}(F_||(F_={})),function(t){let e,i;t.PolylinePropertiesDto=class{constructor(t,e){this.isClosed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.isClosed=e)}},function(t){t.edge="edge",t.round="round",t.chamfer="chamfer"}(e=t.solidCornerTypeEnum||(t.solidCornerTypeEnum={})),function(t){t.left="left",t.center="center",t.right="right"}(i=t.jscadTextAlignEnum||(t.jscadTextAlignEnum={})),t.MeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.MeshesDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.DrawSolidMeshDto=class{constructor(t,e,i,r,n,s,o,a,c){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.mesh=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.jscadMesh=s),void 0!==o&&(this.drawTwoSided=o),void 0!==a&&(this.backFaceColour=a),void 0!==c&&(this.backFaceOpacity=c)}},t.DrawSolidMeshesDto=class{constructor(t,e,i,r,n,s,o,a,c){this.opacity=1,this.colours="#444444",this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.meshes=t),void 0!==e&&(this.opacity=e),void 0!==i&&(this.colours=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.jscadMesh=s),void 0!==o&&(this.drawTwoSided=o),void 0!==a&&(this.backFaceColour=a),void 0!==c&&(this.backFaceOpacity=c)}},t.DrawPathDto=class{constructor(t,e,i,r,n,s){this.colour="#444444",this.opacity=1,this.width=10,this.updatable=!1,void 0!==t&&(this.path=t),void 0!==e&&(this.colour=e),void 0!==i&&(this.opacity=i),void 0!==r&&(this.width=r),void 0!==n&&(this.updatable=n),void 0!==s&&(this.pathMesh=s)}},t.TransformSolidsDto=class{constructor(t,e){void 0!==t&&(this.meshes=t),void 0!==e&&(this.transformation=e)}},t.TransformSolidDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.transformation=e)}},t.DownloadSolidDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.fileName=e)}},t.DownloadGeometryDto=class{constructor(t,e,i){this.fileName="jscad-geometry",void 0!==t&&(this.geometry=t),void 0!==e&&(this.fileName=e),void 0!==i&&(this.options=i)}},t.DownloadSolidsDto=class{constructor(t,e){void 0!==t&&(this.meshes=t),void 0!==e&&(this.fileName=e)}},t.ColorizeDto=class{constructor(t,e){this.color="#0000ff",void 0!==t&&(this.geometry=t),void 0!==e&&(this.color=e)}},t.BooleanObjectsDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.BooleanTwoObjectsDto=class{constructor(t,e){void 0!==t&&(this.first=t),void 0!==e&&(this.second=e)}},t.BooleanObjectsFromDto=class{constructor(t,e){void 0!==t&&(this.from=t),void 0!==e&&(this.meshes=e)}},t.ExpansionDto=class{constructor(t,i,r,n){this.delta=.1,this.corners=e.edge,this.segments=24,void 0!==t&&(this.geometry=t),void 0!==i&&(this.delta=i),void 0!==r&&(this.corners=r),void 0!==n&&(this.segments=n)}},t.OffsetDto=class{constructor(t,i,r,n){this.delta=.1,this.corners=e.edge,this.segments=24,void 0!==t&&(this.geometry=t),void 0!==i&&(this.delta=i),void 0!==r&&(this.corners=r),void 0!==n&&(this.segments=n)}},t.ExtrudeLinearDto=class{constructor(t,e,i,r){this.height=1,this.twistAngle=90,this.twistSteps=15,void 0!==t&&(this.geometry=t),void 0!==e&&(this.height=e),void 0!==i&&(this.twistAngle=i),void 0!==r&&(this.twistSteps=r)}},t.HullDto=class{constructor(t){void 0!==t&&(this.meshes=t)}},t.ExtrudeRectangularDto=class{constructor(t,e,i){this.height=1,this.size=1,void 0!==t&&(this.geometry=t),void 0!==e&&(this.height=e),void 0!==i&&(this.size=i)}},t.ExtrudeRectangularPointsDto=class{constructor(t,e,i){this.height=1,this.size=1,void 0!==t&&(this.points=t),void 0!==e&&(this.height=e),void 0!==i&&(this.size=i)}},t.ExtrudeRotateDto=class{constructor(t,e,i,r){this.angle=90,this.startAngle=0,this.segments=24,void 0!==t&&(this.polygon=t),void 0!==e&&(this.angle=e),void 0!==i&&(this.startAngle=i),void 0!==r&&(this.segments=r)}},t.PolylineDto=class{constructor(t){void 0!==t&&(this.polyline=t)}},t.CurveDto=class{constructor(t){void 0!==t&&(this.curve=t)}},t.PointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.PathDto=class{constructor(t){void 0!==t&&(this.path=t)}},t.PathFromPointsDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.points=t),void 0!==e&&(this.closed=e)}},t.PathsFromPointsDto=class{constructor(t){void 0!==t&&(this.pointsLists=t)}},t.PathFromPolylineDto=class{constructor(t,e){this.closed=!1,void 0!==t&&(this.polyline=t),void 0!==e&&(this.closed=e)}},t.PathAppendCurveDto=class{constructor(t,e){void 0!==t&&(this.curve=t),void 0!==e&&(this.path=e)}},t.PathAppendPointsDto=class{constructor(t,e){void 0!==t&&(this.points=t),void 0!==e&&(this.path=e)}},t.PathAppendPolylineDto=class{constructor(t,e){void 0!==t&&(this.polyline=t),void 0!==e&&(this.path=e)}},t.PathAppendArcDto=class{constructor(t,e,i,r,n,s,o,a){this.endPoint=[1,1],this.xAxisRotation=90,this.clockwise=!0,this.large=!1,this.segments=24,this.radiusX=1,this.radiusY=1,void 0!==t&&(this.path=t),void 0!==e&&(this.endPoint=e),void 0!==i&&(this.xAxisRotation=i),void 0!==r&&(this.clockwise=r),void 0!==n&&(this.large=n),void 0!==s&&(this.segments=s),void 0!==o&&(this.radiusX=o),void 0!==a&&(this.radiusY=a)}},t.CircleDto=class{constructor(t,e,i){this.center=[0,0],this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.EllipseDto=class{constructor(t,e,i){this.center=[0,0],this.radius=[1,2],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.SquareDto=class{constructor(t,e){this.center=[0,0],this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.RectangleDto=class{constructor(t,e,i){this.center=[0,0],this.width=1,this.length=1,void 0!==t&&(this.center=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i)}},t.RoundedRectangleDto=class{constructor(t,e,i,r,n){this.center=[0,0],this.roundRadius=.2,this.segments=24,this.width=1,this.length=1,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.segments=i),void 0!==r&&(this.width=r),void 0!==n&&(this.length=n)}},t.StarDto=class{constructor(t,e,i,r,n,s){this.center=[0,0],this.vertices=10,this.density=1,this.outerRadius=2,this.innerRadius=1,this.startAngle=0,void 0!==t&&(this.center=t),void 0!==e&&(this.vertices=e),void 0!==i&&(this.density=i),void 0!==r&&(this.outerRadius=r),void 0!==n&&(this.innerRadius=n),void 0!==s&&(this.startAngle=s)}},t.CubeDto=class{constructor(t,e){this.center=[0,0,0],this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.CubeCentersDto=class{constructor(t,e){this.size=1,void 0!==t&&(this.centers=t),void 0!==e&&(this.size=e)}},t.CuboidDto=class{constructor(t,e,i,r){this.center=[0,0,0],this.width=1,this.length=1,this.height=1,void 0!==t&&(this.center=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==r&&(this.height=r)}},t.CuboidCentersDto=class{constructor(t,e,i,r){this.width=1,this.length=1,this.height=1,void 0!==t&&(this.centers=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==r&&(this.height=r)}},t.RoundedCuboidDto=class{constructor(t,e,i,r,n,s){this.center=[0,0,0],this.roundRadius=1,this.width=1,this.length=1,this.height=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.width=i),void 0!==r&&(this.length=r),void 0!==n&&(this.height=n),void 0!==s&&(this.segments=s)}},t.RoundedCuboidCentersDto=class{constructor(t,e,i,r,n,s){this.roundRadius=.1,this.width=1,this.length=1,this.height=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.width=i),void 0!==r&&(this.length=r),void 0!==n&&(this.height=n),void 0!==s&&(this.segments=s)}},t.CylidnerEllipticDto=class{constructor(t,e,i,r,n){this.center=[0,0,0],this.height=1,this.startRadius=[1,2],this.endRadius=[2,3],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.height=e),void 0!==i&&(this.startRadius=i),void 0!==r&&(this.endRadius=r),void 0!==n&&(this.segments=n)}},t.CylidnerCentersEllipticDto=class{constructor(t,e,i,r,n){this.height=1,this.startRadius=[1,2],this.endRadius=[2,3],this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.height=e),void 0!==i&&(this.startRadius=i),void 0!==r&&(this.endRadius=r),void 0!==n&&(this.segments=n)}},t.CylidnerDto=class{constructor(t,e,i,r){this.center=[0,0,0],this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.height=e),void 0!==i&&(this.radius=i),void 0!==r&&(this.segments=r)}},t.RoundedCylidnerDto=class{constructor(t,e,i,r,n){this.center=[0,0,0],this.roundRadius=.1,this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.height=i),void 0!==r&&(this.radius=r),void 0!==n&&(this.segments=n)}},t.EllipsoidDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=[1,2,3],this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.EllipsoidCentersDto=class{constructor(t,e,i){this.radius=[1,2,3],this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.GeodesicSphereDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=1,this.frequency=12,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.frequency=i)}},t.GeodesicSphereCentersDto=class{constructor(t,e,i){this.radius=1,this.frequency=12,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.frequency=i)}},t.CylidnerCentersDto=class{constructor(t,e,i,r){this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.height=e),void 0!==i&&(this.radius=i),void 0!==r&&(this.segments=r)}},t.RoundedCylidnerCentersDto=class{constructor(t,e,i,r,n){this.roundRadius=.1,this.height=1,this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.roundRadius=e),void 0!==i&&(this.height=i),void 0!==r&&(this.radius=r),void 0!==n&&(this.segments=n)}},t.SphereDto=class{constructor(t,e,i){this.center=[0,0,0],this.radius=1,this.segments=24,void 0!==t&&(this.center=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.SphereCentersDto=class{constructor(t,e,i){this.radius=1,this.segments=24,void 0!==t&&(this.centers=t),void 0!==e&&(this.radius=e),void 0!==i&&(this.segments=i)}},t.TorusDto=class{constructor(t,e,i,r,n,s,o,a){this.center=[0,0,0],this.innerRadius=1,this.outerRadius=2,this.innerSegments=24,this.outerSegments=24,this.innerRotation=0,this.outerRotation=360,this.startAngle=0,void 0!==t&&(this.center=t),void 0!==e&&(this.innerRadius=e),void 0!==i&&(this.outerRadius=i),void 0!==r&&(this.innerSegments=r),void 0!==n&&(this.outerSegments=n),void 0!==s&&(this.innerRotation=s),void 0!==o&&(this.outerRotation=o),void 0!==a&&(this.startAngle=a)}},t.TextDto=class{constructor(t,e,r,n,s,o,a,c,l){this.text="Hello World",this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.segments=e),void 0!==r&&(this.xOffset=r),void 0!==n&&(this.yOffset=n),void 0!==s&&(this.height=s),void 0!==o&&(this.lineSpacing=o),void 0!==a&&(this.letterSpacing=a),void 0!==c&&(this.align=c),void 0!==l&&(this.extrudeOffset=l)}},t.CylinderTextDto=class{constructor(t,e,r,n,s,o,a,c,l,h,u){this.text="Hello World",this.extrusionHeight=.5,this.extrusionSize=.1,this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.extrusionHeight=e),void 0!==r&&(this.extrusionSize=r),void 0!==n&&(this.segments=n),void 0!==s&&(this.xOffset=s),void 0!==o&&(this.yOffset=o),void 0!==a&&(this.height=a),void 0!==c&&(this.lineSpacing=c),void 0!==l&&(this.letterSpacing=l),void 0!==h&&(this.align=h),void 0!==u&&(this.extrudeOffset=u)}},t.SphereTextDto=class{constructor(t,e,r,n,s,o,a,c,l,h){this.text="Hello World",this.radius=.1,this.segments=24,this.xOffset=0,this.yOffset=0,this.height=1,this.lineSpacing=1.4,this.letterSpacing=1,this.align=i.center,this.extrudeOffset=0,void 0!==t&&(this.text=t),void 0!==e&&(this.radius=e),void 0!==r&&(this.segments=r),void 0!==n&&(this.xOffset=n),void 0!==s&&(this.yOffset=s),void 0!==o&&(this.height=o),void 0!==a&&(this.lineSpacing=a),void 0!==c&&(this.letterSpacing=c),void 0!==l&&(this.align=l),void 0!==h&&(this.extrudeOffset=h)}},t.FromPolygonPoints=class{constructor(t){void 0!==t&&(this.polygonPoints=t)}}}(U_||(U_={})),function(t){let e,i;!function(t){t.evenOdd="EvenOdd",t.nonZero="NonZero",t.positive="Positive",t.negative="Negative"}(e=t.fillRuleEnum||(t.fillRuleEnum={})),function(t){t.square="Square",t.round="Round",t.miter="Miter",t.bevel="Bevel"}(i=t.manifoldJoinTypeEnum||(t.manifoldJoinTypeEnum={})),t.DecomposedManifoldMeshDto=class{},t.DrawManifoldOrCrossSectionDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h){this.faceOpacity=1,this.faceColour="#ff0000",this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.crossSectionOpacity=1,this.computeNormals=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.manifoldOrCrossSection=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.faceMaterial=i),void 0!==r&&(this.faceColour=r),void 0!==n&&(this.crossSectionColour=n),void 0!==s&&(this.crossSectionWidth=s),void 0!==o&&(this.crossSectionOpacity=o),void 0!==a&&(this.computeNormals=a),void 0!==c&&(this.drawTwoSided=c),void 0!==l&&(this.backFaceColour=l),void 0!==h&&(this.backFaceOpacity=h)}},t.DrawManifoldsOrCrossSectionsDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h){this.faceColour="#ff0000",this.faceOpacity=1,this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.crossSectionOpacity=1,this.computeNormals=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.manifoldsOrCrossSections=t),void 0!==e&&(this.faceOpacity=e),void 0!==i&&(this.faceMaterial=i),void 0!==r&&(this.faceColour=r),void 0!==n&&(this.crossSectionColour=n),void 0!==s&&(this.crossSectionWidth=s),void 0!==o&&(this.crossSectionOpacity=o),void 0!==a&&(this.computeNormals=a),void 0!==c&&(this.drawTwoSided=c),void 0!==l&&(this.backFaceColour=l),void 0!==h&&(this.backFaceOpacity=h)}},t.CreateFromMeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.FromPolygonPointsDto=class{constructor(t){void 0!==t&&(this.polygonPoints=t)}},t.CrossSectionFromPolygonPointsDto=class{constructor(t,i,r,n){this.fillRule=e.positive,this.removeDuplicates=!1,this.tolerance=1e-7,void 0!==t&&(this.points=t),void 0!==i&&(this.fillRule=i),void 0!==r&&(this.removeDuplicates=r),void 0!==n&&(this.tolerance=n)}},t.CrossSectionFromPolygonsPointsDto=class{constructor(t,i,r,n){this.fillRule=e.positive,this.removeDuplicates=!1,this.tolerance=1e-7,void 0!==t&&(this.polygonPoints=t),void 0!==i&&(this.fillRule=i),void 0!==r&&(this.removeDuplicates=r),void 0!==n&&(this.tolerance=n)}},t.CubeDto=class{constructor(t,e){this.center=!0,this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.CreateContourSectionDto=class{constructor(t,i){this.fillRule=e.evenOdd,void 0!==t&&(this.polygons=t),void 0!==i&&(this.fillRule=i)}},t.SquareDto=class{constructor(t,e){this.center=!1,this.size=1,void 0!==t&&(this.center=t),void 0!==e&&(this.size=e)}},t.SphereDto=class{constructor(t,e){this.radius=1,void 0!==t&&(this.radius=t),void 0!==e&&(this.circularSegments=e)}},t.CylinderDto=class{constructor(t,e,i,r,n){this.height=1,this.radiusLow=1,this.radiusHigh=1,this.circularSegments=32,this.center=!0,void 0!==t&&(this.height=t),void 0!==e&&(this.radiusLow=e),void 0!==i&&(this.radiusHigh=i),void 0!==r&&(this.circularSegments=r),void 0!==n&&(this.center=n)}},t.CircleDto=class{constructor(t,e){this.radius=1,this.circularSegments=32,void 0!==t&&(this.radius=t),void 0!==e&&(this.circularSegments=e)}},t.RectangleDto=class{constructor(t,e,i){this.length=1,this.height=1,this.center=!1,void 0!==t&&(this.length=t),void 0!==e&&(this.height=e),void 0!==i&&(this.center=i)}},t.ManifoldDto=class{constructor(t){void 0!==t&&(this.manifold=t)}},t.CalculateNormalsDto=class{constructor(t,e,i){this.normalIdx=0,this.minSharpAngle=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e),void 0!==i&&(this.minSharpAngle=i)}},t.CalculateCurvatureDto=class{constructor(t){void 0!==t&&(this.manifold=t)}},t.CountDto=class{constructor(t){void 0!==t&&(this.count=t)}},t.ManifoldsMinGapDto=class{constructor(t,e,i){this.searchLength=100,void 0!==t&&(this.manifold1=t),void 0!==e&&(this.manifold2=e),void 0!==i&&(this.searchLength=i)}},t.ManifoldRefineToleranceDto=class{constructor(t,e){this.tolerance=1e-6,void 0!==t&&(this.manifold=t),void 0!==e&&(this.tolerance=e)}},t.ManifoldRefineLengthDto=class{constructor(t,e){this.length=.1,void 0!==t&&(this.manifold=t),void 0!==e&&(this.length=e)}},t.ManifoldRefineDto=class{constructor(t,e){this.number=1,void 0!==t&&(this.manifold=t),void 0!==e&&(this.number=e)}},t.ManifoldSmoothByNormalsDto=class{constructor(t,e){this.normalIdx=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldSimplifyDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.tolerance=e)}},t.ManifoldSetPropertiesDto=class{constructor(t,e,i){this.numProp=3,void 0!==t&&(this.manifold=t),void 0!==e&&(this.numProp=e),void 0!==i&&(this.propFunc=i)}},t.ManifoldSmoothOutDto=class{constructor(t,e,i){this.minSharpAngle=60,this.minSmoothness=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.minSharpAngle=e),void 0!==i&&(this.minSmoothness=i)}},t.HullPointsDto=class{constructor(t){void 0!==t&&(this.points=t)}},t.SliceDto=class{constructor(t){this.height=.5,void 0!==t&&(this.manifold=t)}},t.MeshDto=class{constructor(t){void 0!==t&&(this.mesh=t)}},t.MeshVertexIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.vertexIndex=e)}},t.MeshTriangleRunIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.triangleRunIndex=e)}},t.MeshHalfEdgeIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.halfEdgeIndex=e)}},t.MeshTriangleIndexDto=class{constructor(t,e){void 0!==t&&(this.mesh=t),void 0!==e&&(this.triangleIndex=e)}},t.CrossSectionDto=class{constructor(t){void 0!==t&&(this.crossSection=t)}},t.CrossSectionsDto=class{constructor(t){void 0!==t&&(this.crossSections=t)}},t.ExtrudeDto=class{constructor(t){this.height=1,this.nDivisions=1,this.twistDegrees=0,this.scaleTopX=1,this.scaleTopY=1,this.center=!0,void 0!==t&&(this.crossSection=t)}},t.RevolveDto=class{constructor(t,e,i,r){this.matchProfile=!0,this.circularSegments=32,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.revolveDegrees=e),void 0!==i&&(this.matchProfile=i),void 0!==r&&(this.circularSegments=r)}},t.OffsetDto=class{constructor(t,e,r,n,s){this.joinType=i.round,this.miterLimit=2,this.circularSegments=32,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.delta=e),void 0!==r&&(this.joinType=r),void 0!==n&&(this.miterLimit=n),void 0!==s&&(this.circularSegments=s)}},t.SimplifyDto=class{constructor(t,e){this.epsilon=1e-6,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.epsilon=e)}},t.ComposeDto=class{constructor(t){void 0!==t&&(this.polygons=t)}},t.MirrorCrossSectionDto=class{constructor(t,e){this.normal=[1,0],void 0!==t&&(this.crossSection=t),void 0!==e&&(this.normal=e)}},t.Scale2DCrossSectionDto=class{constructor(t,e){this.vector=[2,2],void 0!==t&&(this.crossSection=t),void 0!==e&&(this.vector=e)}},t.TranslateCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.vector=e)}},t.RotateCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.degrees=e)}},t.ScaleCrossSectionDto=class{constructor(t,e){this.factor=2,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.factor=e)}},t.TranslateXYCrossSectionDto=class{constructor(t,e,i){this.x=0,this.y=0,void 0!==t&&(this.crossSection=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i)}},t.TransformCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.transform=e)}},t.CrossSectionWarpDto=class{constructor(t,e){void 0!==t&&(this.crossSection=t),void 0!==e&&(this.warpFunc=e)}},t.MirrorDto=class{constructor(t,e){this.normal=[1,0,0],void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e)}},t.Scale3DDto=class{constructor(t,e){this.vector=[2,2,2],void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.TranslateDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.TranslateByVectorsDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vectors=e)}},t.RotateDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.vector=e)}},t.RotateXYZDto=class{constructor(t,e,i,r){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r)}},t.ScaleDto=class{constructor(t,e){this.factor=2,void 0!==t&&(this.manifold=t),void 0!==e&&(this.factor=e)}},t.TranslateXYZDto=class{constructor(t,e,i,r){this.x=0,this.y=0,this.z=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r)}},t.TransformDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.transform=e)}},t.TransformsDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.transforms=e)}},t.ManifoldWarpDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.warpFunc=e)}},t.TwoCrossSectionsDto=class{constructor(t,e){void 0!==t&&(this.crossSection1=t),void 0!==e&&(this.crossSection2=e)}},t.TwoManifoldsDto=class{constructor(t,e){void 0!==t&&(this.manifold1=t),void 0!==e&&(this.manifold2=e)}},t.SplitManifoldsDto=class{constructor(t,e){void 0!==t&&(this.manifoldToSplit=t),void 0!==e&&(this.manifoldCutter=e)}},t.TrimByPlaneDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffset=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffset=i)}},t.SplitByPlaneDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffset=0,void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffset=i)}},t.SplitByPlaneOnOffsetsDto=class{constructor(t,e,i){this.normal=[1,0,0],this.originOffsets=[0],void 0!==t&&(this.manifold=t),void 0!==e&&(this.normal=e),void 0!==i&&(this.originOffsets=i)}},t.ManifoldsDto=class{constructor(t){void 0!==t&&(this.manifolds=t)}},t.ManifoldToMeshDto=class{constructor(t,e){void 0!==t&&(this.manifold=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldsToMeshesDto=class{constructor(t,e){void 0!==t&&(this.manifolds=t),void 0!==e&&(this.normalIdx=e)}},t.DecomposeManifoldOrCrossSectionDto=class{constructor(t,e){void 0!==t&&(this.manifoldOrCrossSection=t),void 0!==e&&(this.normalIdx=e)}},t.ManifoldOrCrossSectionDto=class{constructor(t){void 0!==t&&(this.manifoldOrCrossSection=t)}},t.ManifoldsOrCrossSectionsDto=class{constructor(t){void 0!==t&&(this.manifoldsOrCrossSections=t)}},t.DecomposeManifoldsOrCrossSectionsDto=class{constructor(t,e){void 0!==t&&(this.manifoldsOrCrossSections=t),void 0!==e&&(this.normalIdx=e)}}}(W_||(W_={}));class B_ extends Zg{constructor(t,e){super(t),this.occWorkerManager=t,this.context=e}loadSTEPorIGES(t){return this.context.getFile(t.assetFile).then((e=>this.occWorkerManager.genericCallToWorkerPromise("io.loadSTEPorIGES",new D_.LoadStepOrIgesDto(e,t.assetFile.name,t.adjustZtoY))))}loadSTEPorIGESFromText(t){return this.occWorkerManager.genericCallToWorkerPromise("io.loadSTEPorIGES",new D_.LoadStepOrIgesDto(t.text,`fake.${t.fileType}`,t.adjustZtoY))}}class z_ extends ov{constructor(t,e){super(e),this.context=t,this.occWorkerManager=e,this.io=new B_(e,t)}}class V_{constructor(t,e){this.context=t,this.math=e}createCircle(t){return new this.context.verb.geom.Circle(t.center,t.xAxis,t.yAxis,t.radius)}createArc(t){return new this.context.verb.geom.Arc(t.center,t.xAxis,t.yAxis,t.radius,this.math.degToRad({number:t.minAngle}),this.math.degToRad({number:t.maxAngle}))}center(t){return t.circle.center()}radius(t){return t.circle.radius()}maxAngle(t){return this.math.radToDeg({number:t.circle.maxAngle()})}minAngle(t){return this.math.radToDeg({number:t.circle.minAngle()})}xAxis(t){return t.circle.xaxis()}yAxis(t){return t.circle.yaxis()}}class H_{constructor(t,e){this.context=t,this.math=e}createEllipse(t){return new this.context.verb.geom.Ellipse(t.center,t.xAxis,t.yAxis)}createArc(t){return new this.context.verb.geom.EllipseArc(t.center,t.xAxis,t.yAxis,this.math.degToRad({number:t.minAngle}),this.math.degToRad({number:t.maxAngle}))}center(t){return t.ellipse.center()}maxAngle(t){return this.math.radToDeg({number:t.ellipse.maxAngle()})}minAngle(t){return this.math.radToDeg({number:t.ellipse.minAngle()})}xAxis(t){return t.ellipse.xaxis()}yAxis(t){return t.ellipse.yaxis()}}class G_{constructor(t,e,i){this.context=t,this.geometryHelper=e,this.math=i,this.circle=new V_(t,this.math),this.ellipse=new H_(t,this.math)}createCurveByKnotsControlPointsWeights(t){return this.context.verb.geom.NurbsCurve.byKnotsControlPointsWeights(t.degree,t.knots,t.points,t.weights)}createCurveByPoints(t){return this.context.verb.geom.NurbsCurve.byPoints(t.points,t.degree)}convertLinesToNurbsCurves(t){return t.lines.map((t=>new this.context.verb.geom.Line(t.start,t.end)))}convertLineToNurbsCurve(t){return new this.context.verb.geom.Line(t.line.start,t.line.end)}convertPolylineToNurbsCurve(t){return this.context.verb.geom.NurbsCurve.byPoints(t.polyline.points,1)}convertPolylinesToNurbsCurves(t){return t.polylines.map((t=>this.convertPolylineToNurbsCurve({polyline:t})))}createBezierCurve(t){return new this.context.verb.geom.BezierCurve(t.points,t.weights)}clone(t){return t.curve.clone()}closestParam(t){return t.curve.closestParam(t.point)}closestParams(t){return t.points.map((e=>t.curve.closestParam(e)))}closestPoint(t){return t.curve.closestPoint(t.point)}closestPoints(t){return t.points.map((e=>t.curve.closestPoint(e)))}controlPoints(t){return t.curve.controlPoints()}degree(t){return t.curve.degree()}derivatives(t){return t.curve.derivatives(t.parameter,t.numDerivatives)}divideByEqualArcLengthToParams(t){return t.curve.divideByEqualArcLength(t.subdivision).map((t=>t.u))}divideByEqualArcLengthToPoints(t){return t.curve.divideByEqualArcLength(t.subdivision).map((e=>t.curve.point(e.u)))}divideByArcLengthToParams(t){return t.curve.divideByArcLength(t.length).map((t=>t.u))}divideByArcLengthToPoints(t){return t.curve.divideByArcLength(t.length).map((e=>t.curve.point(e.u)))}divideCurvesByEqualArcLengthToPoints(t){return t.curves.map((e=>this.divideByEqualArcLengthToPoints({curve:e,subdivision:t.subdivision})))}divideCurvesByArcLengthToPoints(t){return t.curves.map((e=>this.divideByArcLengthToPoints({curve:e,length:t.length})))}domain(t){return t.curve.domain()}startPoint(t){return t.curve.point(t.curve.domain().min)}endPoint(t){return t.curve.point(t.curve.domain().max)}startPoints(t){return t.curves.map((t=>this.startPoint({curve:t})))}endPoints(t){return t.curves.map((t=>this.endPoint({curve:t})))}knots(t){return t.curve.knots()}lengthAtParam(t){return t.curve.lengthAtParam(t.parameter)}length(t){return t.curve.length()}paramAtLength(t){return t.curve.paramAtLength(t.length,t.tolerance)}pointAtParam(t){return t.curve.point(t.parameter)}pointsAtParam(t){return t.curves.map((e=>this.pointAtParam({curve:e,parameter:t.parameter})))}reverse(t){return t.curve.reverse()}split(t){return t.curve.split(t.parameter)}tangent(t){return t.curve.tangent(t.parameter)}tessellate(t){return t.curve.tessellate(t.tolerance)}transform(t){const e=t.curve.controlPoints(),i=this.geometryHelper.transformControlPoints(t.transformation,e);return this.context.verb.geom.NurbsCurve.byKnotsControlPointsWeights(t.curve.degree(),t.curve.knots(),i,t.curve.weights())}transformCurves(t){return t.curves.map((e=>this.transform({curve:e,transformation:t.transformation})))}weights(t){return t.curve.weights()}}class j_{constructor(t,e){this.context=t,this.geometryHelper=e}curves(t){return this.context.verb.geom.Intersect.curves(t.firstCurve,t.secondCurve,t.tolerance)}curveAndSurface(t){return this.context.verb.geom.Intersect.curveAndSurface(t.curve,t.surface,t.tolerance)}surfaces(t){return this.context.verb.geom.Intersect.surfaces(t.firstSurface,t.secondSurface)}curveCurveFirstParams(t){return t.intersections.filter((t=>t.u0>=0&&t.u0<=1)).map((t=>t.u0))}curveCurveSecondParams(t){return t.intersections.filter((t=>t.u1>=0&&t.u1<=1)).map((t=>t.u1))}curveCurveFirstPoints(t){return t.intersections.filter((t=>t.u0>=0&&t.u0<=1)).map((t=>t.point0))}curveCurveSecondPoints(t){return t.intersections.filter((t=>t.u1>=0&&t.u1<=1)).map((t=>t.point1))}curveSurfaceCurveParams(t){return t.intersections.filter((t=>t.u>=0&&t.u<=1)).map((t=>t.u))}curveSurfaceSurfaceParams(t){return t.intersections.map((t=>t.uv))}curveSurfaceCurvePoints(t){return t.intersections.filter((t=>t.u>=0&&t.u<=1)).map((t=>t.curvePoint))}curveSurfaceSurfacePoints(t){return t.intersections.map((t=>t.surfacePoint))}}class X_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.ConicalSurface(t.axis,t.xAxis,t.base,t.height,t.radius)}axis(t){return t.cone.axis()}base(t){return t.cone.base()}height(t){return t.cone.height()}radius(t){return t.cone.radius()}xAxis(t){return t.cone.xaxis()}}class q_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.CylindricalSurface(t.axis,t.xAxis,t.base,t.height,t.radius)}axis(t){return t.cylinder.axis()}base(t){return t.cylinder.base()}height(t){return t.cylinder.height()}radius(t){return t.cylinder.radius()}xAxis(t){return t.cylinder.xaxis()}}class Y_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.ExtrudedSurface(t.profile,t.direction)}direction(t){return t.extrusion.direction()}profile(t){return t.extrusion.profile()}}class Z_{constructor(t,e){this.context=t,this.math=e}create(t){return new this.context.verb.geom.RevolvedSurface(t.profile,t.center,t.axis,this.math.degToRad({number:t.angle}))}profile(t){return t.revolution.profile()}center(t){return t.revolution.center()}axis(t){return t.revolution.axis()}angle(t){return this.math.radToDeg({number:t.revolution.angle()})}}class J_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.SphericalSurface(t.center,t.radius)}radius(t){return t.sphere.radius()}center(t){return t.sphere.center()}}class K_{constructor(t){this.context=t}create(t){return new this.context.verb.geom.SweptSurface(t.profile,t.rail)}profile(t){return t.sweep.profile()}rail(t){return t.sweep.rail()}}class $_{constructor(t,e,i){this.context=t,this.geometryHelper=e,this.math=i,this.cone=new X_(t),this.cylinder=new q_(t),this.extrusion=new Y_(t),this.sphere=new J_(t),this.revolved=new Z_(t,i),this.sweep=new K_(t)}boundaries(t){return t.surface.boundaries()}createSurfaceByCorners(t){return this.context.verb.geom.NurbsSurface.byCorners(t.point1,t.point2,t.point3,t.point4)}createSurfaceByKnotsControlPointsWeights(t){return this.context.verb.geom.NurbsSurface.byKnotsControlPointsWeights(t.degreeU,t.degreeV,t.knotsU,t.knotsV,t.points,t.weights)}createSurfaceByLoftingCurves(t){return this.context.verb.geom.NurbsSurface.byLoftingCurves(t.curves,t.degreeV)}clone(t){return t.surface.clone()}closestParam(t){return t.surface.closestParam(t.point)}closestPoint(t){return t.surface.closestPoint(t.point)}controlPoints(t){return t.surface.controlPoints()}degreeU(t){return t.surface.degreeU()}degreeV(t){return t.surface.degreeV()}derivatives(t){return t.surface.derivatives(t.u,t.v,t.numDerivatives)}domainU(t){return t.surface.domainU()}domainV(t){return t.surface.domainV()}isocurve(t){return t.surface.isocurve(t.parameter,t.useV)}isocurvesSubdivision(t){const e=.999999/t.isocurveSegments,i=this.context.verb.core.Vec.span(1e-7,.9999999,e);return t.includeLast||i.pop(),t.includeFirst||i.shift(),i.map((e=>t.surface.isocurve(e,t.useV)))}isocurvesAtParams(t){return t.parameters.map((e=>t.surface.isocurve(e,t.useV)))}knotsU(t){return t.surface.knotsU()}knotsV(t){return t.surface.knotsV()}normal(t){return t.surface.normal(t.u,t.v)}point(t){return t.surface.point(t.u,t.v)}reverse(t){return t.surface.reverse()}split(t){return t.surface.split(t.parameter,t.useV)}transformSurface(t){const e=t.surface.controlPoints(),i=t.transformation,r=[];return e.forEach((t=>{let e=t;e=this.geometryHelper.transformControlPoints(i,e),r.push(e)})),this.context.verb.geom.NurbsSurface.byKnotsControlPointsWeights(t.surface.degreeU(),t.surface.degreeV(),t.surface.knotsU(),t.surface.knotsV(),r,t.surface.weights())}weights(t){return t.surface.weights()}}class Q_{constructor(t,e,i){this.math=i,this.curve=new G_(t,e,this.math),this.surface=new $_(t,e,this.math),this.intersect=new j_(t,e)}}class ty{}var ey,iy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class ry{constructor(){this.assetManager=new ty}getFile(t){return this.assetManager.getAsset(t.fileName)}getTextFile(t){return iy(this,void 0,void 0,(function*(){const e=yield this.assetManager.getAsset(t.fileName);return yield e.text()}))}getLocalFile(t){return this.assetManager.getLocalAsset(t.fileName)}getLocalTextFile(t){return iy(this,void 0,void 0,(function*(){const e=yield this.getLocalFile(t);return Array.isArray(e)?yield Promise.all(e.map((t=>t.text()))):yield e.text()}))}fetchBlob(t){return iy(this,void 0,void 0,(function*(){return(yield fetch(t.url)).blob()}))}fetchFile(t){return iy(this,void 0,void 0,(function*(){const e=yield fetch(t.url),i=yield e.blob();return new File([i],t.url.split("/").pop().split("?")[0])}))}fetchJSON(t){return iy(this,void 0,void 0,(function*(){return(yield fetch(t.url)).json()}))}fetchText(t){return iy(this,void 0,void 0,(function*(){return(yield fetch(t.url)).text()}))}createObjectURL(t){return URL.createObjectURL(t.file)}createObjectURLs(t){return t.files.map((t=>URL.createObjectURL(t)))}download(t){let e;e="string"==typeof t.content?new Blob([t.content],{type:t.contentType}):t.content,this.assetManager.downloadFile(e,t.fileName,t.extension,t.contentType)}}!function(t){t.IntervalDto=class{constructor(){this.min=0,this.max=1}},t.UVDto=class{constructor(){this.u=0,this.v=0}},t.CurveCurveIntersection=class{},t.CurveSurfaceIntersection=class{},t.SurfaceSurfaceIntersectionPoint=class{}}(ey||(ey={}));class ny{parseToArray(t){const e=this.convertEscapeSequences(t.rowSeparator||"\n"),i=this.convertEscapeSequences(t.columnSeparator||","),r=this.convertEscapeSequences(t.csv).split(e),n=[];for(let t=0;t<r.length;t++){const e=r[t].trim();if(!e)continue;const s=this.parseCsvLine(e,i);n.push(s)}return n}parseToJson(t){var e,i;const r=this.parseToArray({csv:t.csv,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator});if(0===r.length)return[];const n=null!==(e=t.headerRow)&&void 0!==e?e:0,s=null!==(i=t.dataStartRow)&&void 0!==i?i:1;if(n>=r.length)throw new Error(`Header row ${n} is out of bounds (total rows: ${r.length})`);const o=r[n],a=new Set(t.numberColumns||[]),c=[];for(let t=s;t<r.length;t++){const e=r[t],i={};o.forEach(((t,r)=>{const n=e[r]||"";if(a.has(t)){const e=parseFloat(n);i[t]=0===e?0:e}else i[t]=n})),c.push(i)}return c}parseToJsonWithHeaders(t){var e;const i=this.parseToArray({csv:t.csv,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator});if(0===i.length)return[];const r=null!==(e=t.dataStartRow)&&void 0!==e?e:0,n=new Set(t.numberColumns||[]),s=[];for(let e=r;e<i.length;e++){const r=i[e],o={};t.headers.forEach(((t,e)=>{const i=r[e]||"";if(n.has(t)){const e=parseFloat(i);o[t]=0===e?0:e}else o[t]=i})),s.push(o)}return s}queryColumn(t){const e=t.asNumber?[t.column]:void 0;return this.parseToJson({csv:t.csv,headerRow:t.headerRow,dataStartRow:t.dataStartRow,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator,numberColumns:e}).map((e=>void 0!==e[t.column]?e[t.column]:""))}queryRowsByValue(t){var e;const i=this.parseToJson({csv:t.csv,headerRow:t.headerRow,dataStartRow:t.dataStartRow,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator,numberColumns:t.numberColumns}),r=null===(e=t.numberColumns)||void 0===e?void 0:e.includes(t.column),n=r?parseFloat(t.value):t.value;return i.filter((e=>{const i=e[t.column];return r?i===n:i===t.value}))}arrayToCsv(t){const e=this.convertEscapeSequences(t.columnSeparator||","),i=this.convertEscapeSequences(t.rowSeparator||"\n");return t.array.map((t=>t.map((t=>this.escapeCsvCell(t,e))).join(e))).join(i)}jsonToCsv(t){const e=this.convertEscapeSequences(t.columnSeparator||","),i=this.convertEscapeSequences(t.rowSeparator||"\n");if(!t.json||0===t.json.length)return t.includeHeaders?t.headers.join(e):"";const r=[];return t.includeHeaders&&r.push(t.headers.map((t=>this.escapeCsvCell(t,e))).join(e)),t.json.forEach((i=>{const n=t.headers.map((t=>{const r=i[t];return this.escapeCsvCell(null!=r?String(r):"",e)}));r.push(n.join(e))})),r.join(i)}jsonToCsvAuto(t){var e;if(!t.json||0===t.json.length)return"";const i=Object.keys(t.json[0]);return this.jsonToCsv({json:t.json,headers:i,includeHeaders:null===(e=t.includeHeaders)||void 0===e||e,columnSeparator:t.columnSeparator,rowSeparator:t.rowSeparator})}getHeaders(t){var e;const i=this.parseToArray({csv:t.csv,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator}),r=null!==(e=t.headerRow)&&void 0!==e?e:0;if(r>=i.length)throw new Error(`Header row ${r} is out of bounds (total rows: ${i.length})`);return i[r]}getRowCount(t){var e;const i=this.parseToArray({csv:t.csv,rowSeparator:t.rowSeparator,columnSeparator:t.columnSeparator}),r=null!==(e=t.dataStartRow)&&void 0!==e?e:t.hasHeaders?1:0;return Math.max(0,i.length-r)}getColumnCount(t){const e=this.parseToArray(t);return e.length>0?e[0].length:0}parseCsvLine(t,e){const i=[];let r="",n=!1;for(let s=0;s<t.length;s++){const o=t[s],a=t[s+1];'"'===o?n&&'"'===a?(r+='"',s++):n=!n:o!==e||n?r+=o:(i.push(r),r="")}return i.push(r),i}escapeCsvCell(t,e){const i=null!=t?String(t):"";return i.includes(e)||i.includes('"')||i.includes("\n")||i.includes("\r")?'"'+i.replace(/"/g,'""')+'"':i}convertEscapeSequences(t){return t.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r")}}class sy{constructor(t){this.context=t}stringify(t){return JSON.stringify(t.json)}parse(t){return JSON.parse(t.text)}query(t){return this.context.jsonpath({path:t.query,json:t.json})}setValueOnProp(t){const e=Object.assign({},structuredClone(t.json));return e[t.property]=t.value,e}getJsonFromArrayByFirstPropMatch(t){return t.jsonArray.find((e=>e[t.property]===t.match))}getValueOnProp(t){try{return Object.assign({},structuredClone(t.json))[t.property]}catch(e){return t.json[t.property]}}setValue(t){if(t.json instanceof Object){const e=Object.assign({},structuredClone(t.json)),i=e=>(e[t.prop]=t.value,e);return this.context.jsonpath({path:t.path,json:e,callback:i}),e}throw new Error("Json must be an object")}setValuesOnPaths(t){let e=Object.assign({},structuredClone(t.json));return t.paths.forEach(((i,r)=>{e=this.setValue({json:e,path:i,value:t.values[r],prop:t.props[r]})})),e}paths(t){return this.context.jsonpath({json:t.json,path:t.query,resultType:"path"})}createEmpty(){return{}}previewAndSaveJson(t){t.json&&this.context.promptPrintSave({text:t.json,isJson:!0,hidden:!1})}previewJson(t){t.json&&this.context.promptPrint({text:t.json,isJson:!0,hidden:!1})}}class oy{constructor(t){this.context=t}create(t){const e=new O_.TagDto;return e.text=t.text,e.position=t.position,e.colour=t.colour,e.size=t.size,e.adaptDepth=t.adaptDepth,e}drawTag(t){if(t.tagVariable&&t.updatable){const e=this.context.tagBag.find((e=>e.id===t.tagVariable.id));Object.keys(t.tag).forEach((i=>{e[i]=t.tag[i]})),e.needsUpdate=!0}else{const e=document.createElement("span"),i="_tag"+(new Date).getTime()+this.context.tagBag.length;t.tag.id=i,e.id=i,e.textContent=t.tag.text,document.querySelector("."+this.context.canvasZoneClass).appendChild(e),t.tag.needsUpdate=!0,this.context.tagBag.push(t.tag)}return t.tag}drawTags(t){if(t.tagsVariable&&t.updatable){if(t.tagsVariable.length<t.tags.length)for(let e=t.tagsVariable.length-1;e<t.tags.length-1;e++){const i=t.tags[e],r=document.createElement("span"),n="_tag"+(new Date).getTime()+this.context.tagBag.length;i.id=n,r.id=n,document.querySelector("."+this.context.canvasZoneClass).appendChild(r),i.needsUpdate=!0,this.context.tagBag.push(i),t.tagsVariable.push(i)}t.tagsVariable.forEach(((e,i)=>{const r=this.context.tagBag.find((t=>t.id===e.id)),n=t.tags[i];if(n)Object.keys(n).forEach((t=>{r[t]=n[t]})),r.needsUpdate=!0;else{this.context.tagBag=this.context.tagBag.filter((t=>t.id!==r.id));const t=document.getElementById(r.id);t.parentNode.removeChild(t)}}))}else{const e=[];t.tags.forEach(((i,r)=>{const n=document.createElement("span"),s="_tag"+(new Date).getTime()+this.context.tagBag.length;i.id=s,n.id=s,n.textContent=i.text,document.querySelector("."+this.context.canvasZoneClass).appendChild(n),i.needsUpdate=!0,this.context.tagBag.push(i),e.push(i),t.tagsVariable=e}))}return t.tagsVariable}}class ay{constructor(t){this.context=t}registerRenderFunction(t){this.context.renderLoopBag.push((e=>{t(e)}))}}const cy=.5,ly=.4,hy=.4,uy=.5,dy=.7,py=.6,fy=.8,my=.7,gy="#0000ff";var vy;!function(t){t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG"}(vy||(vy={}));class _y{constructor(){this.canvasZoneClass="canvasZone",this.tolerance=1e-5,this.snapTolerance=1e-5,this.tagBag=[],this.timeoutBag=[],this.intervalBag=[],this.renderLoopBag=[],this.keyDownBag=[],this.keyUpBag=[],this.keyPressBag=[],this.currentlyPressedKeys=[]}getFile(t){return new Promise(((e,i)=>{if(t){const r=new FileReader;r.readAsText(t,"UTF-8"),r.onload=t=>{const i=t.target.result;e(i)},r.onerror=t=>{i()}}else i()}))}remap(t,e,i,r,n){return(t-e)/(i-e)*(n-r)+r}}class yy{detectPoint(t){return Array.isArray(t)&&3===t.length&&this.checkIfElementsInArrayAreNumbers(t)}detectPoints(t){return Array.isArray(t)&&this.checkIfElementsInArrayAreArrays(t)&&this.arraysInChildrenArraysContainNumbers(t)&&this.arraysInChildrenArraysAreOfLength3(t)}detectLine(t){if(!t||"object"!=typeof t)return!1;const e=t;return e.start&&e.end&&Array.isArray(e.start)&&Array.isArray(e.end)||Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1])&&this.checkIfElementsInArrayAreNumbers(t[0])&&3===t[0].length&&this.checkIfElementsInArrayAreNumbers(t[1])&&3===t[1].length}detectLines(t){return Array.isArray(t)&&!t.some((t=>!this.detectLine(t)))}detectPolyline(t){if(!t||"object"!=typeof t)return!1;const e=t;return void 0!==e.points&&Array.isArray(e.points)}detectPolylines(t){return Array.isArray(t)&&!t.some((t=>!this.detectPolyline(t)))}detectNode(t){if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=t;return"string"==typeof e.id&&e.id.includes("node")}detectNodes(t){return Array.isArray(t)&&!t.some((t=>!this.detectNode(t)))}detectVerbCurve(t){if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=t._data;return void 0!==e&&void 0!==e.controlPoints&&void 0!==e.knots&&void 0!==e.degree}detectVerbSurface(t){if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=t._data;return void 0!==e&&void 0!==e.controlPoints&&void 0!==e.degreeU&&void 0!==e.degreeV&&void 0!==e.knotsU&&void 0!==e.knotsV}detectVerbCurves(t){return Array.isArray(t)&&!t.some((t=>!this.detectVerbCurve(t)))}detectVerbSurfaces(t){return Array.isArray(t)&&!t.some((t=>!this.detectVerbSurface(t)))}detectJscadMesh(t){if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=t;return void 0!==e.sides||void 0!==e.polygons}detectJscadMeshes(t){return Array.isArray(t)&&!t.some((t=>!this.detectJscadMesh(t)))}detectOcctShape(t){return!(!t||"object"!=typeof t)&&"occ-shape"===t.type}detectOcctShapes(t){return Array.isArray(t)&&!t.some((t=>!this.detectOcctShape(t)))}detectManifoldShape(t){return!(!t||"object"!=typeof t)&&"manifold-shape"===t.type}detectManifoldShapes(t){return Array.isArray(t)&&!t.some((t=>!this.detectManifoldShape(t)))}detectTag(t){return!(!t||"object"!=typeof t||Array.isArray(t))&&void 0!==t.text}detectTags(t){return Array.isArray(t)&&!t.some((t=>!this.detectTag(t)))}checkIfElementsInArrayAreNumbers(t){return!t.some((t=>"number"!=typeof t||isNaN(t)))}checkIfElementsInArrayAreArrays(t){return!t.some((t=>!Array.isArray(t)))}arraysInChildrenArraysContainNumbers(t){return!t.some((t=>!this.checkIfElementsInArrayAreNumbers(t)))}arraysInChildrenArraysAreOfLength3(t){return!t.some((t=>3!==t.length))}isValidDrawInput(t){return null!=t&&(!Array.isArray(t)||0!==t.length)}isTagDto(t){return null!=t&&"object"==typeof t&&"text"in t}isTagDtoArray(t){return Array.isArray(t)&&t.length>0&&this.isTagDto(t[0])}}class xy{constructor(t){this.vector=t}computeEdgeMiddlePos(t){let e;if(2===t.vertex_coord.length){const i=t.vertex_coord[0],r=t.vertex_coord[1];e=this.vector.lerp({first:i,second:r,fraction:.5})}else if(3===t.vertex_coord.length)e=t.vertex_coord[1];else{const i=t.vertex_coord[Math.floor(t.vertex_coord.length/2)],r=t.vertex_coord[Math.floor(t.vertex_coord.length/2+1)];e=this.vector.lerp({first:i,second:r,fraction:.5})}return e}computeFaceMiddlePos(t){let e=0,i=0,r=0,n=0;return t.forEach((t=>{e+=t[0],i+=t[1],r+=t[2],n++})),[e/n,i/n,r/n]}resolveColorForEntity(t,e,i,r=F_.colorMapStrategyEnum.lastColorRemainder){if(!Array.isArray(t))return t;if(0===t.length)return"#ff0000";if(1===t.length)return t[0];if(t.length>=i)return t[e];switch(r){case F_.colorMapStrategyEnum.firstColorForAll:return t[0];case F_.colorMapStrategyEnum.lastColorRemainder:return e<t.length?t[e]:t[t.length-1];case F_.colorMapStrategyEnum.repeatColors:return t[e%t.length];case F_.colorMapStrategyEnum.reversedColors:{const i=2*(t.length-1);if(i<=0)return t[0];const r=e%i;return r<t.length?t[r]:t[i-r]}default:return e<t.length?t[e]:t[t.length-1]}}resolveAllColors(t,e,i=F_.colorMapStrategyEnum.lastColorRemainder){const r=[];for(let n=0;n<e;n++)r.push(this.resolveColorForEntity(t,n,e,i));return r}colorToHex(t,e,i){const r=t=>{const e=Math.round(t).toString(16);return 1===e.length?"0"+e:e};return"#"+r(t)+r(e)+r(i)}normalizedColorToHex(t,e,i){return this.colorToHex(255*t,255*e,255*i)}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16)/255,g:parseInt(e[2],16)/255,b:parseInt(e[3],16)/255}:null}normalizeColor(t,e){return t?Array.isArray(t)?t.length<3?(console.warn(`Invalid color array length: ${t.length}, expected at least 3. Using fallback: ${e}`),e):this.normalizedColorToHex(t[0],t[1],t[2]):"string"==typeof t?/^#?[0-9A-F]{6}$/i.test(t)?t.startsWith("#")?t:`#${t}`:(console.warn(`Invalid hex color: ${t}. Using fallback: ${e}`),e):(console.warn(`Unknown color format: ${typeof t}. Using fallback: ${e}`),e):e}getMaterialKey(t,e,i,r=!1){return`${t}-${e.toFixed(4)}-${i}${r?"-unlit":""}`}computePolylineSignature(t){return t.map((t=>t.length)).join(",")}computeArrowHeadLines(t,e,i){if(t.length<2||e<=0)return[];const r=t[t.length-1],n=t[t.length-2],s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2],c=Math.sqrt(s*s+o*o+a*a);if(c<1e-10)return[];const l=s/c,h=o/c,u=a/c,d=i*Math.PI/180,p=Math.cos(d),f=Math.sin(d);let m=0,g=1,v=0;Math.abs(h)>.9&&(m=1,g=0,v=0);let _=h*v-u*g,y=u*m-l*v,x=l*g-h*m;const b=Math.sqrt(_*_+y*y+x*x);_/=b,y/=b,x/=b;let M=h*x-u*y,S=u*_-l*x,w=l*y-h*_;const T=Math.sqrt(M*M+S*S+w*w);M/=T,S/=T,w/=T;const C=e*p,E=e*f,P=[];return P.push([r,[r[0]-l*C+_*E,r[1]-h*C+y*E,r[2]-u*C+x*E]]),P.push([r,[r[0]-l*C-_*E,r[1]-h*C-y*E,r[2]-u*C-x*E]]),P.push([r,[r[0]-l*C+M*E,r[1]-h*C+S*E,r[2]-u*C+w*E]]),P.push([r,[r[0]-l*C-M*E,r[1]-h*C-S*E,r[2]-u*C-w*E]]),P}computeArrowHeadLinesForPolylines(t,e,i){const r=[];for(const n of t){const t=this.computeArrowHeadLines(n,e,i);r.push(...t)}return r}arrowLinesToPolylines(t){return t}processPolylinePoints(t){return t.map((t=>{const e=t.points?[...t.points]:[];return t.isClosed&&e.length>0&&e.push(e[0]),e}))}computeNormals(t,e){const i=t.length/3,r=new Float32Array(t.length);for(let i=0;i<e.length;i+=3){const n=e[i],s=e[i+1],o=e[i+2],a=t[3*n],c=t[3*n+1],l=t[3*n+2],h=t[3*s]-a,u=t[3*s+1]-c,d=t[3*s+2]-l,p=t[3*o]-a,f=t[3*o+1]-c,m=t[3*o+2]-l,g=u*m-d*f,v=d*p-h*m,_=h*f-u*p;r[3*n]+=g,r[3*n+1]+=v,r[3*n+2]+=_,r[3*s]+=g,r[3*s+1]+=v,r[3*s+2]+=_,r[3*o]+=g,r[3*o+1]+=v,r[3*o+2]+=_}for(let t=0;t<i;t++){const e=r[3*t],i=r[3*t+1],n=r[3*t+2],s=Math.sqrt(e*e+i*i+n*n);s>0&&(r[3*t]=e/s,r[3*t+1]=i/s,r[3*t+2]=n/s)}return Array.from(r)}expandToFlatShaded(t,e){const i=[],r=[],n=[];for(let s=0;s<e.length;s+=3){const o=e[s],a=e[s+1],c=e[s+2],l=t[3*o],h=t[3*o+1],u=t[3*o+2],d=t[3*a],p=t[3*a+1],f=t[3*a+2],m=t[3*c],g=t[3*c+1],v=t[3*c+2],_=d-l,y=p-h,x=f-u,b=m-l,M=g-h,S=v-u;let w=y*S-x*M,T=x*b-_*S,C=_*M-y*b;const E=Math.sqrt(w*w+T*T+C*C);E>0&&(w/=E,T/=E,C/=E);const P=i.length/3;i.push(l,h,u),i.push(d,p,f),i.push(m,g,v),r.push(w,T,C),r.push(w,T,C),r.push(w,T,C),n.push(P,P+1,P+2)}return{positions:i,indices:n,normals:r}}prepareBackFaceMeshData(t){const e=[];let i=[];const r=[],n=[];let s=0;if(t.forEach((t=>{if(e.push(...t.positions),t.normals&&t.normals.length>0)for(let e=0;e<t.normals.length;e++)i.push(-t.normals[e]);t.uvs&&n.push(...t.uvs);for(let e=0;e<t.indices.length;e+=3)r.push(t.indices[e]+s,t.indices[e+2]+s,t.indices[e+1]+s);s+=t.positions.length/3})),0===i.length&&e.length>0){const t=this.computeNormals(e,r);i=t}return{positions:e,indices:r,normals:i,uvs:n.length>0?n:void 0}}getDefaultBackFaceColor(){return gy}}var by=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class My{constructor(t){this.jscadWorkerManager=t}intersect(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.intersect",t)}))}subtract(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtract",t)}))}union(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.union",t)}))}intersectTwo(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.intersectTwo",t)}))}subtractTwo(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtractTwo",t)}))}unionTwo(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.unionTwo",t)}))}subtractFrom(t){return by(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("booleans.subtractFrom",t)}))}}var Sy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class wy{constructor(t){this.jscadWorkerManager=t}expand(t){return Sy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("expansions.expand",t)}))}offset(t){return Sy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("expansions.offset",t)}))}}var Ty=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Cy{constructor(t){this.jscadWorkerManager=t}extrudeLinear(t){return Ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeLinear",t)}))}extrudeRectangular(t){return Ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRectangular",t)}))}extrudeRectangularPoints(t){return Ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRectangularPoints",t)}))}extrudeRotate(t){return Ty(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("extrusions.extrudeRotate",t)}))}}var Ey=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Py{constructor(t){this.jscadWorkerManager=t}hullChain(t){return Ey(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("hulls.hullChain",t)}))}hull(t){return Ey(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("hulls.hullChain",t)}))}}var Ay=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Dy{constructor(t){this.jscadWorkerManager=t}createFromPoints(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createFromPoints",t)}))}createPathsFromPoints(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createPathsFromPoints",t)}))}createFromPolyline(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createFromPolyline",t)}))}createEmpty(){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.createEmpty",{})}))}close(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.close",t)}))}appendPoints(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendPoints",t)}))}appendPolyline(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendPolyline",t)}))}appendArc(t){return Ay(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("path.appendArc",t)}))}}var ky=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Ry{constructor(t){this.jscadWorkerManager=t}createFromPoints(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPoints",t)}))}createFromPolyline(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPolyline",t)}))}createFromCurve(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromCurve",t)}))}createFromPath(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.createFromPath",t)}))}circle(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.circle",t)}))}ellipse(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.ellipse",t)}))}rectangle(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.rectangle",t)}))}roundedRectangle(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.roundedRectangle",t)}))}square(t){return ky(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("polygon.square",t)}))}star(t){return ky(this,void 0,void 0,(function*(){return yield this.jscadWorkerManager.genericCallToWorkerPromise("polygon.star",t)}))}}var Iy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Oy{constructor(t){this.jscadWorkerManager=t}cube(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cube",t)}))}cubesOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cubesOnCenterPoints",t)}))}cuboid(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cuboid",t)}))}cuboidsOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cuboidsOnCenterPoints",t)}))}cylinderElliptic(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinderElliptic",t)}))}cylinderEllipticOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinderEllipticOnCenterPoints",t)}))}cylinder(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylinder",t)}))}cylindersOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.cylindersOnCenterPoints",t)}))}ellipsoid(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.ellipsoid",t)}))}ellipsoidsOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.ellipsoidsOnCenterPoints",t)}))}geodesicSphere(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.geodesicSphere",t)}))}geodesicSpheresOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.geodesicSpheresOnCenterPoints",t)}))}roundedCuboid(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCuboid",t)}))}roundedCuboidsOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCuboidsOnCenterPoints",t)}))}roundedCylinder(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCylinder",t)}))}roundedCylindersOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.roundedCylindersOnCenterPoints",t)}))}sphere(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.sphere",t)}))}spheresOnCenterPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.spheresOnCenterPoints",t)}))}torus(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.torus",t)}))}fromPolygonPoints(t){return Iy(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("shapes.fromPolygonPoints",t)}))}}var Ly=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Ny{constructor(t){this.jscadWorkerManager=t}cylindricalText(t){return Ly(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.cylindricalText",t)}))}sphericalText(t){return Ly(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.sphericalText",t)}))}createVectorText(t){return Ly(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("text.createVectorText",t)}))}}class Fy{constructor(t){this.jscadWorkerManager=t}colorize(t){return e=this,i=void 0,n=function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("colors.colorize",t)},new((r=void 0)||(r=Promise))((function(t,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(o,a)}c((n=n.apply(e,i||[])).next())}));var e,i,r,n}}var Uy,Wy,By=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class zy{constructor(t){this.jscadWorkerManager=t,this.booleans=new My(t),this.expansions=new wy(t),this.extrusions=new Cy(t),this.hulls=new Py(t),this.path=new Dy(t),this.polygon=new Ry(t),this.shapes=new Oy(t),this.text=new Ny(t),this.colors=new Fy(t)}toPolygonPoints(t){return By(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("toPolygonPoints",t)}))}transformSolids(t){return By(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("transformSolids",t)}))}transformSolid(t){return By(this,void 0,void 0,(function*(){return this.jscadWorkerManager.genericCallToWorkerPromise("transformSolid",t)}))}downloadSolidSTL(t){return By(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadSolidSTL",t);this.downloadFile(e.blob,t.fileName,"stl")}))}downloadSolidsSTL(t){return By(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadSolidsSTL",t);this.downloadFile(e.blob,t.fileName,"stl")}))}downloadGeometryDxf(t){return By(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadGeometryDxf",t);this.downloadFile(e.blob,t.fileName,"dxf")}))}downloadGeometry3MF(t){return By(this,void 0,void 0,(function*(){const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("downloadGeometry3MF",t);this.downloadFile(e.blob,t.fileName,"3mf")}))}downloadFile(t,e,i){const r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.target="_self",n.download=e+"."+i,n.click(),n.remove()}}(Wy=Uy||(Uy={}))[Wy.loading=0]="loading",Wy[Wy.loaded=1]="loaded",Wy[Wy.initialised=2]="initialised",Wy[Wy.computing=3]="computing";class Vy{constructor(){this.jscadWorkerState$=new d_,this.promisesMade=[]}jscadWorkerAlreadyInitialised(){return!!this.jscadWorker}setJscadWorker(t){this.jscadWorker=t,this.jscadWorker.onmessage=({data:t})=>{if("jscad-initialised"===t)this.jscadWorkerState$.next({state:Uy.initialised});else if("busy"===t)this.jscadWorkerState$.next({state:Uy.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.jscadWorkerState$.next({state:Uy.loaded}):this.jscadWorkerState$.next({state:Uy.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,r={uid:i},n=new Promise(((t,e)=>{r.resolve=t,r.reject=e}));return r.promise=n,this.promisesMade.push(r),this.jscadWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),n}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}var Hy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Gy{constructor(t){this.manifoldWorkerManager=t}manifoldFromMesh(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.manifoldFromMesh",t)}fromPolygonPoints(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.fromPolygonPoints",t)}cube(t){return Hy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.cube",t)}))}sphere(t){return Hy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.sphere",t)}))}tetrahedron(){return Hy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.tetrahedron",{})}))}cylinder(t){return Hy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.shapes.cylinder",t)}))}}var jy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Xy{constructor(t){this.manifoldWorkerManager=t}subtract(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.subtract",t)}))}add(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.add",t)}))}intersect(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersect",t)}))}differenceTwo(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.differenceTwo",t)}))}unionTwo(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.unionTwo",t)}))}intersectionTwo(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersectionTwo",t)}))}difference(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.difference",t)}))}union(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.union",t)}))}intersection(t){return jy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.intersection",t)}))}split(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.split",t)}splitByPlane(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.splitByPlane",t)}splitByPlaneOnOffsets(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.splitByPlaneOnOffsets",t)}trimByPlane(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.booleans.trimByPlane",t)}}var qy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Yy{constructor(t){this.manifoldWorkerManager=t}hull(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.hull",t)}))}hullPoints(t){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.hullPoints",t)}slice(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.slice",t)}))}project(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.project",t)}))}setTolerance(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.setTolerance",t)}))}reserveIds(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.reserveIds",t)}))}asOriginal(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.asOriginal",t)}))}compose(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.compose",t)}))}decompose(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.decompose",t)}))}calculateNormals(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.calculateNormals",t)}))}calculateCurvature(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.calculateCurvature",t)}))}refineToTolerance(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refineToTolerance",t)}))}refineToLength(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refineToLength",t)}))}refine(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.refine",t)}))}smoothOut(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.smoothOut",t)}))}smoothByNormals(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.smoothByNormals",t)}))}simplify(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.simplify",t)}))}setProperties(t){return qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.operations.setProperties",t)}))}}var Zy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Jy{constructor(t){this.manifoldWorkerManager=t}scale3D(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.scale3D",t)}))}scale(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.scale",t)}))}mirror(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.mirror",t)}))}translate(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translate",t)}))}translateByVectors(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translateByVectors",t)}))}translateXYZ(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.translateXYZ",t)}))}rotate(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.rotate",t)}))}rotateXYZ(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.rotateXYZ",t)}))}transform(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.transform",t)}))}transforms(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.transforms",t)}))}warp(t){return Zy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.transforms.warp",t)}))}}var Ky=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class $y{constructor(t){this.manifoldWorkerManager=t}surfaceArea(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.surfaceArea",t)}))}volume(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.volume",t)}))}isEmpty(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.isEmpty",t)}))}numVert(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numVert",t)}))}numTri(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numTri",t)}))}numEdge(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numEdge",t)}))}numProp(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numProp",t)}))}numPropVert(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.numPropVert",t)}))}boundingBox(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.boundingBox",t)}))}tolerance(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.tolerance",t)}))}genus(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.genus",t)}))}minGap(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.minGap",t)}))}originalID(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.originalID",t)}))}status(t){return Ky(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.evaluate.status",t)}))}}var Qy=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class tx{constructor(t){this.manifoldWorkerManager=t,this.shapes=new Gy(t),this.booleans=new Xy(t),this.operations=new Yy(t),this.transforms=new Jy(t),this.evaluate=new $y(t)}manifoldToMesh(t){return Qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.manifoldToMesh",t)}))}manifoldsToMeshes(t){return Qy(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifold.manifoldsToMeshes",t)}))}}var ex=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class ix{constructor(t){this.manifoldWorkerManager=t}hull(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.hull",t)}))}extrude(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.extrude",t)}))}revolve(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.revolve",t)}))}offset(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.offset",t)}))}simplify(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.simplify",t)}))}compose(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.compose",t)}))}decompose(t){return ex(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.operations.decompose",t)}))}}var rx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class nx{constructor(t){this.manifoldWorkerManager=t}create(t){return rx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.create",t)}))}square(t){return rx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.square",t)}))}circle(t){return rx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.circle",t)}))}rectangle(t){return rx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.shapes.rectangle",t)}))}}var sx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class ox{constructor(t){this.manifoldWorkerManager=t}scale2D(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.scale2D",t)}))}scale(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.scale",t)}))}mirror(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.mirror",t)}))}translate(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.translate",t)}))}translateXY(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.translateXY",t)}))}rotate(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.rotate",t)}))}transform(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.transform",t)}))}warp(t){return sx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.transforms.warp",t)}))}}var ax=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class cx{constructor(t){this.manifoldWorkerManager=t}subtract(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.subtract",t)}))}add(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.add",t)}))}intersect(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersect",t)}))}differenceTwo(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.differenceTwo",t)}))}unionTwo(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.unionTwo",t)}))}intersectionTwo(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersectionTwo",t)}))}difference(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.difference",t)}))}union(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.union",t)}))}intersection(t){return ax(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.booleans.intersection",t)}))}}var lx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class hx{constructor(t){this.manifoldWorkerManager=t}area(t){return lx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.area",t)}))}isEmpty(t){return lx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.isEmpty",t)}))}numVert(t){return lx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.numVert",t)}))}numContour(t){return lx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.numContour",t)}))}bounds(t){return lx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.evaluate.bounds",t)}))}}var ux=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class dx{constructor(t){this.manifoldWorkerManager=t,this.shapes=new nx(t),this.operations=new ix(t),this.booleans=new cx(t),this.transforms=new ox(t),this.evaluate=new hx(t)}crossSectionFromPoints(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionFromPoints",t)}))}crossSectionFromPolygons(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionFromPolygons",t)}))}crossSectionToPolygons(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionToPolygons",t)}))}crossSectionToPoints(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionToPoints",t)}))}crossSectionsToPolygons(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionsToPolygons",t)}))}crossSectionsToPoints(t){return ux(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("crossSection.crossSectionsToPoints",t)}))}}class px{constructor(t){this.manifoldWorkerManager=t}merge(t){return e=this,i=void 0,n=function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.operations.merge",t)},new((r=void 0)||(r=Promise))((function(t,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(o,a)}c((n=n.apply(e,i||[])).next())}));var e,i,r,n}}var fx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class mx{constructor(t){this.manifoldWorkerManager=t}position(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.position",t)}))}verts(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.verts",t)}))}tangent(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.tangent",t)}))}extras(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.extras",t)}))}transform(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.transform",t)}))}numProp(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numProp",t)}))}numVert(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numVert",t)}))}numTri(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numTri",t)}))}numRun(t){return fx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("mesh.evaluate.numRun",t)}))}}class gx{constructor(t){this.manifoldWorkerManager=t,this.operations=new px(t),this.evaluate=new mx(t)}}var vx,_x,yx,xx,bx,Mx,Sx,wx,Tx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Cx{constructor(t){this.manifoldWorkerManager=t,this.manifold=new tx(t),this.crossSection=new dx(t),this.mesh=new gx(t)}manifoldToMeshPointer(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("manifoldToMeshPointer",t)}))}decomposeManifoldOrCrossSection(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldOrCrossSection",t)}))}toPolygonPoints(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("toPolygonPoints",t)}))}decomposeManifoldsOrCrossSections(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldsOrCrossSections",t)}))}deleteManifoldOrCrossSection(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("deleteManifoldOrCrossSection",t)}))}deleteManifoldsOrCrossSections(t){return Tx(this,void 0,void 0,(function*(){return this.manifoldWorkerManager.genericCallToWorkerPromise("deleteManifoldsOrCrossSections",t)}))}}(_x=vx||(vx={}))[_x.loading=0]="loading",_x[_x.loaded=1]="loaded",_x[_x.initialised=2]="initialised",_x[_x.computing=3]="computing";class Ex{constructor(){this.manifoldWorkerState$=new d_,this.promisesMade=[]}manifoldWorkerAlreadyInitialised(){return!!this.manifoldWorker}setManifoldWorker(t){this.manifoldWorker=t,this.manifoldWorker.onmessage=({data:t})=>{if("manifold-initialised"===t)this.manifoldWorkerState$.next({state:vx.initialised});else if("busy"===t)this.manifoldWorkerState$.next({state:vx.computing});else{const e=this.promisesMade.find((e=>e.uid===t.uid));e&&void 0!==t.result&&!t.error?e.resolve(t.result):t.error&&(this.errorCallback&&this.errorCallback(t.error),e.reject(t.error)),this.promisesMade=this.promisesMade.filter((e=>e.uid!==t.uid)),0===this.promisesMade.length?this.manifoldWorkerState$.next({state:vx.loaded}):this.manifoldWorkerState$.next({state:vx.computing})}}}cleanPromisesMade(){this.promisesMade=[]}genericCallToWorkerPromise(t,e){const i=`call${Math.random()}${Date.now()}`,r={uid:i},n=new Promise(((t,e)=>{r.resolve=t,r.reject=e}));return r.promise=n,this.promisesMade.push(r),this.manifoldWorker.postMessage({action:{functionName:t,inputs:e},uid:i}),n}startedTheRun(){return this.genericCallToWorkerPromise("startedTheRun",{})}cleanAllCache(){return this.genericCallToWorkerPromise("cleanAllCache",{})}}(wx=yx||(yx={})).horizontalAlignEnum=F_.horizontalAlignEnum,wx.verticalAlignmentEnum=F_.verticalAlignmentEnum,wx.topBottomEnum=F_.topBottomEnum,wx.basicAlignmentEnum=F_.basicAlignmentEnum,wx.colorMapStrategyEnum=F_.colorMapStrategyEnum,function(t){let e,i,r;t.DrawAny=class{constructor(t,e){void 0!==t&&(this.entity=t),void 0!==e&&(this.options=e)}},t.DrawManifoldOrCrossSectionOptions=class{constructor(t,e,i,r,n,s,o,a,c,l){this.faceOpacity=1,this.faceColour="#ff0000",this.crossSectionColour="#ff00ff",this.crossSectionWidth=2,this.computeNormals=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,void 0!==t&&(this.faceOpacity=t),void 0!==e&&(this.faceMaterial=e),void 0!==i&&(this.faceColour=i),void 0!==r&&(this.crossSectionColour=r),void 0!==n&&(this.crossSectionWidth=n),void 0!==s&&(this.crossSectionOpacity=s),void 0!==o&&(this.computeNormals=o),void 0!==a&&(this.drawTwoSided=a),void 0!==c&&(this.backFaceColour=c),void 0!==l&&(this.backFaceOpacity=l)}},t.DrawOcctShapeOptions=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b,M){this.faceOpacity=1,this.edgeOpacity=1,this.edgeColour="#ffffff",this.faceColour="#ff0000",this.vertexColour="#ffaaff",this.edgeWidth=2,this.vertexSize=.03,this.drawEdges=!0,this.drawFaces=!0,this.drawVertices=!1,this.precision=.01,this.drawEdgeIndexes=!1,this.edgeIndexHeight=.06,this.edgeIndexColour="#ff00ff",this.drawFaceIndexes=!1,this.faceIndexHeight=.06,this.faceIndexColour="#0000ff",this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,this.edgeArrowSize=0,this.edgeArrowAngle=15,void 0!==t&&(this.faceOpacity=t),void 0!==e&&(this.edgeOpacity=e),void 0!==i&&(this.edgeColour=i),void 0!==r&&(this.faceMaterial=r),void 0!==n&&(this.faceColour=n),void 0!==l&&(this.vertexColour=l),void 0!==h&&(this.vertexSize=h),void 0!==s&&(this.edgeWidth=s),void 0!==o&&(this.drawEdges=o),void 0!==a&&(this.drawFaces=a),void 0!==c&&(this.drawVertices=c),void 0!==u&&(this.precision=u),void 0!==d&&(this.drawEdgeIndexes=d),void 0!==p&&(this.edgeIndexHeight=p),void 0!==f&&(this.edgeIndexColour=f),void 0!==m&&(this.drawFaceIndexes=m),void 0!==g&&(this.faceIndexHeight=g),void 0!==v&&(this.faceIndexColour=v),void 0!==_&&(this.drawTwoSided=_),void 0!==y&&(this.backFaceColour=y),void 0!==x&&(this.backFaceOpacity=x),void 0!==b&&(this.edgeArrowSize=b),void 0!==M&&(this.edgeArrowAngle=M)}},t.DrawBasicGeometryOptions=class{constructor(t,e,i,r,n,s,o,a,c,l,h){this.colours="#ff0000",this.colorMapStrategy=yx.colorMapStrategyEnum.lastColorRemainder,this.size=1,this.opacity=1,this.updatable=!1,this.hidden=!1,this.drawTwoSided=!0,this.backFaceColour="#0000ff",this.backFaceOpacity=1,this.arrowSize=0,this.arrowAngle=15,void 0!==t&&(this.colours=t),void 0!==e&&(this.size=e),void 0!==i&&(this.opacity=i),void 0!==r&&(this.updatable=r),void 0!==n&&(this.hidden=n),void 0!==s&&(this.drawTwoSided=s),void 0!==o&&(this.backFaceColour=o),void 0!==a&&(this.backFaceOpacity=a),void 0!==c&&(this.colorMapStrategy=c),void 0!==l&&(this.arrowSize=l),void 0!==h&&(this.arrowAngle=h)}},function(t){t.nearest="nearest",t.bilinear="bilinear",t.trilinear="trilinear"}(e=t.samplingModeEnum||(t.samplingModeEnum={})),t.GenericTextureDto=class{constructor(t,i,r,n,s,o,a,c,l,h){this.name="Texture",this.uScale=1,this.vScale=1,this.uOffset=0,this.vOffset=0,this.wAng=0,this.invertY=!1,this.invertZ=!1,this.samplingMode=e.nearest,void 0!==t&&(this.url=t),void 0!==i&&(this.name=i),void 0!==r&&(this.uScale=r),void 0!==n&&(this.vScale=n),void 0!==s&&(this.uOffset=s),void 0!==o&&(this.vOffset=o),void 0!==a&&(this.wAng=a),void 0!==c&&(this.invertY=c),void 0!==l&&(this.invertZ=l),void 0!==h&&(this.samplingMode=h)}},function(t){t.opaque="opaque",t.mask="mask",t.blend="blend"}(i=t.alphaModeEnum||(t.alphaModeEnum={})),t.GenericPBRMaterialDto=class{constructor(t,e,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y){this.name="PBRMaterial",this.baseColor="#0000ff",this.metallic=.5,this.roughness=.5,this.alpha=1,this.emissiveColor="#000000",this.emissiveIntensity=1,this.zOffset=0,this.zOffsetUnits=0,this.alphaMode=i.opaque,this.alphaCutoff=.5,this.doubleSided=!1,this.wireframe=!1,this.unlit=!1,void 0!==t&&(this.name=t),void 0!==e&&(this.baseColor=e),void 0!==r&&(this.metallic=r),void 0!==n&&(this.roughness=n),void 0!==s&&(this.alpha=s),void 0!==o&&(this.emissiveColor=o),void 0!==a&&(this.emissiveIntensity=a),void 0!==c&&(this.zOffset=c),void 0!==l&&(this.zOffsetUnits=l),void 0!==h&&(this.baseColorTexture=h),void 0!==u&&(this.metallicRoughnessTexture=u),void 0!==d&&(this.normalTexture=d),void 0!==p&&(this.emissiveTexture=p),void 0!==f&&(this.occlusionTexture=f),void 0!==m&&(this.alphaMode=m),void 0!==g&&(this.alphaCutoff=g),void 0!==v&&(this.doubleSided=v),void 0!==_&&(this.wireframe=_),void 0!==y&&(this.unlit=y)}},function(t){t[t.point=0]="point",t[t.points=1]="points",t[t.line=2]="line",t[t.lines=3]="lines",t[t.node=4]="node",t[t.nodes=5]="nodes",t[t.polyline=6]="polyline",t[t.polylines=7]="polylines",t[t.verbCurve=8]="verbCurve",t[t.verbCurves=9]="verbCurves",t[t.verbSurface=10]="verbSurface",t[t.verbSurfaces=11]="verbSurfaces",t[t.jscadMesh=12]="jscadMesh",t[t.jscadMeshes=13]="jscadMeshes",t[t.occt=14]="occt",t[t.occtShapes=15]="occtShapes",t[t.tag=16]="tag",t[t.tags=17]="tags"}(r=t.drawingTypes||(t.drawingTypes={}))}(xx||(xx={})),(Sx=bx||(bx={})).OrbitCameraDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f){this.pivotPoint=[0,0,0],this.distance=20,this.pitch=30,this.yaw=45,this.distanceMin=.1,this.distanceMax=1e3,this.pitchAngleMin=-90,this.pitchAngleMax=90,this.orbitSensitivity=.3,this.distanceSensitivity=.15,this.panSensitivity=1,this.inertiaFactor=.1,this.autoRender=!0,this.frameOnStart=!0,this.enableDamping=!0,this.dampingFactor=.1,void 0!==t&&(this.distance=t),void 0!==e&&(this.pitch=e),void 0!==i&&(this.yaw=i),void 0!==r&&(this.distanceMin=r),void 0!==n&&(this.distanceMax=n),void 0!==s&&(this.pitchAngleMin=s),void 0!==o&&(this.pitchAngleMax=o),void 0!==a&&(this.orbitSensitivity=a),void 0!==c&&(this.distanceSensitivity=c),void 0!==l&&(this.panSensitivity=l),void 0!==h&&(this.inertiaFactor=h),void 0!==u&&(this.autoRender=u),void 0!==d&&(this.frameOnStart=d),void 0!==p&&(this.enableDamping=p),void 0!==f&&(this.dampingFactor=f)}},Sx.CameraDto=class{constructor(t){void 0!==t&&(this.camera=t)}},Sx.PositionDto=class{constructor(t,e){this.position=[0,0,0],void 0!==t&&(this.camera=t),void 0!==e&&(this.position=e)}},Sx.PivotPointDto=class{constructor(t,e){this.pivotPoint=[0,0,0],void 0!==t&&(this.orbitCamera=t),void 0!==e&&(this.pivotPoint=e)}},Sx.FocusObjectDto=class{constructor(t,e,i){this.padding=1.5,void 0!==t&&(this.orbitCamera=t),void 0!==e&&(this.object=e),void 0!==i&&(this.padding=i)}},Sx.ResetCameraDto=class{constructor(t,e,i,r){this.yaw=45,this.pitch=30,this.distance=20,void 0!==t&&(this.orbitCamera=t),void 0!==e&&(this.yaw=e),void 0!==i&&(this.pitch=i),void 0!==r&&(this.distance=r)}},Sx.OrbitCameraControllerDto=class{constructor(t){void 0!==t&&(this.orbitCamera=t)}},Sx.SetDistanceLimitsDto=class{constructor(t,e,i){this.min=.1,this.max=1e3,void 0!==t&&(this.orbitCamera=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},Sx.SetPitchLimitsDto=class{constructor(t,e,i){this.min=-90,this.max=90,void 0!==t&&(this.orbitCamera=t),void 0!==e&&(this.min=e),void 0!==i&&(this.max=i)}},(Mx||(Mx={})).InitThreeJSDto=class{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f){this.sceneSize=20,this.backgroundColor="#1a1c1f",this.enableShadows=!0,this.enableGround=!0,this.groundCenter=[0,0,0],this.groundScaleFactor=2,this.groundColor="#333333",this.groundOpacity=1,this.hemisphereLightSkyColor="#ffffff",this.hemisphereLightGroundColor="#444444",this.hemisphereLightIntensity=1,this.directionalLightColor="#ffffff",this.directionalLightIntensity=1.5,this.shadowMapSize=2048,this.enableOrbitCamera=!0,void 0!==t&&(this.canvasId=t),void 0!==e&&(this.sceneSize=e),void 0!==i&&(this.backgroundColor=i),void 0!==r&&(this.enableShadows=r),void 0!==n&&(this.enableGround=n),void 0!==s&&(this.groundCenter=s),void 0!==o&&(this.groundScaleFactor=o),void 0!==a&&(this.groundColor=a),void 0!==c&&(this.groundOpacity=c),void 0!==l&&(this.hemisphereLightSkyColor=l),void 0!==h&&(this.hemisphereLightGroundColor=h),void 0!==u&&(this.hemisphereLightIntensity=u),void 0!==d&&(this.directionalLightColor=d),void 0!==p&&(this.directionalLightIntensity=p),void 0!==f&&(this.shadowMapSize=f)}};var Px=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Ax extends yy{constructor(t,e,i){super(),this.drawHelper=t,this.context=e,this.tag=i,this.defaultBasicOptions=new xx.DrawBasicGeometryOptions,this.defaultPolylineOptions=Object.assign(Object.assign({},new xx.DrawBasicGeometryOptions),{size:2,colours:"#ff00ff"})}drawAnyAsync(t){return Px(this,void 0,void 0,(function*(){const e=t.entity;return void 0===e||Array.isArray(e)&&0===e.length?Promise.resolve(void 0):this.detectJscadMesh(e)?this.handleJscadMesh(t):this.detectOcctShape(e)?this.handleOcctShape(t):this.detectOcctShapes(e)?this.handleOcctShapes(t):this.detectJscadMeshes(e)?this.handleJscadMeshes(t):this.detectManifoldShape(e)?this.handleManifoldShape(t):this.detectManifoldShapes(e)?this.handleManifoldShapes(t):Promise.resolve(this.drawAny(t))}))}drawAny(t){let e;const i=t.entity;return t.group||t.entity instanceof ua?e=this.updateAny(t):this.detectLine(i)?e=this.handleLine(t):this.detectPoint(i)?e=this.handlePoint(t):this.detectPolyline(i)?e=this.handlePolyline(t):this.detectVerbCurve(i)?e=this.handleVerbCurve(t):this.detectVerbSurface(i)?e=this.handleVerbSurface(t):this.detectPolylines(i)?e=this.handlePolylines(t):this.detectLines(i)?e=this.handleLines(t):this.detectPoints(i)?e=this.handlePoints(t):this.detectVerbCurves(i)?e=this.handleVerbCurves(t):this.detectVerbSurfaces(i)?e=this.handleVerbSurfaces(t):this.detectTag(i)?e=this.handleTag(t):this.detectTags(i)&&(e=this.handleTags(t)),e}optionsSimple(t){return t}optionsOcctShape(t){return t}createTexture(t){const e=(new ku).load(t.url);switch(e.name=t.name,e.repeat.set(t.uScale,t.vScale),e.offset.set(t.uOffset,t.vOffset),e.rotation=t.wAng,e.flipY=!t.invertY,e.wrapS=oe,e.wrapT=oe,t.samplingMode){case xx.samplingModeEnum.nearest:e.minFilter=le,e.magFilter=le;break;case xx.samplingModeEnum.bilinear:e.minFilter=fe,e.magFilter=fe;break;case xx.samplingModeEnum.trilinear:e.minFilter=ve,e.magFilter=fe}return e}createPBRMaterial(t){const e=new Hh({name:t.name,color:new so(t.baseColor),metalness:t.metallic,roughness:t.roughness,opacity:t.alpha,transparent:t.alpha<1||t.alphaMode===xx.alphaModeEnum.blend,side:t.doubleSided?ot:nt,wireframe:t.wireframe});switch(t.emissiveColor&&(e.emissive=new so(t.emissiveColor),e.emissiveIntensity=t.emissiveIntensity),0===t.zOffset&&0===t.zOffsetUnits||(e.polygonOffset=!0,e.polygonOffsetFactor=t.zOffset,e.polygonOffsetUnits=t.zOffsetUnits),t.baseColorTexture&&(e.map=t.baseColorTexture),t.metallicRoughnessTexture&&(e.metalnessMap=t.metallicRoughnessTexture,e.roughnessMap=t.metallicRoughnessTexture),t.normalTexture&&(e.normalMap=t.normalTexture),t.emissiveTexture&&(e.emissiveMap=t.emissiveTexture),t.occlusionTexture&&(e.aoMap=t.occlusionTexture),t.alphaMode){case xx.alphaModeEnum.opaque:e.transparent=!1,e.alphaTest=0;break;case xx.alphaModeEnum.mask:e.transparent=!1,e.alphaTest=t.alphaCutoff;break;case xx.alphaModeEnum.blend:e.transparent=!0,e.alphaTest=0}return t.unlit&&(e.emissive=new so(t.baseColor),e.emissiveIntensity=1,e.color=new so(0)),e}handleJscadMesh(t){return this.handleAsync(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSolidOrPolygonMesh(Object.assign({jscadMesh:t.group,mesh:t.entity},e))),xx.drawingTypes.jscadMesh)}handleJscadMeshes(t){return this.handleAsync(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSolidOrPolygonMeshes(Object.assign({jscadMesh:t.group,meshes:t.entity},e))),xx.drawingTypes.jscadMeshes)}handleManifoldShape(t){return this.handleAsync(t,new W_.DrawManifoldOrCrossSectionDto(t.entity),(e=>this.drawHelper.drawManifoldOrCrossSection(Object.assign(Object.assign({manifoldOrCrossSection:t.entity},new xx.DrawManifoldOrCrossSectionOptions),e))),xx.drawingTypes.occt)}handleManifoldShapes(t){return this.handleAsync(t,new W_.DrawManifoldOrCrossSectionDto(t.entity),(e=>this.drawHelper.drawManifoldsOrCrossSections(Object.assign(Object.assign({manifoldsOrCrossSections:t.entity},new xx.DrawManifoldOrCrossSectionOptions),e))),xx.drawingTypes.occt)}handleOcctShape(t){return this.handleAsync(t,new xx.DrawOcctShapeOptions,(e=>this.drawHelper.drawShape(Object.assign(Object.assign({shape:t.entity},new xx.DrawOcctShapeOptions),e))),xx.drawingTypes.occt)}handleOcctShapes(t){return this.handleAsync(t,new xx.DrawOcctShapeOptions,(e=>this.drawHelper.drawShapes(Object.assign(Object.assign({shapes:t.entity},new xx.DrawOcctShapeOptions),e))),xx.drawingTypes.occtShapes)}handleLine(t){return this.handle(t,this.defaultPolylineOptions,(e=>{const i=t.entity,r=[];return i&&i.start?r.push(i.start,i.end):r.push(...i),this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:[{points:r}]},e))}),xx.drawingTypes.line)}handlePoint(t){return this.handle(t,this.defaultBasicOptions,(e=>this.drawHelper.drawPoint(Object.assign({pointMesh:t.group,point:t.entity},e))),xx.drawingTypes.point)}handlePolyline(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPolylineClose(Object.assign({polylineMesh:t.group,polyline:t.entity},e))),xx.drawingTypes.polyline)}handleVerbCurve(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawCurve(Object.assign({curveMesh:t.group,curve:t.entity},e))),xx.drawingTypes.verbCurve)}handleVerbSurface(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawSurface(Object.assign({surfaceMesh:t.group,surface:t.entity},e))),xx.drawingTypes.verbSurface)}handlePolylines(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:t.entity},e))),xx.drawingTypes.polylines)}handleLines(t){return this.handle(t,this.defaultPolylineOptions,(e=>{const i=t.entity,r=[];return i&&i[0]&&i[0].start?i.forEach((t=>{r.push([t.start,t.end])})):i.forEach((t=>{r.push(t)})),this.drawHelper.drawPolylinesWithColours(Object.assign({polylinesMesh:t.group,polylines:r.map((t=>({points:[...t]})))},e))}),xx.drawingTypes.lines)}handlePoints(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawPoints(Object.assign({pointsMesh:t.group,points:t.entity},e))),xx.drawingTypes.points)}handleVerbCurves(t){return this.handle(t,this.defaultPolylineOptions,(e=>this.drawHelper.drawCurves(Object.assign({curvesMesh:t.group,curves:t.entity},e))),xx.drawingTypes.verbCurves)}handleVerbSurfaces(t){return this.handle(t,this.defaultBasicOptions,(e=>this.drawHelper.drawSurfacesMultiColour(Object.assign({surfacesMesh:t.group,surfaces:t.entity},e))),xx.drawingTypes.verbSurfaces)}handleTag(t){const e=t.options?t.options:{updatable:!1},i=this.tag.drawTag(Object.assign({tagVariable:t.group,tag:t.entity},e));return i.userData={type:xx.drawingTypes.tag,options:e},i}handleTags(t){const e=t.options?t.options:{updatable:!1},i=this.tag.drawTags(Object.assign({tagsVariable:t.group,tags:t.entity},e));return i.userData={type:xx.drawingTypes.tags,options:e},i}updateAny(t){let e;if(t.group&&t.group.userData)switch(t.group.userData.type){case xx.drawingTypes.point:e=this.handlePoint(t);break;case xx.drawingTypes.points:e=this.handlePoints(t);break;case xx.drawingTypes.line:e=this.handleLine(t);break;case xx.drawingTypes.lines:e=this.handleLines(t);break;case xx.drawingTypes.polyline:e=this.handlePolyline(t);break;case xx.drawingTypes.polylines:e=this.handlePolylines(t);break;case xx.drawingTypes.verbCurve:e=this.handleVerbCurve(t);break;case xx.drawingTypes.verbCurves:e=this.handleVerbCurves(t);break;case xx.drawingTypes.verbSurface:e=this.handleVerbSurface(t);break;case xx.drawingTypes.verbSurfaces:e=this.handleVerbSurfaces(t);break;case xx.drawingTypes.tag:e=this.handleTag(t);break;case xx.drawingTypes.tags:e=this.handleTags(t)}return e}handle(t,e,i,r){let n=t.options?t.options:e;!t.options&&t.group&&t.group.userData.options&&(n=t.group.userData.options);const s=i(n);return this.applyGlobalSettingsAndMetadataAndShadowCasting(r,n,s),s}handleAsync(t,e,i,r){return Px(this,void 0,void 0,(function*(){let n=t.options?t.options:e;return!t.options&&t.group&&t.group.userData.options&&(n=t.group.userData.options),i(n).then((t=>(this.applyGlobalSettingsAndMetadataAndShadowCasting(r,n,t),t)))}))}applyGlobalSettingsAndMetadataAndShadowCasting(t,e,i){if(i){const r={type:t,options:e};i.userData=i.userData?Object.assign(Object.assign({},i.userData),r):r}}}const Dx=Math.PI/180,kx=180/Math.PI;class Rx{constructor(t){this.context=t}create(t){if(!this.context.scene)throw new Error("Scene not initialized. Ensure context.scene is set first.");const e="undefined"!=typeof window?window.innerWidth/window.innerHeight:1,i=new oa(50,e,.1,1e4),r=this.createOrbitCameraInstance(i,{autoRender:t.autoRender,distanceMax:t.distanceMax,distanceMin:t.distanceMin,pitchAngleMax:t.pitchAngleMax,pitchAngleMin:t.pitchAngleMin,inertiaFactor:t.inertiaFactor,enableDamping:t.enableDamping,dampingFactor:t.dampingFactor,focusObject:t.focusObject||null,frameOnStart:t.frameOnStart}),n=new fn(t.pivotPoint[0],t.pivotPoint[1],t.pivotPoint[2]);r.pivotPoint=n,r.distance=t.distance,r.pitch=t.pitch,r.yaw=t.yaw,r.initializePivotPoint(n);const s=t.domElement||document.body,o=this.createMouseInput(i,r,s,{orbitSensitivity:t.orbitSensitivity,distanceSensitivity:t.distanceSensitivity,panSensitivity:t.panSensitivity}),a=this.createTouchInput(i,r,s,{orbitSensitivity:t.orbitSensitivity,distanceSensitivity:t.distanceSensitivity,panSensitivity:t.panSensitivity}),c=this.createKeyboardInput(r);return t.focusObject&&t.frameOnStart&&r.focus(t.focusObject),{orbitCamera:r,camera:i,mouseInput:o,touchInput:a,keyboardInput:c,update:t=>{r.update(t)},destroy:()=>{null==o||o.destroy(),null==a||a.destroy(),null==c||c.destroy()}}}setPivotPoint(t){const e=new fn(t.pivotPoint[0],t.pivotPoint[1],t.pivotPoint[2]);t.orbitCamera.orbitCamera.pivotPoint=e}getPivotPoint(t){const e=t.orbitCamera.orbitCamera.pivotPoint;return[e.x,e.y,e.z]}focusOnObject(t){t.orbitCamera.orbitCamera.focus(t.object,t.padding)}resetCamera(t){t.orbitCamera.orbitCamera.reset(t.yaw,t.pitch,t.distance)}getDistance(t){return t.orbitCamera.orbitCamera.distance}setDistance(t){t.orbitCamera.orbitCamera.distance=t.distance}getYaw(t){return t.orbitCamera.orbitCamera.yaw}getPitch(t){return t.orbitCamera.orbitCamera.pitch}setDistanceLimits(t){t.orbitCamera.orbitCamera.distanceMin=t.min,t.orbitCamera.orbitCamera.distanceMax=t.max}setPitchLimits(t){t.orbitCamera.orbitCamera.pitchAngleMin=t.min,t.orbitCamera.orbitCamera.pitchAngleMax=t.max}createOrbitCameraInstance(t,e){const i={_modelsAabb:new Bn,_pivotPoint:new fn,_targetPivotPoint:new fn,_lastFramePivotPoint:new fn,_yaw:0,_pitch:0,_distance:0,_targetYaw:0,_targetPitch:0,_targetDistance:0,_autoRenderDefault:!0},r=new fn,n=()=>{const e=(90-i._pitch)*Dx,r=i._yaw*Dx,n=Math.sin(e),s=Math.cos(e),o=Math.sin(r),a=Math.cos(r),c=i._distance*n*o,l=i._distance*s,h=i._distance*n*a;t.position.set(i._pivotPoint.x+c,i._pivotPoint.y+l,i._pivotPoint.z+h),t.lookAt(i._pivotPoint)},s=()=>{i._yaw=i._targetYaw,i._pitch=i._targetPitch,i._distance=i._targetDistance,i._pivotPoint.copy(i._targetPivotPoint)},o=t=>{i._modelsAabb.setFromObject(t)},a=(t,e,i)=>t+(e-t)*i;return{autoRender:e.autoRender,distanceMax:e.distanceMax,distanceMin:e.distanceMin,pitchAngleMax:e.pitchAngleMax,pitchAngleMin:e.pitchAngleMin,inertiaFactor:e.inertiaFactor,enableDamping:e.enableDamping,dampingFactor:e.dampingFactor,focusObject:e.focusObject,frameOnStart:e.frameOnStart,get distance(){return i._targetDistance},set distance(t){i._targetDistance=Math.max(this.distanceMin,Math.min(this.distanceMax,t))},get pitch(){return i._targetPitch},set pitch(t){const e=Math.max(this.pitchAngleMin,-89.9),r=Math.min(this.pitchAngleMax,89.9);i._targetPitch=Math.max(e,Math.min(r,t))},get yaw(){return i._targetYaw},set yaw(t){i._targetYaw=t;const e=(i._targetYaw-i._yaw)%360;e>180?i._yaw+=360:e<-180&&(i._yaw-=360)},get pivotPoint(){return i._targetPivotPoint},set pivotPoint(t){i._targetPivotPoint.copy(t)},focus(e,r=1.5){if(o(e),i._modelsAabb.isEmpty())return;const a=new fn;i._modelsAabb.getCenter(a);const c=new fn;i._modelsAabb.getSize(c);const l=Math.max(c.x,c.y,c.z),h=t.fov*Dx;let u=l/(2*Math.tan(h/2));u*=r,this.distance=u,i._targetPivotPoint.copy(a),s(),n()},resetAndLookAtPoint(e,o){i._targetPivotPoint.copy(o),t.position.copy(e),t.lookAt(o),r.subVectors(o,e),this.distance=r.length();const a=new fn;a.subVectors(e,o).normalize(),this.yaw=Math.atan2(a.x,a.z)*kx,this.pitch=Math.asin(a.y)*kx,s(),n()},resetAndLookAtObject(t,e){o(e);const r=new fn;i._modelsAabb.getCenter(r),this.resetAndLookAtPoint(t,r)},reset(t,e,i){this.pitch=e,this.yaw=t,this.distance=i,s(),n()},update(t){const r=e.enableDamping?0===e.dampingFactor?1:Math.min(t/(e.inertiaFactor||.1),1):1;i._distance=a(i._distance,i._targetDistance,r),i._yaw=a(i._yaw,i._targetYaw,r),i._pitch=a(i._pitch,i._targetPitch,r),i._pivotPoint.lerp(i._targetPivotPoint,r),n()},initializePivotPoint(t){i._pivotPoint.copy(t)}}}createMouseInput(t,e,i,r){let n=!1,s=!1,o=0,a=0;const c=new fn,l=t=>{switch(t.preventDefault(),t.button){case 0:n=!0;break;case 1:case 2:s=!0}o=t.clientX,a=t.clientY},h=t=>{switch(t.button){case 0:n=!1;break;case 1:case 2:s=!1}},u=i=>{const l=i.clientX-o,h=i.clientY-a;n?(e.pitch+=h*r.orbitSensitivity,e.yaw-=l*r.orbitSensitivity):s&&((i,n)=>{const s=new fn,o=new fn;t.matrix.extractBasis(s,o,new fn);const a=.001*e.distance*r.panSensitivity;c.set(0,0,0),c.addScaledVector(s,-i*a),c.addScaledVector(o,n*a),e.pivotPoint.add(c)})(l,h),o=i.clientX,a=i.clientY},d=t=>{t.preventDefault();const i=t.deltaY>0?1:-1;e.distance+=i*r.distanceSensitivity*e.distance*.1},p=()=>{n=!1,s=!1},f=t=>{t.preventDefault()};return i.addEventListener("mousedown",l),i.addEventListener("mouseup",h),i.addEventListener("mousemove",u),i.addEventListener("wheel",d,{passive:!1}),i.addEventListener("mouseout",p),i.addEventListener("contextmenu",f),{destroy:()=>{i.removeEventListener("mousedown",l),i.removeEventListener("mouseup",h),i.removeEventListener("mousemove",u),i.removeEventListener("wheel",d),i.removeEventListener("mouseout",p),i.removeEventListener("contextmenu",f)}}}createTouchInput(t,e,i,r){let n=0,s=0,o=0,a=0,c=0;const l=new fn,h=(t,e)=>{const i=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(i*i+r*r)},u=(t,e)=>({x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}),d=t=>{t.preventDefault();const e=t.touches;if(1===e.length)n=e[0].clientX,s=e[0].clientY;else if(2===e.length){o=h(e[0],e[1]);const t=u(e[0],e[1]);a=t.x,c=t.y}},p=t=>{const e=t.touches;if(1===e.length)n=e[0].clientX,s=e[0].clientY;else if(2===e.length){o=h(e[0],e[1]);const t=u(e[0],e[1]);a=t.x,c=t.y}},f=i=>{i.preventDefault();const d=i.touches;if(1===d.length){const t=d[0].clientX-n,i=d[0].clientY-s;e.pitch+=i*r.orbitSensitivity,e.yaw-=t*r.orbitSensitivity,n=d[0].clientX,s=d[0].clientY}else if(2===d.length){const i=h(d[0],d[1]),n=i-o;e.distance-=n*r.distanceSensitivity*.1*(.1*e.distance),o=i;const s=u(d[0],d[1]);((i,n)=>{const s=new fn,o=new fn;t.matrix.extractBasis(s,o,new fn);const a=.002*e.distance*r.panSensitivity;l.set(0,0,0),l.addScaledVector(s,-i*a),l.addScaledVector(o,n*a),e.pivotPoint.add(l)})(s.x-a,s.y-c),a=s.x,c=s.y}};return i.addEventListener("touchstart",d,{passive:!1}),i.addEventListener("touchend",p),i.addEventListener("touchcancel",p),i.addEventListener("touchmove",f,{passive:!1}),{destroy:()=>{i.removeEventListener("touchstart",d),i.removeEventListener("touchend",p),i.removeEventListener("touchcancel",p),i.removeEventListener("touchmove",f)}}}createKeyboardInput(t){const e=e=>{switch(e.key){case"ArrowLeft":t.yaw-=2;break;case"ArrowRight":t.yaw+=2;break;case"ArrowUp":e.shiftKey?t.distance*=.95:t.pitch+=2;break;case"ArrowDown":e.shiftKey?t.distance*=1.05:t.pitch-=2}},i="undefined"!=typeof window?window:null;return i&&i.addEventListener("keydown",e),{destroy:()=>{i&&i.removeEventListener("keydown",e)}}}}class Ix{constructor(t){this.context=t,this.orbitCamera=new Rx(this.context)}}class Ox{constructor(t,e){this.context=t,this.drawHelper=e,this.camera=new Ix(this.context)}}class Lx extends _y{}var Nx=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class Fx extends xy{constructor(t,e,i,r,n,s){super(i),this.context=t,this.solidText=e,this.vector=i,this.jscadWorkerManager=r,this.manifoldWorkerManager=n,this.occWorkerManager=s,this.materialCache=new Map,this.unlitMaterialCache=new Map,this.entityIdCounter=0,this.instanceId=`three-${Date.now()}`}isDisposed(){return 0===this.materialCache.size&&0===this.unlitMaterialCache.size}dispose(){this.materialCache.forEach(((t,e)=>{try{t.dispose&&t.dispose()}catch(t){console.warn(`Error disposing material ${e}:`,t)}})),this.materialCache.clear(),this.unlitMaterialCache.forEach(((t,e)=>{try{t.dispose&&t.dispose()}catch(t){console.warn(`Error disposing unlit material ${e}:`,t)}})),this.unlitMaterialCache.clear(),this.entityIdCounter=0,console.log("DrawHelper disposed successfully")}drawManifoldsOrCrossSections(t){return Nx(this,void 0,void 0,(function*(){try{const e=this.getSafeWorkerOptions(t),i=(yield this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldsOrCrossSections",e)).map((e=>this.handleDecomposedManifold(e,t))).filter((t=>void 0!==t)),r=new ua;return r.name=this.generateEntityId("manifoldMeshContainer"),i.forEach((t=>{t.parent=r})),this.context.scene.add(r),r}catch(t){throw console.error("Error drawing manifolds or cross sections:",t),new Error(`Failed to draw manifolds or cross sections: ${t instanceof Error?t.message:String(t)}`)}}))}drawManifoldOrCrossSection(t){return Nx(this,void 0,void 0,(function*(){try{if(!t.manifoldOrCrossSection)throw new Error("Manifold or cross section parameter is required");const e=this.getSafeWorkerOptions(t),i=yield this.manifoldWorkerManager.genericCallToWorkerPromise("decomposeManifoldOrCrossSection",e);return this.handleDecomposedManifold(i,t)}catch(t){throw console.error("Error drawing manifold or cross section:",t),new Error(`Failed to draw manifold or cross section: ${t instanceof Error?t.message:String(t)}`)}}))}drawShape(t){return Nx(this,void 0,void 0,(function*(){try{if(!t.shape)throw new Error("Shape parameter is required");const e=this.getSafeWorkerOptions(t),i=yield this.occWorkerManager.genericCallToWorkerPromise("shapeToMesh",e);return this.handleDecomposedMesh(t,i,t)}catch(t){throw console.error("Error drawing OCCT shape:",t),new Error(`Failed to draw OCCT shape: ${t instanceof Error?t.message:String(t)}`)}}))}drawShapes(t){return Nx(this,void 0,void 0,(function*(){try{const e=this.getSafeWorkerOptions(t),i=yield this.occWorkerManager.genericCallToWorkerPromise("shapesToMeshes",e),r=yield Promise.all(i.map((e=>Nx(this,void 0,void 0,(function*(){return this.handleDecomposedMesh(t,e,t)}))))),n=new ua;return n.name=this.generateEntityId("shapesMeshContainer"),this.context.scene.add(n),r.forEach((t=>{n.add(t)})),n}catch(t){throw console.error("Error drawing OCCT shapes:",t),new Error(`Failed to draw OCCT shapes: ${t instanceof Error?t.message:String(t)}`)}}))}drawSolidOrPolygonMesh(t){return Nx(this,void 0,void 0,(function*(){try{const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("shapeToMesh",t);if(!(e&&e.positions&&e.indices&&e.transforms)){console.warn("Corrupted worker response, returning empty mesh");const t=new ua;return t.name=this.generateEntityId("jscadMesh"),this.context.scene.add(t),t}let i,r;if(t.jscadMesh&&t.updatable?i=t.jscadMesh:(i=new ua,i.name=this.generateEntityId("jscadMesh"),this.context.scene.add(i)),t.mesh.color&&t.mesh.color.length>0){const e=t.mesh.color;r="#"+new so(e[0],e[1],e[2]).getHexString()}else r=Array.isArray(t.colours)?t.colours[0]:t.colours;const n=this.makeMesh({updatable:t.updatable,opacity:t.opacity,hidden:t.hidden,colour:r,drawTwoSided:t.drawTwoSided,backFaceColour:t.backFaceColour,backFaceOpacity:t.backFaceOpacity},i,e);return t.jscadMesh=n,n}catch(t){throw console.error("Error drawing JSCAD solid or polygon mesh:",t),new Error(`Failed to draw JSCAD mesh: ${t instanceof Error?t.message:String(t)}`)}}))}drawSolidOrPolygonMeshes(t){return Nx(this,void 0,void 0,(function*(){try{const e=yield this.jscadWorkerManager.genericCallToWorkerPromise("shapesToMeshes",t);let i;t.jscadMesh&&t.updatable?(i=t.jscadMesh,i.clear()):(i=new ua,i.name=this.generateEntityId("jscadMeshes"));const r=Array.isArray(t.colours)&&t.colours.length===e.length,n=Array.isArray(t.colours);return e.map(((e,s)=>{const o=new ua;let a;if(o.name=this.generateEntityId("jscadMesh",i.name),e.color){const t=e.color;a="#"+new so(t[0],t[1],t[2]).getHexString()}else a=r?t.colours[s]:n?t.colours[0]:t.colours;const c=this.makeMesh(Object.assign(Object.assign({},t),{colour:a,drawTwoSided:t.drawTwoSided,backFaceColour:t.backFaceColour,backFaceOpacity:t.backFaceOpacity}),o,e);i.add(c)})),this.context.scene.add(i),t.jscadMesh=i,i}catch(t){throw console.error("Error drawing JSCAD solid or polygon meshes:",t),new Error(`Failed to draw JSCAD meshes: ${t instanceof Error?t.message:String(t)}`)}}))}drawPolylinesWithColours(t){let e=t.colours;const i=t.colorMapStrategy||yx.colorMapStrategyEnum.lastColorRemainder,r=t.polylines.map(((t,i)=>{const r=t.points;return t.isClosed&&r.push(r[0]),t.color&&(Array.isArray(e)||(e=[]),Array.isArray(t.color)?e[i]="#"+new so(t.color[0],t.color[1],t.color[2]).getHexString():e[i]=t.color),r}));let n;t.polylinesMesh&&t.updatable&&(n=t.polylinesMesh.children[0]);const s=this.drawPolylines(n,r,t.updatable,t.size,t.opacity,e,i,t.arrowSize,t.arrowAngle);if(t.polylinesMesh&&t.updatable){if(t.polylinesMesh.children[0].name!==s.name){const t=new ua;return t.name=this.generateEntityId("polylines"),t.add(s),this.context.scene.add(t),t}return t.polylinesMesh}{const t=new ua;return t.name=this.generateEntityId("polylines"),t.add(s),this.context.scene.add(t),t}}drawPoint(t){const e=[t.point];let i=[];return i=Array.isArray(t.colours)?t.colours:[t.colours],t.pointMesh&&t.updatable?this.updatePointsInstances(t.pointMesh,e):t.pointMesh=this.createPointSpheresMesh(this.generateEntityId("pointMesh"),e,i,t.opacity,t.size,t.updatable),t.pointMesh}drawPolylineClose(t){const e=t.polyline.points;return t.polyline.isClosed&&e.push(e[0]),this.drawPolyline(t.polylineMesh,e,t.updatable,t.size,t.opacity,t.colours,t.arrowSize,t.arrowAngle)}drawPolyline(t,e,i,r,n,s,o=0,a=30){let c;t&&t.children.length>0&&(c=t.children[0]);const l=this.drawPolylines(c,[e],i,r,n,s,yx.colorMapStrategyEnum.lastColorRemainder,o,a);return t||((t=new ua).name=this.generateEntityId("polyline"),t.add(l),this.context.scene.add(t)),t}drawCurve(t){const e=t.curve.tessellate();return this.drawPolyline(t.curveMesh,e,t.updatable,t.size,t.opacity,t.colours)}drawPoints(t){const e=t.points,i=t.colorMapStrategy||yx.colorMapStrategyEnum.lastColorRemainder,r=this.resolveAllColors(t.colours,e.length,i);return t.pointsMesh&&t.updatable?t.pointsMesh.children.reduce(((t,e)=>e instanceof cc?t+e.count:t+1),0)===e.length?this.updatePointsInstances(t.pointsMesh,e):(t.pointsMesh.children.forEach((t=>{var e;(t instanceof Yo||t instanceof cc)&&(null===(e=t.geometry)||void 0===e||e.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((t=>t.dispose())):t.material.dispose()))})),t.pointsMesh.remove(),t.pointsMesh=this.createPointSpheresMesh(this.generateEntityId("pointsMesh"),e,r,t.opacity,t.size,t.updatable)):t.pointsMesh=this.createPointSpheresMesh(this.generateEntityId("pointsMesh"),e,r,t.opacity,t.size,t.updatable),t.pointsMesh}updatePointsInstances(t,e){const i=t.children,r=new Map;e.forEach(((t,e)=>{r.set(e,new fn(t[0],t[1],t[2]))})),i.forEach((t=>{const e=t.userData.pointIndices;if(e){const i=new ps;e.forEach(((e,n)=>{const s=r.get(e);s&&(i.setPosition(s),t.setMatrixAt(n,i))})),t.instanceMatrix.needsUpdate=!0}}))}drawCurves(t){const e=t.curves.map((t=>({points:t.tessellate()})));return this.drawPolylinesWithColours(Object.assign({polylines:e,polylinesMesh:t.curvesMesh},t))}drawSurfacesMultiColour(t){t.surfacesMesh&&t.updatable?t.surfacesMesh.clear():(t.surfacesMesh=new ua,t.surfacesMesh.name=this.generateEntityId("colouredSurfaces"),this.context.scene.add(t.surfacesMesh));const e=t.colorMapStrategy||yx.colorMapStrategyEnum.lastColorRemainder,i=this.resolveAllColors(t.colours,t.surfaces.length,e);return t.surfaces.forEach(((e,r)=>{const n=this.drawSurface({surface:e,colours:i[r],updatable:t.updatable,opacity:t.opacity,hidden:t.hidden,drawTwoSided:t.drawTwoSided,backFaceColour:t.backFaceColour,backFaceOpacity:t.backFaceOpacity});t.surfacesMesh.add(n)})),t.surfacesMesh}createOrUpdateSurfacesMesh(t,e,i,r,n,s){const o=()=>{const e=[];let i=[];const r=[],n=[];let s=0;t.forEach((t=>{if(!t||!t.positions||!t.indices)return void console.warn("Skipping corrupted mesh item");e.push(...t.positions),t.normals&&t.normals.length>0&&i.push(...t.normals),t.uvs&&n.push(...t.uvs);const o=t.indices.map((t=>t+s));r.push(...o),s+=t.positions.length/3})),0===i.length&&e.length>0&&(i=Array.from(this.computeNormals(e,r)));const o=new No;return o.setAttribute("position",new yo(Float32Array.from(e),3)),o.setAttribute("normal",new yo(Float32Array.from(i),3)),n.length>0&&(o.setAttribute("uv",new yo(Float32Array.from(n),2)),o.setAttribute("uv2",new yo(Float32Array.from(n),2))),o.setIndex(new yo(Uint32Array.from(r),1)),o};if(e&&i){e.clear();const t=o();if(r){const i=new Yo(t,r);i.castShadow=!0,i.receiveShadow=!0,e.add(i)}else{const i=new Yo(t);i.castShadow=!0,i.receiveShadow=!0,e.add(i)}}else{let t=null;n&&(t=this.context.scene),(e=new ua).name=this.generateEntityId("surface"),t.add(e);const i=o();if(r){const t=new Yo(i,r);t.castShadow=!0,t.receiveShadow=!0,e.add(t)}else{const t=new Yo(i);t.castShadow=!0,t.receiveShadow=!0,e.add(t)}}return s&&(e.visible=!1),e}drawSurface(t){var e;const i=t.surface.tessellate(),r={positions:[],indices:[],normals:[]};let n=0;i.faces.forEach((t=>{n=this.parseFaces(t,i,r,n)}));const s=Array.isArray(t.colours)?t.colours[0]:t.colours,o=this.getOrCreateMaterial(s,t.opacity,0,(()=>{const e=new Gh;return e.name=this.generateEntityId("surfaceMaterial"),e.color=new so(s),e.metalness=cy,e.roughness=dy,e.opacity=t.opacity,t.opacity<1&&(e.transparent=!0),e})),a=this.createOrUpdateSurfacesMesh([r],t.surfaceMesh,t.updatable,o,!0,t.hidden);if(!1!==t.drawTwoSided){const i=this.createBackFaceMesh([r],t.backFaceColour||gy,null!==(e=t.backFaceOpacity)&&void 0!==e?e:t.opacity,0);a.add(i)}return a}parseFaces(t,e,i,r){return t.forEach((t=>{const n=e.normals[t];i.normals.push(n[0],n[1],n[2]);const s=e.points[t];i.positions.push(s[0],s[1],s[2]),i.indices.push(r),r++})),r}makeMesh(t,e,i){var r;const n=this.getOrCreateMaterial(t.colour,t.opacity,0,(()=>{const e=new Gh;return e.name=this.generateEntityId("jscadMaterial"),e.color=new so(t.colour),e.metalness=ly,e.roughness=py,e.alphaTest=t.opacity,e.polygonOffsetFactor=0,e}));if(this.createMesh(i.positions,i.indices,i.normals,e,i.transforms,t.updatable,n),!1!==t.drawTwoSided){const n=[{positions:i.positions,indices:i.indices,normals:i.normals}],s=this.createBackFaceMesh(n,t.backFaceColour||gy,null!==(r=t.backFaceOpacity)&&void 0!==r?r:t.opacity,0);e.add(s)}return t.hidden&&(e.visible=!1),e}createMesh(t,e,i,r,n,s,o){if(!t||!e||!n)return void console.warn("Corrupted worker response, creating empty mesh");const a=new No;a.setAttribute("position",new yo(Float32Array.from(t),3)),a.setIndex(new yo(Uint32Array.from(e),1)),a.computeVertexNormals();const c=new ps;c.fromArray(n),r.clear();const l=new Yo(a,o);l.castShadow=!0,l.receiveShadow=!0,r.add(l),r.applyMatrix4(c)}handleDecomposedMesh(t,e,i){var r;return Nx(this,void 0,void 0,(function*(){const n=new ua;if(n.name=this.generateEntityId("brepMesh"),this.context.scene.add(n),t.drawFaces&&e&&e.faceList&&e.faceList.length){let i;if(t.faceMaterial)i=t.faceMaterial;else{const e=Array.isArray(t.faceColour)?t.faceColour[0]:t.faceColour,r=t.faceOpacity,n=t.drawEdges?2:0;i=this.getOrCreateMaterial(e,r,n,(()=>{const t=new Gh;return t.name=this.generateEntityId("brepMaterial"),t.color=new so(e),t.metalness=hy,t.roughness=fy,t.alphaTest=r,t.polygonOffset=!0,t.polygonOffsetFactor=n,t}))}const s=e.faceList.map((t=>({positions:t.vertex_coord,normals:t.normal_coord,indices:t.tri_indexes,uvs:t.uvs}))),o=this.createOrUpdateSurfacesMesh(s,void 0,!1,i,!0,!1);if(n.add(o),!1!==t.drawTwoSided){const e=this.createBackFaceMesh(s,t.backFaceColour||gy,null!==(r=t.backFaceOpacity)&&void 0!==r?r:t.faceOpacity,t.drawEdges?2:0);n.add(e)}}if(t.drawEdges&&e&&e.edgeList&&e.edgeList.length){const r=[];e.edgeList.forEach((t=>{const e=t.vertex_coord.filter((t=>void 0!==t));r.push(e)}));const s=this.drawPolylines(void 0,r,!1,t.edgeWidth,t.edgeOpacity,t.edgeColour,yx.colorMapStrategyEnum.lastColorRemainder,i.edgeArrowSize,i.edgeArrowAngle);n.add(s)}if(t.drawVertices&&e&&e.pointsList&&e.pointsList.length){const i=this.drawPoints({points:e.pointsList,opacity:1,size:t.vertexSize,colours:t.vertexColour,updatable:!1});n.add(i)}if(t.drawEdgeIndexes){const i=e.edgeList.map((e=>Nx(this,void 0,void 0,(function*(){let i=e.middle_point;void 0===i&&(i=this.computeEdgeMiddlePos(e));const r=new U_.TextDto;return r.text=`${e.edge_index}`,r.height=t.edgeIndexHeight,r.lineSpacing=1.5,(yield this.solidText.createVectorText(r)).map((t=>t.map((t=>[t[0],t[1]+.05,0])).map((t=>this.vector.add({first:t,second:i})))))})))),r=yield Promise.all(i),s=this.drawPolylines(void 0,r.flat(),!1,.2,1,t.edgeIndexColour);n.add(s)}if(t.drawFaceIndexes){const i=e.faceList.map((e=>Nx(this,void 0,void 0,(function*(){let i=e.center_point;void 0===i&&(i=this.computeFaceMiddlePos(e.vertex_coord_vec));const r=new U_.TextDto;return r.text=`${e.face_index}`,r.height=t.faceIndexHeight,r.lineSpacing=1.5,(yield this.solidText.createVectorText(r)).map((t=>t.map((t=>[t[0],t[1]+.05,0])).map((t=>this.vector.add({first:t,second:i})))))})))),r=yield Promise.all(i);this.drawPolylines(void 0,r.flat(),!1,.2,1,t.faceIndexColour).parent=n}return n}))}drawPolylines(t,e,i,r,n,s,o=yx.colorMapStrategyEnum.lastColorRemainder,a=0,c=30){var l;if(e&&e.length>0){const n=[],h=[],u=[];let d;if(e.forEach(((t,i)=>{const r=this.resolveColorForEntity(s,i,e.length,o);let l=0;for(let e=0;e<t.length-1;e++){const i=t[e],r=t[e+1];n.push(new fn(i[0],i[1],i[2])),n.push(new fn(r[0],r[1],r[2])),l++}h.push(l),u.push(r),a>0&&t.length>=2&&this.computeArrowHeadLines(t,a,c).forEach((t=>{n.push(new fn(t[0][0],t[0][1],t[0][2])),n.push(new fn(t[1][0],t[1][1],t[1][2])),h.push(1),u.push(r)}))})),t&&i){if((null===(l=null==t?void 0:t.userData)||void 0===l?void 0:l.linesForRenderLengths)===e.map((t=>t.length)).toString()){t.geometry.clearGroups(),t.geometry.setFromPoints(n);const e=this.computePolylineColorsWithExplicit(h,u);return t.geometry.setAttribute("color",new Po(e,3)),t}return d=this.createLineGeometry(n,s,r,h,o,u),d.userData={linesForRenderLengths:e.map((t=>t.length)).toString()},d}return d=this.createLineGeometry(n,s,r,h,o,u),d.userData={linesForRenderLengths:e.map((t=>t.length)).toString()},d}}computePolylineColors(t,e,i){const r=[],n=e.length;return e.forEach(((e,s)=>{const o=this.resolveColorForEntity(t,s,n,i),a=new so(o);for(let t=0;t<2*e;t++)r.push(a.r,a.g,a.b)})),r}computePolylineColorsWithExplicit(t,e){const i=[];return t.forEach(((t,r)=>{const n=e[r]||e[0]||"#ff0000",s=new so(n);for(let e=0;e<2*t;e++)i.push(s.r,s.g,s.b)})),i}createLineGeometry(t,e,i,r=[],n=yx.colorMapStrategyEnum.lastColorRemainder,s){const o=(new No).setFromPoints(t);let a;if(s&&s.length>0)a=this.computePolylineColorsWithExplicit(r,s);else if(r.length>0)a=this.computePolylineColors(e,r,n);else{const i=Array.isArray(e)?new so(e[0]):new so(e);a=[];for(let e=0;e<t.length;e++)a.push(i.r,i.g,i.b)}o.setAttribute("color",new Po(a,3));const c=new Wc({color:16777215,linewidth:i,vertexColors:!0}),l=new Kc(o,c);return l.name=this.generateEntityId("lines"),l}handleDecomposedManifold(t,e){var i;if(t.vertProperties){const r=t;if(0!==r.triVerts.length){const t=new No;t.setAttribute("position",new yo(r.vertProperties,3)),t.setIndex(new yo(r.triVerts,1)),t.computeVertexNormals();const n=new ua;let s;n.name=this.generateEntityId("manifoldMesh"),s=void 0===e.faceMaterial?this.getOrCreateMaterial(e.faceColour,e.faceOpacity,0,(()=>{const t=new Gh;return t.name=this.generateEntityId("manifoldMaterial"),t.color=new so(e.faceColour),t.metalness=uy,t.roughness=my,t.opacity=e.faceOpacity,t.alphaTest=1,e.computeNormals||(t.flatShading=!0),t})):e.faceMaterial;const o=new Yo(t,s);if(o.castShadow=!0,o.receiveShadow=!0,n.add(o),!1!==e.drawTwoSided){const s=Array.from(r.vertProperties),o=Array.from(r.triVerts),a=t.getAttribute("normal"),c=[{positions:s,indices:o,normals:a?Array.from(a.array):[]}],l=this.createBackFaceMesh(c,e.backFaceColour||gy,null!==(i=e.backFaceOpacity)&&void 0!==i?i:e.faceOpacity,0);n.add(l)}return this.context.scene.add(n),n}}else{const i=t;if(i.length>0){const t=new ua;t.name=this.generateEntityId("manifoldCrossSection");const r=i.map((t=>({points:t.map((t=>[t[0],t[1],0])),isClosed:!0})));return this.drawPolylinesWithColours({polylinesMesh:void 0,polylines:r,updatable:!1,size:e.crossSectionWidth,opacity:e.crossSectionOpacity,colours:e.crossSectionColour}).parent=t,this.context.scene.add(t),t}}}getSafeWorkerOptions(t){const{faceMaterial:e}=t;return function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i}(t,["faceMaterial"])}generateEntityId(t,e){const i=`${this.instanceId}-${t}-${++this.entityIdCounter}`;return e?`${e}/${i}`:i}getOrCreateMaterial(t,e,i,r,n=!1){const s=this.getMaterialKey(t,e,i,n),o=this.materialCache.get(s);if(o)return o;if(this.materialCache.size>=1e3){const t=this.materialCache.keys().next().value,e=this.materialCache.get(t);e&&e.dispose&&e.dispose(),this.materialCache.delete(t),console.warn(`Material cache full, evicted: ${t}`)}const a=r();return this.materialCache.set(s,a),a}getOrCreateUnlitMaterial(t,e,i){const r=this.getMaterialKey(t,e,0,!0),n=this.unlitMaterialCache.get(r);if(n)return n;if(this.unlitMaterialCache.size>=1e3){const t=this.unlitMaterialCache.keys().next().value,e=this.unlitMaterialCache.get(t);e&&e.dispose&&e.dispose(),this.unlitMaterialCache.delete(t),console.warn(`Unlit material cache full, evicted: ${t}`)}const s=i();return this.unlitMaterialCache.set(r,s),s}createBackFaceMesh(t,e,i,r){const n=this.getOrCreateMaterial(e+"-back",i,r+.1,(()=>{const t=new Gh;return t.name=this.generateEntityId("backFaceMaterial"),t.color=new so(e),t.metalness=cy,t.roughness=dy,t.opacity=i,t.polygonOffset=!0,t.polygonOffsetFactor=r+.1,t})),s=this.prepareBackFaceMeshData(t),o=new No;o.setAttribute("position",new yo(Float32Array.from(s.positions),3)),o.setAttribute("normal",new yo(Float32Array.from(s.normals),3)),s.uvs&&s.uvs.length>0&&o.setAttribute("uv",new yo(Float32Array.from(s.uvs),2)),o.setIndex(new yo(Uint32Array.from(s.indices),1));const a=new ua;a.name=this.generateEntityId("backFaceSurface");const c=new Yo(o,n);return c.name=this.generateEntityId("backFaceSurfaceChild"),c.castShadow=!0,c.receiveShadow=!0,a.add(c),a}createPointSpheresMesh(t,e,i,r,n,s){const o=e.map(((t,e)=>({position:t,color:i[e],posIndex:e}))),a=Array.from(new Set(i)).map((t=>{const e=this.getOrCreateUnlitMaterial(t,r,(()=>{const e=new lo({name:this.generateEntityId("pointMaterial")});return e.opacity=r,e.transparent=r<1,e.color=new so(t),e})),i=o.filter((e=>e.color===t));return{hex:t,material:e,positions:i}})),c=new ua;return c.name=t,this.context.scene.add(c),a.forEach((t=>{const e=t.positions.length;if(0===e)return;const i=e>1e3?1:6,r=new Ih(n,i,i),s=new cc(r,t.material,e);s.name=this.generateEntityId(`points-${t.hex}`);const o=[],a=new ps;t.positions.forEach(((t,e)=>{a.setPosition(t.position[0],t.position[1],t.position[2]),s.setMatrixAt(e,a),o.push(t.posIndex)})),s.instanceMatrix.needsUpdate=!0,s.userData={pointIndices:o},c.add(s)})),c}}class Ux{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ux.version}static addUnaryOp(t){return Ux.max_unop_len=Math.max(t.length,Ux.max_unop_len),Ux.unary_ops[t]=1,Ux}static addBinaryOp(t,e,i){return Ux.max_binop_len=Math.max(t.length,Ux.max_binop_len),Ux.binary_ops[t]=e,i?Ux.right_associative.add(t):Ux.right_associative.delete(t),Ux}static addIdentifierChar(t){return Ux.additional_identifier_chars.add(t),Ux}static addLiteral(t,e){return Ux.literals[t]=e,Ux}static removeUnaryOp(t){return delete Ux.unary_ops[t],t.length===Ux.max_unop_len&&(Ux.max_unop_len=Ux.getMaxKeyLen(Ux.unary_ops)),Ux}static removeAllUnaryOps(){return Ux.unary_ops={},Ux.max_unop_len=0,Ux}static removeIdentifierChar(t){return Ux.additional_identifier_chars.delete(t),Ux}static removeBinaryOp(t){return delete Ux.binary_ops[t],t.length===Ux.max_binop_len&&(Ux.max_binop_len=Ux.getMaxKeyLen(Ux.binary_ops)),Ux.right_associative.delete(t),Ux}static removeAllBinaryOps(){return Ux.binary_ops={},Ux.max_binop_len=0,Ux}static removeLiteral(t){return delete Ux.literals[t],Ux}static removeAllLiterals(){return Ux.literals={},Ux}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Ux(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map((t=>t.length)))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Ux.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ux.binary_ops[String.fromCharCode(t)]||Ux.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Ux.isIdentifierStart(t)||Ux.isDecimalDigit(t)}throwError(t){const e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(Ux.hooks[t]){const i={context:this,node:e};return Ux.hooks.run(t,i),i.node}return e}searchHook(t){if(Ux.hooks[t]){const e={context:this};return Ux.hooks[t].find((function(t){return t.call(e.context,e),e.node})),e.node}}gobbleSpaces(){let t=this.code;for(;t===Ux.SPACE_CODE||t===Ux.TAB_CODE||t===Ux.LF_CODE||t===Ux.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const t=this.gobbleExpressions(),e=1===t.length?t[0]:{type:Ux.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e,i,r=[];for(;this.index<this.expr.length;)if(e=this.code,e===Ux.SEMCOL_CODE||e===Ux.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())r.push(i);else if(this.index<this.expr.length){if(e===t)break;this.throwError('Unexpected "'+this.char+'"')}return r}gobbleExpression(){const t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Ux.max_binop_len),e=t.length;for(;e>0;){if(Ux.binary_ops.hasOwnProperty(t)&&(!Ux.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ux.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,n,s,o,a,c;if(s=this.gobbleToken(),!s)return s;if(e=this.gobbleBinaryOp(),!e)return s;for(n={value:e,prec:Ux.binaryPrecedence(e),right_a:Ux.right_associative.has(e)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+e),r=[s,n,o];e=this.gobbleBinaryOp();){if(i=Ux.binaryPrecedence(e),0===i){this.index-=e.length;break}n={value:e,prec:i,right_a:Ux.right_associative.has(e)},c=e;const a=t=>n.right_a&&t.right_a?i>t.prec:i<=t.prec;for(;r.length>2&&a(r[r.length-2]);)o=r.pop(),e=r.pop().value,s=r.pop(),t={type:Ux.BINARY_EXP,operator:e,left:s,right:o},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+c),r.push(n,t)}for(a=r.length-1,t=r[a];a>1;)t={type:Ux.BINARY_EXP,operator:r[a-1].value,left:r[a-2],right:t},a-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,Ux.isDecimalDigit(t)||t===Ux.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Ux.SQUOTE_CODE||t===Ux.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===Ux.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,Ux.max_unop_len),i=e.length;i>0;){if(Ux.unary_ops.hasOwnProperty(e)&&(!Ux.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Ux.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;const t=this.gobbleToken();return t||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ux.UNARY_EXP,operator:e,argument:t,prefix:!0})}e=e.substr(0,--i)}Ux.isIdentifierStart(t)?(r=this.gobbleIdentifier(),Ux.literals.hasOwnProperty(r.name)?r={type:Ux.LITERAL,value:Ux.literals[r.name],raw:r.name}:r.name===Ux.this_str&&(r={type:Ux.THIS_EXP})):t===Ux.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===Ux.PERIOD_CODE||e===Ux.OBRACK_CODE||e===Ux.OPAREN_CODE||e===Ux.QUMARK_CODE;){let i;if(e===Ux.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ux.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===Ux.OBRACK_CODE?((t={type:Ux.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()}).property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),e=this.code,e!==Ux.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===Ux.OPAREN_CODE?t={type:Ux.CALL_EXP,arguments:this.gobbleArguments(Ux.CPAREN_CODE),callee:t}:(e===Ux.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:Ux.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t,e,i="";for(;Ux.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(this.code===Ux.PERIOD_CODE)for(i+=this.expr.charAt(this.index++);Ux.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(t=this.char,"e"===t||"E"===t){for(i+=this.expr.charAt(this.index++),t=this.char,"+"!==t&&"-"!==t||(i+=this.expr.charAt(this.index++));Ux.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);Ux.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+i+this.char+")")}return e=this.code,Ux.isIdentifierStart(e)?this.throwError("Variable names cannot start with a number ("+i+this.char+")"):(e===Ux.PERIOD_CODE||1===i.length&&i.charCodeAt(0)===Ux.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ux.LITERAL,value:parseFloat(i),raw:i}}gobbleStringLiteral(){let t="";const e=this.index,i=this.expr.charAt(this.index++);let r=!1;for(;this.index<this.expr.length;){let e=this.expr.charAt(this.index++);if(e===i){r=!0;break}if("\\"===e)switch(e=this.expr.charAt(this.index++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:Ux.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(Ux.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Ux.isIdentifierPart(t));)this.index++;return{type:Ux.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){const e=[];let i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===t){i=!0,this.index++,t===Ux.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}if(n===Ux.COMMA_CODE){if(this.index++,r++,r!==e.length)if(t===Ux.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Ux.CBRACK_CODE)for(let t=e.length;t<r;t++)e.push(null)}else if(e.length!==r&&0!==r)this.throwError("Expected comma");else{const t=this.gobbleExpression();t&&t.type!==Ux.COMPOUND||this.throwError("Expected comma"),e.push(t)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Ux.CPAREN_CODE);if(this.code===Ux.CPAREN_CODE)return this.index++,1===t.length?t[0]:!!t.length&&{type:Ux.SEQUENCE_EXP,expressions:t};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ux.ARRAY_EXP,elements:this.gobbleArguments(Ux.CBRACK_CODE)}}}const Wx=new class{add(t,e,i){if("string"!=typeof arguments[0])for(let t in arguments[0])this.add(t,arguments[0][t],arguments[1]);else(Array.isArray(t)?t:[t]).forEach((function(t){this[t]=this[t]||[],e&&this[t][i?"unshift":"push"](e)}),this)}run(t,e){this[t]=this[t]||[],this[t].forEach((function(t){t.call(e&&e.context?e.context:e,e)}))}};Object.assign(Ux,{hooks:Wx,plugins:new class{constructor(t){this.jsep=t,this.registered={}}register(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{if("object"!=typeof t||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)}))}}(Ux),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),Ux.max_unop_len=Ux.getMaxKeyLen(Ux.unary_ops),Ux.max_binop_len=Ux.getMaxKeyLen(Ux.binary_ops);const Bx=t=>new Ux(t).parse(),zx=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(Ux).filter((t=>!zx.includes(t)&&void 0===Bx[t])).forEach((t=>{Bx[t]=Ux[t]})),Bx.Jsep=Ux;var Vx={name:"ternary",init(t){t.hooks.add("after-expression",(function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;const i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;const n=this.gobbleExpression();if(n||this.throwError("Expected expression"),e.node={type:"ConditionalExpression",test:i,consequent:r,alternate:n},i.operator&&t.binary_ops[i.operator]<=.9){let r=i;for(;r.right.operator&&t.binary_ops[r.right.operator]<=.9;)r=r.right;e.node.test=r.right,r.right=e.node,e.node=i}}else this.throwError("Expected :")}}))}};Bx.plugins.register(Vx);var Hx={name:"regex",init(t){t.hooks.add("gobble-token",(function(e){if(47===this.code){const i=++this.index;let r=!1;for(;this.index<this.expr.length;){if(47===this.code&&!r){const r=this.expr.slice(i,this.index);let n,s="";for(;++this.index<this.expr.length;){const t=this.code;if(!(t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57))break;s+=this.char}try{n=new RegExp(r,s)}catch(t){this.throwError(t.message)}return e.node={type:t.LITERAL,value:n,raw:this.expr.slice(i-1,this.index)},e.node=this.gobbleTokenProperty(e.node),e.node}this.code===t.OBRACK_CODE?r=!0:r&&this.code===t.CBRACK_CODE&&(r=!1),this.index+=92===this.code?2:1}this.throwError("Unclosed Regex")}}))}};const Gx={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[43,45],assignmentPrecedence:.9,init(t){const e=[t.IDENTIFIER,t.MEMBER_EXP];function i(t){Gx.assignmentOperators.has(t.operator)?(t.type="AssignmentExpression",i(t.left),i(t.right)):t.operator||Object.values(t).forEach((t=>{t&&"object"==typeof t&&i(t)}))}Gx.assignmentOperators.forEach((e=>t.addBinaryOp(e,Gx.assignmentPrecedence,!0))),t.hooks.add("gobble-token",(function(t){const i=this.code;Gx.updateOperators.some((t=>t===i&&t===this.expr.charCodeAt(this.index+1)))&&(this.index+=2,t.node={type:"UpdateExpression",operator:43===i?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},t.node.argument&&e.includes(t.node.argument.type)||this.throwError(`Unexpected ${t.node.operator}`))})),t.hooks.add("after-token",(function(t){if(t.node){const i=this.code;Gx.updateOperators.some((t=>t===i&&t===this.expr.charCodeAt(this.index+1)))&&(e.includes(t.node.type)||this.throwError(`Unexpected ${t.node.operator}`),this.index+=2,t.node={type:"UpdateExpression",operator:43===i?"++":"--",argument:t.node,prefix:!1})}})),t.hooks.add("after-expression",(function(t){t.node&&i(t.node)}))}};Bx.plugins.register(Hx,Gx),Bx.addUnaryOp("typeof"),Bx.addLiteral("null",null),Bx.addLiteral("undefined",void 0);const jx=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),Xx={evalAst(t,e){switch(t.type){case"BinaryExpression":case"LogicalExpression":return Xx.evalBinaryExpression(t,e);case"Compound":return Xx.evalCompound(t,e);case"ConditionalExpression":return Xx.evalConditionalExpression(t,e);case"Identifier":return Xx.evalIdentifier(t,e);case"Literal":return Xx.evalLiteral(t,e);case"MemberExpression":return Xx.evalMemberExpression(t,e);case"UnaryExpression":return Xx.evalUnaryExpression(t,e);case"ArrayExpression":return Xx.evalArrayExpression(t,e);case"CallExpression":return Xx.evalCallExpression(t,e);case"AssignmentExpression":return Xx.evalAssignmentExpression(t,e);default:throw SyntaxError("Unexpected expression",t)}},evalBinaryExpression:(t,e)=>({"||":(t,e)=>t||e(),"&&":(t,e)=>t&&e(),"|":(t,e)=>t|e(),"^":(t,e)=>t^e(),"&":(t,e)=>t&e(),"==":(t,e)=>t==e(),"!=":(t,e)=>t!=e(),"===":(t,e)=>t===e(),"!==":(t,e)=>t!==e(),"<":(t,e)=>t<e(),">":(t,e)=>t>e(),"<=":(t,e)=>t<=e(),">=":(t,e)=>t>=e(),"<<":(t,e)=>t<<e(),">>":(t,e)=>t>>e(),">>>":(t,e)=>t>>>e(),"+":(t,e)=>t+e(),"-":(t,e)=>t-e(),"*":(t,e)=>t*e(),"/":(t,e)=>t/e(),"%":(t,e)=>t%e()}[t.operator](Xx.evalAst(t.left,e),(()=>Xx.evalAst(t.right,e)))),evalCompound(t,e){let i;for(let r=0;r<t.body.length;r++){"Identifier"===t.body[r].type&&["var","let","const"].includes(t.body[r].name)&&t.body[r+1]&&"AssignmentExpression"===t.body[r+1].type&&(r+=1);const n=t.body[r];i=Xx.evalAst(n,e)}return i},evalConditionalExpression:(t,e)=>Xx.evalAst(t.test,e)?Xx.evalAst(t.consequent,e):Xx.evalAst(t.alternate,e),evalIdentifier(t,e){if(Object.hasOwn(e,t.name))return e[t.name];throw ReferenceError(`${t.name} is not defined`)},evalLiteral:t=>t.value,evalMemberExpression(t,e){const i=String(t.computed?Xx.evalAst(t.property):t.property.name),r=Xx.evalAst(t.object,e);if(null==r)throw TypeError(`Cannot read properties of ${r} (reading '${i}')`);if(!Object.hasOwn(r,i)&&jx.has(i))throw TypeError(`Cannot read properties of ${r} (reading '${i}')`);const n=r[i];return"function"==typeof n?n.bind(r):n},evalUnaryExpression:(t,e)=>({"-":t=>-Xx.evalAst(t,e),"!":t=>!Xx.evalAst(t,e),"~":t=>~Xx.evalAst(t,e),"+":t=>+Xx.evalAst(t,e),typeof:t=>typeof Xx.evalAst(t,e)}[t.operator](t.argument)),evalArrayExpression:(t,e)=>t.elements.map((t=>Xx.evalAst(t,e))),evalCallExpression(t,e){const i=t.arguments.map((t=>Xx.evalAst(t,e)));return Xx.evalAst(t.callee,e)(...i)},evalAssignmentExpression(t,e){if("Identifier"!==t.left.type)throw SyntaxError("Invalid left-hand side in assignment");const i=t.left.name,r=Xx.evalAst(t.right,e);return e[i]=r,e[i]}};function qx(t,e){return(t=t.slice()).push(e),t}function Yx(t,e){return(e=e.slice()).unshift(t),e}class Zx extends Error{constructor(t){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=t,this.name="NewError"}}function Jx(t,e,i,r,n){if(!(this instanceof Jx))try{return new Jx(t,e,i,r,n)}catch(t){if(!t.avoidNew)throw t;return t.value}"string"==typeof t&&(n=r,r=i,i=e,e=t,t=null);const s=t&&"object"==typeof t;if(t=t||{},this.json=t.json||i,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=!Object.hasOwn(t,"wrap")||t.wrap,this.sandbox=t.sandbox||{},this.eval=void 0===t.eval?"safe":t.eval,this.ignoreEvalErrors=void 0!==t.ignoreEvalErrors&&t.ignoreEvalErrors,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||r||null,this.otherTypeCallback=t.otherTypeCallback||n||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},!1!==t.autostart){const r={path:s?t.path:e};s?"json"in t&&(r.json=t.json):r.json=i;const n=this.evaluate(r);if(!n||"object"!=typeof n)throw new Zx(n);return n}}Jx.prototype.evaluate=function(t,e,i,r){let n=this.parent,s=this.parentProperty,{flatten:o,wrap:a}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,i=i||this.callback,this.currOtherTypeCallback=r||this.otherTypeCallback,e=e||this.json,(t=t||this.path)&&"object"==typeof t&&!Array.isArray(t)){if(!t.path&&""!==t.path)throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=t),o=Object.hasOwn(t,"flatten")?t.flatten:o,this.currResultType=Object.hasOwn(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=Object.hasOwn(t,"sandbox")?t.sandbox:this.currSandbox,a=Object.hasOwn(t,"wrap")?t.wrap:a,this.currEval=Object.hasOwn(t,"eval")?t.eval:this.currEval,i=Object.hasOwn(t,"callback")?t.callback:i,this.currOtherTypeCallback=Object.hasOwn(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,n=Object.hasOwn(t,"parent")?t.parent:n,s=Object.hasOwn(t,"parentProperty")?t.parentProperty:s,t=t.path}if(n=n||null,s=s||null,Array.isArray(t)&&(t=Jx.toPathString(t)),!t&&""!==t||!e)return;const c=Jx.toPathArray(t);"$"===c[0]&&c.length>1&&c.shift(),this._hasParentSelector=null;const l=this._trace(c,e,["$"],n,s,i).filter((function(t){return t&&!t.isParentSelector}));return l.length?a||1!==l.length||l[0].hasArrExpr?l.reduce(((t,e)=>{const i=this._getPreferredOutput(e);return o&&Array.isArray(i)?t=t.concat(i):t.push(i),t}),[]):this._getPreferredOutput(l[0]):a?[]:void 0},Jx.prototype._getPreferredOutput=function(t){const e=this.currResultType;switch(e){case"all":{const e=Array.isArray(t.path)?t.path:Jx.toPathArray(t.path);return t.pointer=Jx.toPointer(e),t.path="string"==typeof t.path?t.path:Jx.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return Jx.toPathString(t[e]);case"pointer":return Jx.toPointer(t.path);default:throw new TypeError("Unknown result type")}},Jx.prototype._handleCallback=function(t,e,i){if(e){const r=this._getPreferredOutput(t);t.path="string"==typeof t.path?t.path:Jx.toPathString(t.path),e(r,i,t)}},Jx.prototype._trace=function(t,e,i,r,n,s,o,a){let c;if(!t.length)return c={path:i,value:e,parent:r,parentProperty:n,hasArrExpr:o},this._handleCallback(c,s,"value"),c;const l=t[0],h=t.slice(1),u=[];function d(t){Array.isArray(t)?t.forEach((t=>{u.push(t)})):u.push(t)}if(("string"!=typeof l||a)&&e&&Object.hasOwn(e,l))d(this._trace(h,e[l],qx(i,l),e,l,s,o));else if("*"===l)this._walk(e,(t=>{d(this._trace(h,e[t],qx(i,t),e,t,s,!0,!0))}));else if(".."===l)d(this._trace(h,e,i,r,n,s,o)),this._walk(e,(r=>{"object"==typeof e[r]&&d(this._trace(t.slice(),e[r],qx(i,r),e,r,s,!0))}));else{if("^"===l)return this._hasParentSelector=!0,{path:i.slice(0,-1),expr:h,isParentSelector:!0};if("~"===l)return c={path:qx(i,l),value:n,parent:r,parentProperty:null},this._handleCallback(c,s,"property"),c;if("$"===l)d(this._trace(h,e,i,null,null,s,o));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(l))d(this._slice(l,h,e,i,r,n,s));else if(0===l.indexOf("?(")){if(!1===this.currEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const t=l.replace(/^\?\((.*?)\)$/u,"$1"),o=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(t);o?this._walk(e,(t=>{const a=[o[2]],c=o[1]?e[t][o[1]]:e[t];this._trace(a,c,i,r,n,s,!0).length>0&&d(this._trace(h,e[t],qx(i,t),e,t,s,!0))})):this._walk(e,(o=>{this._eval(t,e[o],o,i,r,n)&&d(this._trace(h,e[o],qx(i,o),e,o,s,!0))}))}else if("("===l[0]){if(!1===this.currEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");d(this._trace(Yx(this._eval(l,e,i.at(-1),i.slice(0,-1),r,n),h),e,i,r,n,s,o))}else if("@"===l[0]){let t=!1;const o=l.slice(1,-2);switch(o){case"scalar":e&&["object","function"].includes(typeof e)||(t=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===o&&(t=!0);break;case"integer":!Number.isFinite(e)||e%1||(t=!0);break;case"number":Number.isFinite(e)&&(t=!0);break;case"nonFinite":"number"!=typeof e||Number.isFinite(e)||(t=!0);break;case"object":e&&typeof e===o&&(t=!0);break;case"array":Array.isArray(e)&&(t=!0);break;case"other":t=this.currOtherTypeCallback(e,i,r,n);break;case"null":null===e&&(t=!0);break;default:throw new TypeError("Unknown value type "+o)}if(t)return c={path:i,value:e,parent:r,parentProperty:n},this._handleCallback(c,s,"value"),c}else if("`"===l[0]&&e&&Object.hasOwn(e,l.slice(1))){const t=l.slice(1);d(this._trace(h,e[t],qx(i,t),e,t,s,o,!0))}else if(l.includes(",")){const t=l.split(",");for(const o of t)d(this._trace(Yx(o,h),e,i,r,n,s,!0))}else!a&&e&&Object.hasOwn(e,l)&&d(this._trace(h,e[l],qx(i,l),e,l,s,o,!0))}if(this._hasParentSelector)for(let t=0;t<u.length;t++){const i=u[t];if(i&&i.isParentSelector){const a=this._trace(i.expr,e,i.path,r,n,s,o);if(Array.isArray(a)){u[t]=a[0];const e=a.length;for(let i=1;i<e;i++)t++,u.splice(t,0,a[i])}else u[t]=a}}return u},Jx.prototype._walk=function(t,e){if(Array.isArray(t)){const i=t.length;for(let t=0;t<i;t++)e(t)}else t&&"object"==typeof t&&Object.keys(t).forEach((t=>{e(t)}))},Jx.prototype._slice=function(t,e,i,r,n,s,o){if(!Array.isArray(i))return;const a=i.length,c=t.split(":"),l=c[2]&&Number.parseInt(c[2])||1;let h=c[0]&&Number.parseInt(c[0])||0,u=c[1]&&Number.parseInt(c[1])||a;h=h<0?Math.max(0,h+a):Math.min(a,h),u=u<0?Math.max(0,u+a):Math.min(a,u);const d=[];for(let t=h;t<u;t+=l)this._trace(Yx(t,e),i,r,n,s,o,!0).forEach((t=>{d.push(t)}));return d},Jx.prototype._eval=function(t,e,i,r,n,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=n,this.currSandbox._$_property=i,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const o=t.includes("@path");o&&(this.currSandbox._$_path=Jx.toPathString(r.concat([i])));const a=this.currEval+"Script:"+t;if(!Jx.cache[a]){let e=t.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(o&&(e=e.replaceAll("@path","_$_path")),"safe"===this.currEval||!0===this.currEval||void 0===this.currEval)Jx.cache[a]=new this.safeVm.Script(e);else if("native"===this.currEval)Jx.cache[a]=new this.vm.Script(e);else if("function"==typeof this.currEval&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const t=this.currEval;Jx.cache[a]=new t(e)}else{if("function"!=typeof this.currEval)throw new TypeError(`Unknown "eval" property "${this.currEval}"`);Jx.cache[a]={runInNewContext:t=>this.currEval(e,t)}}}try{return Jx.cache[a].runInNewContext(this.currSandbox)}catch(e){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+e.message+": "+t)}},Jx.cache={},Jx.toPathString=function(t){const e=t,i=e.length;let r="$";for(let t=1;t<i;t++)/^(~|\^|@.*?\(\))$/u.test(e[t])||(r+=/^[0-9*]+$/u.test(e[t])?"["+e[t]+"]":"['"+e[t]+"']");return r},Jx.toPointer=function(t){const e=t,i=e.length;let r="";for(let t=1;t<i;t++)/^(~|\^|@.*?\(\))$/u.test(e[t])||(r+="/"+e[t].toString().replaceAll("~","~0").replaceAll("/","~1"));return r},Jx.toPathArray=function(t){const{cache:e}=Jx;if(e[t])return e[t].concat();const i=[],r=t.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,(function(t,e){return"[#"+(i.push(e)-1)+"]"})).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,(function(t,e){return"['"+e.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"})).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,(function(t,e){return";"+e.split("").join(";")+";"})).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map((function(t){const e=t.match(/#(\d+)/u);return e&&e[1]?i[e[1]]:t}));return e[t]=r,e[t].concat()},Jx.prototype.safeVm={Script:class{constructor(t){this.code=t,this.ast=Bx(this.code)}runInNewContext(t){const e=Object.assign(Object.create(null),t);return Xx.evalAst(this.ast,e)}}},Jx.prototype.vm={Script:class{constructor(t){this.code=t}runInNewContext(t){let e=this.code;const i=Object.keys(t),r=[];!function(e,i,r){const n=e.length;for(let r=0;r<n;r++)s=e[r],"function"==typeof t[s]&&i.push(e.splice(r--,1)[0]);var s}(i,r);const n=i.map((e=>t[e]));e=r.reduce(((e,i)=>{let r=t[i].toString();return/function/u.test(r)||(r="function "+r),"var "+i+"="+r+";"+e}),"")+e,/(['"])use strict\1/u.test(e)||i.includes("arguments")||(e="var arguments = undefined;"+e),e=e.replace(/;\s*$/u,"");const s=e.lastIndexOf(";"),o=-1!==s?e.slice(0,s+1)+" return "+e.slice(s+1):" return "+e;return new Function(...i,o)(...n)}}};var Kx,$x,Qx,tb,eb,ib,rb=o(258);class nb{constructor(){this.context=new Lx,this.jscadWorkerManager=new Vy,this.manifoldWorkerManager=new Ex,this.occtWorkerManager=new f_,this.jscad=new zy(this.jscadWorkerManager),this.manifold=new Cx(this.manifoldWorkerManager);const t=new T_;this.lists=new g_,this.math=new __,this.vector=new S_(this.math,t);const e=new Fx(this.context,this.jscad.text,this.vector,this.jscadWorkerManager,this.manifoldWorkerManager,this.occtWorkerManager);this.three=new Ox(this.context,e),this.tag=new oy(this.context),this.draw=new Ax(e,this.context,this.tag),this.color=new m_(this.math),this.transforms=new w_(this.vector,this.math),this.point=new y_(t,this.transforms,this.vector,this.lists),this.line=new C_(this.vector,this.point,t),this.polyline=new E_(this.vector,this.point,this.line,t),this.verb=new Q_(this.context,t,this.math),this.time=new ay(this.context),this.occt=new z_(this.context,this.occtWorkerManager),this.asset=new ry,this.logic=new v_,this.json=new sy(this.context),this.csv=new ny,this.text=new b_(this.point),this.dates=new M_,this.mesh=new P_(this.vector,this.polyline)}init(t,e,i,r){const n={geom:rb.geom,core:rb.core};this.context.scene=t,this.context.verb=n,this.context.jsonpath=Jx,e&&this.occtWorkerManager.setOccWorker(e),i&&this.jscadWorkerManager.setJscadWorker(i),r&&this.manifoldWorkerManager.setManifoldWorker(r)}}!function(t){t.low="low",t.middle="middle",t.high="high"}(Kx||(Kx={}));class sb{constructor(){this.lod=Kx.low}}class ob{}class ab{constructor(t,e,i,r,n,s,o,a,c){this.swirl=.6,this.nrOfDivisions=10,this.addRadiusNarrow=.4,this.addRadiusWide=.2,this.addMiddleHeight=1.6,this.addTopHeight=1.5,this.thickness=1,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.swirl=t),void 0!==e&&(this.nrOfDivisions=e),void 0!==i&&(this.addRadiusNarrow=i),void 0!==r&&(this.addRadiusWide=r),void 0!==n&&(this.addMiddleHeight=n),void 0!==s&&(this.addTopHeight=s),void 0!==o&&(this.thickness=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.origin=c)}}class cb{constructor(){this.type="parametric-model",this.name="serenitySwirl"}}class lb{}class hb{constructor(t,e,i,r,n,s,o,a,c,l,h,u){this.profilePoints=[[2,0,0],[4,5,0],[1.5,10,0],[3,14,0]],this.nrOfSides=6,this.nrOfVerticalArches=4,this.archCenterThickness=.8,this.edgesThickness=.2,this.thickness=1,this.baseHeight=.4,this.patchHoles=!0,this.lod=Kx.high,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],this.scale=[1,1,1],void 0!==t&&(this.nrOfSides=t),void 0!==e&&(this.nrOfVerticalArches=e),void 0!==i&&(this.archCenterThickness=i),void 0!==r&&(this.edgesThickness=r),void 0!==n&&(this.thickness=n),void 0!==s&&(this.baseHeight=s),void 0!==o&&(this.patchHoles=o),void 0!==a&&(this.lod=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.origin=l),void 0!==h&&(this.direction=h),void 0!==u&&(this.scale=u)}}class ub{constructor(){this.type="parametric-model",this.name="arabicArchway"}}class db{}class pb{}class fb{}class mb{constructor(t,e,i,r,n,s,o,a){this.textHeading="LOVE YOU",this.textName="NORA",this.fullModel=!0,this.thickness=6,this.decorationThickness=1,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.textHeading=t),void 0!==e&&(this.textName=e),void 0!==i&&(this.fullModel=i),void 0!==r&&(this.thickness=r),void 0!==n&&(this.decorationThickness=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.origin=o),void 0!==a&&(this.direction=a)}}class gb{constructor(){this.type="parametric-model",this.name="eternalLove"}}class vb{}class _b{constructor(t,e,i,r,n,s,o,a,c,l,h,u){this.height=6,this.radiusBottom=4,this.radiusTopOffset=2,this.thickness=.6,this.fillet=.2,this.nrOfHandles=1,this.handleDist=2,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.radiusBottom=e),void 0!==i&&(this.radiusTopOffset=i),void 0!==r&&(this.thickness=r),void 0!==n&&(this.fillet=n),void 0!==s&&(this.nrOfHandles=s),void 0!==o&&(this.handleDist=o),void 0!==a&&(this.precision=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.scale=l),void 0!==h&&(this.origin=h),void 0!==u&&(this.direction=u)}}class yb{constructor(){this.type="parametric-model",this.name="calmCup"}}class xb{}class bb{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x){this.height=8,this.radiusBottom=4,this.radiusTopOffset=2,this.radiusMidOffset=2,this.rotationTopAngle=20,this.rotationMidAngle=20,this.nrSkinCellsVertical=5,this.nrSkinCellsHorizontal=10,this.nrSkinCellDivisionsTop=1,this.nrSkinCellDivisionsBottom=3,this.skinCellOuterHeight=.4,this.skinCellInnerHeight=.3,this.skinCellBottomHeight=.4,this.skinCellTopHeight=.4,this.thickness=.6,this.bottomThickness=1,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.radiusBottom=e),void 0!==i&&(this.radiusTopOffset=i),void 0!==r&&(this.radiusMidOffset=r),void 0!==n&&(this.rotationTopAngle=n),void 0!==s&&(this.rotationMidAngle=s),void 0!==o&&(this.nrSkinCellsVertical=o),void 0!==a&&(this.nrSkinCellsHorizontal=a),void 0!==c&&(this.nrSkinCellDivisionsTop=c),void 0!==l&&(this.nrSkinCellDivisionsBottom=l),void 0!==h&&(this.skinCellOuterHeight=h),void 0!==u&&(this.skinCellInnerHeight=u),void 0!==d&&(this.skinCellBottomHeight=d),void 0!==p&&(this.skinCellTopHeight=p),void 0!==f&&(this.thickness=f),void 0!==m&&(this.bottomThickness=m),void 0!==g&&(this.precision=g),void 0!==v&&(this.rotation=v),void 0!==_&&(this.scale=_),void 0!==y&&(this.origin=y),void 0!==x&&(this.direction=x)}}class Mb{constructor(){this.type="parametric-model",this.name="dragonCup"}}class Sb{}class wb{}class Tb{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v){this.heightBottom=5,this.heightTop=16,this.widthBack=25,this.widthFront=10,this.length=16,this.backOffset=6,this.thickness=.4,this.applyOrnaments=!1,this.filletRadius=2,this.phoneHeight=16.8,this.phoneWidth=7.8,this.phoneThickness=.7,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.heightBottom=t),void 0!==e&&(this.heightTop=e),void 0!==i&&(this.widthBack=i),void 0!==r&&(this.widthFront=r),void 0!==n&&(this.length=n),void 0!==s&&(this.backOffset=s),void 0!==o&&(this.thickness=o),void 0!==a&&(this.applyOrnaments=a),void 0!==c&&(this.filletRadius=c),void 0!==l&&(this.phoneHeight=l),void 0!==h&&(this.phoneWidth=h),void 0!==u&&(this.phoneThickness=u),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdges=p),void 0!==f&&(this.rotation=f),void 0!==m&&(this.scale=m),void 0!==g&&(this.origin=g),void 0!==v&&(this.direction=v)}}class Cb{constructor(){this.type="parametric-model",this.name="phoneNest"}}class Eb extends ob{}class Pb{}class Ab extends ob{}class Db{}class kb{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class Rb{}class Ib{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_){this.textTop="Pepper",this.textFront="For Your Spicy Needs",this.nrSides=4,this.nrOffsets=1,this.height=6,this.radiusBase=4,this.radiusOffset=2,this.coverHeight=1,this.baseHeight=1,this.thickness=.6,this.ornamentalThickness=.1,this.nrOrnamnetsPerSide=10,this.invertOrnaments=!1,this.fillet=.2,this.precision=.01,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.textTop=t),void 0!==e&&(this.textFront=e),void 0!==i&&(this.nrSides=i),void 0!==r&&(this.nrOffsets=r),void 0!==n&&(this.height=n),void 0!==s&&(this.coverHeight=s),void 0!==o&&(this.baseHeight=o),void 0!==a&&(this.radiusBase=a),void 0!==c&&(this.radiusOffset=c),void 0!==l&&(this.thickness=l),void 0!==h&&(this.ornamentalThickness=h),void 0!==u&&(this.nrOrnamnetsPerSide=u),void 0!==d&&(this.invertOrnaments=d),void 0!==p&&(this.fillet=p),void 0!==f&&(this.precision=f),void 0!==m&&(this.rotation=m),void 0!==g&&(this.scale=g),void 0!==v&&(this.origin=v),void 0!==_&&(this.direction=_)}}class Ob{constructor(){this.type="parametric-model",this.name="spicyBox"}}class Lb{}class Nb{}class Fb{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b,M,S,w){this.title="Your Name",this.subtitle="And Message",this.includeLogo=!0,this.thickness=.4,this.kerf=.01,this.phoneWidth=8,this.phoneHeight=16,this.phoneThickness=1,this.backLength=10,this.angle=20,this.offsetAroundPhone=.5,this.penShelf=1,this.phoneLockHeight=.5,this.filletRadius=.3,this.includePattern=!1,this.densityPattern=.4,this.holesForWire=!0,this.wireInputThickness=1.5,this.includeModel=!0,this.includeDrawings=!0,this.spacingDrawings=.5,this.rotation=0,this.origin=[0,0,0],this.direction=[0,1,0],this.scale=[1,1,1],void 0!==t&&(this.title=t),void 0!==e&&(this.subtitle=e),void 0!==i&&(this.includeLogo=i),void 0!==r&&(this.thickness=r),void 0!==n&&(this.kerf=n),void 0!==s&&(this.phoneWidth=s),void 0!==o&&(this.phoneHeight=o),void 0!==a&&(this.phoneThickness=a),void 0!==c&&(this.backLength=c),void 0!==l&&(this.angle=l),void 0!==h&&(this.offsetAroundPhone=h),void 0!==u&&(this.penShelf=u),void 0!==d&&(this.phoneLockHeight=d),void 0!==p&&(this.filletRadius=p),void 0!==f&&(this.includePattern=f),void 0!==m&&(this.densityPattern=m),void 0!==g&&(this.holesForWire=g),void 0!==v&&(this.wireInputThickness=v),void 0!==_&&(this.includeModel=_),void 0!==y&&(this.includeDrawings=y),void 0!==x&&(this.spacingDrawings=x),void 0!==b&&(this.rotation=b),void 0!==M&&(this.origin=M),void 0!==S&&(this.direction=S),void 0!==w&&(this.scale=w)}}class Ub{}class Wb{constructor(){this.cutWiresColor="#000000",this.engravingWiresColor="#0000ff",this.fileName="bitbybit-droplets-phone-holder",this.angularDeflection=.1,this.curvatureDeflection=.1,this.minimumOfPoints=2,this.uTolerance=1e-9,this.minimumLength=1e-7}}class Bb{constructor(){this.fileName="bitbybit-droplets-phone-holder",this.adjustYZ=!0}}class zb{constructor(){this.type="parametric-model",this.name="dropletsPhoneHolder"}}class Vb{}class Hb{}class Gb{}class jb{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v,_,y,x,b,M,S,w,T,C,E,P,A){this.widthFirstWing=4,this.lengthFirstWing=10,this.terraceWidth=3,this.widthSecondWing=5,this.lengthSecondWing=10,this.heightWalls=3,this.roofAngleFirstWing=15,this.roofAngleSecondWing=25,this.roofOffset=.5,this.roofInsideOverhang=.5,this.roofMaxDistAttachmentBeams=.8,this.roofAttachmentBeamWidth=.2,this.roofAttachmentBeamHeight=.05,this.roofOutsideOverhang=.5,this.columnSize=.3,this.ceilingBeamHeight=.25,this.ceilingBeamWidth=.1,this.nrCeilingBeamsBetweenColumns=3,this.distBetweenColumns=2,this.floorHeight=.1,this.groundLevel=.6,this.facadePanelThickness=.05,this.windowWidthOffset=.1,this.windowHeightOffset=.2,this.windowFrameThickness=.1,this.windowGlassFrameThickness=.05,this.lod=Kx.high,this.skinOpacity=1,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.widthFirstWing=t),void 0!==e&&(this.lengthFirstWing=e),void 0!==i&&(this.terraceWidth=i),void 0!==r&&(this.widthSecondWing=r),void 0!==n&&(this.lengthSecondWing=n),void 0!==s&&(this.heightWalls=s),void 0!==o&&(this.roofAngleFirstWing=o),void 0!==a&&(this.roofAngleSecondWing=a),void 0!==c&&(this.roofOffset=c),void 0!==l&&(this.roofInsideOverhang=l),void 0!==h&&(this.roofMaxDistAttachmentBeams=h),void 0!==u&&(this.roofAttachmentBeamWidth=u),void 0!==d&&(this.roofAttachmentBeamHeight=d),void 0!==p&&(this.roofOutsideOverhang=p),void 0!==f&&(this.columnSize=f),void 0!==m&&(this.ceilingBeamHeight=m),void 0!==g&&(this.ceilingBeamWidth=g),void 0!==v&&(this.nrCeilingBeamsBetweenColumns=v),void 0!==_&&(this.distBetweenColumns=_),void 0!==y&&(this.floorHeight=y),void 0!==x&&(this.groundLevel=x),void 0!==b&&(this.facadePanelThickness=b),void 0!==M&&(this.windowWidthOffset=M),void 0!==S&&(this.windowHeightOffset=S),void 0!==w&&(this.windowFrameThickness=w),void 0!==T&&(this.windowGlassFrameThickness=T),void 0!==C&&(this.lod=C),void 0!==E&&(this.skinOpacity=E),void 0!==P&&(this.rotation=P),void 0!==A&&(this.origin=A)}}class Xb{constructor(){this.type="parametric-model",this.name="zenHideout"}}class qb{}class Yb{}class Zb{constructor(){this.wallThickness=.4,this.facadePanelThickness=.05,this.glassFrameThickness=.02,this.glassThickness=.005,this.frameThckness=.05,this.height=3,this.lengthFirst=1,this.lengthSecond=2,this.rotation=0}}class Jb{constructor(){this.thickness=.3,this.glassFrameThickness=.02,this.glassThickness=.005,this.frameThickness=.05,this.height=3,this.width=1,this.rotation=0,this.center=[0,0,0],this.direction=[0,1,0]}}class Kb extends Jb{}class $b extends Zb{}class Qb{constructor(){this.name="sandwitch-panel",this.createWindow=!0,this.createInnerPanel=!0,this.createExteriorPanel=!0,this.wallWidth=.3,this.exteriorPanelWidth=.4,this.exteriorPanelHeight=3,this.exteriorPanelThickness=.05,this.exteriorPanelBottomOffset=0,this.interiorPanelWidth=.4,this.interiorPanelHeight=3,this.interiorPanelThickness=.05,this.interiorPanelBottomOffset=0,this.windowWidthOffset=0,this.windowHeightOffset=0,this.windowFrameThickness=.1,this.windowGlassFrameThickness=.05}}class tM{constructor(){this.name="sandwitch-panel-flex",this.createInteriorPanel=!0,this.createExteriorPanel=!0,this.wallWidth=.3,this.exteriorPanelThickness=.05,this.interiorPanelThickness=.05,this.interiorPanelPolygonPoints=[],this.exteriorPanelPolygonPoints=[]}}class eM extends Qb{}class iM extends tM{}class rM{}class nM{}class sM{}class oM{}class aM{}class cM{}class lM{constructor(){this.invert=!1,this.widthFirstLanding=1,this.widthSecondLanding=1,this.lengthFirstWing=2,this.lengthSecondWing=1,this.maxWishedStepHeight=.25,this.stepHeightWidthProportion=1.35,this.totalHeight=1,this.rotation=0,this.origin=[0,0,0]}}class hM extends lM{}class uM{}class dM{constructor(){this.name="roof-cover",this.roofAngle=15,this.roofLength=3,this.roofWidth=3,this.roofOutsideOverhang=.5,this.roofInsideOverhang=1,this.roofOverhangFacade=.1,this.roofThickness=.05,this.roofCoverHeight=.3,this.rotation=0,this.lod=Kx.high,this.center=[0,0,0],this.direction=[0,1,0]}}class pM extends dM{}class fM{}class mM{}class gM{constructor(){this.widthFirstWing=1,this.widthSecondWing=2,this.lengthStairFirstWing=2,this.lengthStairSecondWing=1,this.lengthWallFirstWing=2,this.lengthWallSecondWing=1,this.facadePanelThickness=.05,this.wallThickness=3,this.wallHeightExterior=3,this.wallHeightInterior=3,this.windowFrameOffsetTop=.3,this.windowFrameThickness=.1,this.glassFrameThickness=.05,this.doorWidth=1,this.windowWidthOffset=.3,this.stairTotalHeight=1,this.createStair=!1,this.flipDirection=!1,this.rotation=0,this.origin=[0,0,0]}}class vM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d){this.interiorWidth=3,this.interiorLength=3,this.interiorHeight=5,this.thickness=.5,this.holeDiameter=1.5,this.holeDistToBottom=2.5,this.stickLength=1.2,this.stickDiameter=.5,this.baseAttachmentHeight=2,this.roofOverhang=1,this.rotation=0,this.chimneyHeight=1,this.origin=[0,0,0],void 0!==t&&(this.interiorWidth=t),void 0!==e&&(this.interiorLength=e),void 0!==i&&(this.interiorHeight=i),void 0!==r&&(this.thickness=r),void 0!==n&&(this.holeDiameter=n),void 0!==s&&(this.holeDistToBottom=s),void 0!==o&&(this.stickLength=o),void 0!==a&&(this.stickDiameter=a),void 0!==c&&(this.baseAttachmentHeight=c),void 0!==l&&(this.roofOverhang=l),void 0!==h&&(this.rotation=h),void 0!==u&&(this.chimneyHeight=u),void 0!==d&&(this.origin=d)}}class _M{constructor(){this.type="parametric-model",this.name="wingtipVilla"}}class yM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d){this.interiorWidth=3,this.interiorLength=3,this.interiorHeight=5,this.thickness=.3,this.holeDiameter=1.2,this.holeDistToBottom=2.5,this.stickLength=.9,this.stickDiameter=.3,this.baseAttachmentHeight=2,this.roofOverhang=.5,this.roofAngle=20,this.rotation=0,this.origin=[0,0,0],void 0!==t&&(this.interiorWidth=t),void 0!==e&&(this.interiorLength=e),void 0!==i&&(this.interiorHeight=i),void 0!==r&&(this.thickness=r),void 0!==n&&(this.holeDiameter=n),void 0!==s&&(this.holeDistToBottom=s),void 0!==o&&(this.stickLength=o),void 0!==a&&(this.stickDiameter=a),void 0!==c&&(this.baseAttachmentHeight=c),void 0!==l&&(this.roofOverhang=l),void 0!==h&&(this.roofAngle=h),void 0!==u&&(this.rotation=u),void 0!==d&&(this.origin=d)}}class xM{constructor(){this.type="parametric-model",this.name="chirpyChalet"}}class bM{}class MM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f){this.sittingHeight=.45,this.backRestOffset=.1,this.backRestHeight=.7,this.width=.45,this.length=.45,this.thickness=.05,this.nrOrnamentPlanks=7,this.ornamentDepth=.01,this.filletRadius=.05,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.sittingHeight=t),void 0!==e&&(this.backRestOffset=e),void 0!==i&&(this.backRestHeight=i),void 0!==r&&(this.width=r),void 0!==n&&(this.length=n),void 0!==s&&(this.thickness=s),void 0!==o&&(this.nrOrnamentPlanks=o),void 0!==a&&(this.ornamentDepth=a),void 0!==c&&(this.filletRadius=c),void 0!==l&&(this.precision=l),void 0!==h&&(this.drawEdges=h),void 0!==u&&(this.rotation=u),void 0!==d&&(this.scale=d),void 0!==p&&(this.origin=p),void 0!==f&&(this.direction=f)}}class SM{constructor(){this.type="parametric-model",this.name="snakeChair"}}class wM extends ob{}class TM{}class CM extends ob{}class EM{}class PM{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class AM{}class DM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m){this.height=.74,this.width=1,this.length=2,this.topThickness=.02,this.topOffset=.03,this.bottomThickness=.05,this.minFillet=.2,this.radiusLegTop=.03,this.radiusLegBottom=.01,this.nrLegPairs=2,this.precision=.001,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==r&&(this.topThickness=r),void 0!==n&&(this.topOffset=n),void 0!==s&&(this.bottomThickness=s),void 0!==o&&(this.minFillet=o),void 0!==a&&(this.radiusLegTop=a),void 0!==c&&(this.radiusLegBottom=c),void 0!==l&&(this.nrLegPairs=l),void 0!==h&&(this.precision=h),void 0!==u&&(this.drawEdges=u),void 0!==d&&(this.rotation=d),void 0!==p&&(this.scale=p),void 0!==f&&(this.origin=f),void 0!==m&&(this.direction=m)}}class kM{constructor(){this.type="parametric-model",this.name="elegantTable"}}class RM extends ob{}class IM{}class OM extends ob{}class LM extends ob{}class NM{constructor(){this.index=0}}class FM{}class UM{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class WM{}class BM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g,v){this.height=.4,this.width=1,this.length=1.2,this.chamfer=.01,this.topThickness=.05,this.topGlassOffset=.2,this.glassThickness=.005,this.glassHolderLength=.02,this.shelfTopOffset=.15,this.shelfThickness=.03,this.legWidth=.1,this.legDepth=.05,this.precision=.001,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==r&&(this.chamfer=r),void 0!==n&&(this.topThickness=n),void 0!==s&&(this.topGlassOffset=s),void 0!==o&&(this.glassThickness=o),void 0!==a&&(this.glassHolderLength=a),void 0!==c&&(this.shelfTopOffset=c),void 0!==l&&(this.shelfThickness=l),void 0!==h&&(this.legWidth=h),void 0!==u&&(this.legDepth=u),void 0!==d&&(this.precision=d),void 0!==p&&(this.drawEdges=p),void 0!==f&&(this.rotation=f),void 0!==m&&(this.scale=m),void 0!==g&&(this.origin=g),void 0!==v&&(this.direction=v)}}class zM{constructor(){this.type="parametric-model",this.name="goodCoffeeTable"}}class VM extends ob{}class HM{}class GM extends ob{}class jM extends ob{}class XM extends ob{}class qM{constructor(){this.index=0}}class YM{}class ZM{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}class JM{}class KM{constructor(t,e,i,r,n,s,o,a,c,l,h,u,d,p,f,m,g){this.height=.74,this.width=1,this.length=2,this.supportLength=.5,this.shelfHeight=.2,this.thickness=.05,this.glassThickness=.005,this.glassOffset=0,this.nrOrnamentPlanks=7,this.ornamentDepth=.01,this.filletRadius=.05,this.precision=.01,this.drawEdges=!0,this.rotation=0,this.scale=1,this.origin=[0,0,0],this.direction=[0,1,0],void 0!==t&&(this.height=t),void 0!==e&&(this.width=e),void 0!==i&&(this.length=i),void 0!==r&&(this.supportLength=r),void 0!==n&&(this.shelfHeight=n),void 0!==s&&(this.thickness=s),void 0!==o&&(this.glassThickness=o),void 0!==a&&(this.glassOffset=a),void 0!==c&&(this.nrOrnamentPlanks=c),void 0!==l&&(this.ornamentDepth=l),void 0!==h&&(this.filletRadius=h),void 0!==u&&(this.precision=u),void 0!==d&&(this.drawEdges=d),void 0!==p&&(this.rotation=p),void 0!==f&&(this.scale=f),void 0!==m&&(this.origin=m),void 0!==g&&(this.direction=g)}}class $M{constructor(){this.type="parametric-model",this.name="snakeTable"}}class QM extends ob{}class tS{}class eS extends ob{}class iS{}class rS{constructor(){this.drawFaces=!0,this.precision=.001,this.drawEdges=!0,this.edgeColour="#ffffff",this.edgeWidth=.06}}!function(t){t.Aboreto="Aboreto",t.Bungee="Bungee",t.IndieFlower="IndieFlower",t.Lugrasimo="Lugrasimo",t.Orbitron="Orbitron",t.Roboto="Roboto",t.RobotoSlab="RobotoSlab",t.Silkscreen="Silkscreen",t.Tektur="Tektur",t.Workbench="Workbench"}($x||($x={})),function(t){t.Regular="Regular",t.Black="Black",t.Bold="Bold",t.ExtraBold="ExtraBold",t.Medium="Medium",t.SemiBold="SemiBold",t.BlackItalic="BlackItalic",t.BoldItalic="BoldItalic",t.Italic="Italic",t.Light="Light",t.LightItalic="LightItalic",t.MediumItalic="MediumItalic",t.Thin="Thin",t.ThinItalic="ThinItalic",t.ExtraLight="ExtraLight"}(Qx||(Qx={})),function(t){t.separatedExtrusion="separatedExtrusion",t.integratedExtrusion="integratedExtrusion",t.cutout="cutout"}(tb||(tb={})),function(t){t.compound="compound",t.cutout="originalCutout",t.cutoutInsideCharacter="cutoutInsideCharacter"}(eb||(eb={})),function(t){t.leftTop="leftTop",t.leftMiddle="leftMiddle",t.leftBottom="leftBottom",t.centerTop="centerTop",t.centerMiddle="centerMiddle",t.centerBottom="centerBottom",t.rightTop="rightTop",t.rightMiddle="rightMiddle",t.rightBottom="rightBottom"}(ib||(ib={}));const nS=[{key:"Aboreto",variants:["Regular"]},{key:"Bungee",variants:["Regular"]},{key:"IndieFlower",variants:["Regular"]},{key:"Lugrasimo",variants:["Regular"]},{key:"Orbitron",variants:["Black","Bold","ExtraBold","Medium","Regular","SemiBold"]},{key:"Roboto",variants:["Black","BlackItalic","Bold","BoldItalic","Italic","Light","LightItalic","Medium","MediumItalic","Regular","Thin","ThinItalic"]},{key:"RobotoSlab",variants:["Black","Bold","ExtraBold","ExtraLight","Light","Medium","Regular","SemiBold","Thin"]},{key:"Silkscreen",variants:["Bold","Regular"]},{key:"Tektur",variants:["Black","Bold","ExtraBold","Medium","Regular","SemiBold"]},{key:"Workbench",variants:["Regular"]}];class sS{constructor(t,e,i,r,n,s,o,a,c){this.text="bitbybit.dev",this.fontType=$x.Roboto,this.fontVariant=Qx.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.origin=[0,0,0],this.direction=[0,1,0],this.originAlignment=ib.centerMiddle,void 0!==t&&(this.text=t),void 0!==e&&(this.fontType=e),void 0!==i&&(this.fontVariant=i),void 0!==r&&(this.fontSize=r),void 0!==n&&(this.height=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.origin=o),void 0!==a&&(this.direction=a),void 0!==c&&(this.originAlignment=c)}}class oS{constructor(t,e,i,r,n,s,o,a){this.text="bitbybit.dev",this.fontUrl="https://git-cdn.bitbybit.dev/latest/fonts/Tektur/Tektur-Bold.ttf",this.fontSize=1.5,this.height=.2,this.rotation=180,this.origin=[0,0,0],this.direction=[0,1,0],this.originAlignment=ib.centerMiddle,void 0!==t&&(this.text=t),void 0!==e&&(this.fontUrl=e),void 0!==i&&(this.fontSize=i),void 0!==r&&(this.height=r),void 0!==n&&(this.rotation=n),void 0!==s&&(this.origin=s),void 0!==o&&(this.direction=o),void 0!==a&&(this.originAlignment=a)}}class aS{constructor(t,e,i,r,n,s,o,a){this.text="bitbybit.dev",this.fontSize=1.5,this.height=.2,this.rotation=180,this.origin=[0,0,0],this.direction=[0,1,0],this.originAlignment=ib.centerMiddle,void 0!==t&&(this.text=t),void 0!==e&&(this.letterPaths=e),void 0!==i&&(this.fontSize=i),void 0!==r&&(this.height=r),void 0!==n&&(this.rotation=n),void 0!==s&&(this.origin=s),void 0!==o&&(this.direction=o),void 0!==a&&(this.originAlignment=a)}}class cS{constructor(t,e,i,r,n,s,o,a,c,l,h,u){this.facePlanar=!1,this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontType=$x.Roboto,this.fontVariant=Qx.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.faceTextVar=i),void 0!==r&&(this.text=r),void 0!==n&&(this.fontType=n),void 0!==s&&(this.fontVariant=s),void 0!==o&&(this.fontSize=o),void 0!==a&&(this.height=a),void 0!==c&&(this.rotation=c),void 0!==l&&(this.originParamU=l),void 0!==h&&(this.originParamV=h),void 0!==u&&(this.originAlignment=u)}}class lS{constructor(t,e,i,r,n,s,o,a,c,l,h){this.facePlanar=!1,this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontUrl="https://git-cdn.bitbybit.dev/latest/fonts/Tektur/Tektur-Bold.ttf",this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.faceTextVar=i),void 0!==r&&(this.text=r),void 0!==n&&(this.fontUrl=n),void 0!==s&&(this.fontSize=s),void 0!==o&&(this.height=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.originParamU=c),void 0!==l&&(this.originParamV=l),void 0!==h&&(this.originAlignment=h)}}class hS{constructor(t,e,i,r,n,s,o,a,c,l,h){this.facePlanar=!1,this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.faceTextVar=i),void 0!==r&&(this.text=r),void 0!==n&&(this.letterPaths=n),void 0!==s&&(this.fontSize=s),void 0!==o&&(this.height=o),void 0!==a&&(this.rotation=a),void 0!==c&&(this.originParamU=c),void 0!==l&&(this.originParamV=l),void 0!==h&&(this.originAlignment=h)}}class uS{constructor(){this.type="parametric-model",this.name="text3d"}}class dS{constructor(){this.index=0}}class pS{}class fS{}class mS{constructor(t,e,i,r,n,s,o,a,c,l){this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontType=$x.Roboto,this.fontVariant=Qx.Regular,this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.faceTextVar=t),void 0!==e&&(this.text=e),void 0!==i&&(this.fontType=i),void 0!==r&&(this.fontVariant=r),void 0!==n&&(this.fontSize=n),void 0!==s&&(this.height=s),void 0!==o&&(this.rotation=o),void 0!==a&&(this.originParamU=a),void 0!==c&&(this.originParamV=c),void 0!==l&&(this.originAlignment=l)}}class gS{constructor(t,e,i,r,n,s,o,a,c){this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontUrl="https://git-cdn.bitbybit.dev/latest/fonts/Tektur/Tektur-Bold.ttf",this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.faceTextVar=t),void 0!==e&&(this.text=e),void 0!==i&&(this.fontUrl=i),void 0!==r&&(this.fontSize=r),void 0!==n&&(this.height=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.originParamU=o),void 0!==a&&(this.originParamV=a),void 0!==c&&(this.originAlignment=c)}}class vS{constructor(t,e,i,r,n,s,o,a,c){this.faceTextVar=tb.separatedExtrusion,this.text="bitbybit.dev",this.fontSize=1.5,this.height=.2,this.rotation=180,this.originParamU=.5,this.originParamV=.5,this.originAlignment=ib.centerMiddle,void 0!==t&&(this.faceTextVar=t),void 0!==e&&(this.text=e),void 0!==i&&(this.letterPaths=i),void 0!==r&&(this.fontSize=r),void 0!==n&&(this.height=n),void 0!==s&&(this.rotation=s),void 0!==o&&(this.originParamU=o),void 0!==a&&(this.originParamV=a),void 0!==c&&(this.originAlignment=c)}}class _S{constructor(t,e,i){this.facePlanar=!1,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.definitions=i)}}class yS{constructor(t,e,i){this.facePlanar=!1,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.definitions=i)}}class xS{constructor(t,e,i){this.facePlanar=!1,void 0!==t&&(this.face=t),void 0!==e&&(this.facePlanar=e),void 0!==i&&(this.definitions=i)}}class bS{constructor(t,e,i,r){this.uNumber=10,this.vNumber=10,this.height=.2,this.precision=.01,void 0!==t&&(this.faces=t),void 0!==r&&(this.height=r),void 0!==e&&(this.uNumber=e),void 0!==i&&(this.vNumber=i)}}class MS{constructor(t,e,i,r,n,s,o){this.uNumber=10,this.vNumber=5,this.defaultHeight=.2,this.affectMinHeight=0,this.affectMaxHeight=1,this.precision=.01,void 0!==t&&(this.faces=t),void 0!==e&&(this.affectorPoints=e),void 0!==i&&(this.uNumber=i),void 0!==r&&(this.vNumber=r),void 0!==n&&(this.affectMinHeight=n),void 0!==s&&(this.affectMaxHeight=s),void 0!==o&&(this.precision=o)}}class SS{constructor(){this.type="parametric-model",this.name="patternsFacePatternPyramidSimple"}}class wS{constructor(){this.index=0}}class TS{}class CS{}class ES{}class PS{}class AS{constructor(){this.faceIndex=0}}class DS{constructor(){this.faceIndex=0,this.uIndex=0,this.vIndex=0}}class kS{constructor(){this.faceIndex=0,this.uIndex=0}}class RS{constructor(){this.faceIndex=0,this.vIndex=0}}class IS{}class OS{}var LS;!function(t){t.wire="wire",t.face="face",t.solid="solid"}(LS||(LS={}));class NS{static parse(t,e){var i;const r=[t],n=new Set;for(;r.length>0;){const t=r.pop();if("object"==typeof t&&null!==t&&!n.has(t))if(n.add(t),Array.isArray(t))for(let e=0;e<t.length;e++)r.push(t[e]);else{if(Object.keys(t).includes("shapes")){const r=t.shapes;if("object"==typeof r&&null!==r)for(const n in r)t.shapes[n]&&(t.shapes[n]=null===(i=e.find((e=>e.id===t.shapes[n])))||void 0===i?void 0:i.shape)}for(const e in t)r.push(t[e])}}return t}}var FS=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class US{constructor(t,e,i,r){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=r}create(t){return FS(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.text3d",t),i=NS.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createTextOnFace(t){return FS(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.text3dFace",t),i=NS.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createTextsOnFace(t){return FS(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.texts3dFace",t),i=NS.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}definition3dTextOnFace(t){return t}drawModel(t,e=.003){return FS(this,void 0,void 0,(function*(){const i=new ua;i.name="brepMesh"+Math.random(),this.context.scene.add(i);const r=new xx.DrawOcctShapeOptions;r.faceOpacity=0,r.edgeColour="#bc7e5b",r.edgeWidth=.6,r.precision=e;const n=yield this.draw.drawAnyAsync({entity:t.compound,options:r}),s=new Gh;return s.name="brepMaterial"+Math.random(),s.color=new so(1,1,1),s.specularColor=new so("#ffffff"),s.metalness=0,s.roughness=.7,s.polygonOffset=!0,s.polygonOffsetUnits=2,n.children[0].material=s,i.add(n),i}))}getCompoundShape(t){return t.model.compound}getCharacterShape(t){if(t.index<0||t.index>=t.model.characterParts.length)throw new Error("Index is out of bounds.");return t.model.characterParts[t.index].shapes.compound}getCharacterShapes(t){return t.model.characterParts.map((t=>t.shapes.compound))}getCharacterCenterCoordinates(t){return t.model.characterCenterCoordinates}getFaceCutout(t){if(t.model.faceParts){const e=t.model.faceParts.filter((t=>t.type===eb.cutout)).map((t=>t.shapes.face));if(e.length>0)return e[0];throw new Error("No cutout was found.")}throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getAllFacesOfCutout(t){if(t.model.faceParts)return t.model.faceParts.filter((t=>t.type===eb.cutout||t.type===eb.cutoutInsideCharacter)).map((t=>t.shapes.face));throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getCutoutsInsideCharacters(t){if(t.model.faceParts)return t.model.faceParts.filter((t=>t.type===eb.cutoutInsideCharacter)).map((t=>t.shapes.face));throw new Error("It seems this text was not created on the face, so there is no face cutout.")}getAdvanceWidth(t){return t.model.advanceWidth}}var WS,BS=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class zS{constructor(t,e,i,r){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=r}createPyramidSimple(t){return BS(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.pyramidSimple",t),i=NS.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}createPyramidSimpleAffectors(t){return BS(this,void 0,void 0,(function*(){const e=yield this.occWorkerManager.genericCallToWorkerPromise("plugins.advanced.pyramidSimpleAffectors",t),i=NS.parse(e.data,e.shapes);return Object.assign(Object.assign({},i),{type:e.data.type,name:e.data.name,shapes:e.shapes,compound:e.compound})}))}drawModel(t){return BS(this,void 0,void 0,(function*(){const e=new ua;e.name="brepMesh"+Math.random(),this.context.scene.add(e);const i=new xx.DrawOcctShapeOptions;i.faceOpacity=0,i.edgeColour="#bc7e5b",i.edgeWidth=1,i.precision=t.originalInputs.precision;const r=yield this.draw.drawAnyAsync({entity:t.compound,options:i}),n=new Gh;return n.name="brepMaterial"+Math.random(),n.color=new so(1,1,1),n.specularColor=new so("#ffffff"),n.metalness=.3,n.roughness=.6,n.polygonOffset=!0,n.polygonOffsetUnits=2,r.children[0].material=n,e.add(r),e}))}getCompoundShape(t){return t.model.compound}getCompoundShapeOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compound;throw new Error("Face index is out of range")}getCompoundShapeCellOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length){if(t.uIndex<t.model.originalInputs.uNumber&&t.vIndex<t.model.originalInputs.vNumber){const e=t.model.faceParts[t.faceIndex].cells.find((e=>e.uIndex===t.uIndex&&e.vIndex===t.vIndex));if(e)return e.shapes.compound;throw new Error("Cell does not exist on the face")}throw new Error("Cell u or v index is out of range")}throw new Error("Face index is out of range")}getAllPyramidCells(t){return t.model.faceParts.map((t=>t.cells)).flat()}getAllPyramidCellsOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells;throw new Error("Face index is out of range")}getAllPyramidUCellsOnFace(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells;throw new Error("Face index is out of range")}getAllPyramidUCellsOnFaceAtU(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells.filter((e=>e.uIndex===t.uIndex));throw new Error("Face index is out of range")}getAllPyramidUCellsOnFaceAtV(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].cells.filter((e=>e.vIndex===t.vIndex));throw new Error("Face index is out of range")}getCellOnIndex(t){if(t.model.faceParts&&t.faceIndex<t.model.faceParts.length){if(t.uIndex<t.model.originalInputs.uNumber&&t.vIndex<t.model.originalInputs.vNumber){const e=t.model.faceParts[t.faceIndex].cells.find((e=>e.uIndex===t.uIndex&&e.vIndex===t.vIndex));if(e)return e;throw new Error("Cell does not exist on the face")}throw new Error("Cell u or v index is out of range")}throw new Error("Face index is out of range")}getTopPointsOfCells(t){return t.cells.map((t=>t.topPoint))}getCenterPointsOfCells(t){return t.cells.map((t=>t.centerPoint))}getCornerPointsOfCells(t){return t.cells.map((t=>[t.cornerPoint1,t.cornerPoint2,t.cornerPoint3,t.cornerPoint4].filter((t=>void 0!==t))))}getCornerPointOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.cornerPoint1:1===t.index?e.cornerPoint2:2===t.index?e.cornerPoint3:3===t.index?e.cornerPoint4:void 0));throw new Error("Corner index is out of range")}getCornerNormalOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.cornerNormal1:1===t.index?e.cornerNormal2:2===t.index?e.cornerNormal3:3===t.index?e.cornerNormal4:void 0));throw new Error("Corner index is out of range")}getCornerNormalsOfCells(t){return t.cells.map((t=>[t.cornerNormal1,t.cornerNormal2,t.cornerNormal3,t.cornerNormal4].filter((t=>void 0!==t))))}getCompoundShapesOfCells(t){return t.cells.map((t=>t.shapes.compound))}getFaceShapesOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.shapes.face1:1===t.index?e.shapes.face2:2===t.index?e.shapes.face3:3===t.index?e.shapes.face4:void 0));throw new Error("Face index is out of range")}getWireShapesOfCells(t){if(t.index>=0&&t.index<=3)return t.cells.map((e=>0===t.index?e.shapes.wire1:1===t.index?e.shapes.wire2:2===t.index?e.shapes.wire3:3===t.index?e.shapes.wire4:void 0));throw new Error("Wire index is out of range")}getStartPolylineWireU(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.startPolylineWireU;throw new Error("Face index is out of bounds")}getEndPolylineWireU(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.endPolylineWireU;throw new Error("Face index is out of bounds")}getStartPolylineWireV(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.startPolylineWireV;throw new Error("Face index is out of bounds")}getEndPolylineWireV(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.endPolylineWireV;throw new Error("Face index is out of bounds")}getPolylineWiresUCompound(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compoundPolylineWiresU;throw new Error("Face index is out of bounds")}getPolylineWiresVCompound(t){if(t.faceIndex>=0&&t.faceIndex<t.model.faceParts.length)return t.model.faceParts[t.faceIndex].shapes.compoundPolylineWiresV;throw new Error("Face index is out of bounds")}}class VS{constructor(t,e,i,r){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=r,this.pyramidSimple=new zS(this.occWorkerManager,this.context,this.draw,this.occt)}}class HS{constructor(t,e,i,r){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=r,this.facePatterns=new VS(this.occWorkerManager,this.context,this.draw,this.occt)}}class GS{constructor(t,e,i,r){this.occWorkerManager=t,this.context=e,this.draw=i,this.occt=r,this.text3d=new US(this.occWorkerManager,this.context,this.draw,this.occt),this.patterns=new HS(this.occWorkerManager,this.context,this.draw,this.occt)}}!function(t){t.wingtipVilla="wingtipVilla",t.chirpyChalet="chirpyChalet",t.serenitySwirl="serenitySwirl",t.arabicArchway="arabicArchway",t.zenHideout="zenHideout",t.calmCup="calmCup",t.dragonCup="dragonCup",t.spicyBox="spicyBox",t.phoneNest="phoneNest",t.elegantTable="elegantTable",t.goodCoffeeTable="goodCoffeeTable",t.snakeChair="snakeChair",t.snakeTable="snakeTable",t.eternalLove="eternalLove",t.text3d="text3d",t.patternsFacePatternPyramidSimple="patternsFacePatternPyramidSimple"}(WS||(WS={}));class jS{constructor(t,e,i){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.paths=i)}}class XS{constructor(t,e,i){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.chars=i)}}class qS{}class YS{}class ZS{}class JS{constructor(){this.type="text",this.name="text"}}class KS{}class $S extends Ax{constructor(t,e,i,r){super(t,r,e),this.drawHelper=t,this.tag=e,this.advanced=i,this.context=r}drawAnyAsync(t){const e=t.entity;if(!e||!e.type||"parametric-model"!==e.type)return super.drawAnyAsync(t);switch(t.options,e.name){case WS.text3d:return this.advanced.text3d.drawModel(e);case WS.patternsFacePatternPyramidSimple:return this.advanced.patterns.facePatterns.pyramidSimple.drawModel(e);default:throw new Error(`Unknown parametric model "${e.name}"`)}}optionsSimple(t){return super.optionsSimple(t)}optionsOcctShape(t){return super.optionsOcctShape(t)}}class QS extends nb{constructor(){super(),this.advanced=new GS(this.occtWorkerManager,this.context,this.draw,this.occt);const t=new Fx(this.context,this.jscad.text,this.vector,this.jscadWorkerManager,this.manifoldWorkerManager,this.occtWorkerManager);this.draw=new $S(t,this.tag,this.advanced,this.context)}}var tw,ew=function(){return ew=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},ew.apply(this,arguments)},iw=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))},rw=function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){t.flat="flat"}(tw||(tw={}));var nw=function(){function t(){}return t.handleBlock=function(t,e,i){},t.inputAwaiter=function(e,i,r){return iw(this,void 0,void 0,(function(){var n,s;return rw(this,(function(o){return n=Object.keys(e),s=[],n.forEach((function(t){if(e[t])if(e[t].then)e[t].then((function(i){return e[t]=i,i})),s.push(e[t]);else if(e[t].length&&e[t].length>0&&"string"!=typeof e[t])for(var i=function(i){var r=e[t][i];"object"==typeof r&&null!==r&&r.then&&(r.then((function(r){return e[t][i]=r,r})),s.push(e[t][i]))},r=0;r<e[t].length;r++)i(r)})),s.length>0&&t.startedAsyncTask(i,r,"#eeeeff"),s.length>0?[2,Promise.all(s).then((function(e){return t.finishedAsyncTask(i,r),e}))]:[2,null]}))}))},t.finishedAsyncTask=function(t,e){},t.startedAsyncTask=function(t,e,i){},t.runtimeValidation=function(t,e){},t.validate=function(t,e,i){},t.handleBlockException=function(t,e){},t.errorHappened=function(t,e,i){},t.updateListInputs=function(t){Object.keys(t).forEach((function(e){if(Array.isArray(t[e])){var i=[];t[e].forEach((function(t){if(t&&t.result){var e=t.result;t.transformers&&t.transformers.length&&t.transformers.forEach((function(t){t.type===tw.flat&&(e=e.flat())})),e instanceof Array?i.push.apply(i,e):i.push(e)}})),t[e]=i}}))},t.executeBasedOnTypeAsync=function(t,e,i){return iw(this,void 0,void 0,(function(){var r,n,s,o,a,c,l,h,u;return rw(this,(function(d){switch(d.label){case 0:if(e)return[3,5];c=this.performActionOnAllVariationsSimplified(t,i),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.all(c)];case 2:return r=d.sent(),[3,4];case 3:throw n=d.sent(),new Error(n);case 4:return[3,9];case 5:if(!e)return[3,9];for(s=Object.keys(t),o=s.map((function(e){return t[e]})),a=this.normalizeListsToEqualLength(o),c=[],l=function(t){var e={};s.forEach((function(i,r){e[i]=o[r][t]})),c.push(i(e,t))},h=0;h<a;h++)l(h);d.label=6;case 6:return d.trys.push([6,8,,9]),[4,Promise.all(c)];case 7:return r=d.sent(),[3,9];case 8:throw u=d.sent(),new Error(u);case 9:return[2,r]}}))}))},t.executeBasedOnType=function(t,e,i){var r;if(e){if(e){var n=Object.keys(t),s=n.map((function(e){return t[e]})),o=this.normalizeListsToEqualLength(s);try{r=[];for(var a=function(t){var e={};n.forEach((function(i,r){e[i]=s[r][t]})),r.push(i(e))},c=0;c<o;c++)a(c)}catch(t){throw new Error(t)}}}else try{r=this.performActionOnAllVariationsSimplified(t,i)}catch(t){throw new Error(t)}return r},t.performActionOnAllVariationsSimplified=function(t,e){var i=Object.keys(t),r=[],n=function(s,o){var a,c=0;if(s===i.length)return r.push(e(o,c)),void c++;for(var l=i[s],h=0,u=t[l];h<u.length;h++){var d=u[h],p=ew(ew({},o),((a={})[l]=d,a));n(s+1,p)}};return n(0,t),r},t.normalizeListsToEqualLength=function(t){var e=this.getLongestListLength(t);return t.forEach((function(t){if(t.length<e)for(var i=t[t.length-1],r=e-t.length,n=0;n<r;n++)t.push(i)})),e},t.getLongestListLength=function(t){var e=0;return t.forEach((function(t){t.length>e&&(e=t.length)})),e},t.drawNodeMeshes=function(t,e){return iw(this,void 0,void 0,(function(){var i,r=this;return rw(this,(function(n){switch(n.label){case 0:return i=t.map((function(t){return iw(r,void 0,void 0,(function(){var i,r,n;return rw(this,(function(s){switch(s.label){case 0:return i=t.result,r=[],i instanceof Array&&i.length>0&&i[0]&&i[0].hash?i.forEach((function(t){var i=e.draw.drawAnyAsync({entity:t,options:void 0});r.push(i)})):(n=e.draw.drawAnyAsync({entity:i,options:void 0}),r.push(n)),[4,Promise.all(r)];case 1:return[2,s.sent()]}}))}))})),[4,Promise.all(i)];case 1:return n.sent(),[2]}}))}))},t}();const sw={type:"change"},ow={type:"start"},aw={type:"end"},cw=new ds,lw=new dc,hw=Math.cos(70*un.DEG2RAD),uw=new fn,dw=2*Math.PI,pw=-1,fw=1e-6;class mw extends Vp{constructor(t,e=null){super(t,e),this.state=pw,this.target=new fn,this.cursor=new fn,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Y.ROTATE,MIDDLE:Y.DOLLY,RIGHT:Y.PAN},this.touches={ONE:Z.ROTATE,TWO:Z.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new fn,this._lastQuaternion=new pn,this._lastTargetPosition=new fn,this._quat=(new pn).setFromUnitVectors(t.up,new fn(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Kd,this._sphericalDelta=new Kd,this._scale=1,this._panOffset=new fn,this._rotateStart=new dn,this._rotateEnd=new dn,this._rotateDelta=new dn,this._panStart=new dn,this._panEnd=new dn,this._panDelta=new dn,this._dollyStart=new dn,this._dollyEnd=new dn,this._dollyDelta=new dn,this._dollyDirection=new fn,this._mouse=new dn,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=vw.bind(this),this._onPointerDown=gw.bind(this),this._onPointerUp=_w.bind(this),this._onContextMenu=Tw.bind(this),this._onMouseWheel=bw.bind(this),this._onKeyDown=Mw.bind(this),this._onTouchStart=Sw.bind(this),this._onTouchMove=ww.bind(this),this._onMouseDown=yw.bind(this),this._onMouseMove=xw.bind(this),this._interceptControlDown=Cw.bind(this),this._interceptControlUp=Ew.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(sw),this.update(),this.state=pw}update(t=null){const e=this.object.position;uw.copy(e).sub(this.target),uw.applyQuaternion(this._quat),this._spherical.setFromVector3(uw),this.autoRotate&&this.state===pw&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=dw:i>Math.PI&&(i-=dw),r<-Math.PI?r+=dw:r>Math.PI&&(r-=dw),this._spherical.theta=i<=r?Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let n=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),n=t!=this._spherical.radius}if(uw.setFromSpherical(this._spherical),uw.applyQuaternion(this._quatInverse),e.copy(this.target).add(uw),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=uw.length();t=this._clampDistance(e*this._scale);const i=e-t;this.object.position.addScaledVector(this._dollyDirection,i),this.object.updateMatrixWorld(),n=!!i}else if(this.object.isOrthographicCamera){const e=new fn(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),n=i!==this.object.zoom;const r=new fn(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(e),this.object.updateMatrixWorld(),t=uw.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(cw.origin.copy(this.object.position),cw.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(cw.direction))<hw?this.object.lookAt(this.target):(lw.setFromNormalAndCoplanarPoint(this.object.up,this.target),cw.intersectPlane(lw,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),n=!0)}return this._scale=1,this._performCursorZoom=!1,!!(n||this._lastPosition.distanceToSquared(this.object.position)>fw||8*(1-this._lastQuaternion.dot(this.object.quaternion))>fw||this._lastTargetPosition.distanceToSquared(this.target)>fw)&&(this.dispatchEvent(sw),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?dw/60*this.autoRotateSpeed*t:dw/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){uw.setFromMatrixColumn(e,0),uw.multiplyScalar(-t),this._panOffset.add(uw)}_panUp(t,e){!0===this.screenSpacePanning?uw.setFromMatrixColumn(e,1):(uw.setFromMatrixColumn(e,0),uw.crossVectors(this.object.up,uw)),uw.multiplyScalar(t),this._panOffset.add(uw)}_pan(t,e){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;uw.copy(r).sub(this.target);let n=uw.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*n/i.clientHeight,this.object.matrix),this._panUp(2*e*n/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=t-i.left,n=e-i.top,s=i.width,o=i.height;this._mouse.x=r/s*2-1,this._mouse.y=-n/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(dw*this._rotateDelta.x/e.clientHeight),this._rotateUp(dw*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(dw*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-dw*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(dw*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-dw*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panStart.set(i,r)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,r=t.pageY-e.y,n=Math.sqrt(i*i+r*r);this._dollyStart.set(0,n)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateEnd.set(i,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(dw*this._rotateDelta.x/e.clientHeight),this._rotateUp(dw*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,r=t.pageY-e.y,n=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,n),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new dn,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,i={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function gw(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function vw(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function _w(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(aw),this.state=pw;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y})}}function yw(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Y.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=1;break;case Y.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}break;case Y.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}break;default:this.state=pw}this.state!==pw&&this.dispatchEvent(ow)}function xw(t){switch(this.state){case 0:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case 1:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case 2:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function bw(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===pw&&(t.preventDefault(),this.dispatchEvent(ow),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(aw))}function Mw(t){!1!==this.enabled&&this._handleKeyDown(t)}function Sw(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Z.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=3;break;case Z.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=4;break;default:this.state=pw}break;case 2:switch(this.touches.TWO){case Z.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=5;break;case Z.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=6;break;default:this.state=pw}break;default:this.state=pw}this.state!==pw&&this.dispatchEvent(ow)}function ww(t){switch(this._trackPointer(t),this.state){case 3:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case 4:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=pw}}function Tw(t){!1!==this.enabled&&t.preventDefault()}function Cw(t){"Control"===t.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Ew(t){"Control"===t.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var Pw=pv((function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Aw(t){return function(e){if(function(t){return dv(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Dw(t,e,i,r,n){return new kw(t,e,i,r,n)}var kw=function(t){function e(e,i,r,n,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=i?function(t){try{i(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=n?function(t){try{n(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return cv(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(kv),Rw=new zv((function(t){return t.complete()}));function Iw(){return new Pw}function Ow(t,e){var i=arguments.length>=2;return function(r){return r.pipe(t?function(t,e){return Aw((function(e,i){var r=0;e.subscribe(Dw(i,(function(e){return t.call(undefined,e,r++)&&i.next(e)})))}))}((function(e,i){return t(e,i,r)})):Bv,1<=0?function(){return Rw}:Aw((function(t,e){var i=0;t.subscribe(Dw(e,(function(t){++i<=1&&(e.next(t),1<=i&&e.complete())})))})),i?function(t){return Aw((function(e,i){var r=!1;e.subscribe(Dw(i,(function(t){r=!0,i.next(t)}),(function(){r||i.next(t),i.complete()})))}))}(e):(void 0===(n=function(){return new Pw})&&(n=Iw),Aw((function(t,e){var i=!1;t.subscribe(Dw(e,(function(t){i=!0,e.next(t)}),(function(){return i?e.complete():e.error(n())})))}))));var n}}var Lw,Nw,Fw=function(){return Fw=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},Fw.apply(this,arguments)},Uw=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))},Ww=function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){t.rete="rete",t.blockly="blockly",t.typescript="typescript"}(Lw||(Lw={})),function(t){t.Aboreto="Aboreto",t.Bungee="Bungee",t.IndieFlower="IndieFlower",t.Lugrasimo="Lugrasimo",t.Orbitron="Orbitron",t.Roboto="Roboto",t.RobotoSlab="RobotoSlab",t.Silkscreen="Silkscreen",t.Tektur="Tektur",t.Workbench="Workbench"}(Nw||(Nw={}));var Bw=function(){this.canvasZoneClass="canvasZone",this.enableJSCAD=!0,this.enableOCCT=!0,this.enableManifold=!0,this.enableKeyEventListeners=!0,this.cameraPosition=[0,10,-20],this.cameraTarget=[0,0,0],this.backgroundColor="#ffffff",this.loadFonts=Object.keys(Nw),this.cdnUrl=A_.BITBYBIT_CDN_URL};console.log("%c Bitbybit Runner - Powering Incredible 3D Experiences (https://bitbybit.dev)","background: #1a1c1f; color: #f0cebb; padding: 4px 8px; border-radius: 4px; font-weight: bold;");var zw={Things:L,Advanced:z,Inputs:X,Models:j};function Vw(){return new Hw}var Hw=function(){function e(){var t=this;this.bitbybit=new QS,this.registerBeforeRender=function(e){t.bitbybit.context.renderLoopBag.forEach((function(t){return t(e)}))},this.initWithExternalScene=function(e,i){return t.bitbybit.context.scene=e,{scene:e,camera:i}},this.initScene=function(e,i){var r=new ga;e.setClearColor(new so(t.options.backgroundColor),1);var n=new oa(70,i.clientWidth/i.clientHeight,.01,1e3),s=t.options.cameraPosition;n.position.set(s[0],s[1],s[2]);var o=t.options.cameraTarget;n.lookAt(new fn(o[0],o[1],o[2])),n.aspect=i.clientWidth/i.clientHeight,n.updateProjectionMatrix();var a=new mw(n,e.domElement);window.addEventListener("resize",(function(){n.aspect=i.clientWidth/i.clientHeight,n.updateProjectionMatrix(),e.setSize(i.clientWidth,i.clientHeight)}),!1);var c=new Gu(16772863,20);return c.position.set(35,12,-15),r.add(c),t.bitbybit.context.scene=r,e.setAnimationLoop((function(i){t.registerBeforeRender(i),e.render(r,n),a.update()})),{scene:r,camera:n}}}return e.prototype.run=function(e){return Uw(this,void 0,void 0,(function(){var i=this;return Ww(this,(function(r){return this.options=Fw(Fw({},new Bw),e),e.cdnUrl&&e.cdnUrl!==A_.BITBYBIT_CDN_URL&&(A_.BITBYBIT_CDN_URL=e.cdnUrl),[2,new Promise((function(e,r){var n,s;function o(t){var e='importScripts("'.concat(t,'");');return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}try{if(i.options.enableOCCT){var a=i.options.cdnUrl+"/workers/".concat("32"===i.options.occtArch?"bitbybit-dev-occt-webworker.js":"64"===i.options.occtArch?"bitbybit-dev-occt-64-bit-webworker.js":"64-mt"===i.options.occtArch?"bitbybit-dev-occt-64-bit-mt-webworker.js":"bitbybit-dev-occt-webworker.js"),c=(s='import "'.concat(a,'";'),URL.createObjectURL(new Blob([s],{type:"text/javascript"}))),l=new Worker(c,{type:"module",name:"OCC_WORKER"});l.postMessage({type:"initialise",loadFonts:null!==(n=i.options.loadFonts)&&void 0!==n?n:[]}),URL.revokeObjectURL(c),i.bitbybit.occtWorkerManager.setOccWorker(l)}if(i.options.enableJSCAD){var h=o(i.options.cdnUrl+"/workers/bitbybit-dev-jscad-webworker.js"),u=new Worker(h,{name:"JSCAD_WORKER"});URL.revokeObjectURL(h),i.bitbybit.jscadWorkerManager.setJscadWorker(u)}if(i.options.enableManifold){var d=o(i.options.cdnUrl+"/workers/bitbybit-dev-manifold-webworker.js"),p=new Worker(d,{name:"MANIFOLD_WORKER"});URL.revokeObjectURL(d),i.bitbybit.manifoldWorkerManager.setManifoldWorker(p)}var f,m,g;if(i.options.externalThreeJSSettings){var v=i.initWithExternalScene(i.options.externalThreeJSSettings.scene,i.options.externalThreeJSSettings.camera);g=i.options.externalThreeJSSettings.renderer,f=v.scene,m=v.camera}else{var _=document.getElementById(i.options.canvasId);_.addEventListener("wheel",(function(t){return t.preventDefault()}));var y=new Fg({antialias:!0,canvas:_});y.setSize(_.clientWidth,_.clientHeight),y.setPixelRatio(window.devicePixelRatio/1.5),g=y,v=i.initScene(y,_),f=v.scene,m=v.camera}i.bitbybit.init(f),i.bitbybit.context.canvasZoneClass=i.options.canvasZoneClass,i.bitbybit.context.promptPrintSave=function(t){return console.log("Print save dialog can not be opened in the runner.")},i.bitbybit.context.promptPrint=function(t){return console.log("Print dialog can not be opened in the runner.")},i.options.enableKeyEventListeners&&(document.addEventListener("keypress",(function(t){i.bitbybit.context.keyPressBag.forEach((function(e){e.key===t.key&&e.fn()}))})),document.addEventListener("keydown",(function(t){i.bitbybit.context.currentlyPressedKeys.includes(t.key)||i.bitbybit.context.currentlyPressedKeys.push(t.key),i.bitbybit.context.keyDownBag.forEach((function(e){e.key===t.key&&e.fn()}))})),document.addEventListener("keyup",(function(t){i.bitbybit.context.currentlyPressedKeys.includes(t.key)&&(i.bitbybit.context.currentlyPressedKeys=i.bitbybit.context.currentlyPressedKeys.filter((function(e){return t.key!==e}))),i.bitbybit.context.keyUpBag.forEach((function(e){e.key===t.key&&e.fn()}))})));var x=i.bitbybit.occtWorkerManager.occWorkerState$,b=i.bitbybit.jscadWorkerManager.jscadWorkerState$,M=i.bitbybit.manifoldWorkerManager.manifoldWorkerState$,S=0,w=0,T=function(){S===w&&e({bitbybit:i.bitbybit,Bit:zw,scene:f,camera:m,renderer:g,THREEJS:t})};i.options.enableOCCT&&(w++,x.pipe(Ow()).subscribe((function(t){t.state===Hv.initialised&&(S++,T())}))),i.options.enableJSCAD&&(w++,b.pipe(Ow()).subscribe((function(t){t.state===Uy.initialised&&(S++,T())}))),i.options.enableManifold&&(w++,M.pipe(Ow()).subscribe((function(t){t.state===vx.initialised&&(S++,T())}))),0===w&&e({bitbybit:i.bitbybit,Bit:zw,scene:f,camera:m,renderer:g,THREEJS:t})}catch(t){r(t)}}))]}))}))},e.prototype.executeScript=function(e,i){return Uw(this,void 0,void 0,(function(){var r,n,s,o,a;return Ww(this,(function(c){return r=JSON.parse(e),n=function(t){throw new Error(t)},s='\n            "use strict";\n    \n            // make all global things undefined\n    \n            const bitbybitRunnerStart = async () => {\n    \n                const bitbybitRunnerInputs = '.concat(i&&Object.keys(i).length>0?JSON.stringify(i):"{}",';\n                let bitbybitRunnerResult = {};\n                const runContext = "runner";\n                const mockBitbybitRunnerInputs = (inputs) => {\n                }\n                const getBitbybitRunnerInputs = () => {\n                    return bitbybitRunnerInputs;\n                }\n                const setBitbybitRunnerResult = (result) => {\n                    bitbybitRunnerResult = result;\n                }\n                const setBitbybitRunnerResultValue = (prop, value) => {\n                    bitbybitRunnerResult[prop] = value;\n                }\n    \n                const bitbybit = this.bitbybit;\n                const Bit = this.Bit;\n                Bit.mockBitbybitRunnerInputs = mockBitbybitRunnerInputs;\n                Bit.getBitbybitRunnerInputs = getBitbybitRunnerInputs;\n                Bit.setBitbybitRunnerResult = setBitbybitRunnerResult;\n                Bit.setBitbybitRunnerResultValue = setBitbybitRunnerResultValue;\n    \n                const BitByBit = this.BitByBit;\n                const errorHandle = this.errorHandle;\n        \n                const resolve = this.resolve;\n    \n                await ').concat(r.script,"\n                if(bitbybitRunnerResult !== undefined){\n                    resolve(bitbybitRunnerResult);\n                } else {\n                    resolve(undefined);\n                }\n            }\n            \n            bitbybitRunnerStart();\n        "),o={HS:nw,BitByBitContextHelperService:this.bitbybit.context},a={bitbybit:this.bitbybit,THREEJS:t,Bit:zw,BitByBit:o,errorHandle:n},[2,new Promise((function(t){return a.resolve=t,new Function(s).apply(a)}))]}))}))},e.prototype.resetRunnerContext=function(t,e){void 0===e&&(e=!0),e&&this.bitbybit.context.scene.clear();var i=document.getElementById(this.options.canvasId);this.initScene(t,i),this.bitbybit.context.intervalBag.forEach((function(t){return clearInterval(t)})),this.bitbybit.context.timeoutBag.forEach((function(t){return clearTimeout(t)})),this.bitbybit.context.intervalBag.length=0,this.bitbybit.context.timeoutBag.length=0,this.bitbybit.context.renderLoopBag.length=0,this.bitbybit.context.keyPressBag.length=0,this.bitbybit.context.keyDownBag.length=0,this.bitbybit.context.keyUpBag.length=0},e.prototype.cleanOCCTCache=function(){return Uw(this,void 0,void 0,(function(){return Ww(this,(function(t){return[2,this.bitbybit.occtWorkerManager.cleanAllCache()]}))}))},e.prototype.cleanJSCADCache=function(){return Uw(this,void 0,void 0,(function(){return Ww(this,(function(t){return[2,this.bitbybit.jscadWorkerManager.cleanAllCache()]}))}))},e.prototype.cleanManifoldCache=function(){return Uw(this,void 0,void 0,(function(){return Ww(this,(function(t){return[2,this.bitbybit.manifoldWorkerManager.cleanAllCache()]}))}))},e}()})(),a})()));